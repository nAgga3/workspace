/* Thinfinity(c) Remote Desktop Server v7.0.3.114 */
/*
 zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License  @overview es6-promise - a tiny implementation of Promises/A+.
 @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 @license   Licensed under MIT license
            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 @version   v4.2.8+1e68dce6
 jQuery blockUI plugin
 Version 2.70.0-2014.11.23
 Requires jQuery v1.7 or later

 Examples at: http://malsup.com/jquery/block/
 Copyright (c) 2007-2013 M. Alsup
 Dual licensed under the MIT and GPL licenses:
 http://www.opensource.org/licenses/mit-license.php
 http://www.gnu.org/licenses/gpl.html

 Thanks to Amir-Hossein Sobhi for some excellent contributions!
 jQuery AjaxQ - AJAX request queueing for jQuery

 Version: 0.0.1
 Date: July 22, 2008

 Copyright (c) 2008 Oleg Podolsky (oleg.podolsky@gmail.com)
 Licensed under the MIT (MIT-LICENSE.txt) license.

 http://plugins.jquery.com/project/ajaxq
 http://code.google.com/p/jquery-ajaxq/
 Original code (c) 2010 Nick Galbreath
 http://code.google.com/p/stringencoders/source/browse/#svn/trunk/javascript

 jQuery port (c) 2010 Carlo Zottmann
 http://github.com/carlo/jquery-base64

 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
 Hammer.JS - v2.0.8 - 2016-04-23
 http://hammerjs.github.io/

 Copyright (c) 2016 Jorik Tangelder;
 Licensed under the MIT license  protobuf.js v7.2.5 (c) 2016, daniel wirtz
 compiled tue, 22 aug 2023 00:04:29 utc
 licensed under the bsd-3-clause license
 see: https://github.com/dcodeio/protobuf.js for details
*/
Object.defineProperty(window,"productId",{"enumerable":true,"configurable":false,"get":function(){return"virtualui"}});Object.defineProperty(window,"cookiePrefix",{"enumerable":true,"configurable":false,"get":function(){return"FMX"}});Object.defineProperty(window,"productName",{"enumerable":true,"configurable":false,"get":function(){return"Thinfinity Remote Workspace"}});"use strict";
(function(exports){if(exports.requestFileSystem||exports.webkitRequestFileSystem)return;const indexedDB=exports.indexedDB||exports.mozIndexedDB||exports.msIndexedDB;if(!indexedDB)return;let IDB_SUPPORTS_BLOB=true;const support=new function(){var dbName="blob-support";indexedDB.deleteDatabase(dbName).onsuccess=function(){var request=indexedDB.open(dbName,1);request.onerror=function(){IDB_SUPPORTS_BLOB=false};request.onsuccess=function(){var db=request.result;try{var blob=new Blob(["test"],{type:"text/plain"});
var transaction=db.transaction("store","readwrite");transaction.objectStore("store").put(blob,"key");IDB_SUPPORTS_BLOB=true}catch(err){IDB_SUPPORTS_BLOB=false}finally{db.close();indexedDB.deleteDatabase(dbName)}};request.onupgradeneeded=function(){request.result.createObjectStore("store")}}};const Base64ToBlob=function(dataURL){var BASE64_MARKER=";base64,";if(dataURL.indexOf(BASE64_MARKER)==-1){var parts=dataURL.split(",");var contentType=parts[0].split(":")[1];var raw=decodeURIComponent(parts[1]);
return new Blob([raw],{type:contentType})}var parts=dataURL.split(BASE64_MARKER);var contentType=parts[0].split(":")[1];var raw=window.atob(parts[1]);var rawLength=raw.length;var uInt8Array=new Uint8Array(rawLength);for(var i=0;i<rawLength;++i)uInt8Array[i]=raw.charCodeAt(i);return new Blob([uInt8Array],{type:contentType})};const BlobToBase64=function(blob,onload){var reader=new FileReader;reader.readAsDataURL(blob);reader.onloadend=function(){onload(reader.result)}};if(!exports.PERSISTENT){exports.TEMPORARY=
0;exports.PERSISTENT=1}if(exports.FileError===undefined){window.FileError=function(){};FileError.prototype.prototype=Error.prototype}if(!FileError.INVALID_MODIFICATION_ERR){FileError.INVALID_MODIFICATION_ERR=9;FileError.NOT_FOUND_ERR=1}function MyFileError(obj){var code_=obj.code;var name_=obj.name;Object.defineProperty(this,"code",{set:function(code){code_=code},get:function(){return code_}});Object.defineProperty(this,"name",{set:function(name){name_=name},get:function(){return name_}})}MyFileError.prototype=
FileError.prototype;MyFileError.prototype.toString=Error.prototype.toString;const INVALID_MODIFICATION_ERR=new MyFileError({code:FileError.INVALID_MODIFICATION_ERR,name:"INVALID_MODIFICATION_ERR"});const NOT_IMPLEMENTED_ERR=new MyFileError({code:1E3,name:"Not implemented"});const NOT_FOUND_ERR=new MyFileError({code:FileError.NOT_FOUND_ERR,name:"Not found"});let fs_=null;let storageType_="temporary";const idb_={db:null};const FILE_STORE_="entries";const DIR_SEPARATOR="/";const DIR_OPEN_BOUND=String.fromCharCode(DIR_SEPARATOR.charCodeAt(0)+
1);function resolveToFullPath_(cwdFullPath,path){var fullPath=path;var relativePath=path[0]!=DIR_SEPARATOR;if(relativePath)fullPath=cwdFullPath+DIR_SEPARATOR+path;var parts=fullPath.split(DIR_SEPARATOR);var finalParts=[];for(var i=0;i<parts.length;++i){var part=parts[i];if(part===".."){if(!finalParts.length)throw Error("Invalid path");finalParts.pop()}else if(part===".");else if(part!=="")finalParts.push(part)}fullPath=DIR_SEPARATOR+finalParts.join(DIR_SEPARATOR);return fullPath}function MyFile(opts){var blob_=
null;this.size=opts.size||0;this.name=opts.name||"";this.type=opts.type||"";this.lastModifiedDate=opts.lastModifiedDate||null;Object.defineProperty(this,"blob_",{enumerable:true,get:function(){return blob_},set:function(val){blob_=val;this.size=blob_.size;this.name=blob_.name;this.type=blob_.type;this.lastModifiedDate=blob_.lastModifiedDate}.bind(this)})}MyFile.prototype.constructor=MyFile;function FileWriter(fileEntry){if(!fileEntry)throw Error("Expected fileEntry argument to write.");var position_=
0;var blob_=fileEntry.file_?fileEntry.file_.blob_:null;Object.defineProperty(this,"position",{get:function(){return position_}});Object.defineProperty(this,"length",{get:function(){return blob_?blob_.size:0}});this.seek=function(offset){position_=offset;if(position_>this.length)position_=this.length;if(position_<0)position_+=this.length;if(position_<0)position_=0};this.truncate=function(size){if(blob_)if(size<this.length)blob_=blob_.slice(0,size);else blob_=new Blob([blob_,new Uint8Array(size-this.length)],
{type:blob_.type});else blob_=new Blob([]);position_=0;this.write(blob_)};this.write=function(data){if(!data)throw Error("Expected blob argument to write.");if(this.onwritestart)this.onwritestart();if(blob_){var head=blob_.slice(0,position_);var tail=blob_.slice(position_+data.size);var padding=position_-head.size;if(padding<0)padding=0;blob_=new Blob([head,new Uint8Array(padding),data,tail],{type:blob_.type})}else blob_=new Blob([data],{type:data.type});const writeFile=function(blob){fileEntry.file_.blob_=
blob;fileEntry.file_.lastModifiedDate=data.lastModifiedDate||new Date;idb_.put(fileEntry,function(entry){if(!IDB_SUPPORTS_BLOB){fileEntry.file_.blob_=blob_;fileEntry.file_.lastModifiedDate=data.lastModifiedDate||null}position_+=data.size;if(this.onwriteend)this.onwriteend()}.bind(this),this.onerror)}.bind(this);if(IDB_SUPPORTS_BLOB)writeFile(blob_);else BlobToBase64(blob_,writeFile)}}function DirectoryReader(dirEntry){var dirEntry_=dirEntry;var used_=false;this.readEntries=function(successCallback,
opt_errorCallback){if(!successCallback)throw Error("Expected successCallback argument.");if(!used_)idb_.getAllEntries(dirEntry_.fullPath,function(entries){used_=true;successCallback(entries)},opt_errorCallback);else successCallback([])}}function Metadata(modificationTime,size){this.modificationTime_=modificationTime||null;this.size_=size||0}Metadata.prototype={get modificationTime(){return this.modificationTime_},get size(){return this.size_}};function Entry(){}Entry.prototype={name:null,fullPath:null,
filesystem:null,copyTo:function(){throw NOT_IMPLEMENTED_ERR;},getMetadata:function(successCallback,opt_errorCallback){if(!successCallback)throw Error("Expected successCallback argument.");try{if(this.isFile)successCallback(new Metadata(this.file_.lastModifiedDate,this.file_.size));else opt_errorCallback(new MyFileError({code:1001,name:"getMetadata() not implemented for DirectoryEntry"}))}catch(e){opt_errorCallback&&opt_errorCallback(e)}},getParent:function(){throw NOT_IMPLEMENTED_ERR;},moveTo:function(){throw NOT_IMPLEMENTED_ERR;
},remove:function(successCallback,opt_errorCallback){if(!successCallback)throw Error("Expected successCallback argument.");idb_["delete"](this.fullPath,function(){successCallback()},opt_errorCallback)},toURL:function(){var origin=location.protocol+"//"+location.host;return"filesystem:"+origin+DIR_SEPARATOR+storageType_.toLowerCase()+this.fullPath}};function FileEntry(opt_fileEntry){this.file_=null;Object.defineProperty(this,"isFile",{enumerable:true,get:function(){return true}});Object.defineProperty(this,
"isDirectory",{enumerable:true,get:function(){return false}});if(opt_fileEntry){this.file_=opt_fileEntry.file_;this.name=opt_fileEntry.name;this.fullPath=opt_fileEntry.fullPath;this.filesystem=opt_fileEntry.filesystem;if(typeof this.file_.blob_==="string")this.file_.blob_=Base64ToBlob(this.file_.blob_)}}FileEntry.prototype=new Entry;FileEntry.prototype.constructor=FileEntry;FileEntry.prototype.createWriter=function(callback){callback(new FileWriter(this))};FileEntry.prototype.file=function(successCallback,
opt_errorCallback){if(!successCallback)throw Error("Expected successCallback argument.");if(this.file_==null){if(opt_errorCallback)opt_errorCallback(NOT_FOUND_ERR);else throw NOT_FOUND_ERR;return}var file=this.file_.blob_==null?this.file_:this.file_.blob_;file.lastModifiedDate=this.file_.lastModifiedDate;successCallback(file)};function DirectoryEntry(opt_folderEntry){Object.defineProperty(this,"isFile",{enumerable:true,get:function(){return false}});Object.defineProperty(this,"isDirectory",{enumerable:true,
get:function(){return true}});if(opt_folderEntry){this.name=opt_folderEntry.name;this.fullPath=opt_folderEntry.fullPath;this.filesystem=opt_folderEntry.filesystem}}DirectoryEntry.prototype=new Entry;DirectoryEntry.prototype.constructor=DirectoryEntry;DirectoryEntry.prototype.createReader=function(){return new DirectoryReader(this)};DirectoryEntry.prototype.getDirectory=function(path,options,successCallback,opt_errorCallback){path=resolveToFullPath_(this.fullPath,path);idb_.get(path,function(folderEntry){if(!options)options=
{};if(options.create===true&&options.exclusive===true&&folderEntry){if(opt_errorCallback){opt_errorCallback(INVALID_MODIFICATION_ERR);return}}else if(options.create===true&&!folderEntry){var dirEntry=new DirectoryEntry;dirEntry.name=path.split(DIR_SEPARATOR).pop();dirEntry.fullPath=path;dirEntry.filesystem=fs_;idb_.put(dirEntry,successCallback,opt_errorCallback)}else if(options.create===true&&folderEntry)if(folderEntry.isDirectory)successCallback(new DirectoryEntry(folderEntry));else{if(opt_errorCallback){opt_errorCallback(INVALID_MODIFICATION_ERR);
return}}else if((!options.create||options.create===false)&&!folderEntry){if(path==DIR_SEPARATOR){folderEntry=new DirectoryEntry;folderEntry.name="";folderEntry.fullPath=DIR_SEPARATOR;folderEntry.filesystem=fs_;successCallback(folderEntry);return}if(opt_errorCallback){opt_errorCallback(NOT_FOUND_ERR);return}}else if((!options.create||options.create===false)&&folderEntry&&folderEntry.isFile){if(opt_errorCallback){opt_errorCallback(INVALID_MODIFICATION_ERR);return}}else successCallback(new DirectoryEntry(folderEntry))},
opt_errorCallback)};DirectoryEntry.prototype.getFile=function(path,options,successCallback,opt_errorCallback){path=resolveToFullPath_(this.fullPath,path);idb_.get(path,function(fileEntry){if(!options)options={};if(options.create===true&&options.exclusive===true&&fileEntry){if(opt_errorCallback){opt_errorCallback(INVALID_MODIFICATION_ERR);return}}else if(options.create===true&&!fileEntry){var fileEntry=new FileEntry;fileEntry.name=path.split(DIR_SEPARATOR).pop();fileEntry.fullPath=path;fileEntry.filesystem=
fs_;fileEntry.file_=new MyFile({size:0,name:fileEntry.name,lastModifiedDate:new Date});idb_.put(fileEntry,successCallback,opt_errorCallback)}else if(options.create===true&&fileEntry)if(fileEntry.isFile)successCallback(new FileEntry(fileEntry));else{if(opt_errorCallback){opt_errorCallback(INVALID_MODIFICATION_ERR);return}}else if((!options.create||options.create===false)&&!fileEntry){if(opt_errorCallback){opt_errorCallback(NOT_FOUND_ERR);return}}else if((!options.create||options.create===false)&&fileEntry&&
fileEntry.isDirectory){if(opt_errorCallback){opt_errorCallback(INVALID_MODIFICATION_ERR);return}}else successCallback(new FileEntry(fileEntry))},opt_errorCallback)};DirectoryEntry.prototype.removeRecursively=function(successCallback,opt_errorCallback){if(!successCallback)throw Error("Expected successCallback argument.");this.remove(successCallback,opt_errorCallback)};function DOMFileSystem(type,size){storageType_=type==exports.TEMPORARY?"Temporary":"Persistent";this.name=(location.protocol+location.host).replace(/:/g,
"_")+":"+storageType_;this.root=new DirectoryEntry;this.root.fullPath=DIR_SEPARATOR;this.root.filesystem=this;this.root.name=""}function requestFileSystem(type,size,successCallback,opt_errorCallback){if(type!=exports.TEMPORARY&&type!=exports.PERSISTENT)if(opt_errorCallback){opt_errorCallback(INVALID_MODIFICATION_ERR);return}fs_=new DOMFileSystem(type,size);idb_.open(fs_.name,function(e){successCallback(fs_)},opt_errorCallback)}function resolveLocalFileSystemURL(url,successCallback,opt_errorCallback){var origin=
location.protocol+"//"+location.host;var base="filesystem:"+origin+DIR_SEPARATOR+storageType_.toLowerCase();url=url.replace(base,"");if(url.substr(-1)==="/")url=url.slice(0,-1);if(url)idb_.get(url,function(entry){if(entry)if(entry.isFile)return successCallback(new FileEntry(entry));else{if(entry.isDirectory)return successCallback(new DirectoryEntry(entry))}else opt_errorCallback&&opt_errorCallback(NOT_FOUND_ERR)},opt_errorCallback);else successCallback(fs_.root)}idb_.open=function(dbName,successCallback,
opt_errorCallback){var self=this;var request=indexedDB.open(dbName.replace(":","_"));request.onerror=opt_errorCallback||onError;request.onupgradeneeded=function(e){self.db=e.target.result;self.db.onerror=onError;if(!self.db.objectStoreNames.contains(FILE_STORE_))var store=self.db.createObjectStore(FILE_STORE_)};request.onsuccess=function(e){self.db=e.target.result;self.db.onerror=onError;successCallback(e)};request.onblocked=opt_errorCallback||onError};idb_.close=function(){this.db.close();this.db=
null};idb_.drop=function(successCallback,opt_errorCallback){if(!this.db)return;var dbName=this.db.name;var request=indexedDB.deleteDatabase(dbName);request.onsuccess=function(e){successCallback(e)};request.onerror=opt_errorCallback||onError;idb_.close()};idb_.get=function(fullPath,successCallback,opt_errorCallback){if(!this.db)return;var tx=this.db.transaction([FILE_STORE_],"readonly");var range=IDBKeyRange.bound(fullPath,fullPath+DIR_OPEN_BOUND,false,true);var request=tx.objectStore(FILE_STORE_).get(range);
tx.onabort=opt_errorCallback||onError;tx.oncomplete=function(e){successCallback(request.result)}};idb_.getAllEntries=function(fullPath,successCallback,opt_errorCallback){if(!this.db)return;var results=[];var range=null;if(fullPath!=DIR_SEPARATOR)range=IDBKeyRange.bound(fullPath+DIR_SEPARATOR,fullPath+DIR_OPEN_BOUND,false,true);var tx=this.db.transaction([FILE_STORE_],"readonly");tx.onabort=opt_errorCallback||onError;tx.oncomplete=function(e){results=results.filter(function(val){var valPartsLen=val.fullPath.split(DIR_SEPARATOR).length;
var fullPathPartsLen=fullPath.split(DIR_SEPARATOR).length;if(fullPath==DIR_SEPARATOR&&valPartsLen<fullPathPartsLen+1)return val;else if(fullPath!=DIR_SEPARATOR&&valPartsLen==fullPathPartsLen+1)return val});successCallback(results)};var request=tx.objectStore(FILE_STORE_).openCursor(range);request.onsuccess=function(e){var cursor=e.target.result;if(cursor){var val=cursor.value;results.push(val.isFile?new FileEntry(val):new DirectoryEntry(val));cursor["continue"]()}}};idb_["delete"]=function(fullPath,
successCallback,opt_errorCallback){if(!this.db)return;var tx=this.db.transaction([FILE_STORE_],"readwrite");tx.oncomplete=successCallback;tx.onabort=opt_errorCallback||onError;var range=IDBKeyRange.bound(fullPath,fullPath+DIR_OPEN_BOUND,false,true);var request=tx.objectStore(FILE_STORE_)["delete"](range)};idb_.put=function(entry,successCallback,opt_errorCallback){if(!this.db)return;var tx=this.db.transaction([FILE_STORE_],"readwrite");tx.onabort=opt_errorCallback||onError;tx.oncomplete=function(e){successCallback(entry)};
var request=tx.objectStore(FILE_STORE_).put(entry,entry.fullPath)};function onError(e){switch(e.target.errorCode){case 12:console.log("Error - Attempt to open db with a lower version than the "+"current one.");break;default:console.log("errorCode: "+e.target.errorCode)}console.log(e,e.code,e.message)}exports.addEventListener("beforeunload",function(e){idb_.db&&idb_.db.close()},false);exports.requestFileSystem=requestFileSystem;exports.resolveLocalFileSystemURL=resolveLocalFileSystemURL;if(exports===
window&&exports.RUNNING_TESTS){exports["Entry"]=Entry;exports["FileEntry"]=FileEntry;exports["DirectoryEntry"]=DirectoryEntry;exports["resolveToFullPath_"]=resolveToFullPath_;exports["Metadata"]=Metadata;exports["Base64ToBlob"]=Base64ToBlob}})(self);
(function(){function StatusAPI(){var _ref=this;var _wnd=null;var _propKey="__#statusapi__";var _variables={};var _variablesDef={};function initialize(){_wnd=getTopWindow(window);var instance=_wnd[_propKey];if(instance)_ref=instance;else createInstance()}function getTopWindow(wnd){if(wnd.parent&&wnd.parent!=wnd)try{var hasError=true;if(wnd.parent.location.href){hasError=false;return getTopWindow(wnd.parent)}}catch(error){hasError=true}finally{if(hasError)return wnd}else return wnd}function createInstance(){attachHandlers();
defineProperties();_wnd[_propKey]=_ref}function attachHandlers(){window.addEventListener("addStatusAPIVariables",function(e){if(e&&e.detail)add(e.detail)})}function add(variables){if(variables){if(!variables.forEach)variables=[variables];var newOnes=false;variables.forEach(function(variable){if(_variables[variable.name]===undefined){newOnes=true;_variablesDef[variable.name]=variable;_variablesDef[variable.name].__attached={};Object.defineProperty(_variables,variable.name,{"enumerable":true,"configurable":false,
"get":variable.get})}else helper.console.log(helper.string.format("This variable is already registered [{0}]",variable.name),arguments)});if(newOnes)window.dispatchEvent(new CustomEvent("newStatusAPIVariables",null))}}function getValue(name){if(_variablesDef[name])return _variablesDef[name].get();else return undefined}function dump(name){var variablesToAdd=[];for(var kvp in _variablesDef){var variable=_variablesDef[kvp];if(name===undefined||!variable.__attached[name]){variablesToAdd.push(variable);
if(name!==undefined)variable.__attached[name]=true}}return variablesToAdd}function defineProperties(){Object.defineProperty(_ref,"add",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(_ref,"get",{"enumerable":true,"configurable":false,"writable":false,"value":getValue});Object.defineProperty(_ref,"dump",{"enumerable":true,"configurable":false,"writable":false,"value":dump});Object.defineProperty(_ref,"variables",{"enumerable":true,"configurable":false,"get":function(){return _variables}})}
initialize();return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.StatusAPI=new StatusAPI})();
(function(){function BrowserTracking(){var _ref=this;var _gatewayId="";var _windowId="";var _elapsedTimes={};var _countType={"none":0,"start":1,"end":2};var _events={};var _elapsed=0;function initialize(){_windowId=getGUID();_gatewayId=Thinfinity.global.variables.gwsid}function getGUID(){function uuidv4(){return"WNDID-xxxxxxxx-xxxx-ZMQ-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}return uuidv4().toUpperCase()}function _log(action,
name,data,statusCode,cType){if(_gatewayId==="")_gatewayId=Thinfinity.global.variables.gwsid;if(cType===_countType.start)_elapsedTimes[action]=(new Date).getTime();else if(cType===_countType.end){_elapsed=_elapsedTimes[action]?(new Date).getTime()-_elapsedTimes[action]:-999;delete _elapsedTimes[action]}var strAction=action+(name!=""?"."+name:"");try{if(cType!==_countType.end)window.external.LogEvent(_gatewayId,_windowId,strAction,data,statusCode);else window.external.LogElapsed(_gatewayId,_windowId,
strAction,data,_elapsed)}catch(error){if(cType!==_countType.end)console.log("GatewayId: "+_gatewayId+", event: "+strAction+" ,data: "+data+" ,status: "+statusCode);else console.log("GatewayId: "+_gatewayId+", event: "+strAction+" ,data: "+data+" ,status: "+statusCode+" ,elapsed: "+_elapsed+"ms")}}function closeBrowserFn(){try{}catch(error){window.console.log("Close Browser")}finally{_log("Page.Window","Close","thinfinity.browsertracking.js","",eCountType.none);window.close()}}function requireUnloadFn(){triggerEvent(["disconnect"]);
setTimeout(function(){closeBrowserFn()},1E3)}function addEvent(name,handler){if(name==undefined||name==null||name=="")return"Name is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";name=name.toLowerCase();var item={"name":name,"handler":handler};var isContained=false;if(_events[name]==undefined)_events[name]=[];else for(var i=0;i<_events[name].length;i++)if(_events[name][i].handler==item.handler){isContained=true;break}if(!isContained)_events[name].push(item);
return true}function removeEvent(name,event){var ret=false;if(name==undefined||name==null||name=="")return"Name is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";name=name.toLowerCase();var item={"name":name,"handler":handler};if(_events[name]==undefined)return"Cannot find event. Event is not in the command list.";else for(var i=0;i<_events[name].length;i++)if(_events[name][i].handler.toString()==item.handler.toString()){_events[name].splice(i,
1);ret=true}return ret}function triggerEvent(eventNames){var atLeastOne=false;if(eventNames){if(typeof eventNames=="string")eventNames=[eventNames];for(var k=0;k<eventNames.length;k++)if(_events[eventNames[k].toLowerCase()]!=undefined)for(var i=0;i<_events[eventNames[k].toLowerCase()].length;i++)try{_events[eventNames[k].toLowerCase()][i].handler()}catch(error){}}}function findActiveElapseTimes(){var l=[];for(var k in _elapsedTimes)l.push(k);return l}function terminateFn(action,msg,code){setTimeout(function(){_log("Page.Terminate",
action,msg,code,_countType.none);setTimeout(function(){closeBrowserFn()},1E3)},500)}initialize();Object.defineProperty(_ref,"countType",{"configurable":false,"enumerable":true,"get":function(){return _countType}});Object.defineProperty(_ref,"gatewayId",{"configurable":false,"enumerable":true,"get":function(){return _gatewayId},"set":function(gatewayId){return _gatewayId=gatewayId}});Object.defineProperty(_ref,"windowId",{"configurable":false,"enumerable":true,"get":function(){return _windowId}});
Object.defineProperty(_ref,"log",{"configurable":false,"enumerable":true,"writable":false,"value":_log});Object.defineProperty(_ref,"closeBrowser",{"configurable":false,"enumerable":true,"writable":false,"value":closeBrowserFn});Object.defineProperty(_ref,"requireUnload",{"configurable":false,"enumerable":true,"writable":false,"value":requireUnloadFn});Object.defineProperty(_ref,"on",{"configurable":false,"enumerable":true,"writable":false,"value":addEvent});Object.defineProperty(_ref,"off",{"configurable":false,
"enumerable":true,"writable":false,"value":removeEvent});Object.defineProperty(_ref,"terminate",{"configurable":false,"enumerable":true,"writable":false,"value":terminateFn})}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.BrowserTracking=BrowserTracking;try{var r=window.external.eventTrackingAvailable;if(r){window.browserTracking=new Thinfinity.BrowserTracking;window.eCountType=browserTracking.countType;browserTracking.log("Page.Load","Start",location.href,"",eCountType.start);window.onload=
function(){browserTracking.log("Page.Load","End",location.href,"",eCountType.end)}}}catch(error){}})();
(function(){var _binding=[{"base":"common","propName":"defaultSettings","scraper":false,"search":"customSettings"},{"base":"settings","propName":"customSettings","scraper":true},{"base":"editorSettings","propName":"customProfileDefaults","scraper":true}];var _warn=console.warn||console.log;function initialize(){if(window.cookiePrefix)_binding.forEach(function(item){if(window.userSettings&&(userSettings[window.cookiePrefix]&&userSettings[window.cookiePrefix][item.propName]||userSettings[item.base]&&
userSettings[item.base][item.search])){_warn("Loading settings ["+item.base+"] from deprecated customSettings instead of web.settings.");var _get=userSettings[window.cookiePrefix]&&userSettings[window.cookiePrefix][item.propName]?userSettings[window.cookiePrefix][item.propName]:userSettings[item.base][item.search];if(!window[item.propName])Object.defineProperty(window,item.propName,{"enumerable":true,"configurable":false,"get":function(){return _get}});else _warn("Cannot create web settings, ["+_definePropertyName+
"] property is already defined")}else if(window[item.base])if(item.scraper)if(window[item.base][window.cookiePrefix])if(!window[item.propName])Object.defineProperty(window,item.propName,{"enumerable":true,"configurable":false,"get":function(){return window[item.base][window.cookiePrefix]}});else _warn("Cannot create web settings, ["+_definePropertyName+"] property is already defined");else _warn(JSON.stringify(window[item.base])+" definitions is empty for this scraper ["+window.cookiePrefix+"], please complete the requested info.");
else{if(!window[item.propName])Object.defineProperty(window,item.propName,{"enumerable":true,"configurable":false,"get":function(){return window[item.base]}})}else _warn(item.base+" is not defined, please check web.settings file in DB folder")});else _warn("cookiePrefix is not defined");window.addEventListener("load",function(){if(typeof customSettings!="undefined")Object.defineProperty(customSettings,"defaultValues",{"enumerable":true,"configurable":false,"get":function(){return{"mobile":{"gestures":Thinfinity&&
Thinfinity.Mobile?Thinfinity.Mobile.defaultTouchGestures:[]}}}})})}initialize()})();
(function(){function EmbedScript(args){var _ref=this;function initialize(args){}function findInitialBracket(s){var p={"idx":null,"row":null};var idx=-1;var row=0;if(s){var found=false;while(!found&&row<s.length){idx=s[row].indexOf("{");if(idx!=-1){p.row=row;p.idx=idx+1;found=true}row++}}return p}function findFinalBracket(s){var p={"idx":null,"row":null};var idx=-1;var row=0;if(s){row=s.length-1;var found=false;while(!found&&row>=0){idx=s[row].lastIndexOf("}");if(idx!=-1){p.row=row;p.idx=Math.max(0,
idx-1);found=true}row++}}return p}function convertToString(fn){var s=fn.toString().split("\n");var ib=findInitialBracket(s);var fb=findFinalBracket(s);var row=ib.row+1;var str=s[ib.row].substr(ib.idx);while(row<s.length&&row<fb.row){str+=s[row];row++}str+=s[fb.row].substr(0,fb.idx);return str.replace(/^\s+/,"").replace(/\s+$/,"")}function findLocation(s,loc,ib){var r={"row":null,"idx":null};var row=ib.row,idx=ib.idx;if(loc.row!=undefined){r.row=loc.row+ib.row;if(loc.idx==undefined)r.idx=0;if(loc.row==
ib.row)r.idx+=ib.idx}else if(loc.text){loc.text=loc.text.replace(/^\s+/,"").replace(/\s+$/,"");var found=false;while(!found&&row<s.length){if(row==ib.row&&s[row].substr(idx).indexOf(loc.text)!=-1){found=true;r.row=row;r.idx=s[row].indexOf(loc.text)}else if(s[row].indexOf(loc.text)!=-1){found=true;r.row=row;r.idx=s[row].indexOf(loc.text)}row++}}else if(loc.position==="beforeEnd"){var fb=findFinalBracket(s);r.idx=fb.idx;if(fb.idx==0&&fb.row>0){r.idx=s[fb.row-1].length;r.row=fb.row-1}}if(loc.position)if(loc.position===
"after"&&r.row<s.length){r.row++;r.idx=0}else if(loc.position==="before"&&r.row>0){r.row--;r.idx=s[r.row].length}return r}function getFunctionName(args){try{var fName="";if(args!=null&&args!=undefined&&args.callee!=undefined){var calleeName=args.callee&&args.callee.name?args.callee.name:"[anonymous]";var callerName=args.callee&&args.callee.caller&&args.callee.caller.name?args.callee.caller.name:"[anonymous]";fName=calleeName+" from "+callerName}return fName}catch(error){genericLog(error,arguments);
return"[unknown]"}}function isAnonymous(s){}function uuidv4(){return"TMPFN_xxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})+"_"+(new Date).getTime()}function getTempName(){return uuidv4().toUpperCase()}function addFnName(name,s,alias){if(name!=""&&s)if(s instanceof Array)s.splice(0,0,(alias&&alias!=""?alias+".":"var ")+name+" = ");else return(alias&&alias!=""?alias+".":"var ")+name+" = "+s}function embedScript(code,sourceFn,loc,scope,alias){var sFn=
null;var name=null;var isAnonymous=false;if(sourceFn===""&&scope.eval){scope.eval(code);return}else if(typeof sourceFn=="string"&&scope){sFn=sourceFn.indexOf(".")==-1?scope[sourceFn]:eval("scope."+sourceFn);name=getFunctionName(sFn);isAnonymous=name=="";name=sourceFn;sFn=sFn.toString()}else if(sourceFn instanceof Function){name=getFunctionName(sFn);isAnonymous=name=="";sFn=sourceFn.toString()}else if(code)eval(code);if(sFn&&code){if(code instanceof Function)code=convertToString(code);if(loc.btp&&
loc.btp!=""&&sFn.indexOf(loc.btp)!=-1){var s=sFn.indexOf(loc.btp);var tFn=sFn.substr(s);var ep=tFn.indexOf(";")+1;var output=sFn.substr(0,s)+code+sFn.substr(s+ep);if(isAnonymous&&scope.eval){output=addFnName(name,output,alias);scope.eval(output)}else window.eval(output)}else{sFn=sFn.split("\n");var added=false;var i=0;var ib=findInitialBracket(sFn);if(ib&&ib.row!=undefined){ib=findLocation(sFn,loc,ib);if(ib){sFn[ib.row]=[sFn[ib.row].slice(0,ib.idx),code,sFn[ib.row].slice(ib.idx)].join("\n");var tempName=
null;if(isAnonymous)tempName=addFnName(name,sFn,alias);var output=sFn.join("\n");if(isAnonymous&&scope.eval)scope.eval(output);else window.eval(output)}else console.log("Cannot insert code")}}}else return"sourceFn is not a valid Function"}function embedScripts(eScripts,scope){if(eScripts&&scope)for(var i=0;i<eScripts.length;i++)embedScript(eScripts[i].code,eScripts[i].sourceFn,eScripts[i].position,scope,eScripts[i].alias)}initialize(args);Object.defineProperty(_ref,"embed",{"enumerable":true,"configurable":false,
"writable":false,"value":embedScript});Object.defineProperty(_ref,"add",{"enumerable":true,"configurable":false,"writable":false,"value":embedScripts});return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.EmbedScript=EmbedScript;try{var r=window.external.eventTrackingAvailable;if(r)window.eScript=new Thinfinity.EmbedScript}catch(error){}})();
if(window.browserTracking){var logs={"thinvnc.sdk":[{"sourceFn":"connect","code":"browserTracking.log('Page.Connect.GetServerURL', 'Start', '', '', eCountType.start);","position":{"btp":"BTP_PCG_STR","text":"if (_fromBroker) {","position":"after"},"alias":"TVNC"},{"sourceFn":"connect","code":"browserTracking.log('Page.Connect.GetServerURL', 'End', _location, '', eCountType.end);","position":{"btp":"BTP_PCG_END","text":"_location = TVNC.getAjaxUrl();","position":"after"},"alias":"TVNC"},{"sourceFn":"connect",
"code":"browserTracking.log('Page.Connect.GetServerURL', 'Error', 'emtpy response, calling connect again ', '-1', eCountType.end);","position":{"btp":"BTP_PCG_ERR","text":"TVNC.connect(userid, password);","position":"before"},"alias":"TVNC"},{"sourceFn":"postConnect","code":"browserTracking.log('Page.CheckSize', 'Start', _location, '', eCountType.start);","position":{"btp":"BTP_PCS_STR","text":"TVNC.checkSizeAndResolution(function () {","position":"before"},"alias":"TVNC"},{"sourceFn":"postConnect",
"code":"browserTracking.log('Page.CheckSize', 'End', _location, '', eCountType.end);","position":{"btp":"BTP_PCS_END","text":"TVNC.checkSizeAndResolution(function () {","position":"after"},"alias":"TVNC"},{"sourceFn":"postConnect","code":"browserTracking.log('Page.Connect.Request', 'Start', _location, '', eCountType.start);","position":{"btp":"BTP_PCR_STR","text":"serverCmdResultOrientation = null;","position":"before"},"alias":"TVNC"},{"sourceFn":"onConnectResult","code":"browserTracking.log('Page.Connect.Request','End', helper.string.format('LogFile: {0}, ServerProcessId: {1}', (obj && obj.logFile ? obj.logFile : ''), (obj && obj.serverProcessId ? obj.serverProcessId : '')),'' , eCountType.end);",
"position":{"btp":"BTP_PCR_END1","text":'if (obj.status && typeof obj.status != "undefined") {',"position":"before"},"alias":"TVNC"},{"sourceFn":"postConnect","code":"browserTracking.log('Page.Connect.Request', 'End', 'Redirect', '200', eCountType.end);","position":{"btp":"BTP_PCR_END2","text":"top.location.href = redirect;","position":"before"},"alias":"TVNC"},{"sourceFn":"postConnect","code":"browserTracking.log('Page.Connect.Request', 'Retry', 'Connect was fail, trying to connect again.' ,'', eCountType.none);",
"position":{"btp":"BTP_PCR_RTY","text":"if (TVNC.reconnecting) {","position":"after"},"alias":"TVNC"},{"sourceFn":"postConnect","code":"browserTracking.log('Page.Connect.Request', 'Error', jqXHR.statusText, jqXHR.status.toString(), eCountType.end);","position":{"btp":"BTP_PCR_ERR3","text":"error: function (jqXHR, err) {","position":"after"},"alias":"TVNC"},{"sourceFn":"postConnect","code":"browserTracking.log('Page.Connect.Request', 'End', 'Reload - Is not a valid HTML', '', eCountType.end);","position":{"btp":"BTP_PCR_ERR4",
"text":"$(window).off('onbeforeunload');","position":"after"},"alias":"TVNC"},{"sourceFn":"processDrawCmds","code":"if (cmd && cmd.ec != '') { browserTracking.log('Page.Connect.Logon','Error', helper.string.format('Logon Error - code: {0}, data: {1}, description: {2}', (cmd.ec)?cmd.ec:'', (cmd.d)? cmd.d:'', (cmd.s)?cmd.s:''),'' , eCountType.none); }","position":{"btp":"BTP_PCL_ERR","text":'} else if (cmd.c == "LE") {',"position":"after"},"alias":"TVNC"},{"sourceFn":"serverCmdResult","code":"browserTracking.log('Page.Session', 'Start', '', '', eCountType.start);",
"position":{"btp":"BTP_PS_STR","text":'if ((typeof TVNC.rcParams.events == "undefined") || (TVNC.rcParams.events.onSessionStart == null)) {',"position":"before"},"alias":"TVNC"},{"sourceFn":"serverCmdResult","code":"if (!window._sessionEnd) {window._sessionEnd = true; browserTracking.log('Page.Session', 'End', '', '', eCountType.start);}","position":{"btp":"BTP_PS_STP","text":'if ((typeof TVNC.rcParams.events == "undefined") || (TVNC.rcParams.events.onSessionStop == null)) {',"position":"before"},
"alias":"TVNC"},{"sourceFn":"receiveScreen","code":"if (!window._sessionEnd) {window._sessionEnd = true;browserTracking.log('Page.Session', 'End', 'obj.status == 9', '', eCountType.end);}","position":{"btp":"BTP_PS_END1","text":"_isSessionEnded = true;","position":"after"},"alias":"TVNC"},{"sourceFn":"disconnect","code":"if (window._remoteApp_) browserTracking.log('Page.RemoteApp', 'End', '', '', eCountType.end);\n window._remoteApp_=false;\n browserTracking.log('Page.Session', 'End', '', '', eCountType.end);",
"position":{"btp":"BTP_PS_END2","text":"TVNC.fromReconnection = false;","position":"before"},"alias":"TVNC"},{"sourceFn":"onConnectResult","code":"browserTracking.log('Page.Ajax', 'Start', 'Switching to Ajax', '', eCountType.none);","position":{"btp":"BTP_PA_STR","text":"TVNC.start();","position":"before"},"alias":"TVNC"},{"sourceFn":"connectWebSocket","code":"browserTracking.log('Page.WebSocket', 'Initialize', '', '', eCountType.none);","position":{"btp":"BTP_WS_INIT","row":0},"alias":"TVNC"},{"sourceFn":"connectWebSocket",
"code":"browserTracking.log('Page.WebSocket', 'Open', '', '', eCountType.start);","position":{"btp":"BTP_WS_OPEN","text":"resetLastError();","position":"before"},"alias":"TVNC"},{"sourceFn":"connectWebSocket","code":"browserTracking.log('Page.WebSocket', 'Close', helper.string.format('Event - Code: {0}, EventPhase: {1}, Reason: {2}, Type: {3}', e.code, e.eventPhase, e.reason, e.type),'', eCountType.end);","position":{"btp":"BTP_WS_CLOSE1","text":"TVNC.ws.onclose = function (e) { ","position":"after"},
"alias":"TVNC"},{"sourceFn":"connectWebSocket","code":"browserTracking.log('Page.WebSocket', 'Timeout', 'Switching to AJAX mode', '', eCountType.end);","position":{"btp":"BTP_WS_TOUT","text":"var wstimer = setTimeout(function () {","position":"after"},"alias":"TVNC"},{"sourceFn":"connectWebSocket","code":"browserTracking.log('Page.WebSocket', 'Error', helper.string.format('Event - Code: {0}, EventPhase: {1}, Reason: {2}, Type: {3}', e.code, e.eventPhase, e.reason, e.type), e.code, eCountType.end);",
"position":{"btp":"BTP_WS_ERR","text":"TVNC.ws.onerror = function (e) {","position":"after"},"alias":"TVNC"},{"sourceFn":"connectWebSocket","code":"browserTracking.log('Page.WebSocket', 'Error', 'Reconnecting', '', eCountType.none);","position":{"btp":"BTP_WS_ERR1","text":"if (TVNC.wsEnabled && !TVNC.useAjax) {","position":"after"},"alias":"TVNC"},{"sourceFn":"connectWebSocket","code":"browserTracking.log('Page.WebSocket', 'Error', 'Switch to Ajax', '', eCountType.none);","position":{"btp":"BTP_WS_ERR2",
"text":'helper.console.log("TVNC.start. useAjax: " + TVNC.useAjax + ", wsEnabled: " + TVNC.wsEnabled, arguments);',"position":"after"},"alias":"TVNC"},{"sourceFn":"onConnectResult","code":"browserTracking.terminate('Need.Credentials','',-1);\nreturn;","position":{"btp":"BTP_PT_NC","text":"} else if (obj.authStatus == 4) {","position":"after"},"alias":"TVNC"},{"sourceFn":"serverCmdResult","code":"browserTracking.log('Page.Session','Error', (errormsg) ? errormsg.msg || errormsg : '',-1);\nbrowserTracking.terminate('Error',(errormsg) ? errormsg.msg || errormsg : '',-1);\nreturn;",
"position":{"btp":"BTP_PS_ERR","text":'var errormsg = (typeof obj.errormsg != "undefined") ? obj.errormsg : "";',"position":"after"},"alias":"TVNC"},{"sourceFn":"processDrawCmds","code":"window._remoteApp_ = true;\n browserTracking.log('Page.RemoteApp', 'Start', (cmd.exename ? cmd.exename.replace(/||/g,'') :''), '', eCountType.start);","position":{"btp":"BTP_PRA_SRT","text":'} else if (cmd.c == "EA") {',"position":"after"},"alias":"TVNC"},{"sourceFn":"processDrawCmds","code":"browserTracking.log('Page.RemoteApp', 'Status', (cmd)?cmd.rctext:'', (cmd)?cmd.rc:0, eCountType.none);",
"position":{"btp":"BTP_PRA_STS","text":'} else if (cmd.c == "EX") { // -- EXECUTE RESULT',"position":"after"},"alias":"TVNC"},{"sourceFn":"receiveScreen","code":"if (window._remoteApp_) browserTracking.log('Page.RemoteApp', 'End', '', '', eCountType.end);window._remoteApp_=false;\n","position":{"btp":"BTP_PRA_END","text":"_isSessionEnded = true;","position":"before"},"alias":"TVNC"},{"sourceFn":"showReconnectDiv","code":"browserTracking.log('Page.Connection', 'Unstable', '', '', eCountType.none);",
"position":{"btp":"BTP_PC_UNS","text":"var cs = { 'code': 1, 'message': consts.connUnstable };","position":"after"},"alias":"TVNC"},{"sourceFn":"showReconnectDiv","code":"browserTracking.log('Page.Connection', 'Lost', '', '', eCountType.none);","position":{"btp":"BTP_PC_LST","text":"var cs = { 'code': 2, 'message': consts.connLostReconnecting };","position":"after"},"alias":"TVNC"},{"sourceFn":"closeReconnectDiv","code":"browserTracking.log('Page.Connection', 'Restored', '', '', eCountType.none);",
"position":{"btp":"BTP_PC_RST","text":"var cs = { 'code': 3, 'message': consts.connRestored };","position":"after"},"alias":"TVNC"},{"sourceFn":"connect","code":"helper.utils.removeCookie(cookiePrefix+'_SID', TVNC.baseUrl);","position":{"btp":"BTP_REM_CO","row":1,"position":"before"},"alias":"TVNC"},{"sourceFn":"","code":"ID = { 'key': function () {return location.pathname.replace(/\\//g, '') + ((!!window.name) ? window.name.replace('__Thinfinity.Broker__', '_') : '') + '_sid';},'get': function () {return null;},'set': function (id) {return null;}};"},
{"sourceFn":"start","code":"browserTracking.log('Page.Request', 'Start', 'Sending start command', '', eCountType.none);","position":{"btp":"BTP_PR_STR","text":"TVNC.sendStart(cmdv);","position":"before"},"alias":"TVNC"},{"sourceFn":"connectWebSocket","code":"browserTracking.log('Page.WebSocket', 'Close', 'Calling ws.close(); --\x3e from connectWebSocket method, an old web socket.', '', eCountType.none);","position":{"btp":"BTP_PWS_CLS1","text":"// -- Close old webSocket","position":"after"},"alias":"TVNC"},
{"sourceFn":"connectWebSocket","code":"browserTracking.log('Page.WebSocket', 'Close', 'Calling ws.close(); --\x3e from connectWebSocket method, switching to ajax (timeout)', '', eCountType.none);","position":{"btp":"BTP_PWS_CLS2","text":'logDebug("WebSocket: no response. Switching to Ajax mode.");',"position":"after"},"alias":"TVNC"},{"sourceFn":"dispose","code":"browserTracking.log('Page.WebSocket', 'Close', 'Calling ws.close(); --\x3e from dispose method.', '', eCountType.none);","position":{"btp":"BTP_PWS_CLS3",
"text":"TVNC.ws.close();","position":"after"},"alias":"TVNC"}],"webfmx.sdk":[{"sourceFn":"events.onServerSceneRender","code":"browserTracking.log('Page.Application', 'Start', '', '', eCountType.start);","position":{"btp":"BTP_FMX_AS","text":"isFirstTime = false;","position":"after"},"alias":"self"},{"sourceFn":"events.onSessionEnd","code":"browserTracking.log('Page.Application', 'End', '', '', eCountType.end);","position":{"btp":"BTP_FMX_AE","text":"self.disconnect();","position":"before"},"alias":"self"}]};
if(!window.embedScriptLog)window.embedScriptLog={};if(!window.embedScriptLog["thinvnc.sdk"])window.embedScriptLog["thinvnc.sdk"]=[];if(!window.embedScriptLog["webfmx.sdk"])window.embedScriptLog["webfmx.sdk"]=[];window.embedScriptLog["thinvnc.sdk"]=window.embedScriptLog["thinvnc.sdk"].concat(logs["thinvnc.sdk"]);window.embedScriptLog["webfmx.sdk"]=window.embedScriptLog["webfmx.sdk"].concat(logs["webfmx.sdk"])}
if(!Element.prototype.matches)Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;if(!Element.prototype.closest)Element.prototype.closest=function(s){var el=this;if(!document.documentElement.contains(el))return null;do{if(el.matches(s))return el;el=el.parentElement||el.parentNode}while(el!==null&&el.nodeType===1);return null};
if(!Array.prototype.find){Object.defineProperty(Array.prototype,"_customFind",{value:function(predicate){if(this==null)throw new TypeError('"this" is null or not defined');if(typeof predicate!=="function")throw new TypeError("predicate must be a function");var o=Object(this);var len=o.length>>>0;var thisArg=arguments[1];var k=0;var result=null;var kValue;while(k<len&&result==null){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o))result={"index":k,"value":kValue};else k++}return result||{}}});
Object.defineProperty(Array.prototype,"find",{value:function(predicate){return this._customFind(predicate)["value"]}});Object.defineProperty(Array.prototype,"findIndex",{value:function(predicate){return this._customFind(predicate)["index"]||-1}})}if(window.NodeList&&!NodeList.prototype.forEach)NodeList.prototype.forEach=function(callback,thisArg){thisArg=thisArg||window;for(var i=0;i<this.length;i++)callback.call(thisArg,this[i],i,this)};
if(!String.prototype.startsWith)String.prototype.startsWith=function(searchString,position){position=position||0;return this.substr(position,searchString.length)===searchString};
if(!String.prototype.endsWith)String.prototype.endsWith=function(searchString,position){var subjectString=this.toString();if(typeof position!=="number"||!isFinite(position)||Math.floor(position)!==position||position>subjectString.length)position=subjectString.length;position-=searchString.length;var lastIndex=subjectString.indexOf(searchString,position);return lastIndex!==-1&&lastIndex===position};
if(!String.prototype.replaceAll)String.prototype.replaceAll=function(str,newStr){if(str==null||str==undefined)return this.toString();if(Object.prototype.toString.call(str).toLowerCase()==="[object regexp]")if(str.global)return this.replace(str,newStr);else throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument");str=str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return this.replace(new RegExp(str,"g"),newStr)};
if(!Object.values)Object.defineProperty(Object.__proto__,"values",{"configurable":false,"writable":false,"value":function(predicate){return Object.keys(predicate).map(function(k){return predicate[k]})}});
if(!String.prototype.padStart)String.prototype.padStart=function padStart(targetLength,padString){targetLength=targetLength>>0;padString=String(typeof padString!=="undefined"?padString:" ");if(this.length>=targetLength)return String(this);else{targetLength=targetLength-this.length;if(targetLength>padString.length)padString+=padString.repeat(targetLength/padString.length);return padString.slice(0,targetLength)+String(this)}};
if(!String.prototype.padEnd)String.prototype.padEnd=function padEnd(targetLength,padString){targetLength=targetLength>>0;padString=String(typeof padString!=="undefined"?padString:" ");if(this.length>targetLength)return String(this);else{targetLength=targetLength-this.length;if(targetLength>padString.length)padString+=padString.repeat(targetLength/padString.length);return String(this)+padString.slice(0,targetLength)}};
(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent})();(function(){if(!Number.isNaN)Number.isNaN=function(value){return typeof value==="number"&&isNaN(value)}})();
(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.ES6Promise=factory()})(this,function(){function objectOrFunction(x){var type=typeof x;return x!==null&&(type==="object"||type==="function")}function isFunction(x){return typeof x==="function"}var _isArray=void 0;if(Array.isArray)_isArray=Array.isArray;else _isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"};
var isArray=_isArray;var len=0;var vertxNext=void 0;var customSchedulerFn=void 0;var asap=function asap(callback,arg){queue[len]=callback;queue[len+1]=arg;len+=2;if(len===2)if(customSchedulerFn)customSchedulerFn(flush);else scheduleFlush()};function setScheduler(scheduleFn){customSchedulerFn=scheduleFn}function setAsap(asapFn){asap=asapFn}var browserWindow=typeof window!=="undefined"?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;
var isNode=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function useNextTick(){return function(){return process.nextTick(flush)}}function useVertxTimer(){if(typeof vertxNext!=="undefined")return function(){vertxNext(flush)};return useSetTimeout()}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);
var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0)}}function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}var queue=new Array(1E3);function flush(){for(var i=0;i<len;i+=2){var callback=queue[i];var arg=queue[i+1];callback(arg);
queue[i]=undefined;queue[i+1]=undefined}len=0}function attemptVertx(){try{var vertx=Function("return this")().require("vertx");vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer()}catch(e){return useSetTimeout()}}var scheduleFlush=void 0;if(isNode)scheduleFlush=useNextTick();else if(BrowserMutationObserver)scheduleFlush=useMutationObserver();else if(isWorker)scheduleFlush=useMessageChannel();else if(browserWindow===undefined&&typeof require==="function")scheduleFlush=attemptVertx();
else scheduleFlush=useSetTimeout();function then(onFulfillment,onRejection){var parent=this;var child=new this.constructor(noop);if(child[PROMISE_ID]===undefined)makePromise(child);var _state=parent._state;if(_state){var callback=arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})}else subscribe(parent,child,onFulfillment,onRejection);return child}function resolve$1(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===
Constructor)return object;var promise=new Constructor(noop);resolve(promise,object);return promise}var PROMISE_ID=Math.random().toString(36).substring(2);function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function tryThen(then$$1,value,fulfillmentHandler,rejectionHandler){try{then$$1.call(value,
fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then$$1){asap(function(promise){var sealed=false;var error=tryThen(then$$1,thenable,function(value){if(sealed)return;sealed=true;if(thenable!==value)resolve(promise,value);else fulfill(promise,value)},function(reason){if(sealed)return;sealed=true;reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;reject(promise,error)}},promise)}function handleOwnThenable(promise,
thenable){if(thenable._state===FULFILLED)fulfill(promise,thenable._result);else if(thenable._state===REJECTED)reject(promise,thenable._result);else subscribe(thenable,undefined,function(value){return resolve(promise,value)},function(reason){return reject(promise,reason)})}function handleMaybeThenable(promise,maybeThenable,then$$1){if(maybeThenable.constructor===promise.constructor&&then$$1===then&&maybeThenable.constructor.resolve===resolve$1)handleOwnThenable(promise,maybeThenable);else if(then$$1===
undefined)fulfill(promise,maybeThenable);else if(isFunction(then$$1))handleForeignThenable(promise,maybeThenable,then$$1);else fulfill(promise,maybeThenable)}function resolve(promise,value){if(promise===value)reject(promise,selfFulfillment());else if(objectOrFunction(value)){var then$$1=void 0;try{then$$1=value.then}catch(error){reject(promise,error);return}handleMaybeThenable(promise,value,then$$1)}else fulfill(promise,value)}function publishRejection(promise){if(promise._onerror)promise._onerror(promise._result);
publish(promise)}function fulfill(promise,value){if(promise._state!==PENDING)return;promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length!==0)asap(publish,promise)}function reject(promise,reason){if(promise._state!==PENDING)return;promise._state=REJECTED;promise._result=reason;asap(publishRejection,promise)}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers;var length=_subscribers.length;parent._onerror=null;_subscribers[length]=
child;_subscribers[length+FULFILLED]=onFulfillment;_subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state)asap(publish,parent)}function publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0)return;var child=void 0,callback=void 0,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child)invokeCallback(settled,child,callback,detail);else callback(detail)}promise._subscribers.length=
0}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=void 0,error=void 0,succeeded=true;if(hasCallback){try{value=callback(detail)}catch(e){succeeded=false;error=e}if(promise===value){reject(promise,cannotReturnOwn());return}}else value=detail;if(promise._state!==PENDING);else if(hasCallback&&succeeded)resolve(promise,value);else if(succeeded===false)reject(promise,error);else if(settled===FULFILLED)fulfill(promise,value);else if(settled===REJECTED)reject(promise,
value)}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){resolve(promise,value)},function rejectPromise(reason){reject(promise,reason)})}catch(e){reject(promise,e)}}var id=0;function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[]}function validationError(){return new Error("Array Methods must be provided an Array")}var Enumerator=function(){function Enumerator(Constructor,
input){this._instanceConstructor=Constructor;this.promise=new Constructor(noop);if(!this.promise[PROMISE_ID])makePromise(this.promise);if(isArray(input)){this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0)fulfill(this.promise,this._result);else{this.length=this.length||0;this._enumerate(input);if(this._remaining===0)fulfill(this.promise,this._result)}}else reject(this.promise,validationError())}Enumerator.prototype._enumerate=function _enumerate(input){for(var i=
0;this._state===PENDING&&i<input.length;i++)this._eachEntry(input[i],i)};Enumerator.prototype._eachEntry=function _eachEntry(entry,i){var c=this._instanceConstructor;var resolve$$1=c.resolve;if(resolve$$1===resolve$1){var _then=void 0;var error=void 0;var didError=false;try{_then=entry.then}catch(e){didError=true;error=e}if(_then===then&&entry._state!==PENDING)this._settledAt(entry._state,i,entry._result);else if(typeof _then!=="function"){this._remaining--;this._result[i]=entry}else if(c===Promise$2){var promise=
new c(noop);if(didError)reject(promise,error);else handleMaybeThenable(promise,entry,_then);this._willSettleAt(promise,i)}else this._willSettleAt(new c(function(resolve$$1){return resolve$$1(entry)}),i)}else this._willSettleAt(resolve$$1(entry),i)};Enumerator.prototype._settledAt=function _settledAt(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(state===REJECTED)reject(promise,value);else this._result[i]=value}if(this._remaining===0)fulfill(promise,this._result)};
Enumerator.prototype._willSettleAt=function _willSettleAt(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})};return Enumerator}();function all(entries){return(new Enumerator(this,entries)).promise}function race(entries){var Constructor=this;if(!isArray(entries))return new Constructor(function(_,reject){return reject(new TypeError("You must pass an array to race."))});
else return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++)Constructor.resolve(entries[i]).then(resolve,reject)})}function reject$1(reason){var Constructor=this;var promise=new Constructor(noop);reject(promise,reason);return promise}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
}var Promise$2=function(){function Promise(resolver){this[PROMISE_ID]=nextId();this._result=this._state=undefined;this._subscribers=[];if(noop!==resolver){typeof resolver!=="function"&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew()}}Promise.prototype.catch=function _catch(onRejection){return this.then(null,onRejection)};Promise.prototype.finally=function _finally(callback){var promise=this;var constructor=promise.constructor;if(isFunction(callback))return promise.then(function(value){return constructor.resolve(callback()).then(function(){return value})},
function(reason){return constructor.resolve(callback()).then(function(){throw reason;})});return promise.then(callback,callback)};return Promise}();Promise$2.prototype.then=then;Promise$2.all=all;Promise$2.race=race;Promise$2.resolve=resolve$1;Promise$2.reject=reject$1;Promise$2._setScheduler=setScheduler;Promise$2._setAsap=setAsap;Promise$2._asap=asap;function polyfill(){var local=void 0;if(typeof global!=="undefined")local=global;else if(typeof self!=="undefined")local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment");
}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if(promiseToString==="[object Promise]"&&!P.cast)return}local.Promise=Promise$2}Promise$2.polyfill=polyfill;Promise$2.Promise=Promise$2;Promise$2.polyfill();return Promise$2});
(function(){function setup($){$.fn._fadeIn=$.fn.fadeIn;var noOp=$.noop||function(){};var msie=/MSIE/.test(navigator.userAgent);var ie6=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent);var mode=document.documentMode||0;var setExpr=$.isFunction(document.createElement("div").style.setExpression);$.blockUI=function(opts){install(window,opts)};$.unblockUI=function(opts){remove(window,opts)};$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');
if(title)$m.append("<h1>"+title+"</h1>");if(message)$m.append("<h2>"+message+"</h2>");if(timeout===undefined)timeout=3E3;var callBlock=function(opts){opts=opts||{};$.blockUI({message:$m,fadeIn:typeof opts.fadeIn!=="undefined"?opts.fadeIn:700,fadeOut:typeof opts.fadeOut!=="undefined"?opts.fadeOut:1E3,timeout:typeof opts.timeout!=="undefined"?opts.timeout:timeout,centerY:false,showOverlay:false,onUnblock:onClose,css:$.blockUI.defaults.growlCSS})};callBlock();var nonmousedOpacity=$m.css("opacity");$m.mouseover(function(){callBlock({fadeIn:0,
timeout:3E4});var displayBlock=$(".blockMsg");displayBlock.stop();displayBlock.fadeTo(300,1)}).mouseout(function(){$(".blockMsg").fadeOut(1E3)})};$.fn.block=function(opts){if(this[0]===window){$.blockUI(opts);return this}var fullOpts=$.extend({},$.blockUI.defaults,opts||{});this.each(function(){var $el=$(this);if(fullOpts.ignoreIfBlocked&&$el.data("blockUI.isBlocked"))return;$el.unblock({fadeOut:0})});return this.each(function(){if($.css(this,"position")=="static"){this.style.position="relative";
$(this).data("blockUI.static",true)}this.style.zoom=1;install(this,opts)})};$.fn.unblock=function(opts){if(this[0]===window){$.unblockUI(opts);return this}return this.each(function(){remove(this,opts)})};$.blockUI.version=2.7;$.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",
left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:false,baseZ:1E3,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,
constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:false};var pageBlock=null;var pageBlockEls=[];function applyStyle(elem,style){for(var v in style)elem.style[v]=style[v]}function install(el,opts){var css,themedCSS;var full=el==window;var msg=opts&&opts.message!==undefined?opts.message:undefined;opts=$.extend({},
$.blockUI.defaults,opts||{});if(opts.ignoreIfBlocked&&$(el).data("blockUI.isBlocked"))return;opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});css=$.extend({},$.blockUI.defaults.css,opts.css||{});if(opts.onOverlayClick)opts.overlayCSS.cursor="pointer";themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});msg=msg===undefined?opts.message:msg;if(full&&pageBlock)remove(window,{fadeOut:0});if(msg&&typeof msg!="string"&&(msg.parentNode||msg.jquery)){var node=
msg.jquery?msg[0]:msg;var data={};$(el).data("blockUI.history",data);data.el=node;data.parent=node.parentNode;data.display=node.style.display;data.position=node.style.position;if(data.parent)data.parent.removeChild(node)}$(el).data("blockUI.onUnblock",opts.onUnblock);var z=opts.baseZ;var lyr1,lyr2,lyr3,s;if(msie||opts.forceIframe){lyr1=$('<iframe class="blockUI" src="'+opts.iframeSrc+'"></iframe>');applyStyle(lyr1[0],{"z-index":z++,"display":"none","border":"none","margin":0,"padding":0,"position":"absolute",
"width":"100%","height":"100%","top":0,"left":0})}else{lyr1=$('<div class="blockUI"></div>');applyStyle(lyr1[0],{"display":"none"})}if(opts.theme){lyr2=$('<div class="blockUI blockOverlay ui-widget-overlay"></div>');applyStyle(lyr2[0],{"z-index":z++,"display":"none"})}else{lyr2=$('<div class="blockUI blockOverlay" ></div>');applyStyle(lyr2[0],{"z-index":z++,"display":"none","border":"none","margin":0,"padding":0,"width":"100%","height":"100%","top":0,"left":0})}if(opts.theme&&full){s='<div class="blockUI '+
opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all">';if(opts.title)s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>";s+='<div class="ui-widget-content ui-dialog-content"></div>';s+="</div>";s=$(s);applyStyle(s[0],{"z-index":z+10,"display":"none","position":"fixed"})}else if(opts.theme){s='<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all">';if(opts.title)s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+
(opts.title||"&nbsp;")+"</div>";s+='<div class="ui-widget-content ui-dialog-content"></div>';s+="</div>";s=$(s);applyStyle(s[0],{"z-index":z+10,"display":"none","position":"absolute"})}else if(full){s=$('<div class="blockUI '+opts.blockMsgClass+' blockPage"></div>');applyStyle(s[0],{"z-index":z+10,"display":"none","position":"fixed"})}else{s=$('<div class="blockUI '+opts.blockMsgClass+' blockElement"></div>');applyStyle(s[0],{"z-index":z+10,"display":"none","position":"absolute"})}lyr3=s;if(msg)if(opts.theme){lyr3.css(themedCSS);
lyr3.addClass("ui-widget-content")}else lyr3.css(css);if(!opts.theme)lyr2.css(opts.overlayCSS);lyr2.css("position",full?"fixed":"absolute");if(msie||opts.forceIframe)lyr1.css("opacity",0);var layers=[lyr1,lyr2,lyr3],$par=full?$("body"):$(el);$.each(layers,function(){this.appendTo($par)});if(opts.theme&&opts.draggable&&$.fn.draggable)lyr3.draggable({handle:".ui-dialog-titlebar",cancel:"li"});var expr=setExpr&&(!$.support.boxModel||$("object,embed",full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&
$.support.boxModel)$("html,body").css("height","100%");if((ie6||!$.support.boxModel)&&!full){var t=sz(el,"borderTopWidth"),l=sz(el,"borderLeftWidth");var fixT=t?"(0 - "+t+")":0;var fixL=l?"(0 - "+l+")":0}$.each(layers,function(i,o){var s=o[0].style;s.position="absolute";if(i<2){if(full)s.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+opts.quirksmodeOffsetHack+') + "px"');else s.setExpression("height",'this.parentNode.offsetHeight + "px"');
if(full)s.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"');else s.setExpression("width",'this.parentNode.offsetWidth + "px"');if(fixL)s.setExpression("left",fixL);if(fixT)s.setExpression("top",fixT)}else if(opts.centerY){if(full)s.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');
s.marginTop=0}else if(!opts.centerY&&full){var top=opts.css&&opts.css.top?parseInt(opts.css.top,10):0;var expression="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+top+') + "px"';s.setExpression("top",expression)}})}if(msg){if(opts.theme)lyr3.find(".ui-widget-content").append(msg);else lyr3.append(msg);if(msg.jquery||msg.nodeType)$(msg).show()}if((msie||opts.forceIframe)&&opts.showOverlay)lyr1.show();if(opts.fadeIn){var cb=opts.onBlock?opts.onBlock:
noOp;var cb1=opts.showOverlay&&!msg?cb:noOp;var cb2=msg?cb:noOp;if(opts.showOverlay)lyr2._fadeIn(opts.fadeIn,cb1);if(msg)lyr3._fadeIn(opts.fadeIn,cb2)}else{if(opts.showOverlay)lyr2.show();if(msg)lyr3.show();if(opts.onBlock)opts.onBlock.bind(lyr3)()}bind(1,el,opts);if(full){pageBlock=lyr3[0];pageBlockEls=$(opts.focusableElements,pageBlock);if(opts.focusInput)setTimeout(focus,20)}else{center(lyr3[0],opts.centerX,opts.centerY);$(window).on("resize",function(){center(lyr3[0],opts.centerX,opts.centerY)})}if(opts.timeout){var to=
setTimeout(function(){if(full)$.unblockUI(opts);else $(el).unblock(opts)},opts.timeout);$(el).data("blockUI.timeout",to)}}function remove(el,opts){var count;var full=el==window;var $el=$(el);var data=$el.data("blockUI.history");var to=$el.data("blockUI.timeout");if(to){clearTimeout(to);$el.removeData("blockUI.timeout")}opts=$.extend({},$.blockUI.defaults,opts||{});bind(0,el,opts);if(opts.onUnblock===null){opts.onUnblock=$el.data("blockUI.onUnblock");$el.removeData("blockUI.onUnblock")}var els;if(full)els=
$("body").children().filter(".blockUI").add("body > .blockUI");else els=$el.find(">.blockUI");if(opts.cursorReset){if(els.length>1)els[1].style.cursor=opts.cursorReset;if(els.length>2)els[2].style.cursor=opts.cursorReset}if(full)pageBlock=pageBlockEls=null;if(opts.fadeOut){count=els.length;els.stop().fadeOut(opts.fadeOut,function(){if(--count===0)reset(els,data,opts,el)})}else reset(els,data,opts,el)}function reset(els,data,opts,el){var $el=$(el);if($el.data("blockUI.isBlocked"))return;els.each(function(i,
o){if(this.parentNode)this.parentNode.removeChild(this)});if(data&&data.el){data.el.style.display=data.display;data.el.style.position=data.position;data.el.style.cursor="default";if(data.parent)data.parent.appendChild(data.el);$el.removeData("blockUI.history")}if($el.data("blockUI.static"))$el.css("position","static");if(typeof opts.onUnblock=="function")opts.onUnblock(el,opts);var body=$(document.body),w=body.width(),cssW=body[0].style.width;body.width(w-1).width(w);body[0].style.width=cssW}function bind(b,
el,opts){var full=el==window,$el=$(el);if(!b&&(full&&!pageBlock||!full&&!$el.data("blockUI.isBlocked")))return;$el.data("blockUI.isBlocked",b);if(!full||!opts.bindEvents||b&&!opts.showOverlay)return;var events="mousedown mouseup keydown keypress keyup touchstart touchend touchmove";if(b)$(document).bind(events,opts,handler);else $(document).unbind(events,handler)}function handler(e){if(e.type==="keydown"&&e.keyCode&&e.keyCode==9)if(pageBlock&&e.data.constrainTabKey){var els=pageBlockEls;var fwd=!e.shiftKey&&
e.target===els[els.length-1];var back=e.shiftKey&&e.target===els[0];if(fwd||back){setTimeout(function(){focus(back)},10);return false}}var opts=e.data;var target=$(e.target);if(target.hasClass("blockOverlay")&&opts.onOverlayClick)opts.onOverlayClick(e);if(target.parents("div."+opts.blockMsgClass).length>0)return true;return target.parents().children().filter("div.blockUI").length===0}function focus(back){if(!pageBlockEls)return;var e=pageBlockEls[back===true?pageBlockEls.length-1:0];if(e)e.focus()}
function center(el,x,y){var p=el.parentNode,s=el.style;if(p){var l=(p.offsetWidth-el.offsetWidth)/2-sz(p,"borderLeftWidth");var t=(p.offsetHeight-el.offsetHeight)/2-sz(p,"borderTopWidth");if(x)s.left=l>0?l+"px":"0";if(y)s.top=t>0?t+"px":"0"}}function sz(el,p){return parseInt($.css(el,p),10)||0}}if(typeof define==="function"&&define.amd&&define.amd.jQuery)define(["jquery"],setup);else setup(jQuery)})();
jQuery.ajaxq=function(queue,options){if(typeof document.ajaxq=="undefined")document.ajaxq={q:{},r:null};if(typeof document.ajaxq.q[queue]=="undefined")document.ajaxq.q[queue]=[];if(typeof options!="undefined"){var optionsCopy={};for(var o in options)optionsCopy[o]=options[o];options=optionsCopy;var originalCompleteCallback=options.complete;options.error=function(e){};options.complete=function(request,status){document.ajaxq.q[queue].shift();document.ajaxq.r=null;if(originalCompleteCallback)originalCompleteCallback(request,
status);if(document.ajaxq.q[queue].length>0)document.ajaxq.r=jQuery.ajax(document.ajaxq.q[queue][0])};document.ajaxq.q[queue].push(options);if(document.ajaxq.q[queue].length==1)document.ajaxq.r=jQuery.ajax(document.ajaxq.q[queue][0])}else{if(document.ajaxq.r){document.ajaxq.r.abort();document.ajaxq.r=null}document.ajaxq.q[queue]=[]}};"use strict";
jQuery.base64=function($){var _PADCHAR="=",_ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_VERSION="1.0";function _getbyte64(s,i){var idx=_ALPHA.indexOf(s.charAt(i));if(idx===-1)throw"Cannot decode base64";return idx}function _decode(s){var pads=0,i,b10,imax=s.length,x=[];s=String(s);if(imax===0)return s;if(imax%4!==0)throw"Cannot decode base64";if(s.charAt(imax-1)===_PADCHAR){pads=1;if(s.charAt(imax-2)===_PADCHAR)pads=2;imax-=4}for(i=0;i<imax;i+=4){b10=_getbyte64(s,i)<<
18|_getbyte64(s,i+1)<<12|_getbyte64(s,i+2)<<6|_getbyte64(s,i+3);x.push(String.fromCharCode(b10>>16,b10>>8&255,b10&255))}switch(pads){case 1:b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12|_getbyte64(s,i+2)<<6;x.push(String.fromCharCode(b10>>16,b10>>8&255));break;case 2:b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12;x.push(String.fromCharCode(b10>>16));break}return x.join("")}function _getbyte(s,i){var x=s.charCodeAt(i);if(x>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return x}function _encode(s){if(arguments.length!==
1)throw"SyntaxError: exactly one argument required";s=String(s);var i,b10,x=[],imax=s.length-s.length%3;if(s.length===0)return s;for(i=0;i<imax;i+=3){b10=_getbyte(s,i)<<16|_getbyte(s,i+1)<<8|_getbyte(s,i+2);x.push(_ALPHA.charAt(b10>>18));x.push(_ALPHA.charAt(b10>>12&63));x.push(_ALPHA.charAt(b10>>6&63));x.push(_ALPHA.charAt(b10&63))}switch(s.length-imax){case 1:b10=_getbyte(s,i)<<16;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt(b10>>12&63)+_PADCHAR+_PADCHAR);break;case 2:b10=_getbyte(s,i)<<16|_getbyte(s,
i+1)<<8;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt(b10>>12&63)+_ALPHA.charAt(b10>>6&63)+_PADCHAR);break}return x.join("")}return{decode:_decode,encode:_encode,VERSION:_VERSION}}(jQuery);
function AgentInfo(){var p={};var asyncCallbacks={};var apaSupported=false;var _self=this;var _surface={isTouchable:undefined,key:"__#thinfinity.touch.data__",callbacks:[]};function initialize(){p=getBrowserInfo();if(this.__proto__==null)if(Object.getPrototypeOf)this.__proto__=Object.getPrototypeOf(this);else this.__proto__=this.constructor.prototype;this.__proto__.getAgentKey=function(){var result;if(p["isIOS"])result="IOS_";else if(p["isAndroid"])result="ANDROID_";else if(p["isPlaybook"])result=
"PLAYBOOK_";else if(p["isHPTablet"])result="WEBOS_";else if(p["isChromeOS"])result="CHROMEOS_";else if(p["isMac"])result="MAC_";else if(p["isSymbian"])result="SYMBIAN_";else result="PC_";if(p["isFirefox"])result+="FIREFOX";else if(p["isOpera"])result+="OPERA";else if(p["isSafari"])result+="SAFARI";else if(p["isChrome"])result+="CHROME";else if(p["isMSIE"])result+="MSIE";else if(p["isTrident"])result+="TRIDENT";else if(p["isNokiaBrowser"])result+="NOKIA";else if(p["isChromium"])result+="CHROMIUM";
return result};this.__proto__.browserFromAgent=function(agentStr){var result;var params=getBrowserInfo(agentStr);if(params["isFirefox"])result="Mozilla Firefox";else if(params["isOpera"])result="Opera";else if(params["isSafari"])result="Safari";else if(params["isChrome"])result="Google Chrome";else if(params["isMSIE"])result="MS Internet Explorer";else if(params["isNokiaBrowser"])result="Nokia Browser";else if(params["isTrident"])result="Trident (MSIE >= 11, like Gecko)";else if(params["isChromium"])result=
"CHROMIUM";result+=" on ";if(params["isIOS"])result+="iOS"+(iosVersion==7)?" 7":"";else if(params["isAndroid"])result+="Android";else if(params["isPlaybook"])result+="BlackBerry Playbook";else if(params["isChromeOS"])result+="Chrome OS";else if(params["isHPTablet"])result+="Web OS";else if(params["isMac"])result+="Mac";else if(params["isSymbian"])result+="Symbian";else result+="PC";return result};getInitizationData();touchableDetection();try{window.dispatchEvent(new CustomEvent("addStatusAPIVariables",
{"detail":[{"name":"supportH264","title":"Support H264","get":function(){return p.h264},"index":100},{"name":"isMobile","title":"Mobile","get":function(){return p.isMobile},"index":110},{"name":"isTouch","title":"Touch","get":function(){return p.isTouch},"index":120},{"name":"browserInfo","title":"Browser","get":function(){var binfo=[];if(p.isWindows)binfo.push("Windows");else if(p.isMac)binfo.push("Mac");if(p.isChrome)binfo.push("Chrome: "+p.chromeVersion);else if(p.isOpera)binfo.push("Opera");else if(p.isSafari)binfo.push("Safari");
else if(p.isSafari)binfo.push("Safari");else if(p.isMSIE)binfo.push("IE "+p.msieVersion);else if(p.isFirefox)binfo.push("Firefox");binfo=binfo.join(", ");return binfo},"index":130}]}))}catch(error){}}(function autoplayAudioSupported(callback){if(isFirefox())callback(false);else{var audioFile="data:audio/mpeg;base64,/+MYxAAAAANIAAAAAExBTUUzLjk4LjIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";var audioElem=document.createElement("audio");audioElem.muted=true;audioElem.preload="auto";
audioElem.src=audioFile;var startPlayPromise=audioElem.play();if(!!startPlayPromise)startPlayPromise.then(function(){audioElem=null;callback(true)}).catch(function(error){audioElem=null;callback(false)});else callback(false)}})(response=>{apaSupported=response});function touchableDetection(){if(window.sessionStorage){let tempData=sessionStorage.getItem(_surface.key);if(tempData)try{tempData=JSON.parse(tempData);if(tempData.hasOwnProperty("isTouchable"))_surface.isTouchable=tempData.isTouchable}catch(error){}if(_surface.isTouchable||
p.isTouch)p.isTouch=true;else if(!p.isMobile){var waitForTouchDevice=function(){return new Promise(resolve=>{var _touchDetection=function(e){if(e?.sourceCapabilities?.firesTouchEvents===true){p.isTouch=true;window.sessionStorage.setItem(_surface.key,JSON.stringify({isTouchable:true}));window.removeEventListener("touchstart",_touchDetection,{passive:false});resolve()}};window.addEventListener("touchstart",_touchDetection,{passive:false})})};waitForTouchDevice().then(r=>{_surface.callbacks.forEach(fn=>
{try{fn()}catch(error){console.log(`Cannot execute callback: ${error.message||error}`)}});_surface.callbacks=null})}}}function detectTouch(callback){if(_surface.isTouchable===true)callback();else _surface.callbacks.push(callback)}function isFirefox(){var m=window.navigator.userAgent.match(/firefox/gi);return m&&m.length!=-1}function detectFirefox(userAgent,params){params["isFirefox"]=userAgent.indexOf("firefox")!=-1;params["firefoxVersion"]=0;if(/firefox[\/\s](\d+\.\d+)/.test(userAgent))params["firefoxVersion"]=
new Number(RegExp.$1)}function getOSVersion(userAgent){var osReg=new RegExp(/Windows NT [0-9]+.[0-9]+;/gi);var numReg=new RegExp(/[0-9]+/gi);var fgroup=userAgent.match(osReg);if(fgroup)try{var osnum=fgroup[0].match(numReg);if(osnum){osnum=parseInt(osnum[0],10);if(osnum<10)return 7;else return 10}}catch(error){}return"unknown"}function getMSIEBrowserVersion(userAgent){try{var tempVersion=/edge\/(([0-9]+).)*/.exec(userAgent)||0;return parseFloat(tempVersion[0].replace("edge/","").replace(/ /g,"").replace(/;/g,
""))}catch(error){return 0}}function detectIE(userAgent,params){var reg=/(msie) ([\w.]+)/.exec(userAgent);params["msieVersion"]=0;params["msieOSVersion"]="";params["msieHTMLVersion"]=0;params["isWindowsPhone"]=false;var ieTest=/(msie) ([0-9\.]+)/i.exec(userAgent);params["isMSIE"]=!!(ieTest&&ieTest[1]=="msie");if(params["isMSIE"])params["msieVersion"]=parseFloat(ieTest[2]);else if(userAgent.indexOf("trident")!=-1){ieTest=/rv:([0-9\.]+)/i.exec(userAgent);if(ieTest){params["isMSIE"]=true;params["msieVersion"]=
parseFloat(ieTest[1])}}else if(/(windows nt 10.0)/i.exec(userAgent)&&/(edge)/i.exec(userAgent)){params["isMSIE"]=true;params["msieVersion"]=12}else if(/(windows phone 10.0)/i.exec(userAgent)&&/(edge)/i.exec(userAgent)){params["isMSIE"]=true;params["msieVersion"]=12;params["isWindowsPhone"]=true}if(params.isMSIE)params.msieHTMLVersion=getMSIEBrowserVersion(userAgent);params["msieOSVersion"]=getOSVersion(userAgent)}function checkPolyfillObjectURL(){window.URL=window.URL||window.webkitURL;return window.URL?
true:false}function checkTypedArrays(){var result=false;if(!window.Uint32Array&&!window.Uint16Array&&!window.Uint8Array)return result;var test=null;var testU8=null;var testU16=null;var testU32=null;var i;try{test=new ArrayBuffer(16);testU8=new Uint8ClampedArray(test,8,8);testU16=new Uint16Array(test,8,4);testU32=new Uint32Array(test,8,2);for(i=0;i<testU8.length;++i)testU8[i]=171;for(i=0;i<testU16.length;++i)testU16[i]=43947;for(i=0;i<testU32.length;++i)testU32[i]=2880154539;result=true}catch(err){result=
false}finally{testU8=null;testU16=null;testU32=null;test=null}return result}function checkTransferableObjects(){var result;var workerScript;var objectUrl;var trArr;var trWork;try{if(!window.URL)throw"";workerScript=new Blob(["onmessage = function (oEvent) {}"],{type:"text/javascript"});objectUrl=window.URL.createObjectURL(workerScript);trArr=new ArrayBuffer(1);trWork=new Worker(objectUrl);trWork.postMessage(trArr,[trArr]);result=trArr.byteLength?false:true}catch(err){result=false}finally{trWork=null;
trArr=null;window.URL.revokeObjectURL(objectUrl)}return result}function checkAsmJsWorkersSupportAsync(scriptUrl,params){var worker;try{if(!params["hasTypedArrays"]||!_self.hasTransferableObjects)throw"";worker=new Worker(scriptUrl);worker.onmessage=function(oEvent){params["supportsAsmJsWorkers"]=true;params["supportsRFXDecoder"]=true;worker=null;callAsyncDetectionCallback("OnAsmJsWorkersTested")};worker.onerror=function(oEvent){params["supportsAsmJsWorkers"]=false;params["supportsRFXDecoder"]=false;
worker=null;callAsyncDetectionCallback("OnAsmJsWorkersTested")};worker.postMessage("test")}catch(err){params["supportsAsmJsWorkers"]=false;params["supportsRFXDecoder"]=false;worker=null;callAsyncDetectionCallback("OnAsmJsWorkersTested")}}function getIphoneModel(){var retModel={"name":"","resolution":"","majorVersion":0};try{var dpr=window.devicePixelRatio||1;var h=window.screen.height*dpr;var w=window.screen.width*dpr;if(w==320&&h==480)retModel={"name":["1","2g","3","3g","3gs"],"resolution":"320x480",
"majorVersion":3};else if(w==640&&h==960)retModel={"name":["4","4s"],"resolution":"640x960","majorVersion":4};else if(w==640&&h==1136)retModel={"name":["5","5s","5c"],"resolution":"640x1136","majorVersion":5};else if(w==750&&h==1334)retModel={"name":["6"],"resolution":"750x1134","majorVersion":6};else if(w==1080&&h==1920)retModel={"name":["6plus"],"resolution":"1080x1920","majorVersion":6}}catch(error){}return retModel}function getBrowserInfo(userAgent){var params={};if(typeof userAgent!="string")userAgent=
navigator.userAgent;params["agentStr"]=userAgent=userAgent.toLowerCase();var isTrident=userAgent.indexOf("trident")!=-1;params["protocol"]=document.location.protocol=="https:"?"https":"http";params["majorVersion"]=parseInt(navigator.appVersion,10);params["isWindows"]=userAgent.indexOf("windows")!=-1;params["isMac"]=userAgent.indexOf("macintosh")!=-1;params["isLinux"]=userAgent.indexOf("linux")!=-1;params["isIOS"]=(userAgent.indexOf("iphone")!=-1||userAgent.indexOf("ipod")!=-1||userAgent.indexOf("ipad")!=
-1||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!isTrident;params["iosVersion"]=params["isIOS"]?/os (([0-9]+)_)*./.exec(userAgent)||0:0;if(params["iosVersion"]!=0)try{params["iosBuildVersion"]=params["iosVersion"][0].replace("os","").replace(/_/g,".").replace(/ /g,"");var tempIosVersion=params["iosVersion"][0].replace("os","").replace(/ /g,"");if(tempIosVersion.indexOf("_")!=-1)tempIosVersion=parseInt(tempIosVersion.substring(0,tempIosVersion.indexOf("_")),10);params["iosVersion"]=
tempIosVersion}catch(error){params["iosVersion"]=params["iosBuildVersion"]=params["iosVersion"][params["iosVersion"].length-1]}params["ipadModel"]=0;if(params["isIOS"])try{var ipadModel=1;if(window.ondevicemotion)window.ondevicemotion=function(e){if(event.acceleration)ipadModel+=window.devicePixelRatio;params["ipadModel"]=ipadModel;window.ondevicemotion=null};else params.ipadModel="pro"}catch(error){params["ipadModel"]=0}params["isIphone"]=(userAgent.indexOf("iphone")!=-1||userAgent.indexOf("ipod")!=
-1)&&!isTrident;if(params["isIphone"]==true)params["iphoneModel"]=getIphoneModel();params["isIpod"]=userAgent.indexOf("ipod")!=-1;params["isAndroid"]=userAgent.indexOf("android")!=-1&&!isTrident;params["isHPTablet"]=userAgent.indexOf("hp-tablet")!=-1;params["isPlaybook"]=userAgent.indexOf("playbook")!=-1;params["isChromeOS"]=userAgent.indexOf(" cros ")!=-1;if(params["isChromeOS"]==true)try{var tempChromeVersion=/android (([0-9]+).)*./.exec(userAgent)||0;params["chromeOSVersion"]=tempChromeVersion[0].replace("android",
"").replace(/ /g,"").replace(/;/g,"")}catch(error){params["chromeOSVersion"]="0"}else params["chromeOSVersion"]="0";params["isYandex"]=userAgent.indexOf("yabrowser")!=-1;detectIE(userAgent,params);params["isSymbian"]=userAgent.indexOf("symbian")!=-1;params["isWindowMobile"]=userAgent.indexOf("iemobile")!=-1||userAgent.indexOf("windows phone")!=-1;params["isOpera"]=userAgent.indexOf("opera")!=-1||userAgent.indexOf("opr/")!=-1;params["isChrome"]=!params["isOpera"]&&(userAgent.indexOf("chrome")!=-1||
userAgent.indexOf("crios")!=-1)&&params["isMSIE"]==false;params["isChromium"]=false;if(params["isChrome"])try{var getChromeVersion=function(){var tempChromeVersion=/chrome\/(([0-9]+).)*/.exec(userAgent)||0;return tempChromeVersion[0].replace("chrome/","").replace(/ /g,"").replace(/;/g,"")};var getCriosVersion=function(){var tempChromeVersion=/crios\/(([0-9]+).)*/.exec(userAgent)||0;return params["chromeVersion"]=tempChromeVersion[0].replace("crios/","").replace(/ /g,"").replace(/;/g,"")};var tempChromeVersion=
"";if(params["isIOS"]){tempChromeVersion=/crios\/(([0-9]+).)*/.exec(userAgent)||0;if(tempChromeVersion){params.isChrome=true;params.isSafari=false;params["chromeVersion"]=getCriosVersion()}else{params.isIOS=false;params.isSafari=false;params["chromeVersion"]=getChromeVersion()}}else{tempChromeVersion=/chrome\/(([0-9]+).)*/.exec(userAgent)||0;if(tempChromeVersion){params.isChrome=true;params.isSafari=false;params["chromeVersion"]=getChromeVersion()}else{params.isIOS=false;params.isSafari=false}}}catch(error){params["chromeVersion"]=
"0"}else params["chromeVersion"]="0";params["isDragon"]=userAgent.indexOf("dragon")!=-1&&params["isChrome"]==true;if(params["isDragon"])try{var tempDragonVersion=/dragon\/(([0-9]+).)*/.exec(userAgent)||0;params["dragonVersion"]=tempDragonVersion[0].replace("dragon/","").replace(/ /g,"").replace(/;/g,"")}catch(error){params["dragonVersion"]="0"}else params["dragonVersion"]="0";params["isNokiaBrowser"]=userAgent.indexOf("nokiabrowser")!=-1;detectFirefox(userAgent,params);params["isSafari"]=!(params["isNokiaBrowser"]||
params["isChrome"]||params["isOpera"]||params["isFirefox"]||params["isMSIE"])&&(userAgent.indexOf("safari")!=-1||params["isIOS"]);if(params["isSafari"]&&params["isAndroid"]){params["isSafari"]=false;params["isChromium"]=true}if(params.isMSIE&&params.msieVersion>=11&&params.isWindows){params.isIOS=false;params.isAndroid=false;params.isSafari=false;params.isChrome=false;params.isFirefox=false}params["isMobile"]=!params["isChromeOS"]&&(params["isIOS"]||params["isAndroid"]||params["isHPTablet"]||params["isPlaybook"]||
params["isSymbian"]||params["isWindowMobile"]);params["isTouch"]=!!("ontouchstart"in window)||navigator.pointerEnabled&&navigator.maxTouchPoints>0||navigator.msPointerEnabled&&navigator.msMaxTouchPoints>0||false;params["hasObjectURL"]=checkPolyfillObjectURL();params["hasArrayBuffers"]=!!window.ArrayBuffer;params["hasTypedArrays"]=params["hasArrayBuffers"]?checkTypedArrays():false;params["hasWorkers"]=!!window.Worker;params["hasTransferableObjects"]=null;window.requestAnimationFrame=window.requestAnimationFrame||
window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){setTimeout(callback,0)};params["supportsAsmJsWorkers"]=false;params["supportsRFXDecoder"]=false;if(params["isWindowsPhone"]==true){params["isAndroid"]=false;params["isChromium"]=false;params["isChromeOS"]=false;params["chromeVersion"]="0"}params["isTabletMode"]=false;params["timeZone"]=-(new Date).getTimezoneOffset()/60;params["h264"]=!(params.isMSIE&&params.msieVersion<15);params["gfx"]=
!(params.isMSIE&&params.msieVersion<15)&&!params["isSafari"];return params}function supportsFullScreen(element){var response=false;if(element==null||element==undefined)element=document.documentElement;if(element){if(element.requestFullscreen)response=true;else if(element.mozRequestFullScreen)response=true;else if(element.webkitRequestFullscreen)response=true;else if(element.msRequestFullscreen)response=true;if(response&&!(p.isMac&&(p.isOpera||p.isChrome)||p.isChrome))response=window.top===(typeof element.defaultView!=
"undefined"?element.defaultView:typeof element.ownerDocument!="undefined"&&typeof element.ownerDocument.defaultView!="undefined"?element.ownerDocument.defaultView:window)}return response}function callAsyncDetectionCallback(event){if(asyncCallbacks.hasOwnProperty(event)){var callbacks=asyncCallbacks[event];for(var i=0;i<callbacks.length;++i)callbacks[i].callback.apply(callbacks[i].self)}}function addAsyncDetectionCallback(event,self,callback){if(!asyncCallbacks.hasOwnProperty(event))asyncCallbacks[event]=
[];asyncCallbacks[event].push({self:self,callback:callback})}function runAsyncDetections(){checkAsmJsWorkersSupportAsync("common/workers/test.js",p)}function supportHTML5(){try{var canvas=document.createElement("canvas");return typeof canvas.getContext!="undefined"?true:false}catch(error){return false}}function updateProperty(){if(arguments&&arguments.length>0)for(var key in arguments[0])if(p[key]!=undefined){console.log(`Forcing property value - ${key}:${arguments[0][key]}`);p[key]=arguments[0][key]}}
function getInitizationData(){if(window.Thinfinity&&window.Thinfinity.InitializationData){var data=window.Thinfinity.InitializationData.get("AGENTINFO");if(data)updateProperty(data)}}function setInitializationData(data){if(window.Thinfinity&&window.Thinfinity.InitializationData){window.Thinfinity.InitializationData.update("AGENTINFO",data);updateProperty(data)}}function getTransferableObjects(){if(p["hasTransferableObjects"]!=null)return p["hasTransferableObjects"];else{p["hasTransferableObjects"]=
p["hasWorkers"]?checkTransferableObjects():false;return p["hasTransferableObjects"]}}function compareVersions(versionA,versionB){var result=0;if(versionA!=versionB){var aVA=versionA.split(".");var aVB=versionB.split(".");var m=Math.min(aVA.length,aVB.length);var i=0;while(result==0&&i<m){result=parseInt(aVA[i],10)-parseInt(aVB[i],10);i++}if(result==0)if(m<aVB.length)result=-1;else if(m<aVA.length)result=1}return result}function isNewerThan(versionA,versionB){return compareVersions(versionA,versionB)>
0}function isOlderThan(versionA,versionB){return compareVersions(versionA,versionB)<0}function isSameVersion(versionA,versionB){return compareVersions(versionA,versionB)==0}function getBrowserName(){return p["isChrome"]?"chrome":p["isMSIE"]?"edge":p["isFirefox"]?"firefox":p["isOpera"]?"opera":p["isSafari"]?"safari":p["isDragon"]?"dragon":p["isSymbian"]?"symbian":p["isChromium"]?"android":"unknown"}function supportOggFormat(callback){let checkOgg=()=>{return new Promise(resolve=>{try{let audioCtx=
new AudioContext;let chunk=[79,103,103,83,0,2,0,0,0,0,0,0,0,0,26,50,0,0,0,0,0,0,253,79,48,95,1,19,79,112,117,115,72,101,97,100,1,2,56,1,68,172,0,0,0,0,0,79,103,103,83,0,0,0,0,0,0,0,0,0,0,26,50,0,0,1,0,0,0,101,92,227,247,1,51,79,112,117,115,84,97,103,115,35,0,0,0,108,105,98,111,112,117,115,32,117,110,107,110,111,119,110,44,32,108,105,98,111,112,117,115,101,110,99,32,117,110,107,110,111,119,110,0,0,0,0,79,103,103,83,0,4,245,37,0,0,0,0,0,0,26,50,0,0,2,0,0,0,167,37,66,36,14,255,144,241,237,233,235,241,
233,230,255,111,230,255,158,252,127,12,20,204,98,190,27,223,60,146,131,102,2,15,67,177,166,86,254,172,19,81,160,245,25,129,89,47,50,163,219,19,109,120,142,210,182,207,246,96,150,241,199,58,105,62,202,178,179,170,86,30,188,185,17,125,250,117,60,173,73,126,157,36,135,211,204,180,173,211,208,122,17,193,32,51,107,80,2,34,51,119,59,119,122,228,213,149,184,223,154,232,140,57,182,203,52,207,211,36,98,208,10,24,250,149,166,251,147,123,156,163,173,143,250,145,224,120,23,125,163,194,207,224,192,202,60,103,
42,44,254,187,54,251,212,135,145,105,136,31,138,157,19,34,160,226,180,201,223,78,96,54,7,249,255,203,49,105,182,182,227,80,120,30,161,20,0,0,0,1,244,148,122,129,74,111,98,98,85,129,123,61,74,124,255,58,194,191,58,194,183,89,45,128,75,96,0,2,208,1,30,72,209,111,46,227,119,148,51,34,19,209,3,214,235,0,191,149,3,214,235,55,120,147,57,153,131,41,216,133,47,110,252,30,102,202,17,96,192,212,74,97,193,185,149,214,165,55,204,141,161,39,104,96,131,64,197,153,0,109,233,199,117,124,93,47,177,243,68,148,182,
182,43,232,172,62,79,64,103,124,59,16,176,139,36,116,143,10,233,116,192,152,166,143,138,30,14,114,190,123,33,196,102,217,98,212,101,134,196,141,110,118,204,91,173,171,117,146,22,179,162,139,248,0,164,124,99,112,66,94,122,216,1,59,239,84,22,187,179,205,107,221,59,195,94,43,229,106,122,130,205,203,197,229,216,150,12,0,54,121,110,118,234,14,145,117,155,220,93,226,115,230,100,69,147,31,164,71,109,96,182,38,45,17,124,179,250,89,128,21,231,11,68,164,87,1,82,7,252,101,151,201,103,98,50,196,172,95,172,137,
244,140,185,12,251,106,121,57,240,172,205,112,121,55,113,123,117,114,14,246,44,246,80,110,187,121,212,147,237,241,69,46,235,178,140,192,114,121,219,97,150,55,23,151,4,19,37,221,162,241,61,214,150,232,163,86,135,190,154,29,191,84,40,136,48,81,232,230,206,213,92,99,105,182,199,80,230,91,49,85,148,56,51,176,67,233,100,20,152,213,3,194,183,146,123,49,23,37,51,223,66,43,116,115,57,11,16,159,43,198,68,239,150,143,76,54,72,36,151,188,185,201,243,25,74,132,117,71,202,195,63,131,194,48,50,155,61,136,31,247,
56,18,115,168,185,134,226,172,72,246,95,76,122,39,70,231,227,240,139,51,142,65,27,172,31,127,26,249,69,186,117,31,134,51,185,45,156,37,81,149,93,90,145,164,18,197,255,189,61,219,209,159,198,123,70,168,110,107,55,49,69,2,145,2,54,105,13,77,53,59,233,160,247,10,184,137,144,157,27,184,33,242,229,145,106,155,166,123,149,252,38,119,8,151,118,97,60,197,181,145,118,161,103,159,136,110,183,175,184,61,238,153,244,76,74,102,163,131,108,1,86,11,0,34,130,169,169,103,192,103,90,100,153,238,171,117,44,143,177,
252,6,14,193,55,13,24,140,103,2,252,205,240,15,204,12,174,97,179,126,240,140,76,251,90,229,42,205,20,183,121,43,250,243,148,162,226,230,127,110,202,103,62,84,198,232,113,45,3,185,90,52,180,220,120,20,123,231,143,102,132,221,227,46,11,221,92,73,71,207,133,131,128,108,39,45,205,14,68,70,83,178,18,26,232,179,88,43,29,39,175,76,153,80,31,221,61,228,239,130,217,80,157,95,149,43,230,177,106,69,153,0,54,129,100,65,23,60,6,5,156,187,33,183,107,89,142,117,165,31,198,138,24,134,177,177,79,130,139,181,20,106,
195,13,6,48,183,205,179,81,124,3,217,236,124,255,20,87,9,235,73,59,248,226,54,59,126,110,190,126,88,4,64,155,85,254,70,122,234,122,185,239,144,58,75,144,234,252,40,103,44,173,139,243,37,30,197,11,208,244,201,78,57,181,34,58,66,91,165,70,64,196,34,184,32,243,173,104,63,51,109,186,218,178,226,79,176,10,183,19,52,247,113,211,140,239,52,244,33,154,168,83,172,166,222,82,223,108,166,207,68,109,11,193,128,141,218,147,36,180,69,173,15,193,112,36,86,48,198,241,67,246,134,17,195,246,35,125,42,247,80,142,127,
67,146,2,204,117,227,203,160,208,164,141,226,73,131,203,89,215,80,206,22,64,116,155,137,197,119,87,161,46,235,231,82,13,34,234,228,38,36,87,38,128,236,101,183,25,108,53,79,248,133,242,140,107,88,86,134,80,66,142,109,53,219,109,14,186,81,42,117,47,82,243,50,54,15,170,90,56,21,199,82,16,161,241,123,72,63,62,163,209,12,31,212,150,210,215,178,241,71,151,143,179,155,102,109,228,230,244,8,18,22,3,155,197,62,212,148,68,154,244,10,193,22,55,170,207,168,185,21,247,110,197,218,207,242,149,240,249,252,37,177,
219,167,13,34,187,105,57,130,73,87,49,150,29,217,251,190,247,255,45,237,202,156,26,231,13,114,170,231,116,139,117,34,252,122,95,146,78,177,167,231,24,42,55,50,9,201,224,173,201,153,204,5,219,147,104,132,124,52,219,74,43,212,159,1,133,74,12,85,195,232,231,16,59,190,98,1,38,222,164,52,113,31,42,114,164,222,154,74,242,83,188,163,162,135,59,127,5,217,90,27,91,124,33,248,239,98,58,218,127,220,136,110,10,42,73,102,64,136,249,116,68,153,103,4,165,210,111,143,119,75,182,97,70,93,171,221,238,231,202,111,160,
111,35,126,254,88,190,125,160,69,85,223,230,225,180,189,57,32,75,148,91,58,163,14,73,51,254,2,14,203,168,109,141,29,225,52,108,13,52,54,155,172,191,153,125,225,190,93,114,36,205,35,48,60,144,215,202,204,57,18,118,14,147,161,143,250,45,143,65,224,84,216,197,96,210,10,160,52,230,209,109,39,45,143,132,126,114,74,7,31,45,60,252,46,164,87,128,38,225,187,169,63,243,221,220,205,167,103,27,124,115,184,21,55,115,9,104,162,39,189,176,22,175,89,189,148,187,215,107,84,90,202,96,131,199,111,39,240,230,122,137,
238,212,15,81,108,118,198,133,91,18,173,171,194,116,15,160,216,183,167,172,194,114,23,77,12,35,252,66,192,98,21,37,29,73,204,83,118,198,102,166,91,251,66,117,97,61,99,143,7,122,149,189,148,253,25,208,151,150,243,6,100,162,152,176,5,48,164,119,86,58,245,188,191,183,200,22,172,239,95,114,138,173,251,199,248,157,90,192,93,89,206,229,84,82,30,98,19,18,42,202,29,25,67,54,159,146,188,236,148,60,203,55,58,66,217,113,253,79,13,35,253,91,16,44,172,36,2,68,183,244,69,53,110,61,228,149,12,101,61,86,211,122,
152,68,69,145,7,208,57,93,91,31,14,142,163,8,156,22,154,142,187,80,192,100,221,184,249,185,221,133,74,153,67,105,189,186,185,71,82,216,226,52,69,238,44,106,34,236,199,68,141,131,252,47,9,213,11,17,31,234,115,186,222,147,77,196,1,20,144,89,226,207,65,128,12,138,213,175,85,7,180,28,136,198,216,55,103,59,153,110,195,193,202,20,207,134,44,128,190,3,83,166,125,130,68,218,106,38,193,95,81,156,99,85,107,98,64,2,211,235,176,1,12,218,141,40,150,220,170,57,94,8,152,53,103,130,141,102,224,130,59,206,3,235,14,
113,74,193,197,94,27,181,221,167,150,81,193,14,212,232,101,104,157,4,81,119,11,93,45,61,71,223,11,119,162,156,228,63,156,110,148,177,85,23,17,42,67,142,58,118,112,199,215,24,54,251,43,175,137,161,32,161,38,78,231,249,136,68,235,249,180,77,33,156,93,173,217,26,1,118,224,21,60,169,159,66,169,87,192,50,254,4,228,152,169,23,180,10,164,178,30,164,3,243,173,244,55,40,116,202,182,116,100,72,55,138,241,235,49,128,145,104,26,254,141,101,16,125,54,239,45,0,103,215,218,31,158,215,97,104,87,45,146,18,164,252,
46,0,101,234,211,183,62,130,57,238,51,209,85,67,128,33,10,167,149,176,189,237,244,99,28,6,121,119,183,32,108,88,245,165,153,181,153,51,71,142,71,9,254,24,204,95,196,3,34,188,225,84,206,7,157,159,242,174,188,170,39,240,133,52,129,88,151,44,11,187,239,245,192,18,57,182,161,133,110,12,178,128,144,89,47,206,243,222,2,181,137,29,228,181,133,20,98,135,210,56,218,162,123,139,111,230,228,247,76,252,228,136,149,129,131,122,162,43,132,165,118,77,140,168,89,122,250,225,65,90,60,4,213,71,237,205,210,26,28,95,
200,94,132,72,92,199,126,37,136,87,152,226,172,36,201,191,110,86,50,81,47,120,59,16,239,108,46,205,194,93,52,186,95,147,174,128,220,217,105,108,121,193,48,136,206,71,204,66,41,138,178,222,215,79,118,140,0,211,58,124,81,11,172,174,187,101,221,124,8,153,242,136,5,118,42,243,208,188,71,30,65,251,218,131,101,220,112,41,115,252,123,16,18,142,20,151,239,200,161,5,196,168,112,249,82,169,130,132,202,135,92,139,251,183,70,215,34,226,65,223,212,213,179,64,131,213,250,216,43,171,150,142,239,108,66,194,246,48,
69,195,166,24,197,224,63,195,5,132,131,214,218,65,5,146,98,195,112,121,192,145,72,229,193,182,53,210,7,12,139,143,19,184,151,117,4,234,212,36,199,100,106,187,168,212,115,48,201,239,33,29,26,162,94,117,137,84,143,238,144,66,142,98,58,93,26,107,90,79,113,171,146,158,1,153,111,48,232,126,120,114,61,159,191,106,154,157,96,31,42,60,238,188,203,88,125,154,239,97,228,120,220,241,123,235,22,13,220,205,19,30,15,6,28,22,183,3,162,191,200,195,184,187,45,32,173,180,77,168,212,79,102,50,219,27,163,123,144,24,
159,103,219,188,46,143,193,254,38,63,214,137,122,213,196,137,150,245,153,179,28,192,211,251,96,189,109,178,132,117,42,171,74,154,52,219,86,12,55,5,2,104,233,229,132,1,86,57,143,55,83,23,178,187,254,245,145,51,179,59,197,118,49,14,253,189,219,135,37,5,212,84,240,53,195,147,88,233,45,252,237,3,66,200,165,255,189,214,71,44,75,18,92,222,194,51,169,62,216,113,47,205,166,12,163,100,48,104,75,19,83,64,204,83,149,194,229,93,223,65,104,147,59,158,254,203,9,62,15,107,42,92,117,149,128,51,205,11,64,206,187,
145,23,126,41,65,25,52,165,152,139,26,81,72,107,223,223,242,122,115,111,52,220,27,84,55,141,92,36,146,136,97,237,196,168,69,217,252,1,18,158,161,218,100,186,252,112,152,148,116,30,118,133,8,19,138,136,50,109,180,225,221,171,138,140,219,194,53,216,152,237,58,114,57,229,39,122,170,168,222,46,144,55,199,30,234,6,104,86,64,18,42,111,80,207,57,64,129,234,56,237,117,138,130,110,141,39,137,4,247,52,96,244,134,213,135,140,218,54,183,195,243,179,113,29,191,92,164,183,88,197,60,35,214,3,250,149,205,165,204,
225,46,78,40,73,140,172,237,47,100,173,190,91,223,153,191,51,195,26,216,89,96,130,128,185,188,248,244,201,200,104,240,102,108,127,66,99,252,236,110,251,25,95,24,56,98,14,214,59,187,86,208,197,42,209,229,146,232,66,41,110,113,70,4,253,7,12,91,77,148,216,255,143,24,185,34,65,159,146,201,102,177,177,142,179,41,10,206,251,72,186,196,24,168,77,134,146,242,141,78,238,183,67,137,11,223,163,196,28,202,50,87,39,1,169,80,58,139,27,84,17,89,200,179,56,36,116,252,114,165,6,179,6,71,137,123,67,7,148,163,133,82,
23,107,43,58,198,65,72,174,130,245,38,3,254,68,169,70,116,99,149,186,84,114,147,213,100,103,222,56,189,156,225,96,58,156,0,17,86,213,8,134,46,136,30,11,11,247,97,229,80,0,12,226,247,49,102,152,8,183,31,4,151,11,188,3,11,27,5,19,184,6,190,213,104,188,0,0,7,65,195,30,60,0,0,223,109,64,130,237,214,14,160,176,40,27,216,147,27,9,68,165,25,73,146,192,72,249,89,190,220,55,61,146,249,212,81,61,64,162,97,161,102,79,186,150,13,37,121,24,189,69,247,56,202,2,217,206,0,99,86,203,165,149,53,174,201,202,97,113,
32,107,121,77,196,192,220,62,146,75,38,210,88,35,210,226,150,186,27,238,84,82,247,52,113,63,254,158,156,69,244,95,139,53,75,133,21,198,31,199,92,44,187,3,32,2,140,106,179,80,119,149,201,194,55,184,167,183,20,50,194,81,62,181,146,157,140,71,120,8,43,173,184,74,116,148,116,108,246,12,70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,13,6,137,177,239,236,22,3,42,144,166,108,232,130,10,93,18,206,254,91,121,192,138,188,92,92,122,195,226,212,169,31,
80,106,16,4,149,101,83,203,7,200,64,216,252,84,87,224,52,63,5,67,56,252,142,223,73,194,52,119,31,134,214,12,196,135,1,136,3,131,169,176,171,247,16,0,0,0,0,0,0,0,5,42,130,161,75,5,183,162,118,19,150,78,89,249,239,152,208,143,151,199,114,90,242,137,175,148,247,102,96,66,224,163,67,83,165,204];let ab=new ArrayBuffer(chunk.length*Uint8Array.BYTES_PER_ELEMENT);let view=new Uint8Array(ab);chunk.forEach((elem,idx)=>{view[idx]=elem});view=null;audioCtx.decodeAudioData(ab,()=>{resolve(true)},()=>{resolve(false)})}catch(err){resolve(false)}})};
if(window.localStorage){let tempData=localStorage.getItem(_ogg.key);if(tempData)try{tempData=JSON.parse(tempData);if(tempData.hasOwnProperty("supportOgg"))_ogg.supportOgg=tempData.supportOgg;callback(_ogg.supportOgg)}catch(error){}else checkOgg().then(res=>{localStorage.setItem(_ogg.key,JSON.stringify({supportOgg:res}));callback(res)})}else checkOgg().then(res=>{callback(res)})}initialize();Object.defineProperty(this,"gfx",{enumerable:true,"configurable":false,"value":p["gfx"]});Object.defineProperty(this,
"h264",{enumerable:true,"configurable":false,"value":p["h264"]});Object.defineProperty(this,"agentStr",{enumerable:true,"configurable":false,"value":p["agentStr"]});Object.defineProperty(this,"protocol",{enumerable:true,"configurable":false,"get":function(){return p["protocol"]}});Object.defineProperty(this,"majorVersion",{enumerable:true,"configurable":false,"value":p["majorVersion"]});Object.defineProperty(this,"isWindows",{enumerable:true,"configurable":false,"value":p["isWindows"]});Object.defineProperty(this,
"isMac",{enumerable:true,"configurable":false,"value":p["isMac"]});Object.defineProperty(this,"isIOS",{enumerable:true,"configurable":false,"value":p["isIOS"]});Object.defineProperty(this,"iosVersion",{enumerable:true,"configurable":false,"value":p["iosVersion"]});Object.defineProperty(this,"ipadModel",{enumerable:true,"configurable":false,"get":function(){return p["ipadModel"]}});Object.defineProperty(this,"iosBuildVersion",{enumerable:true,"configurable":false,"value":p["iosBuildVersion"]});Object.defineProperty(this,
"isIphone",{enumerable:true,"configurable":false,"value":p["isIphone"]});if(p["isIphone"]==true)Object.defineProperty(this,"iphoneModel",{enumerable:true,"configurable":false,"value":p["iphoneModel"]});Object.defineProperty(this,"isIpod",{enumerable:true,"configurable":false,"value":p["isIpod"]});Object.defineProperty(this,"isAndroid",{enumerable:true,"configurable":false,"value":p["isAndroid"]});Object.defineProperty(this,"isHPTablet",{enumerable:true,"configurable":false,"value":p["isHPTablet"]});
Object.defineProperty(this,"isPlaybook",{enumerable:true,"configurable":false,"value":p["isPlaybook"]});Object.defineProperty(this,"isChromeOS",{enumerable:true,"configurable":false,"value":p["isChromeOS"]});Object.defineProperty(this,"chromeOSVersion",{enumerable:true,"configurable":false,"value":p["chromeOSVersion"]});Object.defineProperty(this,"isSymbian",{enumerable:true,"configurable":false,"value":p["isSymbian"]});Object.defineProperty(this,"isFirefox",{enumerable:true,"configurable":false,
"value":p["isFirefox"]});Object.defineProperty(this,"isOpera",{enumerable:true,"configurable":false,"value":p["isOpera"]});Object.defineProperty(this,"isChrome",{enumerable:true,"configurable":false,"value":p["isChrome"]});Object.defineProperty(this,"chromeVersion",{enumerable:true,"configurable":false,"value":p["chromeVersion"]});Object.defineProperty(this,"isNokiaBrowser",{enumerable:true,"configurable":false,"value":p["isNokiaBrowser"]});Object.defineProperty(this,"isSafari",{enumerable:true,"configurable":false,
"value":p["isSafari"]});Object.defineProperty(this,"isMSIE",{enumerable:true,"configurable":false,"value":p["isMSIE"]});Object.defineProperty(this,"isYandex",{enumerable:true,"configurable":false,"value":p["isYandex"]});Object.defineProperty(this,"isDragon",{enumerable:true,"configurable":false,"value":p["isDragon"]});Object.defineProperty(this,"dragonVersion",{enumerable:true,"configurable":false,"value":p["dragonVersion"]});Object.defineProperty(this,"isChromium",{enumerable:true,"configurable":false,
"value":p["isChromium"]});Object.defineProperty(this,"msieVersion",{enumerable:true,"configurable":false,"value":p["msieVersion"]});Object.defineProperty(this,"msieOSVersion",{enumerable:true,"configurable":false,"value":p["msieOSVersion"]});Object.defineProperty(this,"msieHTMLVersion",{enumerable:true,"configurable":false,"value":p["msieHTMLVersion"]});Object.defineProperty(this,"browserName",{enumerable:true,"configurable":false,"get":getBrowserName});Object.defineProperty(this,"firefoxVersion",
{enumerable:true,"configurable":false,"value":p["firefoxVersion"]});Object.defineProperty(this,"isWindowsPhone",{enumerable:true,"configurable":false,"value":p["isWindowsPhone"]});Object.defineProperty(this,"isMobile",{enumerable:true,"configurable":false,"get":function(){return p["isMobile"]}});Object.defineProperty(this,"isTouch",{enumerable:true,"configurable":false,"get":function(){return p["isTouch"]}});Object.defineProperty(this,"getAgentKey",{enumerable:true,"configurable":false,"value":getAgentKey});
Object.defineProperty(this,"browserFromAgent",{enumerable:true,"configurable":false,"value":browserFromAgent});Object.defineProperty(this,"hasObjectURL",{enumerable:true,"configurable":false,"value":p["hasObjectURL"]});Object.defineProperty(this,"hasArrayBuffers",{enumerable:true,"configurable":false,"value":p["hasArrayBuffers"]});Object.defineProperty(this,"hasTypedArrays",{enumerable:true,"configurable":false,"value":p["hasTypedArrays"]});Object.defineProperty(this,"hasWorkers",{enumerable:true,
"configurable":false,"value":p["hasWorkers"]});Object.defineProperty(this,"hasTransferableObjects",{enumerable:true,"configurable":false,"get":function(){return getTransferableObjects()}});Object.defineProperty(this,"supportsAsmJsWorkers",{enumerable:true,"configurable":false,"get":function(){return p["supportsAsmJsWorkers"]}});Object.defineProperty(this,"supportsRFXDecoder",{enumerable:true,"configurable":false,"get":function(){return p["supportsRFXDecoder"]}});Object.defineProperty(this,"supportsFullScreen",
{enumerable:true,"configurable":false,"value":supportsFullScreen});Object.defineProperty(this,"addAsyncDetectionCallback",{enumerable:true,"configurable":false,"value":addAsyncDetectionCallback});Object.defineProperty(this,"runAsyncDetections",{enumerable:true,"configurable":false,"value":runAsyncDetections});Object.defineProperty(this,"supportHTML5",{enumerable:true,"configurable":false,"get":function(){return supportHTML5()}});Object.defineProperty(this,"supportAudioAutoPlay",{enumerable:true,"configurable":false,
"get":function(){return apaSupported}});Object.defineProperty(this,"detectTouch",{enumerable:true,"configurable":false,writable:false,"value":detectTouch});Object.defineProperty(this,"isTabletMode",{enumerable:true,"configurable":false,"get":function(){return p["isTabletMode"]}});Object.defineProperty(this,"timeZone",{enumerable:true,"configurable":false,"get":function(){return p["timeZone"]}});Object.defineProperty(this,"compareVersions",{enumerable:true,"configurable":false,"value":compareVersions});
Object.defineProperty(this,"isOlderThan",{enumerable:true,"configurable":false,"value":isOlderThan});Object.defineProperty(this,"isNewerThan",{enumerable:true,"configurable":false,"value":isNewerThan});Object.defineProperty(this,"isSameVersion",{enumerable:true,"configurable":false,"value":isSameVersion});Object.defineProperty(this,"supportOggFormat",{enumerable:true,"configurable":false,"value":supportOggFormat});Object.defineProperty(this,"__setInitializationData__",{enumerable:true,"configurable":false,
"writable":false,"value":setInitializationData});return this}var agentInfo=null;try{agentInfo=new AgentInfo}catch(error){}if(typeof agentInfo=="undefined"||agentInfo==null){agentInfo=new Object;agentInfo["supportHTML5"]=false}
function Helper(){var GLOBAL_VAR={console:{logDebug:false,logWarning:true,logInfo:true,logError:true,logException:true,logFatal:true},"class":{"name":"help","privateREF#":null,"ref#":null}};var _plugins={};function initialize(assignElem){try{if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+GLOBAL_VAR["class"]["name"]+" class. - "+(new Date).toString());GLOBAL_VAR["class"]["privateREF#"]=assignElem;var ajax=new Ajax;var color=
new Color;var console=new Console;var dom=new Dom;var object=new ObjectExtend;var datetime=new Datetime;var dictionary=new Dictionary;var polyfills=new Polyfills;var printObject=new Printer;var size=new Size;var storage=new Storage;var string=new StringExtend;var style=new Style;var url=new URL;var utils=new Utils;new WebSocketObject(assignElem);Object.defineProperty(assignElem,"ajax",{"enumerable":true,"configurable":false,"get":function(){return ajax}});Object.defineProperty(assignElem,"color",
{"enumerable":true,"configurable":false,"get":function(){return color}});Object.defineProperty(assignElem,"console",{"enumerable":true,"configurable":false,"get":function(){return console}});Object.defineProperty(assignElem,"dom",{"enumerable":true,"configurable":false,"get":function(){return dom}});Object.defineProperty(assignElem,"object",{"enumerable":true,"configurable":false,"get":function(){return object}});Object.defineProperty(assignElem,"datetime",{"enumerable":true,"configurable":false,
"get":function(){return datetime}});Object.defineProperty(assignElem,"dictionary",{"enumerable":true,"configurable":false,"get":function(){return dictionary}});Object.defineProperty(assignElem,"printer",{"enumerable":true,"configurable":false,"get":function(){return printObject}});Object.defineProperty(assignElem,"url",{"enumerable":true,"configurable":false,"get":function(){return url}});Object.defineProperty(assignElem,"size",{"enumerable":true,"configurable":false,"get":function(){return size}});
Object.defineProperty(assignElem,"storage",{"enumerable":true,"configurable":false,"get":function(){return storage}});Object.defineProperty(assignElem,"string",{"enumerable":true,"configurable":false,"get":function(){return string}});Object.defineProperty(assignElem,"style",{"enumerable":true,"configurable":false,"get":function(){return style}});Object.defineProperty(assignElem,"utils",{"enumerable":true,"configurable":false,"get":function(){return utils}});Object.defineProperty(assignElem,"registerPlugin",
{"enumerable":true,"configurable":false,"writable":false,"value":registerPlugin});Object.defineProperty(assignElem,"unregisterPlugin",{"enumerable":true,"configurable":false,"writable":false,"value":unregisterPlugin});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log(GLOBAL_VAR["class"]["name"]+" class was Initialized. - "+(new Date).toString())}catch(error){genericLog(error,arguments)}}function getFunctionName(args){try{var fName="";if(args!=
null&&args!=undefined&&args.callee!=undefined){var calleeName=args.callee&&args.callee.name?args.callee.name:"[anonymous]";var callerName=args.callee&&args.callee.caller&&args.callee.caller.name?args.callee.caller.name:"[anonymous]";fName=calleeName+" from "+callerName}return fName}catch(error){return"[unknown]"}}function genericLog(error){if(typeof window["console"]!="undefined"){function convertMessageToString(message){try{var retMsg=GLOBAL_VAR["class"]["privateREF#"]["datetime"].getFormattedDatetime(new Date)+
" - ";if(message!=undefined&&message!=null){if(message.Message!=undefined)retMsg+=" Message: "+message.Message;else if(message.message!=undefined)retMsg+=" Message: "+message.message;if(message.Stack!=undefined)retMsg+=" Stack: "+message.Stack;else if(message.stack!=undefined)retMsg+=" Stack: "+message.stack;if(message.Description!=undefined)retMsg+=" Description: "+message.Description;else if(message.description!=undefined)retMsg+=" Description: "+message.description;else if(typeof message=="string")retMsg+=
" "+message}}catch(error){if(typeof window.agentInfo!="undefined"&&agentInfo.supportHTML5)return message&&typeof message.message!="undefined"?message.message:message.toString();else;}return retMsg}if(window["console"].hasOwnProperty("error"))window.console.error(convertMessageToString(error));else if(window["console"].hasOwnProperty("warn"))window.console.warn(convertMessageToString(error));else if(window["console"].hasOwnProperty("log"))window.console.log(convertMessageToString(error))}}function registerPlugin(name,
plugin){if(name&&name!=""&&_plugins[name]==undefined){for(var n in GLOBAL_VAR["class"]["privateREF#"])if(n.toLowerCase()==name.toLowerCase())return false;_plugins[name]=new plugin;Object.defineProperty(GLOBAL_VAR["class"]["privateREF#"],name,{"enumerable":true,"configurable":false,"get":function(){return _plugins[name]}});return true}else return false}function unregisterPlugin(name,plugin){if(name&&name!=""&&_plugins[name]!=undefined){delete _plugins[name];delete GLOBAL_VAR["class"]["privateREF#"][name];
return true}else return false}function Ajax(){var _className=getFunctionName(arguments);var _headers={};var _responseTypes=Object.freeze({"BLANK":"","TEXT":"text","ARRAYBUFFER":"arraybuffer","BLOB":"blob","DOCUMENT":"document","JSON":"json","MSSTREAM":"ms-stream"});var _HTTPStatusCodeDescription=Object.freeze({400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",
409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",419:"Page Expired",420:"Method Failure",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Reserved for WebDAV",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",430:"Request Header Fields Too Large",431:"Request Header Fields Too Large",
440:"Login Time-out",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request header too large",495:"SSL Certificate Error",496:"SSL Certificate Required",497:"HTTP Request Sent to HTTPS Port",498:"Invalid Token",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",
508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Web Server Returned an Unknown Error",521:"Web Server Is Down",522:"Connection Timed Out",523:"Origin Is Unreachable",524:"A Timeout Occurred",525:"SSL Handshake Failed",526:"Invalid SSL Certificate",527:"Railgun Error",561:"Unauthorized"});var _default={"async":true,"type":_responseTypes.BLANK,"timeout":3E4,"credentials":false};var _queues={};var states={"READY":0,"SETUP":1,"SENT":2,"PROCESS":3,
"COMPLETED":4};var _rePP=RegExp(/\?|&/);var _normalizeResponse=agentInfo.isMSIE&&agentInfo.msieVersion<12;function addHeaderValue(header,value){_headers[header]=value}function removeHeaderValue(header){delete _headers[header]}function shiftQueue(qname){if(qname&&_queues[qname]){_queues[qname].shift();setTimeout(execXMLHttpRequest,1,qname)}}function normalizeResponse(callback){if(callback)return function(response,status,xmlhttp){try{if(typeof response!=="object")callback(JSON.parse(response),status,
xmlhttp);else callback(response,status,xmlhttp)}catch(error){if(xmlhttp.error)xmlhttp.error(error.message,xmlhttp)}};else return undefined}function xmlHttpRequest(method,jData){var xmlhttp=new XMLHttpRequest;var responseType="";var async=typeof jData.async!="undefined"?jData.async:_default.async;if(async!==false)responseType=(jData.dataType||jData.type||jData.responseType||_default.type).toLowerCase();var qname=typeof jData.queueName!="undefined"?jData.queueName:null;xmlhttp.withCredentials=typeof jData.withCredentials!=
"undefined"?jData.withCredentials:_default.credentials;var url=jData.url;xmlhttp.success=_normalizeResponse&&responseType===_responseTypes.JSON?normalizeResponse(jData.success):jData.success;xmlhttp.error=jData.error;xmlhttp.abort=jData.abort;xmlhttp.readystatechange=jData.readystatechange;xmlhttp.onreadystatechange=function(e){var evt=e.target;if(evt.readyState===states.COMPLETED)if(evt.status===200){shiftQueue(evt.queuename);clearTimeout(xmlhttp.timeoutId);delete xmlhttp.timeoutId;if(!evt.aborted)if(xmlhttp.success)xmlhttp.success(evt.response,
evt.status,xmlhttp)}else{shiftQueue(evt.queuename);clearTimeout(xmlhttp.timeoutId);delete xmlhttp.timeoutId;var err={};try{err.message=evt.response?evt.response.error.message:evt.responseText}catch(error){}err.message=err.message||_HTTPStatusCodeDescription[evt.status]||"Unknown error";if(!evt.aborted&&xmlhttp.error)xmlhttp.error(err,evt.status,xmlhttp);else if(evt.aborted)if(xmlhttp.abort)xmlhttp.abort(err,evt.status,xmlhttp);else if(xmlhttp.error)xmlhttp.error(err,evt.status,xmlhttp)}if(xmlhttp.readystatechange)xmlhttp.readystatechange(evt.readyState,
evt.status,xmlhttp)};xmlhttp.params={"async":async,"method":method,"url":url,"contentType":jData.contentType,"data":jData.data,"timeout":typeof jData.timeout!="undefined"?jData.timeout:_default.timeout,"responseType":responseType,"noHeaders":jData.noHeaders,"beforeSend":jData.beforeSend};try{if(qname){if(!_queues[qname])_queues[qname]=[];xmlhttp.queuename=qname;_queues[qname].push({"xmlhttp":xmlhttp});execXMLHttpRequest(qname)}else executeXMLHttpRequest(xmlhttp)}catch(error){if(jData.error)jData.error(error,
-1,xmlhttp);return xmlhttp}return xmlhttp}function execXMLHttpRequest(qname){if(_queues[qname]&&_queues[qname].length>0){var xmlhttp=_queues[qname][0].xmlhttp;if(xmlhttp.readyState===states.READY)executeXMLHttpRequest(xmlhttp)}}function executeXMLHttpRequest(xmlhttp){var params=xmlhttp.params;xmlhttp.open(params.method,params.url,params.async);if(params.async){xmlhttp.responseType=params.responseType;if(params.timeout>0){xmlhttp.timeout=params.timeout;xmlhttp.timeoutId=setTimeout(function(){if(!xmlhttp.aborted){xmlhttp.aborted=
true;if(xmlhttp.abort)xmlhttp.abort()}},params.timeout);params.timeout=null}}var data=typeof params.data!="undefined"?params.data:null;if(params.method==="POST"){var contentType=null;if(params.contentType)contentType=params.contentType;else if(data!==null&&!(data instanceof FormData))if(GLOBAL_VAR["class"]["privateREF#"].object.getDataTypeOf(data)=="json")contentType="application/json";else contentType="application/x-www-form-urlencoded; charset=UTF-8";if(contentType!=null){xmlhttp.setRequestHeader("Content-Type",
contentType);if(contentType=="application/json"&&data!=null&&typeof data=="object")data=JSON.stringify(data)}}if(params.noHeaders!==true)for(var header in _headers)xmlhttp.setRequestHeader(header,_headers[header]);if(params.beforeSend&&params.beforeSend instanceof Function)params.beforeSend(xmlhttp);if(data!=null)xmlhttp.send(data);else xmlhttp.send()}function jsonP(jData){var script=document.createElement("script");script.async=true;script.defer=true;script.type="text/javascript";if(jData.charset)script.charset=
jData.charset;script.onload=function(e){if(jData.success)jData.success(e)};script.error=jData.error}function get(jData){return xmlHttpRequest("GET",jData)}function post(jData){return xmlHttpRequest("POST",jData)}function releaseQueue(queueName){if(_queues[queueName]&&_queues[queueName].length>0)_queues[queueName].forEach(function(elem){elem.xmlhttp.aborted=true;if(elem.xmlhttp.abort)elem.xmlhttp.abort()})}Object.defineProperty(this,"addHeaderValue",{"enumerable":true,"configurable":false,"writable":false,
"value":addHeaderValue});Object.defineProperty(this,"removeHeaderValue",{"enumerable":true,"configurable":false,"writable":false,"value":removeHeaderValue});Object.defineProperty(this,"jsonP",{"enumerable":true,"configurable":false,"writable":false,"value":jsonP});Object.defineProperty(this,"get",{"enumerable":true,"configurable":false,"writable":false,"value":get});Object.defineProperty(this,"post",{"enumerable":true,"configurable":false,"writable":false,"value":post});Object.defineProperty(this,
"releaseQueue",{"enumerable":true,"configurable":false,"writable":false,"value":releaseQueue});Object.defineProperty(this,"queueLength",{"enumerable":true,"configurable":false,"writable":false,"value":function(queueName){return _queues[queueName]?_queues[queueName].length:0}});Object.defineProperty(this,"responseType",{"enumerable":true,"configurable":false,"get":function(){return _responseTypes}});Object.defineProperty(this,"httpStatusCodeDescription",{"enumerable":true,"configurable":false,"get":function(){return _HTTPStatusCodeDescription}});
if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Color(){var _className=getFunctionName(arguments);var COLOR_LIGHT_BOTTOMLIMIT=144;function getRGBStruct(r,g,b,a){var aux=GLOBAL_VAR["class"]["privateREF#"]["string"].sprintf('{ "r": %s, "g": %s, "b": %s, "a": %s }',Math.round(r||0),Math.round(g||0),Math.round(b||0),a||1);return JSON.parse(aux)}function toRGB(color){if(typeof color==
"object"&&typeof color.r!="undefined"&&typeof color.g!="undefined"&&color.b!="undefined"){if(typeof color.a=="undefined")color.a=1;return color}var rgba=getRGBStruct();if(/^#[A-Fa-f0-9]{3}$/.test(color)){rgba.r=parseInt(color.substr(1,1),16);rgba.g=parseInt(color.substr(2,1),16);rgba.b=parseInt(color.substr(3,1),16)}else if(/^#[A-Fa-f0-9]{6}$/.test(color)){rgba.r=parseInt(color.substr(1,2),16);rgba.g=parseInt(color.substr(3,2),16);rgba.b=parseInt(color.substr(5,2),16)}else{var res=/rgba?\((\d+), ?(\d+), ?(\d+)(, ?(\.?\d+))?\)/.exec(color);
if(res!=null){rgba.r=parseInt(res[1],10);rgba.g=parseInt(res[2],10);rgba.b=parseInt(res[3],10);if(res.length==6)rgba.a=parseFloat(res[5])}}if(isNaN(rgba.a))rgba.a=1;return rgba}function averageColor(col1,col2){var RGB1=toRGB(col1);var RGB2=toRGB(col2);var rgba=getRGBStruct((RGB1.r+RGB2.r)/2,(RGB1.g+RGB2.g)/2,(RGB1.b+RGB2.b)/2,(RGB1.a+RGB2.a)/2);return toHexColor(rgba)}function toHexColor(){var toHex=function(n){return("0"+n.toString(16)).substr(-2)};if(arguments[0]instanceof Object){var c=arguments[0];
return"#"+toHex(c.r)+toHex(c.g)+toHex(c.b)}else if(arguments.length>2)return"#"+toHex(arguments[0])+toHex(arguments[1])+toHex(arguments[2]);else if(arguments.length===1){var c=toRGB(arguments[0]);return"#"+toHex(c.r)+toHex(c.g)+toHex(c.b)}return"#000"}function shift(color,shiftValue){var rgb=toRGB(color);if(shiftValue==1)return{"r":rgb.g,"g":rgb.b,"b":rgb.r};else return{"r":rgb.b,"g":rgb.r,"b":rgb.g}}function combine(mode,col1,col2){var RGB1=toRGB(col1);var RGB2=toRGB(col2);var rgba=getRGBStruct((RGB1.r+
RGB2.r)%256,(RGB1.g+RGB2.g)%256,(RGB1.b+RGB2.b)%256,(RGB1.a+RGB2.a)/2);return toHexColor(rgba)}function getTextColor(color){var rgb=toRGB(color);var avg=(rgb.r+rgb.g+rgb.b)/3;return avg>COLOR_LIGHT_BOTTOMLIMIT||Math.max(rgb.r,Math.max(rgb.g*1.8,rgb.b))>COLOR_LIGHT_BOTTOMLIMIT&&avg>COLOR_LIGHT_BOTTOMLIMIT?"#000000":"#fcfcfc"}function isLightColor(color){var rgb=toRGB(color);helper.console.log(JSON.stringify(rgb));return(rgb.r+rgb.g|+rgb.b)/3>COLOR_LIGHT_BOTTOMLIMIT}Object.defineProperty(this,"toRGB",
{"enumerable":true,"configurable":false,"writable":false,"value":toRGB});Object.defineProperty(this,"toHexColor",{"enumerable":true,"configurable":false,"writable":false,"value":toHexColor});Object.defineProperty(this,"averageColor",{"enumerable":true,"configurable":false,"writable":false,"value":averageColor});Object.defineProperty(this,"shift",{"enumerable":true,"configurable":false,"writable":false,"value":shift});Object.defineProperty(this,"combine",{"enumerable":true,"configurable":false,"writable":false,
"value":combine});Object.defineProperty(this,"getTextColor",{"enumerable":true,"configurable":false,"writable":false,"value":getTextColor});Object.defineProperty(this,"isLightColor",{"enumerable":true,"configurable":false,"writable":false,"value":isLightColor});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Console(){var LOCAL_VAR={"class":{"name":"console"},
"console":{"log":null,"error":null,"info":null,"warn":null,"exception":null,"fatal":null},"msgLogAvailable":null,"msgLogger":null,"logConsole":null,"preserveLog":{"log":[],"available":false},"externalLog":false};try{function initialize(){try{if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+LOCAL_VAR["class"]["name"]+" class. - "+(new Date).toString());if(typeof Thinfinity!=="undefined"&&typeof Thinfinity.LogConsole!="undefined")LOCAL_VAR.logConsole=
Thinfinity.LogConsole;if(typeof MsgLogger!="undefined"){LOCAL_VAR.msgLogAvailable=true;LOCAL_VAR.msgLogger=new MsgLogger}else LOCAL_VAR.msgLogAvailable=false;for(var collection in LOCAL_VAR.console)LOCAL_VAR.console[collection]=window.console[collection]!==undefined?collection:LOCAL_VAR.console.log!=null?LOCAL_VAR.console.log:"alert";if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log(LOCAL_VAR["class"]["name"]+" class was Initialized. - "+
(new Date).toString())}catch(error){genericLog(error,arguments)}}function getISOTime(){var now=new Date;if(typeof now.toISOString!="undefined"){var ret=now.toISOString();ret=ret.substr(ret.indexOf("T")+1,12);return ret}else return("0"+now.getUTCHours()).substr(-2)+":"+("0"+now.getUTCMinutes()).substr(-2)+":"+("0"+now.getUTCSeconds()).substr(-2)+"."+now.getUTCMilliseconds()}function remoteLog(value){LOCAL_VAR.externalLog=value}function log(message,args,collection,exceptionStack){try{var isLocal=arguments.length>=
5;var fnName=getFunctionName(args);if(fnName!="")fnName="Caller: "+fnName+" - ";var msg=getISOTime()+": ";if(message!=undefined&&message!=null){if(message.message!=undefined)msg+=" Message: "+message.message;else if(message.Message!=undefined)msg+=" Message: "+message.Message;if(message.stack!=undefined)msg+=" Stack: "+message.stack;else if(message.Stack!=undefined)msg+=" Stack: "+message.Stack;if(message.description!=undefined)msg+=" Description: "+message.description;else if(message.Description!=
undefined)msg+=" Description: "+message.Description;else if(typeof message=="string")msg+=" "+message}if(exceptionStack!=undefined&&exceptionStack!=null){if(exceptionStack.message!=undefined)msg+=" Message: "+exceptionStack.message;else if(exceptionStack.Message!=undefined)msg+=" Message: "+exceptionStack.Message;if(exceptionStack.stack!=undefined)msg+=" Stack: "+exceptionStack.stack;else if(exceptionStack.Stack!=undefined)msg+=" Stack: "+exceptionStack.Stack;if(exceptionStack.description!=undefined)msg+=
" Description: "+exceptionStack.description;else if(exceptionStack.Description!=undefined)msg+=" Description: "+exceptionStack.Description}if(LOCAL_VAR.console[collection]!="alert"){if(LOCAL_VAR["preserveLog"]["available"]==true)LOCAL_VAR["preserveLog"]["log"].push({"fName":fnName,"msg":msg,"collection":collection});window.console[LOCAL_VAR.console[collection]](fnName+msg)}else if(collection=="error"||collection=="exception"||collection=="fatal")alert(fnName+msg);if(LOCAL_VAR.logConsole)LOCAL_VAR.logConsole.send(collection,
fnName,msg,exceptionStack);if(!isLocal&&LOCAL_VAR.externalLog==true&&LOCAL_VAR.msgLogAvailable)switch(collection){case "error":case "exception":case "fatal":msgLogError(fnName+msg,collection);break;default:msgLogDebug(fnName+msg,collection);break}}catch(error){genericLog(error,arguments)}}function msgLogDebug(value,extraClass){try{var addISOTime=arguments.length>1&&arguments[1];if(addISOTime)value=getISOTime()+": "+value;if(LOCAL_VAR.msgLogAvailable)LOCAL_VAR.msgLogger.log(value,extraClass);else log(value,
null,"log",null,null)}catch(error){genericLog(error,arguments)}}function msgLogError(value,extraClass){try{var addISOTime=arguments.length>1&&arguments[1];if(addISOTime)value=getISOTime()+": "+value;if(LOCAL_VAR.msgLogAvailable)LOCAL_VAR.msgLogger.log("ERROR: "+value,extraClass);else{log(value,null,"error",null,null);return value}}catch(error){genericLog(error,arguments)}}function switchLogStatus(logsName,enabled){var response=true;try{logsName=logsName.toString().toLowerCase();if(logsName.indexOf("debug")!=
-1)GLOBAL_VAR["console"]["logDebug"]=enabled;if(logsName.indexOf("log")!=-1)GLOBAL_VAR["console"]["logDebug"]=enabled;if(logsName.indexOf("info")!=-1)GLOBAL_VAR["console"]["logInfo"]=enabled;if(logsName.indexOf("warning")!=-1)GLOBAL_VAR["console"]["logWarning"]=enabled;if(logsName.indexOf("warn")!=-1)GLOBAL_VAR["console"]["logWarning"]=enabled;if(logsName.indexOf("error")!=-1)GLOBAL_VAR["console"]["logError"]=enabled;if(logsName.indexOf("fatal")!=-1)GLOBAL_VAR["console"]["logFatal"]=enabled;if(logsName.indexOf("exception")!=
-1)GLOBAL_VAR["console"]["logException"]=enabled;if(logsName.indexOf("ex")!=-1)GLOBAL_VAR["console"]["logException"]=enabled}catch(error){response=false}return response}initialize();Object.defineProperty(this,"debug",{"enumerable":false,"configurable":false,"value":function(message,args){if(GLOBAL_VAR.console.logDebug)log(message,args,"log")}});Object.defineProperty(this,"log",{"enumerable":false,"configurable":false,"value":function(message,args){if(GLOBAL_VAR.console.logDebug)log(message,args,"log")}});
Object.defineProperty(this,"warning",{"enumerable":false,"configurable":false,"value":function(warn,args){if(GLOBAL_VAR.console.logWarning)log(warn,args,"warn")}});Object.defineProperty(this,"warn",{"enumerable":false,"configurable":false,"value":function(warn,args){if(GLOBAL_VAR.console.logWarning)log(warn,args,"warn")}});Object.defineProperty(this,"error",{"enumerable":false,"configurable":false,"value":function(message,exception,args){if(GLOBAL_VAR.console.logError)log(message,args,"error",exception)}});
Object.defineProperty(this,"fatal",{"enumerable":false,"configurable":false,"value":function(message,exception,args){if(GLOBAL_VAR.console.logFatal)log(message,args,"fatal",exception)}});Object.defineProperty(this,"exception",{"enumerable":false,"configurable":false,"value":function(message,exception,args){if(GLOBAL_VAR.console.logException)log(exception,args,"exception",exception)}});Object.defineProperty(this,"info",{"enumerable":false,"configurable":false,"value":function(info,args){if(GLOBAL_VAR.console.logInfo)log(info,
args,"info")}});Object.defineProperty(this,"msgDebug",{"enumerable":false,"configurable":false,"value":function(value){if(GLOBAL_VAR.console.logDebug)msgLogDebug(value)}});Object.defineProperty(this,"msgError",{"enumerable":false,"configurable":false,"value":function(value){if(GLOBAL_VAR.console.logError)msgLogDebug(value)}});genericLog=this.error;Object.defineProperty(this,"on",{"enumerable":false,"configurable":false,"value":function(logsName){switchLogStatus(logsName,true)}});Object.defineProperty(this,
"off",{"enumerable":false,"configurable":false,"value":function(logsName){switchLogStatus(logsName,false)}});Object.defineProperty(this,"remoteLog",{"enumerable":false,"configurable":false,"get":function(){return LOCAL_VAR.externalLog},"set":function(value){LOCAL_VAR.externalLog=value}});Object.defineProperty(this,"getLog",{"enumerable":true,"configurable":false,"value":function(){return LOCAL_VAR["preserveLog"]["log"]}});Object.defineProperty(this,"preserveLog",{"enumerable":true,"configurable":false,
"get":function(){return LOCAL_VAR["preserveLog"]["available"]},"set":function(value){return LOCAL_VAR["preserveLog"]["available"]=value}});return this}catch(error){genericLog(error,arguments)}}function Datetime(){var _className=getFunctionName(arguments);function getFormattedDatetime(datetime){return datetimeToString(datetime,"yyyy/mm/dd HH:MM:ss.f")}function getFormattedDate(datetime){return datetimeToString(datetime,"yyyy/mm/dd")}function getFormattedTime(datetime){return datetimeToString(datetime,
"HH:MM:ss")}function getDatetime(datetime,format){return datetimeToString(datetime,format)}function datetimeToString(datetime,format,utc){try{var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[FfoSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val};
return function(date,mask,utc){var dF=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(date)=="[object String]"&&!/\d/.test(date)){mask=date;date=undefined}if(!date instanceof Date)date=new Date;if(isNaN(date))throw SyntaxError("invalid date");mask=String(dF.masks[mask]||mask||dF.masks["default"]);if(mask.slice(0,4)=="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+
"Minutes"](),s=date[_+"Seconds"](),F=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),f:pad(F,3),F:pad(F>99?Math.round(F/10):F),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,
""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",
isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return dateFormat(datetime,format,utc)}catch(Error){return Error}}function zeropad(n){return String("00"+n).slice(-2)}
function completeTimeToString(datetime){try{var d=new Date;d.setTime(datetime);s=zeropad(d.getMonth()+1)+"/"+zeropad(d.getDate())+" "+d.getHours()+":"+zeropad(d.getMinutes());return s}catch(error){return error}}Object.defineProperty(this,"getFormattedDatetime",{"enumerable":true,"configurable":false,"writable":false,"value":getFormattedDatetime});Object.defineProperty(this,"getFormattedDate",{"enumerable":true,"configurable":false,"writable":false,"value":getFormattedDate});Object.defineProperty(this,
"getFormattedTime",{"enumerable":true,"configurable":false,"writable":false,"value":getFormattedTime});Object.defineProperty(this,"getDatetime",{"enumerable":true,"configurable":false,"writable":false,"value":getDatetime});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Dictionary(){var _className=getFunctionName(arguments);var _defaultDictionaries=null;
var _defaultDictionariesIgnoreCase=null;var _ignoreCase=false;function defaultDictionaries(dictionaries){_defaultDictionaries=[];_defaultDictionariesIgnoreCase=[];if(dictionaries)for(var i=0;i<dictionaries.length;i++){var _dic={};for(var key in dictionaries[i])_dic[key.toLowerCase()]=dictionaries[i][key];_defaultDictionaries.push(dictionaries[i]);_defaultDictionariesIgnoreCase.push(_dic)}}function getValue(key,dictionaries){if(key){if(dictionaries)for(var i=0;i<dictionaries.length;i++)if(dictionaries[i])if(dictionaries[i].hasOwnProperty(key))return dictionaries[i][key];
else if(_ignoreCase)for(var _key in dictionaries[i])if(_key.toLowerCase()==key.toLowerCase())return dictionaries[i][_key];if(_defaultDictionaries)for(var i=0;i<_defaultDictionaries.length;i++)if(_defaultDictionaries[i].hasOwnProperty(key))return _defaultDictionaries[i][key];else if(_ignoreCase&&_defaultDictionariesIgnoreCase[i].hasOwnProperty(key.toLowerCase()))return _defaultDictionariesIgnoreCase[i][key.toLowerCase()];return""}else return""}Object.defineProperty(this,"items",{"enumerable":true,
"configurable":false,"set":function(dictionaries){defaultDictionaries(dictionaries)}});Object.defineProperty(this,"ignoreCase",{"enumerable":true,"configurable":false,"set":function(value){_ignoreCase=value}});Object.defineProperty(this,"getValue",{"enumerable":true,"configurable":false,"writable":false,"value":getValue});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}
function Dom(){var _className=getFunctionName(arguments);var _useOn=document.addEventListener==undefined;var _domStateEvents={"order":["loading","interactive","complete"],"lastState":-1,"handlers":{"loading":[],"interactive":[],"complete":[]}};var _shortcutTrim=null;function byId(id){return document.getElementById(id)}function setContent(elem,content){switch(elem.nodeName){case "DIV":case "SPAN":case "P":case "LABEL":case "LI":case "A":case "OPTION":case "BUTTON":elem.innerHTML=content;break;case "INPUT":case "CHECKBOX":case "RADIO":elem.value=
content;break;default:elem.nodeName=="OPTION"||typeof elem.value=="undefined"?elem.innerHTML=content:elem.value=content;break}}function createJsonElement(json){if(_shortcutTrim==null)_shortcutTrim=GLOBAL_VAR["class"]["privateREF#"].string.trim;var elem=document.createElement(json["type"]);if(json["attributes"])for(var attr in json["attributes"])if(["innerHTML","innerText"].indexOf(attr)==-1&&(attr=="class"||typeof elem[attr]!="undefined"||json.type==="label"&&attr==="for"))if(attr==="style"){var s=
json["attributes"][attr].replace(/ /g,"").split(";");s.forEach(function(item){var kvp=item.split(":");elem.style[kvp[0]]=kvp[1]})}else elem.setAttribute(attr,json["attributes"][attr]);else elem[attr]=json["attributes"][attr];var content=json["content"];if(typeof content!=="undefined"){var regExp=new RegExp("HTML{1}[a-zA-Z]*Element{1}");var type=GLOBAL_VAR["class"]["privateREF#"].object.getTypeOf(content);if(content instanceof HTMLElement||regExp.exec(type)!=null&&regExp.exec(type).length>0)elem.appendChild(content);
else setContent(elem,content)}var events=json["events"];for(var eventName in events){var _handler=typeof events[eventName]==="function"?events[eventName]:events[eventName]&&typeof events[eventName].handler==="function"?events[eventName].handler:null;var _evtAttr=typeof events[eventName]==="object"&&events[eventName]&&events[eventName].options?events[eventName].options:false;addEvent(elem,eventName,_handler,_evtAttr)}if(json["style"])GLOBAL_VAR["class"]["privateREF#"]["style"].add(elem,json["style"]);
return elem}function appendJsonElement(json){var elem=createJsonElement(json);if(json["parentElement"])json["parentElement"].appendChild(elem);return elem}function prependJsonElement(json){var elem=createJsonElement(json);if(json["parentElement"])json["parentElement"].insertBefore(elem,json["parentElement"].firstChild);return elem}function createElement(type,attributesCollection,content,events){if(GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(type)=="object")return createJsonElement(type);
else{var elem=document.createElement(type);if(attributesCollection)for(var a in attributesCollection)elem.setAttribute(a,attributesCollection[a]);if(content)if(GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(content)=="object")elem.appendChild(content);else elem.innerHTML=content;if(events)for(var eventName in events)addEvent(elem,eventName,events[eventName]);return elem}}function appendElement(parentElement,type,attributesCollection,content,events){if((typeof parentElement=="undefined"||typeof parentElement.nodeType==
"undefined")&&GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(parentElement)=="object")return appendJsonElement(parentElement);else{var elem=createElement(type,attributesCollection,content,events);parentElement.appendChild(elem);return elem}}function prependElement(parentElement,type,attributesCollection,content,events){if((typeof parentElement=="undefined"||typeof parentElement.nodeType=="undefined")&&GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(parentElement)=="object")return prependJsonElement(parentElement);
else{var elem=createElement(type,attributesCollection,content,events);parentElement.insertBefore(elem,parentElement.firstChild);return elem}}function addEvent(element,events,delegHandler,evtAttr){if(element){if(!(events instanceof Array))events=events.split(",");events=normalizeEventsName(events);var _addEvent=function(elem){if(typeof elem==="string")elem=document.getElementById(elem);if(elem)events.forEach(function(eventName){if(elem.addEventListener!=undefined)elem.addEventListener(eventName,delegHandler,
evtAttr||false);else elem.attachEvent(eventName,delegHandler,evtAttr||false)})};if(element instanceof Array||element instanceof NodeList)for(var i=0,t=element.length;i<t;i++)_addEvent(element[i]);else _addEvent(element)}}function removeEvent(element,events,delegHandler,evtAttr){if(element){if(!(events instanceof Array))events=[events];events=normalizeEventsName(events);var _removeEvent=function(elem){if(typeof elem==="string")elem=document.getElementById(elem);if(elem)events.forEach(function(eventName){if(elem.removeEventListener!=
undefined)elem.removeEventListener(eventName,delegHandler,evtAttr||false);else elem.detachEvent(eventName,delegHandler,evtAttr||false)})};if(element instanceof Array||element instanceof NodeList)for(var i=0,t=element.length;i<t;i++)_removeEvent(element[i]);else _removeEvent(element)}}function triggerEvent(element,event,args){var customEvent=null;event=normalizeEventName(event);if(window.CustomEvent)try{element.dispatchEvent(new window.CustomEvent(event,args))}catch(e){GLOBAL_VAR["class"]["privateREF#"]["console"].error(e.message,
e,arguments)}else{customEvent=document.createEventObject();customEvent.eventType=event;element.fireEvent(event,customEvent)}customEvent=null;return element}function normalizeEventsName(events){for(var i=0,t=events.length;i<t;i++)events[i]=normalizeEventName(events[i]);return events}function normalizeEventName(event){event=event.trim();var hasOn=event.substr(0,2)=="on";if(_useOn&&!hasOn)event="on"+event;else if(hasOn&&!_useOn)event=event.substring(2,event.length);hasOn=null;return event}window.document.onreadystatechange=
function(){var rn=document.readyState;var rs=convertStateToInt(rn);if(_domStateEvents.lastState<rs)for(var i=0;i<rs;i++)fireStateEvent(_domStateEvents.order[i]);_domStateEvents.lastState=rs;fireStateEvent(rn)};function convertStateToInt(rs){return _domStateEvents.order.indexOf(rs)}function documentLoading(callback){var en="loading";_domStateEvents.handlers[en].push(callback);checkDocumenEvent(en)}function documentInteractive(callback){var en="interactive";_domStateEvents.handlers[en].push(callback);
checkDocumenEvent(en)}function documentComplete(callback){var en="complete";_domStateEvents.handlers[en].push(callback);checkDocumenEvent(en)}function checkDocumenEvent(rs){if(convertStateToInt(rs)<=_domStateEvents.lastState)fireStateEvent(rs)}function fireStateEvent(name){if(_domStateEvents.handlers[name].length>0)while(_domStateEvents.handlers[name].length>0)try{_domStateEvents.handlers[name].shift()({"current":document.readyState,"eventName":name})}catch(error){if(GLOBAL_VAR.console.logError)console.log(error.message+
"\r\n"+error.stack)}}function loadScript(url,success,error){var script=document.createElement("script");script.type="text/javascript";script.onload=success;script.onerror=error;script.src=url;document.head.appendChild(script)}function loadFile(url){return new Promise(function(resolve,reject){var script=document.createElement("script");script.type="text/javascript";script.onload=resolve;script.onerror=reject;script.src=url;document.head.appendChild(script)})}function fillElements(elems){if(elems){var elem=
null,name=null;for(var kvp in elems){name=elems[kvp];if(!name||name==="")name=kvp;elem=document.getElementById(name);if(!elem){elem=document.getElementsByClassName(name);if(elem.length>0)elem=elem[0]}elems[kvp]=elem}}}function decodeText(value){var _auxTextArea=document.createElement("textarea");_auxTextArea.innerHTML=value;return _auxTextArea.value}Object.defineProperty(this,"byId",{"enumerable":false,"configurable":false,"writable":false,"value":byId});Object.defineProperty(this,"createElement",
{"enumerable":false,"configurable":false,"writable":false,"value":createElement});Object.defineProperty(this,"appendElement",{"enumerable":false,"configurable":false,"writable":false,"value":appendElement});Object.defineProperty(this,"prependElement",{"enumerable":false,"configurable":false,"writable":false,"value":prependElement});Object.defineProperty(this,"addEvent",{"enumerable":false,"configurable":false,"writable":false,"value":addEvent});Object.defineProperty(this,"removeEvent",{"enumerable":false,
"configurable":false,"writable":false,"value":removeEvent});Object.defineProperty(this,"triggerEvent",{"enumerable":false,"configurable":false,"writable":false,"value":triggerEvent});Object.defineProperty(this,"createJsonElement",{"enumerable":false,"configurable":false,"writable":false,"value":createJsonElement});Object.defineProperty(this,"appendJsonElement",{"enumerable":false,"configurable":false,"writable":false,"value":appendJsonElement});Object.defineProperty(this,"prependJsonElement",{"enumerable":false,
"configurable":false,"writable":false,"value":prependJsonElement});Object.defineProperty(this,"loading",{"enumerable":false,"configurable":false,"writable":false,"value":function(callback){return documentLoading(callback)}});Object.defineProperty(this,"interactive",{"enumerable":false,"configurable":false,"writable":false,"value":function(callback){return documentInteractive(callback)}});Object.defineProperty(this,"ready",{"enumerable":false,"configurable":false,"writable":false,"value":function(callback){return documentComplete(callback)}});
Object.defineProperty(this,"complete",{"enumerable":false,"configurable":false,"writable":false,"value":function(callback){return documentComplete(callback)}});Object.defineProperty(this,"loadScript",{"enumerable":false,"configurable":false,"writable":false,"value":function(url,success,error){return loadScript(url,success,error)}});Object.defineProperty(this,"loadFile",{"enumerable":false,"configurable":false,"writable":false,"value":function(url){return loadFile(url)}});Object.defineProperty(this,
"fillElements",{"enumerable":false,"configurable":false,"writable":false,"value":function(elems){return fillElements(elems)}});Object.defineProperty(this,"decodeText",{"enumerable":false,"configurable":false,"writable":false,"value":function(value){return decodeText(value)}});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function ObjectExtend(){var _className=
getFunctionName(arguments);var _REEvalFnRetrieve=/function/ig;function EnumeratorClass(){var _self=this;var _keys=[];var _ikeys={};var _values={};function initialize(values){if(typeof values[0]=="string")for(var v in values)addEnumValue(values[v],parseInt(v));else{var jsonDef=values[0];for(var key in jsonDef)addEnumValue(key,jsonDef[key]);jsonDef=null}}function addEnumValue(key,value){_keys.push(key);_ikeys[value]=key;if(_self[key]==undefined){_values[key]=value;Object.defineProperty(_self,key,{"enumerable":true,
"configurable":false,"get":function(){return _values[key]}})}}function hasValue(value){return Object.values(_self).indexOf(value)!=-1}function getKey(value){return _ikeys[value]}function toArray(){return _keys}if(arguments&&arguments.length>0)initialize(arguments[0]);else throw new Error("Cannot define new enum without arguments");Object.defineProperty(_self,"hasValue",{"enumerable":false,"configurable":false,"writable":false,"value":hasValue});Object.defineProperty(_self,"getKey",{"enumerable":false,
"configurable":false,"writable":false,"value":getKey});Object.defineProperty(_self,"toArray",{"enumerable":false,"configurable":false,"writable":false,"value":toArray});return Object.freeze?Object.freeze(_self):_self}function convertTo(value,type){try{type=type.toLowerCase();switch(type){case "number":case "float":value=parseFloat(value);break;case "integer":case "int":value=parseInt(value,10);break;case "datetime":case "date":case "time":value=new Date(value);break;case "json":value=JSON.parse(value);
break;case "string":value=value.toString();break;case "bool":case "boolean":if(typeof value=="string"&&["0","1"].indexOf(value)!=-1||typeof value=="number"&&value>=0&&value<=1)value=toBoolean(value);break;case "array":value=toArray(value);break;case "object":break;case "hexadecimal":value=toHexadecimal(value);break}}catch(error){helper.console.error(error.message,error,arguments)}return value}function isObject(elem){if(elem instanceof Object)if(elem instanceof Function||elem instanceof Array||elem instanceof
Date||elem instanceof String)return false;else return true;else return false}function isArray(array){try{if(array!=null&&array!=undefined&&array.hasOwnProperty("length")&&array instanceof Array)return true;else return Array.isArray(array)}catch(error){return false}}function isBoolean(value){if(value!=null)if(value==1||value==0)return true;else if(value.toString().toUpperCase()=="TRUE"||value.toString().toUpperCase()=="FALSE")return true;else if(typeof value=="boolean")return true;else return false;
else return false}function isNumber(n){if(n==undefined||n==null)return false;else return!isNaN(parseFloat(n))&&isFinite(n)&&n-parseFloat(n)+1>=0}var _HTMLElements=["HTMLDocument","HTMLBodyElement","HTMLAnchorElement","HTMLDivElement","HTMLIFrameElement","HTMLFrameElement","HTMLElement","HTMLImageElement","HTMLInputElement","HTMLFormElement","HTMLHeadElement","HTMLTableElement","HTMLCanvasElement","HTMLScriptElement","HTMLParagraphElement","HTMLSpanElement","HTMLStyleElement","HTMLHtmlElement","HTMLParamElement",
"HTMLPhraseElement","HTMLSelectElement","HTMLTableCaptionElement","HTMLTableCellElement","HTMLTableColElement","HTMLTableDataCellElement","HTMLTableHeaderCellElement","HTMLTableRowElement","HTMLTableSectionElement","HTMLTextAreaElement","HTMLAppletElement","HTMLAreaElement","HTMLAreasCollection","HTMLAudioElement","HTMLBaseElement","HTMLBaseFontElement","HTMLBGSoundElement","HTMLBlockElement","HTMLBRElement","HTMLButtonElement","HTMLCollection","HTMLDataListElement","HTMLDDElement","HTMLDirectoryElement",
"HTMLDListElement","HTMLDTElement","HTMLEmbedElement","HTMLFieldSetElement","HTMLFontElement","HTMLFrameSetElement","HTMLHeadingElement","HTMLHRElement","HTMLIsIndexElement","HTMLLabelElement","HTMLLegendElement","HTMLLIElement","HTMLLinkElement","HTMLMapElement","HTMLMarqueeElement","HTMLMediaElement","HTMLMenuElement","HTMLMetaElement","HTMLModElement","HTMLNextIdElement","HTMLObjectElement","HTMLOListElement","HTMLOptGroupElement","HTMLOptionElement","HTMLPreElement","HTMLProgressElement","HTMLQuoteElement",
"HTMLSourceElement","HTMLTitleElement","HTMLTrackElement","HTMLUListElement","HTMLUnknownElement","HTMLVideoElement"];var _nodeTypes={1:"ELEMENT_NODE",2:"ATTRIBUTE_NODE",3:"TEXT_NODE",4:"CDATA_SECTION_NODE",5:"ENTITY_REFERENCE_NODE",6:"ENTITY_NODE",7:"PROCESSING_INSTRUCTION_NODE",8:"COMMENT_NODE",9:"DOCUMENT_NODE",10:"DOCUMENT_TYPE_NODE",11:"DOCUMENT_FRAGMENT_NODE",12:"NOTATION_NODE"};function getTypeOfHTMLElement(elem){if(elem&&elem.nodeType&&elem.nodeName){var elemType=null;for(var i=0,t=_HTMLElements.length;i<
t;i++){elemType=_HTMLElements[i];if(window[elemType]&&elem instanceof window[elemType])return elemType}return getTypeOfNode(elem)||"HTMLElement"}else if(isWindowElem(elem))return"window";else return null}function getTypeOfNode(elem){if(elem&&elem.nodeType){for(var k in Node)if(elem.nodeType===Node[k])return _nodeTypes[elem.nodeType];return null}else return null}function isWindowElem(elem){if(elem){var cname=elem.constructor?elem.constructor.toString().toLowerCase():"";if(cname.indexOf("window")!=
-1)return true;else return elem.location&&elem.navigator&&elem.document&&getTypeOfHTMLElement(elem.document)==="HTMLDocument"}return false}function getTypeOf(elem){var t=null;try{if(elem!==null&&elem!==undefined)if(elem instanceof Function)return"function";else if(typeof elem=="object"){if(elem instanceof Date)return"date";else if(isArray(elem))return"array";else if(elem instanceof HTMLElement||elem.nodeType&&elem.nodeName)return"HTMLElement";else if(isWindowElem(elem))return"window";if(t!=null)return t;
else return elem.constructor&&elem.constructor.name?elem.constructor.name.toLowerCase():"object"}else if(typeof elem=="number"||isNumber(elem))return"number";else return(typeof elem).toString();else return elem===null?"null":"undefined"}catch(Error){return false}}function getDataTypeOf(value){var type=getTypeOf(value);function isJSON(value){try{if(value){if(typeof value=="string")JSON.parse(value);else if(typeof value=="object")JSON.stringify(value);return true}else return false}catch(error){return false}}
switch(type){case "function":case "array":case "datetime":break;case "number":type=value%1===0?"integer":"float";break;case "boolean":break;case "object":type=isJSON(value)==true?"json":type;break;case "string":function isHexadecimal(value){var pattern=/[A-Fa-f0-9]*/;var reg=new RegExp(pattern);var ret=reg.exec(value)[0].toString();if(ret.length==value.toString().length)return true;else return false}type=isHexadecimal(value)==true?"hexadecimal":type;if(type!="hexadecimal"){type=isBoolean(value)==
true?"boolean":type;if(type!="boolean")if(value.substr(0,1)=="{"&&value.substr(value.length-1,1)=="}")type=isJSON(value)==true?"json":type}break;case "HTMLCollection":case "HTMLElement":case "window":break;default:type=value==null?"null":typeof value;break}return type}function toBoolean(value){if(isNumber(value))if(value==1)return true;else return false;else if(typeof value=="boolean")return value;else if(typeof value=="string")if(value.toUpperCase().indexOf("TRUE")!=-1)return true;else return false;
else return false}function toArray(value){if(value==null||value=="")return[];else if(value instanceof Array)return value;else if(value instanceof String)if(value.indexOf(";")!=-1)return value.split(";");else return value.split(",");else return[value]}function toHexadecimal(value){if(value!=undefined&&value!=null){var hex="";for(var i=0;i<value.length;i++)hex+=""+value.charCodeAt(i).toString(16);return hex}else return null}function checkPath(obj,path){if(path.length==0&&obj!=null&&obj!=undefined)return true;
else if(obj!=null&&obj!=undefined&&obj[path[0]]!=null&&obj[path[0]]!=undefined){var remain=path.splice(0,1);return checkPath(obj[remain],path)}else return false}function existsPath(obj,path,separatorOpt){if(obj!=undefined&&path!=null&&path!=""){var finalPath=path.replace(/\[/g,".").replace(/\]/g,"");if(finalPath.substr(0,1)==".")finalPath=finalPath.substr(1,finalPath.length);if(finalPath.substr(finalPath.length-1,1)==".")finalPath=finalPath.substr(0,finalPath.length-1);var pathArray=finalPath.split(".");
return checkPath(obj,pathArray)}else return false}function getObjectValue(obj,path){try{if(path.length==0)return obj;else if(obj!=null&&obj!=undefined){var remain=path.splice(0,1);return getObjectValue(obj[remain],path)}else return null}catch(error){return null}}function generatePath(obj){var response=[];function _generatePath(obj,path){var fPath=path!=""?path+".":"";for(var attrib in obj)switch(getTypeOf(obj[attrib])){case "object":response.push(fPath+attrib);_generatePath(obj[attrib],fPath+attrib);
break;case "array":response.push(fPath+attrib);for(var i=0;i<obj[attrib].length;i++)switch(getTypeOf(obj[attrib][i])){case "object":case "array":_generatePath(obj[attrib][i],fPath+attrib+"["+i.toString()+"]");break;default:response.push(fPath+attrib+"["+i.toString()+"]");break}break;default:response.push(fPath+attrib);break}}_generatePath(obj,"");return response}function checkPathValue(obj,path,value,separatorOpt){if(obj!=undefined&&path!=null&&path!=""){var finalPath=path.replace(/\[/g,".").replace(/\]/g,
"");if(finalPath.substr(0,1)==".")finalPath=finalPath.substr(1,finalPath.length);if(finalPath.substr(finalPath.length-1,1)==".")finalPath=finalPath.substr(0,finalPath.length-1);var pathArray=finalPath.split(".");var validPaths=generatePath(obj);return validPaths.indexOf(path)!=-1&&getObjectValue(obj,pathArray)==value}else return false}function hasPath(obj,path){if(obj!=undefined&&path!=null&&path!=""){var validPaths=generatePath(obj);return validPaths.indexOf(path)!=-1}else return false}function validateTypeOf(value,
type,restricted){var isValid=false;restricted=restricted==undefined?false:restricted;type=type.toLowerCase();var foundType=getDataTypeOf(value);var rules={"float":{"types":["float","double","real"],"exceptions":[{"types":["integer"],"match":function(value){return!restricted?"float":""}}]},"hexadecimal":{"types":["hexadecimal","hexa","hex"]},"integer":{"types":["integer","int"]},"boolean":{"types":["boolean","bool"],"exceptions":[{"types":["integer","number"],"range":{"min":0,"max":1}},{"types":["string"],
"equalTo":["true","false"]}]},"function":{"types":["function","func","void","procedure"]},"string":{"types":["string","str"],"exceptions":[{"types":["*"],"match":function(value){return typeof value}}]},"datetime":{"types":["datetime","date","time"]},"array":{"types":["array"]},"object":{"types":["object","obj"]},"json":{"types":["json"]}};if(type=="string"&&foundType=="json"&&typeof value=="string")return true;var fnFindRule=function(r){if(r&&rules[r])return rules[r];else for(var n in rules)if(rules[n].types.indexOf(r)!=
-1)return rules[n];return null};var fnVerifyRule=function(r){r=fnFindRule(r);if(!r)return false;if(r.types.indexOf(foundType)!=-1)if(!restricted)return true;else return typeof value==type;else{if(r.exceptions)for(var i=0;i<r.exceptions.length;i++){var exc=r.exceptions[i];if(exc.types.length==1&&exc.types[0]=="*"||exc.types.indexOf(foundType)!=-1)if(exc.range&&exc.range.min<=value&&value<=exc.range.max&&(!restricted||typeof value==type))return true;else if(exc.equalTo&&exc.equalTo.indexOf(value)!=
-1&&(!restricted||typeof value==type))return true;else if(exc.match&&exc.match(value)==type&&(!restricted||typeof value==type))return true}return false}};return fnVerifyRule(type)}function isDOMNode(obj){if(obj==null)return false;return obj instanceof Object&&typeof obj.outerHTML!="undefined"||typeof obj==="object"&&obj.nodeType===1&&typeof obj.style==="object"&&typeof obj.ownerDocument==="object"}function parseByMatched(attributes,target){try{if(attributes!=null&&attributes!=undefined&&target!=null&&
target!=undefined){var ar=getArrayAttributesFromObject(attributes,[],"",1);for(var i=0;i<ar.length;i++)if(target.hasOwnProperty([ar[i]])){var origPath=ar[i];if(target[origPath]){if(target[origPath]!==attributes[origPath])if(target[origPath]instanceof Window||isDOMNode(target[origPath]))target[origPath]=attributes[origPath];else if(attributes[origPath]&&(attributes[origPath]instanceof Array||attributes[origPath].constructor&&attributes[origPath].constructor.name=="Array"))target[origPath]=attributes[origPath];
else if((!attributes[origPath].constructor||attributes[origPath].constructor.name==="Object")&&(target[origPath]instanceof Object||(target[origPath].constructor&&target[origPath].constructor.name=="Object"||GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(target[origPath])==="object")))parseByMatched(attributes[origPath],target[origPath]);else target[origPath]=attributes[origPath]}else target[origPath]=attributes[origPath]}}}catch(error){return error}return target}function getArrayAttributesFromObject(attributes,
array,base,deep){if(deep==undefined)deep=-1;return getArrayAttributesFromObjectInternal(attributes,array,base,deep,0)}function getArrayAttributesFromObjectInternal(attributes,array,base,deep,count){try{if(attributes)for(var attr in attributes){var type="string";if(attributes[attr]!=null){try{if(attributes[attr]&&attributes[attr].window&&attributes[attr].window===attributes[attr].frames)type="window";else if(attributes[attr].nodeType==undefined||attributes[attr].nodeType==null||typeof attributes[attr].nodeType!=
"number")type=typeof attributes[attr]}catch(error){type="unknown"}switch(type){case "object":if(attributes.length==undefined)array.push(base+attr);if(deep==-1||deep<=count)getArrayAttributesFromObjectInternal(attributes[attr],array,base+attr+".",deep,count);break;case "window":default:array.push(base+attr);break}}}}catch(error){return error}return array}function getAttribute(prop,source){try{var str="";if(prop&&source)for(var attr in source)if(attr.toUpperCase()==prop.toUpperCase())return str+="['"+
attr+"']";else{var type="string";if(source[attr]!=null&&(source[attr].nodeType==undefined||source[attr].nodeType==null||typeof source[attr].nodeType!="number"))type=typeof source[attr];switch(type){case "object":var name=getAttribute(prop,source[attr]);if(name!="")return str+="['"+attr+"']"+name;break;case "function":case "number":case "string":case "boolean":default:break}}}catch(error){return error}return str}function clone(obj){try{if(obj==null||typeof obj!="object")return obj;else if(typeof obj==
"object"&&obj.nodeType!=undefined&&obj.nodeType==1)return obj;else if(obj.scopeName&&obj.scopeName=="HTML"&&obj.document&&obj.document.mimeType&&obj.document.mimeType.indexOf("HTML")!=-1)return obj;else{var temp;if(obj instanceof Date)temp=obj;else{try{temp=new obj.constructor}catch(Error){temp={}}for(var key in obj)if(key.substring(0,1)=="#")temp[key]=obj[key];else temp[key]=clone(obj[key])}return temp}}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].log("Cannot clone this object. ["+
JSON.stringify(obj)+"]");return obj}}function evaluate(obj,path,separator){if(obj!=undefined&&path!=null&&path!=""){if(separator==undefined||separator==""||separator==null)separator=".";var spl=path.toString().split(separator);var cValue=obj;for(var prop in spl){spl[prop]=spl[prop].replace(/\[|\]/g,"");if(typeof cValue!="string"&&cValue[spl[prop]]!=undefined){cValue=cValue[spl[prop]];if(spl[prop]==spl[spl.length-1])return cValue!=undefined&&cValue!=null?true:false}else return false}return false}else return false}
function evalExists(obj,path,separator){if(obj!=undefined&&path!=null&&path!=""){if(separator==undefined||separator==""||separator==null)separator=".";var spl=path.toString().split(separator);var cValue=obj;for(var prop in spl){spl[prop]=spl[prop].replace(/\[|\]/g,"");if(typeof cValue!="string"&&typeof cValue[spl[prop]]!="undefined"){cValue=cValue[spl[prop]];if(spl[prop]==spl[spl.length-1])return typeof cValue!="undefined"?true:false}else return false}return false}else return false}function getObjectKeyCaseInsensitive(obj,
key){const lc=key.toLowerCase();return Object.keys(obj).find(k=>k.toLowerCase()===lc)}function getValue(obj,path,defaultResponse,options){if(obj!=undefined&&path!=null&&path!=""){path=path.toString().replace(/\[/g,".").replace(/\[|\]/g,"");if(path[0]==".")path=path.substr(1,path.length);var spl=path.split(".");var cValue=obj;let ig=options&&options.ignoreCase;let len=spl.length;let last=spl[len-1];let prop=null;let oProp=null;for(let i=0,t=len;i<t;i++){prop=oProp=spl[i];if(ig===true)prop=getObjectKeyCaseInsensitive(cValue,
oProp);if(prop&&cValue[prop]!=undefined){cValue=cValue[prop];if(oProp==last)return cValue!=undefined?cValue:typeof defaultResponse!="undefined"?defaultResponse:undefined;let to=typeof cValue;if(["string","number","boolean","function"].indexOf(typeof cValue)!=-1)return typeof defaultResponse!="undefined"?defaultResponse:undefined}else return typeof defaultResponse!="undefined"?defaultResponse:undefined}}return typeof defaultResponse!="undefined"?defaultResponse:undefined}function setValue(obj,path,
value,options={switchTypes:false}){if(path){if(!obj)obj={};path=path.toString().replace(/\[/g,".").replace(/\[|\]/g,"");if(path[0]==".")path=path.substr(1,path.length);var spl=path.split(".");var cValue=obj;var tObj=null;var l=spl.length;let idx=0,c=true;let prop=null;while(idx<l&&c){prop=spl[idx];if(cValue[prop]==undefined)if(["string","number","boolean","function"].indexOf(typeof cValue)!==-1)if(options.switchTypes){tObj[spl[idx-1]]={};cValue[prop]={}}else c=false;else cValue[prop]={};tObj=cValue;
cValue=cValue[prop];idx++}if(c)tObj[prop]=value}return obj}function deleteValue(obj,path){if(path){if(!obj)obj={};path=path.toString().replace(/\[/g,".").replace(/\[|\]/g,"");if(path[0]==".")path=path.substr(1,path.length);var spl=path.split(".");var cValue=obj;var tObj=null;var l=spl.length-1;for(var prop in spl)if(cValue[spl[prop]]==undefined)return obj;else{tObj=cValue;cValue=cValue[spl[prop]]}try{delete tObj[spl[prop]]}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].log("Cannot delete property ["+
ptath+"]. "+error.message)}}return obj}function validate(object){return typeof object!="undefined"&&object!=null}function extendObject(obj,attributes,extendArrays){try{if(validate(attributes)==true&&validate(obj)==false)obj={};obj=extendObjectAttributes(attributes,obj,typeof extendArrays!="boolean"?false:extendArrays);return obj}catch(error){return error.message}}function goOver(json,attributes){for(var prop in attributes)if(attributes[prop]instanceof Array&&json[prop]instanceof Array)for(var i=0;i<
attributes[prop].length;i++){if(typeof attributes[prop][i]=="object"||attributes[prop][i]instanceof Array)goOver(json[prop][i],attributes[prop][i])}else if(attributes[prop]instanceof Array&&typeof json[prop]=="undefined"){json[prop]={};json[prop]=clone(attributes[prop])}else if(typeof attributes[prop]=="object"){if(!json[prop])json[prop]={};goOver(json[prop],attributes[prop])}else if(typeof json[prop]!==typeof attributes[prop]){if(!evalExists(json,prop))json[prop]=clone(attributes[prop])}else if(typeof json[prop]==
"undefined")json[prop]=undefined}function jsonsBalance(json1,json2){try{if(validate(json1)&&validate(json2)){if(json1===json2)return;goOver(json1,json2);goOver(json2,json1);return}}catch(error){return error.message}}function compareJsonBranches(json1,json2){try{if(validate(json1)&&validate(json2)){if(json1===json2)return;var paths1=generatePath(json1);var paths2=generatePath(json2);if(paths1 instanceof Array&&paths2 instanceof Array&&paths1.length==paths2.length){paths1=paths1.sort();paths2=paths2.sort();
for(var i=0;i<paths1.length;i++)if(paths1[i]!=paths2[i])return false;return true}else return false}else return false}catch(error){console.log(error.message);return false}}function extendObjectAttributes(source,target,extendArrays){try{if(source==target)return target;if(target==null)target={};if(source instanceof Array&&!extendArrays)target=clone(source);else for(var prop in source)if(source[prop]instanceof Array)if(extendArrays&&target[prop]instanceof Array)for(var a=0;a<source[prop].length;a++){var idx=
target[prop].indexOf(source[prop][a]);if(idx==-1)try{target[prop].push(clone(source[prop][a]))}catch(e){console.warning(e.message+"  - Assigning target directly");target[prop]=source[prop]}else extendObjectAttributes(source[prop][idx],target[prop][a],extendArrays)}else target[prop]=source[prop];else if(source[prop]instanceof Window||isDOMNode(source[prop]))target[prop]=source[prop];else if(typeof source[prop]!="object")target[prop]=source[prop];else{if(target[prop]===undefined)target[prop]=null;target[prop]=
extendObjectAttributes(source[prop],target[prop],extendArrays)}return target}catch(error){return error.message}}function merge(source,target,override){try{if(source==target)return target;if(target==null){target=clone(source);return target}for(var prop in source)if(typeof source[prop]!="object"||source[prop]instanceof Array){if(target[prop]===undefined||override||override==undefined)target[prop]=source[prop]}else if(source[prop]instanceof Window||isDOMNode(source[prop]))target[prop]=source[prop];else{if(target[prop]===
undefined)target[prop]=null;target[prop]=merge(source[prop],target[prop],override)}return target}catch(error){return error.message}}function applyAttributes(source,attributes){try{if(source==attributes)return source;if(source==null)return source;for(var prop in source)if(typeof source[prop]!="object"||source[prop]instanceof Array){if(attributes[prop]!=undefined)source[prop]=attributes[prop]}else if(attributes[prop]instanceof Window||isDOMNode(attributes[prop]))source[prop]=attributes[prop];else if(attributes[prop]!=
undefined)source[prop]=applyAttributes(source[prop],attributes[prop]);return source}catch(error){return error.message}}function setAttribute(elem,keyValueAttributes,deep){deep=isNumber(deep)?deep:0;var recursive=function(elem,keyValueAttributes,count){if(elem){for(var attrib in keyValueAttributes)if(elem.nodeType==1&&elem.setAttribute)elem.setAttribute(attrib,keyValueAttributes[attrib]);if(count<deep&&elem.childNodes&&elem.childNodes.length>0){count++;for(var i=0;i<elem.childNodes.length;i++)recursive(elem.childNodes[i],
keyValueAttributes,count)}}};recursive(elem,keyValueAttributes,0)}function equals(a,b){if(arguments.length>2&&getDataTypeOf(arguments[2])=="json")return equalsWithOptions.apply(null,arguments);try{var p;var tap;var i;if(a==null&&b==null)return true;if(a==null&&b!=null||b==null)return false;if(a==undefined&&b==undefined)return true;if(a==undefined&&b!=undefined||b==undefined)return false;for(p in a)if(typeof b[p]=="undefined"&&typeof a[p]!="undefined")return false;else{tap=typeof a[p];switch(tap){case "object":if(tap!=
typeof b[p])return false;else if(a[p]instanceof HTMLElement){if(a[p]!==b[p])return false}else{tap=getTypeOf(a[p]);if(tap!=getTypeOf(b[p]))return false;else switch(tap){case "date":if(a[p].getTime()!=b[p].getTime())return false;break;case "array":if(a[p].length!=b[p].length)return false;else for(i=0;i<a[p].length;i++)if(!equals(a[p][i],b[p][i]))return false;break;default:if(!equals(a[p],b[p]))return false}}break;case "function":if(a[p].toString()!=b[p].toString())return false;break;default:if(a[p]!=
b[p])return false}}for(p in b)if(typeof a[p]=="undefined"&&typeof b[p]!="undefined")return false;return true}catch(e){GLOBAL_VAR["class"]["privateREF#"]["console"].log("Error comparing data objects: "+e.message);return false}finally{i=tap=p=null}}function equalsWithOptions(a,b,options){let d=false;let ds=[];let r=false;d=options?.differencies?true:false;try{var p;var tap;var i;if(a==null&&b==null)return true;if(a==null&&b!=null||b==null){if(!d)return r;ds.push("A is null")}if(a==undefined&&b==undefined)return true;
if(a==undefined&&b!=undefined||b==undefined){if(!d)return r;ds.push("A or B is undefined")}for(p in a)if(typeof b[p]=="undefined"&&typeof a[p]!="undefined"){if(!d)return r;ds.push(`B property is undefined prop: "${p}"`)}else{tap=typeof a[p];switch(tap){case "object":if(tap!=typeof b[p]){if(!d)return r;ds.push(`B prop: "${p}", is not a type of 'Object'`)}else if(a[p]instanceof HTMLElement){if(a[p]!==b[p]){if(!d)return r;ds.push(`B prop: "${p}", is not a type of 'HTMLElement'`)}}else{tap=getTypeOf(a[p]);
if(tap!=getTypeOf(b[p])){if(!d)return r;ds.push(`A prop: "${p}", type: "${tap}", is not the same that property B, type: "${getTypeOf(b[p])}"`)}else switch(tap){case "date":if(a[p].getTime()!=b[p].getTime()){if(!d)return r;ds.push(`Property value of A is different than B, prop: "${p}"`)}break;case "array":if(a[p].length!=b[p].length){if(!d)return r;ds.push(`Arrays have differents length, prop: "${p}",  A:${a[p].length}, B:"${b[p].length}"`)}else for(i=0;i<a[p].length;i++){let eq=equalsWithOptions(a[p][i],
b[p][i],options);if(eq!==true){if(!d)return r;ds=ds.concat(eq)}}break;default:let eq=equalsWithOptions(a[p],b[p],options);if(eq!==true){if(!d)return r;ds=ds.concat(eq)}}}break;case "function":if(a[p].toString()!=b[p].toString()){if(!d)return r;ds.push(`B Prop: "${p}" is not a "function"`)}break;default:if(a[p]!=b[p]){if(!d)return r;ds.push(`Prop: "${p}" is not equal`)}}}for(p in b)if(typeof a[p]=="undefined"&&typeof b[p]!="undefined"){if(!d)return r;ds.push(`Prop: "${p}" is undefined in A object, but exists in B object`)}if(!r)r=
d&&ds.length==0||!d?true:false}catch(e){let msg=`Error comparing data objects: ${e.message}`;GLOBAL_VAR["class"]["privateREF#"]["console"].log(msg);if(!d)return r;ds.push(msg);r=false}finally{i=tap=p=null}return r?r:d?ds:false}function toNumber(value,options){if(typeof options=="undefined")options={"type":"int","base":10,"defaultValue":null};else{options.type=typeof options.type!="undefined"?options.type.toLowerCase():"int";if(typeof options.base=="undefined")options.base=10;if(typeof options.defaultValue==
"undefined")options.defaultValue=null}if(isNumber(value))if(options.type=="int"||options.type=="integer")return parseInt(value,options.value);else return parseFloat(value);else if(typeof defaultValue!="undefined")return defaultValue;return value}function createEnum(){return new EnumeratorClass(arguments)}function evalObject(textScript,scope){if(getDataTypeOf(textScript)==="json")return JSON.parse(textScript);else if(!textScript.match(_REEvalFnRetrieve))return window[textScript];else{var script=document.createElement("script");
script.type="text/javascript";script.text=textScript;if(scope)scope.appendChild(script);else document.body.appendChild(script);window.setTimeout(function(){document.body.removeChild(script)},10)}}function createFunctionFromStr(params,strFn){if(params instanceof Array)params.push(strFn);return Function.apply(this,params)}function jsonToArray(json){var result=[];return Object.keys(json)}function jsonToString(jsonObj,firstParams,encode){var str="";var encFn=encode===true?encodeURIComponent:function(value){return value};
firstParams=firstParams===true?"?":firstParams===false?"&":typeof firstParams!="undefined"?firstParams:"&";for(var kvp in jsonObj){str+=firstParams+kvp+"="+encFn(jsonObj[kvp]);firstParams="&"}return str}function jsonMap(target,source,map,options={useBothKey:true,removeChildren:true}){if(!target)return null;if(source&&map)if(getDataTypeOf(map)=="json")for(let kvp in map){let values=map[kvp];if(!(values instanceof Array))values=[values];if(options.useBothKey)values=[kvp].concat(values);if(values){let propValue=
null;let idx=0,len=values.length;while(!propValue&&idx<len&&propValue==undefined){propValue=getValue(source,values[idx],undefined);if(propValue==undefined)propValue=source[values[idx]];idx++}if(propValue!=undefined)if(typeof target[kvp]==="object"&&typeof propValue==="object")merge(propValue,target[kvp],true);else setValue(target,kvp,propValue)}}else throw new Error(`Map object is not a JSON Object`);return target}Object.defineProperty(this,"getTypeOf",{"enumerable":false,"configurable":false,"writable":false,
"value":getTypeOf});Object.defineProperty(this,"getDataTypeOf",{"enumerable":false,"configurable":false,"writable":false,"value":getDataTypeOf});Object.defineProperty(this,"validateTypeOf",{"enumerable":false,"configurable":false,"writable":false,"value":validateTypeOf});Object.defineProperty(this,"getHTMLType",{"enumerable":false,"configurable":false,"writable":false,"value":getTypeOfHTMLElement});Object.defineProperty(this,"getTypeOfNode",{"enumerable":false,"configurable":false,"writable":false,
"value":getTypeOfNode});Object.defineProperty(this,"validate",{"enumerable":false,"configurable":false,"writable":false,"value":validate});Object.defineProperty(this,"convertTo",{"enumerable":false,"configurable":false,"writable":false,"value":convertTo});Object.defineProperty(this,"toNumber",{"enumerable":false,"configurable":false,"writable":false,"value":toNumber});Object.defineProperty(this,"isNumber",{"enumerable":false,"configurable":false,"writable":false,"value":isNumber});Object.defineProperty(this,
"existPath",{"enumerable":false,"configurable":false,"writable":false,"value":existsPath});Object.defineProperty(this,"existsPath",{"enumerable":false,"configurable":false,"writable":false,"value":existsPath});Object.defineProperty(this,"getValue",{"enumerable":false,"configurable":false,"writable":false,"value":getValue});Object.defineProperty(this,"setValue",{"enumerable":false,"configurable":false,"writable":false,"value":setValue});Object.defineProperty(this,"deleteValue",{"enumerable":false,
"configurable":false,"writable":false,"value":deleteValue});Object.defineProperty(this,"parseAttributes",{"enumerable":false,"configurable":false,"writable":false,"value":function(target,attributes){return parseByMatched(attributes,target)}});Object.defineProperty(this,"extend",{"enumerable":false,"configurable":false,"writable":false,"value":extendObject});Object.defineProperty(this,"jsonsBalance",{"enumerable":false,"configurable":false,"writable":false,"value":jsonsBalance});Object.defineProperty(this,
"jsonMap",{"enumerable":false,"configurable":false,"writable":false,"value":jsonMap});Object.defineProperty(this,"compareJsonBranches",{"enumerable":false,"configurable":false,"writable":false,"value":compareJsonBranches});Object.defineProperty(this,"merge",{"enumerable":false,"configurable":false,"writable":false,"value":merge});Object.defineProperty(this,"applyAttributes",{"enumerable":false,"configurable":false,"writable":false,"value":applyAttributes});Object.defineProperty(this,"clone",{"enumerable":false,
"configurable":false,"writable":false,"value":clone});Object.defineProperty(this,"evaluate",{"enumerable":false,"configurable":false,"writable":false,"value":evaluate});Object.defineProperty(this,"exist",{"enumerable":false,"configurable":false,"writable":false,"value":evalExists});Object.defineProperty(this,"exists",{"enumerable":false,"configurable":false,"writable":false,"value":evalExists});Object.defineProperty(this,"setAttribute",{"enumerable":false,"configurable":false,"writable":false,"value":setAttribute});
Object.defineProperty(this,"equals",{"enumerable":false,"configurable":false,"writable":false,"value":equals});Object.defineProperty(this,"checkPathValue",{"enumerable":false,"configurable":false,"writable":false,"value":checkPathValue});Object.defineProperty(this,"hasPath",{"enumerable":false,"configurable":false,"writable":false,"value":hasPath});Object.defineProperty(this,"createEnum",{"enumerable":false,"configurable":false,"writable":false,"value":createEnum});Object.defineProperty(this,"eval",
{"enumerable":false,"configurable":false,"writable":false,"value":evalObject});Object.defineProperty(this,"createFunction",{"enumerable":false,"configurable":false,"writable":false,"value":createFunctionFromStr});Object.defineProperty(this,"jsonToArray",{"enumerable":false,"configurable":false,"writable":false,"value":jsonToArray});Object.defineProperty(this,"jsonToString",{"enumerable":false,"configurable":false,"writable":false,"value":jsonToString});Object.defineProperty(this,"getFunctionName",
{"enumerable":false,"configurable":false,"writable":false,"value":getFunctionName});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Polyfills(){var _className=getFunctionName(arguments);if(typeof window.btoa=="undefined"){var btoa=null;if(typeof window.Base64!="undefined"&&typeof window.Base64.encode!="undefined")btoa=Base64.encode;else if(typeof window.jQuery!=
"undefined"&&typeof window.jQuery.base64!="undefined"&&typeof window.jQuery.base64.encode!="undefined")btoa=jQuery.base64.encode;if(btoa!=null)Object.defineProperty(window,"btoa",{"enumerable":true,"writable":false,"configurable":false,"value":function(data){return btoa(data)}})}if(typeof window.crypto==="undefined")window.crypto=window.msCrypto;if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString())}
function Printer(){var _className=getFunctionName(arguments);function supportPrint(){var response=false;if(window.agentInfo)if(agentInfo.isWindows)switch(true){case agentInfo.isOpera:case agentInfo.isChrome:case agentInfo.isSafari:case agentInfo.isYandex:response=true;break;case agentInfo.isMSIE:case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:default:response=false;break}else if(agentInfo.isMac)switch(true){case agentInfo.isOpera:case agentInfo.isChrome:case agentInfo.isSafari:case agentInfo.isYandex:response=
true;break;case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:case agentInfo.isSymbian:default:response=false;break}else if(agentInfo.isIOS)switch(true){case agentInfo.isSafari:case agentInfo.isOpera:case agentInfo.isChrome:case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:case agentInfo.isSymbian:default:response=false;break}else if(agentInfo.isChromeOS)response=false;else if(agentInfo.isPlaybook)response=false;else if(agentInfo.isHPTablet)response=false;else if(agentInfo.isAndroid)response=
false;else if(agentInfo.isIphone)response=false;else response=false;else{helper.console.warning("AgentInfo class is not defined",arguments);response=false}return response}function supportPrintMethods(){var response={"PREVIEW":false,"DIRECT":false};if(window.agentInfo)if(agentInfo.isWindows)switch(true){case agentInfo.isChrome:case agentInfo.isFirefox:case agentInfo.isSafari:case agentInfo.isOpera:case agentInfo.isYandex:response.PREVIEW=true;response.DIRECT=true;break;case agentInfo.isMSIE:response.PREVIEW=
true;response.DIRECT=false;break;case agentInfo.isNokiaBrowser:default:response.PREVIEW=false;response.DIRECT=false;break}else if(agentInfo.isMac)switch(true){case agentInfo.isOpera:case agentInfo.isChrome:case agentInfo.isSafari:case agentInfo.isYandex:response.PREVIEW=true;response.DIRECT=true;break;case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:case agentInfo.isSymbian:default:response.PREVIEW=false;response.DIRECT=false;break}else if(agentInfo.isIOS)switch(true){case agentInfo.isSafari:if(agentInfo.ipadModel<=
2){response.PREVIEW=true;response.DIRECT=true}else if(agentInfo.ipadModel==3){response.PREVIEW=true;response.DIRECT=true}else{response.PREVIEW=true;response.DIRECT=false}break;case agentInfo.isChrome:response.PREVIEW=true;response.DIRECT=true;break;case agentInfo.isOpera:case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:case agentInfo.isSymbian:default:response.PREVIEW=false;response.DIRECT=false;break}else if(agentInfo.isChromeOS){response.PREVIEW=false;response.DIRECT=false}else if(agentInfo.isPlaybook){response.PREVIEW=
false;response.DIRECT=false}else if(agentInfo.isHPTablet){response.PREVIEW=false;response.DIRECT=false}else if(agentInfo.isAndroid){response.PREVIEW=true;response.DIRECT=true}else if(agentInfo.isIphone){response.PREVIEW=false;response.DIRECT=false}else{response.PREVIEW=false;response.DIRECT=false}else{helper.console.warning("AgentInfo class is not defined",arguments);response.PREVIEW=false;response.DIRECT=false}return response}Object.defineProperty(this,"supportPrint",{"enumerable":true,"configurable":false,
"get":function(){return supportPrint()}});Object.defineProperty(this,"printMethods",{"enumerable":true,"configurable":false,"get":function(){return supportPrintMethods()}});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Size(){var _className=getFunctionName(arguments);var _isMSIE=false;function round(value,decimals){var strValue;try{if(value!=null&&value!=
undefined&&(value!=""||value.toString()=="0")&&value.toString().toUpperCase()!="NAN"){strValue=parseFloat(value).toFixed(decimals);if(decimals==undefined||decimals==null||decimals==0)strValue=parseInt(strValue,10)}else strValue=""}catch(error){}return strValue}function isMSIE(){var userAgent=window.navigator.userAgent.toLowerCase();var isMSIE=false;var reg=/(msie) ([\w.]+)/.exec(userAgent);var ieTest=/(msie) ([0-9\.]+)/i.exec(userAgent);isMSIE=!!(ieTest&&ieTest[1]=="msie");if(!isMSIE&&userAgent.indexOf("trident")!=
-1&&/rv:([0-9\.]+)/i.exec(userAgent))isMSIE=true;return isMSIE}_isMSIE=isMSIE();function getCleanValue(value){var retValue=0;try{if(GLOBAL_VAR["class"]["privateREF#"]["object"]["isNumber"](value))retValue=parseFloat(value);else if(typeof(value=="string")){var exampleValue=round(1,2);var hasPoint=true;var re=new RegExp("[+-]?[0-9]*[.,][0-9]*|[+-]?[0-9]*");if(exampleValue.indexOf(",")!=-1)hasPoint=false;var regExpExec=re.exec(value);if(regExpExec!=null&&regExpExec[0]!=undefined&&regExpExec[0]!=""&&
regExpExec[0]!=null){var retValue=regExpExec[0];if(hasPoint)retValue=retValue.replace(",",".");else retValue=retValue.replace(".",",");retValue=parseFloat(retValue)}else retValue=value}else retValue=value}catch(error){retValue=value}return retValue}function getElementWidth(elem,includingMargin){var retValue=0;try{if(elem)if(elem.window&&elem.document&&elem.document.documentElement)retValue=elem.document.documentElement.clientWidth||elem.document.documentElement.offsetWidth;else if(window.getComputedStyle&&
elem.nodeType!=9&&window.getComputedStyle(elem,null)!=null){var tempWidth=window.getComputedStyle(elem,null).getPropertyValue("width");if(tempWidth.indexOf("px")>-1)retValue=getCleanValue(tempWidth);else if(tempWidth.indexOf("%")>-1)retValue=getElementWidth(elem.parentElement)*parseInt(getCleanValue(tempWidth),10)/100;else if(tempWidth.indexOf("auto")>-1)retValue=getElementWidth(elem.parentElement);else retValue=tempWidth}else if(elem.offsetWidth!=undefined&&elem.offsetWidth!=0)retValue=elem.offsetWidth;
else if(elem.clientWidth!=undefined&&elem.clientWidth!=0)retValue=elem.clientWidth;else if(_isMSIE==false&&elem.ownerDocument&&elem.ownerDocument.documentElement)retValue=elem.ownerDocument.documentElement.clientWidth||elem.ownerDocument.documentElement.offsetWidth;else if(elem.currentStyle)if(elem.currentStyle.width&&elem.currentStyle.width.indexOf("px")>-1)retValue=parseInt(elem.currentStyle.width.replace("px",""),10);else if(elem.currentStyle.width&&elem.currentStyle.width.indexOf("%")>-1)retValue=
getElementWidth(elem.parentElement)*parseInt(elem.currentStyle.width.replace("%",""),10)/100;else{if(elem.currentStyle.width&&elem.currentStyle.width.indexOf("auto")>-1)retValue=getElementWidth(elem.parentElement)}else if(elem.documentElement&&elem.documentElement.offsetWidth)retValue=elem.documentElement.offsetWidth;else if(elem.parentElement)retValue=getElementWidth(elem.parentElement);else retValue=0;else if(window.document.body.clientWidth!=undefined)retValue=window.document.body.clientWidth;
else if(window.document.body.offsetWidth!=undefined)retValue=window.document.body.offsetWidth;else retValue=MYREFERENCES.DefaultWidth;if(includingMargin===true){var css=window.getComputedStyle(elem,null);if(css){var ar=["marginLeft","marginRight","left","right"];for(var i=0;i<ar.length;i++){var rv=css[ar[i]];if(rv!="auto"&&rv!="")retValue+=parseFloat(getCleanValue(rv))}}}}catch(error){genericLog(error,arguments);retValue=0}return retValue}function getElementHeight(elem,includingMargin){var retValue=
0;try{if(elem)if(elem.window&&elem.document&&elem.document.documentElement)retValue=elem.document.documentElement.clientHeight||elem.document.documentElement.offsetHeight;else if(window.getComputedStyle&&elem.nodeType!=9&&window.getComputedStyle(elem,null)!=null){var tempHeight=window.getComputedStyle(elem,null).getPropertyValue("height");if(tempHeight.indexOf("px")>-1)retValue=getCleanValue(tempHeight);else if(tempHeight.indexOf("%")>-1)retValue=getElementHeight(elem.parentElement)*parseInt(getCleanValue(tempHeight),
10)/100;else if(tempHeight.indexOf("auto")>-1)retValue=getElementHeight(elem.parentElement);else retValue=tempHeight}else if(elem.offsetHeight!=undefined&&elem.offsetHeight!=0)retValue=elem.offsetHeight;else if(elem.clientHeight!=undefined&&elem.clientHeight!=0)retValue=elem.clientHeight;else if(_isMSIE==false&&elem.ownerDocument&&elem.ownerDocument.documentElement)retValue=elem.ownerDocument.documentElement.clientHeight||elem.ownerDocument.documentElement.offsetHeight;else if(elem.currentStyle)if(elem.currentStyle.height&&
elem.currentStyle.height.indexOf("px")>-1)retValue=parseInt(elem.currentStyle.height.replace("px",""),10);else if(elem.currentStyle.height&&elem.currentStyle.height.indexOf("%")>-1)retValue=getElementHeight(elem.parentElement)*parseInt(elem.currentStyle.height.replace("%",""),10)/100;else{if(elem.currentStyle.height&&elem.currentStyle.height.indexOf("auto")>-1)retValue=getElementHeight(elem.parentElement)}else if(elem.documentElement&&elem.documentElement.scrollHeight)retValue=elem.documentElement.scrollHeight;
else if(elem.parentElement)retValue=getElementHeight(elem.parentElement);else retValue=0;else if(window.document.body.clientHeight!=undefined)retValue=window.document.body.clientHeight;else if(window.document.body.offsetHeight!=undefined)retValue=window.document.body.offsetHeight;else retValue=MYREFERENCES.DefaultHeight;if(includingMargin===true){var css=window.getComputedStyle(elem,null);if(css){var ar=["marginTop","marginBottom","top","bottom"];for(var i=0;i<ar.length;i++){var rv=css[ar[i]];if(rv!=
"auto"&&rv!="")retValue+=parseFloat(getCleanValue(rv))}}}}catch(error){genericLog(error,arguments);retValue=0}return retValue}function getElementSize(elem,includingMargin){try{var _w;var _h;_w=getElementWidth(elem,includingMargin);_h=getElementHeight(elem,includingMargin);if(_w==undefined)_w=window.screen.width;if(_h==undefined)_h=window.screen.height;return{"width":_w,"height":_h}}catch(error){genericLog(error,arguments);return{"width":0,"height":0}}}Object.defineProperty(this,"getWidth",{"enumerable":true,
"configurable":false,"writable":false,"value":getElementWidth});Object.defineProperty(this,"getHeight",{"enumerable":true,"configurable":false,"writable":false,"value":getElementHeight});Object.defineProperty(this,"get",{"enumerable":true,"configurable":false,"writable":false,"value":getElementSize});Object.defineProperty(this,"cleanValue",{"enumerable":true,"configurable":false,"writable":false,"value":getCleanValue});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=
undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function SessionStorage(){var _className=getFunctionName(arguments);var _supportSessionStorage=true;function initialize(){try{_supportSessionStorage=window.sessionStorage?true:false}catch(error){_supportSessionStorage=false}}function get(key){var tempData=null;if(_supportSessionStorage){tempData=sessionStorage.getItem(key);if(tempData)try{tempData=JSON.parse(tempData)}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].error(error.message,
error,arguments);return error}}return tempData}function add(key,value){if(_supportSessionStorage&&key)try{sessionStorage.setItem(key,JSON.stringify(value))}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].error(error.message,error,arguments)}}function remove(key){if(_supportSessionStorage&&key)sessionStorage.removeItem(key)}function clear(){if(_supportSessionStorage)sessionStorage.clear()}initialize();Object.defineProperty(this,"get",{"enumerable":true,"configurable":false,"writable":false,
"value":get});Object.defineProperty(this,"set",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,"add",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,"remove",{"enumerable":true,"configurable":false,"writable":false,"value":remove});Object.defineProperty(this,"clear",{"enumerable":true,"configurable":false,"writable":false,"value":clear});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&
window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Storage(){var _className=getFunctionName(arguments);var _noop=function(){};var _supportLocalStorage=true;var _eventName="storage";var _handlers={};_handlers[_eventName]={};var _listening=false;function initialize(){try{_supportLocalStorage=window.localStorage?true:false;if(!_supportLocalStorage)_off=_on=clear=remove=add=get=_noop}catch(error){_supportLocalStorage=false}}
function get(key){var tempData=null;tempData=localStorage.getItem(key);if(tempData)try{tempData=JSON.parse(tempData)}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].error(error.message,error,arguments);return error}return tempData}function add(key,value){if(key)try{return localStorage.setItem(key,JSON.stringify(value))}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].error(error.message,error,arguments)}}function remove(key){if(key)return localStorage.removeItem(key)}function clear(){return localStorage.clear()}
function on(key,handler){if(key&&handler)if(handler instanceof Function){if(!_listening)window.addEventListener(_eventName,localStorageChange,{passive:true});if(!_handlers[_eventName][key])_handlers[_eventName][key]=[];_handlers[_eventName][key].push(handler);_listening=true;return true}else return false;else return false}function off(key,handler){if(key&&handler)if(handler instanceof Function){if(_handlers[_eventName][key]){let idx=_handlers[_eventName][key].indexOf(handler);if(idx!=-1)_handlers[_eventName][key].splice(idx,
1)}else return false;return true}else return false;else return false}function localStorageChange(e){if(_handlers[_eventName][e.key])_handlers[_eventName][e.key].forEach(hnd=>{try{hnd(e)}catch(err){}})}initialize();Object.defineProperty(this,"get",{"enumerable":true,"configurable":false,"writable":false,"value":get});Object.defineProperty(this,"set",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,"add",{"enumerable":true,"configurable":false,"writable":false,
"value":add});Object.defineProperty(this,"remove",{"enumerable":true,"configurable":false,"writable":false,"value":remove});Object.defineProperty(this,"clear",{"enumerable":true,"configurable":false,"writable":false,"value":clear});var ss=new SessionStorage;Object.defineProperty(this,"session",{"enumerable":true,"configurable":false,"get":function(){return ss}});Object.defineProperty(this,"on",{enumerable:true,configurable:false,writeble:false,value:on});Object.defineProperty(this,"off",{enumerable:true,
configurable:false,writeble:false,value:off});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function StringExtend(){var _className=getFunctionName(arguments);if(!String.prototype.trimLeft)String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")};if(!String.prototype.ltrim)String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};if(!String.prototype.trimRight)String.prototype.trimRight=
function(){return this.replace(/\s+$/,"")};if(!String.prototype.rtrim)String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function trim(str){return typeof str=="string"?str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):str}function leftTrim(str){return typeof str=="string"?str.replace(/^\s+/,""):str}function rightTrim(str){return typeof str=="string"?str.replace(/\s+$/,
""):str}function formatStr(format,values){var args=Array.prototype.slice.call(arguments,1);return format.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!="undefined"?args[number]:match})}function sprintf(format,values){var arg=arguments;var i=1;if(format!=null&&typeof format!="undefined")return format.replace(/%((%)|s)/g,function(m){return m[2]||arg[i++]});else return format}function hasWord(text,word){var i=text.indexOf(word);return i==-1?false:function(tl){return(i==0||text[i-
1]==" ")&&(text.length==tl||text[tl]==" ")}(i+word.length)}Object.defineProperty(this,"trim",{"enumerable":true,"configurable":false,"writable":false,"value":trim});Object.defineProperty(this,"ltrim",{"enumerable":true,"configurable":false,"writable":false,"value":leftTrim});Object.defineProperty(this,"rtrim",{"enumerable":true,"configurable":false,"writable":false,"value":rightTrim});Object.defineProperty(this,"format",{"enumerable":true,"configurable":false,"writable":false,"value":formatStr});
Object.defineProperty(this,"sprintf",{"enumerable":true,"configurable":false,"writable":false,"value":sprintf});Object.defineProperty(this,"hasWord",{"enumerable":true,"configurable":false,"writable":false,"value":hasWord});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Style(){var _className=getFunctionName(arguments);var _dynamicStyleSheet=null;var _gref=
GLOBAL_VAR["class"]["privateREF#"];function parsingAttributes(attribute,value){var attrib={};if(!window.agentInfo)if(GLOBAL_VAR.class["privateREF#"].console)GLOBAL_VAR.class["privateREF#"].console.warning("AgentInfo class is not defined.",arguments);else window.console.log("AgentInfo class is not defined");else try{switch(attribute.toUpperCase()){case "OPACITY":case "FILTER":if(agentInfo.isMSIE){if(value>1)value/=100;attrib["name"]="opacity";attrib["value"]=value}else{attrib["name"]="filter";if(value<
1&&value%1!=0)value*=100;attrib["value"]="alpha(opacity="+value+")"}break;case "FLOAT":case "CSSFLOAT":case "STYLEFLOAT":if(agentInfo.isMSIE)attrib={"name":"styleFloat","value":value};else attrib={"name":"cssFloat","value":value};break;default:attrib={"name":attribute,"value":value};break}}catch(error){return error}return attrib}function add(elems,style){if(elems){var isElem=true;if(!(elems.forEach instanceof Function)){elems=[elems];isElem=false}elems.forEach(function(elem){try{if(GLOBAL_VAR["class"]["privateREF#"]["object"].validate(style)==
true&&GLOBAL_VAR["class"]["privateREF#"]["object"].validate(elem)==true)if(typeof style=="string"&&style.indexOf(":")==-1){var splStyle=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(style).split(" ");var curClass=elem.className.split(" ");for(var i=0;i<splStyle.length;i++){var added=true;for(var k=0;k<curClass.length;k++)if(curClass[k]==splStyle[i]){added=false;break}if(added==true){elem.className=(elem.className+" "+splStyle[i]).replace(/ +/g," ").trim();added=false}}}else if(typeof style=="string"&&
style.indexOf(":")!=-1){var splStyle=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(style).split(":");splStyle[1]=splStyle[1].replace(/[;|,]/g,"");if(GLOBAL_VAR["class"]["privateREF#"].object.evaluate(elem,"style."+splStyle[0])==true)elem.style[splStyle[0]]=splStyle[1]}else if(typeof style=="object")for(var attrib in style){var lAttrib=attrib.substring(0,1).toLowerCase()+attrib.substring(1,attrib.length);if(GLOBAL_VAR["class"]["privateREF#"].object.evaluate(elem,"style."+[lAttrib])==true){elem.style[lAttrib]=
style[attrib];if(elem.style[lAttrib]!=style[attrib]){var text=elem.style.cssText;var start=text.search(lAttrib);if(start==-1)if(text=="")text=attrib+":"+style[attrib];else text+=";"+attrib+":"+style[attrib];else{var end=text.substr(start).search(";");if(end==-1)text=text.replace(text.substr(start),attrib+":"+style[attrib]);else text=text.replace(text.substr(start,end),attrib+":"+style[attrib])}elem.style.cssText=text}}}}catch(error){return error}});return isElem?elems[0]:elems}}function remove(elems,
toRemove){if(elems){var isElem=true;if(!(elems.forEach instanceof Function)){elems=[elems];isElem=false}elems.forEach(function(elem){if(GLOBAL_VAR["class"]["privateREF#"]["object"].validate(toRemove)==true&&GLOBAL_VAR["class"]["privateREF#"]["object"].validate(elem)==true)if(typeof toRemove=="string"&&toRemove.indexOf(":")==-1){var rmvClasses=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(toRemove).split(/ +/g);var curClasses=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(elem.className).split(/ +/g);
var p;for(var i=0;i<rmvClasses.length;i++){p=curClasses.indexOf(rmvClasses[i]);if(p!=-1)curClasses.splice(p,1)}elem.className=curClasses.join(" ")}});return isElem?elems[0]:elems}}function addAll(elem,style){if(GLOBAL_VAR["class"]["privateREF#"]["object"].validate(style)==true&&GLOBAL_VAR["class"]["privateREF#"]["object"].validate(elem)==true){add(elem,style);for(var i=0;i<elem.childNodes.length;i++)addAll(elem.childNodes[i],style)}}function removeAll(elem,style){if(GLOBAL_VAR["class"]["privateREF#"]["object"].validate(style)==
true&&GLOBAL_VAR["class"]["privateREF#"]["object"].validate(elem)==true){remove(elem,style);for(var i=0;i<elem.childNodes.length;i++)removeAll(elem.childNodes[i],style)}}function replace(elems,oldStyle,newStyle){if(elems){var isElem=true;if(!(elems.forEach instanceof Function)){elems=[elems];isElem=false}elems.forEach(function(elem){remove(elem,oldStyle);add(elem,newStyle)});return isElem?elems[0]:elems}}function hasClass(elem,className){if(elem&&className&&elem instanceof HTMLElement&&typeof className==
"string"){var splClasses=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(className).split(/ +/g);var count=0;for(var i=0;i<splClasses.length;i++)if(GLOBAL_VAR["class"]["privateREF#"]["string"].hasWord(elem.className,splClasses[i]))count++;return count==splClasses.length}return false}function hasAnyClass(elem,classes){if(elem&&classes&&elem instanceof HTMLElement&&typeof classes=="string"){var splClasses=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(classes).split(/ +/g);for(var i=0;i<splClasses.length;i++)if(GLOBAL_VAR["class"]["privateREF#"]["string"].hasWord(elem.className,
splClasses[i]))return true;return false}return false}function hasAnyParentsClass(elem,classes){if(!elem)return false;else if(hasAnyClass(elem,classes))return true;else return hasAnyParentsClass(elem.parentElement,classes)}function getAttribute(elem,attribute){var value=undefined;var obj=GLOBAL_VAR["class"]["privateREF#"]["object"];try{if(obj.validate(elem)&&obj.validate(attribute)){if(obj.exists(elem,"currentStyle")==true){attribute=attribute.replace(/\-(\w)/g,function(strMatch,p1){return p1.toUpperCase()});
return elem.currentStyle[attribute]}if(obj.exists(document,"defaultView.getComputedStyle")){value=document.defaultView.getComputedStyle(elem,"");if(value!=null)return value.getPropertyValue(attribute)}if(obj.exists(elem,"style."+attribute)==true)return elem.style[attribute]}return value}catch(error){return error}}function getComputedStyleProperty(elem,prop){var value;if(elem.currentStyle)value=elem.currentStyle[styleProp];else if(window.getComputedStyle)value=document.defaultView.getComputedStyle(elem,
null).getPropertyValue(prop);return value}function getCSSRule(rulePath){var ruleName=rulePath.toLowerCase();var styleSheet;var i,ii;var cssRule,cssRuleInner=null;var cssRules,cssRulesInner;if(document.styleSheets)for(i=0;i<document.styleSheets.length;i++){styleSheet=document.styleSheets[i];try{styleSheet.cssRules||styleSheet.rules}catch(error){continue}if(styleSheet.cssRules)cssRules=styleSheet.cssRules;else cssRules=styleSheet.rules;if(cssRules)for(ii=0;ii<cssRules.length;ii++){cssRule=cssRules[ii];
if(cssRule)if(cssRule.selectorText){let selectors=cssRule.selectorText.split(",");if(selectors.find(r=>{return _gref.string.trim(r.toLowerCase())==ruleName}))return cssRule}else if(cssRule.styleSheet){if(cssRule.styleSheet.cssRules)cssRulesInner=cssRule.styleSheet.cssRules;else cssRulesInner=cssRule.styleSheet.rules;if(cssRulesInner)for(jj=0;jj<cssRulesInner.length;jj++){cssRuleInner=cssRulesInner[jj];if(cssRuleInner)if(cssRuleInner.selectorText)if(cssRuleInner.selectorText.toLowerCase()==ruleName)return cssRuleInner}}}}return null}
function addCSSRule(rulepath,style){if(!_dynamicStyleSheet){_dynamicStyleSheet=document.createElement("style");_dynamicStyleSheet.type="text/css";var idx=document.styleSheets.length;document.getElementsByTagName("head")[0].appendChild(_dynamicStyleSheet);_dynamicStyleSheet=document.styleSheets[idx]}var cssRules=null;if(_dynamicStyleSheet.cssRules)cssRules=_dynamicStyleSheet.cssRules;else cssRules=_dynamicStyleSheet.rules;_dynamicStyleSheet.insertRule(rulepath+"{"+style+"}",cssRules.length)}function removeCSSRule(rulepath){ruleName=
ruleName.toLowerCase();var styleSheet;var i,ii;var cssRule=null;var cssRules;if(document.styleSheets)for(i=0;i<document.styleSheets.length;i++){styleSheet=document.styleSheets[i];if(styleSheet.cssRules)cssRules=styleSheet.cssRules;else cssRules=styleSheet.rules;if(cssRules)for(var k=0;k<cssRules.length;k++){cssRule=cssRules[k];if(cssRule.selectorText)if(cssRule.selectorText.toLowerCase()==ruleName){cssRules.splice(k,1);return}}}}function changeCSSRule(rule,attribute,value){if(typeof rule=="string")rule=
getCSSRule(rule);if(rule)rule.style[attribute]=value;else GLOBAL_VAR["class"]["privateREF#"]["console"].log("rule '"+rule+"' not found",arguments)}function getCSSRuleAttributes(rule){if(typeof rule=="string")rule=getCSSRule(rule);if(rule==null)return null;else return rule.style}function getCSSRuleAttribute(rule,attrname){var attr=null;if(typeof rule=="string")rule=getCSSRule(rule);var styles=getCSSRuleAttributes(rule);if(styles!=null)attr=styles.getPropertyValue(attrname);return attr}function showElem(elems,
display){if(elems){if(!(elems instanceof Array))elems=[elems];var _show=function(elem){if(typeof elem=="string")elem=document.getElementById(elem);if(elem){if(getAttribute(elem,"display")=="none"&&display!==false){if(typeof display=="undefined")display="inherit";elem.style.display=display}if(elem.style.visibility!="visible")elem.style.visibility="visible"}};elems.forEach(_show)}}function hideElem(elems,display){if(elems){if(!(elems instanceof Array))elems=[elems];var _hide=function(elem){if(typeof elem==
"string")elem=document.getElementById(elem);if(elem){if(getAttribute(elem,"display")!="none"&&display!==false){if(typeof display=="undefined")display="none";elem.style.display=display}if(elem.style.visibility!="hidden")elem.style.visibility="hidden"}};elems.forEach(_hide)}}Object.defineProperty(this,"add",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,"addClass",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,
"remove",{"enumerable":true,"configurable":false,"writable":false,"value":remove});Object.defineProperty(this,"removeClass",{"enumerable":true,"configurable":false,"writable":false,"value":remove});Object.defineProperty(this,"replace",{"enumerable":true,"configurable":false,"writable":false,"value":replace});Object.defineProperty(this,"hasClass",{"enumerable":true,"configurable":false,"writable":false,"value":hasClass});Object.defineProperty(this,"hasAnyClass",{"enumerable":true,"configurable":false,
"writable":false,"value":hasAnyClass});Object.defineProperty(this,"hasAnyParentsClass",{"enumerable":true,"configurable":false,"writable":false,"value":hasAnyParentsClass});Object.defineProperty(this,"getAttribute",{"enumerable":true,"configurable":false,"writable":false,"value":getAttribute});Object.defineProperty(this,"getComputedStyle",{"enumerable":true,"configurable":false,"writable":false,"value":getComputedStyleProperty});Object.defineProperty(this,"getCSSRule",{"enumerable":true,"configurable":false,
"writable":false,"value":getCSSRule});Object.defineProperty(this,"addCSSRule",{"enumerable":true,"configurable":false,"writable":false,"value":addCSSRule});Object.defineProperty(this,"removeCSSRule",{"enumerable":true,"configurable":false,"writable":false,"value":removeCSSRule});Object.defineProperty(this,"changeCSSRule",{"enumerable":true,"configurable":false,"writable":false,"value":changeCSSRule});Object.defineProperty(this,"getCSSRuleAttributes",{"enumerable":true,"configurable":false,"writable":false,
"value":getCSSRuleAttributes});Object.defineProperty(this,"getCSSRuleAttribute",{"enumerable":true,"configurable":false,"writable":false,"value":getCSSRuleAttribute});Object.defineProperty(this,"show",{"enumerable":true,"configurable":false,"writable":false,"value":showElem});Object.defineProperty(this,"hide",{"enumerable":true,"configurable":false,"writable":false,"value":hideElem});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+
_className+" class. - "+(new Date).toString());return this}function URL(){var _className=getFunctionName(arguments);var _gref=GLOBAL_VAR["class"]["privateREF#"];function gup(name,optionalWindow,defaultValue){var regex=new RegExp("[\\?&]"+name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)","ig");var wnd="";try{wnd=typeof optionalWindow!="undefined"&&optionalWindow!=null&&optionalWindow.location&&optionalWindow.location.href?optionalWindow.location.href:window.location.href}catch(error){wnd=
window.location.href}var results=regex.exec(wnd);regex=null;return results==null?typeof defaultValue!="undefined"?defaultValue:"":results[1]}function getParam(parseUrl,name,params){if(params)params=params.replace(/ /g,"").replace(/\\/g,"-").split("-");if(parseUrl&&parseUrl.parameters&&name)for(var i=0;i<parseUrl.parameters.length;i++)if(parseUrl.parameters[i].name.toLowerCase()==name.toLowerCase()){var rParam=parseUrl.parameters[i];if(params){if(params.indexOf("lc")!=-1&&rParam)rParam=rParam.toLowerCase();
if(params.indexOf("uc")!=-1&&rParam)rParam=rParam.toUpperCase()}return rParam}return null}function toUrl(parseUrl,params){var fUrl="";if(parseUrl){if(typeof params==="undefined")params=[];else if(!(params instanceof Array))params=params.replace(/ /g,"").replace(/\\/g,"-").replace(/\//g,"-").split("-");if(params.indexOf("lp")!=-1)fUrl=parseUrl.lastPath;else if(params.indexOf("bp")!=-1)fUrl=parseUrl.brokerPath;else{if(parseUrl.protocol)fUrl+=parseUrl.protocol+"://";if(parseUrl.hostname)fUrl+=parseUrl.hostname;
if(parseUrl.port)fUrl+=":"+parseUrl.port;if(params.indexOf("vp")!=-1){if(fUrl.substr(fUrl.length-1,1)!="/")fUrl+="/"}else if(parseUrl.virtualPath){if(parseUrl.virtualPath.substr(0,1)!="/"&&fUrl.substr(fUrl.length-1,1)!="/")fUrl+="/";fUrl+=parseUrl.virtualPath}if(params.indexOf("r")===-1&&parseUrl.resource){if(fUrl.substr(fUrl.length-1,1)!="/")fUrl+="/";fUrl+=parseUrl.resource}if(params.indexOf("a")===-1)for(var i=0;i<parseUrl.parameters.length;i++)if(typeof parseUrl.parameters[i].value!="undefined")fUrl+=
(i==0?"?":"&")+parseUrl.parameters[i].name+"="+parseUrl.parameters[i].value;else fUrl+=(i==0?"?":"&")+parseUrl.parameters[i].name;if(params.indexOf("o")!=-1)fUrl=fUrl.replace(parseUrl.protocol+"://"+parseUrl.hostname+(parseUrl.port&&parseUrl.port!=""?":"+parseUrl.port:""),"");if(params.indexOf("p")!=-1)fUrl=fUrl.replace(parseUrl.protocol+"://","");if(params.indexOf("h")!=-1)fUrl=fUrl.split("#")[0]}}return fUrl}function parseUrl(url){var ret=null;var port=null;var prot=null;var host=null;var baseURL=
null;var parameters=[];var virtualPath=null;var lastPath=null;var brokerPath=null;var resource=null;var hash=null;var res;try{if(url){url=_gref.string.trim(url.toString());if(url.indexOf("://")!=-1){res=url.split("://");prot=res[0];url=res[1]}url=url.replace(/[/]+/g,"/");var colon=url.indexOf(":");if(colon!==-1&&colon<url.indexOf("/")){res=null;var re=new RegExp(":[0-9]*");res=re.exec(url);if(res!=null){port=res[0].replace(":","");host=url.substring(0,res.index);url=url.substring(res.index+res[0].length,
url.length)}}if(host===null){var slashIdx=url.indexOf("/");if(slashIdx!==-1){host=url.substr(0,slashIdx);url=url.substr(slashIdx)}else{host=url;url=""}}baseURL=url;if(baseURL&&baseURL.indexOf("#")!==-1){let hashes=baseURL.split("#");baseURL=hashes[0];hash=hashes[1]}if(baseURL&&baseURL.indexOf("?")!=-1){var params=baseURL.substr(baseURL.indexOf("?")+1,baseURL.length);virtualPath=baseURL.substr(0,baseURL.indexOf("?"));params=params.split("&");for(var i=0;i<params.length;i++){var param=params[i].split("=");
parameters.push({"name":param[0],"value":param[1]})}}else virtualPath=baseURL;if(virtualPath&&virtualPath.indexOf(".")!=-1){var lbs=virtualPath.lastIndexOf("/");var tempVirtualPath=virtualPath.substr(0,lbs+1);resource=virtualPath.substr(lbs+1,virtualPath.length-lbs);virtualPath=tempVirtualPath;tempVirtualPath=null}}if(host=="")host=null;if(baseURL=="")baseURL=null;if(virtualPath){var tvp=_gref.string.trim(virtualPath);var lvp=tvp.substr(0,tvp.lastIndexOf("/")).split("/");var i=lvp.length-1;lastPath=
lvp[i]!==""?lvp[i]+"/":i-1>0&&lvp[i-1]!==""?lvp[i-1]+"/":"";var bp=tvp;if(!bp.endsWith("/"))bp=tvp.substr(0,tvp.lastIndexOf("/"));bp=bp.split("/");if(bp.length>0){bp.pop();brokerPath=bp.join("/");if(!brokerPath.endsWith("/"))brokerPath+="/";if(brokerPath.endsWith(lastPath))brokerPath=brokerPath.substring(0,brokerPath.length-lastPath.length)}else brokerPath="/"}else{brokerPath="/";lastPath=""}var origin=(prot?`${prot}://`:"")+(host?host+(port?`:${port}`:""):"");ret={origin,port,"protocol":prot,"hostname":host,
"baseurl":baseURL,parameters,virtualPath,brokerPath,lastPath,resource,hash,"toUrl":function(params){return toUrl(this,params)},"getParam":function(name,params){return getParam(this,name,params)}}}catch(error){return error}return ret}function getTopWindow(wnd){if(wnd.parent&&wnd.parent!=wnd)try{var hasError=true;if(wnd.parent.location.href){hasError=false;return getTopWindow(wnd.parent)}}catch(error){hasError=true}finally{if(hasError)return wnd}else return wnd}Object.defineProperty(this,"gup",{"enumerable":true,
"configurable":false,"writable":false,"value":gup});Object.defineProperty(this,"getTopWindow",{"enumerable":true,"configurable":false,"writable":false,"value":getTopWindow});Object.defineProperty(this,"parseUrl",{"enumerable":true,"configurable":false,"writable":false,"value":parseUrl});Object.defineProperty(this,"toUrl",{"enumerable":true,"configurable":false,"writable":false,"value":toUrl});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+
_className+" class. - "+(new Date).toString());return this}function Utils(){var _className=getFunctionName(arguments);function getCookie(name){var re=new RegExp(name+"=([^;]+)");var value=re.exec(document.cookie);return value!=null?unescape(value[1]):null}function removeCookie(name,path){var d=new Date(1);document.cookie=GLOBAL_VAR["class"]["privateREF#"].string.format("{0}=; expires={1}; path={2}",name,d.toString(),path||"/")}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}function getGUID(){return"{"+uuidv4().toUpperCase()+"}"}function getNewGWSID(){return generateGUID(32)}function generateGUID(len){var str="".padEnd(len,"x");return str.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)}).toUpperCase()}function maskToGUID(mask){if(mask&&typeof mask==="string")return mask.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)});
else return null}Object.defineProperty(this,"getCookie",{"enumerable":true,"configurable":false,"writable":false,"value":getCookie});Object.defineProperty(this,"getGUID",{"enumerable":true,"configurable":false,"writable":false,"value":getGUID});Object.defineProperty(this,"getNewUUIDv4GUID",{"enumerable":true,"configurable":false,"writable":false,"value":uuidv4});Object.defineProperty(this,"getNewGWSID",{"enumerable":true,"configurable":false,"writable":false,"value":getNewGWSID});Object.defineProperty(this,
"generateGUID",{"enumerable":true,"configurable":false,"writable":false,"value":generateGUID});Object.defineProperty(this,"maskToGUID",{"enumerable":true,"configurable":false,"writable":false,"value":maskToGUID});Object.defineProperty(this,"removeCookie",{"enumerable":true,"configurable":false,"writable":false,"value":removeCookie});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());
return this}function WebSocketObject(owner){var _className=getFunctionName(arguments);var _webSocket=null;var _opening=false;var _wsObjects=[];function getWSConstructor(){return"WebSocket"in window?WebSocket:MozWebSocket}function checkPendings(){_opening=false;if(_wsObjects.length>0)resolveWebSocket.apply(null,_wsObjects.shift())}function resolveWebSocket(url,binaryType,resolve,reject){var _ws;var _eventHandler=function(e){if(_ws){_ws.removeEventListener("open",_eventHandler);_ws.removeEventListener("close",
_eventHandler);_ws.removeEventListener("error",_eventHandler);try{var str="";var values=["type"];var srcValues=["readyState","url","binaryType","protocol"];values.forEach(function(item){str+=item+": "+e[item]+"\n\r"});srcValues.forEach(function(item){str+=item+": "+e.srcElement[item]+"\n\r"});GLOBAL_VAR.class["privateREF#"].console.log("Type:["+e.type+"], message: "+str,arguments)}catch(err){}}checkPendings()};try{GLOBAL_VAR.class["privateREF#"].console.log("New WebSocket connection: "+url,arguments);
_ws=new _webSocket(url);if(binaryType&&typeof _ws.binaryType!="undefined")_ws.binaryType=binaryType;_ws.addEventListener("open",_eventHandler);_ws.addEventListener("close",_eventHandler);_ws.addEventListener("error",_eventHandler);resolve(_ws)}catch(e){reject(e)}}function getNewWebSocket(url,binaryType){return new Promise(function(resolve,reject){if(!_opening){_opening=true;resolveWebSocket(url,binaryType,resolve,reject)}else _wsObjects.push([url,binaryType,resolve,reject])})}_webSocket=getWSConstructor();
Object.defineProperty(owner,"webSocket",{"enumerable":true,"configurable":false,"writable":false,"value":getNewWebSocket});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString())}function arrayExtract(a,fn){var result=[];var i=a.length-1;while(i>=0){if(fn(a[i]))result=result.concat(a.splice(i,1));i--}return result}function stringRepeat(s,count){if(s==null)throw new TypeError("can't convert "+
s+" to object");var str=""+s;count=+count;if(count!=count)count=0;if(count<0)throw new RangeError("repeat count must be non-negative");if(count==Infinity)throw new RangeError("repeat count must be less than infinity");count=Math.floor(count);if(str.length==0||count==0)return"";if(str.length*count>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");var rpt="";for(;;){if((count&1)==1)rpt+=str;count>>>=1;if(count==0)break;str+=str}return rpt}if(window.agentInfo&&(window.agentInfo.isMSIE||
window.agentInfo.isSafari)){var _getBoundingClientRect=HTMLElement.prototype.getBoundingClientRect;HTMLElement.prototype._getBoundingClientRect=_getBoundingClientRect;HTMLElement.prototype.getBoundingClientRect=function(){var bcr=this._getBoundingClientRect();bcr.x=bcr.left;bcr.y=bcr.top;return bcr}}if(!Array.extract)Object.defineProperty(Array.prototype,"extract",{"enumerable":false,"configurable":false,"writable":false,"value":function(fn){return arrayExtract(this,fn)}});if(!String.repeat)Object.defineProperty(String.prototype,
"repeat",{"enumerable":false,"configurable":false,"writable":false,"value":function(count){return stringRepeat(this,count)}});GLOBAL_VAR["class"]["ref#"]=this;initialize(this);return this}if(typeof window.helper==="undefined")var helper=new Helper;
(function(){function Environment(){var _ref=this;if(typeof window["agentInfo"]=="undefined")return;var _isEmbedded=false;try{_isEmbedded=window.top!=window}catch(error){_isEmbedded=true}var _currentDevicePixelRatio=1;var _initialDevicePixelRatio=typeof window.agentInfo=="undefined"||!agentInfo.isMobile?1:window.devicePixelRatio||1;var _detectedWidth=window.screen.availWidth;var _availWidth=window.screen.availWidth;var _detectedHeight=window.screen.availHeight;var _availHeight=window.screen.availHeight;
var _screenWidth=window.screen.availWidth;var _screenHeight=window.screen.availHeight;var _screenRawWidth=_screenWidth;var _screenRawHeight=_screenHeight;var _getWidth=typeof window.helper!="undefined"?function(elem){return helper.size.getWidth(elem)}:function(elem){return $(elem).width()};var _getHeight=typeof window.helper!="undefined"?function(elem){return helper.size.getHeight(elem)}:function(elem){return $(elem).height()};var _winWidth=_getWidth(window);var _winHeight=_getHeight(window);var _viewportWidth=
_detectedWidth;var _viewportHeight=_detectedHeight;var _deviceWidth=window.screen.width;var _deviceHeight=window.screen.height;var _sizeCalculationHolderElem=null;var _sizeCalculationHolderElemId="sizeCalculationHolder";var _xzoom=100;var _xzoomfn=null;var _supportsFullScreenMode=agentInfo.supportHTML5&&!(agentInfo.isIOS&&agentInfo.ipadModel==="pro")&&agentInfo.supportsFullScreen(document.documentElement);var _fullScreenAvailable=false;var _isFullscreen=false;var _environmentReady=false;var _resolutionModes=
{"fittobrowser":0,"fittoscale":1,"fittoscreen":2,"fixed":3};var _resolutionMode=_resolutionModes.fittobrowser;var _watchDog={"intervalId":null,"intervalTime":50,"width":null,"height":null,"isChanging":false,"isRunning":false,"currentDate":null,"lastEvent":null,"waitTime":window.agentInfo&&agentInfo.isMobile?500:50,"updateTime":window.agentInfo&&agentInfo.isMobile?100:50,"count":0};var _commandHandlerList=[];var _isResizingRunning=false;var _holderElemReady=false;var _orientationMedia=null;var _margin=
{"left":0,"top":0,"right":0,"bottom":0,"infullscreen":false,"notinfullscreen":false,"original":{"left":0,"top":0,"right":0,"bottom":0}};var _savedValues={"currentDevicePixelRatio":null,"detectedWidth":null,"availWidth":null,"detectedHeight":null,"availHeight":null,"screenWidth":null,"screenHeight":null,"screenRawWidth":null,"screenRawHeight":null,"winWidth":null,"winHeight":null,"viewportWidth":null,"viewportHeight":null};var _crop={"width":0,"height":0,"infullscreen":false,"notinfullscreen":false,
"original":{"width":0,"height":0}};var _mobileLimits={"_320x320":320*320,"_640x480":640*480,"_960x600":960*600,"_2048x1024":2048*1024};var _isIEMobileMode=false;var _zoomValues=[25,33.5,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500,600,700,800,900,1E3,2E3,3E3,4E3,1E4];var _initialOrientation=null;function initialize(){applyPixelRatioRule(undefined,function(){return _initialDevicePixelRatio},function(value){_initialDevicePixelRatio=value});_isIEMobileMode=agentInfo.isMSIE&&agentInfo.isWindowsPhone&&
typeof window.matchMedia!="undefined";appendSizeCalculationHolder();var bodyReady=function(){if(document.body){document.body.appendChild(_sizeCalculationHolderElem);_holderElemReady=true;if(!agentInfo.isMobile){_isFullscreen=isFullscreen();assignZoomFn();_orientationMedia="landscape";if(_detectedWidth==0&&_detectedHeight==0)startWatchDog()}attachEvents();updateSizeValues();_initialOrientation=getOrientation();_environmentReady=true}else setTimeout(bodyReady,25)};helper.dom.loading(bodyReady);try{window.dispatchEvent(new CustomEvent("addStatusAPIVariables",
{"detail":[{"name":"size","title":"Size","get":function(){return _detectedWidth+"x"+_detectedHeight},"index":55}]}));window.dispatchEvent(new CustomEvent("addStatusAPIVariables",{"detail":[{"name":"zoom","title":"Zoom","get":function(){return _xzoom},"index":56}]}));window.dispatchEvent(new CustomEvent("addStatusAPIVariables",{"detail":[{"name":"rsize","title":"RSize","get":function(){return window.screen.width+"x"+window.screen.height},"index":56}]}))}catch(error){}}function getMatchMedia(){return window.matchMedia("(orientation: portrait)").matches?
"portrait":"landscape"}function getWndOrientation(){return typeof window.orientation=="undefined"||Math.abs(window.orientation)==90?"landscape":"portrait"}function getOrientation(){if(agentInfo.isMobile)if(_holderElemReady)if(window.matchMedia&&(agentInfo.isIOS&&agentInfo.ipadModel>=2||agentInfo.isWindowsPhone))return getMatchMedia();else if(agentInfo.isAndroid&&agentInfo.chromeVersion>"50")return getWndOrientation();else{var h=_getHeight(_sizeCalculationHolderElem);var w=_getWidth(_sizeCalculationHolderElem);
if(agentInfo.isAndroid&&!agentInfo.isChrome&&!agentInfo.isFirefox&&agentInfo.agentStr.indexOf("android 4.2.2")!=-1){var sw=window.screen.width;var sh=window.screen.height;if(sw==w){w=2;h=1}else if(sh==w){w=1;h=2}else{var wDif=Math.abs(sw-w);var hDif=Math.abs(sh-h);if(wDif>300||hDif>300)if(wDif>hDif){w=2;h=1}else{w=1;h=2}}}return w>=h?"landscape":"portrait"}else if(window.matchMedia)return getMatchMedia();else return getWndOrientation();else return _orientationMedia}function applyPixelRatioRule(dpr,
getDpr,setDpr){if(typeof setDpr==="undefined"||!(setDpr instanceof Function))setDpr=function(value){_currentDevicePixelRatio=value};if(typeof dpr!="undefined")setDpr(dpr);else{var vdpr=null;var cdpr=getDpr();if(agentInfo.isMobile){var w=window.screen.availWidth;var h=window.screen.availHeight;if(w<=320&&h<=320)vdpr=2;else if(w<=320&&h>=640||w*h<_mobileLimits._320x320||w>=640&&h<=320)vdpr=1;else if(cdpr>1&&(w<=480&&h<=640||h<=480&&w<=640||w*h<_mobileLimits._640x480)){if(!(agentInfo.isIOS&&agentInfo.isIphone&&
agentInfo.iosVersion==4))vdpr=1}else if(w>2048||h>2048||w*h>_mobileLimits._2048x1024);else if((w>=600&&h>=960||w>=960&&h>=600||w*h>_mobileLimits._960x600)&&cdpr>1)vdpr=1;else if((w<=1024&&h<=768||w<=768&&h<=1024)&&cdpr>1)vdpr=1;else if(cdpr>2)vdpr=2;else vdpr=window.devicePixelRatio||1}else vdpr=1;if(vdpr)setDpr(vdpr)}}function appendSizeCalculationHolder(){_sizeCalculationHolderElem=document.createElement("div");_sizeCalculationHolderElem.id=_sizeCalculationHolderElemId;_sizeCalculationHolderElem.style.height=
"100%";_sizeCalculationHolderElem.style.width="100%";_sizeCalculationHolderElem.style.backgroundColor="transparent";_sizeCalculationHolderElem.style.opacity="0.5";_sizeCalculationHolderElem.style.position="fixed";_sizeCalculationHolderElem.style.margin="0px";_sizeCalculationHolderElem.style.padding="0px";_sizeCalculationHolderElem.style.top="0px";_sizeCalculationHolderElem.style.left="0px";_sizeCalculationHolderElem.style.right="0px";_sizeCalculationHolderElem.style.bottom="0px";_sizeCalculationHolderElem.style.zIndex=
-9999999}function attachEvents(){window.addEventListener("resize",onresize,false)}function assignZoomFn(){var zoom=null;if(_isEmbedded)_xzoomfn=function(){return 100};else if(agentInfo.isFirefox)_xzoomfn=function(){var mediaQueryBinarySearch=function(property,unit,a,b,maxIter,epsilon){var matchMedia;var head,style,div;if(window.matchMedia)matchMedia=window.matchMedia;else{head=document.getElementsByTagName("head")[0];style=document.createElement("style");head.appendChild(style);div=document.createElement("div");
div.className="mediaQueryBinarySearch";div.style.display="none";document.body.appendChild(div);matchMedia=function(query){style.sheet.insertRule("@media "+query+"{.mediaQueryBinarySearch "+"{text-decoration: underline} }",0);var matched=getComputedStyle(div,null).textDecoration=="underline";style.sheet.deleteRule(0);return{matches:matched}}}var ratio=binarySearch(a,b,maxIter);if(div){head.removeChild(style);document.body.removeChild(div)}return ratio;function binarySearch(a,b,maxIter){var mid=(a+
b)/2;if(maxIter<=0||b-a<epsilon)return mid;var query="("+property+":"+mid+unit+")";if(matchMedia(query).matches)return binarySearch(mid,b,maxIter-1);else return binarySearch(a,mid,maxIter-1)}};return mediaQueryBinarySearch("min--moz-device-pixel-ratio","",0,10,20,1E-4)*100};else if(agentInfo.isMSIE)_xzoomfn=function(){return screen.deviceXDPI/screen.logicalXDPI*100};else if(window===window.top)if(agentInfo.isSafari)_xzoomfn=function(){return window.outerWidth/window.innerWidth*100};else _xzoomfn=
function(){return window.outerWidth/window.innerWidth*100};else if(agentInfo.isChrome)_xzoomfn=function(){if(window.devicePixelRatio!=1&&Math.abs(_getWidth(window)-window.screen.availWidth)>window.screen.availWidth*.01)return window.devicePixelRatio*100;else return window.outerWidth===window.screen.availWidth?window.devicePixelRatio*100:100};else _xzoomfn=function(){return 100}}function updateRealDevicePixelRatio(){if(document.hidden)_currentDevicePixelRatio=1;else{var rawXzoom=_xzoomfn();var dif=
999;if(_zoomValues.indexOf(rawXzoom)==-1){var i=0;while(rawXzoom>_zoomValues[i])i++;if(i==0)rawXzoom=_zoomValues[i];else rawXzoom=Math.abs(_zoomValues[i-1]-rawXzoom)<Math.abs(_zoomValues[i]-rawXzoom)?_zoomValues[i-1]:_zoomValues[i]}_xzoom=rawXzoom;_currentDevicePixelRatio=Math.floor(_xzoom)/100}}function setResolutionMode(value){switch(value.toString().toLowerCase()){case "1":case "fittoscale":_resolutionMode=_resolutionModes.fittoscale;break;case "2":case "fittoscreen":_resolutionMode=_resolutionModes.fittoscreen;
break;case "3":case "fixed":_resolutionMode=_resolutionModes.fixed;break;case "0":case "fittobrowser":default:_resolutionMode=_resolutionModes.fittobrowser;break}}function updateSizeValues(){if(agentInfo.isMobile){var orin=getOrientation();var max=Math.max(window.screen.width,window.screen.height);var min=Math.min(window.screen.width,window.screen.height);if(agentInfo.isIOS&&agentInfo.ipadModel==="pro"&&_holderElemReady)if(orin==="portrait"){max=window.screen.height;min=window.screen.width}else if(orin===
"landscape"){max=window.screen.height;min=window.screen.width}_deviceWidth=orin==="portrait"?min:max;_deviceHeight=orin==="portrait"?max:min;_screenRawWidth=_deviceWidth-_crop.width;_screenRawHeight=_deviceHeight-_crop.height;_screenHeight=_screenRawHeight*_currentDevicePixelRatio;_screenWidth=_screenRawWidth*_currentDevicePixelRatio;if(_holderElemReady){_viewportWidth=_getWidth(_sizeCalculationHolderElem)-_crop.width;_viewportHeight=_getHeight(_sizeCalculationHolderElem)-_crop.height}if(_supportsFullScreenMode)if(agentInfo.isMSIE&&
_isIEMobileMode){if(agentInfo.msieVersion>=11)if(getOrientation()=="portrait"){_detectedWidth=(screen.width||1)-_crop.width;_availWidth=_detectedWidth*_currentDevicePixelRatio-(_margin.left+_margin.right);_detectedHeight=(screen.height||1)-_crop.height;_availHeight=_detectedHeight*_currentDevicePixelRatio-(_margin.top+_margin.bottom)}else{_detectedHeight=(screen.width||1)-_crop.height;_availHeight=_detectedHeight*_currentDevicePixelRatio-(_margin.left+_margin.right);_detectedWidth=(screen.height||
1)-_crop.width;_availWidth=_detectedWidth*_currentDevicePixelRatio-(_margin.top+_margin.bottom)}}else if(_holderElemReady){_detectedWidth=_getWidth(_sizeCalculationHolderElem)-_crop.width;_detectedHeight=_getHeight(_sizeCalculationHolderElem)-_crop.height}else{_detectedWidth=_screenRawWidth;_detectedHeight=_screenRawHeight}else{_detectedWidth=_getWidth(window)-_crop.width;_detectedHeight=_getHeight(window)-_crop.height}if(!_holderElemReady){_viewportWidth=_detectedWidth;_viewportHeight=_detectedHeight}_availWidth=
_detectedWidth*_currentDevicePixelRatio-(_margin.left+_margin.right);_availHeight=_detectedHeight*_currentDevicePixelRatio-(_margin.top+_margin.bottom)}else{updateRealDevicePixelRatio();_deviceWidth=window.screen.width;_deviceHeight=window.screen.height;if(_isFullscreen){_screenWidth=window.screen.width-_crop.width;_screenHeight=window.screen.height-_crop.height}else{_screenWidth=window.screen.availWidth-_crop.width;_screenHeight=window.screen.availHeight-_crop.height}_screenRawWidth=_screenWidth;
_screenRawHeight=_screenHeight;_detectedWidth=_getWidth(window)-_crop.width;_availWidth=_detectedWidth*_currentDevicePixelRatio-(_margin.left+_margin.right);_detectedHeight=_getHeight(window)-_crop.height;_availHeight=_detectedHeight*_currentDevicePixelRatio-(_margin.top+_margin.bottom);if(_holderElemReady&&!_isFullscreen){_viewportWidth=_getWidth(_sizeCalculationHolderElem)-_crop.width;_viewportHeight=_getHeight(_sizeCalculationHolderElem)-_crop.height}else{_viewportWidth=_detectedWidth;_viewportHeight=
_detectedHeight}}}function setElement(elem){if(typeof elem!="undefined"){_sizeCalculationHolderElem=elem;if(_sizeCalculationHolderElem.id==undefined||_sizeCalculationHolderElem=="")_sizeCalculationHolderElem.id=_sizeCalculationHolderElemId;else _sizeCalculationHolderElemId=_sizeCalculationHolderElemId.id}}function environmentReady(fCallback){if(_environmentReady&&_holderElemReady){updateSizeValues();fCallback()}else{var count=0;var tempInterval=setInterval(function(){if(count<25){if(_environmentReady&&
_holderElemReady){clearInterval(tempInterval);updateSizeValues();fCallback()}}else{clearInterval(tempInterval);var str="Cannot trigger environment ready event";var ex=new Error(str);helper.console.error(str,ex);_environmentReady=false;_holderElemReady=false;updateSizeValues();fCallback()}count++},25)}}function isFullscreen(){return _getWidth(window)==_deviceWidth&&_getHeight(window)==_deviceHeight}function addEvent(event,handler){if(event==undefined||event==null||event=="")return"Event is undefined or null.";
if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";event=event.toLowerCase();var item={"event":event,"handler":handler};var isContained=false;if(_commandHandlerList[event]==undefined)_commandHandlerList[event]=[];else for(var i=0;i<_commandHandlerList[event].length;i++)if(_commandHandlerList[event][i].handler==item.handler){isContained=true;break}if(!isContained)_commandHandlerList[event].push(item);return true}function removeEvent(event,handler){var ret=false;
if(event==undefined||event==null||event=="")return"Event is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";event=event.toLowerCase();var item={"event":event,"handler":handler};if(_commandHandlerList[event]==undefined)return"Cannot find event. Event is not in the command list.";else for(var i=0;i<_commandHandlerList[event].length;i++)if(_commandHandlerList[event][i].handler.toString()==item.handler.toString()){_commandHandlerList[event].splice(i,
1);ret=true}return ret}function setDevicePixelRatio(dpr){_initialDevicePixelRatio=dpr;_currentDevicePixelRatio=dpr;updateSizeValues()}function getCurrentWidth(){return(_holderElemReady?_getWidth(_sizeCalculationHolderElem):_screenRawWidth)-_crop.width}function getCurrentHeight(){return(_holderElemReady?_getHeight(_sizeCalculationHolderElem):_screenRawHeight)-_crop.height}function startWatchDog(e){_watchDog.currentDate=(new Date).getTime();_watchDog.lastEvent=e;watchDesktopSize()}function watchDesktopSize(){if(!_watchDog.isRunning&&
!_watchDog.isChanging){_watchDog.isRunning=true;_watchDog.count=0;triggerEvent(["resizestart"]);var elem=_holderElemReady?_sizeCalculationHolderElem:window;_watchDog.intervalId=setInterval(function(){if(_watchDog.height!=_getHeight(elem)||_watchDog.width!=_getWidth(elem)){_watchDog.height=_getHeight(elem);_watchDog.width=_getWidth(elem);stopWatchDog();changeScreenSize()}else{_watchDog.count++;if(_watchDog.count>10&&_watchDog.height==_getHeight(window)&&_watchDog.width==_getWidth(window)){stopWatchDog();
changeScreenSize()}}},_watchDog.intervalTime)}}function stopWatchDog(){clearInterval(_watchDog.intervalId);_watchDog.intervalId=null;_watchDog.isRunning=false}function changeScreenSize(){if(_watchDog.isChanging==false){_watchDog.isChanging=true;var cHeight=null;var originalHeight=cHeight;var maxWaitTime=1E3;function updateScreenSize(){_isFullscreen=!!document.fullscreenElement;if(_isFullscreen){if(_crop.notinfullscreen){_crop.width=_crop.original.width;_crop.height=_crop.original.height}if(_margin.notinfullscreen){_margin.left=
_margin.original.left;_margin.top=_margin.original.top;_margin.right=_margin.original.right;_margin.bottom=_margin.original.bottom}if(window.Thinfinity.InitializationData){var cropfs=helper.object.getValue(Thinfinity.InitializationData.get("ENVIRONMENT"),"crop.infullscreen",null);if(cropfs){_crop.infullscreen=true;_crop.width=cropfs.width;_crop.height=cropfs.height}var marginfs=helper.object.getValue(Thinfinity.InitializationData.get("ENVIRONMENT"),"margin.infullscreen",null);if(marginfs){_margin.infullscreen=
true;_margin.left=marginfs.left;_margin.top=marginfs.top;_margin.right=marginfs.right;_margin.bottom=marginfs.bottom}}}else{if(_crop.infullscreen){_crop.width=_crop.original.width;_crop.height=_crop.original.height}if(_margin.infullscreen){_margin.left=_margin.original.left;_margin.top=_margin.original.top;_margin.right=_margin.original.right;_margin.bottom=_margin.original.bottom}if(window.Thinfinity.InitializationData){var cropfs=helper.object.getValue(Thinfinity.InitializationData.get("ENVIRONMENT"),
"crop.notinfullscreen",null);if(cropfs){_crop.notinfullscreen=true;_crop.width=cropfs.width;_crop.height=cropfs.height}var marginfs=helper.object.getValue(Thinfinity.InitializationData.get("ENVIRONMENT"),"margin.notinfullscreen",null);if(marginfs){_margin.notinfullscreen=true;_margin.left=marginfs.left;_margin.top=marginfs.top;_margin.right=marginfs.right;_margin.bottom=marginfs.bottom}}}_watchDog.height=null;_watchDog.width=null;_watchDog.isChanging=false;updateSizeValues();triggerEvent(["resize",
"resizeComplete","resizeend"]);if(agentInfo.isMobile){var orin=getOrientation();if(_initialOrientation!=orin){_initialOrientation=orin;triggerEvent(["orientationChange"])}}triggerEvent(_isFullscreen?"enterfullscreen":"exitfullscreen")}function waitForSizeChanged(){var fHeight=_getHeight(window);if(fHeight!=_winHeight&&fHeight==cHeight)setTimeout(function(){updateScreenSize()},_watchDog.waitTime);else{cHeight=fHeight;if(maxWaitTime<(new Date).getTime()-_watchDog.currentDate)setTimeout(function(){updateScreenSize()},
_watchDog.waitTime);else setTimeout(function(){waitForSizeChanged()},_watchDog.updateTime)}}waitForSizeChanged()}}function updateDevicePixelRatio(){applyPixelRatioRule(undefined,function(value){_currentDevicePixelRatio=value});updateSizeValues()}function launchFullscreenMode(elem){try{_isFullscreen=true;if(!elem)elem=document.documentElement;if(elem.requestFullscreen)elem.requestFullscreen().then(()=>{_isFullscreen=!!document.fullscreenElement});else if(elem.mozRequestFullScreen)elem.mozRequestFullScreen();
else if(elem.webkitRequestFullscreen)elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else if(elem.msRequestFullscreen)elem.msRequestFullscreen();else if(typeof window.ActiveXObject!="undefined"){var wscript=new ActiveXObject("WScript.Shell");if(wscript!=null)wscript.SendKeys("{F11}")}else{_isFullscreen=false;helper.console.log("Your browser do not support FullScreen Mode")}}catch(error){_isFullscreen=false}}function exitFullscreenMode(elem){_isFullscreen=false;try{if(document.fullscreenElement){if(!elem)elem=
document.documentElement;if(elem.exitFullscreen)elem.exitFullscreen();else if(document.exitFullscreen)document.exitFullscreen().then(()=>{_isFullscreen=!!document.fullscreenElement});else if(elem.cancelFullscreen)elem.cancelFullscreen();else if(document.cancelFullscreen)document.cancelFullscreen();else if(elem.mozCancelFullScreen)elem.mozCancelFullScreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(elem.webkitExitFullscreen)elem.webkitExitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();
else if(elem.webkitCancelFullscreen)elem.webkitCancelFullscreen();else if(document.webkitCancelFullscreen)document.webkitCancelFullscreen();else if(elem.msExitFullscreen)elem.msExitFullscreen();else if(document.msExitFullscreen)document.msExitFullscreen();else if(elem.msCancelFullscreen)elem.msCancelFullscreen();else if(document.msCancelFullscreen)document.msCancelFullscreen();else{_isFullscreen=true;logDebug("Your browser do not support FullScreen Mode")}}}catch(error){_isFullscreen=!!document.fullscreenElement}}
function onresize(e){_isFullscreen=isFullscreen();updateSizeValues(e);triggerEvent(["resize"]);startWatchDog(e)}function triggerEvent(eventNames){var atLeastOne=false;if(eventNames){if(typeof eventNames=="string")eventNames=[eventNames];for(var k=0;k<eventNames.length;k++)if(_commandHandlerList[eventNames[k].toLowerCase()]!=undefined)for(var i=0;i<_commandHandlerList[eventNames[k].toLowerCase()].length;i++){try{_commandHandlerList[eventNames[k].toLowerCase()][i]["handler"](_watchDog.lastEvent)}catch(error){}atLeastOne=
true}}return atLeastOne}function crop(sizes){if(!sizes)return _crop;else{helper.object.parseAttributes(_crop,sizes);_crop.original.width=_crop.width;_crop.original.height=_crop.height;updateSizeValues();startWatchDog()}}function getScaleAndLayout(){var dpr=parseInt(window.devicePixelRatio*100,10);var cdpr=parseInt(_currentDevicePixelRatio*100,10);if(dpr>cdpr){var fw=_screenRawWidth*100/_xzoom;var sal=fw*window.devicePixelRatio/(fw*_currentDevicePixelRatio)*100;return parseInt(sal/25,10)*25}else return 100}
function lookFor(wnd,key,onlyCurrentWindow){let getParent=function(wnd){try{if(wnd&&wnd.parent&&wnd.parent!=wnd&&wnd.parent.location.href)return wnd.parent}catch(error){return null}};var web7Info=null;try{if(wnd){web7Info=wnd[key];if(!onlyCurrentWindow)while(!web7Info&&wnd){wnd=getParent(wnd);if(wnd)web7Info=wnd[key]}}}catch(error){}return web7Info}function getEnvironmentInformation(){var wndp=null;var wb=true;var crossDomain,embeddedCross=false;try{if(!(parent&&parent.document))crossDomain=true}catch(error){crossDomain=
true}try{if(!window.top.document)embeddedCross=true}catch(error){embeddedCross=true}if(window.parent&&window!=window.parent)try{if(window.parent.location.href)wndp=window.parent;wb=wndp&&wndp.location.host==window.location.host&&wndp.location.protocol==window.location.protocol&&window.location.pathname.endsWith(wndp.location.pathname)}catch(error){wndp=window}else wndp=window;var mw=wndp!=window&&wndp==top?wndp:window;var inFullScreen=crossDomain||embeddedCross?false:isFullscreen();let wfe=window.frameElement==
null||window.frameElement.getAttribute("__webV7_frame__")!==null;let cReferrer=wfe?window.parent.document.referrer:document.referrer;var inw=wfe&&(mw.opener&&mw!=mw.opener||mw.document.referrer==mw.document.location.href||wndp==window&&window.document.referrer.indexOf("oturl")!=-1);let fIndex=undefined;let webV7=lookFor(window,"__webV7__",false);if(webV7)fIndex=inw=false;else{let twnd=helper.url.getTopWindow(window);if(twnd.opener==null&&(window.cookiePrefix==="VNC"||twnd.document.referrer===location.origin+
Thinfinity.global.variables.basePath)){inw=true;fIndex=false}}var referrer=inw?"":cReferrer;var sameOrigin=helper.url.parseUrl(referrer).toUrl("-vp-a-p")===helper.url.parseUrl(window.location).toUrl("-vp-a-p");var info={"withBroker":wb,"referrer":referrer,"fromIndex":inFullScreen||inw?false:typeof fIndex!="undefined"?fIndex:sameOrigin,"mainWindow":mw,"inFullScreen":inFullScreen,"inNewWindow":inw,"embedded":crossDomain||embeddedCross?false:mw!==window};Object.defineProperty(info,"webV7",{enumerable:true,
configurable:false,get:()=>{return lookFor(window,"__webV7__",true)}});return info}initialize();Object.defineProperty(_ref,"fixDevicePixelRatio",{"enumerable":true,"configurable":false,"writable":false,"value":function(){updateDevicePixelRatio()}});Object.defineProperty(_ref,"currentOrientation",{"enumerable":true,"configurable":false,"get":function(){return getOrientation()}});Object.defineProperty(_ref,"currentDevicePixelRatio",{"enumerable":true,"configurable":false,"get":function(){return _currentDevicePixelRatio},
"set":function(dpr){setDevicePixelRatio(dpr)}});Object.defineProperty(_ref,"initialDevicePixelRatio",{"enumerable":true,"configurable":false,"get":function(){return _initialDevicePixelRatio}});_ref.margin={};Object.defineProperty(_ref.margin,"left",{"enumerable":true,"configurable":false,"get":function(){return _margin.left},"set":function(value){_margin.left=_margin.original.left=value;updateSizeValues()}});Object.defineProperty(_ref.margin,"top",{"enumerable":true,"configurable":false,"get":function(){return _margin.top},
"set":function(value){_margin.top=_margin.original.top=value;updateSizeValues()}});Object.defineProperty(_ref.margin,"right",{"enumerable":true,"configurable":false,"get":function(){return _margin.right},"set":function(value){_margin.right=_margin.original.right=value;updateSizeValues()}});Object.defineProperty(_ref.margin,"bottom",{"enumerable":true,"configurable":false,"get":function(){return _margin.bottom},"set":function(value){_margin.bottom=_margin.original.bottom=value;updateSizeValues()}});
Object.defineProperty(_ref,"detectedWidth",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_detectedWidth,10)}});Object.defineProperty(_ref,"detectedHeight",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_detectedHeight,10)}});Object.defineProperty(_ref,"availWidth",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_availWidth,10)}});Object.defineProperty(_ref,"availHeight",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_availHeight,
10)}});Object.defineProperty(_ref,"rawWidth",{"enumerable":true,"configurable":false,"get":function(){return _screenRawWidth}});Object.defineProperty(_ref,"rawHeight",{"enumerable":true,"configurable":false,"get":function(){return _screenRawHeight}});Object.defineProperty(_ref,"width",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_screenWidth,10)}});Object.defineProperty(_ref,"height",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_screenHeight,
10)}});Object.defineProperty(_ref,"currentWidth",{"enumerable":true,"configurable":false,"get":function(){return getCurrentWidth()}});Object.defineProperty(_ref,"currentHeight",{"enumerable":true,"configurable":false,"get":function(){return getCurrentHeight()}});Object.defineProperty(_ref,"viewportWidth",{"enumerable":true,"configurable":false,"get":function(){return _viewportWidth}});Object.defineProperty(_ref,"viewportHeight",{"enumerable":true,"configurable":false,"get":function(){return _viewportHeight}});
if(typeof _ref["devicePixelRatio"]==undefined)Object.defineProperty(_ref,"devicePixelRatio",{"enumerable":true,"configurable":false,"get":function(){return _currentDevicePixelRatio}});Object.defineProperty(_ref,"scaleAndLayout",{"enumerable":true,"configurable":false,"get":function(){return getScaleAndLayout()}});Object.defineProperty(_ref,"resolutionMode",{"enumerable":true,"configurable":false,"get":function(){return _resolutionMode},"set":function(value){setResolutionMode(value)}});Object.defineProperty(_ref,
"setElement",{"enumerable":true,"configurable":false,"value":function(elem){setElement(elem)}});Object.defineProperty(_ref,"ready",{"enumerable":true,"configurable":false,"writable":false,"value":environmentReady});Object.defineProperty(_ref,"isFullscreen",{"enumerable":true,"configurable":false,"get":function(){return _isFullscreen}});Object.defineProperty(_ref,"supportsFullScreen",{"enumerable":true,"configurable":false,"get":function(){return _supportsFullScreenMode}});Object.defineProperty(_ref,
"fullScreenAvailable",{"enumerable":true,"configurable":false,"get":function(){return _fullScreenAvailable},"set":function(value){_fullScreenAvailable=value}});Object.defineProperty(_ref,"requestFullscreen",{"enumerable":true,"configurable":false,"writable":false,"value":launchFullscreenMode});Object.defineProperty(_ref,"exitFullscreen",{"enumerable":true,"configurable":false,"writable":false,"value":exitFullscreenMode});Object.defineProperty(_ref,"on",{"enumerable":true,"configurable":false,"writable":false,
"value":addEvent});Object.defineProperty(_ref,"off",{"enumerable":true,"configurable":false,"writable":false,"value":removeEvent});Object.defineProperty(_ref,"webapp",{"enumerable":true,"configurable":false,"get":function(){return typeof window.navigator.standalone!="undefined"?window.navigator.standalone:false}});Object.defineProperty(_ref,"trigger",{"enumerable":true,"configurable":false,"writable":false,"value":function(eventNames){return triggerEvent(eventNames)}});Object.defineProperty(_ref,
"update",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return updateSizeValues()}});Object.defineProperty(_ref,"crop",{"enumerable":true,"configurable":false,"get":function(){return{"width":_crop.width,"height":_crop.height}},"set":function(sizes){return crop(sizes)}});Object.defineProperty(_ref,"xZoom",{"enumerable":true,"configurable":false,"get":function(){return _xzoom}});Object.defineProperty(_ref,"getEnvironmentInformation",{"enumerable":true,"configurable":false,
"writable":false,"value":getEnvironmentInformation});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.Environment=Environment})();window.environment=new Thinfinity.Environment;
function MimeType(args){var _args={};function initialize(args){if(args!=null&&args!=undefined)for(var arg in _args)if(args[arg]!=undefined)_args[arg]=args[arg]}function getMimeType(fileExtension){var mimeType="";switch(fileExtension.toLowerCase()){case "3dm":mimeType="x-world/x-3dmf";break;case "3dmf":mimeType="x-world/x-3dmf";break;case "a":mimeType="application/octet-stream";break;case "aab":mimeType="application/x-authorware-bin";break;case "aam":mimeType="application/x-authorware-map";break;case "aas":mimeType=
"application/x-authorware-seg";break;case "abc":mimeType="text/vnd.abc";break;case "acgi":mimeType="text/html";break;case "afl":mimeType="video/animaflex";break;case "ai":mimeType="application/postscript";break;case "aif":mimeType="audio/aiff";break;case "aif":mimeType="audio/x-aiff";break;case "aifc":mimeType="audio/aiff";break;case "aifc":mimeType="audio/x-aiff";break;case "aiff":mimeType="audio/aiff";break;case "aiff":mimeType="audio/x-aiff";break;case "aim":mimeType="application/x-aim";break;
case "aip":mimeType="text/x-audiosoft-intra";break;case "ani":mimeType="application/x-navi-animation";break;case "aos":mimeType="application/x-nokia-9000-communicator-add-on-software";break;case "aps":mimeType="application/mime";break;case "arc":mimeType="application/octet-stream";break;case "arj":mimeType="application/arj";break;case "arj":mimeType="application/octet-stream";break;case "art":mimeType="image/x-jg";break;case "asf":mimeType="video/x-ms-asf";break;case "asm":mimeType="text/x-asm";break;
case "asp":mimeType="text/asp";break;case "asx":mimeType="application/x-mplayer2";break;case "asx":mimeType="video/x-ms-asf";break;case "asx":mimeType="video/x-ms-asf-plugin";break;case "au":mimeType="audio/basic";break;case "au":mimeType="audio/x-au";break;case "avi":mimeType="application/x-troff-msvideo";break;case "avi":mimeType="video/avi";break;case "avi":mimeType="video/msvideo";break;case "avi":mimeType="video/x-msvideo";break;case "avs":mimeType="video/avs-video";break;case "bcpio":mimeType=
"application/x-bcpio";break;case "bin":mimeType="application/mac-binary";break;case "bin":mimeType="application/macbinary";break;case "bin":mimeType="application/octet-stream";break;case "bin":mimeType="application/x-binary";break;case "bin":mimeType="application/x-macbinary";break;case "bm":mimeType="image/bmp";break;case "bmp":mimeType="image/bmp";break;case "bmp":mimeType="image/x-windows-bmp";break;case "boo":mimeType="application/book";break;case "book":mimeType="application/book";break;case "boz":mimeType=
"application/x-bzip2";break;case "bsh":mimeType="application/x-bsh";break;case "bz":mimeType="application/x-bzip";break;case "bz2":mimeType="application/x-bzip2";break;case "c":mimeType="text/plain";break;case "c":mimeType="text/x-c";break;case "c++":mimeType="text/plain";break;case "cat":mimeType="application/vnd.ms-pki.seccat";break;case "cc":mimeType="text/plain";break;case "cc":mimeType="text/x-c";break;case "ccad":mimeType="application/clariscad";break;case "cco":mimeType="application/x-cocoa";
break;case "cdf":mimeType="application/cdf";break;case "cdf":mimeType="application/x-cdf";break;case "cdf":mimeType="application/x-netcdf";break;case "cer":mimeType="application/pkix-cert";break;case "cer":mimeType="application/x-x509-ca-cert";break;case "cha":mimeType="application/x-chat";break;case "chat":mimeType="application/x-chat";break;case "class":mimeType="application/java";break;case "class":mimeType="application/java-byte-code";break;case "class":mimeType="application/x-java-class";break;
case "com":mimeType="application/octet-stream";break;case "com":mimeType="text/plain";break;case "conf":mimeType="text/plain";break;case "cpio":mimeType="application/x-cpio";break;case "cpp":mimeType="text/x-c";break;case "cpt":mimeType="application/mac-compactpro";break;case "cpt":mimeType="application/x-compactpro";break;case "cpt":mimeType="application/x-cpt";break;case "crl":mimeType="application/pkcs-crl";break;case "crl":mimeType="application/pkix-crl";break;case "crt":mimeType="application/pkix-cert";
break;case "crt":mimeType="application/x-x509-ca-cert";break;case "crt":mimeType="application/x-x509-user-cert";break;case "csh":mimeType="application/x-csh";break;case "csh":mimeType="text/x-script.csh";break;case "css":mimeType="application/x-pointplus";break;case "css":mimeType="text/css";break;case "cxx":mimeType="text/plain";break;case "dcr":mimeType="application/x-director";break;case "deepv":mimeType="application/x-deepv";break;case "def":mimeType="text/plain";break;case "der":mimeType="application/x-x509-ca-cert";
break;case "dif":mimeType="video/x-dv";break;case "dir":mimeType="application/x-director";break;case "dl":mimeType="video/dl";break;case "dl":mimeType="video/x-dl";break;case "doc":mimeType="application/msword";break;case "dot":mimeType="application/msword";break;case "dp":mimeType="application/commonground";break;case "drw":mimeType="application/drafting";break;case "dump":mimeType="application/octet-stream";break;case "dv":mimeType="video/x-dv";break;case "dvi":mimeType="application/x-dvi";break;
case "dwf":mimeType="drawing/x-dwf(old)";break;case "dwf":mimeType="model/vnd.dwf";break;case "dwg":mimeType="application/acad";break;case "dwg":mimeType="image/vnd.dwg";break;case "dwg":mimeType="image/x-dwg";break;case "dxf":mimeType="application/dxf";break;case "dxf":mimeType="image/vnd.dwg";break;case "dxf":mimeType="image/x-dwg";break;case "dxr":mimeType="application/x-director";break;case "el":mimeType="text/x-script.elisp";break;case "elc":mimeType="application/x-bytecode.elisp(compiledelisp)";
break;case "elc":mimeType="application/x-elc";break;case "env":mimeType="application/x-envoy";break;case "eps":mimeType="application/postscript";break;case "es":mimeType="application/x-esrehber";break;case "etx":mimeType="text/x-setext";break;case "evy":mimeType="application/envoy";break;case "evy":mimeType="application/x-envoy";break;case "exe":mimeType="application/octet-stream";break;case "f":mimeType="text/plain";break;case "f":mimeType="text/x-fortran";break;case "f77":mimeType="text/x-fortran";
break;case "f90":mimeType="text/plain";break;case "f90":mimeType="text/x-fortran";break;case "fdf":mimeType="application/vnd.fdf";break;case "fif":mimeType="application/fractals";break;case "fif":mimeType="image/fif";break;case "fli":mimeType="video/fli";break;case "fli":mimeType="video/x-fli";break;case "flo":mimeType="image/florian";break;case "flx":mimeType="text/vnd.fmi.flexstor";break;case "fmf":mimeType="video/x-atomic3d-feature";break;case "for":mimeType="text/plain";break;case "for":mimeType=
"text/x-fortran";break;case "fpx":mimeType="image/vnd.fpx";break;case "fpx":mimeType="image/vnd.net-fpx";break;case "frl":mimeType="application/freeloader";break;case "funk":mimeType="audio/make";break;case "g":mimeType="text/plain";break;case "g3":mimeType="image/g3fax";break;case "gif":mimeType="image/gif";break;case "gl":mimeType="video/gl";break;case "gl":mimeType="video/x-gl";break;case "gsd":mimeType="audio/x-gsm";break;case "gsm":mimeType="audio/x-gsm";break;case "gsp":mimeType="application/x-gsp";
break;case "gss":mimeType="application/x-gss";break;case "gtar":mimeType="application/x-gtar";break;case "gz":mimeType="application/x-compressed";break;case "gz":mimeType="application/x-gzip";break;case "gzip":mimeType="application/x-gzip";break;case "gzip":mimeType="multipart/x-gzip";break;case "h":mimeType="text/plain";break;case "h":mimeType="text/x-h";break;case "hdf":mimeType="application/x-hdf";break;case "help":mimeType="application/x-helpfile";break;case "hgl":mimeType="application/vnd.hp-hpgl";
break;case "hh":mimeType="text/plain";break;case "hh":mimeType="text/x-h";break;case "hlb":mimeType="text/x-script";break;case "hlp":mimeType="application/hlp";break;case "hlp":mimeType="application/x-helpfile";break;case "hlp":mimeType="application/x-winhelp";break;case "hpg":mimeType="application/vnd.hp-hpgl";break;case "hpgl":mimeType="application/vnd.hp-hpgl";break;case "hqx":mimeType="application/binhex";break;case "hqx":mimeType="application/binhex4";break;case "hqx":mimeType="application/mac-binhex";
break;case "hqx":mimeType="application/mac-binhex40";break;case "hqx":mimeType="application/x-binhex40";break;case "hqx":mimeType="application/x-mac-binhex40";break;case "hta":mimeType="application/hta";break;case "htc":mimeType="text/x-component";break;case "htm":mimeType="text/html";break;case "html":mimeType="text/html";break;case "htmls":mimeType="text/html";break;case "htt":mimeType="text/webviewhtml";break;case "htx":mimeType="text/html";break;case "ice":mimeType="x-conference/x-cooltalk";break;
case "ico":mimeType="image/x-icon";break;case "idc":mimeType="text/plain";break;case "ief":mimeType="image/ief";break;case "iefs":mimeType="image/ief";break;case "iges":mimeType="application/iges";break;case "iges":mimeType="model/iges";break;case "igs":mimeType="application/iges";break;case "igs":mimeType="model/iges";break;case "ima":mimeType="application/x-ima";break;case "imap":mimeType="application/x-httpd-imap";break;case "inf":mimeType="application/inf";break;case "ins":mimeType="application/x-internett-signup";
break;case "ip":mimeType="application/x-ip2";break;case "isu":mimeType="video/x-isvideo";break;case "it":mimeType="audio/it";break;case "iv":mimeType="application/x-inventor";break;case "ivr":mimeType="i-world/i-vrml";break;case "ivy":mimeType="application/x-livescreen";break;case "jam":mimeType="audio/x-jam";break;case "jav":mimeType="text/plain";break;case "jav":mimeType="text/x-java-source";break;case "java":mimeType="text/plain";break;case "java":mimeType="text/x-java-source";break;case "jcm":mimeType=
"application/x-java-commerce";break;case "jfif":mimeType="image/jpeg";break;case "jfif":mimeType="image/pjpeg";break;case "jfif-tbnl":mimeType="image/jpeg";break;case "jpe":mimeType="image/jpeg";break;case "jpe":mimeType="image/pjpeg";break;case "jpeg":mimeType="image/jpeg";break;case "jpeg":mimeType="image/pjpeg";break;case "jpg":mimeType="image/jpeg";break;case "jpg":mimeType="image/pjpeg";break;case "jps":mimeType="image/x-jps";break;case "js":mimeType="application/x-javascript";break;case "js":mimeType=
"application/javascript";break;case "js":mimeType="application/ecmascript";break;case "js":mimeType="text/javascript";break;case "js":mimeType="text/ecmascript";break;case "jut":mimeType="image/jutvision";break;case "kar":mimeType="audio/midi";break;case "kar":mimeType="music/x-karaoke";break;case "ksh":mimeType="application/x-ksh";break;case "ksh":mimeType="text/x-script.ksh";break;case "la":mimeType="audio/nspaudio";break;case "la":mimeType="audio/x-nspaudio";break;case "lam":mimeType="audio/x-liveaudio";
break;case "latex":mimeType="application/x-latex";break;case "lha":mimeType="application/lha";break;case "lha":mimeType="application/octet-stream";break;case "lha":mimeType="application/x-lha";break;case "lhx":mimeType="application/octet-stream";break;case "list":mimeType="text/plain";break;case "lma":mimeType="audio/nspaudio";break;case "lma":mimeType="audio/x-nspaudio";break;case "log":mimeType="text/plain";break;case "lsp":mimeType="application/x-lisp";break;case "lsp":mimeType="text/x-script.lisp";
break;case "lst":mimeType="text/plain";break;case "lsx":mimeType="text/x-la-asf";break;case "ltx":mimeType="application/x-latex";break;case "lzh":mimeType="application/octet-stream";break;case "lzh":mimeType="application/x-lzh";break;case "lzx":mimeType="application/lzx";break;case "lzx":mimeType="application/octet-stream";break;case "lzx":mimeType="application/x-lzx";break;case "m":mimeType="text/plain";break;case "m":mimeType="text/x-m";break;case "m1v":mimeType="video/mpeg";break;case "m2a":mimeType=
"audio/mpeg";break;case "m2v":mimeType="video/mpeg";break;case "m3u":mimeType="audio/x-mpequrl";break;case "man":mimeType="application/x-troff-man";break;case "map":mimeType="application/x-navimap";break;case "mar":mimeType="text/plain";break;case "mbd":mimeType="application/mbedlet";break;case "mc$":mimeType="application/x-magic-cap-package-1.0";break;case "mcd":mimeType="application/mcad";break;case "mcd":mimeType="application/x-mathcad";break;case "mcf":mimeType="image/vasa";break;case "mcf":mimeType=
"text/mcf";break;case "mcp":mimeType="application/netmc";break;case "me":mimeType="application/x-troff-me";break;case "mht":mimeType="message/rfc822";break;case "mhtml":mimeType="message/rfc822";break;case "mid":mimeType="application/x-midi";break;case "mid":mimeType="audio/midi";break;case "mid":mimeType="audio/x-mid";break;case "mid":mimeType="audio/x-midi";break;case "mid":mimeType="music/crescendo";break;case "mid":mimeType="x-music/x-midi";break;case "midi":mimeType="application/x-midi";break;
case "midi":mimeType="audio/midi";break;case "midi":mimeType="audio/x-mid";break;case "midi":mimeType="audio/x-midi";break;case "midi":mimeType="music/crescendo";break;case "midi":mimeType="x-music/x-midi";break;case "mif":mimeType="application/x-frame";break;case "mif":mimeType="application/x-mif";break;case "mime":mimeType="message/rfc822";break;case "mime":mimeType="www/mime";break;case "mjf":mimeType="audio/x-vnd.audioexplosion.mjuicemediafile";break;case "mjpg":mimeType="video/x-motion-jpeg";
break;case "mm":mimeType="application/base64";break;case "mm":mimeType="application/x-meme";break;case "mme":mimeType="application/base64";break;case "mod":mimeType="audio/mod";break;case "mod":mimeType="audio/x-mod";break;case "moov":mimeType="video/quicktime";break;case "mov":mimeType="video/quicktime";break;case "movie":mimeType="video/x-sgi-movie";break;case "mp2":mimeType="audio/mpeg";break;case "mp2":mimeType="audio/x-mpeg";break;case "mp2":mimeType="video/mpeg";break;case "mp2":mimeType="video/x-mpeg";
break;case "mp2":mimeType="video/x-mpeq2a";break;case "mp3":mimeType="audio/mpeg3";break;case "mp3":mimeType="audio/x-mpeg-3";break;case "mp3":mimeType="video/mpeg";break;case "mp3":mimeType="video/x-mpeg";break;case "mpa":mimeType="audio/mpeg";break;case "mpa":mimeType="video/mpeg";break;case "mpc":mimeType="application/x-project";break;case "mpe":mimeType="video/mpeg";break;case "mpeg":mimeType="video/mpeg";break;case "mpg":mimeType="audio/mpeg";break;case "mpg":mimeType="video/mpeg";break;case "mpga":mimeType=
"audio/mpeg";break;case "mpp":mimeType="application/vnd.ms-project";break;case "mpt":mimeType="application/x-project";break;case "mpv":mimeType="application/x-project";break;case "mpx":mimeType="application/x-project";break;case "mrc":mimeType="application/marc";break;case "ms":mimeType="application/x-troff-ms";break;case "mv":mimeType="video/x-sgi-movie";break;case "my":mimeType="audio/make";break;case "mzz":mimeType="application/x-vnd.audioexplosion.mzz";break;case "nap":mimeType="image/naplps";
break;case "naplps":mimeType="image/naplps";break;case "nc":mimeType="application/x-netcdf";break;case "ncm":mimeType="application/vnd.nokia.configuration-message";break;case "nif":mimeType="image/x-niff";break;case "niff":mimeType="image/x-niff";break;case "nix":mimeType="application/x-mix-transfer";break;case "nsc":mimeType="application/x-conference";break;case "nvd":mimeType="application/x-navidoc";break;case "o":mimeType="application/octet-stream";break;case "oda":mimeType="application/oda";break;
case "omc":mimeType="application/x-omc";break;case "omcd":mimeType="application/x-omcdatamaker";break;case "omcr":mimeType="application/x-omcregerator";break;case "p":mimeType="text/x-pascal";break;case "p10":mimeType="application/pkcs10";break;case "p10":mimeType="application/x-pkcs10";break;case "p12":mimeType="application/pkcs-12";break;case "p12":mimeType="application/x-pkcs12";break;case "p7a":mimeType="application/x-pkcs7-signature";break;case "p7c":mimeType="application/pkcs7-mime";break;case "p7c":mimeType=
"application/x-pkcs7-mime";break;case "p7m":mimeType="application/pkcs7-mime";break;case "p7m":mimeType="application/x-pkcs7-mime";break;case "p7r":mimeType="application/x-pkcs7-certreqresp";break;case "p7s":mimeType="application/pkcs7-signature";break;case "part":mimeType="application/pro_eng";break;case "pas":mimeType="text/pascal";break;case "pbm":mimeType="image/x-portable-bitmap";break;case "pcl":mimeType="application/vnd.hp-pcl";break;case "pcl":mimeType="application/x-pcl";break;case "pct":mimeType=
"image/x-pict";break;case "pcx":mimeType="image/x-pcx";break;case "pdb":mimeType="chemical/x-pdb";break;case "pdf":mimeType="application/pdf";break;case "pfunk":mimeType="audio/make";break;case "pfunk":mimeType="audio/make.my.funk";break;case "pgm":mimeType="image/x-portable-graymap";break;case "pgm":mimeType="image/x-portable-greymap";break;case "pic":mimeType="image/pict";break;case "pict":mimeType="image/pict";break;case "pkg":mimeType="application/x-newton-compatible-pkg";break;case "pko":mimeType=
"application/vnd.ms-pki.pko";break;case "pl":mimeType="text/plain";break;case "pl":mimeType="text/x-script.perl";break;case "plx":mimeType="application/x-pixclscript";break;case "pm":mimeType="image/x-xpixmap";break;case "pm":mimeType="text/x-script.perl-module";break;case "pm4":mimeType="application/x-pagemaker";break;case "pm5":mimeType="application/x-pagemaker";break;case "png":mimeType="image/png";break;case "pnm":mimeType="application/x-portable-anymap";break;case "pnm":mimeType="image/x-portable-anymap";
break;case "pot":mimeType="application/mspowerpoint";break;case "pot":mimeType="application/vnd.ms-powerpoint";break;case "pov":mimeType="model/x-pov";break;case "ppa":mimeType="application/vnd.ms-powerpoint";break;case "ppm":mimeType="image/x-portable-pixmap";break;case "pps":mimeType="application/mspowerpoint";break;case "pps":mimeType="application/vnd.ms-powerpoint";break;case "ppt":mimeType="application/mspowerpoint";break;case "ppt":mimeType="application/powerpoint";break;case "ppt":mimeType=
"application/vnd.ms-powerpoint";break;case "ppt":mimeType="application/x-mspowerpoint";break;case "ppz":mimeType="application/mspowerpoint";break;case "pre":mimeType="application/x-freelance";break;case "prt":mimeType="application/pro_eng";break;case "ps":mimeType="application/postscript";break;case "psd":mimeType="application/octet-stream";break;case "pvu":mimeType="paleovu/x-pv";break;case "pwz":mimeType="application/vnd.ms-powerpoint";break;case "py":mimeType="text/x-script.phyton";break;case "pyc":mimeType=
"application/x-bytecode.python";break;case "qcp":mimeType="audio/vnd.qcelp";break;case "qd3":mimeType="x-world/x-3dmf";break;case "qd3d":mimeType="x-world/x-3dmf";break;case "qif":mimeType="image/x-quicktime";break;case "qt":mimeType="video/quicktime";break;case "qtc":mimeType="video/x-qtc";break;case "qti":mimeType="image/x-quicktime";break;case "qtif":mimeType="image/x-quicktime";break;case "ra":mimeType="audio/x-pn-realaudio";break;case "ra":mimeType="audio/x-pn-realaudio-plugin";break;case "ra":mimeType=
"audio/x-realaudio";break;case "ram":mimeType="audio/x-pn-realaudio";break;case "ras":mimeType="application/x-cmu-raster";break;case "ras":mimeType="image/cmu-raster";break;case "ras":mimeType="image/x-cmu-raster";break;case "rast":mimeType="image/cmu-raster";break;case "rexx":mimeType="text/x-script.rexx";break;case "rf":mimeType="image/vnd.rn-realflash";break;case "rgb":mimeType="image/x-rgb";break;case "rm":mimeType="application/vnd.rn-realmedia";break;case "rm":mimeType="audio/x-pn-realaudio";
break;case "rmi":mimeType="audio/mid";break;case "rmm":mimeType="audio/x-pn-realaudio";break;case "rmp":mimeType="audio/x-pn-realaudio";break;case "rmp":mimeType="audio/x-pn-realaudio-plugin";break;case "rng":mimeType="application/ringing-tones";break;case "rng":mimeType="application/vnd.nokia.ringing-tone";break;case "rnx":mimeType="application/vnd.rn-realplayer";break;case "roff":mimeType="application/x-troff";break;case "rp":mimeType="image/vnd.rn-realpix";break;case "rpm":mimeType="audio/x-pn-realaudio-plugin";
break;case "rt":mimeType="text/richtext";break;case "rt":mimeType="text/vnd.rn-realtext";break;case "rtf":mimeType="application/rtf";break;case "rtf":mimeType="application/x-rtf";break;case "rtf":mimeType="text/richtext";break;case "rtx":mimeType="application/rtf";break;case "rtx":mimeType="text/richtext";break;case "rv":mimeType="video/vnd.rn-realvideo";break;case "s":mimeType="text/x-asm";break;case "s3m":mimeType="audio/s3m";break;case "saveme":mimeType="application/octet-stream";break;case "sbk":mimeType=
"application/x-tbook";break;case "scm":mimeType="application/x-lotusscreencam";break;case "scm":mimeType="text/x-script.guile";break;case "scm":mimeType="text/x-script.scheme";break;case "scm":mimeType="video/x-scm";break;case "sdml":mimeType="text/plain";break;case "sdp":mimeType="application/sdp";break;case "sdp":mimeType="application/x-sdp";break;case "sdr":mimeType="application/sounder";break;case "sea":mimeType="application/sea";break;case "sea":mimeType="application/x-sea";break;case "set":mimeType=
"application/set";break;case "sgm":mimeType="text/sgml";break;case "sgm":mimeType="text/x-sgml";break;case "sgml":mimeType="text/sgml";break;case "sgml":mimeType="text/x-sgml";break;case "sh":mimeType="application/x-bsh";break;case "sh":mimeType="application/x-sh";break;case "sh":mimeType="application/x-shar";break;case "sh":mimeType="text/x-script.sh";break;case "shar":mimeType="application/x-bsh";break;case "shar":mimeType="application/x-shar";break;case "shtml":mimeType="text/html";break;case "shtml":mimeType=
"text/x-server-parsed-html";break;case "sid":mimeType="audio/x-psid";break;case "sit":mimeType="application/x-sit";break;case "sit":mimeType="application/x-stuffit";break;case "skd":mimeType="application/x-koan";break;case "skm":mimeType="application/x-koan";break;case "skp":mimeType="application/x-koan";break;case "skt":mimeType="application/x-koan";break;case "sl":mimeType="application/x-seelogo";break;case "smi":mimeType="application/smil";break;case "smil":mimeType="application/smil";break;case "snd":mimeType=
"audio/basic";break;case "snd":mimeType="audio/x-adpcm";break;case "sol":mimeType="application/solids";break;case "spc":mimeType="application/x-pkcs7-certificates";break;case "spc":mimeType="text/x-speech";break;case "spl":mimeType="application/futuresplash";break;case "spr":mimeType="application/x-sprite";break;case "sprite":mimeType="application/x-sprite";break;case "src":mimeType="application/x-wais-source";break;case "ssi":mimeType="text/x-server-parsed-html";break;case "ssm":mimeType="application/streamingmedia";
break;case "sst":mimeType="application/vnd.ms-pki.certstore";break;case "step":mimeType="application/step";break;case "stl":mimeType="application/sla";break;case "stl":mimeType="application/vnd.ms-pki.stl";break;case "stl":mimeType="application/x-navistyle";break;case "stp":mimeType="application/step";break;case "sv4cpio":mimeType="application/x-sv4cpio";break;case "sv4crc":mimeType="application/x-sv4crc";break;case "svf":mimeType="image/vnd.dwg";break;case "svf":mimeType="image/x-dwg";break;case "svr":mimeType=
"application/x-world";break;case "svr":mimeType="x-world/x-svr";break;case "swf":mimeType="application/x-shockwave-flash";break;case "t":mimeType="application/x-troff";break;case "talk":mimeType="text/x-speech";break;case "tar":mimeType="application/x-tar";break;case "tbk":mimeType="application/toolbook";break;case "tbk":mimeType="application/x-tbook";break;case "tcl":mimeType="application/x-tcl";break;case "tcl":mimeType="text/x-script.tcl";break;case "tcsh":mimeType="text/x-script.tcsh";break;case "tex":mimeType=
"application/x-tex";break;case "texi":mimeType="application/x-texinfo";break;case "texinfo":mimeType="application/x-texinfo";break;case "text":mimeType="application/plain";break;case "text":mimeType="text/plain";break;case "tgz":mimeType="application/gnutar";break;case "tgz":mimeType="application/x-compressed";break;case "tif":mimeType="image/tiff";break;case "tif":mimeType="image/x-tiff";break;case "tiff":mimeType="image/tiff";break;case "tiff":mimeType="image/x-tiff";break;case "tr":mimeType="application/x-troff";
break;case "tsi":mimeType="audio/tsp-audio";break;case "tsp":mimeType="application/dsptype";break;case "tsp":mimeType="audio/tsplayer";break;case "tsv":mimeType="text/tab-separated-values";break;case "turbot":mimeType="image/florian";break;case "txt":mimeType="text/plain";break;case "uil":mimeType="text/x-uil";break;case "uni":mimeType="text/uri-list";break;case "unis":mimeType="text/uri-list";break;case "unv":mimeType="application/i-deas";break;case "uri":mimeType="text/uri-list";break;case "uris":mimeType=
"text/uri-list";break;case "ustar":mimeType="application/x-ustar";break;case "ustar":mimeType="multipart/x-ustar";break;case "uu":mimeType="application/octet-stream";break;case "uu":mimeType="text/x-uuencode";break;case "uue":mimeType="text/x-uuencode";break;case "vcd":mimeType="application/x-cdlink";break;case "vcs":mimeType="text/x-vcalendar";break;case "vda":mimeType="application/vda";break;case "vdo":mimeType="video/vdo";break;case "vew":mimeType="application/groupwise";break;case "viv":mimeType=
"video/vivo";break;case "viv":mimeType="video/vnd.vivo";break;case "vivo":mimeType="video/vivo";break;case "vivo":mimeType="video/vnd.vivo";break;case "vmd":mimeType="application/vocaltec-media-desc";break;case "vmf":mimeType="application/vocaltec-media-file";break;case "voc":mimeType="audio/voc";break;case "voc":mimeType="audio/x-voc";break;case "vos":mimeType="video/vosaic";break;case "vox":mimeType="audio/voxware";break;case "vqe":mimeType="audio/x-twinvq-plugin";break;case "vqf":mimeType="audio/x-twinvq";
break;case "vql":mimeType="audio/x-twinvq-plugin";break;case "vrml":mimeType="application/x-vrml";break;case "vrml":mimeType="model/vrml";break;case "vrml":mimeType="x-world/x-vrml";break;case "vrt":mimeType="x-world/x-vrt";break;case "vsd":mimeType="application/x-visio";break;case "vst":mimeType="application/x-visio";break;case "vsw":mimeType="application/x-visio";break;case "w60":mimeType="application/wordperfect6.0";break;case "w61":mimeType="application/wordperfect6.1";break;case "w6w":mimeType=
"application/msword";break;case "wav":mimeType="audio/wav";break;case "wav":mimeType="audio/x-wav";break;case "wb1":mimeType="application/x-qpro";break;case "wbmp":mimeType="image/vnd.wap.wbmp";break;case "web":mimeType="application/vnd.xara";break;case "wiz":mimeType="application/msword";break;case "wk1":mimeType="application/x-123";break;case "wmf":mimeType="windows/metafile";break;case "wml":mimeType="text/vnd.wap.wml";break;case "wmlc":mimeType="application/vnd.wap.wmlc";break;case "wmls":mimeType=
"text/vnd.wap.wmlscript";break;case "wmlsc":mimeType="application/vnd.wap.wmlscriptc";break;case "word":mimeType="application/msword";break;case "wp":mimeType="application/wordperfect";break;case "wp5":mimeType="application/wordperfect";break;case "wp5":mimeType="application/wordperfect6.0";break;case "wp6":mimeType="application/wordperfect";break;case "wpd":mimeType="application/wordperfect";break;case "wpd":mimeType="application/x-wpwin";break;case "wq1":mimeType="application/x-lotus";break;case "wri":mimeType=
"application/mswrite";break;case "wri":mimeType="application/x-wri";break;case "wrl":mimeType="application/x-world";break;case "wrl":mimeType="model/vrml";break;case "wrl":mimeType="x-world/x-vrml";break;case "wrz":mimeType="model/vrml";break;case "wrz":mimeType="x-world/x-vrml";break;case "wsc":mimeType="text/scriplet";break;case "wsrc":mimeType="application/x-wais-source";break;case "wtk":mimeType="application/x-wintalk";break;case "xbm":mimeType="image/x-xbitmap";break;case "xbm":mimeType="image/x-xbm";
break;case "xbm":mimeType="image/xbm";break;case "xdr":mimeType="video/x-amt-demorun";break;case "xgz":mimeType="xgl/drawing";break;case "xif":mimeType="image/vnd.xiff";break;case "xl":mimeType="application/excel";break;case "xla":mimeType="application/excel";break;case "xla":mimeType="application/x-excel";break;case "xla":mimeType="application/x-msexcel";break;case "xlb":mimeType="application/excel";break;case "xlb":mimeType="application/vnd.ms-excel";break;case "xlb":mimeType="application/x-excel";
break;case "xlc":mimeType="application/excel";break;case "xlc":mimeType="application/vnd.ms-excel";break;case "xlc":mimeType="application/x-excel";break;case "xld":mimeType="application/excel";break;case "xld":mimeType="application/x-excel";break;case "xlk":mimeType="application/excel";break;case "xlk":mimeType="application/x-excel";break;case "xll":mimeType="application/excel";break;case "xll":mimeType="application/vnd.ms-excel";break;case "xll":mimeType="application/x-excel";break;case "xlm":mimeType=
"application/excel";break;case "xlm":mimeType="application/vnd.ms-excel";break;case "xlm":mimeType="application/x-excel";break;case "xls":mimeType="application/excel";break;case "xls":mimeType="application/vnd.ms-excel";break;case "xls":mimeType="application/x-excel";break;case "xls":mimeType="application/x-msexcel";break;case "xlt":mimeType="application/excel";break;case "xlt":mimeType="application/x-excel";break;case "xlv":mimeType="application/excel";break;case "xlv":mimeType="application/x-excel";
break;case "xlw":mimeType="application/excel";break;case "xlw":mimeType="application/vnd.ms-excel";break;case "xlw":mimeType="application/x-excel";break;case "xlw":mimeType="application/x-msexcel";break;case "xm":mimeType="audio/xm";break;case "xml":mimeType="application/xml";break;case "xml":mimeType="text/xml";break;case "xmz":mimeType="xgl/movie";break;case "xpix":mimeType="application/x-vnd.ls-xpix";break;case "xpm":mimeType="image/x-xpixmap";break;case "xpm":mimeType="image/xpm";break;case "x-png":mimeType=
"image/png";break;case "xsr":mimeType="video/x-amt-showrun";break;case "xwd":mimeType="image/x-xwd";break;case "xwd":mimeType="image/x-xwindowdump";break;case "xyz":mimeType="chemical/x-pdb";break;case "z":mimeType="application/x-compress";break;case "z":mimeType="application/x-compressed";break;case "zip":mimeType="application/x-compressed";break;case "zip":mimeType="application/x-zip-compressed";break;case "zip":mimeType="application/zip";break;case "zip":mimeType="multipart/x-zip";break;case "zoo":mimeType=
"application/octet-stream";break;case "zsh":mimeType="text/x-script.zsh";break}return mimeType}function getExtension(fileName){var extension="";if(typeof fileName!="undefined"&&fileName!=null){var askIndex=fileName.indexOf("?");if(askIndex!=-1)fileName=fileName.substr(0,askIndex);var lastIndexOf=fileName.lastIndexOf(".");if(lastIndexOf!=-1)extension=fileName.substr(lastIndexOf+1,fileName.length-lastIndexOf-1)}return extension}function get(fileName){return getMimeType(getExtension(fileName))}Object.defineProperty(this,
"get",{"enumerable":true,"configurable":false,"writeble":false,"value":get});Object.defineProperty(this,"getExtension",{"enumerable":true,"configurable":false,"writeble":false,"value":getExtension});Object.defineProperty(this,"getMimeType",{"enumerable":true,"configurable":false,"writeble":false,"value":getMimeType});initialize(args);return this}var MimeType=new MimeType({});
(function(){const _swstate={"installing":0,"installed":1,"activating":2,"activated":3,"redundant":4};if(Object.freeze)Object.freeze(_swstate);function ServiceWorkerRegistrator(){var _ref=this;var _isAvailable=false;var _notSupportedMsg="Service Workers are not supported by your browser.";var _notSupportedHandler=function(){return _notSupportedMsg};var _notSupportedPromise=function(){return new Promise((resolve,reject)=>{reject(_notSupportedMsg)})};let _controller=null;function initialize(){if("serviceWorker"in
window.navigator)_isAvailable=true;else console.warn(`Service Worker is not available in your browser. "serviceWorker" is not in window.navigator object.`)}function initializeNewService(workerUrl,options){return new Promise(function(resolve,reject){if(options===undefined)options={};window.navigator.serviceWorker.register(workerUrl,options).then(()=>{getInstalledService(options.scope).then(resolve).catch(reject)}).catch(function(error){console.warn("Service worker registration failed:",error);_notSupportedMsg=
error;reject(error)})})}function unregisterService(clientURL,matchCase){return new Promise((resolve,reject)=>{clientURL=normalizeScope(clientURL);getInstalledService(clientURL).then(result=>{if(result&&result.unregister)result.unregister().then(resolve).catch(reject);else if(matchCase===false)unregisterServiceUnMatchCase(clientURL).then(resolve).catch(reject)}).catch(reject)})}function unregisterServiceUnMatchCase(clientURL){return new Promise((resolve,reject)=>{navigator.serviceWorker.getRegistrations().then(registrations=>
{if(registrations){clientURL=clientURL.toLowerCase();let proms=[];registrations.forEach(reg=>{let scope=reg.scope.replace(location.origin,"");if(scope.toLowerCase()===clientURL)proms.push(reg.unregister())});Promise.all(proms).then(resolve).catch(reject)}})})}function normalizeScope(scope){if(scope){if(scope==="/")return scope;let scopes=scope.split("/").filter(s=>s!=="");if(scopes.length==1)return`/${scopes[0]}/`;else return null}else return null}function getInstalledService(clientURL){return new Promise(function(resolve,
reject){if(clientURL!=="")navigator.serviceWorker.getRegistration(clientURL).then(resolve).catch(reject);else reject("Invalid clientURL")})}function getController(){return new Promise((resolve,reject)=>{if(navigator.serviceWorker.controller)resolve(navigator.serviceWorker.controller);else{console.warn(`Controller is not running, please wait...`);let timeoutId=null;timeoutId=setTimeout(()=>{reject(`ServiceWorker is not controlling the page..., trying to reload...`)},45E3);navigator.serviceWorker.ready.then(e=>
{clearTimeout(timeoutId);resolve(navigator.serviceWorker.controller)}).catch(err=>{clearTimeout(timeoutId);reject(null)})}})}function sendMessage(msg,port){return new Promise((resolve,reject)=>{let sendMsg=(msg,port)=>{_controller.postMessage(msg,port)};if(!_controller)getController().then(controller=>{_controller=controller;sendMsg(msg,port);resolve(true)}).catch(err=>{console.warn(`Cannot send message, controller is not ready yet, ${err.message||err}`);reject(err)});else{sendMsg(msg,port);resolve(true)}})}
initialize();Object.defineProperty(_ref,"isSupported",{"enumerable":true,"configurable":false,"get":_isAvailable?()=>{return true}:_notSupportedHandler});Object.defineProperty(_ref,"initializeNewService",{"enumerable":true,"configurable":false,"writable":false,"value":_isAvailable?initializeNewService:_notSupportedPromise});Object.defineProperty(_ref,"unregisterService",{"enumerable":true,"configurable":false,"writable":false,"value":_isAvailable?unregisterService:_notSupportedPromise});Object.defineProperty(_ref,
"getInstalledService",{"enumerable":true,"configurable":false,"writable":false,"value":_isAvailable?getInstalledService:_notSupportedPromise});Object.defineProperty(_ref,"sendMessage",{"enumerable":true,"configurable":false,"writable":false,"value":_isAvailable?sendMessage:_notSupportedPromise});return _ref}try{Thinfinity!==undefined}catch(e){Thinfinity={}}if(Thinfinity.Service===undefined)Thinfinity.Service={};Thinfinity.Service.Worker=new ServiceWorkerRegistrator;Object.defineProperty(Thinfinity.Service.Worker,
"state",{"enumerable":true,"configurable":false,"get":function(){return _swstate}})})();
(function(){var _ref=this;function initialize(){try{let basepath="<%=@BASEURL%>";if(window?.Thinfinity?.Service?.Worker?.unregisterService){let proms=[];let vRoot="/";let pathnames=window.location.pathname.split("/").filter(f=>{return f!==""});let vp=null;if(pathnames.length>0){if(basepath!=="/"){basepath=basepath.split("/").filter(f=>{return f!==""});basepath=basepath.pop();let idx=pathnames.findIndex(p=>{return p.toLowerCase()==basepath.toLowerCase()});if(idx!==null)pathnames=pathnames.splice(idx+
1)}vp=pathnames.length>0?`/${pathnames.pop()}/`:null;if(pathnames.length>0)vRoot=`/${pathnames.join("/")}/`}proms.push(Thinfinity.Service.Worker.unregisterService(vRoot,false));if(vp)proms.push(Thinfinity.Service.Worker.unregisterService(vp,false));Promise.all(proms).then(result=>{if(result[0]==true){if(window?.indexedDB)window.indexedDB.deleteDatabase("thinfinity.indexeddb.wvpn");console.log(`Service worker was successful uninstall for ${vRoot} scope, and IndexedDB was removed also.`)}if(result[1]==
true){console.log(`Service worker was successful uninstall for ${vp} scope.`);if(Thinfinity?.WAG?.Rules?.remove)Thinfinity.WAG.Rules.remove()}}).catch(err=>{console.log(`Cannot unregister Service Worker: ${err.message||err}`)})}}catch(error){console.log(`Cannot unregister service worker. ${error.message||error}`)}}initialize()})();
(function(){function Events(args){var _ref=this;var _events=[];var _args={fireEventArgs:{async:1}};var _noop=function(){};function initialize(){helper.object.parseAttributes(_args,args);if(!args.owner)args.owner=_ref;if(args.events)for(var name in args.events)on(name,args.events[name])}function on(events,handler){if(events==undefined||events==null||events=="")return"Event is undefined or null.";if(!(events instanceof Array))events=events.split(",");if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";
events.forEach(function(eventName){if(_events[eventName]==undefined)_events[eventName]=[];_events[eventName].push(handler)});return args.owner}function off(events,handler){if(events==undefined||events==null||events=="")return"Event is undefined or null.";if(!(events instanceof Array))events=events.split(",");if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";events.forEach(function(eventName){if(_events[eventName])for(var i=_events[eventName].length-1;i>=0;i--)if(_events[eventName][i]===
handler)_events[eventName].splice(i,1)});return args.owner}function fireEvent(){var name=null;var data=null;var jArgs=null;name=arguments[0];var response=[];if(_events[name]&&_events[name].length>0){if(arguments.length<=3){data=[arguments[1]];jArgs=arguments[2]}else{var len=arguments.length;jArgs=arguments[len-1];data=[];for(let i=1,t=len-1;i<t;i++)data.push(arguments[i])}if(!jArgs)jArgs=_args.fireEventArgs;for(var i=0;i<_events[name].length;i++)try{if(jArgs.async===false||jArgs.async===0)response[i]=
_events[name][i].apply(null,data);else{var time=parseInt(jArgs.async,10);if(time.toString()==="NaN")time=1;setTimeout(function(args){if(_events[name]&&_events[name][args[0]])response[i]=_events[name][args[0]].apply(null,data);if(i==_events[name].length-1)if(jArgs.callback)jArgs.callback(getResponse(response))},time,[i])}}catch(error){console.warn("Uncaught error: "+error.message,arguments);response[i]=error.message}}return getResponse(response)}function getResponse(a){Object.defineProperty(a,"preventExecution",
{"enumerable":true,"configurable":false,"get":function(){return a.find(function(elem){return elem===true})}});return a}function hasHandler(event){return _events[event]&&_events[event].length>0}function dispose(){_events=[];delete args.owner.on;delete args.owner.off;delete _ref["fireEvent"];on=off=fireEvent=_noop}initialize();let override=args.owner===_ref;Object.defineProperty(args.owner,"on",{"enumerable":true,"configurable":override,"value":on});Object.defineProperty(args.owner,"off",{"enumerable":true,
"configurable":override,"value":off});Object.defineProperty(_ref,"hasHandler",{"enumerable":true,"configurable":override,"value":hasHandler});Object.defineProperty(_ref,"dispose",{"enumerable":true,"configurable":override,"writable":override,"value":dispose});Object.defineProperty(_ref,"fireEvent",{"enumerable":true,"configurable":override,"value":fireEvent});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.Events=Events})();
function JSLogAPI(Server){var _TVNC=Server;this._log=function(msgType,msgText,msgDest){if(typeof msgDest=="undefined"||msgDest=="")msgDest="*";var cmd="cmd=jslogapi"+"&dest="+escape(msgDest)+"&type="+escape(msgType)+"&text="+escape(msgText);_TVNC.sendCmd(cmd)};this.logDebug=function(text,dest){this._log("debug",text,dest)};this.logInfo=function(text,dest){this._log("info",text,dest)};this.logError=function(text,dest){this._log("error",text,dest)};this.logWarning=function(text,dest){this._log("warning",
text,dest)};this.errorReport=function(reportData){this._log("report",reportData)}}function getISOTime(){var now=new Date;if(typeof now.toISOString!="undefined"){var ret=now.toISOString();ret=ret.substr(ret.indexOf("T")+1,12);return ret}else return("0"+now.getUTCHours()).substr(-2)+":"+("0"+now.getUTCMinutes()).substr(-2)+":"+("0"+now.getUTCSeconds()).substr(-2)+"."+now.getUTCMilliseconds()}
function logDebug(value){value=getISOTime()+": "+value;if(typeof MsgLogger=="undefined"){if(window.console&&window.console.log)window.console.log(value)}else logDebugW(value)}function logError(value){value=getISOTime()+": "+value;if(typeof MsgLogger=="undefined"){if(window.console&&window.console.error){window.console.error(value);return value}}else logErrorW(value)}var oMsgLogger=null;function logDebugW(value){if(!oMsgLogger)oMsgLogger=new MsgLogger;oMsgLogger.log(value)}
function logErrorW(value){logDebugW("ERROR: "+value)}
(function(){function TabFocusHook(args){var _ref=this;var _tabFocusHook=this;var _focusAttached=false;var _visibilityChange=null;var _hasFocus=null;var fireEvent=null;var _states=helper.object.createEnum({"BLUR":"blur","FOCUS":"focus"});var _lastState={"focus":null,"visible":null,"visibility":null,name:null,evt:null};var _vstates=helper.object.createEnum({"VISIBLE":"visible","HIDDEN":"hidden"});var _evisibility=helper.object.createEnum({"VISIBLE":"visible","HIDDEN":"hidden","OCCLUDED":"occluded",
"UNKNOWN":"unknown"});var _lastDocumentVisibility=null;var te=null;function initialize(){te=new Thinfinity.Events({"owner":_ref});fireEvent=te.fireEvent;_lastState.focus=!isHidden()?_states.FOCUS:_states.BLUR;_lastState.visible=document.visibilityState;_lastState.visibility=getVisibilityName(_lastState.visible,_lastState.focus);observeDocumentVisibility()}function getVisibilityName(visibility,focus){if(visibility===_vstates.VISIBLE)return focus===_states.FOCUS?_evisibility.VISIBLE:_evisibility.OCCLUDED;
else if(visibility===_vstates.HIDDEN)return isMinimized()?_evisibility.HIDDEN:_evisibility.OCCLUDED;else return _evisibility.UNKNOWN}function isMinimized(){return window.screenX<-window.screen.availWidth&&window.screenY<-window.screen.availHeight}function visibilityChange(e,callback){e=e||window.event;e.stopPropagation();e.preventDefault();var v=true;var h=false;var map={"pageshow":v,"focus":v,"focusin":v,"blur":h,"focusout":h,"pagehide":h,"visibilitychange":v};if(e.type in map){if(document.visibilityState!==
_lastDocumentVisibility){if(document.visibilityState===_vstates.VISIBLE)notify("visible",_vstates.VISIBLE,e);else notify("visible",_vstates.HIDDEN,e);_lastDocumentVisibility=document.visibilityState}_hasFocus=map[e.type]&&!isHidden()&&document.hasFocus();if(_hasFocus)notify("focus",_states.FOCUS,e);else notify("focus",_states.BLUR,e);notify("visibility","visibility",e,getVisibilityName(_lastState.visible,_lastState.focus));if(callback)callback()}map=h=v=null;return false}function isHidden(){return document.hidden}
function notify(propName,evtName,e,value){var lv=value||evtName;if(_lastState[propName]!=lv){e.visibilityState=value||evtName;_lastState.evt=e;_lastState.name=evtName;fireEvent(evtName,e,{"async":false})}_lastState[propName]=lv}function observeDocumentVisibility(callback){if(!_focusAttached){_focusAttached=true;_visibilityChange=function(e){visibilityChange(e,callback)};var hidden="hidden";if(hidden in document)document.addEventListener("visibilitychange",_visibilityChange,false);else if(hidden==
"mozHidden")document.addEventListener("mozvisibilitychnage",_visibilityChange,false);else if(hidden=="webkitHidden")document.addEventListener("webkitvisibilitychange",_visibilityChange,false);else if(hidden=="msHidden")document.addEventListener("msvisibilitychange",_visibilityChange,false);else if("onfocusin"in document)document.onfocusin=document.onfocusout=_visibilityChange;window.onpageshow=window.onpagehide=window.onfocus=window.onblur=_visibilityChange;if(document[hidden]!==undefined)_visibilityChange({"type":document[hidden]?
"blur":"focus","stopPropagation":function(){return},"preventDefault":function(){return}})}else if(_lastState.name)fireEvent(_lastState.name,_lastState.evt,{"async":false});else{let evtName=document.hasFocus()?"focus":"blur";fireEvent(evtName,window.event||{},{"async":false})}if(callback)callback()}function unobserveDocumentVisibility(){var hidden="hidden";if(hidden in document)document.removeEventListener("visibilitychange",_visibilityChange,false);else if(hidden=="mozHidden")document.removeEventListener("mozvisibilitychnage",
_visibilityChange,false);else if(hidden=="webkitHidden")document.removeEventListener("webkitvisibilitychange",_visibilityChange,false);else if(hidden=="msHidden")document.removeEventListener("msvisibilitychange",_visibilityChange,false);else if("onfocusin"in document){_visibilityChange=function(){};document.onfocusin=document.onfocusout=null}_visibilityChange=function(){};window.onpageshow=window.onpagehide=window.onfocus=window.onblur=null;_focusAttached=false;te.dispose()}initialize();Object.defineProperty(_tabFocusHook,
"start",{"enumerable":true,"configurable":false,"writable":false,"value":observeDocumentVisibility});Object.defineProperty(_tabFocusHook,"stop",{"enumerable":true,"configurable":false,"writable":false,"value":unobserveDocumentVisibility});Object.defineProperty(_tabFocusHook,"isHidden",{"enumerable":true,"configurable":false,"get":isHidden});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.TabFocusHook=new TabFocusHook})();
(function(){function ObserveObject(){var _observePollingTime=100;var _observeTimeoutId=null;var _objectCollection=[];var _handlerList={};var _handlerListName={};var _handlerCount=0;function isContained(elem){for(var i=0;i<_objectCollection.length;i++)if(_objectCollection[i]["object"]==elem)return true;return false}function compareObject(){var hasChanged=false;var list={};for(var i=0;i<_objectCollection.length;i++){var currentObject=_objectCollection[i];for(var key in currentObject["object"])if(key!=
undefined)if(typeof currentObject["copy"][key]=="undefined"){currentObject["copy"][key]=currentObject["object"][key];_handlerList[getHandlerName(currentObject["handler"])]["list"].push({"name":key,"object":currentObject["object"],"type":"add"})}else if(currentObject["copy"][key]!=currentObject["object"][key]&&!(Number.isNaN(currentObject["object"][key])&&Number.isNaN(currentObject["copy"][key]))){var oldValue=currentObject["copy"][key];currentObject["copy"][key]=currentObject["object"][key];_handlerList[getHandlerName(currentObject["handler"])]["list"].push({"name":key,
"object":currentObject["object"],"type":"update","oldValue":oldValue})}for(var key in currentObject["copy"])if(key!=undefined)if(typeof currentObject["object"][key]=="undefined"){var oldValue=currentObject["copy"][key];delete currentObject["copy"][key];_handlerList[getHandlerName(currentObject["handler"])]["list"].push({"name":key,"object":currentObject["object"],"type":"delete","oldValue":oldValue})}}for(var handlerName in _handlerList)try{if(_handlerList[handlerName]["list"].length>0){_handlerList[handlerName].handler(_handlerList[handlerName]["list"]);
_handlerList[handlerName]["list"]=[]}}catch(error){}clearTimeout(_observeTimeoutId);_observeTimeoutId=null;if(_objectCollection.length>0)_observeTimeoutId=setTimeout(compareObject,_observePollingTime)}function copyObject(elem){var copy={};for(var key in elem)copy[key]=elem[key];return copy}function getHandlerName(handler){for(var key in _handlerListName)if(_handlerListName[key]==handler)return key;key=(new Date).getTime()+"_"+_handlerCount.toString();_handlerCount++;if(_handlerCount>9999)_handlerCount=
0;_handlerListName[key]=handler;return key}function observe(elem,handler){if(isContained(elem)==false){var copy=copyObject(elem);var handlerName=getHandlerName(handler);if(_handlerList[handlerName]==undefined)_handlerList[handlerName]={"handler":handler,"list":[],"count":1};else _handlerList[handlerName]["count"]++;_objectCollection.push({"object":elem,"handler":handler,"copy":copy});if(_observeTimeoutId==null)_observeTimeoutId=setTimeout(compareObject,_observePollingTime)}}function unobserve(elem,
handler){for(var i=0;i<_objectCollection.length;i++)if(_objectCollection[i]["object"]==elem&&_objectCollection[i]["handler"]==handler){_objectCollection.splice(i,1);break}}function startObserve(){clearTimeout(_observeTimeoutId);_observeTimeoutId=setTimeout(compareObject,_observePollingTime)}function stopObserve(){clearTimeout(_observeTimeoutId)}clearTimeout(_observeTimeoutId);_observeTimeoutId=setTimeout(compareObject,_observePollingTime);Object.defineProperty(this,"observe",{"enumerable":true,"configurable":false,
"value":observe});Object.defineProperty(this,"unobserve",{"enumerable":true,"configurable":false,"value":unobserve});Object.defineProperty(Object,"startObserve",{"enumerable":true,"configurable":false,"value":startObserve});Object.defineProperty(Object,"stopObserve",{"enumerable":true,"configurable":false,"value":stopObserve})}if(Object["observe"]==undefined){var obs=new ObserveObject;Object.defineProperty(Object,"observe",{"enumerable":true,"configurable":false,"value":obs.observe});Object.defineProperty(Object,
"unobserve",{"enumerable":true,"configurable":false,"value":obs.unobserve})}})();
(function(){function ObserveObject(args){var _args={"id":null,"input":null,"output":null};var _path="";var _objectView=null;var _dataModel={};var _isReady=false;var _serverFiredList={};var _eventsList={};var _customEventsList={};var _commandHandlerList={};var _cbIdList={};var _modelName="model";var _readOnlyPath=null;var _ref=this;function initialize(args){if(args!=null&&args!=undefined)for(var arg in _args)if(args[arg]!=undefined)_args[arg]=args[arg];if(_args["input"]==undefined||_args["input"]==
null||helper.object.getTypeOf(_args["input"])!="function")_args["input"]=function(){};if(_args["output"]==undefined||_args["output"]==null||helper.object.getTypeOf(_args["output"])!="function")_args["output"]=function(){};_objectView={}}function getPath(model,change){var path="";if(model!=undefined&&model!=null)if(model==change.object)path=change.name;else{var tempRef=null;for(var attrib in model){tempRef=model[attrib];var type=helper.object.getTypeOf(model[attrib]);switch(type){case "object":path+=
getPath(tempRef)+".";break;case "array":for(var i=0;i<tempRef.length;i++)if(helper.object.getTypeOf(tempRef[i])=="object")path+=getPath(tempRef)+".";break}}}return path}function getNode(model,path){var idx=path.indexOf(".")!=-1?path.indexOf("."):path.length;var tempPath=path.substring(0,idx);path=path.substring(idx+1,path.length);if(tempPath!="")return getNode(model[tempPath],path);else return model}function setValue(model,path,value){var idx=path.indexOf(".")!=-1?path.indexOf("."):path.length;var tempPath=
path.substring(0,idx);path=path.substring(idx+1,path.length);if(tempPath!=""&&path!="")return setValue(model[tempPath],path,value);else return model[tempPath]=value}function observeModel(model){if(model!=null&&model!=undefined){for(var attrib in model){var type=helper.object.getTypeOf(model[attrib]);switch(type){case "object":case "array":observeModel(model[attrib]);break;case "function":case "number":case "datetime":case "string":default:break}}Object.observe(model,observeChanges)}}function unobserveModel(model){if(model!=
null&&model!=undefined){for(var attrib in model){var type=helper.object.getTypeOf(model[attrib]);switch(type){case "object":case "array":unobserveModel(model[attrib]);break;case "function":case "number":case "datetime":case "string":default:break}}Object.unobserve(model,observeChanges)}}function setDataModel(model){_isReady=false;var _noErrors=true;if(model["data"]!=undefined){if(model["data"]!=undefined&&model["type"]){switch(model["type"].toUpperCase()){case "OM":unobserveModel(model.data);observeModel(model.data);
_objectView["data"]={};_objectView["data"]=model.data;break;case "ADD":addAttribute(model.data);break;case "UPDATE":updateAttribute(model.data);break;case "DELETE":deleteAttribute(model.data);break;default:helper.console.log("unknown type: "+model["type"]+", Id:"+_args["id"]);break}_noErrors=true}else{helper.console.log("Cannot update this property."+", Id:"+_args["id"]);_noErrors=false}_noErrors=true}else{helper.console.log("Cannot observe these kind of data.");_noErrors=false}setTimeout(function(){_isReady=
true},50);return _noErrors}function addAttribute(data){try{setValue(_objectView.data,data.path,data.value);observeModel(getNode(_objectView.data,data.path))}catch(error){helper.console.warning("Cannot add this attribute: "+data.path+" ,value: "+data.value,error)}}function updateAttribute(data){try{setValue(_objectView.data,data.path,data.value)}catch(error){helper.console.warning("Cannot update this attribute: "+data.path+" ,value: "+data.value,error)}}function deleteAttribute(data){try{unobserveModel(getNode(_objectView.data,
data.path));delete data.object[data.name]}catch(error){helper.console.warning("Cannot delete this attribute: "+data.path+" ,value: "+data.value,error)}}function on(object,event,handler){var canonicalPath=getCanonicalPath(object);if(canonicalPath.indexOf(":")!=-1&&canonicalPath.substring(0,_modelName.length)==_modelName){canonicalPath=canonicalPath.substring(_modelName.length+1,canonicalPath.length);switch(event.toLowerCase()){case "created":case "updated":case "deleted":case "fired":case "error":case "changed":return addCommandHandler(canonicalPath,
event,handler);break;default:return addEventHandler(canonicalPath,event,handler,_customEventsList);break}}else return addEventHandler(canonicalPath,event,handler,_eventsList)}function off(object,event,handler){var canonicalPath=getCanonicalPath(object);if(canonicalPath.indexOf(":")!=-1&&canonicalPath.substring(0,_modelName.length)==_modelName){canonicalPath=canonicalPath.substring(_modelName.length+1,canonicalPath.length);switch(event.toLowerCase()){case "created":case "updated":case "deleted":case "fired":case "error":case "changed":return removeCommandHandler(canonicalPath,
event,handler);break;default:return removeEventHandler(canonicalPath,event,handler,_customEventsList);break}}else return removeEventHandler(canonicalPath,event,handler,_eventsList)}function observeChanges(changes){if(_isReady==true)if(changes)for(var i=0;i<changes.length;i++){var change=changes[i];switch(change.type){case "ADD":addAttribute({"type":chnage.type,"data":model.data});break;case "UPDATE":updateAttribute({"type":chnage.type,"data":model.data});break;case "DELETE":deleteAttribute({"type":chnage.type,
"data":model.data});break}_args["output"](change.type,getPath(_objectView.data,change),change.object[change.name])}}function dispose(){for(var id in _dataModel)deleteObject(id,true);_eventsList=null;_customEventsList=null;_commandHandlerList=null;_objectView=null;_dataModel=null;_ref=null;return}Object.defineProperty(this,"set",{"enumerable":false,"configurable":false,"value":function(value){setDataModel(value)}});initialize(args);Object.defineProperty(this,"model",{"enumerable":true,"configurable":false,
"value":_objectView});Object.defineProperty(this,"on",{"enumerable":true,"configurable":false,"value":function(object,event,handler){return on(object,event,handler)}});Object.defineProperty(this,"off",{"enumerable":true,"configurable":false,"value":function(object,event,handler){return off(object,event,handler)}});Object.defineProperty(this,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":dispose});return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.ObserveObject=
ObserveObject})();
(function(){function ObserveModel(args){var _args={"parentObject":null,"id":null,"shadowCopy":false};var _path="";var _modelView=null;var _dataModel={};var _isReady=false;var _serverFiredList={};var _eventsList={};var _customEventsList={};var _commandHandlerList={};var _cbIdList={};var _modelName="model";var _readOnlyPath=null;var _observeList=[];var _isCSPAvailable=false;var _ref=this;function initialize(args){try{helper.object.eval("function _CSPCheck(param){return param;};");if(window["_CSPCheck"]instanceof
Function){_isCSPAvailable=true;window["_CSPCheck"]=undefined}}catch(error){if(error.toString().match(/'unsafe-eval'|'unsafe-inline'|CSP/)!=-1)helper.console.warning('Dynamic functions are not available, because the current "Content-Security-Policy" header do not allow that, please read the documentation about the "Content-Security-Policy (CSP)" header to allow dynamic functions.',arguments)}if(args!=null&&args!=undefined)for(var arg in _args)if(args[arg]!=undefined)_args[arg]=args[arg];_modelView=
{}}function cloneData(data){if(data==null||typeof data!="object")return data;else if(typeof data=="object"&&data.nodeType!=undefined&&data.nodeType==1)return data;else{var temp;if(data instanceof Date)temp=data;else{try{temp=new data.constructor}catch(Error){temp={}}for(var key in data)if(key.substring(0,1)=="#")temp[key]=data[key];else temp[key]=cloneData(data[key]);if(data["__canonicalPath__"]!=undefined&&temp["path"]==undefined)temp["path"]=data["__canonicalPath__"]}}return temp}function getModelPath(path,
sufix){var ar=path.split(".");var modelPath="";if(ar.length>1){for(var i=0;i<ar.length-2;i++)modelPath+=ar[i]+".objects.";modelPath+=ar[ar.length-2]+"."+sufix+"."+ar[ar.length-1]}else modelPath=path;return modelPath}function getValue(model,path){var idx=path.indexOf(".")!=-1?path.indexOf("."):path.length;var tempPath=path.substring(0,idx);path=path.substring(idx+1,path.length);if(tempPath!="")return getValue(model[tempPath],path);else return model}function setValue(model,path,value){var idx=path.indexOf(".")!=
-1?path.indexOf("."):path.length;var tempPath=path.substring(0,idx);path=path.substring(idx+1,path.length);if(tempPath!=""&&path!="")return setValue(model[tempPath],path,value);else return model[tempPath]=value}function getCanonicalPath(object){if(object!=null&&object!="")if(object["__canonicalPath__"])return object["__canonicalPath__"];else if(helper.object.getTypeOf(object)!="object")return object;else if(object["path"]!=undefined)return object["path"];else return null;else return null}function modelPropertyDescriptor(path){var propertiesPath=
getModelPath(path,"properties");var propertyModel=getValue(_dataModel,propertiesPath);var temp={};for(var attr in propertyModel)temp[attr]=propertyModel[attr];return temp}function defineProperty(obj,name,path,type,data){switch(type){case "object":Object.defineProperty(obj,name,{"enumerable":false,"configurable":false,"get":function(){return path}});break;case "private":if(obj)Object.defineProperty(obj,name,{"enumerable":false,"configurable":false,"get":function(){return data}});break;case "property":var set=
function(value){if(data!=null&&data["readonly"]&&data["readonly"]==true&&(_readOnlyPath==null||_readOnlyPath!=path+"."+name))throw new Error("Readonly property");else{_readOnlyPath=null;var node=getValue(_dataModel,path+"."+name);if(node["type"]!=undefined){var isValid=helper.object.validateTypeOf(value,node["type"],false);if(isValid){if(node["type"]!=undefined&&node["type"]=="JSON"){if(typeof value!="string")value=JSON.stringify(value).toString()}else value=helper.object.convertTo(value,node["type"]);
setValue(_dataModel,path+"."+name+".value",value)}else throw new Error("Invalid data type.");}}};var get=function(){try{var node=getValue(_dataModel,path+"."+name);var value=node["value"];if(node["type"]!=undefined&&node["type"]=="JSON")value=value==""?{}:JSON.parse(value);else if(node["type"]!=undefined)value=helper.object.convertTo(value,node["type"]);return value}catch(e){helper.console.warning(e.message,arguments)}return null};Object.defineProperty(obj,name,{"enumerable":true,"configurable":false,
"set":set,"get":get});break;case "method":if(_isCSPAvailable){var fnArgs="";var hasArgs=false;if(data["arguments"]&&data["arguments"].length>0){hasArgs=true;for(var i=0;i<data["arguments"].length;i++)fnArgs+=data["arguments"][i]["name"]+",";if(fnArgs.length>0)fnArgs=fnArgs.substring(0,fnArgs.length-1)}var fn="";var assignCBID=function(callback,type,path){return arguments.callee.caller.getCBID(callback,type,path)};var sendRemoteCommandHandler=function(_cmd,_path,_data,_cbId){arguments.callee.caller.sendRemoteObj(_cmd,
_path,_data,_cbId)};var rt=false;if(data["return"]){var hasType=false;if(data["return"]["type"]!=null)hasType=true;var cr="";var strDebugger="";if(hasType==true){fn+=cr+strDebugger;fn+=cr+'var type = "CM"; ';fn+=cr+"var _data = "+(hasArgs?"{};":'"";');if(data["return"]["type"]!="NULL"){fn+=cr+"var _cbId = "+assignCBID+'(__callback,"'+data["return"]["type"]+'" );';rt=true}else fn+='var _cbId = ""; ';for(var i=0;i<data["arguments"].length;i++)fn+=cr+'_data["'+data["arguments"][i]["name"]+'"] = '+data["arguments"][i]["name"]+
";";fn+=cr+"var t = "+sendRemoteCommandHandler+'("CM","'+path+'",_data, _cbId);';if(data["return"]["type"]!="NULL")fnArgs+=(fnArgs.length>0?",":"")+"__callback"}}helper.object.eval("function _"+name+"("+fnArgs+"){"+fn+"};");var fnHandler=helper.object.eval("_"+name);fnHandler.sendRemoteObj=_args["parentObject"]["sendRemoteCommand"];if(rt)fnHandler.getCBID=function(callback,type){var sDate=(new Date).getTime();var cbId="CB_CM_"+path+"_"+sDate;if(typeof callback=="undefined"||callback==null)callback=
function(){};_cbIdList[cbId]={"callback":callback,"type":type};return cbId};Object.defineProperty(obj,name,{"enumerable":true,"configurable":false,"value":fnHandler})}else helper.console.log(helper.string.format("Cannot create dynamic function '{0}', because (CSP) header do not allow that.",name),arguments);break;case "event":var set=function(e){setValue(_dataModel,path+"."+name,e)};var get=function(e){return getValue(_dataModel,path+"."+name)};Object.defineProperty(obj,name,{"enumerable":true,"configurable":false,
"set":set,"get":get});break;case "getProperties":Object.defineProperty(obj,name,{"enumerable":false,"configurable":false,"get":function(){return data}});break;case "getMethods":Object.defineProperty(obj,name,{"enumerable":false,"configurable":false,"get":function(){return data}});break;case "getEvents":Object.defineProperty(obj,name,{"enumerable":false,"configurable":false,"get":function(){return data}});break;case "getObjects":Object.defineProperty(obj,name,{"enumerable":false,"configurable":false,
"get":function(){return data}});break}}function getOMCommands(){var omcmds=[];if(_dataModel)for(var key in _dataModel)omcmds.push({"cmd":"rapp","data":JSON.stringify(_dataModel[key]),"group":0,"oob":0,"path":key,"pid":0,pktid:0,"type":"OM"});return omcmds}function observeModel(model,viewModel,path,isNewModel){var properties=["properties"];if(path.indexOf(".")==-1)defineProperty(model,"__isRoot",true,"object");for(var i=0;i<properties.length;i++){var property=properties[i];if(model[property]){defineProperty(model[property],
"__canonicalPath__",path+"."+property,"object");var physPath=(path.length>0?path+".":"")+property;for(var propName in model[property]){viewModel[propName]=model[property][propName];defineProperty(viewModel,propName,physPath,"property",model[property][propName]);defineProperty(model[property][propName],"__canonicalPath__",model["canonicalName"]+"."+propName,"object");_observeList.push({"elem":model[property][propName],"handler":observeChanges});Object.observe(model[property][propName],observeChanges)}defineProperty(viewModel,
"__"+property+"__",physPath,"getProperties",model[property]);_observeList.push({"elem":model[property],"handler":observeChanges});Object.observe(model[property],observeChanges)}}var events=["events"];for(var i=0;i<events.length;i++){var event=events[i];if(model[event]!=undefined){var physPath=(path.length>0?path+".":"")+event;defineProperty(model[event],"__canonicalPath__",path,"object");_observeList.push({"elem":model[event],"handler":observeEventChanges});Object.observe(model[event],observeEventChanges);
for(var eventName in model[event]){defineProperty(viewModel,eventName,physPath,"event",model[event][eventName]);defineProperty(viewModel[eventName],"__type__",physPath,"private","event")}defineProperty(viewModel,"__"+event+"__",physPath,"getEvents",model[event])}}var methods=["methods"];for(var i=0;i<methods.length;i++){var method=methods[i];if(model[method]!=undefined){for(var methodName in model[method]){defineProperty(viewModel,methodName,model["canonicalName"]+"."+methodName,"method",model[method][methodName]);
defineProperty(viewModel[methodName],"__type__",model["canonicalName"]+"."+methodName,"private","method")}defineProperty(viewModel,"__"+method+"__",physPath,"getMethods",model[method])}}var objects=["objects"];for(var i=0;i<objects.length;i++){var object=objects[i];if(model[object]!=undefined){var physPath=(path.length>0?path+".":"")+object;for(var objName in model[object]){viewModel[objName]={};defineProperty(viewModel[objName],"__type__",physPath,"private","node");observeModel(model[object][objName],
viewModel[objName],physPath+"."+model[object][objName]["id"],isNewModel)}defineProperty(viewModel,"__"+object+"__",physPath,"getObjects",model[object])}}}function unobserveModel(model,path){if(model!=null){var properties=["properties"];for(var i=0;i<properties.length;i++){var property=properties[i];if(model[property]){for(var propName in model[property]){removeElemFromObserveList(model[property][propName],observeChanges);Object.unobserve(model[property][propName],observeChanges)}removeElemFromObserveList(model[property],
observeChanges);Object.unobserve(model[property],observeChanges)}}var objects=["objects"];for(var i=0;i<objects.length;i++){var object=objects[i];if(model[object]!=undefined)for(var objName in model[object]){path=(path.length>0?path+".":"")+object+"."+objName;unobserveModel(model[object][objName],path)}}}}function removeElemFromObserveList(elem,handler){for(var i=_observeList.length-1;i>=0;i--)if(_observeList[i].elem==elem&&_observeList[i].handler==handler){_observeList.splice(i,1);break}}function removeAllBindedObserveElems(){for(var i=
0;i<_observeList.length;i++)Object.unobserve(_observeList[i].elem,_observeList[i].handler)}function setDataModel(model){_isReady=false;var _noErrors=true;if(model["data"]!=undefined&&model["type"]){switch(model["type"].toUpperCase()){case "OM":setModel(model);break;case "PC":propertyModelChange(model);break;case "EF":fireHandler(model,undefined,_eventsList);fireCommandHandler(model["path"],"fired",model["path"].substring(model["path"].lastIndexOf(".")+1,model["path"].length),model);break;case "OD":if(model["path"])deleteObject(model["path"],
true);break;case "RV":returnValue(model);break;case "ERR":helper.console.log(helper.string.format("Error: {0}, Id: {1}",JSON.parse(model["data"])["msg"],_args["id"]),arguments);var msg=model&&model["data"]?model["data"]:model;try{msg=JSON.parse(msg)["msg"]}catch(error){}fireCommandHandler(model["path"],"error",null,null,msg);break;default:helper.console.log(helper.string.format("unknown type: {0}, Id: {1}",model["type"],_args["id"]),arguments);return;break}_noErrors=true}else{helper.console.log(helper.string.format("Cannot update this property. Id:{0} ",
_args["id"]),arguments);_noErrors=false}_isReady=true;return _noErrors}function setModel(model){_isReady=false;var _noErrors=true;if(model["data"]!=undefined){var tempModelData=JSON.parse(model["data"]);var tempId=tempModelData["id"];var eventName=null;var oldModelObject=undefined;var isNewModel=false;if(_dataModel[tempId]==undefined||_dataModel[tempId]==null){eventName="created";isNewModel=true}else{eventName="updated";isNewModel=false;oldModelObject=cloneData(_modelView[tempId])}deleteObject(tempId,
false);_dataModel[tempId]=tempModelData;_modelView[tempId]={};observeModel(_dataModel[tempId],_modelView[tempId],tempId,isNewModel);if(eventName!=null){fireCommandHandler(tempId,eventName,tempId,oldModelObject);if(eventName=="created")fireEvents(tempId,"changed",null)}_noErrors=true}else{helper.console.log("Cannot observe these kind of data."+", Id:"+_args["id"]);_noErrors=false}_isReady=true;return _noErrors}function propertyModelChange(currentModel){try{_isReady=false;if(_dataModel!=null){var data=
JSON.parse(currentModel["data"]);if(_serverFiredList[currentModel["path"]]==undefined)_serverFiredList[currentModel["path"]]=0;var oldValue=getValue(_modelView,currentModel["path"]);var virtualModelPath=getModelPath(currentModel.path,"properties");setValue(_dataModel,virtualModelPath+".type",data["type"]);if(data["readonly"]===true)_readOnlyPath=virtualModelPath;else if(data["value"]!=oldValue)_serverFiredList[currentModel["path"]]++;setValue(_modelView,currentModel["path"],data["value"]);var data=
null;try{var data=JSON.parse(currentModel["data"]);data["path"]=currentModel["path"]}catch(error){}fireCommandHandler(data["path"],"changed",data["name"],oldValue)}}catch(error){}finally{_isReady=true}}function getEventObject(modelId,path,event,property,optionalOldValue,description){var propertiesPath=getModelPath(path,"properties");var isWildcard=false;if(propertiesPath.indexOf("*")!=-1){isWildcard=true;propertiesPath=propertiesPath.substr(0,propertiesPath.indexOf("*")-1)}var propertyModel=getValue(_dataModel,
propertiesPath);var obj={"modelId":modelId,"path":path,"event":event,"name":property};if(obj["modelId"]==null){var len=obj["path"].indexOf(".")!=-1?obj["path"].indexOf("."):obj["path"].length;obj["modelId"]=obj["path"].substring(0,len)}if(isWildcard==false&&propertyModel!=null&&propertyModel["name"]!=undefined&&propertyModel["type"]!=undefined&&propertyModel["value"]!=undefined){obj["type"]=propertyModel["type"];obj["name"]=propertyModel["name"];obj["value"]=propertyModel["value"]}else{if(isWildcard==
true)obj["value"]=propertyModel;if(typeof obj["name"]=="undefined"||obj["name"]==null)obj["name"]=modelId}if(event!="fired"){if(typeof obj["value"]=="undefined")obj["value"]=getValue(_modelView,path);if(typeof optionalOldValue!="undefined")obj["oldValue"]=optionalOldValue}else if(event=="fired"&&obj["value"]==undefined&&optionalOldValue!=undefined&&optionalOldValue!=null&&optionalOldValue.data!=undefined)try{var tempValue=JSON.parse(optionalOldValue.data);if(tempValue.arguments!=undefined)obj["value"]=
tempValue.arguments}catch(error){}if(event=="error")obj["message"]=description;return obj}function fireEvents(modelId,event,optionalOldValue){if(_commandHandlerList[event])for(var i=0;i<_commandHandlerList[event].length;i++){var fireEvent=true;if(_commandHandlerList[event][i]["object"]==modelId+".*"||_commandHandlerList[event][i]["object"].indexOf(modelId)!=-1){var jsonData=null;var modelPath=_commandHandlerList[event][i]["object"];if(modelPath=="*")modelPath=modelId;else{var property=getValue(_dataModel,
getModelPath(modelPath,"properties"));if(property&&typeof property["type"]!="undefined"&&property["type"]=="NULL")fireEvent=false}if(fireEvent){jsonData=getEventObject(modelId,modelPath,event,null,optionalOldValue);try{_commandHandlerList[event][i].handler(jsonData)}catch(error){helper.console.warning(error.message)}}}}}function deleteObject(id,removeEvents){try{_isReady=false;if(_dataModel[id]!=undefined){unobserveModel(_dataModel[id],"");var index=id.indexOf(".");var modelId=index!=-1?id.substring(0,
index):id;var oldModelObject=cloneData(_modelView[modelId]);delete _dataModel[id];delete _modelView[id];if(removeEvents==true){var len=id.length;for(var eventName in _eventsList)if(eventName.substr(0,len)==id)delete _eventsList[eventName]}if(eventName!=null)fireHandler(id,"deleted",_eventsList);fireCommandHandler(id,"deleted",id,oldModelObject)}}catch(error){helper.console.warning(error.message)}finally{_isReady=true}}function returnValue(model){if(model&&model["path"]){var path=model["path"];if(path.substr(0,
1)=='"'&&path.substr(path.length-1,1)=='"')path=path.substring(1,path.length-1);if(_cbIdList[path]!=undefined){var retData=null;if(_cbIdList[path]["type"]=="JSON")retData=JSON.parse(model["data"]);else retData=model["data"];_cbIdList[path]["callback"](retData);delete _cbIdList[path]}}}function on(object,event,handler){var canonicalPath=getCanonicalPath(object);if(canonicalPath.indexOf(":")!=-1&&canonicalPath.substring(0,_modelName.length)==_modelName){canonicalPath=canonicalPath.substring(_modelName.length+
1,canonicalPath.length);switch(event.toLowerCase()){case "created":case "updated":case "deleted":case "fired":case "error":case "changed":return addCommandHandler(canonicalPath,event,handler);break;default:return addEventHandler(canonicalPath,event,handler,_customEventsList);break}}else return addEventHandler(canonicalPath,event,handler,_eventsList)}function off(object,event,handler){var canonicalPath=getCanonicalPath(object);if(canonicalPath.indexOf(":")!=-1&&canonicalPath.substring(0,_modelName.length)==
_modelName){canonicalPath=canonicalPath.substring(_modelName.length+1,canonicalPath.length);switch(event.toLowerCase()){case "created":case "updated":case "deleted":case "fired":case "error":case "changed":return removeCommandHandler(canonicalPath,event,handler);break;default:return removeEventHandler(canonicalPath,event,handler,_customEventsList);break}}else return removeEventHandler(canonicalPath,event,handler,_eventsList)}function addEventHandler(object,event,handler,eventsList){var canonicalPath=
getCanonicalPath(object);if(canonicalPath==null&&_dataModel!=null)return"Cannot find canonical path. Object is not in the model view.";if(event==undefined||event==null||event=="")return"Event is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";var item={"event":event,"object":object,"handler":handler,"modelPath":getModelPath(object,"properties")};var isContained=false;if(eventsList[canonicalPath+"."+event]==undefined)eventsList[canonicalPath+
"."+event]=[];else for(var i=0;i<eventsList[canonicalPath+"."+event].length;i++)if(eventsList[canonicalPath+"."+event][i].handler==item.handler){isContained=true;break}if(!isContained)eventsList[canonicalPath+"."+event].push(item);return true}function removeEventHandler(object,event,handler,eventsList){var ret=false;var canonicalPath=getCanonicalPath(object);if(canonicalPath==null)return"Cannot find canonical path. Object is not in the model view.";if(event==undefined||event==null||event=="")return"Event is undefined or null.";
if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";var item={"event":event,"object":object,"handler":handler};if(eventsList[canonicalPath+"."+event]==undefined)return"Cannot find event. Event is not in the model view.";else for(var i=0;i<eventsList[canonicalPath+"."+event].length;i++)if(eventsList[canonicalPath+"."+event][i].handler.toString()==item.handler.toString()){eventsList[canonicalPath+"."+event].splice(i,1);ret=true}return ret}function fireHandler(object,
event,eventsList,jsonData){var canonicalPath="";if(helper.object.getTypeOf(object)=="object")canonicalPath=getCanonicalPath(object);else canonicalPath=object;if(event!=undefined)canonicalPath+="."+event;if(canonicalPath==null)return"Cannot find canonical path. Object is not in the model view.";if(eventsList[canonicalPath]==undefined)return"Event doesnt has a register handler.";else{var jsonArguments=null;if(helper.object.getTypeOf(object)=="object"){if(object["data"]!=undefined){var jTemp=JSON.parse(object["data"]);
if(jTemp["arguments"]!=undefined)jsonArguments=jTemp["arguments"]}}else jsonArguments=jsonData;for(var i=0;i<eventsList[canonicalPath].length;i++){var nodeValue=getValue(_dataModel,eventsList[canonicalPath][i].modelPath);if(nodeValue&&nodeValue["events"]&&nodeValue["events"][eventsList[canonicalPath][i]["event"]]){var fnArguments=nodeValue["events"][eventsList[canonicalPath][i]["event"]]["arguments"];if(fnArguments instanceof Array){var fn="";var dt="";var arArguments=[];for(var k=0;k<fnArguments.length;k++)for(var argName in jsonArguments)if(jsonArguments[argName]&&
fnArguments[k]["name"]==jsonArguments[argName]["name"]){var value=helper.object.convertTo(jsonArguments[argName]["value"],jsonArguments[argName]["type"]);arArguments.push(value)}try{eventsList[canonicalPath][i].handler.apply(this,Array.prototype.slice.call(arArguments,0))}catch(error){helper.console.warning(error.message,arguments)}}else try{eventsList[canonicalPath][i].handler(jsonArguments)}catch(error){helper.console.warning(error.message,arguments)}}else try{eventsList[canonicalPath][i].handler(jsonArguments)}catch(error){helper.console.warning(error.message)}}}}
function addCommandHandler(object,event,handler){var canonicalPath=getCanonicalPath(object);if(canonicalPath==null&&_dataModel!=null)return"Cannot find canonical path. Object is not in the model view.";if(event==undefined||event==null||event=="")return"Event is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";var item={"event":event,"object":object,"handler":handler};var isContained=false;if(_commandHandlerList[event]==undefined)_commandHandlerList[event]=
[];else for(var i=0;i<_commandHandlerList[event].length;i++)if(_commandHandlerList[event][i].handler==item.handler){isContained=true;break}if(!isContained)_commandHandlerList[event].push(item);return true}function removeCommandHandler(object,event,handler){var ret=false;var canonicalPath=getCanonicalPath(object);if(canonicalPath==null&&_dataModel!=null)return"Cannot find canonical path. Object is not in the model view.";if(event==undefined||event==null||event=="")return"Event is undefined or null.";
if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";var item={"event":event,"handler":handler};if(_commandHandlerList[event]==undefined)return"Cannot find event. Event is not in the command list.";else for(var i=0;i<_commandHandlerList[event].length;i++)if(_commandHandlerList[event][i].handler.toString()==item.handler.toString()){_commandHandlerList[event].splice(i,1);ret=true}return ret}function fireCommandHandler(path,commandName,property,oldValue,description){if(_commandHandlerList[commandName])for(var i=
0;i<_commandHandlerList[commandName].length;i++)if(_commandHandlerList[commandName][i]["object"]=="*"||path.indexOf(_commandHandlerList[commandName][i]["object"])!=-1){var eventObject=getEventObject(null,path,commandName,property,oldValue,description);try{_commandHandlerList[commandName][i].handler(eventObject)}catch(error){helper.console.warning(error.message)}}}function observeChanges(changes){if(_isReady==true){helper.console.log("property has been updated."+", Id:"+_args["id"]);if(changes)for(var i=
0;i<changes.length;i++){var change=changes[i];if(change["object"]["readonly"]!=true){var canonicalPath=getCanonicalPath(change["object"]);var value=change["object"]["value"];if(_serverFiredList[canonicalPath]!=undefined&&_serverFiredList[canonicalPath]>0)_serverFiredList[canonicalPath]--;else{helper.console.log("sending message to server..."+", Id:"+_args["id"]);var type="PC";try{_args["parentObject"]["sendRemoteCommand"](type,canonicalPath,value,null)}catch(error){helper.console.warning(error.message)}helper.console.log("canonicalPath: "+
canonicalPath+"."+change.name+" ,PropertyName: "+change.name+" ,Type: "+change.type+", Id:"+_args["id"])}}}}else helper.console.log("model is not ready."+", Id:"+_args["id"])}function observeEventChanges(changes){if(_isReady==true){helper.console.log("event was configured."+", Id:"+_args["id"]);if(changes.length>0&&changes[0]["object"]){var change=changes[0];var id=change["object"]["__canonicalPath__"];var event=change["name"];for(var eventName in _eventsList)if(eventName==id+"."+event)delete _eventsList[eventName];
_eventsList[id+"."+event]=[];var nodeValue=getValue(_modelView,id+"."+event);var canonicalPath=getCanonicalPath(nodeValue);var item={"event":event,"object":id+"."+event,"handler":_modelView[id][event],"modelPath":getModelPath(id+"."+event,"events")};_eventsList[id+"."+event].push(item)}}}function dispose(){removeAllBindedObserveElems();for(var id in _dataModel)deleteObject(id,true);_ref=_dataModel=_modelView=_commandHandlerList=_customEventsList=_eventsList=_observeList=null;return}Object.defineProperty(this,
"set",{"enumerable":false,"configurable":false,"value":function(value){setDataModel(value)}});initialize(args);Object.defineProperty(this,"model",{"enumerable":true,"configurable":false,"value":_modelView});Object.defineProperty(this,"modelPropertyDescriptor",{"enumerable":true,"configurable":false,"value":modelPropertyDescriptor});Object.defineProperty(this,"on",{"enumerable":true,"configurable":false,"value":function(object,event,handler){return on(object,event,handler)}});Object.defineProperty(this,
"off",{"enumerable":true,"configurable":false,"value":function(object,event,handler){return off(object,event,handler)}});Object.defineProperty(this,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":dispose});if(_args.shadowCopy)Object.defineProperty(this,"getOMCommands",{"enumerable":true,"configurable":false,"writable":false,"value":getOMCommands});return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.ObserveModel=ObserveModel})();
(function(){function PostMessage(args){var _ref=this;var _contentWindow={};var _isBidirectional=true;var _commandHandlers={};var _postMessageId=null;var _secure=true;var _origin=null;var _storageDataName="post-message-storage-data";var _linkageId={"session":{},"count":0};var _args={"mode":"REMOTE","id":"POSTMESSAGE_"+(new Date).getTime().toString(),"multipleConnections":false,"sourceElem":null,"targetElem":null,"profileMode":null,"switchHost":false,"allowMethods":null};var _maxConnectTries=0;var _windowTop=
null;var _targetValues=["_self","_blank","_top","_parent"];var _jsroManager=null;var _crossDomain=false;function initialize(args){try{if(parent&&parent.document);else _crossDomain=true}catch(error){_crossDomain=true}_postMessageId=args!=undefined&&args.id!=undefined?"postMessage_"+args.id:"postMessage_"+(new Date).getTime().toString();if(_args.mode!="HOST")_contentWindow[_args.id]=getContentWindow(null);var _windowTop=helper.url.getTopWindow(window);if(_windowTop[_storageDataName]==undefined)_windowTop[_storageDataName]=
{};_windowTop[_storageDataName][_args.id]=window;if(_isBidirectional)startListening();return true}function parseArguments(args){if(args!=null&&args!=undefined)for(var arg in _args)if(args[arg]!=undefined)_args[arg]=args[arg];_args.mode=_args.mode.toUpperCase()}function getHostContentWindow(elem){if(elem!=null){if(window.roleMode!=undefined&&window.roleMode=="HOST")return window;var iframes=(elem.document||elem.documentElement||elem.contentDocument.documentElement).getElementsByTagName("iframe");if(iframes.length>
0){for(var i=0;i<iframes.length;i++)try{if(iframes[i].contentWindow&&iframes[i].contentWindow.roleMode&&iframes[i].contentWindow.roleMode.toUpperCase()=="HOST")return iframes[i].contentWindow}catch(error){}for(var i=0;i<iframes.length;i++)try{var wnd=getHostContentWindow(iframes[i]);if(wnd&&wnd.roleMode&&wnd.roleMode=="HOST")return wnd}catch(error){}return window}else{var wnd=window.roleMode!=undefined&&window.roleMode=="HOST"?window:window.frameElement!=undefined&&window.frameElement.ownerDocument.defaultView&&
window.frameElement.ownerDocument.defaultView.roleMode=="HOST"&&window.frameElement.ownerDocument.defaultView.postMessage?window.frameElement.ownerDocument.defaultView:window.frameElement!=undefined&&window.frameElement.contentWindow!=undefined&&window.frameElement.contentWindow.top.roleMode=="HOST"?window.frameElement.contentWindow.top:iframes.length==1&&iframe[0].contentWindow.roleMode=="HOST"?iframes[0].contentWindow:null;if(wnd!=null)return wnd;else{var top=window.top;if(!_crossDomain&&top){iframes=
top.document.getElementsByTagName("iframe");for(var i=0;i<iframes.length;i++)try{if(iframes[i]&&iframes[i].contentWindow&&iframes[i].contentWindow.roleMode=="HOST")return iframes[i].contentWindow}catch(error){}}return window}}}}function getContentWindow(id,message){var winRef=null;if(message&&message.source&&!(window.Thinfinity&&window.Thinfinity.JsROManager))try{if(message.source!==window&&message.source.name);}catch(error){return message.source}if(_crossDomain)if(message&&message.source)return message.source;
else if(id&&typeof id=="object")return id;else{if(!window.Thinfinity.JsROManager)return window}else{if(window.Thinfinity&&window.Thinfinity.JsROManager){if(_jsroManager==null)_jsroManager=new Thinfinity.JsROManager;winRef=_jsroManager.getJsROContentWindow(id);if(winRef)return winRef}if(id==null&&message==null)return _args.targetElem;else if(id&&id instanceof Window)return id;if(_args.mode!="HOST"){if(_args.targetElem!=undefined&&_args.targetElem!=null)if(typeof _args.targetElem=="string")if(_targetValues.indexOf(_args.targetElem)!=
-1)switch(_args.targetElem){case "_self":break;case "_blank":winRef=window.opener!=undefined?window.opener:null;break;case "_top":break;case "_parent":break}else{winRef=document.getElementById(_args.targetElem);if(winRef==null&&(window.id||window.name)==_args.targetElem)winRef=window.contentWindow;if(winRef!=null&&winRef.nodeName.toLowerCase()=="iframe")winRef=winRef.contentWindow;if(window.top.name==_args.targetElem)winRef=window.top;else{var elems=window.top.document.getElementsByName(_args.targetElem);
if(elems.length>0)winRef=elems[0].contentWindow}if(winRef==null&&window.opener!=undefined&&(window.opener.name||window.opener.id)==_args.targetElem)winRef=window.opener}else if(typeof _args.targetElem["postMessage"]!="undefined")winRef=_args.targetElem;else winRef=_args.targetElem.contentWindow;else if(!window.parent&&window.opener!=undefined)winRef=window.opener;else winRef=getHostContentWindow(window);return winRef}else{winRef=null;if(_args.targetElem!=undefined&&_args.targetElem!=null){if(typeof _args.targetElem==
"string"){winRef=document.getElementById(_args.targetElem);if(winRef==null)if((window.id||window.name)==_args.targetElem)winRef=window;else if((window.top.id||window.top.name)==_args.targetElem)winRef=window.top;if(winRef!=null&&winRef.nodeType!=undefined&&winRef.nodeName.toLowerCase()=="iframe")winRef=winRef.contentWindow}else winRef=_args.targetElem;if(winRef==null)if(typeof _args.sourceElem=="string"&&_targetValues.indexOf(_args.sourceElem)!=-1)if(window.opener!=undefined)if(typeof _args.targetElem==
"string"&&(window.name||window.id)==_args.targetElem)winRef=window.opener;else winRef=window.opener;else winRef=null;else winRef=null}else{var getContentWindowByName=function(iframes){var frmW=null;for(var i=0;i<iframes.length;i++)if(iframes[i].contentWindow.name==id){frmW=iframes[i].contentWindow;break}if(frmW==null)frmW=window;return frmW};if(winRef==null){var iframes=document.getElementsByTagName("iframe");var windowTop=helper.url.getTopWindow(window);winRef=windowTop&&windowTop[_storageDataName]&&
windowTop[_storageDataName][id]!=undefined?windowTop[_storageDataName][id]:window.frameElement!=undefined&&window.frameElement.ownerDocument.defaultView&&window.frameElement.ownerDocument.defaultView.postMessage?window.frameElement.ownerDocument.defaultView:window.frameElement!=undefined&&window.frameElement.contentWindow!=undefined?window.frameElement.contentWindow.top:iframes.length==1?iframes[0].contentWindow:iframes.length>1?getContentWindowByName(iframes):window["postMessage"]?window:null}}return winRef}}return undefined}
function postMessage(data){function postMsg(contentWindow,data){if(contentWindow&&contentWindow.postMessage!=undefined)if(!!window.attachEvent)contentWindow.postMessage(JSON.stringify(data),"*",false);else try{contentWindow.postMessage(data,"*")}catch(error){}else{contentWindow=undefined;helper.console.log("Content windows is undefined or null.")}}var allRemotes=data&&data["allRemotes"]!=undefined?data["allRemotes"]:true;var to=_args.mode=="HOST"&&allRemotes===true?"*":allRemotes===false?data&&data.linkageId?
data.linkageId:"*":-1;if(to=="*")for(var id in _contentWindow){reAttachContentWindow(id);if(_args.id!=id){data.targetId=id;postMsg(_contentWindow[id],data)}}else{if(to!=-1)reAttachContentWindow(data.linkageId);if(_args.mode=="HOST")if(to!=-1&&data["data"]["requestId"]!=undefined)postMsg(_contentWindow[data["data"]["requestId"]],data);else{var toList=allRemotes.split(",");for(var i=0;i<toList.length;i++)if(_contentWindow[toList[i]]){reAttachContentWindow(toList[i]);postMsg(_contentWindow[toList[i]],
data)}}else{if((_contentWindow[data.linkageId]==null||_contentWindow[data.linkageId]==undefined)&&_jsroManager){var hosts=_jsroManager.getHostCollection();if(hosts.length>0)_contentWindow[data.linkageId]=hosts[0]}if(_contentWindow[data.linkageId]==null||_contentWindow[data.linkageId]==undefined)reAttachContentWindow(data.linkageId);postMsg(_contentWindow[data.linkageId],data)}}}function reAttachContentWindow(linkageId){if(linkageId!=undefined&&_contentWindow[linkageId]==undefined){_contentWindow[linkageId]=
getContentWindow(linkageId);if(_contentWindow[linkageId]!=undefined&&_isBidirectional);}}function getLinkageCount(){var count=0;for(var attrib in _linkageId["session"])count++;return count}function startListening(){if(!!window.attachEvent)window.attachEvent("onmessage",receiveMessage);else window.addEventListener("message",receiveMessage,false)}function receiveMessage(e){if(_secure)if(_origin==null)_origin=e.origin;else if(_origin!=e.origin);var obj=null;if(typeof e.data=="string")try{obj=JSON.parse(e.data)}catch(e){helper.console.warning("Cannot parse data: "+
e.data,arguments);obj=null}else obj=e.data;var tempLinkageId=helper.object.existsPath(obj,"linkageId")?obj["linkageId"]:null;var isProtocol=helper.object.existsPath(obj,"protocol")?obj["protocol"]:false;if(tempLinkageId!=null&&"postMessage_"+tempLinkageId!=_postMessageId){_maxConnectTries=0;if(_contentWindow[tempLinkageId]==undefined&&_args.mode=="HOST"&&(_args["allowMethods"]==null||_args["allowMethods"]==undefined||_args["allowMethods"].length==0||helper.object.existsPath(obj,"cmd")&&_args["allowMethods"].indexOf(obj.cmd)!=
-1))_contentWindow[tempLinkageId]=getContentWindow(tempLinkageId,e);if(_args["multipleConnections"]==false&&_contentWindow[_args.id]!=(e.source||e.srcWindow)&&_contentWindow[tempLinkageId]!=(e.source||e.srcWindow))return;if(_args["multipleConnections"]==false&&isProtocol==true&&_linkageId["count"]==0){_linkageId["session"][tempLinkageId]="connected";_linkageId["count"]=getLinkageCount()}else if(_args["multipleConnections"]==true&&isProtocol==true&&_linkageId["session"][tempLinkageId]==undefined){_linkageId["session"][tempLinkageId]=
"connected";_linkageId["count"]=getLinkageCount()}else if(_crossDomain&&helper.object.getValue(obj,"data.requestId",null)==_args.id)return;if(_linkageId["session"][tempLinkageId]==undefined){if(_args.mode=="HOST")delete _contentWindow[tempLinkageId];return}if(obj!=null)callCommand(obj.namespace,obj.cmd,obj.data,e.origin);else throw new Error("Cannot deserialize this object.");}else if(_args.mode=="REMOTE"&&tempLinkageId){_maxConnectTries++;if(_maxConnectTries>=2){_contentWindow={};_maxConnectTries=
0;_contentWindow[tempLinkageId]=getContentWindow(null,e)}}}function registerCommand(namespace,cmd,handler){var ret={"result":null,"message":null};if(namespace==null||namespace==undefined||namespace==""){ret.result=false;ret.message="Namespace cannot be null."}else if(cmd==null||cmd==undefined||cmd==""){ret.result=false;ret.message="Command cannot be null."}else if(handler==null||handler==undefined||handler==""){ret.result=false;ret.message="Handler cannot be null."}else{namespace=namespace.toUpperCase();
if(_commandHandlers[namespace]==undefined)_commandHandlers[namespace]={};if(_commandHandlers[namespace][cmd]==undefined){_commandHandlers[namespace][cmd]=handler;ret.result=true}else{ret.result=false;ret.message="The command was registered previously."}}return ret}function unregisterCommand(namespace,cmd,handler){var ret={"result":null,"message":null};if(namespace==null||namespace==undefined||namespace==""){ret.result=false;ret.message="Namespace cannot be null."}else{namespace=namespace.toUpperCase();
if(_commandHandlers[namespace]!=undefined&&_commandHandlers[namespace][cmd]!=undefined&&_commandHandlers[namespace][cmd]===handler){delete _commandHandlers[namespace][cmd];ret.result=true}else{ret.result=false;ret.message="This command is not registered."}}return ret}function callCommand(namespace,cmd,data,origin,linkageId){namespace=namespace.toUpperCase();if(_commandHandlers[namespace]!=undefined&&_commandHandlers[namespace][cmd]!=undefined)_commandHandlers[namespace][cmd](data,origin);else return null}
function setSourceWindow(win){if(typeof win!="undefined"&&win!=null){if(typeof win=="string")if(window.name==win||window.id==win)_args.sourceElem=window;else _args.sourceElem=win;else _args.sourceElem=win;delete _ref["setSourceWindow"]}}function setTargetWindow(win,name){if(typeof win!="undefined"&&win!=null)if(_args.mode=="REMOTE"||!_args["multipleConnections"]){_args.targetElem=win;_contentWindow[_args.id]=null;if(_crossDomain)_contentWindow[_args.id]=getContentWindow(win);else{var regExp=new RegExp("HTML{1}[a-zA-Z]*Element{1}|Window");
var tof=regExp.exec(helper.object.getTypeOf(win));if(win instanceof HTMLElement||tof&&tof.length>0)_contentWindow[_args.id]=getContentWindow(win);else if(typeof win=="object")_contentWindow[_args.id]=win;else{elem=document.getElementById(win);if(elem){try{elem=elem.contentWindow||elem}catch(error){}_contentWindow[_args.id]=elem}else _contentWindow[_args.id]=getContentWindow(win)}}if(!_args.switchHost)delete _ref["setTargetWindow"]}else _contentWindow[name]=win}function dispose(){if(!!window.removeEvent)window.removeEvent("onmessage",
receiveMessage);else window.removeEventListener("message",receiveMessage,false);_ref=_storageDataName=_secure=_postMessageId=_origin=_linkageId=_commandHandlers=_contentWindow=null;return}function disconnectHost(id){if(id=="*"){if(_linkageId){_linkageId.session={};_linkageId.count=0}_contentWindow={}}else{_linkageId.count--;delete _linkageId.session[id];delete _contentWindow[id]}}function disconnectRemote(){_args.targetElem=null;_contentWindow[_args.id]=null;_linkageId.session={};_linkageId.count=
0}parseArguments(args);Object.defineProperty(this,"registerCommand",{"enumerable":false,"configurable":false,"value":registerCommand});Object.defineProperty(this,"unregisterCommand",{"enumerable":false,"configurable":false,"value":unregisterCommand});Object.defineProperty(this,"postMessage",{"enumerable":true,"configurable":false,"writable":false,"value":postMessage});Object.defineProperty(this,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":dispose});if(_args.mode=="HOST"){Object.defineProperty(this,
"getRemoteSessions",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return _linkageId["session"]}});Object.defineProperty(this,"disconnect",{"enumerable":true,"configurable":false,"writable":false,"value":disconnectHost});Object.defineProperty(this,"id",{"enumerable":true,"configurable":false,"get":function(){return _args.id},"set":function(id){_args.id=id}})}else if(_args.switchHost){Object.defineProperty(this,"disconnect",{"enumerable":true,"configurable":false,"writable":false,
"value":disconnectRemote});Object.defineProperty(this,"setTargetWindow",{"enumerable":false,"configurable":true,"value":setTargetWindow})}if(_args["profileMode"]!=undefined&&_args["profileMode"]=="JsView"){Object.defineProperty(this,"setSourceWindow",{"enumerable":false,"configurable":true,"value":setSourceWindow});if(!(_args.mode=="REMOTE"&&_args.switchHost))Object.defineProperty(this,"setTargetWindow",{"enumerable":false,"configurable":true,"value":setTargetWindow})}initialize(args);return this}
try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.PostMessage=PostMessage})();
(function(){function LinkageConnection(args){var _ref=this;var _isRemote=false;var _isLinked=false;var _waitTime=3E3;var _waitFirstTime=500;var _waitTimeid=null;var _maxTimes=-1;var _countTimes=0;var _postMessage=null;var _linkageTimeoutId=null;var _onConnectCallBacks=[];var _onNodeConnectCallBacks=[];var _sendTimeoutHost=null;var _isFirstTimeConnectCmd=false;var _disposing=false;var _args={"namespace":"THINFINITY","mode":LinkageConnection.mode.REMOTE,"id":"LINKAGE_"+(new Date).getTime().toString(),
"multipleConnections":true,"sourceElem":null,"targetElem":null,"profileMode":null,"switchHost":false,"events":null,"channel":null};var _linkage={"id":null,"namespace":null,"mode":null,"origin":null};var _linkageList={};var _polling={"timeoutId":null,"timeout":null,"isConnected":false,"retries":-1,"maxRetries":1,"reconnectedTimeRefresh":250,"connectedTimeRefresh":4E3};var _allowMethods=["_linkageHostConnectionRequest","_linkageHostPollingRequest","_linkageHostReleaseConnection","_linkageRemoteConnectionRequest",
"_linkageRemotePollingRequest","_linkageHostSyncModelCommand","_linkageRemoteSyncModelCommand"];var _events={};var _crossDomain=false;var _targetId=undefined;var _isDisposed=false;function initialize(args){_ref["commands"]={};if(args!=null&&args!=undefined)for(var arg in _args)if(args[arg]!=undefined)_args[arg]=args[arg];if(!_args["channel"]||_args["channel"]=="")_args["channel"]="*";try{if(!parent||!parent.document)_crossDomain=true}catch(error){_crossDomain=true}_args["mode"]=_args["mode"].toUpperCase();
if(_args["mode"].indexOf("REMOTE")!=-1){_isRemote=true;if(helper.object.existsPath(args,"events.success"))onConnect(args.events.success);if(helper.object.existsPath(args,"events.failure"));}else _isRemote=false;for(var eventName in _args.events)if(helper.object.existsPath(_args,"events."+eventName)){if(!_events[eventName])_events[eventName]=[];_events[eventName].push(_args.events[eventName])}if(typeof _args["id"]=="undefined"||_args["id"]==null||_args["id"]=="")_args["id"]="Thinfinity.Linkage_"+(_isRemote?
LinkageConnection.mode.REMOTE:LinkageConnection.mode.HOST)+"_"+(new Date).getTime().toString();if(window["roleMode"]==undefined||window["roleMode"]==LinkageConnection.mode.REMOTE)window["roleMode"]=_isRemote?LinkageConnection.mode.REMOTE:LinkageConnection.mode.HOST;var errorMsg="Thinfinity.PostMessage is undefined";try{if(Thinfinity["PostMessage"]){_args["allowMethods"]=_allowMethods;_postMessage=new Thinfinity.PostMessage(_args);registerPrivateCommands()}else{_ref=null;throw new Error(errorMsg);
return}}catch(error){_ref=null;throw new Error(error.message);return}}function start(){if(_isRemote)if(!_isLinked){_disposing=false;var data={"id":_args["id"],"mode":_args["mode"],"namespace":_args["namespace"],"channel":_args["channel"]};helper.console.log("Initialize Linkage: Start [Mode: "+_args["mode"]+" , Id: "+_args["id"]+"]");if(arguments.length>0&&helper.object.getTypeOf(arguments[0])=="window"){var wnd=arguments[0];setTargetWindow(wnd,wnd.name||wnd.id||"WND_"+LinkageConnection.mode.HOST+
"_"+helper.utils.generateGUID(10))}if(_maxTimes==-1||_maxTimes>_countTimes){_countTimes++;send("_linkageHostConnectionRequest",data,undefined,true,_targetId);clearTimeout(_waitTimeid);_waitTimeid=setTimeout(start,_isFirstTimeConnectCmd!=true&&_countTimes<10?_waitFirstTime:_waitTime)}else{helper.console.log("Cannot connect to the "+LinkageConnection.mode.HOST+", disposing current element");if(helper.object.existsPath(args,"events.failure"))try{args.events.failure("Cannot connect to host")}catch(error){}disposeRemote()}}}
function linkageHostConnectionRequest(data,origin){if(args["mode"]==LinkageConnection.mode.HOST&&data["id"]!=_args["id"]&&_args["channel"]===data["channel"]){if(_linkageList[data["id"]]==undefined)_linkageList[data["id"]]={};var linkage={};linkage["origin"]=origin;for(var attrib in _linkage)if(data[attrib]!=undefined)linkage[attrib]=data[attrib];_linkageList[data["id"]]=linkage;var data={"id":_args["id"],"mode":_args["mode"],"namespace":_args["namespace"],"targetId":linkage["id"],"channel":_args["channel"]};
helper.console.log("Host Connection Request Received - Linkage: [Mode: "+_args["mode"]+" , Id: "+_args["id"]+"], Linked to: ["+linkage["id"]+"], Channel: ["+_args.channel+"], Accept connection, responding to remote...");send("_linkageRemoteConnectionRequest",data,undefined,true,linkage.id);_isLinked=true;for(var i=0;i<_onNodeConnectCallBacks.length;i++)_onNodeConnectCallBacks[i](getLinkedConfig());fireEvent("connect",{"id":_args.id,"targetId":data.targetId})}}function linkageRemoteConnectionRequest(data,
origin){if(_isLinked==false&&_args["channel"]===data["channel"]){_isLinked=true;_linkage["origin"]=origin;for(var attrib in _linkage)if(data[attrib]!=undefined)_linkage[attrib]=data[attrib];for(var i=0;i<_onConnectCallBacks.length;i++)_onConnectCallBacks[i](getLinkedConfig());helper.console.log("Remote Connection Request Complete - Linkage: [Mode: "+_args["mode"]+" , Id: "+_args["id"]+"], Linked to: ["+_linkage["id"]+"] , Channel: ["+_args.channel+"]. The Host and remote are engaged.");clearTimeout(_waitTimeid);
_waitTimeid=null;setTimeout(function(){helper.console.log("Start polling... Remote: "+_args["id"]);clearTimeout(_polling["timeoutId"]);_polling["isConnected"]=true;_polling["timeout"]=_polling["connectedTimeRefresh"];if(_polling["timeoutId"]==null){clearTimeout(_polling["timeoutId"]);_polling["timeoutId"]=null;linkageRemotePolling()}},500);_maxTimes=30;fireEvent("connect",{"id":_args.id,"targetId":data.targetId})}}function clearPolling(){clearTimeout(_polling["timeoutId"]);_polling["timeoutId"]=null}
function linkageRemotePolling(){if(_isRemote&&!_disposing){clearPolling();if(_polling["isConnected"]==false){helper.console.log("HOST was lost, retrying to connect...");_polling["timeout"]=_polling["reconnectedTimeRefresh"];if(_polling["retries"]==-1||_polling["retries"]>_polling["maxRetries"]){_isLinked=false;clearTimeout(_waitTimeid);_maxTimes=-1;_countTimes=0;_linkageList={};start();return}}else _polling["timeout"]=_polling["connectedTimeRefresh"];var data={"id":_args["id"],"mode":_args["mode"],
"namespace":_args["namespace"],"channel":_args["channel"]};if(_crossDomain)data.targetId=_targetId;send("_linkageHostPollingRequest",data,false,false);clearPolling();_polling["timeoutId"]=setTimeout(function(){_polling["isConnected"]=false;linkageRemotePolling()},_polling["timeout"])}}function linkageHostPollingRequest(data,origin){if(_args["mode"]==LinkageConnection.mode.HOST&&data["id"]!=_args["id"]&&_args["channel"]===data["channel"]){var sendData={};if(_linkageList[data["id"]]==undefined)sendData=
{"id":_args["id"],"mode":_args["mode"],"namespace":_args["namespace"],"targetId":data["id"],"channel":_args["channel"],"reconnect":true};else sendData={"id":_args["id"],"mode":_args["mode"],"namespace":_args["namespace"],"targetId":data["id"],"channel":_args["channel"]};send("_linkageRemotePollingRequest",sendData,data.id,false,data.id)}}function linkageRemotePollingRequest(data,origin){if(_isRemote&&data&&data["mode"]==LinkageConnection.mode.HOST&&data["targetId"]==_args["id"]&&_args["channel"]===
data["channel"]){clearTimeout(_polling["timeoutId"]);_polling["timeoutId"]=null;if(data["reconnect"]==true){_polling["isConnected"]=false;_polling["timeout"]=_polling["reconnectedTimeRefresh"];_isLinked=false;start()}else{_polling["isConnected"]=true;_polling["timeout"]=_polling["connectedTimeRefresh"];_polling["timeoutId"]=setTimeout(function(){linkageRemotePolling()},_polling["timeout"])}}}function linkageRemoteReleaseConnection(){helper.console.log("Requesting release connection from "+LinkageConnection.mode.HOST+
" list.");var data={"id":_args["id"],"mode":_args["mode"],"namespace":_args["namespace"],"targetId":_targetId,"channel":_args["channel"]};send("_linkageHostReleaseConnection",data,false,false,_targetId)}function linkageHostReleaseConnection(data,origin){if(_args["mode"]==LinkageConnection.mode.HOST&&data["id"]!=_args["id"]&&_args["channel"]===data["channel"])releaseRemoteConnection(data.id)}function getLinkedConfig(){if(_args["mode"]==LinkageConnection.mode.HOST)return{"mode":_args["mode"],"id":_args["id"],
"remotes":_linkageList};else return{"mode":_args["mode"],"id":_args["id"],"host":_linkage["id"]}}function guid(){function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return function(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}()}function registerPrivateCommands(){if(_isRemote){_postMessage.registerCommand(_args["namespace"],"_linkageRemoteConnectionRequest",linkageRemoteConnectionRequest);_postMessage.registerCommand(_args["namespace"],"_linkageRemotePollingRequest",
linkageRemotePollingRequest)}else{_postMessage.registerCommand(_args["namespace"],"_linkageHostConnectionRequest",linkageHostConnectionRequest);_postMessage.registerCommand(_args["namespace"],"_linkageHostPollingRequest",linkageHostPollingRequest);_postMessage.registerCommand(_args["namespace"],"_linkageHostReleaseConnection",linkageHostReleaseConnection)}}function register(cmd,handler,populate,optionalName){if(cmd!=undefined&&handler!=undefined)if(_ref["commands"][cmd]==undefined){populate=populate!==
false;var rcReturn=_postMessage.registerCommand(_args["namespace"],cmd,handler);if(populate&&rcReturn.result){var exposeName=typeof optionalName==="string"&&optionalName!=""?optionalName:cmd;_ref["commands"][exposeName]=function(data){send(cmd,data,undefined,false)}}else helper.console.log("Cannot register command:["+rcReturn.message+"]")}else helper.console.log("This command is already registered: ["+cmd+"]");else helper.console.log("Cannot register command:["+cmd+"], handler is: ["+handler.toString()+
"]")}function unregister(cmd,handler){if(cmd!=undefined&&handler!=undefined){if(_isRemote)delete _ref["commands"][cmd];var rcReturn=_postMessage.unregisterCommand(_args["namespace"],cmd,handler);if(rcReturn.result!=true)helper.console.log("Cannot unregister command:["+rcReturn.message+"]")}else helper.console.log("Cannot unregister command:["+cmd+"], handler is: ["+handler.toString()+"]")}function on(event,handler){if(event==undefined||event==null||event=="")return"Event is undefined or null.";if(handler==
undefined||handler==null||handler=="")return"Handler is undefined or null.";if(_events[event]==undefined)_events[event]=[];_events[event].push(handler)}function off(event,handler){if(event==undefined||event==null||event=="")return"Event is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";if(_events[event])for(var i=_events[event].length-1;i>=0;i--)if(_events[event][i]===handler)_events[event].splice(i,1)}function fireEvent(name,data){if(_events[name]&&
_events[name].length>0)for(var i=0;i<_events[name].length;i++)try{setTimeout(function(args){_events[name][args[0]](data)},0,[i])}catch(error){}}function send(cmd,data,allRemotes,protocol,targetId){var sendData=null;if(!targetId||targetId=="")targetId=_targetId;if(allRemotes==undefined)sendData={"namespace":_args["namespace"],"cmd":cmd,"linkageId":_args["id"],"targetId":targetId,"data":data,"allRemotes":true,"protocol":protocol};else sendData={"namespace":_args["namespace"],"cmd":cmd,"linkageId":_args["id"],
"targetId":targetId,"data":data,"allRemotes":allRemotes,"protocol":protocol};if(_isRemote==false){var subcmd=helper.object.getValue(sendData,"data.cmd",undefined);if(cmd.indexOf("_linkage")==-1&&(!_isFirstTimeConnectCmd&&subcmd=="connect"||subcmd!="reconnecting"&&subcmd!="connect")){_isFirstTimeConnectCmd=true;var item={"cmd":cmd,"data":sendData.data,"time":(new Date).getTime(),"linkageId":{}};if(_isLinked==false);else{for(var linkageId in _linkageList)item["linkageId"][linkageId]=true;_postMessage.postMessage(sendData)}}else _postMessage.postMessage(sendData)}else if(_isLinked==
true||_allowMethods.indexOf(cmd)!=-1)_postMessage.postMessage(sendData);else;}function setSourceWindow(win){if(typeof win!="undefined"&&win!=null){_args["sourceElem"]=win;_postMessage.setSourceWindow(win);delete _ref["setSourceWindow"]}}function setTargetWindow(win,name){if(typeof win!="undefined"&&win!=null)if(_args["mode"]==LinkageConnection.mode.REMOTE||!_args["multipleConnections"]){_args["targetElem"]=win;_postMessage.setTargetWindow(win);_targetId=name;if(!_args.switchHost)delete _ref["setTargetWindow"]}else{_args["targetElem"]=
null;_postMessage.setTargetWindow(win,name)}}function onConnect(callback){var isNotAdded=true;for(var i=0;i<_onConnectCallBacks.length;i++)if(_onConnectCallBacks[i]===callback){isNotAdded=false;break}if(isNotAdded&&callback instanceof Function)if(_isLinked)callback(getLinkedConfig());else _onConnectCallBacks.push(callback)}function onNodeConnect(callback){var isNotAdded=true;for(var i=0;i<_onNodeConnectCallBacks.length;i++)if(_onNodeConnectCallBacks[i]===callback){isNotAdded=false;break}if(isNotAdded&&
callback instanceof Function)if(_isLinked)callback(getLinkedConfig());else _onNodeConnectCallBacks.push(callback)}function disposeRemote(){_disposing=true;var time=500;if(arguments.length>0)try{time=parseFloat(arguments[0])}catch(error){}if(_isDisposed)return;clearTimeout(_polling["timeoutId"]);clearTimeout(_waitTimeid);linkageRemoteReleaseConnection();if(_postMessage)_postMessage.dispose();setTimeout(function(){_ref=_postMessage=_onNodeConnectCallBacks=_onConnectCallBacks=_linkageList=_isLinked=
_countTimes=_args=null;_isDisposed=true},time);return}function disposeHost(){var time=500;if(arguments.length>0)try{time=parseFloat(arguments[0])}catch(error){}if(_isDisposed)return;if(_postMessage){_postMessage.disconnect("*");_postMessage.dispose()}setTimeout(function(){_ref=_postMessage=_onNodeConnectCallBacks=_onConnectCallBacks=_linkageList=_isLinked=_countTimes=_args=null;_isDisposed=true},time);return}function activeSessions(){var count=0;for(var link in _linkageList)count++;return count}function releaseRemoteConnection(id){delete _linkageList[id];
_postMessage.disconnect(id)}function disconnectRemote(id,echo){if(echo==undefined||!echo)linkageRemoteReleaseConnection();clearTimeout(_polling.timeoutId);_isLinked=false;_postMessage.disconnect();_args.targetElem=null}initialize(args);Object.defineProperty(this,"register",{"enumerable":true,"configurable":false,"value":register});Object.defineProperty(this,"unregister",{"enumerable":false,"configurable":false,"value":unregister});Object.defineProperty(this,"send",{"enumerable":true,"configurable":false,
"value":send});if(_isRemote==true){Object.defineProperty(this,"start",{"enumerable":true,"configurable":false,"writable":false,"value":start});Object.defineProperty(this,"isConnected",{"enumerable":true,"configurable":false,"get":function(){return _isLinked}});Object.defineProperty(this,"onConnect",{"enumerable":true,"configurable":false,"set":onConnect});Object.defineProperty(this,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":disposeRemote});if(_args.switchHost){Object.defineProperty(this,
"setTargetWindow",{"enumerable":false,"configurable":true,"value":setTargetWindow});Object.defineProperty(this,"disconnect",{"enumerable":true,"configurable":false,"writable":false,"value":disconnectRemote})}Object.defineProperty(this,"targetId",{"enumerable":false,"configurable":true,"get":function(){return _targetId},"set":function(targetId){_targetId=targetId}})}else{Object.defineProperty(this,"onNodeConnect",{"enumerable":true,"configurable":false,"set":onNodeConnect});Object.defineProperty(this,
"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":disposeHost});Object.defineProperty(this,"activeSessions",{"enumerable":true,"configurable":false,"get":function(){return activeSessions()}});Object.defineProperty(this,"disconnect",{"enumerable":true,"configurable":false,"writable":false,"value":releaseRemoteConnection});Object.defineProperty(this,"id",{"enumerable":true,"configurable":false,"get":function(){return _args.id},"set":function(id){_args.id=id;if(_postMessage)_postMessage.id=
id}});Object.defineProperty(this,"isConnected",{"enumerable":true,"configurable":false,"get":function(){for(var k in _linkageList)return true;return false}})}Object.defineProperty(this,"on",{"enumerable":true,"configurable":false,"value":on});Object.defineProperty(this,"off",{"enumerable":true,"configurable":false,"value":off});if(_args["profileMode"]!=undefined&&[LinkageConnection.profileMode.JSVIEW,LinkageConnection.profileMode.CONFIGURABLE].indexOf(_args["profileMode"])!=1){Object.defineProperty(this,
"setSourceWindow",{"enumerable":false,"configurable":true,"value":setSourceWindow});if(!(_isRemote&&_args.switchHost))Object.defineProperty(this,"setTargetWindow",{"enumerable":false,"configurable":true,"value":setTargetWindow})}return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}var _profileMode=helper.object.createEnum({"NONE":"none","JSVIEW":"JsView","CONFIGURABLE":"configurable"});Object.defineProperty(LinkageConnection,"profileMode",{"enumerable":false,"configurable":false,"get":function(){return _profileMode}});
var _modes=helper.object.createEnum({"HOST":"HOST","REMOTE":"REMOTE"});Object.defineProperty(LinkageConnection,"mode",{"enumerable":false,"configurable":false,"get":function(){return _modes}});Thinfinity.LinkageConnection=LinkageConnection})();
(function(){function JsRO(args){var _ref=this;var _linkageConnection=null;var _isRemote=false;var _onRemoteCommandList=[];var _id;var _pid=null;var _name=null;var _args={"input":null,"output":null,"clientSettings":null,"autoStart":true,"id":null,"mode":"REMOTE","supportObserve":true,"events":null,"customEvents":null,"outputMode":"cmd","sourceElem":null,"targetElem":null,"switchHost":false,"commands":null,"hostId":null,"description":null};var _populateMethods={};var _observeModel=null;var _shadowModel=
null;var _privateHandler={};var _jsroManager=null;var _crossDomain=false;try{if(parent&&parent.document);else _crossDomain=true}catch(error){_crossDomain=true}var _wndTop=getTopJsROManager();var _isReadyInterval=null;var _crossInterval=null;var _isDisposing=false;var _visibilityChange=null;function initialize(args){if(args&&args.switchHost)_args.autoStart=false;helper.object.parseAttributes(_args,args,"MATCH");_args.mode=_args.mode.toUpperCase();_id="Thinfinity.JsRO_"+_args.mode+"_"+(new Date).getTime().toString();
_name=_args.name||_args.id||_args.alias||_id;_args.description=_args.description||_name;_args.id=_id;var errorMsg="Thinfinity.LinkageConnection is undefined";try{if(Thinfinity["LinkageConnection"])_linkageConnection=new Thinfinity.LinkageConnection(_args);else{_ref=null;throw new Error(errorMsg);return}}catch(error){_ref=null;throw new Error(error.message);return}if(_args["mode"]&&_args["mode"].indexOf("HOST")!=-1)try{if(typeof _args["input"]!="function")throw"input param is not a function";if(typeof _args["output"]!=
"function")throw"output param is not a function";if(_args["clientSettings"]!=null&&_args["clientSettings"]!=undefined&&typeof _args["clientSettings"]!="object")throw"clientSettings param is not an object";_isRemote=false;initializeLocal();if(_args["supportObserve"]==true){var args={"parentObject":{"sendMessage":function(){},"sendRemoteCommand":function(){},"dispose":function(){}},"id":_id,"shadowCopy":true};_shadowModel=new Thinfinity.ObserveModel(args)}if(agentInfo.isMSIE!=true&&agentInfo.msieVersion>
9)helper.console.log("JsRO - HOST was created and is listening...")}catch(error){helper.console.log("Cannot initialize Thinfinity.JsRO, ["+error+"].");_ref=null;return}else{_isRemote=true;initializeRemote();if(_args["supportObserve"]==true)initializeObserveModel()}}function afterInitialize(){if(helper.object.existsPath(window,"Thinfinity.JsROManager")){_jsroManager=new Thinfinity.JsROManager({});if(_wndTop&&_wndTop.Thinfinity&&_wndTop.Thinfinity.registerJsRO)_wndTop.Thinfinity.registerJsRO(_ref,window)}if(_crossDomain){if(_isRemote&&
!helper.object.existsPath(window,"Thinfinity.JsROManager"))_linkageConnection.start();return}else if(_isRemote)if(_args.hostId!=undefined&&_args.hostId!=""&&_args.hostId!=null)connect(_args.hostId,_args["autoStart"]||_linkageConnection.isConnected);else if(_args.autoStart)_linkageConnection.start()}function getTopJsROManager(){var tempWnd=null;var tempFn=function(wnd){if(wnd.parent&&wnd.parent!=wnd)try{if(wnd.parent&&wnd.parent.document)if(wnd.Thinfinity&&wnd.isJsROManager){tempWnd=wnd;tempFn(wnd.parent)}else tempFn(wnd.parent)}catch(error){return window}else try{if(wnd.Thinfinity&&
wnd.isJsROManager)tempWnd=wnd;else return null}catch(error){return null}};tempFn(window.parent);return tempWnd||window}function crossCommand(cmd,data){if(_linkageConnection.isConnected)_linkageConnection.send("crossCommand",{"cmd":cmd,"data":data});else{if(!data)data={};data.requestId=_id;data.cmd=cmd;data.id=_id;window.top.postMessage({"cmd":"crossCommand","data":data},"*")}}var onBodyFocus=function(){if(document.hasFocus())if(!_crossDomain){if(_wndTop&&_wndTop.Thinfinity&&_wndTop.Thinfinity.focusJsRO)_wndTop.Thinfinity.focusJsRO(_id)}else crossCommand("focusJsRO",
{"id":_id})};function initializeLocal(){var isTrigger=_linkageConnection=="undefined"||_linkageConnection["send"]==undefined?true:false;_args["input"](function(obj){var result=true;switch(obj["cmd"]){case "rapp":if(obj.pid!=null)_pid=obj.pid;_shadowModel.set(obj);if(isTrigger)$(window).trigger("rapp",[obj]);else if(!_isDisposing&&_linkageConnection.isConnected)_linkageConnection.send("rapp",obj);else result=false;break;case "apiMsg":if(isTrigger)$(window).trigger("receiveMessage",[obj.msg]);else if(!_isDisposing&&
_linkageConnection.isConnected)_linkageConnection.send("receiveMessage",{"message":obj.msg});else result=false;break;case "clientSettings":if(typeof obj["HideMousePointer"]!="undefined"){helper["console"]["log"]("clientSettingsChanged: clientSettings.HideMousePointer="+obj["HideMousePointer"]);if(clientSettings&&clientSettings["hidePointer"])clientSettings["hidePointer"]=obj["HideMousePointer"]}if(typeof obj["MouseMovement"]!="undefined"){helper["console"]["log"]("clientSettingsChanged: clientSettings.MouseMovement="+
obj["MouseMovement"]);if(clientSettings&&clientSettings["relativeTouch"])clientSettings["relativeTouch"]=obj["MouseMovement"]=="relative"}if(typeof obj["MouseMoveMode"]!="undefined"){helper["console"]["log"]("clientSettingsChanged: clientSettings.MouseMoveMode="+obj["MouseMoveMode"]);if(obj["MouseMoveMode"]=="move");else;}break}return result});_linkageConnection.register("sendMessage",function(jsonData,origin){if(_pid!=null&&jsonData&&jsonData.pid==null)jsonData.pid=_pid;switch(_args["outputMode"].toLowerCase()){case "json":_args["output"](jsonData);
break;case "cmd":default:var message=jsonData.message;message=message instanceof Object?JSON.stringify(encodeURIComponent(message)):encodeURIComponent(message);var query="cmd=apiMsg"+"&msg="+message;_args["output"](query);break}});_linkageConnection.register("sendRemoteCommand",function(jsonData,origin){switch(_args["outputMode"].toLowerCase()){case "json":if(typeof jsonData["cmd"]=="undefined")jsonData["cmd"]="rapp";if(_pid!=null&&jsonData.pid==null)jsonData.pid=_pid;_args["output"](jsonData);break;
case "cmd":default:var type=jsonData["type"];var path=jsonData["path"];var data=jsonData["data"];var cbid=jsonData["cbid"];if(typeof data=="object")data=JSON.stringify(data);var query="cmd=rapp"+"&type="+encodeURIComponent(type)+"&path="+encodeURIComponent(path)+"&data="+encodeURIComponent(data)+"&cbid="+encodeURIComponent(cbid);if(_pid!=null)query+="&pid="+encodeURIComponent(_pid);_args["output"](query);break}});_linkageConnection.register("syncModelRemoteCommand",function(jsonData){if(!_isDisposing&&
_shadowModel&&_shadowModel.getOMCommands)_linkageConnection.send("syncModelHostCommand",{"data":JSON.stringify(_shadowModel.getOMCommands())},jsonData.id)});_linkageConnection.register("disconnect",function(jsonData){_linkageConnection.disconnect(jsonData.id)});if(_args.customEvents)_linkageConnection.register("sendCommand",function(jsonData){if(jsonData)if(helper.object.existsPath(_args,"customEvents."+jsonData.cmd))try{_args.customEvents[jsonData.cmd](jsonData)}catch(error){}},false);_privateHandler["sendCommand"]=
function(cmd,data){if(isTrigger==true)$(window).trigger("sendCommand",[controlId,keystrokes]);else if(!_isDisposing)_linkageConnection.send("sendCommand",{"cmd":cmd,"data":data})};if(_args.commands)for(var cmd in _args.commands)_linkageConnection.register(cmd,_args.commands[cmd]);initializeFocus()}function processFocus(cmd,value){if(value&&!_crossDomain)if(_wndTop&&_wndTop.Thinfinity&&_wndTop.Thinfinity.focusJsRO)_wndTop.Thinfinity.focusJsRO(_id);else crossCommand("focusJsRO",{"id":_id})}function initializeFocus(){if(Thinfinity.TabFocusHook)Thinfinity.TabFocusHook.on(["visible",
"focus"],function(e){processFocus("focus",true)}).on(["hidden","blur"],function(e){processFocus("blur",false)}).on("visibility",function(e){processFocus(e.visibilityState==="visible"?"focus":"blur",e.visibilityState==="visible")});else{_visibilityChange=function(e){e.stopPropagation();e.preventDefault();var v=false;var h=true;var isHidden=false;var map={"focus":v,"focusin":v,"blur":h,"focusout":h,"pagehide":h};e=e||window.event;if(e.type in map)isHidden=map[e.type];else isHidden=this.hidden?true:
false;if(isHidden);else processFocus("focus",true);pollingTime=map=isHidden=h=v=null;return false};var hidden="hidden";if(hidden in document)document.addEventListener("visibilitychange",_visibilityChange,false);else if(hidden=="mozHidden")document.addEventListener("mozvisibilitychange",_visibilityChange,false);else if(hidden=="webkitHidden")document.addEventListener("webkitvisibilitychange",_visibilityChange,false);else if(hidden=="msHidden")document.addEventListener("msvisibilitychange",_visibilityChange,
false);else if("onfocusin"in document)document.onfocusin=document.onfocusout=_visibilityChange;window.onpageshow=window.onpagehide=window.onfocus=window.onblur=_visibilityChange;if(document[hidden]!==undefined)_visibilityChange({"type":document[hidden]?"blur":"focus","stopPropagation":function(){return},"preventDefault":function(){return}});document.body.addEventListener("focus",onBodyFocus,false)}}function initializeRemote(){var isTrigger=_linkageConnection=="undefined"||_linkageConnection["send"]==
undefined?true:false;_linkageConnection.register("receiveMessage",function(jsonData){if(_ref["onReceiveMessage"])_ref["onReceiveMessage"](jsonData.message)});_linkageConnection.register("rapp",function(jsonData){for(var i=0;i<_onRemoteCommandList.length;i++)_onRemoteCommandList[i](jsonData)});_linkageConnection.register("sendCommand",function(jsonData){if(_args["events"]&&_args["events"]["sendCommand"])try{var cmd=null;var data=null;if(typeof jsonData!="undefined"){cmd=jsonData["cmd"];data=jsonData["data"]}_args["events"]["sendCommand"](cmd,
data)}catch(error){}});_linkageConnection.register("crossCommand",function(jsonData){if(jsonData&&jsonData.cmd&&!_crossDomain){var data=jsonData.data;if(data)if(typeof data=="string")data=JSON.parse(data);switch(jsonData.cmd){case "focusJsRO":if(_wndTop&&_wndTop.Thinfinity&&_wndTop.Thinfinity.focusJsRO)_wndTop.Thinfinity.focusJsRO(data.id);break}}});_linkageConnection.register("syncModelHostCommand",function(jsonData){if(helper.object.existsPath(jsonData,"data")){var omCmds=[];try{omCmds=JSON.parse(jsonData.data)}catch(error){}for(var k=
0;k<omCmds.length;k++)try{for(var i=0;i<_onRemoteCommandList.length;i++)_onRemoteCommandList[i](omCmds[k])}catch(error){}}});_populateMethods["sendMessage"]=function(message){if(isTrigger==true)$(window).trigger("sendMessage",[message]);else if(!_isDisposing)_linkageConnection.send("sendMessage",{"message":message})};_populateMethods["sendRemoteCommand"]=function(type,path,data,cbid){if(isTrigger==true)$(window).trigger("sendRemoteCommand",[controlId,keystrokes]);else if(!_isDisposing)_linkageConnection.send("sendRemoteCommand",
{"type":type,"path":path,"data":data,"cbid":cbid})};_populateMethods["dispose"]=function(){_isDisposing=true;var isConnected=_linkageConnection.isConnected;if(_crossDomain)crossCommand("unregisterJsRO",{"id":_id,"mode":_args.mode});if(_wndTop&&_wndTop.Thinfinity&&_wndTop.Thinfinity.unregisterJsRO)_wndTop.Thinfinity.unregisterJsRO(_ref);_observeModel["dispose"]();_linkageConnection["dispose"]();setTimeout(function(){_observeModel=null;_linkageConnection=null;_populateMethods=null;_privateHandler=null;
_onRemoteCommandList=null;if(isConnected&&helper.object.existsPath(args,"events.disconnect"))try{args.events.disconnect({"id":_id})}catch(error){}_ref=args=_args=_onRemoteCommandList=_privateHandler=_populateMethods=_linkageConnection=_observeModel=null},500);return};if(_args.commands)for(var cmd in _args.commands)_linkageConnection.register(cmd,_args.commands[cmd])}function connect(hostId){var forceConnect=helper.object.convertTo(helper.object.getValue(arguments,"[1]",false),"boolean");if(hostId&&
hostId!="")_args.hostId=hostId;if(!_crossDomain||_args.targetElem==null&&_args.hostId!="")if(_jsroManager){var done=function(){var hostCollection=_jsroManager.getHostCollection();if(_args.hostId=="*")if(hostCollection.length>0){for(var i=0;i<hostCollection.length;i++)if(hostCollection[i]["default"]){updateTarget(_jsroManager.getJsROContentWindow(hostCollection[i].id),forceConnect);return}_args.hostId=hostCollection[0].id;updateTarget(_jsroManager.getJsROContentWindow(hostCollection[0].id),forceConnect);
return}for(var i=0;i<hostCollection.length;i++)if(hostCollection[i].name==_args.hostId||hostCollection[i].id==_args.hostId){updateTarget(_jsroManager.getJsROContentWindow(hostCollection[i].id),forceConnect);return}for(var i=0;i<hostCollection.length;i++)if(hostCollection[i]["default"]){updateTarget(_jsroManager.getJsROContentWindow(hostCollection[i].id),forceConnect);return}};clearInterval(_isReadyInterval);function doConnect(){if(_jsroManager.isReady){clearInterval(_isReadyInterval);done()}}_isReadyInterval=
setInterval(doConnect,250);doConnect()}else{if(_isRemote&&!_args.autoStart&&_args.hostId==undefined)_linkageConnection.start()}else if(_args.targetElem){_linkageConnection.setTargetWindow(_args.targetElem,_args.hostId);_linkageConnection.hostId=_args.hostId;_linkageConnection.start()}}function updateTarget(targetElem){var forceConnect=helper.object.convertTo(helper.object.getValue(arguments,"[1]",false),"boolean");var regExp=new RegExp("HTML{1}[a-zA-Z]*Element{1}|Window");var tof=regExp.exec(helper.object.getTypeOf(targetElem));
if(targetElem&&(targetElem instanceof HTMLElement||targetElem instanceof String||tof&&tof.length>0||typeof targetElem=="object")){disconnect();_args.targetElem=targetElem;_linkageConnection.setTargetWindow(targetElem,_args.hostId);if(_args["autoStart"]||_linkageConnection.isConnected||forceConnect)_linkageConnection.start()}else helper.console.log("JsRO - targetElement must be a HTMLELement or String id",arguments)}function disconnect(){var isConnected=_linkageConnection.isConnected;if(_linkageConnection.isConnected)_linkageConnection.disconnect(_id);
if(_args.targetElem!=null&&!(_crossDomain&&_isRemote))_args.targetElem=null;if(isConnected&&helper.object.existsPath(args,"events.disconnect"))try{args.events.disconnect({"id":_id})}catch(error){}}function initializeObserveModel(){helper.console.log("Initializing Observe Model");if(Thinfinity["ObserveModel"]){var args={"parentObject":_populateMethods,"id":_id};_observeModel=new Thinfinity.ObserveModel(args);_linkageConnection.onConnect=function(){helper.console.log("Linkage was successfully invoked.");
function onRemoteCommandHandler(jsonData){_observeModel.set(jsonData)}_onRemoteCommandList.push(onRemoteCommandHandler);if(!_isDisposing)_linkageConnection.send("syncModelRemoteCommand",{"id":_id})}}else helper.console.warning("Observe Model is undefined.")}function updateManagerInstance(){if(_jsroManager)_jsroManager.updateJsROInstance(_ref)}function updateName(name){if(name!=_name){var oldName=_name;_name=name;updateManagerInstance()}}function updateDescription(description){if(description!=_args.description){var oldDescription=
_args.description;_args.description=description;updateManagerInstance()}}function disposeHost(){var isConnected=false;if(_observeModel)_observeModel.dispose();if(_shadowModel)_shadowModel.dispose();if(_linkageConnection){isConnected=_linkageConnection.isConnected;_linkageConnection.dispose()}if(_crossDomain)crossCommand("unregisterJsRO",{"id":_id,"mode":_args.mode});if(_wndTop&&_wndTop.Thinfinity&&_wndTop.Thinfinity.unregisterJsRO)_wndTop.Thinfinity.unregisterJsRO(_ref);if(isConnected&&helper.object.existsPath(args,
"events.disconnect"))try{args.events.disconnect({"id":_id})}catch(error){}if(Thinfinity.TabFocusHook)Thinfinity.TabFocusHook.off(["visible","focus","hidden","blur","visibility"]);else{document.body.removeEventListener("focus",onBodyFocus,false);onBodyFocus=null;var hidden="hidden";if(hidden in document)document.removeEventListener("visibilitychange",_visibilityChange,false);else if(hidden=="mozHidden")document.removeEventListener("mozvisibilitychange",_visibilityChange,false);else if(hidden=="webkitHidden")document.removeEventListener("webkitvisibilitychange",
_visibilityChange,false);else if(hidden=="msHidden")document.removeEventListener("msvisibilitychange",_visibilityChange,false);else if("onfocusin"in document)document.onfocusin=document.onfocusout=function(){};window.onpageshow=window.onpagehide=window.onfocus=window.onblur=function(){};_visibilityChange=function(){}}}initialize(args);for(var method in _linkageConnection.commands)Object.defineProperty(this,method,{"enumerable":true,"configurable":false,"value":_linkageConnection.commands[method]});
if(_isRemote){if(_observeModel&&_args.supportObserve){Object.defineProperty(this,"model",{"enumerable":true,"configurable":false,"value":_observeModel.model});Object.defineProperty(this,"on",{"enumerable":true,"configurable":false,"value":_observeModel.on});Object.defineProperty(this,"off",{"enumerable":true,"configurable":false,"value":_observeModel.off});Object.defineProperty(this,"modelPropertyDescriptor",{"enumerable":false,"configurable":false,"value":_observeModel.modelPropertyDescriptor});
Object.defineProperty(this,"dispose",{"enumerable":false,"configurable":false,"writable":false,"value":_populateMethods.dispose})}if(_args.autoStart===false||_args.switchHost){Object.defineProperty(this,"start",{"enumerable":true,"configurable":false,"value":function(){return connect(undefined,true)}});Object.defineProperty(this,"connect",{"enumerable":true,"configurable":false,"value":function(hostId){return connect(hostId,true)}})}if(_args.switchHost){Object.defineProperty(this,"disconnect",{"enumerable":true,
"configurable":false,"value":disconnect});Object.defineProperty(this,"id",{"enumerable":true,"configurable":false,"get":function(){return _id}})}Object.defineProperty(this,"description",{"enumerable":true,"configurable":false,"get":function(){return _args.description}})}else{Object.defineProperty(this,"sendCommand",{"enumerable":false,"configuable":false,"value":_privateHandler.sendCommand});Object.defineProperty(this,"id",{"enumerable":true,"configurable":false,"get":function(){return _id}});Object.defineProperty(this,
"description",{"enumerable":true,"configurable":false,"get":function(){return _args.description},"set":updateDescription})}Object.defineProperty(this,"name",{"enumerable":true,"configurable":false,"get":function(){return _name},"set":function(name){return updateName(name)}});if(!_isRemote)Object.defineProperty(this,"dispose",{"enumerable":true,"configurable":false,"value":disposeHost});Object.defineProperty(this,"mode",{"enumerable":true,"configurable":false,"get":function(){return _args.mode}});
afterInitialize(args);return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.JsRO=JsRO})();
(function(){function SendKeys(params){var _args={"apiObject":null,"sender":null,"events":{"sendFunctionKey":null,"sendKeyDown":null,"sendKeyUp":null,"sendKeyStroke":null,"sendText":null,"sendKeys":null}};var _KEYBOARD_ACTION_TYPE=helper.object.createEnum("DOWN","UP","FKEY","TYPE","STROKE");var _skMethods={"sendFunctionKey":function(key){_args.sender.sendFunctionKey(key);if(_args.events.sendFunctionKey)_args.events.sendFunctionKey(key)},"sendKeyDown":function(key){_args.sender.sendKeyDown(key);if(_args.events.sendKeyDown)_args.events.sendKeyDown(key)},
"sendKeyUp":function(key){_args.sender.sendKeyUp(key);if(_args.events.sendKeyUp)_args.events.sendKeyUp(key)},"sendKeyStroke":function(key){_args.sender.sendKeyStroke(key);if(_args.events.sendKeyStroke)_args.events.sendKeyStroke(key)},"sendText":function(text){_args.sender.sendText(text);if(_args.events.sendText)_args.events.sendText(text)},"sendKeys":function(kbActions){for(var k=0;k<kbActions.length;k++)switch(kbActions[k].action){case _KEYBOARD_ACTION_TYPE.DOWN:_skMethods.sendKeyDown(kbActions[k].key);
break;case _KEYBOARD_ACTION_TYPE.UP:_skMethods.sendKeyUp(kbActions[k].key);break;case _KEYBOARD_ACTION_TYPE.TYPE:_skMethods.sendText(kbActions[k].text);break;case _KEYBOARD_ACTION_TYPE.FKEY:_skMethods.sendFunctionKey(kbActions[k].key);break;default:_skMethods.sendKeyStroke(kbActions[k].key)}}};function init(){if(params.apiObject==null)throw"The apiObject cannot be null";else if(!((params.sender||params.apiObject)instanceof ThinVNC))throw"The sender must be instance of ThinVNC";if(!_args.sender)_args.sender=
_args.apiObject;_args.apiObject=params.apiObject;_args.sender=params.sender;helper.object.merge(params.events,_args.events,false);for(var method in _skMethods)if(!_args.apiObject.hasOwnProperty(method))Object.defineProperty(_args.apiObject,method,{"enumerable":true,"configurable":false,"writable":false,"value":_skMethods[method]});if(!_args.apiObject.hasOwnProperty("KEYBOARD_ACTION_TYPE"))Object.defineProperty(_args.apiObject,"KEYBOARD_ACTION_TYPE",{"enumerable":true,"configurable":false,"get":function(){return _KEYBOARD_ACTION_TYPE}})}
init()}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.SendKeys=SendKeys})();
(function(){var enumDocType=helper.object.createEnum({"PRINT_TYPE_RAW":1,"PRINT_TYPE_BITMAP":2,"PRINT_TYPE_XPS":3,"PRINT_TYPE_PDF":4,"PRINT_TYPE_DIRECT":5});var enumMessageType=helper.object.createEnum({"MESSAGE_TYPE_COMMAND":1,"MESSAGE_TYPE_COMMAND_DATA":2,"MESSAGE_TYPE_COMMAND_PRINT":3,"MESSAGE_TYPE_COMMAND_PRINT_DATA":4,"MESSAGE_TYPE_COMMAND_PRINT_RAWDATA":5});var enumResponseType=helper.object.createEnum({"RESPONSE_TYPE_ERROR":-1,"RESPONSE_TYPE_OK":1,"RESPONSE_TYPE_STATUS":2,"RESPONSE_TYPE_INFO":3,
"RESPONSE_TYPE_SETTING":4,"RESPONSE_TYPE_PRINTERS":5,"RESPONSE_TYPE_PRINTER_SETTING":6,"RESPONSE_TYPE_PRINTER_CHANGE":7,"RESPONSE_TYPE_COMMAND_PRINT":8});var enumStatus=helper.object.createEnum({"STATUS_PRINTER_READY":0,"STATUS_PRINTER_PRINTING":1,"STATUS_PRINTER_BUSY":2,"STATUS_PRINTER_LOCKED":3});var enumActionType=helper.object.createEnum({"ACTION_GET_PRINTER_INFO":1,"ACTION_ABORT_PRINT":2,"ACTION_CHANGE_ACTIVE_PRINTER":3,"ACTION_BEGIN_DOC":4,"ACTION_END_DOC":5,"ACTION_PRINT":6,"ACTION_GET_PRINTER_STATUS":7,
"ACTION_SETUP_PRINTER":8,"ACTION_RESET_PRINT":9,"ACTION_SET_PRINTER_SETTING":10,"ACTION_GET_PRINTER_SETTING":11,"ACTION_GET_PRINTERS":12});var enumErrorCodeType=helper.object.createEnum({"RROR_CODE_NOT_ERROR":0,"ERROR_CODE_MESSAGE_TYPE_INVALID":1,"ERROR_CODE_EXCEPTION":2,"ERROR_CODE_GUID_ERROR":3,"ERROR_CODE_PRINTER_ERROR":4});function PrinterClientNode(args){var Root=protobuf.Root;var Type=protobuf.Type;var Field=protobuf.Field;var root=new Root;var _args={"autoStart":false};var _vcnode=null;var _callbacks=
{"printJobs":{},"getPrinters":[],"ready":[]};var _printMessage=null;var _initialized=false;var _ready=false;var _ref=this;function initialize(){if(Thinfinity.VirtualChannels&&Thinfinity.VirtualChannelNode){helper.object.parseAttributes(_args,args);_printMessage=new PrintMessage;_vcnode=new Thinfinity.VirtualChannelNode({"pluginName":"print","channelOrigin":Thinfinity.VirtualChannels.ChannelOrigin.CLIENT,"runMode":Thinfinity.VirtualChannelNode.ChannelRunMode.NODE,"events":{"message":processMessage,
"close":function(){},"ready":function(){_ready=true;callBackResponse("ready",{})}}});if(_args.autoStart)setTimeout(open,1)}else helper.console.log(`Thinfinity Printer Client Node is disabled. (check VirtualChannels flag)`)}function PrintMessage(){var _ref=this;var _msgTypes={"PrintChannelMsgAction":null,"PrintChannelMsgActionData":null,"PrintChannelMsgPrintAction":null,"PrintChannelMsgPrintActionData":null,"PrintChannelMsgPrintActionRawData":null};var _defTypes={1:{"class":"PrintChannelMsgAction",
"fields":[{"name":"MsgType","pos":1,"type":"sint32"},{"name":"Action","pos":2,"type":"sint32"}]},2:{"class":"PrintChannelMsgActionData","fields":[{"name":"MsgType","pos":1,"type":"sint32"},{"name":"Action","pos":2,"type":"sint32"},{"name":"Data","pos":3,"type":"string"}]},3:{"class":"PrintChannelMsgPrintAction","fields":[{"name":"MsgType","pos":1,"type":"sint32"},{"name":"Action","pos":2,"type":"sint32"},{"name":"UniqueID","pos":3,"type":"string"}]},4:{"class":"PrintChannelMsgPrintActionData","fields":[{"name":"MsgType",
"pos":1,"type":"sint32"},{"name":"Action","pos":2,"type":"sint32"},{"name":"UniqueID","pos":3,"type":"string"},{"name":"DocumentType","pos":4,"type":"sint32"},{"name":"PrinterName","pos":5,"type":"string"},{"name":"Data","pos":6,"type":"string"}]},5:{"class":"PrintChannelMsgPrintActionRawData","fields":[{"name":"MsgType","pos":1,"type":"sint32"},{"name":"Action","pos":2,"type":"sint32"},{"name":"UniqueID","pos":3,"type":"string"},{"name":"RawSize","pos":4,"type":"sint32"},{"name":"RawData","pos":5,
"type":"bytes"}]}};var _resTypes={"PrinterMessageError":null,"PrinterInfoSmall":null,"PrinterStatusResponse":null,"PrintChannelResponse":null,"PrintChannelInfoResponse":null,"PrintChannelPrintersResponse":null,"PrinterJobSettingMsg":null,"PrinterChangePrinterMsg":null,"PrintChannelMsgPrintActionResponse":null,"PrinterInfo":null,"PrinterSettings":null,"TDPI":null,"TPageSize":null};var _defResTypes={"-1":{"class":"PrinterMessageError","fields":[{"name":"ResponseType","pos":1,"type":"sint32"},{"name":"ErrorCode",
"pos":2,"type":"sint32"},{"name":"Message","pos":3,"type":"string"}]},2:{"class":"PrinterStatusResponse","fields":[{"name":"ResponseType","pos":1,"type":"sint32"},{"name":"Status","pos":2,"type":"sint32"}]},4:{"class":"PrintChannelInfoResponse","fields":[{"name":"ResponseType","pos":1,"type":"sint32"},{"name":"ActivePrinter","pos":2,"type":"PrinterInfo","repeated":false},{"name":"Printers","pos":3,"type":"PrinterInfo","repeated":true}]},5:{"class":"PrintChannelPrintersResponse","fields":[{"name":"ResponseType",
"pos":1,"type":"sint32"},{"name":"UniversalPrinter","pos":2,"type":"PrinterInfoSmall","repeated":false},{"name":"Printers","pos":3,"type":"PrinterInfoSmall","repeated":true}]},6:{"class":"PrinterJobSettingMsg","fields":[{"name":"MsgType","pos":1,"type":"sint32"},{"name":"Action","pos":2,"type":"sint32"},{"name":"PrinterSettings","pos":3,"type":"PrinterSettings","repetead":false}]},7:{"class":"PrinterChangePrinterMsg","fields":[{"name":"MsgType","pos":1,"type":"sint32"},{"name":"Action","pos":2,"type":"sint32"},
{"name":"Printer","pos":3,"type":"PrinterInfoSmall","repetead":false}]},8:{"class":"PrintChannelMsgPrintActionResponse","fields":[{"name":"MsgType","pos":1,"type":"sint32"},{"name":"Action","pos":2,"type":"sint32"},{"name":"UniqueID","pos":3,"type":"string"},{"name":"ResponseCode","pos":4,"type":"sint32"}]},"PrintChannelResponse":{"class":"PrintChannelResponse","fields":[{"name":"ResponseType","pos":1,"type":"sint32"}]},"PrinterInfoSmall":{"class":"PrinterInfoSmall","fields":[{"name":"Name","pos":1,
"type":"string"},{"name":"Driver","pos":2,"type":"string"},{"name":"Port","pos":3,"type":"string"}]},"PrinterInfo":{"class":"PrinterInfo","fields":[{"name":"Name","pos":1,"type":"string"},{"name":"IsDefault","pos":2,"type":"bool"},{"name":"Driver","pos":3,"type":"string"},{"name":"Port","pos":4,"type":"string"},{"name":"Orientation","pos":5,"type":"sint32"},{"name":"DPI","pos":6,"type":"TDPI","repeated":false},{"name":"DPIs","pos":7,"type":"TDPI","repeated":true},{"name":"PageSize","pos":8,"type":"TPageSize",
"repeated":false},{"name":"PageSizes","pos":9,"type":"TPageSize","repeated":true}]},"PrinterSettings":{"class":"PrinterSettings","fields":[{"name":"ActivePrinter","pos":1,"type":"PrinterInfoSmall","repeated":false},{"name":"DocTitle","pos":2,"type":"string"},{"name":"Copies","pos":3,"type":"sint32"},{"name":"Orientation","pos":4,"type":"sint32"},{"name":"DPI_X","pos":5,"type":"sin32"},{"name":"DPI_Y","pos":6,"type":"sint32"},{"name":"PageSize","pos":8,"type":"sint32"}]},"TDPI":{"class":"TDPI","fields":[{"name":"x",
"pos":1,"type":"sint32"},{"name":"y","pos":2,"type":"sint32"}]},"TPageSize":{"class":"TPageSize","fields":[{"name":"Name","pos":1,"type":"string"},{"name":"Code","pos":2,"type":"sint32"}]}};function initialize(){registerProtoBufferClassTypes(_defTypes,_msgTypes);registerProtoBufferClassTypes(_defResTypes,_resTypes)}function registerProtoBufferClassTypes(classTypeDefinition,target){var def=null;var f=null;for(var k in classTypeDefinition){def=classTypeDefinition[k];helper.console.log("Define protoBuffer class: "+
def.class);var classElem=new Type(def.class);def.fields.forEach(function(field){f=new Field(field.name,field.pos,field.type,field.repeated?"repeated":undefined);classElem.add(f)});root.define(def.class);root.add(classElem);target[def.class]=classElem}}function decodeMessageType(buffer){var type=_resTypes.PrintChannelResponse.decode(new Uint8Array(buffer)).ResponseType;helper.console.log(helper.string.format("PRINT::PrintChannelResponse: {0}",type),arguments);return type}function decodeMessage(buffer,
type){type=type||decodeMessageType(buffer);var data="";var decodeClass=_defResTypes[type]?_defResTypes[type].class:null;if(decodeClass)data=_resTypes[decodeClass].decode(new Uint8Array(buffer));return data}function getResponseMessage(type){if(_defTypes[type]){var encodeClass=_defTypes[type]?_defTypes[type].class:null;if(encodeClass)return _msgTypes[encodeClass]}}Object.defineProperty(_ref,"decodeMessageType",{"enumerable":true,"configurable":true,"writable":false,"value":decodeMessageType});Object.defineProperty(_ref,
"decodeMessage",{"enumerable":true,"configurable":true,"writable":false,"value":decodeMessage});Object.defineProperty(_ref,"getResponseMessage",{"enumerable":true,"configurable":true,"writable":false,"value":getResponseMessage});initialize();return _ref}function getStringMessageType(type){for(var kvp in enumResponseType)if(enumResponseType[kvp]===type)return kvp}function getStringActionType(type){for(var kvp in enumActionType)if(enumActionType[kvp]===type)return kvp}function logMessageType(type){helper.console.log(getStringMessageType(type),
arguments)}function logActionType(type){helper.console.log(getStringActionType(type),arguments)}function processMessage(data){var response=false;if(data){var decodedType=data?_printMessage.decodeMessageType(data):null;var decode=true;var decodedData=_printMessage.decodeMessage(data,decodedType);logMessageType(decodedType);switch(decodedType){case enumResponseType.RESPONSE_TYPE_ERROR:helper.console.warning(helper.string.format("Error: {1} - {0}",enumErrorCodeType.getKey(decodedData.ErrorCode),decodedData.Message),
arguments);break;case enumResponseType.RESPONSE_TYPE_OK:break;case enumResponseType.RESPONSE_TYPE_STATUS:break;case enumResponseType.RESPONSE_TYPE_INFO:break;case enumResponseType.RESPONSE_TYPE_SETTING:break;case enumResponseType.RESPONSE_TYPE_PRINTERS:logActionType(decodedData.ResponseType);callBackResponse("getPrinters",decodedData);break;case enumResponseType.RESPONSE_TYPE_PRINTER_SETTING:break;case enumResponseType.RESPONSE_TYPE_PRINTER_CHANGE:break;case enumResponseType.RESPONSE_TYPE_COMMAND_PRINT:var pJob=
getPrintJob(decodedData.UniqueID);if(pJob){callBackStatus("printJobs",pJob.guid,{"message":enumActionType.getKey(decodedData.Action),"action":decodedData.Action});switch(decodedData.Action){case enumActionType.ACTION_ABORT_PRINT:releasePrintJob(pJob);break;case enumActionType.ACTION_BEGIN_DOC:pJob.ready=true;print(pJob);break;case enumActionType.ACTION_PRINT:pJob.sending=false;print(pJob);break;case enumActionType.ACTION_END_DOC:releasePrintJob(pJob);break}}break}}return response}function getPrintJob(guid){if(_callbacks.printJobs[guid])return _callbacks.printJobs[guid]}
function getGUID(){return helper.utils.maskToGUID("{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}")}function getDefaultGuid(){if(_callbacks.printJobs){var count=0;var guid,tguid=null;for(tguid in _callbacks.printJobs)if(!_callbacks.printJobs[tguid].finished){guid=tguid;count++}else delete _callbacks.printJobs[tguid];if(count==1)return guid}}function emptyPrintQueue(){if(_callbacks.printJobs){for(tguid in _callbacks.printJobs){var pJob=_callbacks.printJobs[tguid];if(!pJob.finished){pJob.endDoc=true;finishPrint(pJob)}}_callbacks.printJobs=
{}}}function startPrinting(jData){if(jData&&typeof jData.cmd!=="undefined")switch(jData.cmd){case enumActionType.ACTION_BEGIN_DOC:if(typeof enumDocType.getKey(jData.type)==="undefined")jData.type=enumDocType.PRINT_TYPE_XPS;var guid=getGUID();emptyPrintQueue();_callbacks.printJobs[guid]={"callback":jData.callback,"type":jData.type,"chunks":[],"printerName":jData.printerName,"documentTitle":jData.documentTitle,"guid":guid,"finished":false,"sending":false};beginPrint(_callbacks.printJobs[guid]);return guid;
case enumActionType.ACTION_PRINT:if(typeof jData.guid==="undefined")jData.guid=getDefaultGuid();var pJob=getPrintJob(jData.guid);if(pJob){pJob.chunks.push(jData.data);print(pJob)}else{var msg="Invalid document guid";helper.console.warning(msg,arguments);return msg}break;case enumActionType.ACTION_END_DOC:if(typeof jData.guid==="undefined")jData.guid=getDefaultGuid();if(jData.guid){var pJob=getPrintJob(jData.guid);pJob.endDoc=true;finishPrint(pJob)}break}}function beginPrint(pJob){var encodeClass=
_printMessage.getResponseMessage(enumMessageType.MESSAGE_TYPE_COMMAND_PRINT_DATA);_vcnode.write(encodeClass.encode(encodeClass.create({"MsgType":enumMessageType.MESSAGE_TYPE_COMMAND_PRINT_DATA,"Action":enumActionType.ACTION_BEGIN_DOC,"UniqueID":pJob.guid,"DocumentType":pJob.type,"PrinterName":pJob.printerName,"Data":pJob.documentTitle})).finish())}function print(pJob){var encodeClass=null;if(pJob)if(pJob.ready&&!pJob.sending){var idx=0;if(pJob.chunks.length>0){pJob.sending=true;encodeClass=_printMessage.getResponseMessage(enumMessageType.MESSAGE_TYPE_COMMAND_PRINT_RAWDATA);
_vcnode.write(encodeClass.encode(encodeClass.create({"MsgType":enumMessageType.MESSAGE_TYPE_COMMAND_PRINT_RAWDATA,"Action":enumActionType.ACTION_PRINT,"UniqueID":pJob.guid,"RawSize":pJob.chunks[idx].byteLength,"RawData":pJob.chunks[idx]})).finish());pJob.chunks.splice(0,1)}else if(pJob.endDoc)finishPrint(pJob)}}function finishPrint(pJob){if(!pJob.finished&&!pJob.sending&&pJob.endDoc&&pJob.chunks.length===0){pJob.finished=true;encodeClass=_printMessage.getResponseMessage(enumMessageType.MESSAGE_TYPE_COMMAND_PRINT);
_vcnode.write(encodeClass.encode(encodeClass.create({"MsgType":enumMessageType.MESSAGE_TYPE_COMMAND_PRINT,"Action":enumActionType.ACTION_END_DOC,"UniqueID":pJob.guid})).finish())}}function releasePrintJob(pJob){delete _callbacks.printJobs[pJob.guid]}function abortPrintJob(guid){var pJob=getPrintJob(guid);if(pJob){encodeClass=_printMessage.getResponseMessage(enumMessageType.MESSAGE_TYPE_COMMAND_PRINT);_vcnode.write(encodeClass.encode(encodeClass.create({"MsgType":enumMessageType.MESSAGE_TYPE_COMMAND_PRINT,
"Action":enumActionType.ACTION_ABORT_PRINT,"UniqueID":pJob.guid})).finish());return true}else{var msg="Cannot find the print job, please check your guid.";helper.console.warning(msg,arguments);return msg}}function callBackResponse(name,data){if(_callbacks[name]){for(var i=0,t=_callbacks[name].length;i<t;i++)try{_callbacks[name][i](data)}catch(error){helper.console.warning(helper.string.format("Error handling callback '{0}' - {1}",name,error.message),arguments)}_callbacks[name]=[]}}function callBackStatus(name,
guid,data){if(_callbacks[name]&&_callbacks[name][guid])try{_callbacks[name][guid].callback(data)}catch(error){helper.console.warning(helper.string.format("Error handling callback '{0}' - {1}",name,error.message),arguments)}}function getPrinters(callback){if(typeof _callbacks.getPrinters==="undefined")_callbacks.getPrinters=[];_callbacks.getPrinters.push(callback);var encodeClass=_printMessage.getResponseMessage(enumMessageType.MESSAGE_TYPE_COMMAND);_vcnode.write(encodeClass.encode(encodeClass.create({"MsgType":enumMessageType.MESSAGE_TYPE_COMMAND,
"Action":enumActionType.ACTION_GET_PRINTERS})).finish())}function open(){if(_initialized!==true){_vcnode.init();_vcnode.open();_initialized=true}}function nodeReady(callback){_callbacks.ready.push(callback);if(_ready)callBackResponse("ready",{})}initialize();Object.defineProperty(_ref,"__private__",{"enumerable":true,"configurable":true,"get":function(){return _vcnode.__private__}});Object.defineProperty(_ref,"getPrinters",{"enumerable":true,"configurable":false,"writable":false,"value":getPrinters});
Object.defineProperty(_ref,"print",{"enumerable":true,"configurable":false,"writable":false,"value":startPrinting});Object.defineProperty(_ref,"cancel",{"enumerable":true,"configurable":false,"writable":false,"value":abortPrintJob});Object.defineProperty(_ref,"open",{"enumerable":true,"configurable":true,"writable":false,"value":open});Object.defineProperty(_ref,"ready",{"enumerable":true,"configurable":true,"writable":false,"value":nodeReady});return _ref}Object.defineProperty(PrinterClientNode,
"enumActionType",{"enumerable":true,"configurable":false,"get":function(){return enumActionType}});Object.defineProperty(PrinterClientNode,"enumErrorCodeType",{"enumerable":true,"configurable":false,"get":function(){return enumErrorCodeType}});Object.defineProperty(PrinterClientNode,"enumDocType",{"enumerable":true,"configurable":false,"get":function(){return enumDocType}});try{Thinfinity!==undefined}catch(e){Thinfinity={}}Thinfinity.PrinterClientNode=PrinterClientNode})();
(function(){function ClientSettings(args){var _ref=this;var _clientSettings={"CursorVisible":null,"OverrideCursor":true,"MouseMoveGestureStyle":null,"MouseMoveGestureAction":null,"MouseWheelDirection":null,"MouseWheelStepValue":null,"MouseWheelZoom":null,"MousePressAsRightButton":null,"Mobile":{"Gestures":[],"KeyboardCaretWait":200},"DockMenu":{"Enabled":null,"Pinned":null,"Style":"default","Embedded":true,"Items":{"WindowList":null,"ErrorReporting":null,"BrowserCapabilities":null,"Keyboard":null,
"Fullscreen":null,"TabletModeAvailable":null}},"UseViewportSize":null,"PrintDialog":{"DefaultMethod":typeof PrintDialog!="undefined"?PrintDialog.printMethods.DEFAULT:0,"BypassDialog":null},"PreventMobileKeyboardDisplay":null};var _defaultValues={"Mobile":{"Gestures":Thinfinity&&Thinfinity.Mobile?Thinfinity.Mobile.defaultTouchGestures:[]}};var _originalClientSettings=null;var _view={};function initialize(args){helper.object.extend(_clientSettings,args,true);_originalClientSettings=helper.object.clone(_clientSettings);
applySetterAndGetter()}function applySetterAndGetter(){try{_view={};createSetterAndGetter(_view,_clientSettings,"")}catch(error){helper.console.error(error.message,error,arguments)}}function getValue(view,path){var idx=path.indexOf(".")!=-1?path.indexOf("."):path.length;var tempPath=path.substring(0,idx);path=path.substring(idx+1,path.length);if(tempPath!="")return getValue(view[tempPath],path);else return view}function setValue(view,path,value){var idx=path.indexOf(".")!=-1?path.indexOf("."):path.length;
var tempPath=path.substring(0,idx);path=path.substring(idx+1,path.length);if(tempPath!=""&&path!="")return setValue(view[tempPath],path,value);else return view[tempPath]=value}function createSetterAndGetter(node,obj,path){for(var attrib in obj){var type=helper.object.getDataTypeOf(obj[attrib]);switch(type){case "object":if(helper.object.existsPath(obj[attrib],"nodeType")){defineProperty(node,attrib,(path.length>0?path+".":"")+attrib);break}case "json":node[attrib]={};createSetterAndGetter(node[attrib],
obj[attrib],(path.length>0?path+".":"")+attrib);break;default:defineProperty(node,attrib,(path.length>0?path+".":"")+attrib);break}}}function defineProperty(obj,name,path){Object.defineProperty(obj,name,{"enumerable":true,"configurable":false,"get":function(){return getValue(_clientSettings,path)},"set":function(value){return setValue(_clientSettings,path,value)}})}function applyServerSettings(data){try{helper.object.parseAttributes(_clientSettings,data,"MATCH")}catch(error){helper.console.error(error.message,
error,arguments)}}function getDataAsJson(){return JSON.stringify(_clientSettings)}function setSettings(value){var typeOf=helper.object.getDataTypeOf(value);if(typeOf=="json"||typeOf=="object")initialize(value);typeOf=null}initialize(args);Object.defineProperty(_ref,"clientSettings",{"enumerable":true,"configurable":false,"get":function(){return _view},"set":function(value){return setSettings(value)}});Object.defineProperty(_ref,"originalClientSettings",{"enumerable":true,"configurable":false,"get":function(){return _originalClientSettings}});
Object.defineProperty(_view,"defaultValues",{"enumerable":true,"configurable":false,"get":function(){return _defaultValues}});Object.defineProperty(_ref,"__json__",{"enumerable":true,"configurable":false,"value":function(){return getDataAsJson()}});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.ClientSettings=ClientSettings})();
(function(){var _login_actions=helper.object.createEnum("LOGIN","CREDENTIALS_UPDATE","GET_METHODS","TFA","READY");var _response_msgs=helper.object.createEnum("ACTION_OK","ACTION_FAILED","CREDENTIALS_EXPIRED","INVALID_DATA","EMPTY_RESPONSE","TFA_REQUEST");function VirtualUI(options){productId="virtualui";var _ref=this;var THIN=null;var connected=false;var autoStart=false;var closing=false;var data=Thinfinity.global.variables.profile;var _encPostData=Thinfinity.global.variables.encPostData;var _runInFullScreen=
false;var _runInNewWindow=false;var _devMode=false;var _catchError=false;var _errorTimeoutId=null;var _storageKey="thinfinity.virtualUI";var _localStorageAvailable=false;var _windowTop=null;var _clipboardObj={};var _terminateStatus=helper.object.createEnum({"RELOAD":0,"CLOSE_WINDOW":1,"GOTO_MAIN":2,"DISCONNECT":3});var _config={"forLogin":false,"virtualKeyboard":true};var _audit={"enabled":false,"obj":null};var _clientSettingsClass=null;var _enumMouseMoveGestureStyle=helper.object.createEnum({"RELATIVE":0,
"ABSOLUTE":1});var _crossDomain=false;var _repl=false;var fireEvent=null;var _connected=false;var _defaultFireEventArgs={async:false};var connEnvironment=null;var _isLegacy=typeof legacyVersion!="undefined"?legacyVersion:true;var _toolbar=null;var _winToolbar=null;var _displayFormAppsAsTabs=false;var _thinMenuProps=null;var _selectedWindow=null;function initialize(options){connEnvironment=environment.getEnvironmentInformation();try{if(parent&&parent.document);else _crossDomain=true}catch(error){_crossDomain=
true}if(typeof data=="undefined"||!data)data={};else if(typeof data=="string")try{data=JSON.parse(unescape(data))}catch(e){helper.console.warning(e.message,arguments);data={}}Thinfinity.Theme.apply({auto:true});helper.object.parseAttributes(_config,options,"match");fireEvent=(new Thinfinity.Events({"owner":_ref,"events":options?.events||null})).fireEvent;_windowTop=helper.url.getTopWindow(window);var vpath=helper.url.gup("vpath",_windowTop);var removeStorageKey=true;try{var testItem=_storageKey+"_test_"+
(new Date).getTime().toString();if(typeof localStorage!="undefined"&&localStorage.setItem){localStorage.setItem(testItem,true);localStorage.removeItem(testItem);_localStorageAvailable=true}else _localStorageAvailable=false}catch(error){_localStorageAvailable=false;helper.console.warning("Local storage quota is disabled, please change browser settings, or try to run without private mode.")}if(_windowTop==window&&document.referrer&&location.href!=document.referrer){removeStorageKey=false;if(_localStorageAvailable){localStorage.removeItem(_storageKey+
"_URL");if(document.referrer&&document.referrer.search("oturl.html")!=-1)localStorage.setItem(_storageKey+"_URL",document.referrer)}}else if(vpath!="")removeStorageKey=false;if(removeStorageKey&&_localStorageAvailable)localStorage.removeItem(_storageKey+"_URL");if(vpath!="")_windowTop.history.replaceState({},document.title,_windowTop.location.href.replace(_windowTop.location.search,""));_connEnvironment=getConnectionEnvironment();Thinfinity.Popups.establishing.backgroundStyle=Thinfinity.Popups.establishing.backgroundStyles.NONE;
_clientSettingsClass=new Thinfinity.ClientSettings;THIN=GetWebFMX(null,_config.forLogin||null,productId,{"vui":_ref});THIN.fromBroker=helper.object.convertTo(helper.object.getValue(data,"fromBroker",false),"boolean");_audit["enabled"]=typeof Thinfinity!="undefined"&&typeof Thinfinity.Audit!="undefined";_runInFullScreen=_connEnvironment.inFullScreen}function getConnectionEnvironment(){var wb;var wndp=null;if(window.parent&&window!=window.parent)try{if(window.parent.location.href)wndp=window.parent}catch(error){wndp=
window}else wndp=window;var wb=wndp&&wndp.location.host==window.location.host&&wndp.location.protocol==window.location.protocol&&window.location.pathname.endsWith(wndp.location.pathname);var isChildOfTop=wndp!=window&&wndp==top;var mw=isChildOfTop?wndp:window;var info={"withBroker":wb,"childOfTop":isChildOfTop,"referrer":_crossDomain&&wndp==window?"":wb?wndp.document.referrer:window.document.referrer,"fromIndex":_crossDomain&&wndp==window?false:wb&&wndp.document.referrer!="","mainWindow":mw,"inFullScreen":_crossDomain?
false:!!window.top.document.body.querySelector("div.fullscreen-container"),"inNewWindow":mw.opener&&mw!=mw.opener||mw.document.referrer==mw.document.location.href||mw.document.referrer==""||wndp==window&&window.document.referrer.indexOf("oturl")!=-1||_crossDomain&&wndp==window};return info}function connect(customData){if(customData!=null)data=customData;else if(data==""){_devMode=true;data={}}if(data){if(data.devMode)_devMode=true;_displayFormAppsAsTabs=_clientSettingsClass?.clientSettings?.DockMenu?.Style?.toUpperCase()===
"TASKBAR";start(data)}else closeOrReload(sprintf(consts.connAttemptFailed,""))}function preventExecution(response){return _isLegacy&&response.preventExecution!==false||!_isLegacy&&response.preventExecution===true}function updateWinApps(){let _formApps=null;if(_displayFormAppsAsTabs)_formApps={activeid:null,icons:[],windows:[]};else _formApps=[];var elems=document.querySelectorAll('div[wndClass]:not([wndClass="TCustomHintWindow"])');for(var i=0;i<elems.length;i++){var elem=elems[i];if(elem!=undefined&&
elem!=null&&(elem.style.visibility!="hidden"&&elem.style.display!="none")){var hwnd=elem.id.toString().substr(elem.id.lastIndexOf("_")+1,elem.id.length);var icons=elem.getElementsByClassName("icon");var icon=icons!=null&&icons.length>0?icons[0].childNodes[0].src:null;if(icon){var titles=elem.getElementsByClassName("title");var title=titles!=null&&titles.length>0?titles[0].getAttribute("hwndTitle")||titles[0].innerHTML:"";let active=elem.className.indexOf(" active")!=-1;if(_displayFormAppsAsTabs){_formApps.icons.push({id:hwnd,
width:32,height:32,data:icon});if(elem.className.indexOf(" active")!=-1)_formApps.activeid=hwnd;_formApps.windows.push({id:hwnd,appid:hwnd,title,state:active?5:4,icons:[0,hwnd]})}else _formApps.push({id:hwnd,scraperId:cookiePrefix,name:title,icon,active})}}}THIN.rcParams.formApps=_formApps}function start(options){window.scroll(0,1);options.divId=productId;$(window).bind("beforeunload",function(e){if(connected&&!closing&&THIN){let response=fireEvent("beforeUnload",WebFMXconsts.closeAppMsg,THIN.enumCloseStatusReason.DISCONNECT,
_defaultFireEventArgs);if(preventExecution(response)!==true){var str=null;if(response[0]&&response[0]!="")str=response[0];e.returnValue=str;return str}}});helper.dictionary.ignoreCase=true;helper.dictionary.items=[vuiAppConsts,WebFMXconsts];$(window).bind("unload",function(e){if(connected)if(THIN)THIN.sendCmd("cmd=close")});var isFirstTime=true;if(typeof options.sourceTarget!="undefined")_runInNewWindow=options.sourceTarget=="*"||options.sourceTarget!="_self"&&window==top;else if(typeof options.targetWindow!=
"undefined")_runInNewWindow=options.targetWindow=="*"||options.targetWindow!="_self"&&window==top;else _runInNewWindow=connEnvironment.inNewWindow;_runInNewWindow=typeof _runInNewWindow!="undefined"?_runInNewWindow:options.forceCloseWindow;if(_runInNewWindow==false&&window.opener!=null)_runInNewWindow=true;autoStart=options.autostart!=undefined?options.autoStart:false;if(typeof options.connectionName!="undefined")document.title=options.connectionName;if(typeof options.icon!="undefined"){var link=
document.createElement("link");link.type="image/x-icon";link.rel="shortcut icon";link.href=options.icon;document.getElementsByTagName("head")[0].appendChild(link)}options.fitToBrowser=true;options.scaled=false;options.centered=false;options.cursorVisible=options.relativeTouch||!agentInfo.isMobile;options.showToolbarMobile=false;options.moveToWheel=agentInfo.isMobile&&!options.relativeTouch;options.virtualKeyboard=_config.virtualKeyboard;THIN.rdParams.persistentCache=options.persistentCache;options.events=
{onServerConnecting:function(status){isFirstTime=true;if(status&&status.description)if(status.state==4){var jArgs={};jArgs.message=status.description!=""?status.description:"Session initialization error";if(preventExecution(fireEvent("show",jArgs,_defaultFireEventArgs))!==true)Thinfinity.Popups.establishing.hide();terminate(jArgs);return}if(!status||!status.reconnecting){var msg=status&&status.title||"Loading...";var animated=true;var msgDetail=consts.initializing;if(status&&status.description)msgDetail=
status.description;let pe=preventExecution(fireEvent("loading",{"title":msg,"message":msgDetail,"animated":animated,"description":msgDetail},_defaultFireEventArgs));if(pe!==true)Thinfinity.Popups.establishing.show(msg,msgDetail,animated,false)}},onSessionStart:function(obj){$.unblockUI();connected=true;if(helper.object.existsPath(window,"Thinfinity.SendKeys"))_sendKeys=new Thinfinity.SendKeys({"apiObject":_ref,"sender":THIN});$("#"+options.divId).show();if(!THIN.mobile)THIN.updateTools();if(preventExecution(fireEvent("sessionStart",
{},_defaultFireEventArgs))!==true)Thinfinity.Popups.establishing.hide();initializeToolbars();isFirstTime=true},onSessionEnd:function(message){disposeToolbars();var jArgs={"message":message};function completeSessionEnd(){Thinfinity.Popups.unblock();terminate(jArgs)}fireEvent("sessionEnd",jArgs,_defaultFireEventArgs);if(!closing)if(connected&&THIN.rdParams.autoStart&&(typeof THIN.rdParams.canLogout!="undefined"&&THIN.rdParams.canLogout))THIN.logout(completeSessionEnd,completeSessionEnd);else completeSessionEnd()},
onServerConnectionError:function(errMessage){$("#"+options.divId).hide();if(preventExecution(fireEvent("error",errMessage,THIN.enumCloseStatusReason.ERROR,_defaultFireEventArgs))!==true){if(_catchError==false){_catchError=true;clearTimeout(_errorTimeoutId);_errorTimeoutId=setTimeout(function(){_catchError=false},500);terminate(errMessage)}}else closeAndBye(undefined)},onServerDisconnect:function(){if(!closing){disposeToolbars();$("#"+options.divId).hide();$.unblockUI();if(!connected){closing=true;
if(preventExecution(fireEvent("error",errMessage,THIN.enumCloseStatusReason.DISCONNECT,_defaultFireEventArgs))!==true)if(_catchError==false){_catchError=true;clearTimeout(_errorTimeoutId);_errorTimeoutId=setTimeout(function(){_catchError=false},500)}}else{if(helper.url.gup("macro")!="")try{var obj=JSON.parse(decodeURIComponent(helper.url.gup("macro")));if(obj.loop){fireEvent("reload",WebFMXconsts.serverDisconnected,THIN.enumCloseStatusReason.DISCONNECT,_defaultFireEventArgs);location.reload();return}}catch(error){}if(_runInFullScreen){var container=
window.top.document.body.querySelector("div.fullscreen-container");window.top.document.body.removeChild(container);return}var url=_localStorageAvailable?localStorage.getItem(_storageKey+"_URL"):null;if(preventExecution(fireEvent("close",url,THIN.enumCloseStatusReason.CLOSE,THIN.enumCloseStatusReason.CLOSE,_defaultFireEventArgs))!==true){closing=true;onClose()}else terminate(!connected?WebFMXconsts.connNotEstablished:consts.applicationClosed)}}if(_localStorageAvailable==true)localStorage.removeItem(_storageKey+
"_URL")},onQueryDisconnect:function(callbackDisconnect){choicePopup("","","confirmDlg","disconnectedIco","none",WebFMXconsts.disconnectConfirm,[consts.ok,consts.cancel],callbackDisconnect,"",true)},onDeleteWindow:function(hwnd){WindowDelete(hwnd)},onServerConnect:function(obj){$.unblockUI();if(_audit["enabled"]==true&&typeof THIN.plugins!=undefined&&obj)initializeAudit()},onServerSceneRender:function(){if(isFirstTime==true){isFirstTime=false;connected=true;fireEvent("show",null,_defaultFireEventArgs)}},
onServerCommandResult:function(obj){if(typeof obj.processInfo!="undefined")fireEvent("processInfo",obj.processInfo,_defaultFireEventArgs)},onServerError:function(oError){disposeToolbars();if(!closing){$("#"+options.divId).hide();$.unblockUI();if(preventExecution(fireEvent("error",oError.message,THIN.enumCloseStatusReason.ERROR,_defaultFireEventArgs))!==true){if(_catchError==false){_catchError=true;clearTimeout(_errorTimeoutId);_errorTimeoutId=setTimeout(function(){_catchError=false},500);terminate(oError)}}else closeAndBye(undefined);
closing=true}},onServerRedirect:function(url,obj){obj.divId=productId;obj.exitURL=document.referrer;obj.sourceTarget=THIN.rdParams.targetWindow;obj.connectionName=THIN.rdParams.connectionName;obj.relativeTouch=THIN.rdParams.relativeTouch;obj.showOnStart=THIN.rdParams.showOnStart;obj.showToolbar=THIN.rdParams.showToolbar;obj.scaled=THIN.rdParams.scaled;obj.resolution=THIN.rdParams.resolution;obj.clientAck=THIN.rdParams.clientAck;obj.forceAjax=THIN.rdParams.forceAjax;obj.logWindow=THIN.rdParams.logWindow;
var vfmx2=GetWebFMX(url,true,undefined,{"vui":_ref});vfmx2.connect(obj)},onReceiveMessage:function(message){if(typeof message!="undefined")fireEvent("receiveMessage",message,_defaultFireEventArgs);else alertPopup(message,"none","","","","",false)},onPropertyChange:function(controlId,property,value){logDebug("Event: onPropertyChange"+"\r\n"+"Control: "+controlId+"\r\n"+"Property "+property+": "+value)},onConnectionLost:function(status){fireEvent("connectionLost",status)},onConnectionRestored:function(status){fireEvent("connectionRestored",
status)},onRepl:function(jdata){if(jdata&&jdata.subcmd)setRepl(jdata.subcmd==="init");else fireEvent("repl",jdata,_defaultFireEventArgs)},onCopy:function(obj){return fireEvent("copy",obj,_defaultFireEventArgs)},onPaste:function(obj){return fireEvent("paste",obj,_defaultFireEventArgs)},onCut:function(obj){return fireEvent("cut",obj,_defaultFireEventArgs)},onLicenseMsg:function(obj){if(fireEvent("licenseMsg",obj,_defaultFireEventArgs).preventExecution!==true)terminate({message:obj.errorMsg})},onCreateCanvas:function(win){setTimeout(()=>
{updateWinApps()},500)},onReleaseCanvas:function(win){setTimeout(()=>{updateWinApps()},500)},onProcessWindow:function(root,win,canvas){if(win.active&&_selectedWindow!=win.hwnd){_selectedWindow=win.hwnd;setTimeout(function(){updateWinApps()},250)}}};if(window.sessionStorage)window.sessionStorage.removeItem(cookiePrefix+"_AUTHENTICATING");if(typeof _encPostData!="undefined")options.encPostData=_encPostData;initializePrintClientNode(function(printOptions){if(!_connected){if(printOptions)for(var evt in printOptions.events)options.events[evt]=
printOptions.events[evt];THIN.connect(options);_connected=true}},500)}function initializePrintClientNode(callback){if(Thinfinity.VirtualChannels)Thinfinity.VirtualChannels.ready(function(result){if(result){_printNode=Thinfinity.VirtualChannels.registerNode(new Thinfinity.PrinterClientNode({"autoStart":true}));var startNewPrintNode=function(){pJob=1;_printNode.print({"documentTitle":"","printerName":"","type":Thinfinity.PrinterClientNode.enumDocType.PRINT_TYPE_PDF,"cmd":Thinfinity.PrinterClientNode.enumActionType.ACTION_BEGIN_DOC,
"callback":function(status){helper.console.log("Status: "+status.message+" ,action: "+status.action)}})};_printNode.ready(function(){callback({"events":{"onPrintHandler":function(objprn){startNewPrintNode();_printNode.print({"cmd":Thinfinity.PrinterClientNode.enumActionType.ACTION_PRINT,"data":new Uint8Array(objprn.arrayBuffer)});_printNode.print({"cmd":Thinfinity.PrinterClientNode.enumActionType.ACTION_END_DOC})}}})})}else callback.apply(null,[result])});else callback.apply(null,[false])}function propertyChanged(name,
oldValue,newValue){if(name==="formApps"){if(_winToolbar)if(_displayFormAppsAsTabs)_winToolbar.update(newValue);else _winToolbar.updateProfiles(newValue)}else if(_toolbar)_toolbar.refresh()}async function initializeToolbars(){if(THIN.baseUrl.indexOf("__PlaybackServer__")==-1&&THIN.runRemote==false&&(helper.object.existsPath(THIN,"clientSettings.DockMenu.Enabled")==false||THIN.clientSettings.DockMenu.Enabled==true||THIN.clientSettings==false))return new Promise(resolve=>{if(!_winToolbar){if(!THIN.setFullscreen)THIN.setFullScreen=
function(active){var el=document.documentElement;if(active)window.environment.requestFullscreen(el);else window.environment.exitFullscreen(el)};_thinMenuProps=new Thinfinity.Menu.Properties({API:THIN});_thinMenuProps.ready(()=>{let windowList=THIN.clientSettings?.DockMenu?.Items?.WindowList?true:false;_winToolbar=new Thinfinity.WindowToolbar({defaultIcon:(new Thinfinity.Profile[cookiePrefix]({})).defaults.DEFAULT_ICON,showEmptyList:false,methods:{output:function(jData){if(jData?.cmd)switch(jData.cmd.toUpperCase()){case "RAPP":case "RESTORE":if(windowList)THIN.sendCmd("cmd=window&hwnd="+
(jData.data.appid||jData.data.id)+"&action="+"5");break}}},oProperties:_thinMenuProps})});_thinMenuProps.allowNotifications=true}_thinMenuProps.allowNotifications=true;_thinMenuProps.on("propertyChanged",propertyChanged);resolve()})}function disposeToolbars(){if(_toolbar)_toolbar.dispose();if(_winToolbar)_winToolbar.dispose();if(_thinMenuProps)_thinMenuProps.off("propertyChanged",propertyChanged);_toolbar=null;_winToolbar=null}function initializeAudit(){helper.console.log("Initializing Audit Object");
if(_audit["obj"]==null)THIN.registerOOBCmd("auditstart",function(e){helper.console.log("Audit model StartAudit was fired, Initializing local Audit Class.");if(_audit["obj"]!=null){var data=_audit["obj"]["getData"]();var query="cmd=audit&entries=";query+=encodeURIComponent(JSON.stringify(data));THIN.sendCmd(query);query=null;_audit["obj"].reset();_audit["obj"]=null}var tempDate=new Date;if(helper.object.existsPath(e,"time")==true)tempDate=new Date(e.time);else tempDate=new Date;_audit["obj"]=new Thinfinity.Audit({"datetime":tempDate,
"submitTime":1500,"output":function(data){var query="cmd=audit&entries=";query+=encodeURIComponent(JSON.stringify(data));THIN.sendCmd(query);query=null}});helper.console.log("Audit Object was created.");THIN.plugins({"name":"audit","obj":_audit["obj"],"enabled":true});helper.console.log("Audit Object was added as plugin.")})}function closeOrReload(message){window.close();if(document.referrer.indexOf("lab.html")==-1&&document.referrer&&location.href!=document.referrer)location.href=document.referrer;
else if(preventExecution(fireEvent("error",message,THIN.enumCloseStatusReason.ERROR,_defaultFireEventArgs))!==true){if(_catchError==false){_catchError=true;clearTimeout(_errorTimeoutId);_errorTimeoutId=setTimeout(function(){_catchError=false},500)}}else if(_devMode==true)location.reload();else location.href="about:blank"}function terminate(jArgs){if(typeof jArgs==="undefined")jArgs={};else if(typeof jArgs==="string")jArgs={message:jArgs};if(typeof jArgs.message==="undefined"||jArgs.message==="")jArgs.message=
consts.applicationClosed;if(closing)return false;closing=true;function doTerminate(){Thinfinity.Popups.establishing.hide();if(_runInFullScreen)_runInNewWindow=false;jArgs.status=_terminateStatus.CLOSE_WINDOW;if(_runInNewWindow&&THIN&&(THIN.rdParams.exitURL==""||THIN.rdParams.exitURL=="about:blank")||THIN&&THIN.isOTURLSession&&THIN.rdParams.exitURL==""){jArgs.caption="";jArgs.status=_terminateStatus.CLOSE_WINDOW;var doc=connEnvironment.mainWindow.document;if(doc.referrer==doc.location.href){var noShowPopup=
THIN&&THIN.rdParams&&THIN.rdParams.noShowConnectionClosePopup;if(noShowPopup)connEnvironment.mainWindow.document.location.reload();jArgs.message=WebFMXconsts.connClosed;jArgs.status=_terminateStatus.RELOAD;jArgs.url=connEnvironment.mainWindow.document.location}jArgs.caption=WebFMXconsts.productDescription;if(preventExecution(fireEvent("close",jArgs.url,jArgs.status,jArgs.message,_defaultFireEventArgs))!==true){let continueClose=()=>{if(_runInNewWindow)byeMessageAndTryClose();else goToMain(jArgs)};
if(noShowPopup)continueClose();else defer(Thinfinity.Popups.alert,jArgs.message,WebFMXconsts.productDescription,"disconnectedDlg","","",continueClose,false)}}else if(autoStart){jArgs.status=_terminateStatus.CLOSE_WINDOW;closeAndBye(jArgs)}else if(THIN&&THIN.rdParams&&THIN.rdParams.noShowConnectionClosePopup)goToMain(jArgs);else if(preventExecution(fireEvent("close",jArgs.url,jArgs.status,jArgs.message,_defaultFireEventArgs))!==true)defer(Thinfinity.Popups.alert,jArgs.message,WebFMXconsts.productDescription,
"disconnectedDlg","","",function(){goToMain(jArgs)},false)}if(THIN&&THIN.isOTURLSession)THIN.logout(doTerminate,doTerminate);else doTerminate()}function goToMain(jArgs){if(connEnvironment?.webV7){window.parent.postMessage({to:"webV7",type:"connection",cmd:"close",meta:connEnvironment.webV7},"*");return}if(_runInFullScreen){fireEvent("close",jArgs.url,jArgs.status,jArgs.message,_defaultFireEventArgs);if(connEnvironment.mainWindow&&connEnvironment.mainWindow.closeFullscreenContainer){connEnvironment.mainWindow.closeFullscreenContainer();
return}}if(THIN&&(THIN.isOTURLSession||!connEnvironment.fromIndex&&(THIN.rdParams.exitURL==""||THIN.rdParams.exitURL=="about:blank"))){if(THIN)THIN=null;jArgs.status=_terminateStatus.CLOSE_WINDOW;if(preventExecution(fireEvent("close",jArgs.url,jArgs.status,jArgs.message,_defaultFireEventArgs))!==true){document.body.innerHTML="";helper.dom.appendJsonElement({"parentElement":document.body,"type":"div","attributes":{"class":"bye"},"content":WebFMXconsts.connClosed})}}else if(!THIN)connEnvironment.mainWindow.location.href=
connEnvironment.referrer!=""?connEnvironment.referrer:"about:blank";else{var targetW=THIN.rdParams.sourceTarget||THIN.rdParams.targetWindow;jArgs.status=_terminateStatus.GOTO_MAIN;if(targetW!="_self"&&targetW!="*"){jArgs.url=THIN.rdParams.exitURL;if(preventExecution(fireEvent("close",jArgs.url,jArgs.status,jArgs.message,_defaultFireEventArgs))!==true)if(agentInfo.isFirefox)jArgs.url;else connEnvironment.mainWindow.open(jArgs.url,"_self","")}else{jArgs.url=THIN.rdParams.exitURL!="about:blank"?THIN.rdParams.exitURL:
connEnvironment.referrer;if(preventExecution(fireEvent("close",jArgs.url,jArgs.status,jArgs.message,_defaultFireEventArgs))!==true)connEnvironment.mainWindow.location.href=jArgs.url}}}function closeAndBye(jArgs){if(THIN&&THIN.rdParams&&THIN.rdParams.noShowConnectionClosePopup===true)bye(null,jArgs);else{if(typeof jArgs.message=="undefined")jArgs.message=WebFMXconsts.connClosed;jArgs.status=_terminateStatus.DISCONNECT;jArgs.caption=WebFMXconsts.productDescription;if(preventExecution(fireEvent("close",
jArgs.url,jArgs.status,jArgs.message,_defaultFireEventArgs))!==true)defer(Thinfinity.Popups.alert,jArgs.message,jArgs.caption,"disconnectedDlg","","",function(){bye(null,jArgs)},true)}}function bye(win,jArgs){closing=true;if(THIN)if(THIN.rcParams.sessionKey){var callback=function(){completeBye(win,jArgs)};THIN.logout(callback,callback);return}completeBye(win,jArgs)}function completeBye(win,jArgs){THIN=null;if(!win)win=connEnvironment.mainWindow;jArgs.status=_terminateStatus.CLOSE_WINDOW;if(connEnvironment.withBroker&&
connEnvironment.fromIndex&&!connEnvironment.inNewWindow){if(preventExecution(fireEvent("close",jArgs.url,jArgs.status,jArgs.message,_defaultFireEventArgs))!==true)win.location.href=win.document.referrer}else{jArgs.message=WebFMXconsts.connClosed;if(preventExecution(fireEvent("close",jArgs.url,jArgs.status,jArgs.message,_defaultFireEventArgs))!==true)byeMessageAndTryClose(win)}}function byeMessageAndTryClose(win){if(!win)win=connEnvironment.mainWindow;document.body.innerHTML="<div class='bye'>"+WebFMXconsts.connClosed+
"</div>";if(win&&connEnvironment.inNewWindow)win.close()}function defer(func){var args=[].splice.call(arguments,1);return setTimeout(function(){return func.apply(null,args)},1)}function isOTURLAccess(){if(!document.referrer)return false;else return document.referrer.search("oturl.html")!=-1}function IEDocumentReferrer(){if(agentInfo.isMSIE&&window.sessionStorage)return window.sessionStorage.getItem(cookiePrefix+"_WDR");else return false}function checkBroker(){var info={"withBroker":false,"fromIndex":false};
if(window.parent){var pLoc="";try{pLoc=window.parent.location.href}catch(e){}if(pLoc!=""){var wLoc=location.href;var pURL=pLoc.split("/");var vPath="/"+pURL.splice(pURL.length-2,1)+"/";var server=pURL.join("/");if(wLoc.match(server+".*"+vPath)!=null){info.withBroker=true;info.fromIndex=parent.document.referrer==server}}}return info}function exitApplication(){if(location.pathname=="/")virtualUI.logout();else{var bi=checkBroker();if(bi.withBroker)if(bi.fromIndex)if(parent.opener==null){parent.location.href=
parent.document.referrer;return}else parent.close();else parent.close()}}function WindowDelete(hwnd){var appIcon=document.getElementById("wIcon"+hwnd);if(appIcon){$(appIcon).unbind("click");var taskbar=document.getElementById("taskbar");if(taskbar)taskbar.removeChild(appIcon)}}function onClose(){if(status===virtualUI.enumCloseStatusReason.ERROR);if(virtualUI.devMode)location.reload();else if(isOTURLAccess()){if(window.top==window&&window.opener)window.close()}else if(typeof window.opener!="undefined"&&
window.opener!=null&&window==window.top)window.close();else if(typeof url!="undefined"&&url!=""&&url!=null)window.location.href=url;else if(window.top==window&&document.referrer&&location.href!=document.referrer&&!IEDocumentReferrer())if(document.referrer.endsWith("totp.html")||document.referrer.endsWith("?signin"))exitApplication();else location.href=document.referrer;else exitApplication()}function getLoginMethods(callback){var success=function(data){callback(data,readLoginOptions())};var fail=
function(data){var values=[];callback(values,readLoginOptions())};if(typeof callback=="undefined")return"Callback cannot be null or undefined.";THIN.getLoginMethods(success,fail)}function login(username,password,context,success,fail,redirect){THIN.login(username,password,context,function(){saveLoginOptions(context);success();fireEvent("login",true,_defaultFireEventArgs)},function(response){var data={"action":_login_actions.LOGIN,"message":_response_msgs.EMPTY_RESPONSE};if(response)if(response.rc==
-2)data={"action":_login_actions.LOGIN,"message":_response_msgs.CREDENTIALS_EXPIRED};else if(response.rc==-1)data={"action":_login_actions.LOGIN,"message":_response_msgs.INVALID_DATA};else if(response.msg)data={"action":_login_actions.LOGIN,"message":_response_msgs.ACTION_FAILED,"msgdata":response.msg};else data={"action":_login_actions.LOGIN,"message":_response_msgs.INVALID_DATA};if(typeof fail=="function")fail(data);fireEvent("login",false,_defaultFireEventArgs)},redirect)}function changePassword(username,
oldPassword,newPassword,success,fail){THIN.changePassword(username,oldPassword,newPassword,success,fail)}function logout(success,fail){THIN.logout(function(){if(success)success();fireEvent("logout",true,_defaultFireEventArgs)},function(){if(fail)fail();fireEvent("logout",false,_defaultFireEventArgs)})}function getConstants(){return WebFMXconsts||{}}function defineReplProp(ref,name,json){try{Object.defineProperty(ref,name,json)}catch(error){helper.console.error("Cannot define property ["+name+"]",
error,arguments)}}function sendRelp(jdata){var data=escape(helper.object.getDataTypeOf(jdata)=="JSON"?JSON.stringify(jdata):jdata);return THIN.sendCmd("cmd=repl&data="+data)}function setRepl(value){if(value){if(!_repl){if(!_ref.onRepl)defineReplProp(_ref,"onRepl",{"enumerable":true,"configurable":false,"set":function(handler){return _ref.on("repl",handler)}});if(!_ref.sendRepl)defineReplProp(_ref,"sendRepl",{"enumerable":true,"configurable":false,"value":sendRelp});_ref.on("repl",function(obj){helper.console.log(obj.msg)});
_repl=true}}else{_ref.off("repl");delete _ref.onRepl;delete _ref.sendRepl;_repl=false}}Object.defineProperty(this,"clientSettings",{"enumerable":true,"configurable":false,"get":function(){return _clientSettingsClass.clientSettings},"set":function(value){_clientSettingsClass.clientSettings=value}});Object.defineProperty(this,"originalClientSettings",{"enumerable":true,"configurable":false,"get":function(){return _clientSettingsClass.originalClientSettings}});initialize(options);Object.defineProperty(this,
"connect",{"enumerable":true,"configurable":false,"value":connect});Object.defineProperty(this,"logout",{"enumerable":true,"configurable":false,"value":logout});Object.defineProperty(this,"devMode",{"enumerable":true,"configurable":false,"get":function(){return _devMode}});Object.defineProperty(this,"getLoginMethods",{"enumerable":true,"configurable":false,"writable":false,"value":getLoginMethods});Object.defineProperty(this,"login",{"enumerable":true,"configurable":false,"writable":false,"value":login});
Object.defineProperty(this,"changePassword",{"enumerable":true,"configurable":false,"writable":false,"value":changePassword});Object.defineProperty(this,"constants",{"enumerable":true,"configurable":false,"get":function(){return getConstants()}});Object.defineProperty(this,"enumMouseMoveGestureStyle",{"enumerable":true,"configurable":false,"get":function(){return _enumMouseMoveGestureStyle}});Object.defineProperty(this,"enumCloseStatusReason",{"enumerable":true,"configurable":false,"get":function(){return THIN.enumCloseStatusReason}});
Object.defineProperty(_ref,"onLogin",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("login",handler)}});Object.defineProperty(_ref,"onLogout",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("logout",handler)}});Object.defineProperty(_ref,"onError",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("error",handler)}});Object.defineProperty(_ref,"onClose",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("close",
handler)}});Object.defineProperty(_ref,"onReload",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("reload",handler)}});Object.defineProperty(_ref,"onShow",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("show",handler)}});Object.defineProperty(_ref,"onSessionStart",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("sessionStart",handler)}});Object.defineProperty(_ref,"onSessionEnd",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("sessionEnd",
handler)}});Object.defineProperty(_ref,"onLoading",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("loading",handler)}});Object.defineProperty(_ref,"onBeforeUnload",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("beforeUnload",handler)}});Object.defineProperty(_ref,"onConnectionLost",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("connectionLost",handler)}});Object.defineProperty(_ref,"onConnectionRestored",{"enumerable":true,
"configurable":false,"set":function(handler){_ref.on("connectionRestored",handler)}});Object.defineProperty(_ref,"onProcessInfo",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("processInfo",handler)}});Object.defineProperty(_ref,"onReceiveMessage",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("receiveMessage",handler)}});Object.defineProperty(_ref,"onLicenseMsg",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("licenseMsg",
handler)}});Object.defineProperty(_ref,"clipboard",{"enumerable":true,"configurable":false,"get":function(){return _clipboardObj}});Object.defineProperty(_clipboardObj,"async",{"enumerable":true,"configurable":false,"get":function(){return THIN?THIN.asyncCopy:_asyncCopy},"set":function(value){return THIN?_asyncCopy=THIN.asyncCopy=value:_asyncCopy=value}});Object.defineProperty(_clipboardObj,"onCopy",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("copy",handler)}});Object.defineProperty(_clipboardObj,
"onPaste",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("paste",handler)}});Object.defineProperty(_clipboardObj,"onCut",{"enumerable":true,"configurable":false,"set":function(handler){_ref.on("cut",handler)}});Object.freeze(_clipboardObj);if(THIN?.macro)Object.defineProperty(this,"macro",{"enumerable":true,"configurable":false,"get":function(){return THIN.macro}});if(window.browserTracking&&window.eScript){_ref.onError=function(msg,code){browserTracking.terminate("Error",
msg,code)};_ref.onBeforeUnload=function(msg,code){browserTracking.terminate("Before.Unload",msg,code)};_ref.onClose=function(url){browserTracking.terminate("Close","Return url: "+url,0)};_ref.onReload=function(msg,code){browserTracking.terminate("Reload",msg,code)}}return this}Object.defineProperty(VirtualUI,"LOGIN_RESPONSE",{"enumerable":true,"configurable":false,"get":function(){return _response_msgs}});try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.VirtualUI=VirtualUI})();
var _POPUPDIALOG=null;var CLOSE_DIALOG=2;var PopupTypes=helper.object.createEnum("ALERT","CHOICE","CUSTOM");var _UNBLOCKING=false;
function PopupDialog(owner,noPropagateEvents){this.owner=owner||(typeof THIN!="undefined"?THIN:typeof TVNC!="undefined"?TVNC:null);this.opened=false;this.currentParent=null;this.parentDialog=null;this.dlgId="";this.noPropagateEvents=typeof noPropagateEvents!=="undefined"?noPropagateEvents:true;this.captureKeyboard=true;this.verticalMiddle=false;this.kbUnbound=false;this.block=function(id,msg,parentObj,onBlockAction,onUnblockAction){this.msg=msg;this.unblockAction=onUnblockAction||null;if(!parentObj){self.currentParent=
null;self.parentDialog=_POPUPDIALOG?_POPUPDIALOG.parentDialog:null;$.blockUI({message:msg,overlayCSS:{backgroundColor:"transparent"},css:{"padding":0,"margin":0,"width":"100%","height":"100%","top":"0px","left":"0px","textAlign":"center","backgroundColor":"transparent","border":"none","cursor":"auto","z-index":"900000"},centerX:true,centerY:true,onBlock:function(){self.hideCursor();self.dlgId=id;self.checkSize();$(self.msg).css({"visibility":"visible"});if(self.captureKeyboard)self.bindKeyboard();
if(typeof onBlockAction!="undefined"&&onBlockAction!=null)onBlockAction()}})}else if(_UNBLOCKING==false){self.currentParent=parentObj;self.parentDialog=_POPUPDIALOG;$(parentObj).block({message:msg,overlayCSS:{backgroundColor:"transparent"},css:{"padding":0,"margin":0,"width":"100%","height":"100%","top":"0px","left":"0px","textAlign":"center","backgroundColor":"transparent","border":"none","cursor":"auto","zIndex":"900000"},centerX:true,centerY:true,onBlock:function(){self.hideCursor();self.dlgId=
id;self.checkSize();$(self.msg).css({"visibility":"visible"});if(self.captureKeyboard)self.bindKeyboard();if(typeof onBlockAction!="undefined"&&onBlockAction!=null)onBlockAction()},onUnblock:function(){if(!!_POPUPDIALOG&&_POPUPDIALOG.opened&&typeof _POPUPDIALOG.unblockAction!="undefined")_POPUPDIALOG.unblockAction()}})}_POPUPDIALOG=this;_POPUPDIALOG.opened=true};this.unblock=function(callback){var _e=window.event;_UNBLOCKING=true;if(typeof callback=="undefined"&&_POPUPDIALOG.unblockAction)callback=
_POPUPDIALOG.unblockAction;if(!this.currentParent)$.unblockUI({onUnblock:function(){try{self.showCursor(_e);self.unbindKeyboard();if(callback)callback();self.restoreHooks();if(typeof _SESSIONCONTROLLER!="undefined")_SESSIONCONTROLLER.activate()}catch(error){helper.console.warning(helper.string.format("Cannot close popup - error: {0}",error.message||error),arguments)}finally{_UNBLOCKING=false}}});else $(this.currentParent).unblock({onUnblock:function(){try{self.showCursor(_e);self.unbindKeyboard();
$(self.currentParent).focus();if(self.notParentOrTop())self.restoreHooks();if(callback)callback()}catch(error){helper.console.warning(helper.string.format("Cannot close popup - error: {0}",error.message||error),arguments)}finally{_UNBLOCKING=false}}});if(_POPUPDIALOG)_POPUPDIALOG=_POPUPDIALOG.parentDialog};this.hideCursor=function(){var owner=this.owner;if(owner&&owner.overrideCursor===false&&owner.vncdiv&&owner.cursorCanvas){owner.vncdiv.style.cursor="default";owner.cursorCanvas.style.visibility=
"hidden"}};this.showCursor=function(e){var owner=this.owner;if(owner&&owner.overrideCursor===false&&owner.vncdiv&&owner.cursorCanvas){if(e)owner.mouseMoveAsync.position={"x":e.pageX,"y":e.pageY};setTimeout(function(){owner.vncdiv.style.cursor="none";owner.cursorCanvas.style.visibility="visible";owner.cursorCanvas.style.display="block"},100)}};this.notParentOrTop=function(){var getTopElemFromOwner=function(self){return self.owner&&self.owner.containerId?document.getElementById(self.owner.containerId):
null};return!this.currentParent||this.currentParent==getTopElemFromOwner(this)};this.bindKeyboard=function(){if(this.owner!=null&&!this.kbUnbound&&this.notParentOrTop()){this.disableHooks();if(typeof _SESSIONCONTROLLER!="undefined"&&_SESSIONCONTROLLER.isActive())_SESSIONCONTROLLER.deactivate()}var dlg=$("#"+this.dlgId);if($(dlg.children("div.divbuttons")[0]).children("a.popuplink")[0])$($(dlg.children("div.divbuttons")[0]).children("a.popuplink")[0]).addClass("selected");dlg.focus();dlg.bind("keydown",
function(e){if(self.noPropagateEvents){e.stopPropagation();e.preventDefault()}var isFieldSelected=e.target.tagName=="INPUT";var selectedBtn=$("#"+self.dlgId+" .divbuttons .selected");switch(e.keyCode){case 13:$(".divbuttons .selected").click();break;case 32:if(!isFieldSelected)$(".divbuttons .selected").click();break;case 27:var cancelBtn=document.getElementById("popupCancelBtn");if(cancelBtn)$(cancelBtn).click();else $("#PopupTBBtnClose").click();break;case 9:case 39:case 40:if(!isFieldSelected){var nextElement=
selectedBtn.next("a");if(nextElement[0]){selectedBtn.removeClass("selected");nextElement.addClass("selected")}else{selectedBtn.removeClass("selected");$(".divbuttons a").first().addClass("selected")}}break;case 37:case 38:if(!isFieldSelected){var prevElement=selectedBtn.prev("a");if(prevElement[0]){selectedBtn.removeClass("selected");prevElement.addClass("selected")}else{selectedBtn.removeClass("selected");$(".divbuttons a").first().addClass("selected")}}break}})};this.disableHooks=function(){var owner=
this.owner;if(owner!=null&&!this.kbUnbound){if(owner.unbindKeyboardEvents)owner.unbindKeyboardEvents();this.kbUnbound=true}};this.restoreHooks=function(){var owner=this.owner;if(owner!=null&&this.kbUnbound){if(owner.bindKeyboardEvents)owner.bindKeyboardEvents();this.kbUnbound=false}};this.unbindKeyboard=function(){$("#"+self.dlgId).unbind("keydown")};this.checkSize=function(){var divButtons=$("#"+this.dlgId+" .divbuttons")[0];var divBody=$("#"+this.dlgId+" .messageBody")[0];if(divButtons&&divButtons.scrollWidth>
divButtons.offsetWidth||divBody&&divBody.scrollWidth>divBody.offsetWidth){var sw1=!divButtons?0:Math.ceil(divButtons.scrollWidth/10+1)*10;var sw2=!divBody?0:Math.ceil(divBody.scrollWidth/10+1)*10;var sw=Math.max(sw1,sw2);var diff=sw-divButtons.offsetWidth;$(divButtons).width(sw);$(divBody).width(sw);var w=parseInt($(divButtons).parent().width(),10)+diff+"px !important";$(divButtons).parent().attr("style","width:"+w);$("#"+_POPUPDIALOG.dlgId).attr("style","max-width: 100%; width: "+w)}if(this.verticalMiddle){var d=
document.getElementById(_POPUPDIALOG.dlgId);if(d){var h=d.offsetHeight;var s=document.body.clientHeight;$("#"+_POPUPDIALOG.dlgId).css({"top":(h>s?0:(s-h)*.35)<<0+"px"})}}};var self=this;return this}
function choicePopup(parentObj,extraClass,id,idIco,title,bodyMsg,aButtonsText,callbackYes,callbackNo,closePreAction,noPropagateEvents){if(idIco==""||idIco==null||typeof idIco=="undefined")idIco="disconnectedIco";var titleRow="";var header="";if((typeof title=="undefined"||typeof title=="null"||title=="")&&title!="none")title=window.document.title;if(title!="none")header="<h3>"+title+"</h3>";titleRow=titleRow.concat("<div id='"+idIco+"'>&nbsp;</div>");var classes="popup";if(extraClass!="")classes+=
" "+extraClass;var btnActionNo,btnActionYes;if(closePreAction===true)if(typeof callbackYes=="string"){btnActionYes="{unblockPopup();"+callbackYes+"}";if(callbackNo==""||callbackNo==null||typeof callbackNo=="undefined")btnActionNo="{unblockPopup()}";else btnActionNo="{unblockPopup();"+callbackNo+"}"}else{btnActionYes=function(){unblockPopup();callbackYes()};if(callbackNo==""||callbackNo==null||typeof callbackNo=="undefined")btnActionNo=unblockPopup;else btnActionNo=function(){unblockPopup();callbackNo()}}else if(typeof callbackYes==
"string"){btnActionYes="{"+callbackYes+";unblockPopup()}";if(callbackNo==""||callbackNo==null||typeof callbackNo=="undefined")btnActionNo="{unblockPopup()}";else btnActionNo="{"+callbackNo+";unblockPopup()}"}else{btnActionYes=function(){callbackYes();unblockPopup()};if(callbackNo==""||callbackNo==null||typeof callbackNo=="undefined")btnActionNo=unblockPopup;else btnActionNo=function(){callbackNo();unblockPopup()}}var msg="<div tabindex='0' class='"+classes+"' id='"+id+"'>"+header+"<div class='alertBody'>"+
titleRow+bodyMsg+"</div>"+"<br/><div class='divbuttons'><a class='popuplink' id='popupCloseBtn'";if(typeof callbackYes=="string")msg+=" onclick='"+btnActionYes+"'";msg+=">"+aButtonsText[0]+"</a>&nbsp;<a class='popuplink' id='popupCancelBtn'";if(typeof callbackYes=="string")msg+=" onclick='"+btnActionNo+"'";msg+=">"+aButtonsText[1]+"</a><input type='text' style='width:1px;height:1px;visibility:hidden'/></div></div>";var popup=new PopupDialog(null,noPropagateEvents);popup.block(id,msg,parentObj);if(typeof callbackYes==
"function"){$("#popupCloseBtn").on("click",btnActionYes);$("#popupCancelBtn").on("click",btnActionNo)}return popup}
function alertPopup(bodyMsg,title,id,extraClass,parentObj,callback,forClose,btnCaption,noPropagateEvents){var classes="popup";if((typeof title=="undefined"||typeof title=="null"||title=="")&&title!="none")title=window.document.title;if(typeof id=="undefined"||typeof id=="null"||id=="")id="alertDlg";if(typeof callback=="undefined"||!callback)callback="";var titleRow="";var header="";if(title!="none")header="<h3>"+title+"</h3>";titleRow=titleRow.concat("<div id='alertIco'>&nbsp;</div>");var btnActionTxt=
typeof btnCaption!="undefined"&&btnCaption!=""?btnCaption:forClose&&!/.*mozilla.*/.exec(navigator.userAgent.toLowerCase())?consts.Close:consts.ok;if(extraClass!=""&&typeof extraClass!="undefined")classes+=" "+extraClass;var msg="<div tabindex='0' class='"+classes+"' id='"+id+"'>"+header+"<div class='alertBody'>"+titleRow+bodyMsg+"</div><br/><div class='divbuttons'><a class='popuplink' id='popupCancelBtn'";if(typeof callback=="string")msg+=" onclick='{"+callback+";unblockPopup()}'";msg+=">"+btnActionTxt+
"</a></div></div>";var popup=new PopupDialog(null,noPropagateEvents);popup.block(id,msg,parentObj);if(typeof callback=="function")$("#popupCancelBtn").on("click",callback)}
function messagePopup(bodyMsg,title,id,extraClass,parentObj,owner,onBlockAction,noPropagateEvents){owner=owner||(typeof THIN!="undefined"?THIN:typeof TVNC!="undefined"?TVNC:null);var classes="popup";if(typeof title=="undefined"||typeof title=="null"||title=="")title=window.document.title;if(typeof id=="undefined"||typeof id=="null"||id=="")id="mssgDlg";if(extraClass!=""&&typeof extraClass!="undefined")classes+=" "+extraClass;var msg="<div tabindex='0' class='"+classes+"' id='"+id+"'><div class='alertBody'>"+
bodyMsg+"</div></div>";var popup=new PopupDialog(owner,noPropagateEvents);popup.captureKeyboard=false;popup.block(id,msg,parentObj,onBlockAction)}function unblockPopup(callback){if(typeof _POPUPDIALOG!="undefined"&&_POPUPDIALOG!=null)_POPUPDIALOG.unblock(callback)}
function ProgressBar(params){if(!(params&&params.id))return null;this.divId=params.id;this.divIdx=params.idx?params.idx:"";this.fileName=params.fileName?params.fileName:"";this.barContainer=document.getElementById(this.divId);if(!this.barContainer)return null;this.backgroundColor=!params.backgroundColor?"auto":params.backgroundColor;this.color=!params.color?"auto":params.color;this.height=!params.height?"auto":params.height;this.width=!params.width?"auto":params.width;this.barHeight=!params.barHeight?
"auto":params.barHeight;this.mask=!params.mask?"$d%":params.mask;this.pos=0;this.maxValue=0;this.message=null;this.progress=null;this.container=null;this.init=function(){if(this.height!="auto")this.barContainer.style.height=this.height;if(this.width!="auto")this.barContainer.style.width=this.width;if(!this.progress){this.container=document.createElement("div");this.container.className="progressbar_container";this.progress=document.createElement("div");if(this.barHeight!="auto")this.progress.style.height=
this.barHeight;this.progress.style.zIndex=0;this.progress.id=this.divId+"_bar"+this.divIdx;this.progress.className="progressbar_bar";this.container.appendChild(this.progress);this.barContainer.appendChild(this.container);if(this.backgroundColor!="auto")this.progress.style.backgroundColor=this.backgroundColor;this.message=document.createElement("DIV");if(this.color!="auto")this.message.style.color=this.color;this.message.id=this.divId+"_msg"+this.divIdx;this.message.className="progressbar_msg";this.container.appendChild(this.message)}this.progress.style.width=
"1px";this.message.innerHTML="0%"};this.setMessage=function(message){this.message.innerHTML=message};this.setPos=function(value){this.pos=value;if(this.maxValue==0)if(value==0)this.progress.style.width="0%";else{this.progress.style.width="10%";var left=this.progress.offsetLeft;if(left>this.barContainer.offsetWidth*.9)left=0;else left+=this.progress.offsetWidth;this.progress.style.left=left+"px";this.setMessage("")}else{this.progress.style.left="0px";var percent=Math.round(Math.min(100,value*100/this.maxValue));
this.progress.style.width=+percent+"%";this.setMessage(this.mask.replace("$d",percent))}};this.show=function(){this.barContainer.style.visibility="visible"};this.hide=function(){this.barContainer.style.visibility="hidden"};this.remove=function(){this.container.removeChild(this.progress);this.container.removeChild(this.message);this.barContainer.removeChild(this.container)};this.setClass=function(value){$(this.progress).addClass(value)};this.removeClass=function(value){$(this.progress).removeClass(value)};
return this}
function createPopup(owner,popupData,parentObj){if(typeof owner=="undefined")return false;if(typeof popupData=="undefined")return false;if(typeof parentObj=="string"){parentObj=document.getElementById(parentObj);if(!parentObj)return false}var dObj=new Dialog(owner,popupData);dObj.render();var popup=new PopupDialog;popup.owner=owner;popup.verticalMiddle=true;popup.block(dObj.id,dObj.domElement,parentObj,dObj.onblockAction,dObj.restoreEnvironment);try{if(ThinVNCTouchManager)ThinVNCTouchManager.disableGestures()}catch(error){}}
function Dialog(owner,popupData){var _DIALOG=this;this.owner=owner;this.data=popupData;this.id=popupData.id;this.domElement=null;this.hasIcon=false;this.onBlockAction=null;this.customCursorRemoved=$(this.owner.vncdiv).hasClass("customCursor");this.drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};if(this.customCursorRemoved)$(this.owner.vncdiv).removeClass("customCursor");function startDrag(e){var d=_DIALOG.domElement;d.parentElement.onmousemove=drag;d.parentElement.onmouseup=endDrag;
if(agentInfo.isMobile){d.parentElement.ontouchmove=drag;d.parentElement.ontouchend=endDrag}if(d.offsetLeft!=parseInt(d.style.left,10)){var l=d.offsetLeft;d.style.marginLeft=d.style.marginRight="0px";d.style.left=l+"px"}_DIALOG.drag={"active":true,"lastX":e.x||e.touches[0].clientX,"lastY":e.y||e.touches[0].clientY,"lastCursor":$(_DIALOG.owner.vncdiv).css("cursor")};if(!TVNC.overrideCursor)$(_DIALOG.owner.vncdiv).css("cursor","move");else helper.style.changeCSSRule("div.systemPopup .title","cursor",
"move")}function drag(e){if(_DIALOG.drag.active){var x=typeof e.x!="undefined"?e.x:e.touches[0].clientX;var y=typeof e.y!="undefined"?e.y:e.touches[0].clientY;_DIALOG.domElement.style.left=_DIALOG.domElement.offsetLeft+(x-_DIALOG.drag.lastX)+"px";_DIALOG.domElement.style.top=_DIALOG.domElement.offsetTop+(y-_DIALOG.drag.lastY)+"px";_DIALOG.drag.lastX=x;_DIALOG.drag.lastY=y}}function endDrag(e){if(!TVNC.overrideCursor)$(_DIALOG.owner.vncdiv).css("cursor",_DIALOG.drag.lastCursor);else helper.style.changeCSSRule("div.systemPopup .title",
"cursor","inherit");_DIALOG.drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};_DIALOG.domElement.parentElement.onmousemove=null;_DIALOG.domElement.parentElement.onmouseup=null;if(agentInfo.isMobile){_DIALOG.domElement.parentElement.ontouchmove=null;_DIALOG.domElement.parentElement.ontouchend=null}}this.renderTitle=function(){var title=this.data.title;if(typeof title=="undefined"||typeof title=="null"||title=="")title=window.document.title;var tit=document.createElement("div");tit.className=
"title";if(this.data.icon!="mtCustom"){var tittxt=document.createElement("span");tittxt.innerHTML=this.data.title;tit.appendChild(tittxt)}this.domElement.appendChild(tit);if(_DIALOG.data.draggable){tit.onmousedown=startDrag;if(agentInfo.isMobile)tit.ontouchstart=startDrag}this.dialogTitle=tit};this.renderBody=function(){var isEqIE9=$.browser.msie&&$.browser.version==9;var mb=document.createElement("div");mb.className="messageBody";if(agentInfo.isMSIE&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor=
"auto";var itemTabIndex=0;if(this.data.dlgType=="messageDialog"){if(this.hasIcon)mb.className+=" "+this.data.icon;var mc=document.createElement("div");mc.className="caption";var mt=document.createElement("div");mt.className="captionText";mt.innerHTML=this.data.message;mc.appendChild(mt);mb.appendChild(mc)}else if(popupData.dlgType=="openFiles"){var irow=document.createElement("div");irow.className="inputRow";var ilbl=document.createElement("div");ilbl.innerHTML=helper.dictionary.getValue("pleaseSelectAFile");
irow.appendChild(ilbl);if(isEqIE9){var labelF=document.createElement("label");labelF.className="inputFileArea";var spanF=document.createElement("span");spanF.innerHTML=helper.dictionary.getValue("clickToSelectFile");spanF.setAttribute("id","infoSelectFile");labelF.appendChild(spanF);var inputF=document.createElement("input");inputF.setAttribute("type","file");inputF.setAttribute("id","inputFile");inputF.setAttribute("name","inputFile");inputF.onchange=function(e){var inputFileName=document.getElementById("inputFileName");
if(inputFileName){document.getElementById("infoSelectFile").innerHTML=this.value.replace(/C:\\fakepath\\/i,"");inputFileName.value=this.value.replace(/C:\\fakepath\\/i,"");document.getElementById("inputFileName").onchange()}else alert("inputFileName not defined")};labelF.appendChild(inputF);irow.appendChild(labelF)}else{ilbl=document.createElement("span");ilbl.className="label";ilbl.id="openFileName";ilbl.innerHTML="&nbsp;";irow.appendChild(ilbl);var iFile=document.createElement("a");iFile.id="iFile";
iFile.innerHTML="&nbsp;";iFile.className="popuplink fileBtn";$(iFile).click(function(){if($(this).attr("disabled")=="disabled")return false;var inputFile=document.getElementById("inputFile");if(inputFile)inputFile.click();else logError("inputFile element not found")});iFile.setAttribute("tabindex",0);irow.appendChild(iFile)}pb=document.createElement("DIV");pb.className="progressbar";pb.id="FMXProgressContainer";pb.style.visibility="hidden";pb.innerHTML="<span class='zero'>0%</span>";irow.appendChild(pb);
var erl=document.createElement("DIV");erl.className="error";erl.id="errorMsg";irow.appendChild(erl);mb.appendChild(irow);this.onblockAction=function(){_DIALOG.owner.dragDrop.start()}}else if(this.data.dlgType=="print"){var fieldset=this.createFieldset("Print Range");var irow=document.createElement("div");irow.className="inputRow";var rad=document.createElement("input");rad.type="radio";rad.name="printRange";rad.id="printRangeAll";rad.value="all";if(this.data.values.printRange==0)rad.checked=true;
$(rad).click(function(){$("#printFromPage").attr("disabled","disabled");$("#printToPage").attr("disabled","disabled")});irow.appendChild(rad);var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=helper.dictionary.getValue("printAllPages");irow.appendChild(ilbl);fieldset.appendChild(irow);var irow=document.createElement("div");irow.className="inputRow";var rad=document.createElement("input");rad.type="radio";rad.name="printRange";rad.id="printRangeSelection";rad.value="sel";
if(this.data.values.printRange==1)rad.checked=true;$(rad).click(function(){$("#printFromPage").attr("disabled","disabled");$("#printToPage").attr("disabled","disabled")});irow.appendChild(rad);var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=helper.dictionary.getValue("printSelection");irow.appendChild(ilbl);fieldset.appendChild(irow);var irow=document.createElement("div");irow.className="inputRow";var rad=document.createElement("input");rad.type="radio";rad.name="printRange";
rad.id="printRangeRange";rad.value="range";if(this.data.values.printRange==2)rad.checked=true;$(rad).click(function(){$("#printFromPage").removeAttr("disabled");$("#printToPage").removeAttr("disabled")});irow.appendChild(rad);var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=helper.dictionary.getValue("printPageNums");irow.appendChild(ilbl);fieldset.appendChild(irow);var irow=document.createElement("div");irow.className="inputRow";var range=document.createElement("input");
range.type="number";range.name="printFromPage";range.id="printFromPage";range.value=this.data.values.minPage||1;range.min=this.data.values.minPage||1;range.max=this.data.values.maxPage||1;range.onChange=function(){document.getElementById("printToPage").min=this.value};range.disabled=this.data.values.printRange!=2;irow.appendChild(range);var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=" - ";irow.appendChild(ilbl);var range=document.createElement("input");range.type="number";
range.name="printToPage";range.id="printToPage";range.value=this.data.values.maxPage||1;range.min=this.data.values.minPage||1;range.max=this.data.values.maxPage||1;range.onChange=function(){document.getElementById("printFromPage").max=this.value};range.disabled=this.data.values.printRange!=2;irow.appendChild(range);fieldset.appendChild(irow);mb.appendChild(fieldset);$(mb).find("input[type='number']").focus(function(){_POPUPDIALOG.noPropagateEvents=false;var $this=$(this);$this.select();$this.mouseup(function(){$this.unbind("mouseup");
return false})});$(mb).find("input[type='number']").blur(function(){var $this=$(this);var num=$this[0];if(typeof num.min!="undefined"&&num.min!=""&&num.value<num.min)num.value=num.min;else if(typeof num.max!="undefined"&&num.max!=""&&num.value>num.max)num.value=num.max;_POPUPDIALOG.noPropagateEvents=true})}else if(this.data.dlgType=="pageSetup"){var fieldset=this.createFieldset("Paper");var irow=document.createElement("div");irow.className="inputRow";irow.style.width="100%";var ilbl=document.createElement("div");
ilbl.className="label";ilbl.innerHTML=helper.dictionary.getValue("size")+":";irow.appendChild(ilbl);var ps=document.createElement("select");ps.name="printPaperSize";ps.id="printPaperSize";var measure=this.data.values.units;var orientation=this.data.values.paperSize.x>this.data.values.paperSize.y;var pWidth=Math.min(this.data.values.paperSize.x,this.data.values.paperSize.y);var pHeight=Math.max(this.data.values.paperSize.x,this.data.values.paperSize.y);var customSize=false;var selectedValue=constPrinterSheets.length;
for(var s=0;s<constPrinterSheets.length;s++){var opt=document.createElement("option");opt.value=s;opt.text=constPrinterSheets[s].name;if(measure<2&&pWidth==constPrinterSheets[s].mWidth&&pHeight==constPrinterSheets[s].mHeight){opt.selected=true;measure=1}else if(pWidth==constPrinterSheets[s].iWidth&&pHeight==constPrinterSheets[s].iHeight){opt.selected=true;measure=2}ps.appendChild(opt)}irow.appendChild(ps);fieldset.appendChild(irow);mb.appendChild(fieldset);var fieldset=this.createFieldset("Orientation");
var irow=document.createElement("div");irow.className="inputRow";var rad=document.createElement("input");rad.type="radio";rad.name="printOrientation";rad.id="prnOPortrait";rad.value="portrait";if(orientation==0)rad.checked=true;irow.appendChild(rad);var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=helper.dictionary.getValue("portrait");irow.appendChild(ilbl);fieldset.appendChild(irow);var irow=document.createElement("div");irow.className="inputRow";var rad=document.createElement("input");
rad.type="radio";rad.name="printOrientation";rad.id="prnOLandscape";rad.value="landscape";if(orientation==1)rad.checked=true;irow.appendChild(rad);var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=helper.dictionary.getValue("landscape");irow.appendChild(ilbl);fieldset.appendChild(irow);mb.appendChild(fieldset);var fieldset=this.createFieldset("Margins");var irow=document.createElement("div");irow.className="inputRow";var ilbl=document.createElement("div");ilbl.className=
"label";ilbl.innerHTML=helper.dictionary.getValue("top")+":";irow.appendChild(ilbl);var ibox=document.createElement("input");ibox.className="numValue";ibox.type="number";ibox.name="printMarginTop";ibox.id="printMarginTop";ibox.value=this.data.values.margin.top/1E3||1;ibox.min=this.data.values.minMargin.top/1E3||0;irow.appendChild(ibox);fieldset.appendChild(irow);var irow=document.createElement("div");irow.className="inputRow";var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=
helper.dictionary.getValue("bottom")+":";irow.appendChild(ilbl);var ibox=document.createElement("input");ibox.className="numValue";ibox.type="number";ibox.name="printMarginBottom";ibox.id="printMarginBottom";ibox.value=this.data.values.margin.bottom/1E3||1;ibox.min=this.data.values.minMargin.bottom/1E3||0;irow.appendChild(ibox);fieldset.appendChild(irow);var irow=document.createElement("div");irow.className="inputRow";var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=helper.dictionary.getValue("left")+
":";irow.appendChild(ilbl);var ibox=document.createElement("input");ibox.className="numValue";ibox.type="number";ibox.name="printMarginLeft";ibox.id="printMarginLeft";ibox.value=this.data.values.margin.left/1E3||1;ibox.min=this.data.values.minMargin.left/1E3||0;irow.appendChild(ibox);fieldset.appendChild(irow);var irow=document.createElement("div");irow.className="inputRow";var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=helper.dictionary.getValue("right")+":";irow.appendChild(ilbl);
var ibox=document.createElement("input");ibox.className="numValue";ibox.type="number";ibox.name="printMarginRight";ibox.id="printMarginRight";ibox.value=this.data.values.margin.right/1E3||1;ibox.min=this.data.values.minMargin.right/1E3||0;irow.appendChild(ibox);fieldset.appendChild(irow);$(fieldset).find("input").focus(function(){_POPUPDIALOG.noPropagateEvents=false;var $this=$(this);$this.select();$this.mouseup(function(){$this.unbind("mouseup");return false})});$(fieldset).find("input").blur(function(){_POPUPDIALOG.noPropagateEvents=
true});var irow=document.createElement("div");irow.className="inputRow";irow.style.width="100%";var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=helper.dictionary.getValue("measuresUnit")+":";irow.appendChild(ilbl);var ps=document.createElement("select");ps.name="measureUnits";ps.id="measureUnits";for(var m=1;m<TPageMeasureUnits.length;m++){var opt=document.createElement("option");opt.value=m;var measures=helper.dictionary.getValue("measuresUnits");opt.text=measures instanceof
Array?measures[m]:helper.dictionary.getValue(TPageMeasureUnits[m]);if(m==measure)opt.selected=true;ps.appendChild(opt)}irow.appendChild(ps);fieldset.appendChild(irow);mb.appendChild(fieldset)}else if(this.data.dlgType=="inputQuery"||this.data.dlgType=="saveFiles"){for(var p=0;p<this.data.prompts.length;p++){var irow=document.createElement("div");irow.className="inputRow centered";var ilbl=document.createElement("div");ilbl.className="label";ilbl.innerHTML=popupData.prompts[p];irow.appendChild(ilbl);
var iTxt=document.createElement("input");iTxt.className="textbox";iTxt.id="inputBoxValue";iTxt.type="text";$(iTxt).focus(function(){_POPUPDIALOG.noPropagateEvents=false;var $this=$(this);$this.select();$this.mouseup(function(){$this.unbind("mouseup");return false})});$(iTxt).blur(function(){_POPUPDIALOG.noPropagateEvents=true});iTxt.setAttribute("tabindex",itemTabIndex);itemTabIndex++;if(popupData.values[p])iTxt.value=popupData.values[p];irow.appendChild(iTxt);mb.appendChild(irow)}this.onblockAction=
function(){$("#inputBoxValue").focus()}}this.domElement.appendChild(mb)};this.render=function(){var classes="popup";if(typeof this.data.dlgClass=="string")classes+=" "+this.data.dlgClass;this.hasIcon=!(typeof this.data.icon!="string"||this.data.icon=="none"||this.data.icon=="mtCustom");if(!this.hasIcon)classes+=" noIcon";if(typeof this.id=="undefined"||typeof this.id=="null"||this.id=="")this.id="alertDlg";var dialog=document.createElement("div");dialog.id=this.id;dialog.setAttribute("tabindex",0);
dialog.className=classes;this.domElement=dialog;var cancelButton=null;this.renderTitle();this.renderBody();var db=document.createElement("div");db.className="divbuttons";this.hasCloseBtn=false;for(b=0;b<this.data.buttons.length;b++){var but=document.createElement("input");but.type="button";if(typeof this.data.buttons[b].id!="undefined")but.id=this.data.buttons[b].id;if(this.data.buttons[b].value==2)this.hasCloseBtn=true;else if(this.data.buttons[b].value==3){this.hasCloseBtn=true;if(!but.id)but.id=
"popupCancelBtn";cancelButton=but}but.value=this.data.buttons[b].text;if(typeof this.data.buttons[b].value!="undefined")$(but).attr("value",this.data.buttons[b].value);else $(but).attr("value",this.data.buttons[b].text);but.className="popuplink";if(typeof this.data.buttons[b].dlgClass!="undefined")but.className+=" "+this.data.buttons[b].dlgClass;if(this.data.buttons[b].defaultButton===true)but.className+=" selected";if(typeof this.data.buttons[b].action=="undefined"){$(but).click(function(){_DIALOG.data.action($(this).attr("value"));
_DIALOG.unblock()});$(but).bind("touchStart",function(){_DIALOG.data.action($(this).attr("value"));_DIALOG.unblock()})}else{$(but).attr("idx",b);$(but).attr("abortClose",!!this.data.buttons[b].abortClose);$(but).attr("manualClose",!!this.data.buttons[b].manualClose);$(but).click(function(){_DIALOG.data.buttons[parseInt($(this).attr("idx"),10)].action($(this).attr("value"));if($(this).attr("abortClose")!="true")if($(this).attr("manualClose")!="true")_DIALOG.unblock()});$(but).bind("touchStart",function(){_DIALOG.data.buttons[parseInt($(this).attr("idx"),
10)].action($(this).attr("value"));if($(this).attr("abortClose")!="true")_DIALOG.unblock()})}db.appendChild(but)}if(this.hasCloseBtn){var closeBtn=document.createElement("span");closeBtn.innerHTML="&nbsp;";closeBtn.className="closeBtn";closeBtn.id="PopupTBBtnClose";$(closeBtn).click(function(){if(cancelButton!=null)cancelButton.click();else if(_DIALOG.data.action)_DIALOG.data.action(CLOSE_DIALOG);_DIALOG.unblock()});$(closeBtn).bind("touchStart",function(){if(_DIALOG.data.action)_DIALOG.data.action(CLOSE_DIALOG);
_DIALOG.unblock()});this.dialogTitle.appendChild(closeBtn)}db.appendChild(document.createElement("span"));dialog.appendChild(db);return this.domElement};this.createFieldset=function(title){var fs=document.createElement("fieldset");if(typeof title!="undefined"&&title!=""){var le=document.createElement("legend");le.innerHTML=title;fs.appendChild(le)}return fs};this.unblock=function(){unblockPopup();if(agentInfo.isMSIE&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="none";console.log("unblock popup")};
this.restoreEnvironment=function(){if(_DIALOG.customCursorRemoved||!$(_DIALOG.owner.vncdiv).hasClass("customCursor")){if(!TVNC.overrideCursor){$(_DIALOG.owner.vncdiv).css("cursor","none");$(_DIALOG.owner.vncdiv).css("cursor","")}if(navigator.userAgent.indexOf("Chrome")==-1)$(_DIALOG.owner.vncdiv).addClass("customCursor");else $(_DIALOG.owner.vncdiv).addClass("customCursor chrome")}try{if(ThinVNCTouchManager)ThinVNCTouchManager.enableGestures()}catch(error){}_DIALOG.owner.vncdiv.blur();_DIALOG.owner.vncdiv.focus()}}
(function(){function OpenLinkPopup(owner,popupData,parentObj){var _domElements={"containerDialog":null,"title":null,"link":null,"btnCancel":null,"btnClose":null,"msgError":null};var _drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};var _owner=owner;var _data=popupData;var _id=null;var _customCursorRemoved=null;var _isBlocked=false;function initialize(){if(typeof popupData=="undefined")return false;if(typeof owner=="undefined")return false;_id=_owner.rdParams.id;if(popupData.link!=undefined){if(popupData.link.url.indexOf("/__PlaybackServer__/")!=
-1){playbackController(popupData);return}var openWindow=window.open(popupData.link.url,"_blank");try{openWindow.focus();_isBlocked=false}catch(error){_isBlocked=true;initializePopup()}}else{helper.console.warning(sprintf(consts.emptyLink));return}}function playbackController(data){var iframe=document.getElementById("_ipbs_");var playback=null;var url=data.link.url;var index=url.indexOf("?");var vncId=document.getElementById(_owner.rdParams.divId);if(iframe==null){iframe=document.createElement("iframe");
iframe.name=iframe.id="_ipbs_";document.body.insertBefore(iframe,vncId);if(agentInfo.isMSIE==true&&agentInfo.msieVersion<11){var blockBck=document.createElement("div");blockBck.style.margin="0px";blockBck.style.left="0px";blockBck.style.top="0px";blockBck.style.position="absolute";blockBck.style.width="100%";blockBck.style.height="100%";blockBck.style.zIndex=50;blockBck.style.overflow="hidden";blockBck.style.backgroundColor="white";blockBck.style.opacity="0.0";document.body.insertBefore(blockBck,
iframe)}vncId.style.zIndex=100;iframe.className="playback_server";playback=iframe}else playback=iframe.getElementsByClassName("playback_server")[0];if(playback)playback.src=url;return}function initializePopup(){if(typeof parentObj=="string"){parentObj=document.getElementById(parentObj);if(!parentObj)return false}if(assignElements()){detachEvents();render();attachEvents();show()}}function assignElements(){_domElements.containerDialog=document.getElementById("openLinkDialog");if(_domElements.containerDialog==
null){if(typeof _owner.errorMsgPopup!="undefined")_owner.errorMsgPopup({"title":helper.dictionary.getValue("versionMismatch"),"message":"<h4>"+helper.dictionary.getValue("cannotFind")+" Open Link Dialog </h4><p>"+helper.dictionary.getValue("interfaceNotImplemented")+"</p>"});else alert(helper.dictionary.getValue("versionMismatch")+' "Open Link Dialog". '+helper.dictionary.getValue("interfaceNotImplemented"));return false}_domElements.title=document.getElementById("openLinkTitle");_domElements.link=
document.getElementById("openLinkUrl");_domElements.btnCancel=document.getElementById("openLinkBtnCancel");_domElements.msgError=document.getElementById("openLinkMsgError");_customCursorRemoved=$(_owner.vncdiv).hasClass("customCursor");_domElements.btnClose=document.getElementById("openLinkBtnClose");return true}function attachEvents(){if((agentInfo.isMSIE==true&&agentInfo.msieVersion>9||agentInfo.isMSIE==false)&&_data.draggable){_domElements.title.onmousedown=onStartDrag;if(agentInfo.isMobile)_domElements.title.ontouchstart=
onStartDrag}helper.dom.addEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.addEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,false);document.body.addEventListener("keydown",documentKeypress,false)}function detachEvents(){helper.dom.removeEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.removeEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,false);document.body.removeEventListener("keydown",documentKeypress,
false)}function show(){var popup=new PopupDialog;popup.owner=owner;popup.verticalMiddle=true;popup.block(_id,_domElements.containerDialog,parentObj,onBlockAction,restoreEnvironment);try{if(ThinVNCTouchManager)ThinVNCTouchManager.disableGestures()}catch(error){}}function render(){var hasIcon=false;if(_customCursorRemoved)$(_owner.vncdiv).removeClass("customCursor");var classes=" popup";if(typeof _data.dlgClass=="string")classes+=" "+_data.dlgClass;var plusClass="";hasIcon=!(typeof _data.icon!="string"||
_data.icon=="none"||_data.icon=="mtCustom");if(!hasIcon)classes+=plusClass=" noIcon";if(typeof _id=="undefined"||typeof _id=="null"||_id=="")_id="alertDlg";$(_domElements.containerDialog).addClass(plusClass);_domElements.containerDialog.setAttribute("tabindex",0);renderBody()}function renderBody(){var cancelButton=null;var dialog=_domElements.containerDialog;if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="auto";var itemTabIndex=0;_domElements.btnCancel.removeAttribute("disabled");
function assignElementLink(caption,url){var a=_domElements.link;a.className="link";a.innerHTML=caption;a.target="_blank";a.href=url;helper.dom.removeEvent(a,["touchend"],anchorTouchEnd,false);helper.dom.removeEvent(a,["click"],anchorClick,false);helper.dom.addEvent(a,["touchend"],anchorTouchEnd,false);helper.dom.addEvent(a,["click"],anchorClick,false);var pId="pBlockedErrorMsg";var pElem=document.getElementById(pId);if(_isBlocked)_domElements.msgError.innerHTML=helper.dictionary.getValue("popupBlockedMsg");
else _domElements.msgError.innerHTML="";return a}assignElementLink(typeof _data.link.caption!="undefined"&&_data.link.caption!=""?_data.link.caption:_data.link.url,_data.link.url)}function isImage(url){var aName=url.split(".");switch(aName[aName.length-1]){case "jpe":case "jpeg":case "jpg":case "png":case "bmp":case "tif":case "gif":return true;default:return false}}function unblock(){detachEvents();THIN.fileUpload.uploadAbort();THIN.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[3]);unblockPopup();
if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="none";$("#iFile").removeAttr("disabled");$(this).removeAttr("disabled")}function restoreEnvironment(){if(_customCursorRemoved||!$(_owner.vncdiv).hasClass("customCursor")){if(!TVNC.overrideCursor){$(_owner.vncdiv).css("cursor","none");$(_owner.vncdiv).css("cursor","")}if(navigator.userAgent.indexOf("Chrome")==-1)$(_owner.vncdiv).addClass("customCursor");else $(_owner.vncdiv).addClass("customCursor chrome")}try{if(ThinVNCTouchManager)ThinVNCTouchManager.enableGestures()}catch(error){}_owner.vncdiv.blur();
_owner.vncdiv.focus()}function onStartDrag(e){var d=_domElements.containerDialog;d.parentElement.onmousemove=onMouseMove;d.parentElement.onmouseup=onMouseUp;if(agentInfo.isMobile==true){d.parentElement.ontouchmove=onMouseMove;d.parentElement.ontouchend=onMouseUp}if(d.offsetLeft!=parseInt(d.style.left,10)){var l=d.offsetLeft;d.style.marginLeft=d.style.marginRight="0px";d.style.left=l+"px"}_drag={"active":true,"lastX":e.clientX||e.x||e.touches&&e.touches[0].clientX,"lastY":e.clientY||e.y||e.touches&&
e.touches[0].clientY,"lastCursor":$(_owner.vncdiv).css("cursor")};if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor","move");else helper.style.changeCSSRule("div.systemPopup .title","cursor","move")}function onMouseMove(e){if(_drag.active){var x=typeof e.clientX!="undefined"?e.clientX:typeof e.x!="undefined"?e.x:typeof e.touches!="undefined"?e.touches[0].clientX:0;var y=typeof e.clientY!="undefined"?e.clientY:typeof e.y!="undefined"?e.y:typeof e.touches!="undefined"?e.touches[0].clientY:0;_domElements.containerDialog.style.left=
_domElements.containerDialog.offsetLeft+(x-_drag.lastX)+"px";_domElements.containerDialog.style.top=_domElements.containerDialog.offsetTop+(y-_drag.lastY)+"px";_drag.lastX=x;_drag.lastY=y}}function onMouseUp(e){if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor",_drag.lastCursor);else helper.style.changeCSSRule("div.systemPopup .title","cursor","inherit");_drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};_domElements.containerDialog.parentElement.onmousemove=null;_domElements.containerDialog.parentElement.onmouseup=
null;if(agentInfo.isMobile){_domElements.containerDialog.parentElement.ontouchmove=null;_domElements.containerDialog.parentElement.ontouchend=null}}function documentKeypress(e){if(e.keyCode==27)unblock()}function onBlockAction(){_owner.dragDrop.start()}function btnCancelClick(e){unblock()}function btnCloseClick(e){if(_data.action)_data.action(CLOSE_DIALOG);unblock()}function anchorClick(e){unblock()}function anchorTouchEnd(e){if(e.preventDefault)e.preventDefault();this.dispatchEvent(new Event("click"))}
initialize();return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.OpenLinkPopup=OpenLinkPopup})();
(function(){function ServerMessagePopup(owner,popupData,parentObj){var _domElements={"containerDialog":null,"caption":null,"title":null,"btnCancel":null,"btnClose":null,"msgText":null};var _drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};var _owner=owner;var _data=popupData;var _id=null;var _customCursorRemoved=null;var _isBlocked=false;function initialize(){if(typeof popupData=="undefined")return false;if(typeof owner=="undefined")return false;_id=_owner.rdParams.id;if(typeof parentObj==
"string"){parentObj=document.getElementById(parentObj);if(!parentObj)return false}if(assignElements()){detachEvents();render();attachEvents();show()}}function assignElements(){_domElements.containerDialog=document.getElementById("serverMsgDialog");if(_domElements.containerDialog==null){if(typeof _owner.errorMsgPopup!="undefined")_owner.errorMsgPopup({"title":helper.dictionary.getValue("versionMismatch"),"message":"<h4>"+helper.dictionary.getValue("cannotFind")+" Server Message Dialog </h4><p>"+helper.dictionary.getValue("interfaceNotImplemented")+
"</p>"});else alert(helper.dictionary.getValue("versionMismatch")+' "Server Message Dialog". '+helper.dictionary.getValue("interfaceNotImplemented"));return false}_domElements.caption=document.getElementById("serverMsgCaption");_domElements.title=document.getElementById("serverMsgTitle");_domElements.btnCancel=document.getElementById("serverMsgBtnCancel");_domElements.msgText=document.getElementById("serverMsgText");_customCursorRemoved=$(_owner.vncdiv).hasClass("customCursor");_domElements.btnClose=
document.getElementById("serverMsgBtnClose");return true}function attachEvents(){if((agentInfo.isMSIE==true&&agentInfo.msieVersion>9||agentInfo.isMSIE==false)&&_data.draggable){_domElements.caption.onmousedown=onStartDrag;if(agentInfo.isMobile)_domElements.caption.ontouchstart=onStartDrag}helper.dom.addEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.addEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,false);document.body.addEventListener("keydown",
documentKeypress,false)}function detachEvents(){helper.dom.removeEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.removeEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,false);document.body.removeEventListener("keydown",documentKeypress,false)}function show(){var popup=new PopupDialog;popup.owner=owner;popup.verticalMiddle=true;popup.block(_id,_domElements.containerDialog,parentObj,onBlockAction,restoreEnvironment);try{if(ThinVNCTouchManager)ThinVNCTouchManager.disableGestures()}catch(error){}}
function render(){var hasIcon=false;if(_customCursorRemoved)$(_owner.vncdiv).removeClass("customCursor");var classes=" popup";if(typeof _data.dlgClass=="string")classes+=" "+_data.dlgClass;var plusClass="";hasIcon=!(typeof _data.icon!="string"||_data.icon=="none"||_data.icon=="mtCustom");if(!hasIcon)classes+=plusClass=" noIcon";if(typeof _id=="undefined"||typeof _id=="null"||_id=="")_id="alertDlg";$(_domElements.containerDialog).addClass(plusClass);_domElements.containerDialog.setAttribute("tabindex",
0);renderBody()}function renderBody(){var cancelButton=null;var dialog=_domElements.containerDialog;if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="auto";_domElements.btnCancel.removeAttribute("disabled");_domElements.title.innerHTML=typeof _data!="undefined"&&typeof _data.message!="undefined"&&typeof _data.message.title!="undefined"?_data.message.title:helper.dictionary.getValue("serverMsgDefault");_domElements.msgText.innerHTML=typeof _data!="undefined"&&
typeof _data.message!="undefined"&&typeof _data.message.text!="undefined"?_data.message.text:"";show()}function unblock(){detachEvents();unblockPopup();if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="none";$(this).removeAttr("disabled")}function restoreEnvironment(){if(_customCursorRemoved||!$(_owner.vncdiv).hasClass("customCursor")){if(!TVNC.overrideCursor){$(_owner.vncdiv).css("cursor","none");$(_owner.vncdiv).css("cursor","")}if(navigator.userAgent.indexOf("Chrome")==
-1)$(_owner.vncdiv).addClass("customCursor");else $(_owner.vncdiv).addClass("customCursor chrome")}try{if(ThinVNCTouchManager)ThinVNCTouchManager.enableGestures()}catch(error){}_owner.vncdiv.blur();_owner.vncdiv.focus()}function onStartDrag(e){var d=_domElements.containerDialog;d.parentElement.onmousemove=onMouseMove;d.parentElement.onmouseup=onMouseUp;if(agentInfo.isMobile==true){d.parentElement.ontouchmove=onMouseMove;d.parentElement.ontouchend=onMouseUp}if(d.offsetLeft!=parseInt(d.style.left,10)){var l=
d.offsetLeft;d.style.marginLeft=d.style.marginRight="0px";d.style.left=l+"px"}_drag={"active":true,"lastX":e.clientX||e.x||e.touches&&e.touches[0].clientX,"lastY":e.clientY||e.y||e.touches&&e.touches[0].clientY,"lastCursor":$(_owner.vncdiv).css("cursor")};if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor","move");else helper.style.changeCSSRule("div.systemPopup .title","cursor","move")}function onMouseMove(e){if(_drag.active){var x=typeof e.clientX!="undefined"?e.clientX:typeof e.x!="undefined"?
e.x:typeof e.touches!="undefined"?e.touches[0].clientX:0;var y=typeof e.clientY!="undefined"?e.clientY:typeof e.y!="undefined"?e.y:typeof e.touches!="undefined"?e.touches[0].clientY:0;_domElements.containerDialog.style.left=_domElements.containerDialog.offsetLeft+(x-_drag.lastX)+"px";_domElements.containerDialog.style.top=_domElements.containerDialog.offsetTop+(y-_drag.lastY)+"px";_drag.lastX=x;_drag.lastY=y}}function onMouseUp(e){if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor",_drag.lastCursor);
else helper.style.changeCSSRule("div.systemPopup .title","cursor","inherit");_drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};_domElements.containerDialog.parentElement.onmousemove=null;_domElements.containerDialog.parentElement.onmouseup=null;if(agentInfo.isMobile){_domElements.containerDialog.parentElement.ontouchmove=null;_domElements.containerDialog.parentElement.ontouchend=null}}function documentKeypress(e){if(e.keyCode==27)unblock()}function onBlockAction(){_owner.dragDrop.start()}
function btnCancelClick(e){unblock()}function btnCloseClick(e){if(_data.action)_data.action(CLOSE_DIALOG);unblock()}function anchorClick(e){unblock()}initialize();return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.ServerMessagePopup=ServerMessagePopup})();
(function(){function OpenFilePopup(owner,popupData,parentObj){var _domElements={"containerDialog":null,"title":null,"openLink":null,"btnCancel":null,"btnClose":null,"msgError":null};var _drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};var _owner=owner;var _data=popupData;var _id=_domElements.containerDialog;var _customCursorRemoved=null;var _isBlocked=false;var _filesQueue={};var _currentFile=null;var _usedIframes={};function initialize(){if(typeof popupData=="undefined")return false;
if(typeof owner=="undefined")return false;assignFile()}function assignFile(){if(popupData.idx==undefined){popupData.idx="idx_"+(new Date).getTime();_filesQueue[popupData.idx]=popupData}_currentFile=popupData;var mimetype=popupData.mimeType||"";var id=_owner.rcParams.id;var fileName=popupData.fileNames[0];var url="ft/"+encodeURIComponent(fileName);if(mimetype!=""){var downloadWindow=window.open(url+"?mimetype="+encodeURIComponent(mimetype)+"&id="+id,"_blank");try{downloadWindow.focus();_isBlocked=
false;removeCurrentFile()}catch(error){_isBlocked=true;initializePopup()}}else if(agentInfo.isIOS==true&&agentInfo.isTouch==true)initializePopup();else{var downloadIframe=helper.dom.appendJsonElement({"parentElement":document.body,"type":"iframe","attributes":{"id":"hiddenDownloader_"+(new Date).getTime(),"style":"zIndex: 0; position: absolute; visibility:hidden; top: 1px; left: -20px : width: 10px;"},"events":{"onload":function(e){_usedIframes[e.srcElement.id]=(new Date).getTime();setTimeout(function(){removeUsedIframes()},
5E3)}}});downloadIframe.src=url+"?id="+id;removeCurrentFile();continueWithFilesQueue()}}function removeUsedIframes(){var d=(new Date).getTime();for(var name in _usedIframes)if(d-_usedIframes[name]>2500){var elem=document.getElementById(name);if(elem)elem.parentElement.removeChild(elem);delete _usedIframes[name]}}function initializePopup(){if(typeof parentObj=="string"){parentObj=document.getElementById(parentObj);if(!parentObj)return false}if(assignElements()){detachEvents();render();attachEvents()}}
function assignElements(){_domElements.containerDialog=document.getElementById("openDialog");if(_domElements.containerDialog==null){if(typeof _owner.errorMsgPopup!="undefined")_owner.errorMsgPopup({"title":helper.dictionary.getValue("versionMismatch"),"message":"<h4>"+helper.dictionary.getValue("cannotFind")+" Open File Dialog </h4><p>"+helper.dictionary.getValue("interfaceNotImplemented")+"<p/>"});else alert(helper.dictionary.getValue("versionMismatch")+' "Open File Dialog". '+helper.dictionary.getValue("interfaceNotImplemented"));
return false}_domElements.title=document.getElementById("openTitle");_domElements.openLink=document.getElementById("openLink");_domElements.btnCancel=document.getElementById("openBtnCancel");_domElements.msgError=document.getElementById("openMsgError");_customCursorRemoved=$(_owner.vncdiv).hasClass("customCursor");_domElements.btnClose=document.getElementById("openBtnClose");return true}function attachEvents(){if((agentInfo.isMSIE==true&&agentInfo.msieVersion>9||agentInfo.isMSIE==false)&&_data.draggable){_domElements.title.onmousedown=
onStartDrag;if(agentInfo.isMobile)_domElements.title.ontouchstart=onStartDrag}helper.dom.addEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.addEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,false);document.body.addEventListener("keydown",documentKeypress,false)}function detachEvents(){helper.dom.removeEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.removeEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,
false);document.body.removeEventListener("keydown",documentKeypress,false)}function show(){var popup=new PopupDialog;popup.owner=owner;popup.verticalMiddle=true;popup.block(_id,_domElements.containerDialog,parentObj,onBlockAction,restoreEnvironment);try{if(ThinVNCTouchManager)ThinVNCTouchManager.disableGestures()}catch(error){}}function render(){var hasIcon=false;if(_customCursorRemoved)$(_owner.vncdiv).removeClass("customCursor");var classes=" popup";if(typeof _data.dlgClass=="string")classes+=" "+
_data.dlgClass;var plusClass="";hasIcon=!(typeof _data.icon!="string"||_data.icon=="none"||_data.icon=="mtCustom");if(!hasIcon)classes+=plusClass=" noIcon";if(typeof _id=="undefined"||typeof _id=="null"||_id=="")_id="alertDlg";$(_domElements.containerDialog).addClass(plusClass);_domElements.containerDialog.setAttribute("tabindex",0);renderBody()}function renderBody(){var cancelButton=null;var dialog=_domElements.containerDialog;if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor=
"auto";var itemTabIndex=0;_domElements.btnCancel.removeAttribute("disabled");var mimetype=_data.mimeType||"";var id=TVNC.rcParams.id;function assignElementLink(filename,mimeType,id,url){var a=_domElements.openLink;a.className="link";a.innerHTML=filename;a.target="_blank";a.href=url+"?mimetype="+encodeURIComponent(mimeType)+"&id="+id;helper.dom.removeEvent(a,["touchend"],fileNameTouchEnd,false);helper.dom.removeEvent(a,["click"],fileNameClick,false);helper.dom.addEvent(a,["touchend"],fileNameTouchEnd,
false);helper.dom.addEvent(a,["click"],fileNameClick,false);var pId="pBlockedErrorMsg";var pElem=document.getElementById(pId);if(_isBlocked)_domElements.msgError.innerHTML=helper.dictionary.getValue("popupBlockedMsg");else _domElements.msgError.innerHTML="";return a}if(_data.fileNames!=undefined&&_data.fileNames.length>0)for(var i=0;i<_data.fileNames.length;i++){var fileName=_data.fileNames[i];var url="ft/"+encodeURIComponent(fileName);if(mimetype!=""){assignElementLink(fileName,mimetype,id,url);
show()}else if(agentInfo.isIOS==true&&agentInfo.isTouch==true){assignElementLink(fileName,mimetype,id,url);show()}else{var downloadIframe=helper.dom.appendJsonElement({"parentElement":document.body,"type":"iframe","attributes":{"id":"hiddenDownloader_"+(new Date).getTime(),"style":"zIndex: 0; position: absolute; visibility:hidden; top: 1px; left: -20px : width: 10px;"},"events":{"onload":function(e){_usedIframes[e.srcElement.id]=(new Date).getTime();setTimeout(function(){removeUsedIframes()},5E3)}}});
downloadIframe.src=url+((url.indexOf("?")==-1?"?":"&")+"id="+id);removeCurrentFile();continueWithFilesQueue()}}}function unblock(){detachEvents();THIN.fileUpload.uploadAbort();THIN.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[3]);unblockPopup();if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="none";$("#iFile").removeAttr("disabled");$(this).removeAttr("disabled");removeCurrentFile();continueWithFilesQueue()}function restoreEnvironment(){if(_customCursorRemoved||
!$(_owner.vncdiv).hasClass("customCursor")){if(!TVNC.overrideCursor){$(_owner.vncdiv).css("cursor","none");$(_owner.vncdiv).css("cursor","")}if(navigator.userAgent.indexOf("Chrome")==-1)$(_owner.vncdiv).addClass("customCursor");else $(_owner.vncdiv).addClass("customCursor chrome")}try{if(ThinVNCTouchManager)ThinVNCTouchManager.enableGestures()}catch(error){}_owner.vncdiv.blur();_owner.vncdiv.focus()}function removeCurrentFile(){if(_currentFile!=null){_currentFile.idx;delete _filesQueue[_currentFile.idx];
_currentFile=null}}function continueWithFilesQueue(){if(_currentFile==null)for(var idx in _filesQueue){_data=popupData=_filesQueue[idx];assignFile();break}}function onStartDrag(e){var d=_domElements.containerDialog;d.parentElement.onmousemove=onMouseMove;d.parentElement.onmouseup=onMouseUp;if(agentInfo.isMobile==true){d.parentElement.ontouchmove=onMouseMove;d.parentElement.ontouchend=onMouseUp}if(d.offsetLeft!=parseInt(d.style.left,10)){var l=d.offsetLeft;d.style.marginLeft=d.style.marginRight="0px";
d.style.left=l+"px"}_drag={"active":true,"lastX":e.clientX||e.x||e.touches&&e.touches[0].clientX,"lastY":e.clientY||e.y||e.touches&&e.touches[0].clientY,"lastCursor":$(_owner.vncdiv).css("cursor")};if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor","move");else helper.style.changeCSSRule("div.systemPopup .title","cursor","move")}function onMouseMove(e){if(_drag.active){var x=typeof e.clientX!="undefined"?e.clientX:typeof e.x!="undefined"?e.x:typeof e.touches!="undefined"?e.touches[0].clientX:0;
var y=typeof e.clientY!="undefined"?e.clientY:typeof e.y!="undefined"?e.y:typeof e.touches!="undefined"?e.touches[0].clientY:0;_domElements.containerDialog.style.left=_domElements.containerDialog.offsetLeft+(x-_drag.lastX)+"px";_domElements.containerDialog.style.top=_domElements.containerDialog.offsetTop+(y-_drag.lastY)+"px";_drag.lastX=x;_drag.lastY=y}}function onMouseUp(e){if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor",_drag.lastCursor);else helper.style.changeCSSRule("div.systemPopup .title",
"cursor","inherit");_drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};_domElements.containerDialog.parentElement.onmousemove=null;_domElements.containerDialog.parentElement.onmouseup=null;if(agentInfo.isMobile){_domElements.containerDialog.parentElement.ontouchmove=null;_domElements.containerDialog.parentElement.ontouchend=null}}function documentKeypress(e){if(e.keyCode==27)unblock()}function onBlockAction(){_owner.dragDrop.start()}function btnCancelClick(e){unblock()}function btnCloseClick(e){if(_data.action)_data.action(CLOSE_DIALOG);
unblock()}function fileNameClick(e){unblock()}function fileNameTouchEnd(e){if(e.preventDefault)e.preventDefault();this.dispatchEvent(new Event("click"))}function addFile(data){if(data.idx==undefined){data.idx="idx_"+(new Date).getTime();_filesQueue[data.idx]=data}continueWithFilesQueue()}Object.defineProperty(this,"addFile",{"enumerable":true,"configurable":false,"value":addFile});initialize();return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.OpenFilePopup=OpenFilePopup})();
(function(){function UploadPopup(owner,popupData,parentObj){var _bError=false;var _domElements={"containerDialog":null,"title":null,"inputFileName":null,"cmbFileFilter":null,"progressContainer":null,"ProgressBar":null,"txtErrorMsg":null,"btnOk":null,"btnRetry":null,"btnCancel":null,"inputFile":null,"btnClose":null,"btnCloseOk":null,"btnAbort":null,"inputFileCompatibility":null};var _progressbarId="uploadProgressBar";var _isRender=false;var _drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};
var _owner=owner;var _data=popupData;var _id=_domElements.containerDialog;var _customCursorRemoved=null;var _dicMimeTypes=null;var _retryFiles=[];var _okFiles=[];var _isReady=true;var _ref=this;function initialize(){if(typeof owner=="undefined")return false;if(typeof popupData=="undefined")return false;if(typeof parentObj=="string"){parentObj=document.getElementById(parentObj);if(!parentObj)return false}if(assignElements()){THIN.fileUpload.progressContainerID=_progressbarId;detachEvents();render();
attachEvents();if(_data.silenceMode)addFilesDirectly(_data.files,_data.items,_data.ignoreFiles);show()}}function show(){_isReady=false;var popup=new PopupDialog;popup.owner=owner;popup.verticalMiddle=true;popup.block(_id,_domElements.containerDialog,parentObj,onBlockAction,restoreEnvironment);try{if(ThinVNCTouchManager)ThinVNCTouchManager.disableGestures()}catch(error){}}function addFilesDirectly(files,items,ignoreFiles){THIN.fileUpload.onFileAdd=function(file){if(isValidExtension(file.name))_domElements.inputFileName.value+=
(_domElements.inputFileName.value.length>0?"|":"")+file.name.replace(/C:\\fakepath\\/i,"");else clearFileUploadFiles();return};var filesToIgnore=new Array;if(typeof ignoreFiles=="string")filesToIgnore=ignoreFiles.split("|");if(files)for(var i=0;i<files.length;i++)if(filesToIgnore.indexOf(files[i].name)==-1)THIN.fileUpload.add(files[i]);if(items)for(var i=0;i<items.length;i++)if(filesToIgnore.indexOf(items[i].fullpath)==-1)THIN.fileUpload.add(items[i].file,items[i].fullpath);if(files||items)setTimeout(function(){btnOkClick()},
1E3);else btnCloseClick()}function assignElements(){_domElements.containerDialog=document.getElementById("uploadDialog");if(_domElements.containerDialog==null){if(typeof _owner.errorMsgPopup!="undefined")_owner.errorMsgPopup({"title":helper.dictionary.getValue("versionMismatch"),"message":"<h4>"+helper.dictionary.getValue("cannotFind")+" Upload Dialog </h4><p>"+helper.dictionary.getValue("interfaceNotImplemented")+"<p/>"});else alert(helper.dictionary.getValue("versionMismatch")+' "Upload Dialog". '+
helper.dictionary.getValue("interfaceNotImplemented"));return false}_domElements.title=document.getElementById("uploadTitle");_domElements.inputFileName=document.getElementById("uploadInputFileName");_domElements.cmbFileFilter=document.getElementById("uploadCmbFileFilter");_domElements.progressContainer=document.getElementById("uploadProgressContainer");_domElements.txtErrorMsg=document.getElementById("uploadTxtErrorMsg");_domElements.btnOk=document.getElementById("uploadBtnOk");_domElements.btnRetry=
document.getElementById("retryBtnOk");_domElements.btnCancel=document.getElementById("uploadBtnCancel");_customCursorRemoved=$(_owner.vncdiv).hasClass("customCursor");_domElements.inputFile=document.getElementById("inputFile");_domElements.btnClose=document.getElementById("uploadBtnClose");_domElements.btnCloseOk=document.getElementById("closeBtnOk");_domElements.btnAbort=document.getElementById("uploadBtnAbort");_domElements.progressContainer.innerHTML="";_domElements.progressContainer.style.border=
"0px";_domElements.progressContainer.style.paddingLeft="0px";_domElements.progressContainer.style.paddingRight="5px";_domElements.progressContainer.style.paddingTop="0px";var pb=_domElements.ProgressBar=document.createElement("div");pb.className="textField progressContainer";pb.style.width="100%";pb.style.visibility="hidden";pb.id=_progressbarId;_domElements.progressContainer.appendChild(pb);if(agentInfo.isMSIE==true&&agentInfo.msieVersion<10){_domElements.inputFileName.style.display="none";if(document.getElementById("ie9InputFileName")==
null){var inputfn=_domElements.inputFileCompatibility=document.createElement("input");inputfn.className="textField fileselector";inputfn.setAttribute("type","file");inputfn.setAttribute("id","ie9InputFileName");inputfn.setAttribute("name","ie9InputFileName");_domElements.inputFileName.parentElement.appendChild(inputfn)}else _domElements.inputFileCompatibility=document.getElementById("ie9InputFileName")}return true}function detachEvents(){helper.dom.removeEvent(_domElements.cmbFileFilter,"change",
cmbFilterChange,false);helper.dom.removeEvent(_domElements.cmbFileFilter,"touchend",cmbFilterTouchEnd,false);helper.dom.removeEvent(_domElements.inputFileName,["touchend","click"],inputFileNameClick,false);helper.dom.removeEvent(_domElements.btnOk,["touchend","click"],btnOkClick,false);helper.dom.removeEvent(_domElements.btnRetry,["touchend","click"],btnRetryClick,false);helper.dom.removeEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.removeEvent(_domElements.btnClose,
["touchend","click"],btnCloseClick,false);helper.dom.removeEvent(_domElements.btnCloseOk,["touchend","click"],btnCloseClick,false);helper.dom.removeEvent(_domElements.btnAbort,["touchend","click"],btnCloseClick,false);helper.dom.removeEvent(document.body,"keydown",documentKeypress,false);helper.dom.removeEvent(_domElements.inputFileName,"dragover",inputDragFilesOver,false);helper.dom.removeEvent(_domElements.inputFileName,"drop",inputDropFilesOver,false);if(agentInfo.isMSIE==true&&agentInfo.msieVersion<
10)helper.dom.removeEvent(_domElements.inputFileCompatibility,"change",inputFileNameCompatibilityChange)}function attachEvents(){if((agentInfo.isMSIE==true&&agentInfo.msieVersion>9||agentInfo.isMSIE==false)&&_data.draggable){_domElements.title.onmousedown=onStartDrag;if(agentInfo.isMobile)_domElements.title.ontouchstart=onStartDrag}helper.dom.addEvent(_domElements.cmbFileFilter,"change",cmbFilterChange,false);helper.dom.addEvent(_domElements.cmbFileFilter,"touchend",cmbFilterTouchEnd,false);helper.dom.addEvent(_domElements.inputFileName,
["touchend","click"],inputFileNameClick,false);helper.dom.addEvent(_domElements.btnOk,["touchend","click"],btnOkClick,false);helper.dom.addEvent(_domElements.btnRetry,["touchend","click"],btnRetryClick,false);helper.dom.addEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.addEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,false);helper.dom.addEvent(_domElements.btnCloseOk,["touchend","click"],btnCloseClick,false);helper.dom.addEvent(_domElements.btnAbort,
["touchend","click"],btnCloseClick,false);helper.dom.addEvent(document.body,"keydown",documentKeypress,false);helper.dom.addEvent(_domElements.inputFileName,"dragover",inputDragFilesOver,false);helper.dom.addEvent(_domElements.inputFileName,"drop",inputDropFilesOver,false);if(agentInfo.isMSIE==true&&agentInfo.msieVersion<10)helper.dom.addEvent(_domElements.inputFileCompatibility,"change",inputFileNameCompatibilityChange)}function getFileExtension(fileName){if(fileName!=undefined){var fn=fileName.toString();
fn=fileName.substring(fileName.lastIndexOf(".")!=-1?fileName.lastIndexOf("."):fileName.length).toLowerCase();return fn}else return""}function render(){var hasIcon=false;if(_customCursorRemoved)$(_owner.vncdiv).removeClass("customCursor");var classes=" popup";if(typeof _data.dlgClass=="string")classes+=" "+_data.dlgClass;var plusClass="";hasIcon=!(typeof _data.icon!="string"||_data.icon=="none"||_data.icon=="mtCustom");if(!hasIcon)classes+=plusClass=" noIcon";if(typeof _id=="undefined"||typeof _id==
"null"||_id=="")_id="alertDlg";$(_domElements.containerDialog).addClass(plusClass);_domElements.containerDialog.setAttribute("tabindex",0);renderBody()}function fillAvailablesMimeType(){_dicMimeTypes={};if(window.navigator.plugins!=undefined&&window.navigator.plugins.length>0)for(var i=0;i<window.navigator.plugins.length;i++)for(var j=0;j<window.navigator.plugins[i].length;j++){var suffixes=window.navigator.plugins[i][j].suffixes;var type=window.navigator.plugins[i][j].type;if(suffixes!=undefined&&
type!=undefined){suffixes=suffixes.split(",");for(var k=0;k<suffixes.length;k++)if(_dicMimeTypes[suffixes[k]]==undefined)_dicMimeTypes[suffixes[k]]=type;else _dicMimeTypes[suffixes[k]]+=","+type}}if(_dicMimeTypes["pdf"]==undefined)_dicMimeTypes["pdf"]="application/pdf";if(_dicMimeTypes["gif"]==undefined)_dicMimeTypes["gif"]="image/*";if(_dicMimeTypes["jpg"]==undefined)_dicMimeTypes["jpg"]="imaga/*";if(_dicMimeTypes["jpeg"]==undefined)_dicMimeTypes["jpeg"]="image/*";if(_dicMimeTypes["bmp"]==undefined)_dicMimeTypes["bmp"]=
"image/*";if(_dicMimeTypes["png"]==undefined)_dicMimeTypes["png"]="image/*";if(_dicMimeTypes["txt"]==undefined)_dicMimeTypes["txt"]="text/plain"}function getMimeTypes(suffixes){var retMime="";if(_dicMimeTypes!=null&&_dicMimeTypes[suffixes]!=undefined)retMime=_dicMimeTypes[suffixes];return retMime}function renderBody(){var cancelButton=null;var dialog=_domElements.containerDialog;if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="auto";var itemTabIndex=0;
var hasFilter=_data.filter&&_data.filter.length>0?true:false;_domElements.inputFileName.readOnly=true;_domElements.inputFileName.value="";if(agentInfo.isMSIE==true&&agentInfo.msieVersion<10){_domElements.inputFileCompatibility.value="";_domElements.inputFileCompatibility.style.width="298px"}if(agentInfo.isMSIE==true&&agentInfo.msieVersion<=10){_domElements.progressContainer.style.width="290px";_domElements.inputFileName.style.width="290px";_domElements.cmbFileFilter.style.width="298px";_domElements.txtErrorMsg.style.width=
"290px"}for(var i=_domElements.cmbFileFilter.childNodes.length-1;i>=0;i--)_domElements.cmbFileFilter.removeChild(_domElements.cmbFileFilter.childNodes[i]);if(agentInfo.isMac==true&&agentInfo.isSafari==true)fillAvailablesMimeType();if(hasFilter==true){_domElements.cmbFileFilter.parentElement.style.visibility="visible";var tempFilters=_data.filter.split("\r\n");for(var f=0;f<tempFilters.length;f++)if(tempFilters[f]!="")if(tempFilters[f].indexOf("=")==-1)helper.console.warning(WebFMXconsts.uploadDlgEmptyFileMask+
": "+tempFilters[f]);else{var ff=tempFilters[f].split("=");var exts=ff[1].replace(/;/g,",").toString().toLowerCase().split(",");var fileTypes="";for(var ext=0;ext<exts.length;ext++){if(fileTypes.length>0)fileTypes+=",";if(exts[ext].indexOf(".")==-1)fileTypes+=exts[ext];else if(agentInfo.isMac==true)if(exts[ext]=="*.*")fileTypes+=exts[ext];else if(agentInfo.isSafari==true){var fExt=exts[ext].substr(exts[ext].indexOf("."));var mTypes=getMimeTypes(fExt.substr(1));mTypes=mTypes!=""?mTypes:fExt;fileTypes+=
mTypes}else fileTypes+=exts[ext].substr(exts[ext].indexOf("."));else fileTypes+=exts[ext].substr(exts[ext].indexOf("."))}var opt=document.createElement("option");opt.innerHTML=ff[0];opt.value=fileTypes;_domElements.cmbFileFilter.appendChild(opt)}if(helper.object.existsPath(_data,"filterIndex")){_domElements.cmbFileFilter.selectedIndex=parseInt(_data.filterIndex,10)-1;if(_domElements.cmbFileFilter.selectedIndex==-1&&_domElements.cmbFileFilter.childNodes.length>0)_domElements.cmbFileFilter.selectedIndex=
_domElements.cmbFileFilter.childNodes.length-1}}else _domElements.cmbFileFilter.parentElement.style.visibility="hidden";if(_domElements.ProgressBar)_domElements.ProgressBar.style.visibility="hidden";if(_data.silenceMode){_domElements.btnOk.style.display="none";_domElements.btnCancel.style.display="none";_domElements.btnAbort.style.display="inline-block"}else{_domElements.btnOk.style.display="inline-block";_domElements.btnCancel.style.display="inline-block";_domElements.btnAbort.style.display="none"}_domElements.txtErrorMsg.innerHTML=
"";_domElements.btnOk.removeAttribute("disabled");_domElements.btnRetry.style.display="none";_domElements.btnCloseOk.style.display="none";_domElements.btnRetry.value=_domElements.btnRetry.getAttribute("data-label");_domElements.btnCancel.removeAttribute("disabled");_domElements.cmbFileFilter.removeAttribute("disabled")}function createFieldset(title){var fs=document.createElement("fieldset");if(typeof title!="undefined"&&title!=""){var le=document.createElement("legend");le.innerHTML=title;fs.appendChild(le)}return fs}
function unblock(){detachEvents();THIN.fileUpload.uploadAbort();THIN.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[3]);unblockPopup();if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="none";$("#iFile").removeAttr("disabled");$(this).removeAttr("disabled")}function restoreEnvironment(){if(_customCursorRemoved||!$(_owner.vncdiv).hasClass("customCursor")){if(!TVNC.overrideCursor){$(_owner.vncdiv).css("cursor","none");$(_owner.vncdiv).css("cursor",
"")}if(navigator.userAgent.indexOf("Chrome")==-1)$(_owner.vncdiv).addClass("customCursor");else $(_owner.vncdiv).addClass("customCursor chrome")}try{if(ThinVNCTouchManager)ThinVNCTouchManager.enableGestures()}catch(error){}_owner.vncdiv.blur();_owner.vncdiv.focus();_isReady=true}function clearFileUploadFiles(){_domElements.inputFileName.value="";if(typeof THIN!="undefined")if(THIN.fileUpload!=undefined)THIN.fileUpload.clear()}function documentKeypress(e){if(e.keyCode==27)unblock();else if(e.keyCode==
13)btnOkClick()}function checkFileType(fileName){var response=false;if(typeof fileName!="undefined"&&fileName!="")if(_data.filter==undefined||_data.filter.length==0)response=true;else{var lastIdx=fileName.lastIndexOf(".");var fileExt=fileName.substr(lastIdx!=-1?lastIdx+1:0,fileName.length);var filter=_domElements.cmbFileFilter.childNodes[_domElements.cmbFileFilter.selectedIndex].value;var name=fileName.replace("."+fileExt,"");if(name==""||name.match(/\b\\|\/|:|\*|\?|"|<|>|\|\b/)!=null)response=false;
else{var exts=filter.split(",");for(var i=0;i<exts.length;i++){if(exts[i][0]==".")exts[i]=exts[i].substring(1,exts[i].length);else if(exts[i][0]=="*"&&exts[i][1]==".")exts[i]=exts[i].substring(2,exts[i].length);exts[i]="\\b"+exts[i].replace(/\*/g,"(.*)").replace(/\?/g,"(.)")+"\\b";var res=fileExt.match(exts[i]);if(res){response=true;break}}}}return response}function onStartDrag(e){var d=_domElements.containerDialog;d.parentElement.onmousemove=onMouseMove;d.parentElement.onmouseup=onMouseUp;if(agentInfo.isMobile==
true){d.parentElement.ontouchmove=onMouseMove;d.parentElement.ontouchend=onMouseUp}if(d.offsetLeft!=parseInt(d.style.left,10)){var l=d.offsetLeft;d.style.marginLeft=d.style.marginRight="0px";d.style.left=l+"px"}_drag={"active":true,"lastX":e.clientX||e.x||e.touches&&e.touches[0].clientX,"lastY":e.clientY||e.y||e.touches&&e.touches[0].clientY,"lastCursor":$(_owner.vncdiv).css("cursor")};if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor","move");else helper.style.changeCSSRule("div.systemPopup .title",
"cursor","move")}function onMouseMove(e){if(_drag.active){var x=typeof e.clientX!="undefined"?e.clientX:typeof e.x!="undefined"?e.x:typeof e.touches!="undefined"?e.touches[0].clientX:0;var y=typeof e.clientY!="undefined"?e.clientY:typeof e.y!="undefined"?e.y:typeof e.touches!="undefined"?e.touches[0].clientY:0;_domElements.containerDialog.style.left=_domElements.containerDialog.offsetLeft+(x-_drag.lastX)+"px";_domElements.containerDialog.style.top=_domElements.containerDialog.offsetTop+(y-_drag.lastY)+
"px";_drag.lastX=x;_drag.lastY=y}}function onMouseUp(e){if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor",_drag.lastCursor);else helper.style.changeCSSRule("div.systemPopup .title","cursor","inherit");_drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};_domElements.containerDialog.parentElement.onmousemove=null;_domElements.containerDialog.parentElement.onmouseup=null;if(agentInfo.isMobile){_domElements.containerDialog.parentElement.ontouchmove=null;_domElements.containerDialog.parentElement.ontouchend=
null}}function cmbFilterChange(e){clearFileUploadFiles()}function cmbFilterTouchEnd(){_domElements.cmbFileFilter.focus()}function isValidExtension(filename){var response=false;if(agentInfo.isMobile)if(helper.object.existsPath(_data,"filter.length")&&_data.filter.length>0&&_domElements.cmbFileFilter.selectedIndex>-1){var selectedFilter=_domElements.cmbFileFilter.childNodes[_domElements.cmbFileFilter.selectedIndex].value.toLowerCase();var extension=filename.substr(filename.lastIndexOf(".")==-1?filename.length:
filename.lastIndexOf("."),filename.length).toLowerCase();response=selectedFilter=="*.*"||selectedFilter.indexOf(extension)!=-1}else response=true;else response=true;return response}function inputFileNameClick(e){if(_domElements.inputFile==null)_domElements.inputFile=document.getElementById("inputFile");if(_domElements.inputFile){if(_data.filter&&_data.filter.length>0&&_domElements.cmbFileFilter.selectedIndex>-1)_domElements.inputFile.setAttribute("accept",_domElements.cmbFileFilter.childNodes[_domElements.cmbFileFilter.selectedIndex].value);
if(_data.multiple==true)_domElements.inputFile.setAttribute("multiple","");else _domElements.inputFile.removeAttribute("multiple");clearFileUploadFiles();THIN.fileUpload.onFileAdd=function(file){if(isValidExtension(file.name))_domElements.inputFileName.value+=(_domElements.inputFileName.value.length>0?"|":"")+file.name.replace(/C:\\fakepath\\/i,"");else clearFileUploadFiles();return};_domElements.inputFile.click();_domElements.txtErrorMsg.innerHTML=""}else logError("inputFile element not found")}
function inputDragFilesOver(e){e.stopPropagation();e.preventDefault();e.dataTransfer.dropEffect="copy";clearFileUploadFiles()}function inputDropFilesOver(e){e.stopPropagation();e.preventDefault();var files=e.dataTransfer.files;THIN.fileUpload.onFileAdd=function(file){if(isValidExtension(file.name))_domElements.inputFileName.value+=(_domElements.inputFileName.value.length>0?"|":"")+file.name.replace(/C:\\fakepath\\/i,"");else clearFileUploadFiles();return};var firstFile=false;for(var i=0;i<files.length;i++)if(_data.multiple==
false&&firstFile==true);else if(checkFileType(files[i].name)==true){firstFile=true;THIN.fileUpload.add(files[i])}}function btnOkClick(e){if($(_ref).attr("disabled")=="disabled")return false;var fn=THIN.fileUpload.getFilenames().replace(/,/g,", ");var currentFilters=null;if(_domElements.cmbFileFilter&&_domElements.cmbFileFilter.childNodes&&_domElements.cmbFileFilter.childNodes.length>0){currentFilters=_domElements.cmbFileFilter.childNodes[_domElements.cmbFileFilter.selectedIndex].value;if(currentFilters.indexOf(".*")!=
-1)currentFilters=null}if(fn!=""){if(currentFilters!=null){var fileExt=getFileExtension(fn);if(currentFilters.toString().toLowerCase().indexOf(fileExt)!=-1);else{_domElements.txtErrorMsg.innerHTML=helper.dictionary.getValue("invalidFileType");return}}$("#iFile").attr("disabled","disabled");_retryFiles=[];THIN.fileUpload.onFileUploadComplete=function(filename,uploader){_domElements.btnCancel.style.display="none";if(!_data.silenceMode)_domElements.btnCloseOk.style.display="inline-block"};THIN.fileUpload.onFileUploadFinish=
function(uploader){THIN.dragDrop.stop();for(var i=0,len=uploader.uploadOk.length;i<len;i++)_okFiles.push(uploader.uploadOk[i].filename);if(uploader.uploadErrors.length==0){var filter="";if(_data.filter&&_data.filter.length>0)filter="&filterIndex="+(parseInt(_domElements.cmbFileFilter.selectedIndex,10)+1);var uploadedFiles=_okFiles.join("|");THIN.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[2]+"&value="+encodeURIComponent(uploadedFiles)+filter);detachEvents();unblockPopup()}else{for(var i=
0,len=uploader.uploadErrors.length;i<len;i++)_retryFiles.push(uploader.uploadErrors[i].filename);_domElements.btnOk.style.display="none";_domElements.btnRetry.value=_domElements.btnRetry.getAttribute("data-label")+" ("+uploader.uploadErrors.length+")";_domElements.btnRetry.style.display="inline-block";setBtnRetryEnabled(true)}$("#iFile").removeAttr("disabled");$(this).removeAttr("disabled")};_domElements.ProgressBar.style.visibility="visible";helper.dom.removeEvent(_domElements.btnOk,["touchend",
"click"],btnOkClick,false);helper.dom.removeEvent(_domElements.inputFileName,["touchend","click"],inputFileNameClick,false);_domElements.txtErrorMsg.innerHTML="";_domElements.cmbFileFilter.setAttribute("disabled","disabled");THIN.fileUpload.startUploading()}else{_domElements.btnOk.setAttribute("abortClose","true");_domElements.txtErrorMsg.innerHTML=helper.dictionary.getValue("noFileSelected");window.setTimeout(function(){_domElements.txtErrorMsg.innerHTML=""},5E3)}}function setBtnRetryEnabled(val){if(val)_domElements.btnRetry.removeAttribute("disabled");
else _domElements.btnRetry.setAttribute("disabled","disabled")}function btnRetryClick(e){setBtnRetryEnabled(false);_domElements.txtErrorMsg="";var retryf=_retryFiles.slice();_retryFiles=[];THIN.fileUpload.retryUpload(retryf)}function btnCancelClick(e){unblock()}function onBlockAction(){_owner.dragDrop.start();_domElements.inputFileName.focus()}function inputFileNameCompatibilityChange(e){var inputFileName=document.getElementById("ie9InputFileName");if(inputFileName){document.getElementById("inputFileName").value=
inputFileName.value=this.value.replace(/C:\\fakepath\\/i,"");document.getElementById("inputFileName").onchange()}else alert("inputFileName not defined")}function btnCloseClick(e){if(_data.action)_data.action(CLOSE_DIALOG);unblock()}initialize();if(_bError==false){Object.defineProperty(this,"createFieldset",{"enumerable":true,"configurable":false,"value":createFieldset});Object.defineProperty(this,"unblock",{"enumerable":true,"configurable":false,"value":unblock});Object.defineProperty(this,"isReady",
{"enumerable":true,"configurable":false,"get":function(){return _isReady}})}else return false}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.UploadPopup=UploadPopup})();
(function(){function SavePopup(owner,popupData,parentObj){var _bError=false;var _domElements={"containerDialog":null,"title":null,"inputFileName":null,"cmbFileFilter":null,"txtErrorMsg":null,"btnOk":null,"btnCancel":null,"btnClose":null};var _isRender=false;var _drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};var _owner=owner;var _data=popupData;var _id=_domElements.containerDialog;var _customCursorRemoved=null;var _filters=null;var _validExtensions=[];var _ref=this;function initialize(){if(typeof owner==
"undefined")return false;if(typeof popupData=="undefined")return false;if(typeof parentObj=="string"){parentObj=document.getElementById(parentObj);if(!parentObj)return false}if(_data.defaultExt)_data.defaultExt=helper.string.trim(_data.defaultExt);if(assignElements()){detachEvents();render();attachEvents();show()}}function show(){var popup=new PopupDialog;popup.owner=owner;popup.verticalMiddle=true;popup.block(_id,_domElements.containerDialog,parentObj,onBlockAction,restoreEnvironment);try{if(ThinVNCTouchManager)ThinVNCTouchManager.disableGestures()}catch(error){}}
function assignElements(){_domElements.containerDialog=document.getElementById("saveDialog");if(_domElements.containerDialog==null){if(typeof _owner.errorMsgPopup!="undefined")_owner.errorMsgPopup({"title":helper.dictionary.getValue("versionMismatch"),"message":"<h4>"+helper.dictionary.getValue("cannotFind")+" Save Dialog </h4><p>"+helper.dictionary.getValue("interfaceNotImplemented")+"<p/>"});else alert(helper.dictionary.getValue("versionMismatch")+' "Save Dialog". '+helper.dictionary.getValue("interfaceNotImplemented"));
return false}_domElements.title=document.getElementById("saveTitle");_domElements.inputFileName=document.getElementById("saveInputFileName");_domElements.cmbFileFilter=document.getElementById("saveCmbFileFilter");_domElements.txtErrorMsg=document.getElementById("saveTxtErrorMsg");_domElements.btnOk=document.getElementById("saveBtnOk");_domElements.btnCancel=document.getElementById("saveBtnCancel");_domElements.btnClose=document.getElementById("saveBtnClose");return true}function detachEvents(){_domElements.inputFileName.onclick=
null;helper.dom.removeEvent(_domElements.btnOk,["touchend","click"],btnOkClick,false);helper.dom.removeEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.removeEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,false);document.body.removeEventListener("keydown",documentKeypress,false);helper.dom.removeEvent(_domElements.cmbFileFilter,"change",cmbFileFilterChange,false);helper.dom.removeEvent(_domElements.cmbFileFilter,"touchend",cmbFileFilterTouchEnd,false)}
function attachEvents(){if((agentInfo.isMSIE==true&&agentInfo.msieVersion>9||agentInfo.isMSIE==false)&&_data.draggable){_domElements.title.onmousedown=onStartDrag;if(agentInfo.isMobile)_domElements.title.ontouchstart=onStartDrag}helper.dom.addEvent(_domElements.btnOk,["touchend","click"],btnOkClick,false);helper.dom.addEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.addEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,false);document.body.addEventListener("keydown",
documentKeypress,false);helper.dom.addEvent(_domElements.cmbFileFilter,"change",cmbFileFilterChange,false);helper.dom.addEvent(_domElements.cmbFileFilter,"touchend",cmbFileFilterTouchEnd,false)}function updateFilenameExtension(filename,extensions,defaultExtension){if(filename==="")return"*";else{var idx=filename.lastIndexOf(".");var fExt="";if(idx!==-1){fExt=_domElements.inputFileName.value.substr(idx,_domElements.inputFileName.value.length);if(extensions.indexOf("*"+fExt)===-1)filename=filename.replaceAll(fExt,
"");else return filename}else;var dExt=null;var b=true,l=extensions.length,eIdx=0;while(b&&eIdx<l){if(extensions[eIdx]!=="*.*"){b=false;dExt=extensions[eIdx]}eIdx++}if(b&&fExt!=="")return filename+fExt;else if(dExt)return filename+="."+dExt.replaceAll(/\*|\./g,"");else if(defaultExtension!=="")return filename+"."+defaultExtension.replaceAll(/\*|\./g,"");else return filename}}function cmbFileFilterChange(e){var elem=_domElements.cmbFileFilter;if(elem){var options=elem.getElementsByTagName("option");
if(options&&options.length>elem.selectedIndex&&elem.selectedIndex>-1){var defExt=options[elem.selectedIndex].defaultExt;if(defExt!==null){_domElements.inputFileName.value=updateFilenameExtension(_domElements.inputFileName.value,options[elem.selectedIndex].value.split(","),defExt);var idx=_domElements.inputFileName.value.lastIndexOf(".");if(idx===-1)idx=_domElements.inputFileName.value.length;_domElements.inputFileName.focus();_domElements.inputFileName.setSelectionRange(0,idx);idx=null}defExt=null}options=
null}elem=null}function cmbFileFilterTouchEnd(){_domElements.cmbFileFilter.focus()}function clearErrorMsg(){_domElements.txtErrorMsg.innerHTML=""}function render(){var hasIcon=false;if(_customCursorRemoved)$(_owner.vncdiv).removeClass("customCursor");var classes=" popup";if(typeof _data.dlgClass=="string")classes+=" "+_data.dlgClass;var plusClass="";hasIcon=!(typeof _data.icon!="string"||_data.icon=="none"||_data.icon=="mtCustom");if(!hasIcon)classes+=plusClass=" noIcon";if(typeof _id=="undefined"||
typeof _id=="null"||_id=="")_id="alertDlg";$(_domElements.containerDialog).addClass(plusClass);_domElements.containerDialog.setAttribute("tabindex",0);renderBody()}function renderBody(){_validExtensions=[];if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="auto";var hasFilters=_data.filter&&_data.filter.length>0;if(typeof _data.values!="undefined"&&_data.values.length>0)_domElements.inputFileName.value=_data.values[0];else _domElements.inputFileName.value=
"";if(agentInfo.isMSIE==true&&agentInfo.msieVersion<=10){_domElements.inputFileName.style.width="290px";_domElements.cmbFileFilter.style.width="298px";_domElements.txtErrorMsg.style.width="290px"}for(var i=_domElements.cmbFileFilter.childNodes.length-1;i>=0;i--)_domElements.cmbFileFilter.removeChild(_domElements.cmbFileFilter.childNodes[i]);if(hasFilters==true){_domElements.cmbFileFilter.parentElement.style.visibility="visible";if(_data.filter){var tempDefExt=_data.defaultExt!=null?_data.defaultExt.toString().toLowerCase().split("|"):
[];var tempFilters=_data.filter.split("\r\n");if(_filters==null)_filters=[];for(var f=0;f<tempFilters.length;f++)if(tempFilters[f]!="")if(tempFilters[f].indexOf("=")==-1)helper.console.warning(WebFMXconsts.saveDlgEmptyFileMask+": "+tempFilters[f]);else{var ff=tempFilters[f].split("=");var exts=ff[1].replace(/;/g,",").replace(/ /g,"");var extsExt=exts;var opt=document.createElement("option");var optExt=[];var extMatch=ff[0].match(/[(].*[)]/);opt.innerHTML=ff[0];if(exts&&exts!=""){optExt=exts.split(",");
var existsOpt=false;for(var iExts=0;iExts<optExt.length;iExts++)if(ff[0].indexOf(optExt[iExts])!==-1){existsOpt=true;break}if(!existsOpt&&extMatch==null)opt.innerHTML=ff[0]+" ("+exts+")"}if(typeof extsExt!="undefined")opt.value=extsExt.toString().toLowerCase();var defExt="";if(optExt.length>0){defExt=optExt[0];defExt=defExt.substr(defExt.lastIndexOf(".")!=-1?defExt.lastIndexOf(".")+1:0,defExt.length)}if(tempDefExt.length>0)if(exts!="*.*"){if(exts.indexOf(tempDefExt[0])!=-1)defExt=tempDefExt[0]}else{defExt=
tempDefExt[0];defExt.substr(defExt.lastIndexOf(".")!=-1?defExt.lastIndexOf(".")+1:0,defExt.length)}opt.defaultExt=defExt;_domElements.cmbFileFilter.appendChild(opt);_filters.push({"text":ff[0],"ext":defExt});for(iExt=0;iExt<optExt.length;iExt++)if(_validExtensions.indexOf(optExt[iExt])==-1)_validExtensions.push(optExt[iExt])}if(helper.object.existsPath(_data,"filterIndex")){var idx=parseInt(_data.filterIndex,10)-1;idx=Math.min(_domElements.cmbFileFilter.length-1,Math.max(idx,0));_domElements.cmbFileFilter.selectedIndex=
idx}}}else _domElements.cmbFileFilter.parentElement.style.visibility="hidden";if(_domElements.ProgressBar)_domElements.ProgressBar.style.visibility="hidden";_domElements.txtErrorMsg.innerHTML="";_domElements.btnOk.removeAttribute("disabled");_domElements.btnCancel.removeAttribute("disabled");_domElements.cmbFileFilter.removeAttribute("disabled");cmbFileFilterChange()}function createFieldset(title){var fs=document.createElement("fieldset");if(typeof title!="undefined"&&title!=""){var le=document.createElement("legend");
le.innerHTML=title;fs.appendChild(le)}return fs}function unblock(){unblockPopup();if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="none";$("#iFile").removeAttr("disabled");$(this).removeAttr("disabled");detachEvents()}function restoreEnvironment(){if(_customCursorRemoved||!$(_owner.vncdiv).hasClass("customCursor")){if(!TVNC.overrideCursor){$(_owner.vncdiv).css("cursor","none");$(_owner.vncdiv).css("cursor","")}if(navigator.userAgent.indexOf("Chrome")==
-1)$(_owner.vncdiv).addClass("customCursor");else $(_owner.vncdiv).addClass("customCursor chrome")}try{if(ThinVNCTouchManager)ThinVNCTouchManager.enableGestures()}catch(error){}_owner.vncdiv.blur();_owner.vncdiv.focus()}function onStartDrag(e){var d=_domElements.containerDialog;d.parentElement.onmousemove=onMouseMove;d.parentElement.onmouseup=onMouseUp;if(agentInfo.isMobile==true){d.parentElement.ontouchmove=onMouseMove;d.parentElement.ontouchend=onMouseUp}if(d.offsetLeft!=parseInt(d.style.left,10)){var l=
d.offsetLeft;d.style.marginLeft=d.style.marginRight="0px";d.style.left=l+"px"}_drag={"active":true,"lastX":e.clientX||e.x||e.touches&&e.touches[0].clientX,"lastY":e.clientY||e.y||e.touches&&e.touches[0].clientY,"lastCursor":$(_owner.vncdiv).css("cursor")};if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor","move");else helper.style.changeCSSRule("div.systemPopup .title","cursor","move")}function onMouseMove(e){if(_drag.active){var x=typeof e.clientX!="undefined"?e.clientX:typeof e.x!="undefined"?
e.x:typeof e.touches!="undefined"?e.touches[0].clientX:0;var y=typeof e.clientY!="undefined"?e.clientY:typeof e.y!="undefined"?e.y:typeof e.touches!="undefined"?e.touches[0].clientY:0;_domElements.containerDialog.style.left=_domElements.containerDialog.offsetLeft+(x-_drag.lastX)+"px";_domElements.containerDialog.style.top=_domElements.containerDialog.offsetTop+(y-_drag.lastY)+"px";_drag.lastX=x;_drag.lastY=y}}function onMouseUp(e){if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor",_drag.lastCursor);
else helper.style.changeCSSRule("div.systemPopup .title","cursor","inherit");_drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};_domElements.containerDialog.parentElement.onmousemove=null;_domElements.containerDialog.parentElement.onmouseup=null;if(agentInfo.isMobile){_domElements.containerDialog.parentElement.ontouchmove=null;_domElements.containerDialog.parentElement.ontouchend=null}}function btnOkClick(e){var cmb=_domElements.cmbFileFilter;var textElem=_domElements.inputFileName;var error=
null;if(textElem.value!==""){if(_data.defaultExt!==""){var fExt=textElem.value.lastIndexOf(".");var mExt=false;if(fExt!==-1){fExt=textElem.value.substr(fExt);if(fExt[0]===".")fExt=fExt.substr(1)}else if(cmb&&cmb.options[cmb.selectedIndex]){var extensions=cmb.options[cmb.selectedIndex].value;extensions=extensions.split(",");var selecExt=extensions.find(function(ext){return helper.string.trim(ext).replaceAll("*.","")===_data.defaultExt});if(!selecExt)selecExt=extensions[0].replaceAll("*.","");if(selecExt===
""||selecExt==="*")mExt=true;else textElem.value+="."+(selecExt==="*.*"?_data.defaultExt:selecExt).replaceAll("*.","")}if(mExt&&_data.defaultExt&&_data.defaultExt!=="*.*"){fExt=_data.defaultExt;textElem.value+="."+fExt}}var name=textElem.value.replace(fExt,"");if(name===""||name.match(/\b\\|\/|:|\*|\?|"|<|>|\|\b/)!==null)error={"code":"","message":WebFMXconsts.saveDlgInvalidFileName}}else error={"code":"","message":WebFMXconsts.saveDlgInvalidFileName};if(error!==null)document.getElementById("saveTxtErrorMsg").innerHTML=
error.message;else{var filter="";if(_data.filter&&_data.filter.length>0)filter="&filterIndex="+(parseInt(cmb.selectedIndex,10)+1);THIN.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[2]+"&value="+encodeURIComponent(textElem.value)+filter);_domElements.txtErrorMsg.innerHTML="";_domElements.inputFileName.value="";unblock()}}function btnCancelClick(e){THIN.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[3]+"&value="+encodeURIComponent(_data.values));unblock()}function onBlockAction(){_owner.dragDrop.start();
_domElements.inputFileName.focus()}function btnCloseClick(e){if(_data.action)_data.action(CLOSE_DIALOG);THIN.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[3]+"&value="+encodeURIComponent(_data.values));unblock()}function documentKeypress(e){if(e.keyCode===27){THIN.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[3]+"&value="+encodeURIComponent(_data.values));unblock()}else if(e.keyCode==13)btnOkClick();else if(e.srcElement===_domElements.inputFileName)clearErrorMsg()}initialize();if(_bError==
false){Object.defineProperty(this,"createFieldset",{"enumerable":true,"configurable":false,"value":createFieldset});Object.defineProperty(this,"unblock",{"enumerable":true,"configurable":false,"value":unblock})}else return false}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.SavePopup=SavePopup})();
(function(){function ErrorMessagePopup(owner,popupData,parentObj){var _domElements={"containerDialog":null,"caption":null,"title":null,"btnCancel":null,"btnClose":null,"msgText":null};var _drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};var _owner=owner;var _data=popupData;var _id=null;var _customCursorRemoved=null;var _isBlocked=false;function initialize(){if(typeof popupData=="undefined")return false;if(typeof owner=="undefined")return false;_id=_owner.rdParams.id;if(typeof parentObj==
"string"){parentObj=document.getElementById(parentObj);if(!parentObj){var msg=typeof _data.title!="undefined"?_data.title:"";msg+=typeof _data.message!="undefined"?_data.message:"";if(msg!="")alert(msg);return false}}assignElements();detachEvents();render();attachEvents();show()}function assignElements(){_domElements.containerDialog=document.getElementById("errorMsgDialog");if(_domElements.containerDialog==null){_domElements.containerDialog=document.createElement("div");_domElements.containerDialog.className=
"systemPopup systemDlg popup";_domElements.containerDialog.style.zIndex=0;_domElements.containerDialog.style.visibility="hidden";_domElements.containerDialog.style.display="none";_domElements.containerDialog.id="errorMsgDialog";_domElements.caption=document.createElement("div");_domElements.caption.className="title";_domElements.caption.id="errorMsgCaption";_domElements.containerDialog.appendChild(_domElements.caption);_domElements.title=document.createElement("span");_domElements.title.innerHTML=
"";_domElements.title.id="errorMsgTitle";_domElements.caption.appendChild(_domElements.title);_domElements.btnClose=document.createElement("div");_domElements.btnClose.className="closeBtn";_domElements.btnClose.id="errorMsgBtnClose";_domElements.caption.appendChild(_domElements.btnClose);var body=document.createElement("div");body.className="body";body.style.minHeight="100px";_domElements.containerDialog.appendChild(body);var inputContainer=document.createElement("div");inputContainer.className="inputContainer";
inputContainer.style.minHeight="50px";body.appendChild(inputContainer);var row=document.createElement("div");row.className="row";inputContainer.appendChild(row);_domElements.msgText=document.createElement("p");_domElements.msgText.id="errorMsgTextError";row.appendChild(_domElements.msgText);var buttonsContainer=document.createElement("div");buttonsContainer.className="buttonsContainer";body.appendChild(buttonsContainer);_domElements.btnCancel=document.createElement("input");_domElements.btnCancel.type=
"button";_domElements.btnCancel.id="errorMsgBtnCancel";_domElements.btnCancel.className="button";_domElements.btnCancel.value="Cancel";buttonsContainer.appendChild(_domElements.btnCancel);document.body.appendChild(_domElements.containerDialog)}else{_domElements.caption=document.getElementById("errorMsgCaption");_domElements.title=document.getElementById("errorMsgTitle");_domElements.btnCancel=document.getElementById("errorMsgBtnCancel");_domElements.msgText=document.getElementById("errorMsgTextError");
_customCursorRemoved=$(_owner.vncdiv).hasClass("customCursor");_domElements.btnClose=document.getElementById("errorMsgBtnClose")}}function attachEvents(){if((agentInfo.isMSIE==true&&agentInfo.msieVersion>9||agentInfo.isMSIE==false)&&_data.draggable){_domElements.caption.onmousedown=onStartDrag;if(agentInfo.isMobile)_domElements.caption.ontouchstart=onStartDrag}helper.dom.addEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.addEvent(_domElements.btnClose,["touchend",
"click"],btnCloseClick,false);document.body.addEventListener("keydown",documentKeypress,false)}function detachEvents(){helper.dom.removeEvent(_domElements.btnCancel,["touchend","click"],btnCancelClick,false);helper.dom.removeEvent(_domElements.btnClose,["touchend","click"],btnCloseClick,false);document.body.removeEventListener("keydown",documentKeypress,false)}function show(){var popup=new PopupDialog;popup.owner=owner;popup.verticalMiddle=true;popup.block(_id,_domElements.containerDialog,parentObj,
onBlockAction,restoreEnvironment);try{if(ThinVNCTouchManager)ThinVNCTouchManager.disableGestures()}catch(error){}}function render(){var hasIcon=false;if(_customCursorRemoved)$(_owner.vncdiv).removeClass("customCursor");var classes=" popup";if(typeof _data.dlgClass=="string")classes+=" "+_data.dlgClass;var plusClass="";hasIcon=!(typeof _data.icon!="string"||_data.icon=="none"||_data.icon=="mtCustom");if(!hasIcon)classes+=plusClass=" noIcon";if(typeof _id=="undefined"||typeof _id=="null"||_id=="")_id=
"alertDlg";$(_domElements.containerDialog).addClass(plusClass);_domElements.containerDialog.setAttribute("tabindex",0);renderBody()}function renderBody(){var cancelButton=null;var dialog=_domElements.containerDialog;if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="auto";_domElements.btnCancel.removeAttribute("disabled");_domElements.title.innerHTML=typeof _data.title!="undefined"?_data.title:"Error";_domElements.msgText.innerHTML=typeof _data.message!=
"undefined"?_data.message:helper.dictionary.getValue("unknownError")}function unblock(){detachEvents();THIN.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[3]);unblockPopup();if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="none";$(this).removeAttr("disabled")}function restoreEnvironment(){if(_customCursorRemoved||!$(_owner.vncdiv).hasClass("customCursor")){if(!TVNC.overrideCursor){$(_owner.vncdiv).css("cursor","none");$(_owner.vncdiv).css("cursor",
"")}if(navigator.userAgent.indexOf("Chrome")==-1)$(_owner.vncdiv).addClass("customCursor");else $(_owner.vncdiv).addClass("customCursor chrome")}try{if(ThinVNCTouchManager)ThinVNCTouchManager.enableGestures()}catch(error){}if(typeof _owner.vncdiv!="undefined"){_owner.vncdiv.blur();_owner.vncdiv.focus()}}function onStartDrag(e){var d=_domElements.containerDialog;d.parentElement.onmousemove=onMouseMove;d.parentElement.onmouseup=onMouseUp;if(agentInfo.isMobile==true){d.parentElement.ontouchmove=onMouseMove;
d.parentElement.ontouchend=onMouseUp}if(d.offsetLeft!=parseInt(d.style.left,10)){var l=d.offsetLeft;d.style.marginLeft=d.style.marginRight="0px";d.style.left=l+"px"}_drag={"active":true,"lastX":e.clientX||e.x||e.touches&&e.touches[0].clientX,"lastY":e.clientY||e.y||e.touches&&e.touches[0].clientY,"lastCursor":$(_owner.vncdiv).css("cursor")};if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor","move");else helper.style.changeCSSRule("div.systemPopup .title","cursor","move")}function onMouseMove(e){if(_drag.active){var x=
typeof e.clientX!="undefined"?e.clientX:typeof e.x!="undefined"?e.x:typeof e.touches!="undefined"?e.touches[0].clientX:0;var y=typeof e.clientY!="undefined"?e.clientY:typeof e.y!="undefined"?e.y:typeof e.touches!="undefined"?e.touches[0].clientY:0;_domElements.containerDialog.style.left=_domElements.containerDialog.offsetLeft+(x-_drag.lastX)+"px";_domElements.containerDialog.style.top=_domElements.containerDialog.offsetTop+(y-_drag.lastY)+"px";_drag.lastX=x;_drag.lastY=y}}function onMouseUp(e){if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor",
_drag.lastCursor);else helper.style.changeCSSRule("div.systemPopup .title","cursor","inherit");_drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};_domElements.containerDialog.parentElement.onmousemove=null;_domElements.containerDialog.parentElement.onmouseup=null;if(agentInfo.isMobile){_domElements.containerDialog.parentElement.ontouchmove=null;_domElements.containerDialog.parentElement.ontouchend=null}}function documentKeypress(e){if(e.keyCode==27)unblock()}function onBlockAction(){if(typeof _owner.dragDrop!=
"undefined"&&typeof _owner.dragDrop.start!="undefined")_owner.dragDrop.start()}function btnCancelClick(e){unblock()}function btnCloseClick(e){if(_data.action)_data.action(CLOSE_DIALOG);unblock()}function anchorClick(e){unblock()}initialize();return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.ErrorMessagePopup=ErrorMessagePopup})();
(function(){function ErrorReportPopup(owner,popupData,parentObj){var _bError=false;var _domElements={"containerDialog":null,"title":null,"inputDescription":null,"inputSubject":null,"inputDetails":null,"btnSend":null,"btnCancel":null,"btnClose":null};var _isRender=false;var _drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};var _owner=owner;var _data=popupData;var _id=_domElements.containerDialog;var _customCursorRemoved=null;var _ref=this;function initialize(){if(typeof owner=="undefined")return false;
if(typeof popupData=="undefined")return false;if(typeof parentObj=="string"){parentObj=document.getElementById(parentObj);if(!parentObj)return false}assignElements();detachEvents();render();attachEvents();show()}function show(){var popup=new PopupDialog;popup.owner=owner;popup.verticalMiddle=true;popup.block(_id,_domElements.containerDialog,parentObj,onBlockAction,restoreEnvironment);try{if(ThinVNCTouchManager)ThinVNCTouchManager.disableGestures()}catch(error){}}function assignElements(){_domElements.containerDialog=
document.getElementById("errorReportDialog");_domElements.containerDialog.style.width="600px";_domElements.title=document.getElementById("errorReportTitle");_domElements.inputDescription=document.getElementById("errorReportDescription");_domElements.inputSubject=document.getElementById("errorReportSubject");_domElements.inputDetails=document.getElementById("errorReportDetails");_domElements.btnSend=document.getElementById("errorReportBtnSend");_domElements.btnCancel=document.getElementById("errorReportBtnCancel");
_domElements.btnClose=document.getElementById("errorReportBtnClose")}function detachEvents(){_domElements.inputDescription.onclick=null;_domElements.inputSubject.onclick=null;_domElements.btnSend.onclick=null;$(_domElements.btnSend).unbind("touchStart",btnOkTouchStart);_domElements.btnCancel.onclick=null;$(_domElements.btnCancel).unbind("touchStart",btnCancelTouchStart);_domElements.btnClose.onclick=null;$(_domElements.btnClose).unbind("touchStart",btnCloseClick)}function attachEvents(){if((agentInfo.isMSIE==
true&&agentInfo.msieVersion>9||agentInfo.isMSIE==false)&&_data.draggable){_domElements.title.onmousedown=onStartDrag;if(agentInfo.isMobile)_domElements.title.ontouchstart=onStartDrag}if(_domElements.inputDetails){var detailMouseOut=false;var mouseLeaveTimeOut=null;_domElements.inputDetails.onmouseenter=function(e){clearTimeout(mouseLeaveTimeOut)};_domElements.inputDetails.onmouseout=function(e){detailMouseOut=true;clearTimeout(mouseLeaveTimeOut);if(_domElements.inputDetails==document.activeElement)return;
mouseLeaveTimeOut=setTimeout(function(){$(_domElements.inputDetails).removeClass("expand")},1E3)};_domElements.inputDetails.onblur=function(e){detailMouseOut=true;clearTimeout(mouseLeaveTimeOut);mouseLeaveTimeOut=setTimeout(function(){$(_domElements.inputDetails).removeClass("expand")},1E3)};if(agentInfo.isMobile==false)_domElements.inputDetails.onclick=function(){if(_domElements.inputDetails.className.indexOf("expand")==-1)$(_domElements.inputDetails).addClass("expand")}}_domElements.btnSend.onclick=
btnSendClick;$(_domElements.btnSend).bind("touchStart",btnOkTouchStart);_domElements.btnCancel.onclick=btnCancelClick;$(_domElements.btnCancel).bind("touchStart",btnCancelTouchStart);_domElements.btnClose.onclick=btnCloseClick;$(_domElements.btnClose).bind("touchStart",btnCloseClick);document.body.addEventListener("keydown",documentKeypress,false)}function render(){var hasIcon=false;if(_customCursorRemoved)$(_owner.vncdiv).removeClass("customCursor");var classes=" popup";if(typeof _data.dlgClass==
"string")classes+=" "+_data.dlgClass;var plusClass="";hasIcon=!(typeof _data.icon!="string"||_data.icon=="none"||_data.icon=="mtCustom");if(!hasIcon)classes+=plusClass=" noIcon";if(typeof _id=="undefined"||typeof _id=="null"||_id=="")_id="alertDlg";$(_domElements.containerDialog).addClass(plusClass);_domElements.containerDialog.setAttribute("tabindex",0);renderBody()}function renderBody(){var cancelButton=null;var dialog=_domElements.containerDialog;if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&
!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="auto";var itemTabIndex=0;_domElements.inputDescription.value="";_domElements.inputSubject.value="";_domElements.inputDetails.value="";_domElements.inputDetails.setAttribute("readOnly","true");if(agentInfo.isMSIE==true&&agentInfo.msieVersion<=10){_domElements.inputDescription.style.width="290px";_domElements.inputSubject.style.width="290px"}_domElements.btnSend.removeAttribute("disabled");_domElements.btnCancel.removeAttribute("disabled")}function unblock(){unblockPopup();
if(agentInfo.isMSIE&&typeof TVNC!="undefined"&&!TVNC.overrideCursor)TVNC.vncdiv.style.cursor="none";$(this).removeAttr("disabled");detachEvents()}function restoreEnvironment(){if(_customCursorRemoved||!$(_owner.vncdiv).hasClass("customCursor")){if(!TVNC.overrideCursor){$(_owner.vncdiv).css("cursor","none");$(_owner.vncdiv).css("cursor","")}if(navigator.userAgent.indexOf("Chrome")==-1)$(_owner.vncdiv).addClass("customCursor");else $(_owner.vncdiv).addClass("customCursor chrome")}try{if(ThinVNCTouchManager)ThinVNCTouchManager.enableGestures()}catch(error){}_owner.vncdiv.blur();
_owner.vncdiv.focus()}function setDetails(obj){if(obj!=null&&obj!=undefined)if(obj.log!=undefined)if(obj.object!=undefined){_domElements.inputDetails.logObject=obj.object;_domElements.inputDetails.value=JSON.stringify(obj.object)}else{_domElements.inputDetails.value=obj.log;_domElements.inputDetails.logObject=_domElements.inputDetails.value}}function getDetails(obj){return _domElements.inputDetails.logObject}function onStartDrag(e){var d=_domElements.containerDialog;d.parentElement.onmousemove=onMouseMove;
d.parentElement.onmouseup=onMouseUp;if(agentInfo.isMobile==true){d.parentElement.ontouchmove=onMouseMove;d.parentElement.ontouchend=onMouseUp}if(d.offsetLeft!=parseInt(d.style.left,10)){var l=d.offsetLeft;d.style.marginLeft=d.style.marginRight="0px";d.style.left=l+"px"}_drag={"active":true,"lastX":e.clientX||e.x||e.touches&&e.touches[0].clientX,"lastY":e.clientY||e.y||e.touches&&e.touches[0].clientY,"lastCursor":$(_owner.vncdiv).css("cursor")};if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor",
"move");else helper.style.changeCSSRule("div.systemPopup .title","cursor","move")}function onMouseMove(e){if(_drag.active){var x=typeof e.clientX!="undefined"?e.clientX:typeof e.x!="undefined"?e.x:typeof e.touches!="undefined"?e.touches[0].clientX:0;var y=typeof e.clientY!="undefined"?e.clientY:typeof e.y!="undefined"?e.y:typeof e.touches!="undefined"?e.touches[0].clientY:0;_domElements.containerDialog.style.left=_domElements.containerDialog.offsetLeft+(x-_drag.lastX)+"px";_domElements.containerDialog.style.top=
_domElements.containerDialog.offsetTop+(y-_drag.lastY)+"px";_drag.lastX=x;_drag.lastY=y}}function onMouseUp(e){if(!TVNC.overrideCursor)$(_owner.vncdiv).css("cursor",_drag.lastCursor);else helper.style.changeCSSRule("div.systemPopup .title","cursor","inherit");_drag={"active":false,"lastX":-1,"lastY":-1,"lastCursor":null};_domElements.containerDialog.parentElement.onmousemove=null;_domElements.containerDialog.parentElement.onmouseup=null;if(agentInfo.isMobile){_domElements.containerDialog.parentElement.ontouchmove=
null;_domElements.containerDialog.parentElement.ontouchend=null}}function btnSendClick(e){if(_data!=undefined&&_data!=null&&_data.send!=undefined)try{_data.send(JSON.stringify({"description":_domElements.inputDescription!=null?_domElements.inputDescription.value:"","message":_domElements.inputSubject!=null?_domElements.inputSubject.value:"","detail":_domElements.inputDetails!=null?_domElements.inputDetails.logObject:""}))}catch(error){}unblock()}function btnOkTouchStart(e){unblock()}function btnCancelClick(e){unblock()}
function btnCancelTouchStart(e){unblock()}function onBlockAction(){if(!agentInfo.isMobile)_domElements.inputDescription.focus()}function btnCloseClick(e){if(_data.action)_data.action(CLOSE_DIALOG);unblock()}function documentKeypress(e){if(e.keyCode==27)unblock()}initialize();if(_bError==false){Object.defineProperty(this,"unblock",{"enumerable":true,"configurable":false,"value":unblock});Object.defineProperty(this,"description",{"enumerable":true,"configurable":false,"get":function(){return _domElements.inputDescription.value},
"set":function(msg){_domElements.inputDescription.value=msg}});Object.defineProperty(this,"subject",{"enumerable":true,"configurable":false,"get":function(){return _domElements.inputSubject.value},"set":function(msg){_domElements.inputSubject.value=msg}});Object.defineProperty(this,"details",{"enumerable":true,"configurable":false,"get":function(){return getDetails()},"set":function(obj){setDetails(obj)}})}else return false}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.ErrorReportPopup=
ErrorReportPopup})();
(function(){function Macro(){var _args={"owner":null,"events":{},"params":{"start":false,"playback":{"enabled":false,"autorun":-1,"files":[]},"record":{"enabled":false}}};var _macro={"isPlaying":false,"isRecording":false,"isPaused":false,"isStop":false,"paused":false,"cancel":false,"waitTime":250,"maxWaitTime":1E4,"currentTime":null,"idx":0,"currentFile":"","cmds":null,"timeoutId":null,"hookMouse":false,"cmd":null,"params":{},"relativeWindow":false,"lastMsg":"","spellSpeed":250};var _fromPopulateTask=
{"isRunning":false,"activeTask":"","resolve":null,"reject":null};var _newPlayback={"enable":false,"promise":null,"promises":[],"resolve":null,"reject":null,"testOfCase":{},"tasks":{},"activeTaskName":"","taskIdx":0,"populateTask":true,"populatedTask":[]};var _asPromises=false;var _enumPlaybackState={"error":-1,"pending":0,"running":1,"done":2};var _defTime=100;var _defButton=0;var _enumBorderAction={"BORDER_ACTION_CLOSE":0,"BORDER_ACTION_MINIMIZE":1,"BORDER_ACTION_MAXIMIZE":2,"BORDER_ACTION_HELP":3,
"BORDER_ACTION_RESTORE":4};var _enumWndAction={"close":_enumBorderAction.BORDER_ACTION_CLOSE,"minimize":_enumBorderAction.BORDER_ACTION_MINIMIZE,"maximize":_enumBorderAction.BORDER_ACTION_MAXIMIZE};var _selectedWindow={"elem":null,"caption":null,"title":null,"class":null,"wndClass":null,"hwnd":null};var _buttons={"stop":null,"play":null,"record":null};var _task={};var _ref=this;function initialize(args){helper.object.parseAttributes(_args,args,"MATCH");if(!_args.owner){helper.console.log(helper.string.format("Cannot initialize Macro, because owner is not defined",
""),arguments);return}if(helper.url.gup("macro")!="")try{_macro.params=JSON.parse(decodeURIComponent(helper.url.gup("macro")))}catch(e){helper.console.error(e.message,e,arguments)}if(_args.owner.dockMenu&&_args.owner.dockMenu.addIcon){if(_args.params.playback.enabled){_args.owner.dockMenu.addIcon("stop_macro",stopHandler,"Stop Macro","right macro stop");_args.owner.dockMenu.addIcon("play_macro",playHandler,"Play Macro","right macro play");if(document.getElementsByClassName("play_macro").length>0)_buttons.play=
document.getElementsByClassName("play_macro")[0];if(document.getElementsByClassName("stop_macro").length>0)_buttons.stop=document.getElementsByClassName("stop_macro")[0];if(document.getElementsByClassName("record_macro").length>0)_buttons.record=document.getElementsByClassName("record_macro")[0];var playback=_args.params.playback;if(_macro.params.start||playback.autorun>-1&&helper.object.existsPath(playback,"files.length")&&playback.files.length>playback.autorun)if(_buttons.play)setTimeout(function(){_buttons.play.click()},
500)}if(_args.params.record.enabled)_args.owner.dockMenu.addIcon("record_macro",recordHandler,"Record Macro","right macro record");toggleClassNameToMacroButton("stop","disabled","Stop")}}function playHandler(){var playback=_args.params.playback;if(_buttons.play&&_buttons.play.className.indexOf("disabled")!=-1)return;if(_macro.isRecording){toggleClassNameToMacroButton("record","disabled","Record");helper.console.log(helper.string.format("Cannot start playing while macro is recording. Please stop recording first."),
arguments);return}if(!helper.object.existsPath(playback,"files.length")||playback.files.length<1){var renderMsg=helper.string.format("The playlist is empty, please record a macro.");helper.console.log(renderMsg,arguments);var r=fireEvent("failure",renderMsg);if(!r)alertPopup("<p>"+renderMsg+"</p>","none","","","","",false);return}toggleClassNameToMacroButton("play","pause","Playing");toggleClassNameToMacroButton("stop","enabled","Stop playing");toggleClassNameToMacroButton("record","disabled","Record");
if(!_macro.isPlaying||_macro.isPlaying&&_macro.isPaused){disableMouse(true);if(_macro.isPaused&&_macro.cmds){_macro.stop=false;_macro.currentTime=null;toggleClassNameToMacroButton("play","paused","Continue playing "+_macro.currentFile);playMacro(_macro.cmds)}else{_macro.stop=false;if(helper.object.existsPath(playback,"files.length")&&_macro.currentFile!=playback.files[0].name){_macro.currentFile=playback.files[0].name;_macro.idx=0;if(_macro.params.url)playback.files[0].url=decodeURIComponent(_macro.params.url);
openFile(playback.files[0].url);toggleClassNameToMacroButton("play","paused","Playing "+playback.files[0].name)}}_macro.isPaused=false;_macro.isPlaying=true}else if(_macro.isPlaying&&!_macro.isPaused){_macro.isPlaying=true;_macro.isPaused=true;clearTimeout(_macro.timeoutId);_macro.stop=true;disableMouse(false);toggleClassNameToMacroButton("play","enabled","Paused")}}function clear(){_macro.cmds=[];_macro.currentFile="";_newPlayback.activeTaskName=null;_newPlayback.enable=false;_newPlayback.promises=
[];_newPlayback.testOfCase={}}function reset(){_macro.stop=false;_macro.paused=false;for(var toc in _newPlayback.testOfCase)if(_newPlayback.testOfCase[toc].promises){_newPlayback.testOfCase[toc].state=_enumPlaybackState.pending;_newPlayback.testOfCase[toc].promisesIdx=0;for(var i=0;i<_newPlayback.testOfCase[toc].promises.length;i++){_newPlayback.testOfCase[toc].promises[i].state=_enumPlaybackState.pending;delete _newPlayback.testOfCase[toc].promises[i].p}}}function stopHandler(){if(_buttons.stop&&
_buttons.stop.className.indexOf("disabled")!=-1)return;_macro.idx=0;_macro.isPaused=false;_macro.currentTime=null;toggleClassNameToMacroButton("record","enabled","Record");toggleClassNameToMacroButton("play","enabled","Record");toggleClassNameToMacroButton("stop","disabled","Stop");if(_macro.isRecording){_macro.isRecording=false;sendMacroAction("reset")}else if(_macro.isPlaying){clearTimeout(_macro.timeoutId);_macro.stop=true;_macro.currentFile=null;_macro.isPlaying=false;disableMouse(false)}}function recordHandler(){var record=
_args.params.record;if(_buttons.record&&_buttons.record.className.indexOf("disabled")!=-1)return;if(_macro.isPlaying){toggleClassNameToMacroButton("record","disabled","Record");helper.console.warning(helper.string.format("Cannot start recording while macro is still playing. Please stop playing first."),arguments);return}toggleClassNameToMacroButton("play","disabled","Play");toggleClassNameToMacroButton("stop","enabled","Stop recording");if(!_macro.isRecording||_macro.isRecording&&_macro.isPaused){_macro.isPaused=
false;_macro.isRecording=true;toggleClassNameToMacroButton("record","paused","Recording");disableMouse(false);sendMacroAction("record")}else if(_macro.isRecording&&!_macro.isPaused){_macro.isRecording=true;_macro.isPaused=true;toggleClassNameToMacroButton("record","enabled","Paused");sendMacroAction("pause")}}function openFile(fileUrl){var onFailure=function(msg){_macro.currentFile=null;_macro.idx=0;var r=fireEvent("failure",msg);if(!r){if(_buttons.stop)_buttons.stop.click();helper.console.warning(msg,
arguments);alertPopup("<p>"+msg+"</p>","none","","","","",false)}return};var url=_args.owner.getAjaxUrl();if(url.lastIndexOf("/")!=url.length-1)url+="/";url+=fileUrl;var params={url:_args.owner.getCrossDomainUrl(url),dataType:_args.owner.getCrossDomainDataType(),async:true,cache:false,timeout:5E3,error:function(jqXHR,err){onFailure(helper.string.format("Error loading file: {0} - status: {1} - message: {2}",_macro.currentFile,jqXHR.status,err))},success:function(file){try{var replace=file.replace(/\r?\n|\r/g,
",");_macro.cmds=JSON.parse("["+replace.substr(0,replace.length-1)+"]");if(_macro.cmds.length>0){_macro.isPlaying=false;playMacro(_macro.cmds)}}catch(error){onFailure(helper.string.format("Error processing file: {0}, please verify your file.",_macro.currentFile));return}}};$.ajax(_args.owner.completeAjaxParams(params))}function on(event,handler){if(event==undefined||event==null||event=="")return"Event is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";
if(_args.events[event]==undefined)_args.events[event]=[];_args.events[event].push(handler)}function off(event,handler){if(event==undefined||event==null||event=="")return"Event is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";if(_args.events[event])for(var i=_args.events[event].length-1;i>=0;i--)if(_args.events[event][i]===handler)_args.events[event].splice(i,1)}function fireEvent(name,data){var r=false;if(_args.events[name]&&_args.events[name].length>
0)for(var i=0;i<_args.events[name].length;i++)try{r|=_args.events[name][args[0]](data)}catch(error){}return r}function toggleClassNameToMacroButton(name,action,title){var elem=_buttons[name]?_buttons[name]:null;if(elem){switch(action){case "enabled":helper.style.remove(elem,"macro_disabled macro_paused");helper.style.add(elem,"macro");break;case "paused":helper.style.remove(elem,"macro_disabled");helper.style.add(elem,"macro_paused");break;case "disabled":helper.style.remove(elem,"macro_paused ");
helper.style.add(elem,"macro_disabled");break}if(title!=null&&title!=undefined)elem.title=title}}function disableMouse(value){_args.owner.isRunningPlayback=value;if(value){_macro.hookMouse=false;$(_args.owner.vncdiv).off("mousedown",_args.owner.onTouchStart);$(_args.owner.vncdiv).off("mouseup",_args.owner.onTouchEnd);$(_args.owner.vncdiv).off("mousemove",_args.owner.onTouchMove);$(_args.owner.vncdiv).off("mouseleave",_args.owner.onTouchLeave)}else if(!_macro.hookMouse){_macro.hookMouse=true;$(_args.owner.vncdiv).on("mousedown",
_args.owner.onTouchStart);$(_args.owner.vncdiv).on("mouseup",_args.owner.onTouchEnd);$(_args.owner.vncdiv).on("mousemove",_args.owner.onTouchMove);$(_args.owner.vncdiv).on("mouseleave",_args.owner.onTouchLeave)}}function removeSpecialCharacters(value){if(value&&typeof value==="string"&&value!==""){var aucode=[0,1,2,3,4,5,6,7,8];var response="";for(var i=0;i<value.length;i++)if(aucode.indexOf(value.charCodeAt(i))===-1)response+=value[i];value=response}return value}function getWnd(wndClass,wndCaption,
wndRegExp){try{var elems=document.querySelectorAll('[wndClass^="'+removeSpecialCharacters(wndClass)+'"]');if(elems&&elems.length>0){wndRegExp=removeSpecialCharacters(wndRegExp);for(var i=0;i<elems.length;i++)if(wndRegExp!=undefined&&wndRegExp!=""){var regExp=new RegExp(wndRegExp);var titles=elems[i].getElementsByClassName("title");if(titles&&titles.length>0)for(var j=0;j<titles.length;j++)if(regExp.test(titles[j].innerHTML))return{"elem":elems[i],"hwnd":elems[i].id.replace("virtualui_canvas_","")}}else if(wndCaption!=
undefined){wndCaption=removeSpecialCharacters(wndCaption);var captions=elems[i].getElementsByClassName("caption");if(captions&&(captions.length==0&&wndCaption.length==0||captions[0].getElementsByClassName("title")[0].innerHTML==wndCaption))return{"elem":elems[i],"hwnd":elems[i].id.replace("virtualui_canvas_","")}}else if(relativeWindow.style.visibility=="visible"||relativeWindow.style.display=="block")return{"elem":elems[i],"hwnd":elems[i].id.replace("virtualui_canvas_","")}}}catch(error){helper.console.error(error.message,
error,arguments)}return null}function assignSelectedWindow(elem){if(elem){_selectedWindow.elem=elem;_selectedWindow.hwnd=elem.id.toString().substr(elem.id.lastIndexOf("_")+1,elem.id.length);var titles=elem.getElementsByClassName("title");_selectedWindow.caption=titles!=null&&titles.length>0?titles[0].getAttribute("hwndTitle")||titles[0].innerHTML:"";_selectedWindow.wndClass=elem.getAttribute("wndClass");_selectedWindow.class=helper.string.trim(elem.className.replace(/inactive|active/g,""))}else{_selectedWindow.elem=
null;_selectedWindow.hwnd=null;_selectedWindow.class=null;_selectedWindow.caption=null;_selectedWindow.wndClass=null}}function executeCmd(cmd){var msg=1;try{var msg=1;if(typeof cmd.wndRef!="undefined"){var wndRef=cmd.wndRef;var wnd=null;if(wndRef.function)wnd=wndRef.function();else wnd=getWnd(wndRef.wndClass,wndRef.wndCaption,wndRef.wndRegExp);_macro.cmd=cmd.wndRef;if(wnd&&wnd.elem){assignSelectedWindow(wnd.elem);switch(wndRef.state){case "visible":if(_selectedWindow.elem.style.visibility=="hidden"||
_selectedWindow.elem.style.display=="none")msg=helper.string.format("Element class {0} / {1} is hidden, wait until elem be visible.",wndRef.wndClass,wndRef.wndCaption);break;case "active":if(!helper.style.hasClass(_selectedWindow.elem,"active"))msg=helper.string.format("Element class {0} / {1}  is not active, wait until elem be active.",wndRef.wndClass,wndRef.wndCaption);break}}else{assignSelectedWindow(null);msg=helper.string.format("Element class {0} / {1}  is not exists, wait until elem exists.",
wndRef.wndClass,wndRef.wndCaption)}}else if(typeof cmd.mouse!="undefined"){var m=cmd.mouse;var x=0;var y=0;if(_macro.relativeWindow)if(_selectedWindow.elem){x=_selectedWindow.elem.offsetLeft+(m.xr||m.x);y=_selectedWindow.elem.offsetLeft+(m.yr||m.y)}else msg=helper.string.format("Active Element is null or undefined","");else{x=_selectedWindow.elem?_selectedWindow.elem.offsetLeft+(m.xr||m.x):m.x;y=_selectedWindow.elem?_selectedWindow.elem.offsetTop+(m.yr||m.y):m.y}if(msg==1)switch(m.action){case "move":_args.owner.mouseMove(x,
y);break;case "down":_args.owner.mouseDown(x,y,m.btn);break;case "up":_args.owner.mouseUp(x,y,m.btn);break;case "wheel":_args.owner.sendWheel(m.delta,0);break;default:msg=helper.string.format("Mouse action: {0}",m.action);break}}else if(typeof cmd.kbd!="undefined")_args.owner.sendKey(cmd.kbd.key,cmd.kbd.ch,cmd.kbd.down?"down":"up");else if(typeof cmd.input!="undefined"){var input=cmd.input;var text=cmd.text?cmd.text:"";if(_macro.params.args)for(arg in _macro.params.args)if(typeof cmd.input[arg]!=
"undefined"){text=_macro.params.args[arg];break}_args.owner.sendText(text)}else if(typeof cmd.wndCmd!="undefined"){var c=cmd.wndCmd;if(wndRef.function)wnd=wndRef.function();else wnd=getWnd(c.wndClass,c.wndCaption,c.wndRegExp);var action=null;if(wnd&&wnd.elem){assignSelectedWindow(wnd.elem);switch(c.cmd){case 0:action=BORDER_ACTION_CLOSE;break;case 1:action=BORDER_ACTION_MINIMIZE;break;case 2:action=BORDER_ACTION_MAXIMIZE;break}_macro.currentTime=null;if(action!=null)_args.owner.sendBtnClick(wnd.hwnd,
action);else msg=helper.string.format("Unknown cmd {0} ",JSON.stringify(c))}else msg=helper.string.format("Cannot find {0}",JSON.stringify(c.cmd))}else msg=helper.string.format("Unknown cmd: {0}",JSON.stringify(cmd))}catch(error){helper.console.log(error.message,arguments);return error.message}return msg}function runCmds(cmds,resolve,reject){var exceedTime=function(){if(_macro.currentTime==null)_macro.currentTime=(new Date).getTime();return(new Date).getTime()-_macro.currentTime>_macro.maxWaitTime};
var fnReject=function(cmd,msg){clearTimeout(_macro.timeoutId);_macro.stop=true;_macro.paused=true;_macro.currentTime=null;var renderMsg=msg||helper.string.format("Cannot find element with class: {0}, caption: {1}",_macro.cmd.wndClass,_macro.cmd.wndCaption);_buttons.stop.click();if(_asPromises)disableMouse(false);if(reject)reject({"data":cmds[_macro.idx],"message":renderMsg});else{disableMouse(false);if(!fireEvent("error",{"type":"notFound","msg":renderMsg}))alertPopup("<p>"+renderMsg+"</p>","none",
"","","","",false)}return false};_macro.isPlaying=true;clearTimeout(_macro.timeoutId);if(_macro.stop){_macro.isPlaying=false;_macro.stop=false;return}var cmd=cmds[_macro.idx];if(exceedTime()){if(_macro.lastMsg==1)_macro.lastMsg="Exceed Time";fnReject(cmd,_macro.lastMsg);return}_macro.lastMsg=executeCmd(cmd);if(_macro.lastMsg!=true){if(_macro.currentTime==null)_macro.currentTime=(new Date).getTime();_macro.timeoutId=setTimeout(runCmds,_macro.waitTime,cmds,resolve,reject)}else{_macro.currentTime=null;
if(_macro.idx<cmds.length-1){_macro.idx++;_macro.timeoutId=setTimeout(runCmds,cmds[_macro.idx].time,cmds,resolve,reject)}else{_macro.stop=false;_macro.idx=0;_macro.isPaused=false;if(_macro.params.start)playMacro(_macro.cmds);else if(_buttons.stop)_buttons.stop.click();if(resolve){if(_asPromises)disableMouse(false);resolve({"data":cmd})}return}}}function playMacro(cmds){helper.console.log(helper.string.format("{1} playing macro: {2} / {0} - {3}",cmds.length,_macro.idx==0?"Start":"Continue",_macro.idx,
_macro.currentFile),arguments);if(!_macro.isPlaying){if(_args.owner.cursorCanvas.style.display!="block")_args.owner.cursorCanvas.style.display="block";_args.owner.cursorCanvas.style.visibility="visible";runCmds(cmds)}}function sendMacroAction(action){_args.owner.sendCmd("cmd=macro&action="+action)}function _new(){_macro.relativeWindow=false;_macro.cmds=[];_macro.currentFile="new Temp File "+(new Date).getTime();_newPlayback.enable=false;_newPlayback.promise=null;_newPlayback.promises=null;_newPlayback.resolve=
null;_newPlayback.reject=null;_newPlayback.testOfCase={};_newPlayback.tasks={};_newPlayback.activeTaskName="";_newPlayback.taskIdx=0;if(_newPlayback.populatedTask.length>0){delete _task;_task={};_newPlayback.populatedTask=[]}}function newGroupTask(name,resolve,reject){if(name!=""&&_newPlayback.testOfCase[name]==undefined){_newPlayback.activeTaskName=name;_newPlayback.testOfCase[name]={"resolve":resolve,"reject":reject,"promises":[],"state":null,"promisesIdx":-1};if(_newPlayback.populateTask)if(_newPlayback.populatedTask.indexOf(name)==
-1){_newPlayback.populatedTask.push(name);Object.defineProperty(_task,name,{"enumerable":true,"configurable":false,"get":function(){_fromPopulateTask.isRunning=true;_fromPopulateTask.activeTask=name;disableMouse(true);return new Promise(function(res,rej){_fromPopulateTask.resolve=function(taskName,message){_macro.stop=false;res({"taskName":taskName,"message":message})};_fromPopulateTask.reject=function(taskName,cmd,message){_macro.stop=false;rej({"taskName":taskName,"cmd":cmd,"message":message})};
if(_newPlayback.testOfCase[name].promises.length>0)executeTaskPromise(name,0)})}})}return _ref}else{_newPlayback.enable=false;helper.console.warning(helper.string.format("Cannot create group task: {0}, is 'empty', undefined or already exists.",name),arguments);return null}}function newPlayback(resolve,reject){_newPlayback.enable=true;if(arguments.length==1&&typeof arguments[0]==="string"){_newPlayback.populateTask=true;return newGroupTask(arguments[0])}else if(arguments.length>2&&typeof arguments[0]===
"string"&&arguments[1]instanceof Function&&arguments[2]instanceof Function)return newGroupTask(arguments[0],arguments[1],arguments[2]);else if(resolve instanceof Function&&reject instanceof Function){_newPlayback.resolve=resolve;_newPlayback.reject=reject;disableMouse(true);return _ref}else{_newPlayback.enable=false;helper.console.warning("Cannot create new playback, is not a valid constructor",arguments);return null}}function executeTaskPromise(taskName,idx){if(taskName&&_newPlayback.testOfCase[taskName]&&
_newPlayback.testOfCase[taskName].promises.length>idx){_newPlayback.activeTaskName=taskName;_newPlayback.testOfCase[taskName].promises[idx].state=_enumPlaybackState.running;_newPlayback.testOfCase[taskName].promisesIdx=idx;var t=_newPlayback.testOfCase[taskName].promises[idx].data.time||1;helper.console.log(helper.string.format("Executing task: {0}, starting in: {1}s, step: {2} of {3}",taskName,t/1E3,idx+1,_newPlayback.testOfCase[taskName].promises.length),arguments);setTimeout(function(){delete _newPlayback.testOfCase[taskName].promises[idx].p;
_newPlayback.testOfCase[taskName].promises[idx].p=_newPlayback.testOfCase[taskName].promises[idx].promise();_newPlayback.testOfCase[taskName].promises[idx].p.then(_playbackResolveGroup,_playbackRejectGroup)},t)}}function runPlayback(expression){reset();var te=null;if(expression instanceof Array)te=expression;else{te=expression.replace(/ /g,"").replace(/\[|\]/g,"").toLowerCase();var s=",";if(te.indexOf("=>")!=-1)s="=>";else if(te.indexOf("->")!=-1)s="->";else if(te.indexOf(",")!=-1)s=",";else if(te.indexOf(";")!=
-1)s=";";te=te.split(s)}_newPlayback.tasks=[];for(var i=0;i<te.length;i++){var t={};if(te[i].indexOf("?")!=-1){var temp=te[i].split("?");t.name=temp[0];if(temp[1].indexOf(":")!=-1){temp=temp[1].split(":");t.then=temp[0];t.reject=temp[1]}else t.then=temp[1]}else t.name=te[i];_newPlayback.tasks.push(t)}if(_newPlayback.tasks.length>0&&_newPlayback.testOfCase[_newPlayback.tasks[0].name]!=undefined){var idx=0;_newPlayback.taskIdx=idx;disableMouse(true);executeTaskPromise(_newPlayback.tasks[0].name,idx)}else disableMouse(false)}
function getAllTestNames(){var names=[];for(var n in _newPlayback.testOfCase)names.push(n);return names}function runPlaybackExpression(exp){if(exp&&exp!=""){var fn=function doTest(name){return name};var names=getAllTestNames();var firstTest="test1";var str=exp;for(var i=0;i<names.length;i++)str=helper.object.eval("str.replace(/"+names[i]+"/g, 'doTest(\""+names[i]+"\")')");str=str.replace(/=>/g,"&")}}function getValue(value,defaultValue){return!(value===null||value===undefined||value==="")?value:defaultValue}
function _playbackResolveGroup(data){if(_newPlayback.testOfCase[_newPlayback.activeTaskName].state!=_enumPlaybackState.error){var idx=_newPlayback.testOfCase[_newPlayback.activeTaskName].promisesIdx;_newPlayback.testOfCase[_newPlayback.activeTaskName].promises[idx].state=_enumPlaybackState.done;var found=false;while(!found&&idx<_newPlayback.testOfCase[_newPlayback.activeTaskName].promises.length)if(_newPlayback.testOfCase[_newPlayback.activeTaskName].promises[idx].state===_enumPlaybackState.pending)found=
true;else idx++;if(found)executeTaskPromise(_newPlayback.activeTaskName,idx);else{try{_newPlayback.testOfCase[_newPlayback.activeTaskName].resolve(_newPlayback.activeTaskName,"resolved")}catch(error){}_newPlayback.taskIdx++;if(_newPlayback.taskIdx<_newPlayback.tasks.length)executeTaskPromise(_newPlayback.tasks[_newPlayback.taskIdx].name,0);else{_newPlayback.taskIdx=0;_newPlayback.activeTaskName="";clearTimeout(_macro.timeoutId);_macro.stop=true;_macro.currentFile=null;_macro.isPlaying=false;helper.console.log(helper.string.format("Playback finish.",
1),arguments);disableMouse(false);if(_fromPopulateTask.isRunning)_fromPopulateTask.resolve(_fromPopulateTask.activeTask,"resolved")}}}}function _playbackRejectGroup(data){_newPlayback.testOfCase[_newPlayback.activeTaskName].state=_enumPlaybackState.error;try{_newPlayback.testOfCase[_newPlayback.activeTaskName].reject(_newPlayback.activeTaskName,data.data,data.message);if(_newPlayback.tasks[_newPlayback.taskIdx].name===_newPlayback.activeTaskName&&_newPlayback.tasks[_newPlayback.taskIdx].reject){var rejectTask=
_newPlayback.tasks[_newPlayback.taskIdx].reject;if(_newPlayback.testOfCase[rejectTask]){_macro.stop=false;_macro.paused=false;executeTaskPromise(rejectTask,0)}}else{if(_fromPopulateTask.isRunning)_fromPopulateTask.reject(_fromPopulateTask.activeTask,data.data,data.message);disableMouse(false)}}catch(error){}}function _playbackResolve(data){_newPlayback.promise=null;_newPlayback.resolve(data.data,"resolved");if(_newPlayback.promises.length>0){var p=_newPlayback.promises.shift();var t=p.data&&p.data.time||
1;setTimeout(function(){var prom=p.promise();prom.then(_playbackResolve,_playbackReject)},t)}else disableMouse(false)}function _playbackReject(data){_newPlayback.promise=null;_newPlayback.reject(data.data,data.message);disableMouse(false)}function resolveResponse(prom,data){if(_newPlayback.activeTaskName){_newPlayback.testOfCase[_newPlayback.activeTaskName].promises.push({"promise":prom,"data":data,"state":_enumPlaybackState.pending});return _ref}else if(_newPlayback.enable&&_newPlayback.promise){if(!_newPlayback.promises)_newPlayback.promises=
[];_newPlayback.promises.push({"promise":prom,"data":data});return _ref}else if(_newPlayback.enable){var t=data&&data.time||1;_newPlayback.promise="inProgress";setTimeout(function(){_newPlayback.promise=prom();_newPlayback.promise.then(_playbackResolve,_playbackReject)},t);return _ref}else if(_asPromises){disableMouse(true);return prom()}else return prom()}function waitForWindow(filter,time){var prom=function(){return new Promise(function(resolve,reject){var cmd=null;_macro.idx=0;if(typeof time===
undefined)time=0;if(filter instanceof Function){cmd={};cmd.time=time;cmd.wndRef={"function":filter}}else if(filter instanceof Object){cmd={};cmd.time=time;cmd.wndRef={"state":getValue(filter.state,"visible"),"wndClass":getValue(filter.wndClass,getValue(filter.class,"")),"wndCaption":getValue(filter.wndCaption,getValue(filter.caption,"")),"wndRegExp":getValue(filter.wndRegExp,getValue(filter.regExp,""))}}if(cmd)if(_asPromises)setTimeout(function(){runCmds([cmd],resolve,reject)},time);else runCmds([cmd],
resolve,reject);else reject(cmd,"Invalid promise")})};return resolveResponse(prom,{"name":"waitForWindow","filter":filter,"time":time})}function windowAction(filter,time,enumWndAction){var prom=function(){return new Promise(function(resolve,reject){var cmd=null;if(typeof time===undefined)time=0;if(filter instanceof Function){cmd={};cmd.time=time;cmd.wndCmd={"function":filter,"cmd":enumWndAction}}else if(filter instanceof Object){cmd={};cmd.time=time;cmd.wndCmd={"state":getValue(filter.state,"visible"),
"wndClass":getValue(filter.wndClass,getValue(filter.class,"")),"wndCaption":getValue(filter.wndCaption,getValue(filter.caption,"")),"wndRegExp":getValue(filter.wndRegExp,getValue(filter.regExp,"")),"cmd":enumWndAction}}if(cmd)if(_asPromises)setTimeout(function(){runCmds([cmd],resolve,reject)},time);else runCmds([cmd],resolve,reject);else reject(cmd,"Invalid promise")})};return resolveResponse(prom,{"name":"windowAction","filter":filter,"time":time,"enumWndAction":enumWndAction})}function getMouse(x,
y,btn,time,action){return{"time":getValue(time,_defTime),"mouse":{"x":x,"y":y,"btn":getValue(btn,_defButton),"delta":0,"action":action}}}function mouseMove(x,y,btn,time){var prom=function(){return new Promise(function(resolve,reject){var cmds=[];if(x instanceof Array)for(var i=0;i<x.length;i++)cmds.push(getMouse(x[i].x,x[i].y,0,x[i].time,"move"));else cmds.push(getMouse(x,y,btn,time,"move"));if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,reject)})};
return resolveResponse(prom,{"name":"mouseMove","x":x,"y":y,"btn":btn,"time":time})}function mouseDown(x,y,btn,time){var prom=function(){return new Promise(function(resolve,reject){var cmds=[getMouse(x,y,0,1,"move"),getMouse(x,y,btn,time,"down")];if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,reject)})};return resolveResponse(prom,{"name":"mouseDown","x":x,"y":y,"btn":btn,"time":time})}function mouseUp(x,y,btn,time){var prom=function(){return new Promise(function(resolve,
reject){var cmds=[getMouse(x,y,btn,time,"up")];if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,reject)})};return resolveResponse(prom,{"name":"mouseUp","x":x,"y":y,"btn":btn,"time":time})}function mouseDownUp(x,y,btn,time){var prom=function(){return new Promise(function(resolve,reject){var t=getValue(time,_defTime);var b=getValue(btn,_defButton);var cmds=[];cmds.push(getMouse(x,y,0,1,"move"));cmds.push(getMouse(x,y,b,t,"down"));cmds.push(getMouse(x,
y,b,_defTime,"up"));if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,reject)})};return resolveResponse(prom,{"name":"mouseDownUp","x":x,"y":y,"btn":btn,"time":time})}function mouseDelta(delta,time){var prom=function(){return new Promise(function(resolve,reject){var cmds=[{"time":getValue(time,_defTime),"mouse":{"btn":0,"delta":delta,"action":"wheel"}}];if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,
reject)})};return resolveResponse(prom,{"promise":"mouseDelta","delta":delta,"time":time})}function mouse(values){var prom=function(){new Promise(function(resolve,reject){if(values instanceof Array){var cmds=[];for(var i=0;i<values.length;i++){var v=values[i];cmds.push(getMouse(v.x,v.y,v.btn,v.time,v.action))}if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,reject)}else reject(cmd,"Invalid promise")})};return resolveResponse(prom,{"name":"mouse","values":values})}
function getKey(key,ch,time,isDown){return{"time":getValue(time,_defTime),"kbd":{"key":key,"ch":ch,"down":isDown}}}function keyDown(key,ch,time){var prom=function(){return new Promise(function(resolve,reject){var cmds=[getKey(key,ch,time,true)];if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,reject)})};return resolveResponse(prom,{"name":"keyDown","key":key,"ch":ch,"time":time})}function keyUp(key,ch,time){var prom=function(){return new Promise(function(resolve,
reject){var cmds=[getKey(key,ch,time,false)];if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,reject)})};return resolveResponse(prom,{"name":"keyUp","key":key,"ch":ch,"time":time})}function keyDownUp(key,ch,time){var prom=function(){return new Promise(function(resolve,reject){var t=getValue(time,_defTime);var cmds=[];cmds.push(getKey(key,ch,t,true));cmds.push(getKey(key,ch,_defTime,false));if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,
reject)},time);else runCmds(cmds,resolve,reject)})};return resolveResponse(prom,{"name":"keyDownUp","key":key,"ch":ch,"time":time})}function text(value,time){var prom=function(){return new Promise(function(resolve,reject){var cmds=[{"input":"","text":value}];if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,reject)})};return resolveResponse(prom,{"name":"text","value":value,"time":time})}function spell(value,time,elapsed){var prom=function(){return new Promise(function(resolve,
reject){var cmds=[];var key="";var t=getValue(time,_defTime);for(var i=0;i<value.length;i++){key=value.charCodeAt(i);cmds.push(getKey(key,key,t,true));cmds.push(getKey(key,key,_defTime,false));t=elapsed||_macro.spellSpeed}if(_asPromises)setTimeout(function(){runCmds(cmds,resolve,reject)},time);else runCmds(cmds,resolve,reject)})};return resolveResponse(prom,{"name":"spell","value":value,"time":time})}function selectedWindow(){var r={"active":null,"hwnd":null,"visible":false,"class":null,"wndClass":null,
"caption":null};if(_selectedWindow.elem){r.active=true;r.hwnd=_selectedWindow.hwnd;r.visible=_selectedWindow.elem.style.visibility!=="hidden"&&_selectedWindow.elem.style.display!=="none";r.class=_selectedWindow.class;r.caption=_selectedWindow.caption;r.wndClass=_selectedWindow.wndClass}return r}function getActiveWindow(){var zIdx=0;var elem=null;document.querySelectorAll('div[wndClass]:not([wndClass="TCustomHintWindow"])').forEach(function(item){var z=parseFloat(item.style.zIndex);var v=item.style.visibility!=
"hidden"&&item.style.display!="none"&&z>zIdx;if(v){zIdx=z;elem=item}});var r={"active":null,"hwnd":null,"visible":false,"class":null,"wndClass":null,"caption":null};if(elem){r.hwnd=elem.id.toString().substr(elem.id.lastIndexOf("_")+1,elem.id.length);r.visible=true;r.class=helper.string.trim(elem.className.replace(/inactive|active/g,""));r.wndClass=elem.getAttribute("wndClass");var titles=elem.getElementsByClassName("title");r.caption=titles!=null&&titles.length>0?titles[0].getAttribute("hwndTitle")||
titles[0].innerHTML:""}return r}Object.defineProperty(this,"initialize",{"enumerable":true,"configurable":false,"writable":false,"value":initialize});Object.defineProperty(this,"on",{"enumerable":true,"configurable":false,"writable":false,"value":on});Object.defineProperty(this,"off",{"enumerable":true,"configurable":false,"writable":false,"value":off});Object.defineProperty(this,"new",{"enumerable":true,"configurable":false,"writable":false,"value":_new});Object.defineProperty(this,"clear",{"enumerable":true,
"configurable":false,"writable":false,"value":clear});Object.defineProperty(this,"reset",{"enumerable":true,"configurable":false,"writable":false,"value":reset});Object.defineProperty(this,"newPlayback",{"enumerable":true,"configurable":false,"writable":false,"value":newPlayback});Object.defineProperty(this,"runPlayback",{"enumerable":true,"configurable":false,"writable":false,"value":runPlayback});Object.defineProperty(this,"runPlaybackExpression",{"enumerable":true,"configurable":false,"writable":false,
"value":runPlaybackExpression});Object.defineProperty(this,"play",{"enumerable":true,"configurable":false,"writable":false,"value":playHandler});Object.defineProperty(this,"stop",{"enumerable":true,"configurable":false,"writable":false,"value":stopHandler});Object.defineProperty(this,"maxWaitTime",{"enumerable":true,"configurable":false,"get":function(){return _macro.maxWaitTime},"set":function(value){_macro.maxWaitTime=value}});Object.defineProperty(this,"asPromises",{"enumerable":true,"configurable":false,
"get":function(){return _asPromises},"set":function(value){_asPromises=value}});Object.defineProperty(this,"populateTask",{"enumerable":true,"configurable":false,"get":function(){return _newPlayback.populateTask},"set":function(value){_newPlayback.populateTask=value}});Object.defineProperty(this,"task",{"enumerable":true,"configurable":false,"get":function(){return _task}});Object.defineProperty(this,"relativeWindow",{"enumerable":true,"configurable":false,"get":function(){return _macro.relativeWindow},
"set":function(value){_macro.relativeWindow=value}});Object.defineProperty(this,"spellSpeed",{"enumerable":true,"configurable":false,"get":function(){return _macro.spellSpeed},"set":function(value){_macro.spellSpeed=value}});Object.defineProperty(this,"waitForWindow",{"enumerable":true,"configurable":false,"writable":false,"value":waitForWindow});Object.defineProperty(this,"windowAction",{"enumerable":true,"configurable":false,"writable":false,"value":windowAction});Object.defineProperty(this,"enumWindowAction",
{"enumerable":true,"configurable":false,"get":function(){return _enumWndAction}});Object.defineProperty(this,"mouseMove",{"enumerable":true,"configurable":false,"writable":false,"value":mouseMove});Object.defineProperty(this,"mouseDown",{"enumerable":true,"configurable":false,"writable":false,"value":mouseDown});Object.defineProperty(this,"mouseUp",{"enumerable":true,"configurable":false,"writable":false,"value":mouseUp});Object.defineProperty(this,"mouseDownUp",{"enumerable":true,"configurable":false,
"writable":false,"value":mouseDownUp});Object.defineProperty(this,"mouse",{"enumerable":true,"configurable":false,"writable":false,"value":mouse});Object.defineProperty(this,"keyDown",{"enumerable":true,"configurable":false,"writable":false,"value":keyDown});Object.defineProperty(this,"keyUp",{"enumerable":true,"configurable":false,"writable":false,"value":keyUp});Object.defineProperty(this,"keyDownUp",{"enumerable":true,"configurable":false,"writable":false,"value":keyDownUp});Object.defineProperty(this,
"text",{"enumerable":true,"configurable":false,"writable":false,"value":text});Object.defineProperty(this,"spell",{"enumerable":true,"configurable":false,"writable":false,"value":spell});Object.defineProperty(this,"selectedWindow",{"enumerable":true,"configurable":false,"get":function(){return selectedWindow()}});Object.defineProperty(this,"getActiveWindow",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return getActiveWindow()}});return this}try{Thinfinity!=undefined}catch(e){Thinfinity=
{}}Thinfinity.Macro=Macro})();var fromFile=false;var BORDER_ACTION_CLOSE=0,BORDER_ACTION_MINIMIZE=1,BORDER_ACTION_MAXIMIZE=2,BORDER_ACTION_HELP=3,BORDER_ACTION_RESTORE=4;var isEqIE9=agentInfo.isMSIE==true&&agentInfo.msieVersion==9?true:false;var TITLEBAR_ICON=0;var TITLEBAR_CAPTION_TEXT=1;var TITLEBAR_MINIMIZE_BUTTON=2;var TITLEBAR_MAXIMIZE_BUTTON=3;var TITLEBAR_RESTORE_BUTTON=3;var TITLEBAR_HELP_BUTTON=4;var TITLEBAR_CLOSE_BUTTON=5;if(typeof window.orientation=="undefined")window.orientation=0;
function byId(id){return document.getElementById(id)}function clone(oldObject){return $.extend(true,{},oldObject)}
function post(path,params,method){method=method||"post";var form=document.createElement("form");form.setAttribute("method",method);form.setAttribute("action",path);for(var key in params)if(params.hasOwnProperty(key)){var hiddenField=document.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",params[key]);form.appendChild(hiddenField)}document.body.appendChild(form);form.submit()}WebFontConfig={google:{families:[]}};
function GetWebFMX(serverData,runRemote,prodId,args){if(typeof serverData=="undefined"||serverData==null)serverData="";if(typeof runRemote=="undefined"||runRemote==null)runRemote=false;productId=typeof prodId!="undefined"?prodId:"webfmx";if(!runRemote)WebFMX.prototype=new ThinVNC(helper.object.existsPath(args,"vui.clientSettings")?{"clientSettings":args.vui.clientSettings}:undefined);var wfmx=new WebFMX(serverData,runRemote,args);if(!runRemote)initWebFMX(wfmx);return wfmx}
function initWebFMX(wfmx){if(wfmx.__proto__==null)if(Object.getPrototypeOf)wfmx.__proto__=Object.getPrototypeOf(wfmx);else wfmx.__proto__=wfmx.constructor.prototype;TVNC=wfmx.__proto__;TVNC.registerDrawCmd("FMX",wfmx.processFMXCommandStart);TVNC.rcParams.persistentCache=false;TVNC.rcParams.events.onProcessWindow=wfmx.events.onProcessWindow;TVNC.rcParams.events.onDeleteWindow=wfmx.events.onDeleteWindow;TVNC.canvasInitiallyHidden=true;var _canvasInitiallyHidden={};TVNC.registerCustomCmd(["canvasInitiallyHidden",
"canvasShow"],function(win){clearTimeout(_canvasInitiallyHidden[win.hwnd]);_canvasInitiallyHidden[win.hwnd]=setTimeout(function(){var canvas=document.getElementById(productId+"_canvas_"+win.hwnd);if(canvas&&canvas.style.display=="none")$(canvas).show()},2E3)});TVNC.registerCustomCmd("canvasHidden",function(win){clearTimeout(_canvasInitiallyHidden[win.hwnd]);delete _canvasInitiallyHidden[win.hwnd]});if(TVNC.overrideCursor)helper.style.changeCSSRule(".dwmwindow .buttons div.minimize, .dwmwindow .buttons div.minimizeDisabled, .dwmwindow .buttons div.maximize, .dwmwindow .buttons div.maximizeDisabled, .dwmwindow .buttons div.help, .dwmwindow .buttons div.helpDisabled, .dwmwindow .buttons div.close, .dwmwindow .buttons div.closeDisabled, .dwmwindow .buttons div.restore, .dwmwindow .buttons div.restoreDisabled, .dwmwindow .caption img.icon, .dwmwindow .caption div.icon",
"cursor","inherit");var touchMoveFn=function(e){if(TVNC.cursorCanvas&&TVNC.cursorCanvas.style.visibility==="hidden")TVNC.cursorCanvas.style.visibility="visible";helper.dom.removeEvent(document.body,"touchmove",touchMoveFn)};helper.dom.addEvent(window,"blur",function(){if(wfmx.cursorCanvas)wfmx.hideCursor();if(agentInfo.isMobile)helper.dom.addEvent(document.body,"touchmove",touchMoveFn,false)},false)}
function WebFMX(serverData,runRemote,args){var self=this;var uploadPopup={"elem":null,"intervalId":null,"max":9};var savePopup=null;var openFilePopup=null;var _vui=null;var _isRunningPlayback=false;var _toolBarButtons={};var _macro=null;if(window.Thinfinity&&window.Thinfinity.Macro){_macro=new Thinfinity.Macro;Object.defineProperty(self,"macro",{"enumerable":true,"configurable":false,"get":function(){return _macro}})}var _dockBarOptions={};var _dragAndDrop={"available":true,"initialized":false,"files":null,
"items":null};var _loadFilesQueue=[];var _proccesingFile=false;var _sessionStarted=false;this.initialize=function(args){if(helper.object.existsPath(args,"vui")){_vui=args["vui"];if(self.clientSettings==undefined&&helper.object.existsPath(_vui,"clientSettings"))self.clientSettings=_vui.clientSettings}if(agentInfo.isMobile)window.environment.on("orientationChange",resizeDesktop);else window.environment.on("resizeComplete",resizeDesktop)};if(typeof serverData!="undefined"&&serverData)self.baseUrl=serverData;
else{var path=this.rcParams&&this.rcParams.url?this.rcParams.url:window.location.href;if(path.indexOf("?")!==-1)path=path.substring(0,path.indexOf("?"));var pathArray=path.split("/");if(this.rcParams){if(this.rcParams.protocol==""||!this.rcParams.protocol)this.rcParams.protocol=pathArray[0];if(this.rcParams.server==""||!this.rcParams.server)this.rcParams.server=pathArray[2]}self.baseUrl="/";for(i=3;i<pathArray.length-1;i++){self.baseUrl+=pathArray[i];self.baseUrl+="/"}WebFMX.prototype.baseUrl=self.baseUrl;
self.webfmxBaseUrl=self.baseUrl}if(typeof self.brokerUrl==="undefined")self.brokerUrl="";WebFMX.prototype.setCookie=function(data,path){if(data&&data.SID){var expDate=new Date;expDate.setDate(expDate.getDate()+365);document.cookie=helper.string.format(cookiePrefix+"_SID={0}; expires={1}; path={2}",data.SID,expDate.toString(),path||"/")}};this.runRemote=typeof runRemote!="undefined"?runRemote:false;this.ftPath="";this.clipSaved=false;this.isCaretVisible=false;this.hideCaretTimer=null;this.canvasResizer=
null;this.getBodyHeight=function(){var p=$("#"+productId).parent();var h=p.length==0||p[0].tagName=="BODY"?$(window).height():p.height();return h};this.getBodyWidth=function(){var p=$("#"+productId).parent();var w=p.length==0||p[0].tagName=="BODY"?$(window).width():p.width();return w};if(self.baseUrl.charAt(self.baseUrl.length-1)!="/")self.baseUrl+="/";this.clearParams=function(){this.rdParams={targetWindow:"_self",exitURL:"about:blank",url:self.baseUrl,postPage:"connection.html",profileKey:null,
profilePass:null,width:window.environment.availWidth||this.getBodyWidth(),height:window.environment.availHeight||this.getBodyHeight(),resolution:"fittobrowser",clientAck:-1,divId:productId,scaled:false,formName:productId+"_form",maxWidth:0,maxHeight:0,hookMouse:true,hookKeyboard:true,clipboard:true,showToolbar:false,moveToWheel:false,mouseWheelDirection:1,mouseWheelStepValue:120,mousePressAsRightButton:false,noShowConnectionClosePopup:false,scraper:"fmx",useFocus:false,fitToBrowser:true,arguments:null,
overflow:"hidden",relativeTouch:1,extraData:{"timeZone":agentInfo.timeZone,"isMobile":agentInfo.isMobile},events:{onQueryDisconnect:null,onServerConnectionError:null,onServerConnect:null,onServerConnecting:null,onServerError:null,onServerDisconnect:null,onSessionStart:null,onSessionStop:null,onServerSceneRender:null,onServerCommandResult:null,onReceiveMessage:null,onPrintHandler:null,onCopy:null,onPaste:null,onCut:null,onLicenseMsg:null,onCreateCanvas:null,onReleaseCanvas:null,onProcessWindow:null},
encPostData:null}};this.clearParams();this.getDiv=function(){return document.getElementById(this.rcParams.divId)};function isImage(url){var aName=url.split(".");switch(aName[aName.length-1]){case "jpe":case "jpeg":case "jpg":case "png":case "bmp":case "tif":case "gif":return true;default:return false}}this.errorMsgPopup=function(data){var errorMessagePopup=null;var popupData={"id":"errorMsgPopup","dlgClass":"systemDlg","draggable":true,"title":data.title,"message":data.message};try{setTimeout(function(){errorMessagePopup=
new Thinfinity.ErrorMessagePopup(self,popupData,self.rdParams.divId)},500)}catch(error){helper.console.error("Error",error)}};var isFirstTime=true;this.events={onFileDownload:function(fileNames,mimetype){var popupData={"id":"openFile","dlgClass":"systemDlg","draggable":true,"fileNames":fileNames,"mimeType":mimetype};try{if(openFilePopup==null)openFilePopup=new Thinfinity.OpenFilePopup(self,popupData,self.rdParams.divId);else openFilePopup.addFile(popupData)}catch(error){helper.console.error("Error",
error)}},onOpenLink:function(obj){try{var openLinkPopup=new Thinfinity.OpenLinkPopup(self,{"id":"openLink","dlgClass":"systemDlg","draggable":true,"link":obj},self.rdParams.divId)}catch(error){helper.console.error("Error",error)}},onServerMessage:function(obj){try{var serverMsgPopup=new Thinfinity.ServerMessagePopup(self,{"id":"serverMsg","dlgClass":"systemDlg","draggable":true,"message":obj},self.rdParams.divId)}catch(error){helper.console.error("Error",error)}},onServerCommandEvent:function(obj){return false},
onServerConnectionError:function(sMsg){if(self.rdParams.events.onServerConnectionError)self.rdParams.events.onServerConnectionError(sMsg)},onServerConnect:function(obj){if(self.remoteApp!=undefined&&self.remoteApp["sendCommand"]!=undefined)self.remoteApp["sendCommand"]("connect",null);if(self.rdParams.events.onServerConnect)self.rdParams.events.onServerConnect(obj)},onServerConnecting:function(rec){if(self.remoteApp!=undefined&&self.remoteApp["sendCommand"]!=undefined)self.remoteApp["sendCommand"]("reconnecting",
null);if(self.rdParams.events.onServerConnecting)self.rdParams.events.onServerConnecting(rec)},onServerError:function(oError){if(self.rdParams.events.onServerError)self.rdParams.events.onServerError(oError)},onServerDisconnect:function(){_sessionStarted=false;self.pingStop();var playback=document.getElementById("_ipbs_");if(playback!=null){var parent=playback.parentElement;parent.removeChild(playback)}if(self.remoteApp!=undefined&&self.remoteApp["sendCommand"]!=undefined)self.remoteApp["sendCommand"]("disconnect",
null);if(isJsRODefined==true&&self.remoteApp)self.remoteApp.dispose();if(self.rdParams.events.onServerDisconnect)self.rdParams.events.onServerDisconnect();self.hideCaret()},onSessionStart:function(obj){_sessionStarted=true;if(self.rdParams.events.onSessionStart)self.rdParams.events.onSessionStart(obj)},onServerSceneRender:function(obj){BTP_FMX_AS=null;if(self.rdParams.events.onServerSceneRender)self.rdParams.events.onServerSceneRender(obj);if(isFirstTime)isFirstTime=false},onServerCommandResult:function(obj){if(self.rdParams.events.onServerCommandResult)self.rdParams.events.onServerCommandResult(obj)},
onSessionStop:function(obj){if(self.rdParams.events.onSessionStop)self.rdParams.events.onSessionStop(obj)},onProcessWindow:function(root,win,canvas){if(typeof win.imgs!=="undefined")if(win.hwnd!=="0"&&isFirstTime)this.onServerSceneRender();if(!win.borderStyle||win.transparent||win.hwnd==0){if(win.width==0&&win.height==0&&delayedShowWindow.winHelper&&delayedShowWindow.winHelper[win.hwnd]&&delayedShowWindow.winHelper[win.hwnd].visible)delayedShowWindow.winHelper[win.hwnd]={"visible":false,"count":0};
else if(typeof win.width!="undefined"&&delayedShowWindow.winHelper[win.hwnd]&&!delayedShowWindow.winHelper[win.hwnd].visible){delayedShowWindow.winHelper[win.hwnd]={"visible":false,"count":0};delayedShowWindow(win)}return}var div=self.getWindowBorder(win,canvas);if(div!=null){if(typeof win.borderIcons!="undefined")self.updateTitlebar(win);if(typeof win.windowState!="undefined")if(canvas.windowState!=win.windowState){self.windowStateChanged(win,canvas);if(self.rdParams.events.onWindowStateChanged)self.rdParams.events.onWindowStateChanged(win,
canvas);canvas.windowState=win.windowState}}div.style.zIndex=TVNC.baseZIndex+win.zidx*10+1;if(win.captionHeight==0)$("#title"+win.hwnd).removeClass("visible");else if(win.captionHeight>0)$("#title"+win.hwnd).addClass("visible");if(typeof win.borderWidth!="undefined"){canvas.style.padding=win.borderWidth+"px";canvas.canvas.style.margin=win.borderWidth+"px"}if(win.caption&&win.captionHeight>0){var elem=document.getElementById("title"+win.hwnd);elem.innerHTML=win.caption;elem.setAttribute("hwndTitle",
win.title)}if(win.active!=undefined&&div!=null){var bdiv=div;if(canvas.tagName=="DIV")bdiv=canvas;if(win.active){$(bdiv).removeClass("inactive");$(bdiv).addClass("active")}else{$(bdiv).removeClass("active");$(bdiv).addClass("inactive")}}if(win.menu){logDebug("menu: ",win.menu);var menu=byId("wmenu"+win.hwnd);if(!menu||JSON.stringify(menu.data)!=JSON.stringify(win.menu)){if(menu)div.removeChild(menu);if(win.menu.visible)menu=self.buildMenu(win,canvas)}menu.style.zIndex=parseInt($(canvas).css("z-index"),
10)+1;self.selectMenuItem(menu,win)}if(self.rdParams.events.onProcessWindow)self.rdParams.events.onProcessWindow(root,win,canvas)},onDeleteWindow:function(elem){var hwnd=elem.id.replace(productId+"_canvas_","");if(delayedShowWindow.winHelper)delete delayedShowWindow.winHelper[hwnd];if(_toolBarButtons[hwnd])delete _toolBarButtons[hwnd];if(elem.tagName=="CANVAS"){var div=elem.borderDiv;if(div)self.vncdiv.removeChild(div);elem.borderDiv=null}else if(elem.children.length!=0&&elem.children[0].tagName==
"CANVAS");self.hideCaret();if(self.rdParams.events.onDeleteWindow)self.rdParams.events.onDeleteWindow(hwnd)},onReceiveMessage:function(message){if(self.rdParams.events.onReceiveMessage)self.rdParams.events.onReceiveMessage(message)},onRemoteAppMessage:function(cmdType,cmdPath,cmdData){if(self.rdParams.events.onRemoteAppMessage)self.rdParams.events.onRemoteAppMessage(cmdType,cmdPath,cmdData)},onConnectionLost:function(status){if(self.rdParams.events.onConnectionLost)return self.rdParams.events.onConnectionLost(status)},
onConnectionRestored:function(status){if(self.rdParams.events.onConnectionRestored)return self.rdParams.events.onConnectionRestored(status)},onSessionEnd:function(msg){BTP_FMX_AE=null;if(self.rdParams.events.onSessionEnd)return self.rdParams.events.onSessionEnd(msg)},onPrintHandler:null,onCopy:function(obj){if(self.rdParams.events.onCopy)self.rdParams.events.onCopy(obj)},onPaste:function(obj){if(self.rdParams.events.onPaste)self.rdParams.events.onPaste(obj)},onCut:function(obj){if(self.rdParams.events.onCut)self.rdParams.events.onCut(obj)},
onLicenseMsg:function(obj){if(self.rdParams.events.onLicenseMsg)return self.rdParams.events.onLicenseMsg(obj)},onCreateCanvas:function(win){if(self.rdParams.events.onCreateCanvas)self.rdParams.events.onCreateCanvas(win)},onReleaseCanvas:function(win){if(self.rdParams.events.onReleaseCanvas)self.rdParams.events.onReleaseCanvas(win)}};this.getResizer=function(container){if(!this.canvasResizer)this.canvasResizer=helper.dom.appendJsonElement({"parentElement":container,"type":"div","attributes":{"id":"win_resizer",
"name":"win_resizer","class":"ignoremouse"}});return this.canvasResizer};this.cancelEvent=function(e){e.stopPropagation();e.preventDefault();return false};this.selectMenuItem=function(menu,win){if(menu.itemSelected!=-1){var id="wmenu"+win.hwnd+"i"+menu.itemSelected;$("#"+id).removeClass("clicked")}menu.itemSelected=win.menu.selected;if(menu.itemSelected!=-1){var id="wmenu"+win.hwnd+"i"+menu.itemSelected;$("#"+id).addClass("clicked")}};this.buildMenu=function(win,canvas){var rect=win.menu.rect;var menuElement=
helper.dom.appendJsonElement({"parentElement":canvas,"type":"div","attributes":{"id":"wmenu"+win.hwnd,"name":"wmenu"+win.hwnd,"class":"menu","style":"top:"+rect.top+"px;left:"+rect.left+"px;width:"+(rect.right-rect.left)+"px;height:"+(rect.bottom-rect.top)+"px;"}});$(menuElement).mousedown(function(e){return self.cancelEvent(e)});$(menuElement).click(function(e){return self.cancelEvent(e)});$(menuElement).mouseup(function(e){return self.cancelEvent(e)});for(var i=0;i<win.menu.items.length;i++){item=
win.menu.items[i];var m=item.text.match(/(.*)(&)(.)(.*)/);var html=m[1]+"<u>"+m[3]+"</u>"+m[4];var h=item.rect.bottom-item.rect.top+"px;";var id="wmenu"+win.hwnd+"i"+i;var elem=helper.dom.appendJsonElement({"parentElement":menuElement,"type":"div","attributes":{"id":id,"name":id,"class":"item","style":"top:"+item.rect.top+"px;left:"+item.rect.left+"px;width:"+(item.rect.right-item.rect.left)+"px;height:"+h+"line-height:"+h,"idx":i},"content":html});$(elem).mousedown(function(){self.sendCmd("cmd=menu&hwnd="+
win.hwnd+"&id="+$(this).attr("idx"));console.log("cmd=menu&hwnd="+win.hwnd+"&id="+$(this).attr("idx"))});$(elem).mouseenter(function(){if(this.parentElement.itemSelected!=-1){var id=$(this).attr("idx");if(this.parentElement.itemSelected!=id){self.sendCmd("cmd=menu&hwnd="+win.hwnd+"&id="+id);console.log("cmd=menu&hwnd="+win.hwnd+"&id="+id)}}})}menuElement.data=win.menu;return menuElement};this.username=null;this.password=null;this.sessionTimer=null;this.login=function(username,password,context,success,
fail,redirect){var curdate=new Date;var curtime=curdate.getFullYear()+"- "+curdate.getMonth()+"- "+curdate.getDate()+"- "+curdate.getHours()+"- "+curdate.getMinutes()+"- "+curdate.getSeconds()+"- "+curdate.getMilliseconds();var querystr="login?t="+curtime;if(typeof context!="undefined")querystr=querystr+"&context="+context;this.username=username;this.password=password;$.ajax({url:self.brokerUrl+querystr,async:true,cache:false,dataType:"html",method:"post",data:"username="+encodeURIComponent(username)+
"&password="+encodeURIComponent(password),error:function(jqXHR,err){fail()},success:function(data){var obj=typeof data!="object"?JSON.parse(data):data;if(typeof obj.redirectUri!="undefined"){if(typeof redirect==="function")try{redirect(obj.redirectUri)}catch(error){logError("login redirect handler error. "+error.message)}post(obj.redirectUri,{data:JSON.stringify(obj.data)});return}if(obj.rc!=0)fail(obj)}});return false};this.changePassword=function(username,oldPassword,newPassword,success,fail){var curdate=
new Date;this.username=username;this.password=newPassword;var querystr="username="+encodeURIComponent(username)+"&oldpassword="+encodeURIComponent(oldPassword)+"&newpassword="+encodeURIComponent(newPassword);var params={"url":self.baseUrl+"changePassword","method":"POST","async":true,"cache":false,"dataType":"html","data":querystr,"error":function(jqXHR,err){fail(err)},"success":function(obj){var response=null;try{response=JSON.parse(obj)}catch(error){logError("change password error. "+error.message)}success(response)}};
$.ajax(self.completeAjaxParams(params))};this.getLoginMethods=function(success,fail){var result=false;var curdate=new Date;var curtime=curdate.getFullYear()+"- "+curdate.getMonth()+"- "+curdate.getDate()+"- "+curdate.getHours()+"- "+curdate.getMinutes()+"- "+curdate.getSeconds()+"- "+curdate.getMilliseconds();var querystr="getLoginMethods?&t="+curtime;$.ajax({url:self.brokerUrl+querystr,async:true,cache:false,dataType:"html",error:function(jqXHR,err){result=false;fail()},success:function(data){var obj=
typeof data!="object"?JSON.parse(data):data;success(obj)}});return result};this.beforeUnload=function(){var curdate=new Date;var curtime=curdate.getFullYear()+"- "+curdate.getMonth()+"- "+curdate.getDate()+"- "+curdate.getHours()+"- "+curdate.getMinutes()+"- "+curdate.getSeconds()+"- "+curdate.getMilliseconds();var result=true;$.ajax({url:self.baseUrl+"beforeUnload"+"?id="+TVNC.rcParams.id+"&t="+curtime,cache:false,async:false,timeout:5E3,dataType:"json",success:function(data){result=data}});return result};
this.logout=function(success,fail){var curdate=new Date;var curtime=curdate.getFullYear()+"- "+curdate.getMonth()+"- "+curdate.getDate()+"- "+curdate.getHours()+"- "+curdate.getMinutes()+"- "+curdate.getSeconds()+"- "+curdate.getMilliseconds();$.ajax({url:self.brokerUrl+"logout"+"?t="+curtime,cache:false,async:true,dataType:"html",success:function(obj){if(typeof success!="undefined")success(obj)},error:function(jqXHR,textStatus){if(typeof fail!="undefined")fail(jqXHR)}})};this.getProfiles=function(success){var result=
null;$.ajax({url:self.brokerUrl+"getprofiles",async:true,dataType:"html",statusCode:{401:function(){result=null;this.profileList=result;success(result)},200:function(data){result=typeof data!="object"&&data!=""?JSON.parse(data):data;this.profileList=result;success(result)}}});this.profileList=result;return result};this.pingStart=function(){if(!this.sessionTimer)this.sessionTimer=setInterval(function(){$.ajax({url:self.baseUrl+"ping",async:true,dataType:"html"})},6E4)};this.pingStop=function(){if(this.sessionTimer){window.clearInterval(this.sessionTimer);
this.sessionTimer=null}};function onMouseGestureStyleHandler(){setRelativeTouch(self.rdParams.relativeTouch)}function resizeDesktop(){if(_sessionStarted){clearTimeout(self.resizeTimeout);self.resizeTimeout=setTimeout(function(){var isLandscape=window.environment.currentOrientation=="landscape"?true:false;var pos=TVNC.vncdiv!=null?TVNC.findPos(TVNC.vncdiv):[0,0];var offset={"left":pos[0],"top":pos[1]};if(TVNC.rcParams.maxWidth!=window.environment.rawWidth||TVNC.rcParams.maxHeight!=window.environment.rawHeight)TVNC.setMaxSize(window.Math.min(window.environment.rawWidth,
window.environment.detectedWidth),window.Math.min(window.environment.rawHeight,window.environment.detectedHeight));var dh,dw;if(!helper.object.existsPath(window,"clientSettings.UseViewportSize")||!clientSettings.UseViewportSize){dw=window.environment.detectedWidth-offset.left;dh=window.environment.detectedHeight-offset.top}else{dw=(window.environment.viewportWidth-offset.left)/Math.min(1,environment.currentDevicePixelRatio);dh=(window.environment.viewportHeight-offset.top)/Math.min(1,environment.currentDevicePixelRatio)}TVNC.sendCmd("cmd=resize&browserWidth="+
dw+"&browserHeight="+dh+"&orientation="+(window.orientation||0)+"&isLandscape="+isLandscape)},500)}}this.connect=function(params){this.clearParams();for(var p in params)this.applyParam(this.rdParams,p,params[p]);if(typeof customSettings!="undefined")[{binding:["noShowPopupsOnClose","noShowConnectionClosePopup"],to:"noShowConnectionClosePopup"},{binding:["noShowConnectionDisconnectPopup"],to:"noShowConnectionDisconnectPopup"}].forEach(item=>{item.binding.forEach(bind=>{if(customSettings.hasOwnProperty(bind))this.rdParams[item.to]=
customSettings[bind]})});if(this.rdParams.events.onPrintHandler)this.events.onPrintHandler=this.rdParams.events.onPrintHandler;if(this.baseUrl.indexOf("__PlaybackServer__")!=-1)self.isRunningPlayback=true;if(this.runRemote){var form=this.getForm();if(this.rdParams.brokerData)form.elements["brokerData"].value=this.rdParams.brokerData;form.elements["data"].value=escape(JSON.stringify(this.rdParams));form.target=this.rdParams.targetWindow=="*"?this.buildTargetName():this.rdParams.targetWindow;var proto=
this.rdParams.postPage.split(":");form.action=(proto[0]=="http"||proto[0]=="https"?"":self.baseUrl)+this.rdParams.postPage;form.submit()}else{this.setParams(this.rdParams,this.events);if(this.rdParams.logWindow){var scr=document.createElement("SCRIPT");scr.setAttribute("type","text/javascript");scr.setAttribute("src",self.baseUrl+"js/msgLogger.js");document.getElementsByTagName("HEAD")[0].appendChild(scr)}if(agentInfo.isMobile)window.environment.ready(function(){self.completeConnection()});else this.completeConnection()}};
this.completeConnection=function(){if(agentInfo.isMobile){this.maxWidth=this.rcParams.width;this.maxHeight=this.rcParams.height;this.rcParams.hookKeyboard=agentInfo.isTabletMode;this.rcParams.centered=false;this.rcParams.scaled=false;var _events=helper.object.clone(self.events);initMobile(this,productId=="virtualui"?undefined:false,{onServerConnecting:self.events.onServerConnecting,onSessionEnd:self.events.onSessionEnd,onServerConnectionError:self.events.onServerConnectionError,onServerError:self.events.onServerError,
onServerConnect:self.events.onServerConnect,onServerDisconnect:function(e){if(_events.onServerDisconnect)_events.onServerDisconnect.apply(this,arguments)},onServerCommandResult:self.events.onServerCommandResult,onSessionStart:function(obj){if(onMouseGestureStyleHandler)onMouseGestureStyleHandler();if(_events.onSessionStart)_events.onSessionStart.apply(this,arguments)}})}else if(this.rdParams.showToolbar&&!byId("connectionToolbar"))this.buildConnectionToolbar();if(agentInfo.isTouch)initTouchDevice();
if(this.__proto__==null)this.__proto__=Object.getPrototypeOf(this);this.__proto__.init.call(this,{scraper:this.rdParams.scraper,scraperArgs:this.buildArgs(this.rdParams)});this.__proto__.connect.call(this)};this.getImgQuality=function(){return this.rdParams.imagequality};this.setImgQuality=function(value){this.rdParams.imagequality=parseInt(value,10);switch(this.rdParams.imagequality){case 0:this.rdParams.imageMethod=1;this.rdParams.quality=100;break;case 1:this.rdParams.imageMethod=2;this.rdParams.quality=
80;break;case 2:this.rdParams.imageMethod=2;this.rdParams.quality=55;break;case 3:this.rdParams.imageMethod=0;this.rdParams.quality=40;break}this.setimageMethod(this.rdParams.imageMethod);this.setQuality(this.rdParams.quality);if(typeof saveConnectionSettings!="undefined")saveConnectionSettings()};this.restart=function(w,h){if(typeof w!="undefined")this.rdParams.width=w;if(typeof h!="undefined")this.rdParams.height=h;var args="cmd=start&subcmd=restart"+this.buildResolutionArgs();self.reset();self.start(args)};
this.buildResolutionArgs=function(){var args="";var w=this.rdParams.width;var h=this.rdParams.height;var fitmode="";if(this.rdParams.resolution=="fittobrowser"){if(!helper.object.existsPath(self,"clientSettings.UseViewportSize")||!self.clientSettings.UseViewportSize){w=window.environment.detectedWidth;h=window.environment.detectedHeight}else{w=window.environment.viewportWidth;h=window.environment.viewportHeight}fitmode="&fitmode=0"}else if(this.rdParams.resolution=="fittoscreen"){w=window.environment.rawWidth;
h=window.environment.rawHeight;fitmode="&fitmode=2"}var pos=TVNC.vncdiv!=null?TVNC.findPos(TVNC.vncdiv):[0,0];var offset={"left":pos[0],"top":pos[1]};args+="&browserWidth="+(w-offset.left)+"&browserHeight="+(h-offset.top);args+="&screenWidth="+window.environment.rawWidth+"&screenHeight="+window.environment.rawHeight;args+=fitmode;return args};this.buildArgs=function(params){var args="";if(this.rdParams.profileKey){args+="profileKey="+this.rdParams.profileKey;if(this.rdParams.profilePass)args+="&profilePass="+
this.rdParams.profilePass;args+=this.buildResolutionArgs()}else{if(args!="")args+="&";if(this.rdParams.width*this.rdParams.height>0)args+=this.buildResolutionArgs()}if(window.location.search!="")args+="&arguments="+encodeURIComponent(window.btoa(decodeURIComponent(window.location.search.substr(1))));if(params.encPostData&&params.encPostData!="")args+="&argumentsp="+encodeURIComponent(params.encPostData);return args};this.getForm=function(){return document.getElementById(this.rdParams.formName)};this.buildTargetName=
function(){var d=new Date;return"RDPCONN_"+(d.getFullYear()*1E4+d.getMonth()*100+d.getDate()).toString(16).toUpperCase()+"_"+(d.getHours()*360+d.getMinutes()*60+d.getSeconds()).toString(16).toUpperCase()};this.buildForm=function(){var form=helper.dom.appendJsonElement({"parentElement":document.body,"type":"form","attributes":{"id":this.rdParams.formName,"name":this.rdParams.formName,"method":"post"}});helper.dom.appendJsonElement({"parentElement":form,"type":"input","attributes":{"id":"brokerData",
"name":"brokerData","type":"hidden"},"content":""});helper.dom.appendJsonElement({"parentElement":form,"type":"input","attributes":{"id":"data","name":"data","type":"hidden"},"content":""})};this.buildConnectionToolbar=function(){var toolbar=new csToolbar("connectionToolbar",{"attributes":{"class":"connectionToolbar","style":"display:none"},"itemClass":"connectionToolbarItem","buttons":[{"attributes":{"id":"scale"},"html":WebFMXconsts.scale,"events":[{"name":"click","action":function(event){event.stopPropagation();
event.preventDefault();if(self.rcParams.scaled){self.rcParams.scaled=false;$("#scale").removeClass("scale2")}else{self.rcParams.scaled=true;$("#scale").addClass("scale2")}self.zoomDesktop()}}]},{"attributes":{"id":"disconnectDt"},"html":WebFMXconsts.disconnect,"events":[{"name":"click","action":function(){if(self.rdParams.events.onQueryDisconnect)self.rdParams.events.onQueryDisconnect(self.disconnect);else self.disconnect()}}]}]})};function viewOnlyMenu(){$("#sendKeysBtn").hide();$("#sendKeysBtn").removeClass("pressed")}
this.hostToName=function(){return self.baseUrl.replace(/[\.:\/]/g,"")};this.updateTools=function(){var tb=$("#connectionToolbar");if(this.rdParams.showToolbar)if(this.connected){tb.show();tb.css("margin-left",-tb.width()/2);if(this.rdParams.scaled)$("#scale").addClass("scale2");else $("#scale").removeClass("scale2")}else tb.hide();else if(tb&&tb[0])tb.hide()};if(this.runRemote&&document.body)this.buildForm();this.fileUpload={filesUploading:null,uploadErrors:null,uploadOk:null,onClear:null,onFileAdd:null,
onFileUploadFinish:null,progressBar:null,progressContainerID:"FMXProgressContainer",xhrItems:{},pendingUploads:null,maxConcurrentUploads:4,init:function(startDrag){this.clear();if(typeof startDrag=="undefined")startDrag=true;if(startDrag&&window.File&&window.FileReader&&window.FileList&&window.Blob)self.dragDrop.init(startDrag)},clear:function(){this.pendingUploads=new Array;this.filesUploading=new Array;if(this.progressBar!=null){for(var pb=0;pb<this.progressBar.length;pb++)if(this.progressBar[pb]){this.progressBar[pb].remove();
delete this.progressBar[pb]}var fupc=byId(this.progressContainerID);if(fupc)fupc.parentElement.removeChild(fupc)}var elem=byId(isEqIE9?"inputFileName":"inputFile");if(elem)elem.form.reset();this.progressBar=null;if(this.onClear)this.onClear()},add:function(file,fullpath){if(typeof fullpath=="undefined")fullpath=typeof file.name!="undefined"?file.name:file;this.filesUploading=this.filesUploading.concat({"file":file,"fullpath":fullpath});if(this.onFileAdd)this.onFileAdd(file)},getFilenames:function(){if(!this.filesUploading)return"";
else{var names=[];for(var f=0;f<this.filesUploading.length;f++)names.push(this.filesUploading[f].fullpath);return names.join("|").replace(/C:\\fakepath\\/i,"")}},retryUpload:function(fnames){fnames=Array.isArray(fnames)?fnames:typeof fnames==="string"?[fnames]:fnames;var files=[];for(var i=0,len=this.filesUploading.length;i<len;i++){if(fnames.indexOf(this.filesUploading[i].fullpath)!=-1)files.push({idx:i,fullpath:this.filesUploading[i].fullpath,file:this.filesUploading[i].file});if(files.length==
fnames.length)break}this.startUploading(files)},startUploading:function(files){this.pendingUploads=new Array;var FMXProgressContainer=byId(this.progressContainerID)||byId("FUProgressContainer");FMXProgressContainer.style.visibility="visible";this.uploadErrors=new Array;this.uploadOk=new Array;this.uploaded=0;if(Array.isArray(files)&&files.length>0){this.toUpload=files.length;var customIdx=typeof files[0].idx==="number"?true:false;for(var i=0;i<this.toUpload;i++)if(customIdx)this.uploadFile(files[i].file,
files[i].idx,files[i].fullpath);else this.uploadFile(files[i],i)}else{this.toUpload=this.filesUploading.length;for(var i=0;i<this.toUpload;i++)this.uploadFile(this.filesUploading[i].file,i,this.filesUploading[i].fullpath)}for(var i=1;i<=this.maxConcurrentUploads;i++)this.startNextUpload()},startNextUpload:function(){if(this.pendingUploads.length>0){var uploadItem=this.pendingUploads.shift();this.xhrItems[uploadItem.fn].open("POST","ft/"+(self.ftPath!=""?self.ftPath+"/":"")+encodeURIComponent(uploadItem.fn));
this.xhrItems[uploadItem.fn].send(uploadItem.fd)}},uploadFile:function(file,idx,fullpath){if(typeof fullpath=="undefined")fullpath=typeof file.name!="undefined"?file.name:file;TVNC.pingIgnore=true;if(Array.isArray(this.progressBar)&&this.progressBar[idx]!=null&&this.progressBar[idx]!=undefined)this.progressBar[idx].removeClass("failed");else this.addProgress(file,idx);if(typeof FormData!="undefined"){var fd=new FormData;fd.append("fileToUpload",file);var fn=fullpath;if(this.xhrItems[fn])delete this.xhrItems[fn];
this.xhrItems[fn]=new XMLHttpRequest;if(typeof window.addEventListener!="undefined"){this.xhrItems[fn].upload.addEventListener("progress",function(evt){self.fileUpload.uploadProgress(evt,file,idx)},false);this.xhrItems[fn].addEventListener("load",function(evt){self.fileUpload.uploadComplete(evt,file,idx,fullpath)},false);this.xhrItems[fn].addEventListener("error",function(evt){self.fileUpload.uploadFailed(evt,file,idx,fullpath)},false);this.xhrItems[fn].addEventListener("abort",function(evt){self.fileUpload.uploadCanceled(evt,
fullpath,idx)},false)}else if(typeof window.attachEvent!="undefined"){this.xhrItems[fn].upload.attachEvent("progress",function(evt){self.fileUpload.uploadProgress(evt,file,idx)},false);this.xhrItems[fn].attachEvent("load",function(evt){self.fileUpload.uploadComplete(evt,file,idx,fullpath)});this.xhrItems[fn].attachEvent("error",function(evt){self.fileUpload.uploadFailed(evt,file,idx,fullpath)});this.xhrItems[fn].attachEvent("abort",function(evt){self.fileUpload.uploadCanceled(evt,fullpath,idx)})}this.pendingUploads.push({"fn":fn,
"fd":fd})}else{var ulFrame=byId("upload_frame");ulFrame.onload=function(evt){self.fileUpload.uploadComplete(evt,file,idx,fullpath)};var fuForm=byId("_fuForm");if(isEqIE9){$(fuForm).remove("input[type=file]");$(fuForm).prepend(byId("inputFile"));$(fuForm).attr("action","/ft/"+(self.ftPath!=""?self.ftPath+"/":"")+encodeURIComponent(byId("inputFileName").value))}$(fuForm).submit()}},uploadAbort:function(){for(var ff in self.fileUpload.xhrItems)self.fileUpload.xhrItems[ff].abort()},uploadProgress:function(evt,
file,idx){if(evt.lengthComputable){var pc=parseInt(evt.loaded/evt.total*100);this.progressBar[idx].maxValue=100;this.progressBar[idx].setPos(pc)}else{this.progressBar[idx].maxValue=0;this.progressBar[idx].setmesage(WebFMXconsts.uploading)}},uploadComplete:function(evt,file,idx,fullpath){var fu=self.fileUpload;var src=evt.sourceElement||evt.target;if(src)if(src.status!=200)if(!src.responseXML){if(typeof src.readyState=="undefined"||src.readyState!="complete"){fu.uploadFailed(evt,file,idx,fullpath);
return}}else if(!src.responseText.match(/200 OK/)){fu.uploadFailed(evt,file,idx,fullpath);return}fu.uploadOk.push({filename:fullpath});if(self.rdParams.events.onFileUploadComplete)self.rdParams.events.onFileUploadComplete();if(this.onFileUploadComplete)this.onFileUploadComplete(fullpath,this);logDebug("uploadComplete "+idx);this.uploadClose(fullpath);this.startNextUpload()},uploadFailed:function(evt,file,idx,fullpath){var fu=self.fileUpload;if(self.rdParams.events.onFileUploadFailed)self.rdParams.events.onFileUploadFailed();
var src=evt.sourceElement||evt.target;var sError="";if(src.status!=0)sError=helper.string.sprintf("Error %s",src.status);if(src.statusText!="")sError+=helper.string.sprintf(" (%s)",src.statusText);if(sError=="")sError=WebFMXconsts.uploadDlgInvalidFile+helper.string.format(" {0}",fullpath);fu.uploadErrors.push({msg:sError,status:src.status,statusText:src.statusText,filename:fullpath});logDebug("upload failed "+idx+": "+sError);this.progressBar[idx].setClass("failed");this.progressBar[idx].setMessage(sError+
" ("+this.formatedSize(file.size)+")");this.uploadClose(fullpath);this.startNextUpload()},uploadCanceled:function(evt,fullpath,idx){if(self.rdParams.events.onFileUploadCancel)self.rdParams.events.onFileUploadCancel();logDebug("upload canceled "+idx);this.progressBar[idx].setClass("failed");this.uploadClose(fullpath)},uploadClose:function(filename){if(this.xhrItems[filename])delete this.xhrItems[filename];this.uploaded++;if(this.uploaded==this.toUpload)this.uploadFinish()},uploadFinish:function(){TVNC.pingIgnore=
false;if(this.onFileUploadFinish)this.onFileUploadFinish(this)},progressContainer:function(){var fuc=byId(this.progressContainerID);if(!fuc)fuc=helper.dom.appendJsonElement({"parentElement":document.body,"type":"div","attributes":{"id":this.progressContainerID}});return fuc},addProgress:function(file,idx){var fuc=this.progressContainer();var pb=new ProgressBar({"id":this.progressContainerID,"idx":idx,"background-color":"#FF0","barHeight":"20px","mask":"<span class='upfilename'>"+file.name+" ("+this.formatedSize(file.size)+
")</span><span class='upfilepercent'>$d%</span>"});pb.init();if(!this.progressBar)this.progressBar=new Array;this.progressBar[idx]=pb},formatedSize:function(val){var unit=" KB";if(val>1048576){val=val/1048576;unit=" MB"}else val=val/1024;return Math.ceil(val*100)/100+unit},setProgressContainerName:function(name){this.FMXProgressContainer=name}};this.dragDrop={init:function(autoStart){if(typeof autoStart=="")autoStart=true;if(autoStart)this.start()},start:function(){var deskDiv=document.body;if(typeof window.addEventListener!=
"undefined"){deskDiv.addEventListener("dragenter",this.dragEnter,false);deskDiv.addEventListener("dragleave",this.dragLeave,false);deskDiv.addEventListener("dragover",this.noopHandler,false);deskDiv.addEventListener("drop",this.drop,false)}else;},stop:function(){var deskDiv=document.body;if(typeof window.removeEventListener!="undefined"){deskDiv.removeEventListener("dragenter",this.dragEnter,false);deskDiv.removeEventListener("dragleave",this.dragLeave,false);deskDiv.removeEventListener("dragover",
this.noopHandler,false);deskDiv.removeEventListener("drop",this.drop,false)}else;},noopHandler:function(evt){evt.stopPropagation();evt.preventDefault()},dragEnter:function(evt){},dragLeave:function(evt){},drop:function(evt){if(typeof self.fileUpload!="undefined")self.fileUpload.clear();var getFileExtension=function(fileName){var fn=fileName.toString();fn=fileName.substring(fileName.lastIndexOf(".")!=-1?fileName.lastIndexOf("."):fileName.length);return fn};var cmbFF=$(".textField.cmbFilter")[0];var currentFilters=
null;if(cmbFF&&cmbFF.childNodes&&cmbFF.childNodes.length>0){currentFilters=cmbFF.childNodes[cmbFF.selectedIndex].value;if(currentFilters.indexOf(".*")!=-1)currentFilters=null}$.unblockUI();self.dragDrop.noopHandler(evt);var files=evt.dataTransfer.files;if(files.length>0){for(var i=0;i<files.length;i++)if(currentFilters!=null){var fileExt=getFileExtension(files[i].name);if(currentFilters.indexOf(fileExt)!=-1)self.fileUpload.add(files[i]);else;}else self.fileUpload.add(files[i]);$("#okBtn").removeClass("disabled")}}};
var cmdCache={},lastMatrix=null,self=this;this.contextStack=0;this.clipArray=null;this.nextCmdIndex=0;this.lastBitmapIndex="";this.resizeTimeout=null;this.caret={"div":null,"x":0,"y":0,"cx":1,"cy":13,"color":0,"blink":0,"data":null};this.blinkTimer=null;this.clearCmdCache=function(win){cmdCache["w"+win.hwnd]=new Array(1E3)};this.toRGB2=function(color,opacity){var rgb="rgba("+(color>>16&255)+",";rgb+=(color>>8&255)+",";rgb+=(color&255)+","+((color>>24&255)>0?(color>>24&255)/255*opacity:opacity)+")";
return rgb};this.toRGB=function(color,opacity){var rgb="rgba("+(color>>16&255)+",";rgb+=(color>>8&255)+",";rgb+=(color&255)+","+(color>>24&255)/255*opacity+")";return rgb};this.setSize=function(cmd,win,context){var canvas=byId("win");if(canvas){var oldcanvas=document.createElement("canvas");oldcanvas.width=canvas.width;oldcanvas.height=canvas.height;var oldcontext=oldcanvas.getContext("2d");oldcontext.drawImage(canvas,0,0);context.save();if(canvas.width!=cmd.w)canvas.width=cmd.w;if(canvas.height!=
cmd.h)canvas.height=cmd.h;context.restore();context.drawImage(oldcanvas,0,0)}};function delayedShowWindow(win){var timeout=50;var maxCount=20;var obj=delayedShowWindow.winHelper[win.hwnd];if(!obj){obj={visible:false,count:0};delayedShowWindow.winHelper[win.hwnd]=obj}if(!obj.visible){win.drawBitmapDone=true;if(obj.timeout){if(obj.count>=maxCount)return;clearTimeout(obj.timeout)}obj.count++;obj.timeout=setTimeout(function(){var canvas=document.getElementById(productId+"_canvas_"+win.hwnd);$(canvas).show();
obj.visible=true},timeout)}}delayedShowWindow.winHelper=[];this.drawBitmap=function(cmd,win,context){delayedShowWindow(win);var item=self.getFromImageCache(cmd.b);if(item&&item.image){var img=item.image.data;if(!img)if(fromFile)img=this.newImage(cmd.b);else{console.error("bitmap "+cmd.b+" not found");return}}else{console.error("item "+cmd.b+" not found");return}if(!cmd.s)cmd.s={l:0,t:0,r:cmd.d.r-cmd.d.l,b:cmd.d.b-cmd.d.t};if(typeof cmd.o=="undefined")cmd.o=1;if(typeof cmd.t=="undefined")cmd.t=0;context.globalAlpha=
cmd.o;try{if(cmd.d.r-cmd.d.l>0&&cmd.d.b-cmd.d.t>0){var cnv=context.canvas;if(cnv.width<cmd.d.r||cnv.height<cmd.d.b)TVNC.updateCanvasSize(cnv.parentElement,null,null,Math.max(cmd.d.r,cnv.width),Math.max(cmd.d.b,cnv.height));if(cmd.t==0)context.clearRect(cmd.d.l,cmd.d.t,cmd.d.r-cmd.d.l,cmd.d.b-cmd.d.t);context.drawImage(img,cmd.s.l,cmd.s.t,cmd.s.r-cmd.s.l,cmd.s.b-cmd.s.t,cmd.d.l,cmd.d.t,cmd.d.r-cmd.d.l,cmd.d.b-cmd.d.t)}}catch(e){console.log(e)}context.globalAlpha=1};this.createLinearGradient=function(grad,
rect,opacity,context){var w=rect.r-rect.l;var h=rect.b-rect.t;var lingrad=context.createLinearGradient(grad.sp.x*w,grad.sp.y*h,grad.ep.x*w,grad.ep.y*h);for(var n=0;n<grad.p.length;n++){var gp=grad.p[n];lingrad.addColorStop(gp.o,this.toRGB(gp.c,opacity))}context.fillStyle=lingrad};this.createRadialGradient=function(grad,rect,opacity,context){var w=rect.r-rect.l;var h=rect.b-rect.t;var radgrad=context.createRadialGradient(grad.sp.x*w,grad.sp.y*h,grad.rd.ra,grad.ep.x*w,grad.ep.y*h,grad.rd.ra);context.fillStyle=
radgrad};this.createGradient=function(grad,rect,opacity,context){if(grad.s==0)this.createLinearGradient(grad,rect,opacity,context);else this.createRadialGradient(grad,rect,opacity,context)};this.createPattern=function(pat,rect,context){var item=self.getFromImageCache(pat.b);var img=item.image.data;if(!img)if(fromFile)img=this.newImage(pat.b);else{console.error("no encontro bitmap");return}var repeat="repeat";if(pat.w>0)repeat="no-repeat";var pattern=context.createPattern(img,repeat);context.fillStyle=
pattern};this.applyBrush=function(brush,rect,opacity,context){switch(brush.k){case 1:context.fillStyle=this.toRGB(brush.c,opacity);break;case 2:this.createGradient(brush.g,rect,opacity,context);break;case 0:case 3:this.createPattern(brush.p,rect,context);break;case 4:case 5:}context.opcacity=opacity};this.applyStroke=function(brush,opacity,context){context.strokeStyle=this.toRGB(brush.c,opacity);context.lineWidth=brush.st};var CP=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;
if(CP&&CP.lineTo){CP.dashLine=function(x,y,x2,y2,dashArray){if(!dashArray)dashArray=[10,5];if(dashLength==0)dashLength=.001;var dashCount=dashArray.length;this.moveTo(x,y);var dx=x2-x,dy=y2-y;var slope=dy/dx;var distRemaining=Math.sqrt(dx*dx+dy*dy);var dashIndex=0,draw=true;while(distRemaining>=.1){var dashLength=dashArray[dashIndex++%dashCount];if(dashLength>distRemaining)dashLength=distRemaining;var xStep=Math.sqrt(dashLength*dashLength/(1+slope*slope));if(dx<0)xStep=-xStep;x+=xStep;y+=slope*xStep;
this[draw?"lineTo":"moveTo"](x,y);distRemaining-=dashLength;draw=!draw}};CP.dashRect=function(x,y,x2,y2,dashArray){this.lineCap="square";this.beginPath();this.dashLine(x,y,x2,y,dashArray);this.dashLine(x2-.1,y,x2,y2,dashArray);this.dashLine(x2,y2,x,y2,dashArray);this.dashLine(x,y2,x-.1,y,dashArray);this.closePath();this.stroke()}}this.showCaret=function(cmd,win,context){if(self.KeyboardHandler)self.KeyboardHandler.setCaret(cmd);this.caret.x=cmd.r.l;this.caret.y=cmd.r.t;this.caret.cx=cmd.r.r-cmd.r.l;
this.caret.cy=cmd.r.b-cmd.r.t;this.caret.color=0;this.caret.blink=cmd.bk;this.caret.rw=helper.object.clone(cmd.rw);if(!this.caret.div){var div=document.createElement("div");div.style.position="absolute";div.style.borderWidth="0px";div.style.display="block";div.id="caret";this.vncdiv.appendChild(div);this.caret.div=div}this.caret.div.style.left=this.caret.x+"px";this.caret.div.style.top=this.caret.y+"px";this.caret.div.style.width=this.caret.cx+"px";this.caret.div.style.height=this.caret.cy+"px";this.caret.div.style.zIndex=
TVNC.baseZIndex+win.zidx*10+1;this.caret.div.style.backgroundColor="black";this.caret.div.style.visibility="visible";if(this.caret.blink&&!this.blinkTimer)this.blinkTimer=setInterval(function(){if(self.caret.div.style.visibility=="visible")self.caret.div.style.visibility="hidden";else self.caret.div.style.visibility="visible"},self.caret.blink);if(!this.caret.blink&&this.blinkTimer){clearInterval(this.blinkTimer);this.blinkTimer=0}this.isCaretVisible=true};this.hideCaret=function(cmd,win,context){if(self.KeyboardHandler)self.KeyboardHandler.setCaret(null);
if(this.caret.div)this.caret.div.style.visibility="hidden";if(this.blinkTimer){clearInterval(this.blinkTimer);this.blinkTimer=0}this.caret.rw=undefined};this.onTap=function(x,y){var coords=self.caret.rw;var tempY=y;var tempX=x;if(productId=="virtualui"){tempY/=self.getZoom();tempX/=self.getZoom()}if(typeof coords!="undefined"&&coords.b-coords.t<self.multiRowMinSize&&coords.t<=tempY&&tempY<=coords.b&&coords.l<=tempX&&tempX<=coords.r){self.caretY=coords.t+(coords.b-coords.t)/2;self.caretX=coords.l;
ShowStdKbd()}else{var url="webfmx/getcaret?sessionid="+self.rcParams.id+"&x="+tempX+"&y="+tempY+"&timeout=450";$.ajax({url:url,async:false,cache:false,dataType:"html",timeout:500,error:function(jqXHR,err){logDebug("error:"+JSON.stringify(jqXHR))},success:function(data){if(data){data=JSON.parse(data);if(data.cmd==28){ShowStdKbd();return}if(data.cmd==24)$("#touchkbd").blur();else{coords=data.rw;if(coords.t<=tempY&&tempY<=coords.b&&coords.l<=tempX&&tempX<=coords.r){self.caretY=coords.t+(coords.b-coords.t)/
2;self.caretX=coords.l;self.caret.data=data;ShowStdKbd()}else $("#touchkbd").blur()}}else if(agentInfo.isMobile&&self.mobileKeyboard&&self.mobileKeyboard.locationType!==self.mobileKeyboard.enumLocationType.VIRTUALKEYBOARD)$("#touchkbd").blur()}})}};this.clearRect=function(cmd,win,context){context.clearRect(cmd.r.l,cmd.r.t,cmd.r.r-cmd.r.l,cmd.r.b-cmd.r.t)};this.clear=function(cmd,win,context){context.clearRect(0,0,context.canvas.width,context.canvas.height)};this.screenBlt=function(cmd,win,context){var imagedata=
null;try{imagedata=context.getImageData(cmd.sx,cmd.sy,cmd.dr.r-cmd.dr.l,cmd.dr.b-cmd.dr.t)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imagedata=context.getImageData(cmd.sx,cmd.sy,cmd.dr.r-cmd.dr.l,cmd.dr.b-cmd.dr.t)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(imagedata)context.putImageData(imagedata,cmd.dr.l,cmd.dr.t)};this.dragRect=function(cmd,
win,context){var canvas=document.getElementById(productId+"_canvas_"+win.hwnd);var resizer=self.getResizer(canvas.parentElement);if(cmd.vis){resizer.style.left=cmd.r.l+"px";resizer.style.top=cmd.r.t+"px";resizer.style.width=cmd.r.r-cmd.r.l+"px";resizer.style.height=cmd.r.b-cmd.r.t+"px";resizer.style.zIndex=self.cursorCanvas?.style?.zIndex||TVNC.baseZIndex+win.zidx*10+1;resizer.style.display="block"}else resizer.style.display="none"};this.roundRect=function(cmd,win,context){var x=cmd.r.l;var y=cmd.r.t;
var width=cmd.r.r-cmd.r.l;var height=cmd.r.b-cmd.r.t;var radius=cmd.rd.x;if(cmd.b)this.applyBrush(cmd.b,cmd.r,cmd.o,context);if(cmd.p)this.applyStroke(cmd.p,cmd.o,context);context.beginPath();context.moveTo(x+radius,y);context.lineTo(x+width-radius,y);context.quadraticCurveTo(x+width,y,x+width,y+radius);context.lineTo(x+width,y+height-radius);context.quadraticCurveTo(x+width,y+height,x+width-radius,y+height);context.lineTo(x+radius,y+height);context.quadraticCurveTo(x,y+height,x,y+height-radius);
context.lineTo(x,y+radius);context.quadraticCurveTo(x,y,x+radius,y);context.closePath();if(cmd.b)context.fill();if(cmd.p)context.stroke()};this.fillRect=function(cmd,win,context){if(cmd.b){this.applyBrush(cmd.b,cmd.r,cmd.o,context);context.fillRect(cmd.r.l,cmd.r.t,cmd.r.r-cmd.r.l,cmd.r.b-cmd.r.t)}if(cmd.p){cmd.b=cmd.p;this.drawRect(cmd,win,context)}};this.drawRect=function(cmd,win,context){this.applyStroke(cmd.b,cmd.o,context);switch(cmd.b.sd){case 5:case 0:context.strokeRect(cmd.r.l,cmd.r.t,cmd.r.r-
cmd.r.l,cmd.r.b-cmd.r.t);break;case 1:context.dashRect(cmd.r.l,cmd.r.t,cmd.r.r,cmd.r.b,[8,8]);break;case 2:context.dashRect(cmd.r.l,cmd.r.t,cmd.r.r,cmd.r.b,[8,8,0,8]);break;case 3:context.dashRect(cmd.r.l,cmd.r.t,cmd.r.r,cmd.r.b,[1,8]);break;case 4:context.dashRect(cmd.r.l,cmd.r.t,cmd.r.r,cmd.r.b,[8,8,0,8,0,8]);break}};this.drawLine=function(cmd,win,context){this.applyStroke(cmd.b,cmd.o,context);context.beginPath();context.moveTo(cmd.p1.x,cmd.p1.y);context.lineTo(cmd.p2.x,cmd.p2.y);context.closePath();
context.stroke()};this.fillEllipse=function(cmd,win,context){self.drawEllipse(cmd,win,context,true)};this.drawEllipse=function(cmd,win,context,fill){if(fill&&cmd.b)this.applyBrush(cmd.b,cmd.r,cmd.o,context);else this.applyStroke(cmd.b,cmd.o,context);if(cmd.p)this.applyStroke(cmd.p,cmd.o,context);var x=cmd.r.l,y=cmd.r.t,w=cmd.r.r-cmd.r.l,h=cmd.r.b-cmd.r.t;var kappa=.5522848;ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.beginPath();context.moveTo(x,ym);context.bezierCurveTo(x,ym-
oy,xm-ox,y,xm,y);context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context.closePath();if(fill&&cmd.b)context.fill();if(!fill||cmd.p)context.stroke()};this.intersectRect=function(r1,r2){var r={l:0,r:0,t:0,b:0};r.l=Math.max(r1.l,r2.l);r.t=Math.max(r1.t,r2.t);r.r=Math.min(r1.r,r2.r);r.b=Math.min(r1.b,r2.b);return r};this.fillText=function(cmd,win,context){this.fontWriter.fillText(cmd,win,context)};this.fillTextEx=
function(cmd,win,context){this.fontWriter.fillTextEx(cmd,win,context)};this.fontWriter={self:this,_cache:{},_dummyDiv:null,_maskCanvas:null,_textCanvas:null,_lastCmd:null,setCache:function(cmd){var fk=cmd.idx;var font;if(!this._cache[fk])font=this._cache[fk]={"lh":0,"ch":[]};else font=this._cache[fk];var chars=cmd.keys.split(",");for(k=0;k<chars.length;k++){var c=chars[k].split(":");font.ch[c[0]]={"w":parseFloat(c[1]),"idx":!c[2]?"":c[2]}}},setColor:function(value){this._color=value},getCharFromCache:function(fontKey,
charKey){var ch=this._cache[fontKey].ch[charKey];var item=self.getFromImageCache(ch.idx);var img=item.image.data;return{"img":img,"w":ch.w}},fillTextEx:function(cmd,win,context){context.save();context.beginPath();context.rect(this._lastCmd.r.l,this._lastCmd.r.t,this._lastCmd.r.r-this._lastCmd.r.l,this._lastCmd.r.b-this._lastCmd.r.t);context.clip();if(!this._lastCmd.tm)this.fillTextImg(cmd,win,context);else{this.fillTextFnt(this._lastCmd,win,context);if(typeof cmd.cp!="undefined")this.fillTextFntEx2(cmd,
win,context);else this.fillTextFntEx(cmd,win,context)}context.restore()},fillText:function(cmd,win,context){this._lastCmd=clone(cmd);if(typeof cmd.keys!="undefined")this.setCache(cmd)},fillTextFntEx:function(cmd,win,context){var deltaY=cmd.h/2;var metrics=context.measureText(cmd.t);var width=metrics.width;var fk=this._lastCmd.idx;var _x=cmd.x;if(cmd.w>width)for(var n=0;n<cmd.t.length;n++){_ch=this.getCharFromCache(fk,cmd.t.charCodeAt(n));context.fillText(cmd.t.charAt(n),_x,cmd.y+deltaY);_x+=_ch.w}else context.fillText(cmd.t,
cmd.x,cmd.y+deltaY,cmd.w)},fillTextFntEx2:function(cmd,win,context){var deltaY=cmd.h/2;var metrics=context.measureText(cmd.t);var width=metrics.width;var fk=this._lastCmd.idx;var _endCh;if(cmd.w>width){cmd.cp=typeof cmd.cp!="object"?JSON.parse(cmd.cp):cmd.cp;var chOffset=cmd.x-cmd.cp[0];for(var n=0;n<cmd.t.length;n++){_endCh=n;while(_endCh<cmd.t.length-2){if(cmd.cp[n]!=cmd.cp[_endCh+1])break;_endCh+=1}_ch="";for(var chidx=n;chidx<=_endCh;chidx++)_ch+=cmd.t.charAt(chidx);context.fillText(_ch,cmd.cp[n]+
chOffset,cmd.y+deltaY);n=_endCh}}else context.fillText(cmd.t,cmd.x,cmd.y+deltaY,cmd.w)},fillTextFnt:function(cmd,win,context){var h=cmd.f.s;var style=[];if(cmd.f.st.b)style.push("bold");if(cmd.f.st.i)style.push("italic");if(style.length==0)style="normal";else style=style.join(" ");var fontStyle=style+" "+h+"px "+self.resolveFont(cmd.f.f);context.font=fontStyle;context.fillStyle=self.toRGB(cmd.c,cmd.o);context.textBaseline="middle"},fillTextImg:function(cmd,win,context){var fk=this._lastCmd.idx;var color=
self.toRGB(this._lastCmd.c,this._lastCmd.o);if(!this._textCanvas){this._textCanvas=document.createElement("canvas");this._textCanvasContext=this._textCanvas.getContext("2d")}this._textCanvas.width=this._lastCmd.r.r-this._lastCmd.r.l;this._textCanvas.height=cmd.h;this._textCanvasContext.clearRect(0,0,this._textCanvas.width,this._textCanvas.height);var _x=0;var _y=0;var _ch=null;var text=cmd.t;for(var t=0;t<text.length;t++){_ch=this.getCharFromCache(fk,text.charCodeAt(t));if(_ch.img){this._textCanvasContext.drawImage(_ch.img,
.5+_x<<0,_y);_x+=_ch.w}}var x=cmd.x;var y=cmd.y;this.drawText(context,this._textCanvas,x<<0,y<<0,color||this._color)},drawText:function(context,img,x,y,textColor){if(this._baseColor==textColor)context.drawImage(img,x,y);else{if(!this._maskCanvas){this._maskCanvas=document.createElement("canvas");this._maskCanvas.width=context.canvas.offsetWidth;this._maskCanvas.height=context.canvas.offsetHeight}var ctx=this._maskCanvas.getContext("2d");ctx.save();ctx.clearRect(0,0,this._maskCanvas.width,this._maskCanvas.height);
ctx.beginPath();ctx.rect(0,0,img.width,img.height);ctx.fillStyle=textColor;ctx.fill();ctx.globalCompositeOperation="destination-in";ctx.beginPath();ctx.drawImage(img,0,0);ctx.restore();context.drawImage(this._maskCanvas,x,y)}},_baseColor:self.toRGB(0,1),_color:self.toRGB(0,1)};this.fillPath=function(cmd,win,context){this.drawPath(cmd,win,context,true)};this.drawPath=function(cmd,win,context,fill){if(fill)this.applyBrush(cmd.b,cmd.p.r,cmd.o,context);else this.applyStroke(cmd.b,cmd.o,context);context.beginPath();
for(n=0;n<cmd.p.c;n++){var p=cmd.p.ps[n];var sp,p1,p2;switch(p.k){case 0:sp=p.p;context.moveTo(sp.x,sp.y);break;case 1:context.lineTo(p.p.x,p.p.y);break;case 2:p1=p.p;n++;p=cmd.p.ps[n];p2=p.p;n++;p=cmd.p.ps[n];context.bezierCurveTo(p1.x,p1.y,p2.x,p2.y,p.p.x,p.p.y);break;case 3:context.lineTo(sp.x,sp.y);break}}if(fill)context.fill();else context.stroke()};this.union=function(r1,r2){var r=clone(r1);r.l=Math.min(r1.l,r2.l);r.t=Math.min(r1.t,r2.t);r.r=Math.max(r1.r,r2.r);r.b=Math.max(r1.b,r2.b);return r};
this.excludeClipRect=function(cmd,win,context){context.setTransform(1,0,0,1,0,0);var l=cmd.r.l+lastMatrix.m31;var r=cmd.r.r+lastMatrix.m31;var t=cmd.r.t+lastMatrix.m32;var b=cmd.r.b+lastMatrix.m32;context.beginPath();context.rect(0,0,l,context.canvas.height);context.rect(0,0,context.canvas.width,t);context.rect(0,b,context.canvas.width,context.canvas.height-b);context.rect(r,0,context.canvas.width-r,context.canvas.height);context.closePath();context.clip();context.setTransform(lastMatrix.m11,lastMatrix.m12,
lastMatrix.m21,lastMatrix.m22,lastMatrix.m31,lastMatrix.m32)};this.intersectClipRect=function(cmd,win,context){context.beginPath();context.rect(cmd.r.l,cmd.r.t,cmd.r.r-cmd.r.l,cmd.r.b-cmd.r.t);context.clip()};this.applyClipping=function(context,clipArray){if(clipArray&&clipArray.length>=0){context.beginPath();for(n=0;n<clipArray.length;n++){var r=clipArray[n];if(r.l<0)r.l=0;if(r.t<0)r.t=0;if(r.r>context.canvas.width)r.r=context.canvas.width;if(r.b>context.canvas.height)r.b=context.canvas.height;context.rect(r.l,
r.t,r.r-r.l,r.b-r.t)}context.clip()}};this.setClipRects=function(cmd,win,context){this.applyClipping(context,cmd.cr.slice())};this.beginScene=function(cmd,win,context){if(cmd.cr)this.applyClipping(context,cmd.cr);if(cmd.show)$(self.canvasResizer).hide()};this.endScene=function(cmd,win,context){if(this.clipSaved)context.restore();this.clipSaved=false;if(win.drawBitmapDone)this.events.onServerSceneRender()};this.setMatrix=function(cmd,win,context){context.setTransform(cmd.m.m11,cmd.m.m12,cmd.m.m21,
cmd.m.m22,cmd.m.m31,cmd.m.m32);lastMatrix=clone(cmd.m)};this.saveContext=function(context){context.save();this.contextStack++};this.restoreContext=function(context){context.restore();this.contextStack--};this.processFileCommands=function(){if(fromFile){var canvas=byId("win");if(canvas){var context=canvas.getContext("2d");for(var i=0;i<jdata.length;i++){var cmds=jdata[i];if(!cmds)break;this.processFMXCommands(cmds,canvas,context)}}}else self.processNextScreen()};this.processDialog=function(cmd){if(cmd.d==
"messageDialog"||cmd.d=="inputQuery"||cmd.d=="openFiles"||cmd.d=="saveFiles"||cmd.d=="pageSetup"||cmd.d=="print")this.processSystemDialog(cmd);else self.sendCmd("cmd=dialog&modalResult=1")};this.processSystemDialog=function(cmd,callback){function createButtons(){var buttons=[];if(cmd.buttons==undefined||cmd.buttons=="")buttons.push({"text":helper.dictionary.getValue(WebFMXTMsgDlgBtn[cmd.defaultButton]),"value":cmd.defaultButton,"defaultButton":true});else{var aButtons=cmd.buttons.split(",");for(var b=
0;b<aButtons.length;b++)if(aButtons[b]!="")buttons.push({"text":helper.dictionary.getValue(WebFMXTMsgDlgBtn[aButtons[b]]),"value":aButtons[b],"defaultButton":aButtons[b]==cmd.defaultButton})}return buttons}if(cmd.d=="messageDialog"){var sDlgType=WebFMXTMsgDlgType[cmd.dlgType];createPopup(self,{"dlgType":cmd.d,"draggable":true,"id":"systemDlg","dlgClass":"systemDlg","title":helper.dictionary.getValue(sDlgType),"icon":sDlgType,"message":cmd.msg,"buttons":createButtons(),"action":function(value){self.sendCmd("cmd=dialog&modalResult="+
WebFMXMsgDlgResponse[value])}},self.rdParams.divId)}else if(cmd.d=="openFiles"){var silenceMode=_dragAndDrop.available&&(_dragAndDrop.files||_dragAndDrop.items);var fuForm=byId("_fuForm");self.ftPath=cmd.initdir;var fileTypes="";if(cmd.filter){var filters=cmd.filter.split("\r\n");for(var f=0;f<filters.length;f++){if(filters[f].indexOf("=")==-1)continue;var ff=filters[f].split("=");var exts=ff[1].replace(/;/g,",").split(",");for(var ext=0;ext<exts.length;ext++){if(fileTypes.length>0)fileTypes+=",";
if(exts[ext].indexOf(".")==-1)fileTypes+=exts[ext];else fileTypes+=exts[ext].substr(exts[ext].indexOf("."))}}}if(!fuForm){fuForm=helper.dom.appendJsonElement({"parentElement":document.body,"type":"form","attributes":{"id":"_fuForm","name":"_fuForm","class":"caption","action":"/ft/"+(self.ftPath!=""?self.ftPath+"/":""),"method":"post","enctype":"multipart/form-data","encoding":"multipart/form-data","target":"upload_frame","style":"display:block; width: 0px; height: 0px; border: none; visibility: hidden; position:absolute; top: 0px; left: -10px;"}});
if(isEqIE9){inputFileName=helper.dom.appendJsonElement({"parentElement":fuForm,"type":"input","attributes":{"id":"inputFileName","type":"text"}});inputFileName.onchange=function(event){self.fileUpload.add(this.value);$("#okBtn").removeClass("disabled")}}else{if(fileTypes.length>0)inputFile=helper.dom.appendJsonElement({"parentElement":fuForm,"type":"input","attributes":{"id":"inputFile","type":"file","accept":fileTypes},"content":""});else inputFile=helper.dom.appendJsonElement({"parentElement":fuForm,
"type":"input","attributes":{"id":"inputFile","type":"file"},"content":""});$(inputFile).bind("change",function(event){var files=this.files;if(files)for(var iFile=0;iFile<files.length;iFile++)self.fileUpload.add(files[iFile]);else if(this.value!="")self.fileUpload.add(this.value);$("#okBtn").removeClass("disabled")})}helper.dom.appendJsonElement({"parentElement":document.body,"type":"iframe","attributes":{"id":"upload_frame","name":"upload_frame","src":"","style":"width: 0px; height: 0px; border: none; position:absolute; top: 0px; left: -100px;"}});
self.fileUpload.onClear=function(file){var input=document.getElementById("openFileName");if(input)input.value=""};self.fileUpload.onFileAdd=function(file){var input=document.getElementById("openFileName");if(input)input.value=typeof file.name=="undefined"?file.replace(/C:\\fakepath\\/i,""):file.name};self.fileUpload.init(false)}else{self.fileUpload.clear();if(!isEqIE9)if(fileTypes.length>0)$("#inputFile").attr("accept",fileTypes);else $("#inputFile").removeAttr("accept")}var popupData={"dlgType":cmd.d,
"id":"uploadFile","dlgClass":"systemDlg","draggable":true,"filter":cmd.filter,"multiple":silenceMode||cmd.multiple,"filterIndex":cmd.filterIndex,"silenceMode":silenceMode,"ignoreFiles":typeof cmd.ignoreFiles=="undefined"?"":cmd.ignoreFiles,"files":_dragAndDrop.files,"items":_dragAndDrop.items};if(_dragAndDrop.available){_dragAndDrop.files=null;_dragAndDrop.items=null}function createUploadPopup(){uploadPopup.elem=new Thinfinity.UploadPopup(self,popupData,self.rdParams.divId)}if(uploadPopup.elem&&!uploadPopup.elem.isReady){clearInterval(uploadPopup.intervalId);
var iCount=0;uploadPopup.intervalId=setInterval(function(){if(uploadPopup.elem.isReady||iCount>uploadPopup.max){clearInterval(uploadPopup.intervalId);createUploadPopup()}iCount++},150)}else createUploadPopup()}else if(cmd.d=="pageSetup"){var result=jQuery.extend(true,{},cmd);cmd.buttons="2,3";cmd.defaultButton="2";createPopup(self,{"id":"pageSetupDlg","dlgType":cmd.d,"dlgClass":"systemDlg","draggable":true,"title":helper.dictionary.getValue("pageSetup"),"buttons":createButtons(),"values":{"margin":cmd.margin,
"minMargin":cmd.minMargin,"paperSize":cmd.paperSize,"units":cmd.units},"action":function(value){if(value!=3){result.margin.top=parseInt($("#printMarginTop").val()*1E3);result.margin.bottom=parseInt($("#printMarginBottom").val()*1E3);result.margin.left=parseInt($("#printMarginLeft").val()*1E3);result.margin.right=parseInt($("#printMarginRight").val()*1E3);var p=$("#printPaperSize").val();if($("#measureUnits").val()==1){result.paperSize.x=constPrinterSheets[p].mWidth;result.paperSize.y=constPrinterSheets[p].mHeight}else{result.paperSize.x=
constPrinterSheets[p].iWidth;result.paperSize.y=constPrinterSheets[p].iHeight}result.units=$("#measureUnits").val()*1;result.orientation=$("#prnOLandscape")[0].checked?1:0;if(result.orientation==1){var aux=result.paperSize.x;result.paperSize.x=result.paperSize.y;result.paperSize.y=aux}}self.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[value]+"&value="+encodeURIComponent(JSON.stringify(result)))}},self.rdParams.divId)}else if(cmd.d=="print"){var result=jQuery.extend(true,{},cmd);cmd.buttons=
"2,3";cmd.defaultButton="2";createPopup(self,{"id":"printDlg","dlgType":cmd.d,"draggable":true,"dlgClass":"systemDlg","title":helper.dictionary.getValue("print"),"buttons":createButtons(),"values":{"printRange":cmd.printRange,"minPage":cmd.minPage,"maxPage":cmd.maxPage,"fromPage":cmd.fromPage,"toPage":cmd.toPage},"action":function(value){if(value!=3)if($("#printRangeAll")[0].checked)result.printRange=0;else if($("#printRangeSelection")[0].checked)result.printRange=1;else if($("#printRangeRange")[0].checked){result.printRange=
2;result.fromPage=Math.min(cmd.maxPage,Math.max(cmd.minPage,parseInt($("#printFromPage").val())));result.toPage=Math.min(cmd.maxPage,Math.max(cmd.minPage,parseInt($("#printToPage").val())))}self.sendCmd("cmd=dialog&modalResult="+WebFMXMsgDlgResponse[value]+"&value="+encodeURIComponent(JSON.stringify(result)))}},self.rdParams.divId)}else{cmd.buttons="2,3";cmd.defaultButton="2";if(cmd.d=="saveFiles"){cmd.prompts=["Filename"];cmd.values=[cmd.filename||""]}var popupData={"dlgType":cmd.d,"id":"saveFile",
"dlgClass":"systemDlg","draggable":true,"filter":cmd.filter,"values":cmd.values,"defaultExt":cmd.defaultExt,"title":cmd.title,"filterIndex":cmd.filterIndex};savePopup=new Thinfinity.SavePopup(self,popupData,self.rdParams.divId)}};this.processCommand=function(cmds,cmd,param,win,context){switch(cmd){case 0:self.beginScene(param,win,context);break;case 1:self.endScene(param,win,context);break;case 2:self.setSize(param,win,context);break;case 3:self.fillRect(param,win,context);break;case 4:self.fillPath(param,
win,context);break;case 5:self.fillEllipse(param,win,context);break;case 6:self.drawBitmap(param,win,context);break;case 7:self.drawLine(param,win,context);break;case 8:self.drawRect(param,win,context);break;case 9:self.drawPath(param,win,context);break;case 10:self.drawEllipse(param,win,context);break;case 11:self.clear(param,win,context);break;case 12:self.clearRect(param,win,context);break;case 13:self.intersectClipRect(param,win,context);break;case 14:self.excludeClipRect(param,win,context);break;
case 15:self.setMatrix(param,win,context);break;case 16:break;case 17:self.fillText(param,win,context);break;case 18:self.loadImage(param,cmds,win,context);break;case 19:self.saveContext(context);break;case 20:self.restoreContext(context);break;case 21:self.fillTextEx(param,win,context);break;case 22:self.setClipRects(param,win,context);break;case 23:self.showCaret(param,win,context);break;case 24:self.hideCaret(param,win,context);break;case 25:self.roundRect(param,win,context);break;case 26:self.screenBlt(param,
win,context);break;case 27:self.dragRect(param,win,context);break;case 28:ShowStdKbd();break;default:logDebug("not found: "+JSON.stringify(cmd))}};this.processFMXCommands=function(cmds,win,context){try{if(cmds.cc)self.clearCmdCache(win);if(cmds.sc)for(var n=0;n<cmds.sc.length;n++){var cmd=cmds.sc[n];if(cmds.idx&&cmdCache["w"+win.hwnd]===undefined)self.clearCmdCache(win);if(cmds.idx)cmdCache["w"+win.hwnd][cmd.z]=cmd;else this.processCommand(cmds,cmd.cmd,cmd,win,context)}if(cmds.wf)self.addFonts(cmds.wf);
if(cmds.idx){self.saveContext(context);var idxArray=cmds.idx.split(",");for(var i=0;i<idxArray.length;i++){var idx=parseInt(idxArray[i],10);var cmd=cmdCache["w"+win.hwnd][idx];try{this.processCommand(cmds,cmd.cmd,cmd,win,context)}catch(er){}}while(self.contextStack>0)self.restoreContext(context)}if(cmds.d)self.processDialog(cmds)}catch(e){}};this.processFMXCommandStart=function(cmds,win,context){self.nextCmdIndex=0;self.processFMXCommands(cmds,win,context)};this.getWindowBorder=function(win,canvas){if(canvas.borderDiv)return canvas.borderDiv;
else return this.buildWindowBorder(win,canvas)};this.toggleMaximize=function(btn,windowState){if(windowState==0){btn.removeClass("restore");btn.addClass("maximize")}else{btn.removeClass("maximize");btn.addClass("restore")}};this.getDivButtonsCoords=function(buttons){var coords={"t":999999,"l":999999,"r":0,"b":0};for(var c=TITLEBAR_MINIMIZE_BUTTON;c<=TITLEBAR_CLOSE_BUTTON;c++)if(buttons[c].rect.b||buttons[c].rect.r||buttons[c].rect.t||buttons[c].rect.l){if(buttons[c].rect.t<coords.t)coords.t=buttons[c].rect.t;
if(buttons[c].rect.l<coords.l)coords.l=buttons[c].rect.l;if(buttons[c].rect.b>coords.b)coords.b=buttons[c].rect.b;if(buttons[c].rect.r>coords.r)coords.r=buttons[c].rect.r}return coords};this.divTitlebarButtonsStyle=function(toShow,coords,z){var style=["display:",toShow||false?"block":"none",";"];if(typeof coords!="undefined"){style.push(["top:",coords.t,"px;"].join(""));style.push(["left:",coords.l,"px;"].join(""));style.push(["height:",coords.b-coords.t,"px;"].join(""));style.push(["width:",coords.r-
coords.l,"px;"].join(""));if(z!=-1)style.push(["z-index:",z,";"].join(""))}return style.join("")};this.titlebarButtonStyle=function(toShow,coords,box){if(typeof box=="undefined")box={"t":0,"b":0,"r":0,"l":0};var style=["display:","blocked",";"];if(typeof coords!="undefined"){style.push(["top:",coords.t-box.t,"px;"].join(""));style.push(["left:",coords.l-box.l,"px;"].join(""));style.push(["height:",coords.b-coords.t,"px;"].join(""));style.push(["width:",coords.r-coords.l,"px;"].join(""))}if(coords.r-
coords.l===0||coords.b-coords.t===0)style.push(["display:none"]);return style.join("")};this.setButtonEvents=function(id,callbackClick,method){$("#"+id).off("click");if(method=="on")$("#"+id).on("click",function(e){callbackClick();e.stopPropagation()})};this.setButtonEvent=function(eventName,id,callback,method){$("#"+id).off(eventName);if(method=="on")$("#"+id).on(eventName,function(e){callback(e);e.stopPropagation()})};this.buildWindowBorder=function(win,canvas){if(canvas.tagName=="CANVAS"){div=
document.createElement("div");div.style.position="absolute";div.style.zIndex=TVNC.baseZIndex+win.zidx*10+1;div.className="canvasBorder";div.id=productId+"_canvasborder"+win.hwnd;div.style.borderWidth=win.borderWidth+"px";div.style.display="none";this.vncdiv.appendChild(div)}else{div=canvas;canvas.style.padding=win.borderWidth+"px";canvas.canvas.style.margin=win.borderWidth+"px"}canvas.borderDiv=div;canvas.captionHeight=win.captionHeight;canvas.borderWidth=win.borderWidth;if(win.borderStyle>0){var ch=
win.captionHeight>0?win.captionHeight:31;var bw=win.borderWidth>0?win.borderWidth:8;var captionDiv=helper.dom.appendJsonElement({"parentElement":div,"type":"div","attributes":{"id":"captionDiv"+win.hwnd,"class":"caption","style":"z-index:0;height:"+ch+"px; line-height:"+ch+"px"}});var box=self.getDivButtonsCoords(win.titlebarInfo.buttons);var boxButtonVisible=win.borderIcons.help||win.borderIcons.minimize||win.borderIcons.maximize||win.borderIcons.systemMenu;if(typeof win.borderIcons.icon=="undefined")win.borderIcons.icon=
true;var btnsCont=helper.dom.appendJsonElement({"parentElement":div,"type":"div","attributes":{"id":"btns"+win.hwnd,"class":"buttons","style":"z-index:2;"+self.divTitlebarButtonsStyle(boxButtonVisible,box,2)}});var helpBtn=helper.dom.appendJsonElement({"parentElement":btnsCont,"type":"div","attributes":{"id":"helpBtn"+win.hwnd,"class":"help borderButton","style":self.titlebarButtonStyle(win.borderIcons.help,win.titlebarInfo.buttons[TITLEBAR_HELP_BUTTON].rect,box),"data":{"hwnd":win.hwnd,"border":BORDER_ACTION_HELP},
"switchMouseCursor":false,"handler":false},"content":"&nbsp;"});var minBtn=helper.dom.appendJsonElement({"parentElement":btnsCont,"type":"div","attributes":{"id":"minBtn"+win.hwnd,"class":"minimize borderButton","style":self.titlebarButtonStyle(win.borderIcons.minimize,win.titlebarInfo.buttons[TITLEBAR_MINIMIZE_BUTTON].rect,box),"data":{"hwnd":win.hwnd,"border":BORDER_ACTION_MINIMIZE},"switchMouseCursor":false,"handler":false},"content":"&nbsp;"});var maxBtn=helper.dom.appendJsonElement({"parentElement":btnsCont,
"type":"div","attributes":{"id":"maxBtn"+win.hwnd,"class":"maximize borderButton","style":self.titlebarButtonStyle(win.borderIcons.maximize,win.titlebarInfo.buttons[TITLEBAR_MAXIMIZE_BUTTON].rect,box),"data":{"hwnd":win.hwnd,"border":BORDER_ACTION_MAXIMIZE},"switchMouseCursor":false,"handler":false},"content":"&nbsp;"});var closeBtn=helper.dom.appendJsonElement({"parentElement":btnsCont,"type":"div","attributes":{"id":"closeBtn"+win.hwnd,"class":"close borderButton","style":self.titlebarButtonStyle(win.borderIcons.systemMenu,
win.titlebarInfo.buttons[TITLEBAR_CLOSE_BUTTON].rect,box),"data":{"hwnd":win.hwnd,"border":BORDER_ACTION_CLOSE},"switchMouseCursor":false,"handler":false},"content":"&nbsp;"});var iconBtn=helper.dom.appendJsonElement({"parentElement":captionDiv,"type":"div","attributes":{"id":"iconBtn"+win.hwnd,"class":"icon","style":self.titlebarButtonStyle(win.borderIcons.icon,{"t":0,"r":16+0,"l":0,"b":16+0},{"t":0,"r":0,"l":0,"b":0})+";"+(!win.borderIcons.icon?"display:none":""),"switchMouseCursor":false}});var formIcon=
win.icon?"data:image/png;base64,"+win.icon:this.appIconSrc||"images/icon.png";helper.dom.appendJsonElement({"parentElement":iconBtn,"type":"img","attributes":{"src":formIcon},"events":{"dblclick":function(){self.sendBtnClick(win.hwnd,BORDER_ACTION_CLOSE)}}});var title=helper.dom.appendJsonElement({"parentElement":captionDiv,"type":"div","attributes":{"id":"title"+win.hwnd,"class":"title","hwndTitle":win.title,"switchMouseCursor":false},"content":win.caption});_toolBarButtons[win.hwnd]={"help":helpBtn,
"close":closeBtn,"maximize":maxBtn,"minimize":minBtn,"icon":iconBtn,"title":title,"container":btnsCont}}return div};this.checkCaptionButtons=function(hwnd,icons){var b;function setVisible(buttonId,isVisible){if(typeof isVisible=="undefined")isVisible=true;b=byId(buttonId);if(b)b.style.display=isVisible?"inline-block":"none"}setVisible("minBtn"+hwnd,icons.minimize);setVisible("maxBtn"+hwnd,icons.maximize);setVisible("helpBtn"+hwnd,icons.help);setVisible("closeBtn"+hwnd,icons.systemMenu);setVisible("iconBtn"+
hwnd,icons.icon)};function toolbarButtonClick(e){helper.console.log("toolbarButtonClick",arguments);e.stopPropagation();e.preventDefault();var data=(e.target||e.srcElement)["data"];self.sendBtnClick(data.hwnd,data.border)}function toolbarButtonMouseUp(e){e.stopPropagation();self.onTouchMove(e);self.onTouchEnd(e)}this.updateTitlebar=function(win){if(typeof win.caption!="undefined"&&typeof win.captionHeight!="undefined"&&win.captionHeight>0){var capDiv=byId("captionDiv"+win.hwnd);if(capDiv){capDiv.style.height=
win.captionHeight+"px";capDiv.style.lineHeight=win.captionHeight+"px"}if(_toolBarButtons&&_toolBarButtons[win.hwnd])if(_toolBarButtons[win.hwnd].title){_toolBarButtons[win.hwnd].title.innerHTML=win.caption;_toolBarButtons[win.hwnd].title.setAttribute("hwndTitle",win.title)}}if(_toolBarButtons&&_toolBarButtons[win.hwnd]){var tb_hwnd=_toolBarButtons[win.hwnd];if(typeof win.borderIcons!="undefined"&&typeof win.titlebarInfo!="undefined"){var boxButtonVisible=win.borderIcons.help||win.borderIcons.minimize||
win.borderIcons.maximize||win.borderIcons.systemMenu;if(!boxButtonVisible)tb_hwnd.container.style.display="none";else{var box=self.getDivButtonsCoords(win.titlebarInfo.buttons);tb_hwnd.container.style.cssText=self.divTitlebarButtonsStyle(boxButtonVisible,box,2);if(tb_hwnd.title){tb_hwnd.title.style.marginTop=win.titlebarInfo.buttons[TITLEBAR_CAPTION_TEXT].rect.t/2+"px";tb_hwnd.title.style.marginLeft=win.titlebarInfo.buttons[TITLEBAR_CAPTION_TEXT].rect.l+"px";tb_hwnd.title.style.width=win.titlebarInfo.buttons[TITLEBAR_CAPTION_TEXT].rect.r-
win.titlebarInfo.buttons[TITLEBAR_CAPTION_TEXT].rect.l+"px"}if(tb_hwnd.icon){tb_hwnd.icon.style.marginLeft=win.titlebarInfo.buttons[TITLEBAR_ICON].rect.l+"px";tb_hwnd.icon.style.marginTop=win.titlebarInfo.buttons[TITLEBAR_ICON].rect.t+(win.titlebarInfo.buttons[TITLEBAR_ICON].rect.b-win.titlebarInfo.buttons[TITLEBAR_ICON].rect.t-16)/2+"px"}tb_hwnd.help.style.cssText=self.titlebarButtonStyle(win.borderIcons.help,win.titlebarInfo.buttons[TITLEBAR_HELP_BUTTON].rect,box);tb_hwnd.minimize.style.cssText=
self.titlebarButtonStyle(win.borderIcons.minimize,win.titlebarInfo.buttons[TITLEBAR_MINIMIZE_BUTTON].rect,box);tb_hwnd.maximize.style.cssText=self.titlebarButtonStyle(win.borderIcons.maximize,win.titlebarInfo.buttons[TITLEBAR_MAXIMIZE_BUTTON].rect,box);tb_hwnd.close.style.cssText=self.titlebarButtonStyle(win.borderIcons.systemMenu,win.titlebarInfo.buttons[TITLEBAR_CLOSE_BUTTON].rect,box);if(!win.borderIcons.minimize){helper.style.replace(tb_hwnd.minimize,"minimize","minimizeDisabled disabled");helper.dom.removeEvent(tb_hwnd.minimize,
"click",toolbarButtonClick);if(agentInfo.isMobile)helper.dom.removeEvent(tb_hwnd.minimize,"mouseup",toolbarButtonMouseUp);tb_hwnd.minimize.handler=false}else{helper.style.replace(tb_hwnd.minimize,"minimizeDisabled disabled","minimize");if(!tb_hwnd.minimize.handler){helper.dom.addEvent(tb_hwnd.minimize,"click",toolbarButtonClick,false);if(agentInfo.isMobile)helper.dom.addEvent(tb_hwnd.minimize,"mouseup",toolbarButtonMouseUp,false);tb_hwnd.minimize.handler=true}}if(!win.borderIcons.maximize){helper.style.replace(tb_hwnd.maximize,
"maximize","maximizeDisabled disabled");helper.dom.removeEvent(tb_hwnd.maximize,"click",toolbarButtonClick);if(agentInfo.isMobile)helper.dom.removeEvent(tb_hwnd.maximize,"mouseup",toolbarButtonMouseUp);tb_hwnd.maximize.handler=false}else{helper.style.replace(tb_hwnd.maximize,"maximizeDisabled disabled","minimize");if(!tb_hwnd.maximize.handler){helper.dom.addEvent(tb_hwnd.maximize,"click",toolbarButtonClick,false);if(agentInfo.isMobile)helper.dom.addEvent(tb_hwnd.maximize,"mouseup",toolbarButtonMouseUp,
false);tb_hwnd.maximize.handler=true}}if(win.borderIcons.help==false){helper.style.replace(tb_hwnd.help,"help","helpDisabled disabled");helper.dom.removeEvent(tb_hwnd.help,"click",toolbarButtonClick);if(agentInfo.isMobile)helper.dom.removeEvent(tb_hwnd.help,"mouseup",toolbarButtonMouseUp);tb_hwnd.help.handler=false}else{helper.style.replace(tb_hwnd.help,"helpDisabled disabled","help");if(!tb_hwnd.help.handler){!agentInfo.isMobile?helper.dom.addEvent(tb_hwnd.help,"click",toolbarButtonClick,false):
helper.dom.addEvent(tb_hwnd.help,"mouseup",toolbarButtonMouseUp,false);tb_hwnd.help.handler=true}}if((win.titlebarInfo.buttons[TITLEBAR_CLOSE_BUTTON].state&32769)!=0){helper.style.replace(tb_hwnd.close,"close","closeDisabled disabled");helper.dom.removeEvent(tb_hwnd.close,"click",toolbarButtonClick);if(agentInfo.isMobile)helper.dom.removeEvent(tb_hwnd.close,"mouseup",toolbarButtonMouseUp);tb_hwnd.close.handler=false}else{helper.style.replace(tb_hwnd.close,"closeDisabled disabled","close");if(!tb_hwnd.close.handler){helper.dom.addEvent(tb_hwnd.close,
"click",toolbarButtonClick,false);if(agentInfo.isMobile)helper.dom.addEvent(tb_hwnd.close,"mouseup",toolbarButtonMouseUp,false);tb_hwnd.close.handler=true}}}if(win.borderIcons.icon)if(tb_hwnd.icon)tb_hwnd.icon.style.display="block"}else if(typeof win.borderIcons!="undefined")self.checkCaptionButtons(win.hwnd,win.borderIcons);tb_hwnd=null}};this.externalTouchStart=function(e){var elem=document.elementFromPoint(e.pageX,e.pageY);return!(elem==$(".closeBtn")[0]||elem==$(".maximize")[0]||elem==$(".minimize")[0]||
elem==$(".help")[0])};this.externalTouchMove=function(e){var elem=document.elementFromPoint(e.pageX,e.pageY);return!(elem==$(".closeBtn")[0]||elem==$(".maximize")[0]||elem==$(".minimize")[0]||elem==$(".help")[0])};this.externalTouchEnd=function(e){var elem=document.elementFromPoint(e.pageX,e.pageY);return!(elem==$(".closeBtn")[0]||elem==$(".maximize")[0]||elem==$(".minimize")[0]||elem==$(".help")[0])};this.sendBtnClick=function(hwnd,action){this.sendCmd("cmd=window&hwnd="+hwnd+"&action="+action)};
function processLoadFileQueue(){if(_loadFilesQueue.length>0&&!_proccesingFile){_proccesingFile=true;var file=_loadFilesQueue.shift();helper.dom.loadScript(file.src,function(){_proccesingFile=false;processLoadFileQueue()},function(){_proccesingFile=false;processLoadFileQueue()})}}if(typeof this.registerOOBCmd!="undefined"){var overrideCursor=!agentInfo.isMobile&&!agentInfo.isMSIE&&productId!="thinzs"?true:false;if(overrideCursor&&helper.object.existsPath(self,"clientSettings.OverrideCursor"))overrideCursor=
self.clientSettings.OverrideCursor;Object.defineProperty(self,"isRunningPlayback",{"enumerable":false,"configurable":false,"get":function(){return _isRunningPlayback},"set":function(value){if(value!=_isRunningPlayback){if(value)self.overrideCursor=_vui.clientSettings.OverrideCursor=false;else self.overrideCursor=_vui.clientSettings.OverrideCursor=overrideCursor;_isRunningPlayback=value;self.rcParams.playsession=value}}});var isJsRODefined=false;try{if(Thinfinity["JsRO"])isJsRODefined=true}catch(error){}if(_dragAndDrop.available){var x=
0;var y=0;var dragX=0;var dragY=0;var activeElem=null;var caption=null;function getDataTransferItems(dt){var result="";if(dt&&dt.items)for(var i=0;i<dt.items.length;i++){if(i>0)result+="|";result+=dt.items[i].type}return result}function getDataTransferFiles(dt){var result="";var item=null;if(dt&&dt.files)for(var i=0;i<dt.files.length;i++){if(i>0)result+="|";result+=dt.files[i].name}return result}function getDataTransferSizes(dt){var result="";var item=null;if(dt&&dt.files)for(var i=0;i<dt.files.length;i++){if(i>
0)result+="|";result+=dt.files[i].size}return result}function getFilesAndDirs(dt,finish){var dirScans=0;var dirScansDone=0;var queuedFiles=0;var addedFiles=0;var dataItems=new Array;var processFileEntry=function(item,dirPath){if(item.isDirectory){var directoryReader=item.createReader();readDirectory(directoryReader,dirPath+item.name+"/")}else{queuedFiles++;item.file(function(file){dataItems.push({"fullpath":dirPath+file.name,"file":file});addedFiles++},function(){addedFiles++})}};var readDirectory=
function(dirReader,dirPath){dirScans++;dirReader.readEntries(function(entries){entries.forEach(function(entry){processFileEntry(entry,dirPath)});if(entries.length>0)readDirectory(dirReader,dirPath);dirScansDone++})};if(dt&&dt.items)for(var i=0;i<dt.items.length;i++){var item=null;if(typeof dt.items[i].webkitGetAsEntry!="undefined")item=dt.items[i].webkitGetAsEntry();else if(typeof dt.items[i].getAsEntry!="undefined")item=dt.items[i].getAsEntry();if(item)processFileEntry(item,"")}var finishInterval=
setInterval(function(){if(dirScansDone>=dirScans&&addedFiles>=queuedFiles){clearInterval(finishInterval);finish(dataItems)}},20)}function updatePosition(e){if(!activeElem){activeElem=document.body.querySelector("div.dwmwindow.active");if(activeElem)caption=activeElem.querySelector("div.caption");else caption=null}x=e.pageX;y=e.pageY;var position=self.findPos(self.vncContainer);x=Math.round((x-position[0])/self.scale)+self.rcParams.viewLeft;y=Math.round((y-position[1])/self.scale)+self.rcParams.viewTop;
dragX=x;dragY=y;if(activeElem){x-=activeElem.offsetLeft;y-=activeElem.offsetTop;if(caption)y-=caption.offsetHeight}}function sendDragAndDropEvent(e,action){updatePosition(e);if(action=="cancel"){self.sendCmd("cmd=drag&x="+e.clientX+"&y="+e.clientY+"&action=cancel&filenames=");self.sendCmd("cmd=filedrag&x="+dragX+"&y="+dragY+"&action=cancel&names=")}else{var files="";var sizes="";if(action=="drop")getFilesAndDirs(e.dataTransfer,function(dataItems){if(dataItems.length>0){for(var i=0;i<dataItems.length;i++){if(i>
0){files+="|";sizes+="|"}files+=dataItems[i].fullpath;sizes+=dataItems[i].file.size}_dragAndDrop.files=null;_dragAndDrop.items=dataItems}else{_dragAndDrop.files=e.dataTransfer.files;_dragAndDrop.items=null;files=getDataTransferItems(e.dataTransfer);sizes=getDataTransferSizes(e.dataTransfer)}self.sendCmd("cmd=drag&x="+x+"&y="+y+"&action=drop&filenames="+encodeURIComponent(files.replace(/\|/g,";")));self.sendCmd("cmd=filedrop&x="+dragX+"&y="+dragY+"&names="+encodeURIComponent(files)+"&sizes="+sizes)});
else{files=getDataTransferItems(e.dataTransfer);self.sendCmd("cmd=drag&x="+x+"&y="+y+"&action="+action+"&filenames="+encodeURIComponent(files.replace(/\|/g,";")));self.sendCmd("cmd=filedrag&x="+dragX+"&y="+dragY+"&action="+action+"&names="+encodeURIComponent(files))}}}if(!_dragAndDrop.initialized){var elem=document.body;if(elem){helper.dom.addEvent(elem,"dragenter",function(e){e.preventDefault();sendDragAndDropEvent(e,"start");return true});helper.dom.addEvent(elem,"dragover",function(e){e.preventDefault();
sendDragAndDropEvent(e,"over");return true});helper.dom.addEvent(elem,"drop",function(e){e.preventDefault();e.stopPropagation();sendDragAndDropEvent(e,"drop");activeElem=null;caption=null;return true});helper.dom.addEvent(elem,"dragleave",function(e){e.preventDefault();sendDragAndDropEvent(e,"cancel");activeElem=null;caption=null;return true})}_dragAndDrop.initialized=true}}if(isJsRODefined){var inputCallback=function(fn){self.registerOOBCmd("rapp",function(obj){fn(obj)});self.registerOOBCmd("apiMsg",
function(obj){if(!fn(obj))self.events.onReceiveMessage(obj&&obj.msg?obj.msg:"")});self.registerOOBCmd("clientSettings",function(obj){fn(obj)})};var outputCallback=null;if(productId==="virtualui")outputCallback=function(json){self.sendPostAjaxCmd("id="+encodeURIComponent(self.rcParams.id),json)};else outputCallback=function(cmd){self.sendCmd(cmd)};this.remoteApp=new Thinfinity.JsRO({"mode":"HOST","output":outputCallback,"input":inputCallback,"clientSettings":self.rcParams,"outputMode":productId=="virtualui"?
"json":"cmd"})}else this.remoteApp={"_init":function(){self.registerOOBCmd("rapp",function(obj){if(typeof self.remoteApp.events=="undefined"||self.remoteApp.events.onRemoteAppMessage==null)$(window).trigger("remoteAppMessage",[obj["type"],obj["path"],obj["data"]]);else self.remoteApp.events.onRemoteAppMessage(obj["type"],obj["path"],obj["data"])});self.registerOOBCmd("apiMsg",function(obj){if(typeof self.remoteApp.events=="undefined"||self.remoteApp.events.onReceiveMessage==null)$(window).trigger("receiveMessage",
[obj.msg]);else self.remoteApp.events.onReceiveMessage(obj.msg)})}(),"events":{"onReceiveMessage":null,"onRemoteAppMessage":null},"sendMessage":function(message){var query="cmd=apiMsg"+"&msg="+escape(message);self.sendCmd(query)}};self.registerOOBCmd("clientSettings",function(obj){switch(true){case typeof obj["CursorVisible"]!="undefined":if(_vui.originalClientSettings["CursorVisible"]==null)_vui.clientSettings["CursorVisible"]=obj.CursorVisible;logDebug("clientSettingsChanged: clientSettings.CursorVisible = "+
_vui.clientSettings["CursorVisible"]);TVNC.rcParams.cursorVisible=self.rdParams.cursorVisible=_vui.clientSettings["CursorVisible"];self[_vui.clientSettings["CursorVisible"]?"showCursor":"hideCursor"]();break;case typeof obj["MouseMoveGestureStyle"]!="undefined":if(_vui.originalClientSettings["MouseMoveGestureStyle"]==null)_vui.clientSettings["MouseMoveGestureStyle"]=obj.MouseMoveGestureStyle!="relative";logDebug("clientSettingsChanged: clientSettings.MouseMoveGestureStyle = "+_vui.clientSettings["MouseMoveGestureStyle"]);
TVNC.rcParams.relativeTouch=self.rdParams.relativeTouch=!_vui.clientSettings["MouseMoveGestureStyle"];if(typeof setRelativeTouch!="undefined")setRelativeTouch(self.rdParams.relativeTouch);break;case typeof obj["MouseMoveGestureAction"]!="undefined":if(_vui.originalClientSettings["MouseMoveGestureAction"]==null)_vui.clientSettings["MouseMoveGestureAction"]=obj.MouseMoveGestureAction=="wheel";logDebug("clientSettingsChanged: clientSettings.MouseMoveGestureAction = "+_vui.clientSettings["MouseMoveGestureAction"]);
TVNC.rcParams.moveToWheel=self.rdParams.moveToWheel=_vui.clientSettings["MouseMoveGestureAction"];break;case typeof obj["MouseWheelStepValue"]!="undefined":if(_vui.originalClientSettings["MouseWheelStepValue"]==null)_vui.clientSettings["MouseWheelStepValue"]=obj.MouseWheelStepValue;logDebug("clientSettingsChanged: clientSettings.MouseWheelStepValue = "+_vui.clientSettings["MouseWheelStepValue"]);TVNC.rcParams.mouseWheelStepValue=self.rdParams.mouseWheelStepValue=_vui.clientSettings["MouseWheelStepValue"];
break;case typeof obj["MouseWheelDirection"]!="undefined":if(_vui.originalClientSettings["MouseWheelDirection"]==null)_vui.clientSettings["MouseWheelDirection"]=obj.MouseWheelDirection;logDebug("clientSettingsChanged: clientSettings.MouseWheelDirection = "+_vui.clientSettings["MouseWheelDirection"]);TVNC.rcParams.mouseWheelDirection=self.rdParams.mouseWheelDirection=_vui.clientSettings["MouseWheelDirection"];break;case typeof obj["MousePressAsRightButton"]!="undefined":if(_vui.originalClientSettings["MousePressAsRightButton"]==
null)_vui.clientSettings["MousePressAsRightButton"]=obj.MousePressAsRightButton;logDebug("clientSettingsChanged: clientSettings.MousePressAsRightButton = "+_vui.clientSettings["MousePressAsRightButton"]);TVNC.rcParams.mousePressAsRightButton=self.rdParams.mousePressAsRightButton=_vui.clientSettings["MousePressAsRightButton"];break;case typeof obj.macro!="undefined":if(!_macro){helper.console.warning(WebFMXconsts.macroClassNotAvailable,arguments);return}_macro.initialize({"owner":self,"params":obj.macro});
break}});self.registerOOBCmd("loadfile",function(obj){for(var x in obj.files){var file=obj.files[x];if(file.src)file.src=TVNC.baseUrl+file.src;if(file.type==="script"){_loadFilesQueue.push({"type":"text/javascript","src":file.src});processLoadFileQueue()}else if(file.type=="html")helper.dom.appendJsonElement({"parentElement":document.head,"type":"link","attributes":{"rel":"import","href":file.src}})}});self.registerOOBCmd("webcomp",function(obj){var wndParent=obj["wndParent"];var id=obj["id"];var hookMouse=
obj["hookMouse"];var comp=byId(id);var parent=null;if(!comp)parent=byId(productId+"_canvas_"+wndParent);if(parent)if(obj.html){var comp=document.createElement("div");comp.innerHTML=obj.html;comp.id=id;if(comp.style.cursor=="")comp.style.cursor="default";if(comp.style.position=="")comp.style.position="absolute";if(comp.style.zIndex=="")comp.style.zIndex=2;parent.insertBefore(comp,parent.childNodes[0]||null)}else{var tag=obj.tag;if(tag=="")tag="<div>";comp=document.createElement(tag);comp.id=id;if(comp.style.cursor==
"")comp.style.cursor="default";comp.style.position="relative";comp.style.borderWidth="0px";comp.style.display="block";comp.style.zIndex=2;parent.appendChild(comp)}if(comp){var parent=byId(productId+"_canvas_"+wndParent);if(parent&&parent!=comp.parentElement)parent.appendChild(comp);comp.style.left=obj["r"].l+"px";comp.style.top=obj["r"].t+"px";comp.style.width=obj["r"].r-obj["r"].l+"px";comp.style.height=obj["r"].b-obj["r"].t+"px";if(!comp.hookMouse&&(hookMouse===true||hookMouse===undefined)&&(!agentInfo.isMobile||
!self.rcParams.relativeTouch)){comp.hookMouse=true;helper.style.add(comp,"__uselocalmouse__");comp["originalRemotePointer"]=self.rcParams.remotePointer;if(agentInfo.isMobile&&agentInfo.isTouch){helper.dom.addEvent(comp,"touchstart",self.webComp_Enter);helper.dom.addEvent(comp,"touchleave",self.webComp_Leave)}else{helper.dom.addEvent(comp,"mouseenter",self.webComp_Enter);helper.dom.addEvent(comp,"mouseleave",self.webComp_Leave)}}else if(hookMouse===false){if(agentInfo.isMobile&&agentInfo.isTouch){helper.dom.removeEvent(comp,
"touchstart",self.webComp_Enter);helper.dom.removeEvent(comp,"touchleave",self.webComp_Leave)}else{helper.dom.removeEvent(comp,"mouseenter",self.webComp_Enter);helper.dom.removeEvent(comp,"mouseleave",self.webComp_Leave)}helper.style.removeAll(comp,"__uselocalmouse__");comp.hookMouse=false}}});self.registerOOBCmd("repl",function(jdata){self.rdParams.events.onRepl(jdata?jdata:{})})}this.webComp_Enter=function(e){self.rcParams.remotePointer=false;self.hideCursor()};this.webComp_Leave=function(e){self.rcParams.remotePointer=
e&&e.srcElement&&typeof e.srcElement["originalRemotePointer"]!="undefined"?e.srcElement["originalRemotePointer"]:true;self.showCursor()};this.showCursor=function(){if(!self.overrideCursor&&self.cursorCanvas&&_vui.clientSettings.CursorVisible){self.cursorCanvas.style.visibility="visible";if(self.cursorCanvas.style.display==="none")self.cursorCanvas.style.display="block"}};this.hideCursor=function(){if(!self.overrideCursor&&self.cursorCanvas&&!self.rcParams.playsession)if(_vui.clientSettings.CursorVisible)self.cursorCanvas.style.visibility=
"hidden";else self.cursorCanvas.style.display="none"};this.addFonts=function(fontList){if(this.fontList)return;function tryFont(fontName){var canvas=document.createElement("canvas");var context=canvas.getContext("2d");var text="abcdefghijklmnopqrstuvwxyz0123456789";context.font="normal 16px '"+fontName+"'";context.fillText(text,0,0);context.font="bold 16px '"+fontName+"'";context.fillText(text,0,0);context.font="italic 16px '"+fontName+"'";context.fillText(text,0,0);context.font="italic bold 16px '"+
fontName+"'";context.fillText(text,0,0);canvas=null}function fontExists(fontName){var canvas=document.createElement("canvas");var context=canvas.getContext("2d");var text="abcdefghijklmnopqrstuvwxyz0123456789";context.font="72px monospace";var baselineSize=context.measureText(text).width;context.font="72px '"+fontName+"', monospace";var newSize=context.measureText(text).width;canvas=null;if(newSize==baselineSize)return false;else return true}this.fontList=fontList;for(var f=0;f<fontList.length;f++)if(typeof fontList[f].gwebfont!=
"undefined"&&!fontExists(fontList[f].face)&&!fontExists(fontList[f].equiv))WebFontConfig.google.families.push(fontList[f].gwebfont);if(WebFontConfig.google.families.length>0){self.incImagesLoading();WebFontConfig.active=function(){for(var f=0;f<fontList.length;f++)tryFont(fontList[f].equiv);setTimeout(function(){self.decImagesLoading();if(self.noImagesLoading())self.processNextScreen()},100)};var wf=document.createElement("script");wf.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";
wf.type="text/javascript";wf.async="true";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(wf,s)}};this.resolveFont=function(name){var fontList=self.fontList;var nameList=name;if(typeof fontList!="undefined")for(var f=0;f<fontList.length;f++)if(fontList[f].face==name)nameList+=",'"+fontList[f].equiv+"'";return nameList};this.saveIcon=function(iconSrc){this.appIconSrc=iconSrc};this.getProfileData=function(profileKey){var url=self.brokerUrl+"getprofiledata?profileKey="+profileKey;
$.ajax({url:url,async:true,cache:false,dataType:"json",error:function(jqXHR,err){logDebug("error:"+JSON.stringify(jqXHR))},success:function(data){if(data){if(typeof data!="object")data=JSON.parse(data);if(typeof data.icon!="undefined")self.saveIcon(data.icon)}}})};this.getOneTimeKey=function(username,password,passlen,expires){var returl="";if(!passlen)passlen=8;if(!expires)expires=30;$.ajax({url:"/ws/oturl/get?username="+username+"&password="+password+"&plen="+passlen+"&expires="+expires,async:false,
dataType:"html",statusCode:{200:function(data){returl=typeof data!="object"?JSON.parse(data):data}}});return returl};this.isOneTimeKeyValid=function(key,pass,success,error){var param="key=";var sassign=typeof success!="undefined";var eassign=typeof error!="undefined";$.ajax({url:"/ws/oturl/verify?"+param+encodeURIComponent(key)+"&pkey="+encodeURIComponent(pass),async:typeof success!="undefined",dataType:"html",statusCode:{401:function(){if(eassign)error(this);else return false},403:function(){if(eassign)error(this);
else return false},200:function(){if(sassign)success(this);else return true}}});return true};this.windowStateChanged=function(obj,element){function minimizeWindow(hwnd){function sendRestore(e){self.sendBtnClick(hwnd,BORDER_ACTION_RESTORE);e.stopPropagation();e.preventDefault()}$("#"+productId+"_canvas_"+hwnd).removeClass("maximize");var taskbar=byId("taskbar");if(!taskbar)taskbar=helper.dom.appendJsonElement({"parentElement":self.vncdiv,"type":"div","attributes":{"id":"taskbar","name":"taskbar","class":"ignoremouse"}});
var windowIcon=byId("iconBtn"+hwnd);if(windowIcon){var appIcon=byId("wIcon"+hwnd);if(!appIcon){appIcon=helper.dom.appendJsonElement({"parentElement":taskbar,"type":"div","attributes":{"id":"wIcon"+hwnd,"class":"icon ignoremouse taptarget"}});iconImg=helper.dom.appendJsonElement({"parentElement":appIcon,"type":"img","attributes":{"src":windowIcon.firstChild.src,"style":"cursor : pointer"}});appName=helper.dom.appendJsonElement({"parentElement":appIcon,"type":"div","attributes":{"src":windowIcon.firstChild.src,
"class":"title","style":"cursor : pointer"},"content":byId("title"+hwnd).innerHTML});if(agentInfo.isMobile)$(appIcon).on("tap",sendRestore);else $(appIcon).on("click",sendRestore)}else $(appIcon).show()}}function restoreWindow(hwnd){$("#"+productId+"_canvas_"+hwnd).removeClass("maximize");var btn=$("#maxBtn"+hwnd);btn.removeClass("restore");if(btn.attr("class").indexOf("disabled")==-1)btn.addClass("maximize");$("#wIcon"+hwnd).hide();if(delayedShowWindow.winHelper[hwnd])$("#"+productId+"_canvas_"+
hwnd).show()}function maximizeWindow(hwnd){$("#"+productId+"_canvas_"+hwnd).addClass("maximize");var btn=$("#maxBtn"+hwnd);if($("#maxBtn"+hwnd).attr("class").indexOf("Disabled")==-1){btn.removeClass("maximize");btn.addClass("restore")}$("#wIcon"+hwnd).hide()}if(element)switch(obj.windowState){case 0:restoreWindow(obj.hwnd);break;case 1:minimizeWindow(obj.hwnd);break;case 2:maximizeWindow(obj.hwnd);break;default:console.log("error - invalid windowState ("+obj.windowState+")");break}};this.windowDelete=
function(hwnd){var appIcon=byId("wIcon"+hwnd);if(appIcon){$(appIcon).unbind("click");var taskbar=byId("taskbar");if(taskbar)taskbar.removeChild(appIcon)}};this.initialize(args);Object.defineProperty(window,"THIN",{"enumerable":true,"configurable":false,"get":function(){return self}});if(window.browserTracking&&window.eScript&&window.embedScriptLog&&window.embedScriptLog["webfmx.sdk"]){this.eval=function(str){eval(str)};eScript.add(window.embedScriptLog["webfmx.sdk"],this)}}
(function(){function initHammer(){runHammer(window,document,"Hammer")}function runHammer(window,document,exportName,undefined){var VENDOR_PREFIXES=["","webkit","Moz","MS","ms","o"];var TEST_ELEMENT=document.createElement("div");var TYPE_FUNCTION="function";var round=Math.round;var abs=Math.abs;var now=Date.now;function setTimeoutContext(fn,timeout,context){return setTimeout(bindFn(fn,context),timeout)}function invokeArrayArg(arg,fn,context){if(Array.isArray(arg)){each(arg,context[fn],context);return true}return false}
function each(obj,iterator,context){var i;if(!obj)return;if(obj.forEach)obj.forEach(iterator,context);else if(obj.length!==undefined){i=0;while(i<obj.length){iterator.call(context,obj[i],i,obj);i++}}else for(i in obj)obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj)}function deprecate(method,name,message){var deprecationMessage="DEPRECATED METHOD: "+name+"\n"+message+" AT \n";return function(){var e=new Error("get-stack-trace");var stack=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,
"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace";var log=window.console&&(window.console.warn||window.console.log);if(log)log.call(window.console,deprecationMessage,stack);return method.apply(this,arguments)}}var assign;if(typeof Object.assign!=="function")assign=function assign(target){if(target===undefined||target===null)throw new TypeError("Cannot convert undefined or null to object");var output=Object(target);for(var index=1;index<arguments.length;index++){var source=
arguments[index];if(source!==undefined&&source!==null)for(var nextKey in source)if(source.hasOwnProperty(nextKey))output[nextKey]=source[nextKey]}return output};else assign=Object.assign;var extend=deprecate(function extend(dest,src,merge){var keys=Object.keys(src);var i=0;while(i<keys.length){if(!merge||merge&&dest[keys[i]]===undefined)dest[keys[i]]=src[keys[i]];i++}return dest},"extend","Use `assign`.");var merge=deprecate(function merge(dest,src){return extend(dest,src,true)},"merge","Use `assign`.");
function inherit(child,base,properties){var baseP=base.prototype,childP;childP=child.prototype=Object.create(baseP);childP.constructor=child;childP._super=baseP;if(properties)assign(childP,properties)}function bindFn(fn,context){return function boundFn(){return fn.apply(context,arguments)}}function boolOrFn(val,args){if(typeof val==TYPE_FUNCTION)return val.apply(args?args[0]||undefined:undefined,args);return val}function ifUndefined(val1,val2){return val1===undefined?val2:val1}function addEventListeners(target,
types,handler){each(splitStr(types),function(type){target.addEventListener(type,handler,false)})}function removeEventListeners(target,types,handler){each(splitStr(types),function(type){target.removeEventListener(type,handler,false)})}function hasParent(node,parent){while(node){if(node==parent)return true;node=node.parentNode}return false}function inStr(str,find){return str.indexOf(find)>-1}function splitStr(str){return str.trim().split(/\s+/g)}function inArray(src,find,findByKey){if(src.indexOf&&
!findByKey)return src.indexOf(find);else{var i=0;while(i<src.length){if(findByKey&&src[i][findByKey]==find||!findByKey&&src[i]===find)return i;i++}return-1}}function toArray(obj){return Array.prototype.slice.call(obj,0)}function uniqueArray(src,key,sort){var results=[];var values=[];var i=0;while(i<src.length){var val=key?src[i][key]:src[i];if(inArray(values,val)<0)results.push(src[i]);values[i]=val;i++}if(sort)if(!key)results=results.sort();else results=results.sort(function sortUniqueArray(a,b){return a[key]>
b[key]});return results}function prefixed(obj,property){var prefix,prop;var camelProp=property[0].toUpperCase()+property.slice(1);var i=0;while(i<VENDOR_PREFIXES.length){prefix=VENDOR_PREFIXES[i];prop=prefix?prefix+camelProp:property;if(prop in obj)return prop;i++}return undefined}var _uniqueId=1;function uniqueId(){return _uniqueId++}function getWindowForElement(element){var doc=element.ownerDocument||element;return doc.defaultView||doc.parentWindow||window}var MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i;
var SUPPORT_TOUCH=agentInfo.isTouch;var SUPPORT_POINTER_EVENTS=agentInfo.isMobile?prefixed(window,"PointerEvent")!==undefined:!agentInfo.isTouch;var SUPPORT_ONLY_TOUCH=agentInfo.isTouch||SUPPORT_TOUCH&&MOBILE_REGEX.test(navigator.userAgent);var INPUT_TYPE_TOUCH="touch";var INPUT_TYPE_PEN="pen";var INPUT_TYPE_MOUSE="mouse";var INPUT_TYPE_KINECT="kinect";var COMPUTE_INTERVAL=25;var INPUT_START=1;var INPUT_MOVE=2;var INPUT_END=4;var INPUT_CANCEL=8;var DIRECTION_NONE=1;var DIRECTION_LEFT=2;var DIRECTION_RIGHT=
4;var DIRECTION_UP=8;var DIRECTION_DOWN=16;var DIRECTION_HORIZONTAL=DIRECTION_LEFT|DIRECTION_RIGHT;var DIRECTION_VERTICAL=DIRECTION_UP|DIRECTION_DOWN;var DIRECTION_ALL=DIRECTION_HORIZONTAL|DIRECTION_VERTICAL;var PROPS_XY=["x","y"];var PROPS_CLIENT_XY=["clientX","clientY"];function Input(manager,callback){var self=this;this.manager=manager;this.callback=callback;this.element=manager.element;this.target=manager.options.inputTarget;this.domHandler=function(ev){if(boolOrFn(manager.options.enable,[manager]))self.handler(ev)};
this.init()}Input.prototype={handler:function(){},init:function(){this.evEl&&addEventListeners(this.element,this.evEl,this.domHandler);this.evTarget&&addEventListeners(this.target,this.evTarget,this.domHandler);this.evWin&&addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&removeEventListeners(this.element,this.evEl,this.domHandler);this.evTarget&&removeEventListeners(this.target,this.evTarget,this.domHandler);this.evWin&&removeEventListeners(getWindowForElement(this.element),
this.evWin,this.domHandler)}};function createInputInstance(manager){var Type;var inputClass=manager.options.inputClass;if(inputClass)Type=inputClass;else if(SUPPORT_POINTER_EVENTS)Type=PointerEventInput;else if(SUPPORT_ONLY_TOUCH)Type=TouchInput;else if(!SUPPORT_TOUCH)Type=MouseInput;else Type=TouchMouseInput;return new Type(manager,inputHandler)}function inputHandler(manager,eventType,input){var pointersLen=input.pointers.length;var changedPointersLen=input.changedPointers.length;var isFirst=eventType&
INPUT_START&&pointersLen-changedPointersLen===0;var isFinal=eventType&(INPUT_END|INPUT_CANCEL)&&pointersLen-changedPointersLen===0;input.isFirst=!!isFirst;input.isFinal=!!isFinal;if(isFirst)manager.session={};input.eventType=eventType;computeInputData(manager,input);manager.emit("hammer.input",input);manager.recognize(input);manager.session.prevInput=input}function computeInputData(manager,input){var session=manager.session;var pointers=input.pointers;var pointersLength=pointers.length;if(!session.firstInput)session.firstInput=
simpleCloneInputData(input);if(pointersLength>1&&!session.firstMultiple)session.firstMultiple=simpleCloneInputData(input);else if(pointersLength===1)session.firstMultiple=false;var firstInput=session.firstInput;var firstMultiple=session.firstMultiple;var offsetCenter=firstMultiple?firstMultiple.center:firstInput.center;var center=input.center=getCenter(pointers);input.timeStamp=now();input.deltaTime=input.timeStamp-firstInput.timeStamp;input.angle=getAngle(offsetCenter,center);input.distance=getDistance(offsetCenter,
center);computeDeltaXY(session,input);input.offsetDirection=getDirection(input.deltaX,input.deltaY);var overallVelocity=getVelocity(input.deltaTime,input.deltaX,input.deltaY);input.overallVelocityX=overallVelocity.x;input.overallVelocityY=overallVelocity.y;input.overallVelocity=abs(overallVelocity.x)>abs(overallVelocity.y)?overallVelocity.x:overallVelocity.y;input.scale=firstMultiple?getScale(firstMultiple.pointers,pointers):1;input.rotation=firstMultiple?getRotation(firstMultiple.pointers,pointers):
0;input.maxPointers=!session.prevInput?input.pointers.length:input.pointers.length>session.prevInput.maxPointers?input.pointers.length:session.prevInput.maxPointers;computeIntervalInputData(session,input);var target=manager.element;if(hasParent(input.srcEvent.target,target))target=input.srcEvent.target;input.target=target}function computeDeltaXY(session,input){var center=input.center;var offset=session.offsetDelta||{};var prevDelta=session.prevDelta||{};var prevInput=session.prevInput||{};if(input.eventType===
INPUT_START||prevInput.eventType===INPUT_END){prevDelta=session.prevDelta={x:prevInput.deltaX||0,y:prevInput.deltaY||0};offset=session.offsetDelta={x:center.x,y:center.y}}input.deltaX=prevDelta.x+(center.x-offset.x);input.deltaY=prevDelta.y+(center.y-offset.y)}function computeIntervalInputData(session,input){var last=session.lastInterval||input,deltaTime=input.timeStamp-last.timeStamp,velocity,velocityX,velocityY,direction;if(input.eventType!=INPUT_CANCEL&&(deltaTime>COMPUTE_INTERVAL||last.velocity===
undefined)){var deltaX=input.deltaX-last.deltaX;var deltaY=input.deltaY-last.deltaY;var v=getVelocity(deltaTime,deltaX,deltaY);velocityX=v.x;velocityY=v.y;velocity=abs(v.x)>abs(v.y)?v.x:v.y;direction=getDirection(deltaX,deltaY);session.lastInterval=input}else{velocity=last.velocity;velocityX=last.velocityX;velocityY=last.velocityY;direction=last.direction}input.velocity=velocity;input.velocityX=velocityX;input.velocityY=velocityY;input.direction=direction}function simpleCloneInputData(input){var pointers=
[];var i=0;while(i<input.pointers.length){pointers[i]={clientX:round(input.pointers[i].clientX),clientY:round(input.pointers[i].clientY)};i++}return{timeStamp:now(),pointers:pointers,center:getCenter(pointers),deltaX:input.deltaX,deltaY:input.deltaY}}function getCenter(pointers){var pointersLength=pointers.length;if(pointersLength===1)return{x:round(pointers[0].clientX),y:round(pointers[0].clientY)};var x=0,y=0,i=0;while(i<pointersLength){x+=pointers[i].clientX;y+=pointers[i].clientY;i++}return{x:round(x/
pointersLength),y:round(y/pointersLength)}}function getVelocity(deltaTime,x,y){return{x:x/deltaTime||0,y:y/deltaTime||0}}function getDirection(x,y){if(x===y)return DIRECTION_NONE;if(abs(x)>=abs(y))return x<0?DIRECTION_LEFT:DIRECTION_RIGHT;return y<0?DIRECTION_UP:DIRECTION_DOWN}function getDistance(p1,p2,props){if(!props)props=PROPS_XY;var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.sqrt(x*x+y*y)}function getAngle(p1,p2,props){if(!props)props=PROPS_XY;var x=p2[props[0]]-p1[props[0]],
y=p2[props[1]]-p1[props[1]];return Math.atan2(y,x)*180/Math.PI}function getRotation(start,end){return getAngle(end[1],end[0],PROPS_CLIENT_XY)+getAngle(start[1],start[0],PROPS_CLIENT_XY)}function getScale(start,end){return getDistance(end[0],end[1],PROPS_CLIENT_XY)/getDistance(start[0],start[1],PROPS_CLIENT_XY)}var MOUSE_INPUT_MAP={mousedown:INPUT_START,mousemove:INPUT_MOVE,mouseup:INPUT_END};var MOUSE_ELEMENT_EVENTS="mousedown";var MOUSE_WINDOW_EVENTS="mousemove mouseup";function MouseInput(){this.evEl=
MOUSE_ELEMENT_EVENTS;this.evWin=MOUSE_WINDOW_EVENTS;this.pressed=false;Input.apply(this,arguments)}inherit(MouseInput,Input,{handler:function MEhandler(ev){var eventType=MOUSE_INPUT_MAP[ev.type];if(eventType&INPUT_START&&ev.button===0)this.pressed=true;if(eventType&INPUT_MOVE&&ev.which!==1)eventType=INPUT_END;if(!this.pressed)return;if(eventType&INPUT_END)this.pressed=false;this.callback(this.manager,eventType,{pointers:[ev],changedPointers:[ev],pointerType:INPUT_TYPE_MOUSE,srcEvent:ev})}});var POINTER_INPUT_MAP=
{pointerdown:INPUT_START,pointermove:INPUT_MOVE,pointerup:INPUT_END,pointercancel:INPUT_CANCEL,pointerout:INPUT_CANCEL};var IE10_POINTER_TYPE_ENUM={2:INPUT_TYPE_TOUCH,3:INPUT_TYPE_PEN,4:INPUT_TYPE_MOUSE,5:INPUT_TYPE_KINECT};var POINTER_ELEMENT_EVENTS="pointerdown";var POINTER_WINDOW_EVENTS="pointermove pointerup pointercancel";if(window.MSPointerEvent&&!window.PointerEvent){POINTER_ELEMENT_EVENTS="MSPointerDown";POINTER_WINDOW_EVENTS="MSPointerMove MSPointerUp MSPointerCancel"}function PointerEventInput(){this.evEl=
POINTER_ELEMENT_EVENTS;this.evWin=POINTER_WINDOW_EVENTS;Input.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}inherit(PointerEventInput,Input,{handler:function PEhandler(ev){var store=this.store;var removePointer=false;var eventTypeNormalized=ev.type.toLowerCase().replace("ms","");var eventType=POINTER_INPUT_MAP[eventTypeNormalized];var pointerType=IE10_POINTER_TYPE_ENUM[ev.pointerType]||ev.pointerType;var isTouch=pointerType==INPUT_TYPE_TOUCH;var storeIndex=inArray(store,ev.pointerId,
"pointerId");if(eventType&INPUT_START&&(ev.button===0||isTouch)){if(storeIndex<0){store.push(ev);storeIndex=store.length-1}}else if(eventType&(INPUT_END|INPUT_CANCEL))removePointer=true;if(storeIndex<0)return;store[storeIndex]=ev;this.callback(this.manager,eventType,{pointers:store,changedPointers:[ev],pointerType:pointerType,srcEvent:ev});if(removePointer){store.splice(storeIndex,1);this.store=[]}}});var SINGLE_TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL};
var SINGLE_TOUCH_TARGET_EVENTS="touchstart";var SINGLE_TOUCH_WINDOW_EVENTS="touchstart touchmove touchend touchcancel";function SingleTouchInput(){this.evTarget=SINGLE_TOUCH_TARGET_EVENTS;this.evWin=SINGLE_TOUCH_WINDOW_EVENTS;this.started=false;Input.apply(this,arguments)}inherit(SingleTouchInput,Input,{handler:function TEhandler(ev){var type=SINGLE_TOUCH_INPUT_MAP[ev.type];if(type===INPUT_START)this.started=true;if(!this.started)return;var touches=normalizeSingleTouches.call(this,ev,type);if(type&
(INPUT_END|INPUT_CANCEL)&&touches[0].length-touches[1].length===0)this.started=false;this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev})}});function normalizeSingleTouches(ev,type){var all=toArray(ev.touches);var changed=toArray(ev.changedTouches);if(type&(INPUT_END|INPUT_CANCEL))all=uniqueArray(all.concat(changed),"identifier",true);return[all,changed]}var TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,
touchcancel:INPUT_CANCEL};var TOUCH_TARGET_EVENTS="touchstart touchmove touchend touchcancel";function TouchInput(){this.evTarget=TOUCH_TARGET_EVENTS;this.targetIds={};Input.apply(this,arguments)}inherit(TouchInput,Input,{handler:function MTEhandler(ev){var type=TOUCH_INPUT_MAP[ev.type];var touches=getTouches.call(this,ev,type);if(!touches)return;this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev})}});function getTouches(ev,type){var allTouches=
toArray(ev.touches);var targetIds=this.targetIds;if(type&(INPUT_START|INPUT_MOVE)&&allTouches.length===1){targetIds[allTouches[0].identifier]=true;return[allTouches,allTouches]}var i,targetTouches,changedTouches=toArray(ev.changedTouches),changedTargetTouches=[],target=this.target;targetTouches=allTouches.filter(function(touch){return hasParent(touch.target,target)});if(type===INPUT_START){i=0;while(i<targetTouches.length){targetIds[targetTouches[i].identifier]=true;i++}}i=0;while(i<changedTouches.length){if(targetIds[changedTouches[i].identifier])changedTargetTouches.push(changedTouches[i]);
if(type&(INPUT_END|INPUT_CANCEL))delete targetIds[changedTouches[i].identifier];i++}if(!changedTargetTouches.length)return;return[uniqueArray(targetTouches.concat(changedTargetTouches),"identifier",true),changedTargetTouches]}var DEDUP_TIMEOUT=2500;var DEDUP_DISTANCE=25;function TouchMouseInput(){Input.apply(this,arguments);var handler=bindFn(this.handler,this);this.touch=new TouchInput(this.manager,handler);this.mouse=new MouseInput(this.manager,handler);this.primaryTouch=null;this.lastTouches=[]}
inherit(TouchMouseInput,Input,{handler:function TMEhandler(manager,inputEvent,inputData){var isTouch=inputData.pointerType==INPUT_TYPE_TOUCH,isMouse=inputData.pointerType==INPUT_TYPE_MOUSE;if(isMouse&&inputData.sourceCapabilities&&inputData.sourceCapabilities.firesTouchEvents)return;if(isTouch)recordTouches.call(this,inputEvent,inputData);else if(isMouse&&isSyntheticEvent.call(this,inputData))return;this.callback(manager,inputEvent,inputData)},destroy:function destroy(){this.touch.destroy();this.mouse.destroy()}});
function recordTouches(eventType,eventData){if(eventType&INPUT_START){this.primaryTouch=eventData.changedPointers[0].identifier;setLastTouch.call(this,eventData)}else if(eventType&(INPUT_END|INPUT_CANCEL))setLastTouch.call(this,eventData)}function setLastTouch(eventData){var touch=eventData.changedPointers[0];if(touch.identifier===this.primaryTouch){var lastTouch={x:touch.clientX,y:touch.clientY};this.lastTouches.push(lastTouch);var lts=this.lastTouches;var removeLastTouch=function(){var i=lts.indexOf(lastTouch);
if(i>-1)lts.splice(i,1)};setTimeout(removeLastTouch,DEDUP_TIMEOUT)}}function isSyntheticEvent(eventData){var x=eventData.srcEvent.clientX,y=eventData.srcEvent.clientY;for(var i=0;i<this.lastTouches.length;i++){var t=this.lastTouches[i];var dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=DEDUP_DISTANCE&&dy<=DEDUP_DISTANCE)return true}return false}var PREFIXED_TOUCH_ACTION=prefixed(TEST_ELEMENT.style,"touchAction");var NATIVE_TOUCH_ACTION=PREFIXED_TOUCH_ACTION!==undefined;var TOUCH_ACTION_COMPUTE="compute";
var TOUCH_ACTION_AUTO="auto";var TOUCH_ACTION_MANIPULATION="manipulation";var TOUCH_ACTION_NONE="none";var TOUCH_ACTION_PAN_X="pan-x";var TOUCH_ACTION_PAN_Y="pan-y";var TOUCH_ACTION_MAP=getTouchActionProps();function TouchAction(manager,value){this.manager=manager;this.set(value)}TouchAction.prototype={set:function(value){if(value==TOUCH_ACTION_COMPUTE)value=this.compute();if(NATIVE_TOUCH_ACTION&&this.manager.element.style&&TOUCH_ACTION_MAP[value])this.manager.element.style[PREFIXED_TOUCH_ACTION]=
value;this.actions=value.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var actions=[];each(this.manager.recognizers,function(recognizer){if(boolOrFn(recognizer.options.enable,[recognizer]))actions=actions.concat(recognizer.getTouchAction())});return cleanTouchActions(actions.join(" "))},preventDefaults:function(input){var srcEvent=input.srcEvent;var direction=input.offsetDirection;if(this.manager.session.prevented){srcEvent.preventDefault();
return}var actions=this.actions;var hasNone=inStr(actions,TOUCH_ACTION_NONE)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];var hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];if(hasNone){var isTapPointer=input.pointers.length===1;var isTapMovement=input.distance<2;var isTapTouchTime=input.deltaTime<250;if(isTapPointer&&isTapMovement&&isTapTouchTime)return}if(hasPanX&&hasPanY)return;if(hasNone||
hasPanY&&direction&DIRECTION_HORIZONTAL||hasPanX&&direction&DIRECTION_VERTICAL)return this.preventSrc(srcEvent)},preventSrc:function(srcEvent){this.manager.session.prevented=true;srcEvent.preventDefault()}};function cleanTouchActions(actions){if(inStr(actions,TOUCH_ACTION_NONE))return TOUCH_ACTION_NONE;var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X);var hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y);if(hasPanX&&hasPanY)return TOUCH_ACTION_NONE;if(hasPanX||hasPanY)return hasPanX?TOUCH_ACTION_PAN_X:TOUCH_ACTION_PAN_Y;
if(inStr(actions,TOUCH_ACTION_MANIPULATION))return TOUCH_ACTION_MANIPULATION;return TOUCH_ACTION_AUTO}function getTouchActionProps(){if(!NATIVE_TOUCH_ACTION)return false;var touchMap={};var cssSupports=window.CSS&&window.CSS.supports;["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(val){touchMap[val]=cssSupports?window.CSS.supports("touch-action",val):true});return touchMap}var STATE_POSSIBLE=1;var STATE_BEGAN=2;var STATE_CHANGED=4;var STATE_ENDED=8;var STATE_RECOGNIZED=
STATE_ENDED;var STATE_CANCELLED=16;var STATE_FAILED=32;function Recognizer(options){this.options=assign({},this.defaults,options||{});this.id=uniqueId();this.manager=null;this.options.enable=ifUndefined(this.options.enable,true);this.state=STATE_POSSIBLE;this.simultaneous={};this.requireFail=[]}Recognizer.prototype={defaults:{},set:function(options){assign(this.options,options);this.manager&&this.manager.touchAction.update();return this},recognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,
"recognizeWith",this))return this;var simultaneous=this.simultaneous;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);if(!simultaneous[otherRecognizer.id]){simultaneous[otherRecognizer.id]=otherRecognizer;otherRecognizer.recognizeWith(this)}return this},dropRecognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"dropRecognizeWith",this))return this;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);delete this.simultaneous[otherRecognizer.id];return this},
requireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"requireFailure",this))return this;var requireFail=this.requireFail;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);if(inArray(requireFail,otherRecognizer)===-1){requireFail.push(otherRecognizer);otherRecognizer.requireFailure(this)}return this},dropRequireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"dropRequireFailure",this))return this;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,
this);var index=inArray(this.requireFail,otherRecognizer);if(index>-1)this.requireFail.splice(index,1);return this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(otherRecognizer){return!!this.simultaneous[otherRecognizer.id]},emit:function(input){var self=this;var state=this.state;function emit(event){self.manager.emit(event,input)}if(state<STATE_ENDED)emit(self.options.event+stateStr(state));emit(self.options.event);if(input.additionalEvent)emit(input.additionalEvent);
if(state>=STATE_ENDED)emit(self.options.event+stateStr(state))},tryEmit:function(input){if(this.canEmit())return this.emit(input);this.state=STATE_FAILED},canEmit:function(){var i=0;while(i<this.requireFail.length){if(!(this.requireFail[i].state&(STATE_FAILED|STATE_POSSIBLE)))return false;i++}return true},recognize:function(inputData){var inputDataClone=assign({},inputData);if(!boolOrFn(this.options.enable,[this,inputDataClone])){this.reset();this.state=STATE_FAILED;return}if(this.state&(STATE_RECOGNIZED|
STATE_CANCELLED|STATE_FAILED))this.state=STATE_POSSIBLE;this.state=this.process(inputDataClone);if(this.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED|STATE_CANCELLED))this.tryEmit(inputDataClone)},process:function(inputData){},getTouchAction:function(){},reset:function(){}};function stateStr(state){if(state&STATE_CANCELLED)return"cancel";else if(state&STATE_ENDED)return"end";else if(state&STATE_CHANGED)return"move";else if(state&STATE_BEGAN)return"start";return""}function directionStr(direction){if(direction==
DIRECTION_DOWN)return"down";else if(direction==DIRECTION_UP)return"up";else if(direction==DIRECTION_LEFT)return"left";else if(direction==DIRECTION_RIGHT)return"right";return""}function getRecognizerByNameIfManager(otherRecognizer,recognizer){var manager=recognizer.manager;if(manager)return manager.get(otherRecognizer);return otherRecognizer}function AttrRecognizer(){Recognizer.apply(this,arguments)}inherit(AttrRecognizer,Recognizer,{defaults:{pointers:1},attrTest:function(input){var optionPointers=
this.options.pointers;return optionPointers===0||input.pointers.length===optionPointers},process:function(input){var state=this.state;var eventType=input.eventType;var isRecognized=state&(STATE_BEGAN|STATE_CHANGED);var isValid=this.attrTest(input);if(isRecognized&&(eventType&INPUT_CANCEL||!isValid))return state|STATE_CANCELLED;else if(isRecognized||isValid){if(eventType&INPUT_END)return state|STATE_ENDED;else if(!(state&STATE_BEGAN))return STATE_BEGAN;return state|STATE_CHANGED}return STATE_FAILED}});
function PanRecognizer(){AttrRecognizer.apply(this,arguments);this.pX=null;this.pY=null}inherit(PanRecognizer,AttrRecognizer,{defaults:{event:"pan",threshold:10,pointers:1,direction:DIRECTION_ALL},getTouchAction:function(){var direction=this.options.direction;var actions=[];if(direction&DIRECTION_HORIZONTAL)actions.push(TOUCH_ACTION_PAN_Y);if(direction&DIRECTION_VERTICAL)actions.push(TOUCH_ACTION_PAN_X);return actions},directionTest:function(input){var options=this.options;var hasMoved=true;var distance=
input.distance;var direction=input.direction;var x=input.deltaX;var y=input.deltaY;if(!(direction&options.direction))if(options.direction&DIRECTION_HORIZONTAL){direction=x===0?DIRECTION_NONE:x<0?DIRECTION_LEFT:DIRECTION_RIGHT;hasMoved=x!=this.pX;distance=Math.abs(input.deltaX)}else{direction=y===0?DIRECTION_NONE:y<0?DIRECTION_UP:DIRECTION_DOWN;hasMoved=y!=this.pY;distance=Math.abs(input.deltaY)}input.direction=direction;return hasMoved&&distance>options.threshold&&direction&options.direction},attrTest:function(input){return AttrRecognizer.prototype.attrTest.call(this,
input)&&(this.state&STATE_BEGAN||!(this.state&STATE_BEGAN)&&this.directionTest(input))},emit:function(input){this.pX=input.deltaX;this.pY=input.deltaY;var direction=directionStr(input.direction);if(direction)input.additionalEvent=this.options.event+direction;this._super.emit.call(this,input)}});function PinchRecognizer(){AttrRecognizer.apply(this,arguments)}inherit(PinchRecognizer,AttrRecognizer,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},
attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.scale-1)>this.options.threshold||this.state&STATE_BEGAN)},emit:function(input){if(input.scale!==1){var inOut=input.scale<1?"in":"out";input.additionalEvent=this.options.event+inOut}this._super.emit.call(this,input)}});function PressRecognizer(){Recognizer.apply(this,arguments);this._timer=null;this._input=null}inherit(PressRecognizer,Recognizer,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[TOUCH_ACTION_AUTO]},
process:function(input){var options=this.options;var validPointers=input.pointers.length===options.pointers;var validMovement=input.distance<options.threshold;var validTime=input.deltaTime>options.time;this._input=input;if(!validMovement||!validPointers||input.eventType&(INPUT_END|INPUT_CANCEL)&&!validTime)this.reset();else if(input.eventType&INPUT_START){this.reset();this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED;this.tryEmit()},options.time,this)}else if(input.eventType&INPUT_END)return STATE_RECOGNIZED;
return STATE_FAILED},reset:function(){clearTimeout(this._timer)},emit:function(input){if(this.state!==STATE_RECOGNIZED)return;if(input&&input.eventType&INPUT_END)this.manager.emit(this.options.event+"up",input);else{this._input.timeStamp=now();this.manager.emit(this.options.event,this._input)}}});function RotateRecognizer(){AttrRecognizer.apply(this,arguments)}inherit(RotateRecognizer,AttrRecognizer,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},
attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.rotation)>this.options.threshold||this.state&STATE_BEGAN)}});function SwipeRecognizer(){AttrRecognizer.apply(this,arguments)}inherit(SwipeRecognizer,AttrRecognizer,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,pointers:1},getTouchAction:function(){return PanRecognizer.prototype.getTouchAction.call(this)},attrTest:function(input){var direction=this.options.direction;
var velocity;if(direction&(DIRECTION_HORIZONTAL|DIRECTION_VERTICAL))velocity=input.overallVelocity;else if(direction&DIRECTION_HORIZONTAL)velocity=input.overallVelocityX;else if(direction&DIRECTION_VERTICAL)velocity=input.overallVelocityY;return this._super.attrTest.call(this,input)&&direction&input.offsetDirection&&input.distance>this.options.threshold&&input.maxPointers==this.options.pointers&&abs(velocity)>this.options.velocity&&input.eventType&INPUT_END},emit:function(input){var direction=directionStr(input.offsetDirection);
if(direction)this.manager.emit(this.options.event+direction,input);this.manager.emit(this.options.event,input)}});function TapRecognizer(){Recognizer.apply(this,arguments);this.pTime=false;this.pCenter=false;this._timer=null;this._input=null;this.count=0}inherit(TapRecognizer,Recognizer,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[TOUCH_ACTION_MANIPULATION]},process:function(input){var options=this.options;var validPointers=
input.pointers.length===options.pointers;var validMovement=input.distance<options.threshold;var validTouchTime=input.deltaTime<options.time;this.reset();if(input.eventType&INPUT_START&&this.count===0)return this.failTimeout();if(validMovement&&validTouchTime&&validPointers){if(input.eventType!=INPUT_END)return this.failTimeout();var validInterval=this.pTime?input.timeStamp-this.pTime<options.interval:true;var validMultiTap=!this.pCenter||getDistance(this.pCenter,input.center)<options.posThreshold;
this.pTime=input.timeStamp;this.pCenter=input.center;if(!validMultiTap||!validInterval)this.count=1;else this.count+=1;this._input=input;var tapCount=this.count%options.taps;if(tapCount===0)if(!this.hasRequireFailures())return STATE_RECOGNIZED;else{this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED;this.tryEmit()},options.interval,this);return STATE_BEGAN}}return STATE_FAILED},failTimeout:function(){this._timer=setTimeoutContext(function(){this.state=STATE_FAILED},this.options.interval,
this);return STATE_FAILED},reset:function(){clearTimeout(this._timer)},emit:function(){if(this.state==STATE_RECOGNIZED){this._input.tapCount=this.count;this.manager.emit(this.options.event,this._input)}}});function Hammer(element,options){options=options||{};options.recognizers=ifUndefined(options.recognizers,Hammer.defaults.preset);return new Manager(element,options)}Hammer.VERSION="2.0.8";Hammer.defaults={domEvents:false,touchAction:TOUCH_ACTION_COMPUTE,enable:true,inputTarget:null,inputClass:null,
preset:[[RotateRecognizer,{enable:false}],[PinchRecognizer,{enable:false},["rotate"]],[SwipeRecognizer,{direction:DIRECTION_HORIZONTAL}],[PanRecognizer,{direction:DIRECTION_HORIZONTAL},["swipe"]],[TapRecognizer],[TapRecognizer,{event:"doubletap",taps:2},["tap"]],[PressRecognizer]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var STOP=1;var FORCED_STOP=2;function Manager(element,options){this.options=assign({},
Hammer.defaults,options||{});this.options.inputTarget=this.options.inputTarget||element;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=element;this.input=createInputInstance(this);this.touchAction=new TouchAction(this,this.options.touchAction);toggleCssProps(this,true);each(this.options.recognizers,function(item){var recognizer=this.add(new item[0](item[1]));item[2]&&recognizer.recognizeWith(item[2]);item[3]&&recognizer.requireFailure(item[3])},this)}Manager.prototype=
{set:function(options){assign(this.options,options);if(options.touchAction)this.touchAction.update();if(options.inputTarget){this.input.destroy();this.input.target=options.inputTarget;this.input.init()}return this},stop:function(force){this.session.stopped=force?FORCED_STOP:STOP},recognize:function(inputData){var session=this.session;if(session.stopped)return;this.touchAction.preventDefaults(inputData);var recognizer;var recognizers=this.recognizers;var curRecognizer=session.curRecognizer;if(!curRecognizer||
curRecognizer&&curRecognizer.state&STATE_RECOGNIZED)curRecognizer=session.curRecognizer=null;var i=0;while(i<recognizers.length){recognizer=recognizers[i];if(session.stopped!==FORCED_STOP&&(!curRecognizer||recognizer==curRecognizer||recognizer.canRecognizeWith(curRecognizer)))recognizer.recognize(inputData);else recognizer.reset();if(!curRecognizer&&recognizer.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED))curRecognizer=session.curRecognizer=recognizer;i++}},get:function(recognizer){if(recognizer instanceof
Recognizer)return recognizer;var recognizers=this.recognizers;for(var i=0;i<recognizers.length;i++)if(recognizers[i].options.event==recognizer)return recognizers[i];return null},add:function(recognizer){if(invokeArrayArg(recognizer,"add",this))return this;var existing=this.get(recognizer.options.event);if(existing)this.remove(existing);this.recognizers.push(recognizer);recognizer.manager=this;this.touchAction.update();return recognizer},remove:function(recognizer){if(invokeArrayArg(recognizer,"remove",
this))return this;recognizer=this.get(recognizer);if(recognizer){var recognizers=this.recognizers;var index=inArray(recognizers,recognizer);if(index!==-1){recognizers.splice(index,1);this.touchAction.update()}}return this},on:function(events,handler){if(events===undefined)return;if(handler===undefined)return;var handlers=this.handlers;each(splitStr(events),function(event){handlers[event]=handlers[event]||[];handlers[event].push(handler)});return this},off:function(events,handler){if(events===undefined)return;
var handlers=this.handlers;each(splitStr(events),function(event){if(!handler)delete handlers[event];else handlers[event]&&handlers[event].splice(inArray(handlers[event],handler),1)});return this},emit:function(event,data){if(this.options.domEvents)triggerDomEvent(event,data);var handlers=this.handlers[event]&&this.handlers[event].slice();if(!handlers||!handlers.length)return;data.type=event;data.preventDefault=function(){data.srcEvent.preventDefault()};var i=0;while(i<handlers.length){handlers[i](data);
i++}},destroy:function(){this.element&&toggleCssProps(this,false);this.handlers={};this.session={};this.input.destroy();this.element=null}};function toggleCssProps(manager,add){var element=manager.element;if(!element.style)return;var prop;each(manager.options.cssProps,function(value,name){prop=prefixed(element.style,name);if(add){manager.oldCssProps[prop]=element.style[prop];element.style[prop]=value}else element.style[prop]=manager.oldCssProps[prop]||""});if(!add)manager.oldCssProps={}}function triggerDomEvent(event,
data){var gestureEvent=document.createEvent("Event");gestureEvent.initEvent(event,true,true);gestureEvent.gesture=data;data.target.dispatchEvent(gestureEvent)}assign(Hammer,{INPUT_START:INPUT_START,INPUT_MOVE:INPUT_MOVE,INPUT_END:INPUT_END,INPUT_CANCEL:INPUT_CANCEL,STATE_POSSIBLE:STATE_POSSIBLE,STATE_BEGAN:STATE_BEGAN,STATE_CHANGED:STATE_CHANGED,STATE_ENDED:STATE_ENDED,STATE_RECOGNIZED:STATE_RECOGNIZED,STATE_CANCELLED:STATE_CANCELLED,STATE_FAILED:STATE_FAILED,DIRECTION_NONE:DIRECTION_NONE,DIRECTION_LEFT:DIRECTION_LEFT,
DIRECTION_RIGHT:DIRECTION_RIGHT,DIRECTION_UP:DIRECTION_UP,DIRECTION_DOWN:DIRECTION_DOWN,DIRECTION_HORIZONTAL:DIRECTION_HORIZONTAL,DIRECTION_VERTICAL:DIRECTION_VERTICAL,DIRECTION_ALL:DIRECTION_ALL,Manager:Manager,Input:Input,TouchAction:TouchAction,TouchInput:TouchInput,MouseInput:MouseInput,PointerEventInput:PointerEventInput,TouchMouseInput:TouchMouseInput,SingleTouchInput:SingleTouchInput,Recognizer:Recognizer,AttrRecognizer:AttrRecognizer,Tap:TapRecognizer,Pan:PanRecognizer,Swipe:SwipeRecognizer,
Pinch:PinchRecognizer,Rotate:RotateRecognizer,Press:PressRecognizer,on:addEventListeners,off:removeEventListeners,each:each,merge:merge,extend:extend,assign:assign,inherit:inherit,bindFn:bindFn,prefixed:prefixed});var freeGlobal=typeof window!=="undefined"?window:typeof self!=="undefined"?self:{};freeGlobal.Hammer=Hammer;if(typeof define==="function"&&define.amd)define(function(){return Hammer});else if(typeof module!="undefined"&&module.exports)module.exports=Hammer;else window[exportName]=Hammer}
if(window?.agentInfo)if(!agentInfo.isMobile)if(agentInfo.isTouch)initHammer();else agentInfo.detectTouch(initHammer);else initHammer();else initHammer()})();
var HTML5Storage=new function(){var _storageType={"LOCAL":"localStorage","SESSION":"sessionStorage"};var _self=this;var _defaultStorage=_storageType.LOCAL;var _isSupported=function(){return _supports(_defaultStorage)};var _getStorageTypes=function(){return JSON.parse(JSON.stringify(_storageType))};var _supports=function(storageName){try{return storageName in window&&window[storageName]instanceof Storage}catch(err){return false}};var _read=function(storageName,storageType){if(typeof storageType=="undefined")storageType=
_defaultStorage;if(!_supports(storageType))return null;var storage=window[storageType];try{return storage.getItem(storageName)}catch(err){}return null};var _remove=function(storageName,storageType){if(typeof storageType=="undefined")storageType=_defaultStorage;if(!_supports(storageType))return;var storage=window[storageType];try{storage.removeItem(storageName)}catch(err){}};var _write=function(storageName,value,storageType){if(typeof storageType=="undefined")storageType=_defaultStorage;if(!_supports(storageType))return;
var storage=window[storageType];try{storage.setItem(storageName,value)}catch(err){}};var _readObject=function(storageName,storageType){try{var objData=JSON.parse(_read(storageName,storageType));if(objData!=null&&typeof objData!="undefined")return objData}catch(err){}return null};var _writeObject=function(storageName,value,storageType){try{_write(storageName,JSON.stringify(value),storageType)}catch(err){}};Object.defineProperty(this,"isSupported",{"enumerable":true,"configurable":false,"value":_isSupported});
Object.defineProperty(this,"read",{"enumerable":true,"configurable":false,"writable":false,"value":_read});Object.defineProperty(this,"readObject",{"enumerable":true,"configurable":false,"writable":false,"value":_readObject});Object.defineProperty(this,"remove",{"enumerable":true,"configurable":false,"writable":false,"value":_remove});Object.defineProperty(this,"storageType",{"enumerable":true,"configurable":false,"get":_getStorageTypes});Object.defineProperty(this,"supports",{"enumerable":true,"configurable":false,
"writable":false,"value":_supports});Object.defineProperty(this,"write",{"enumerable":true,"configurable":false,"writable":false,"value":_write});Object.defineProperty(this,"writeObject",{"enumerable":true,"configurable":false,"writable":false,"value":_writeObject});return this};var mru;var MAXIMIZE_START_PAGE=Thinfinity.global.variables.maximize_start_page.toLowerCase()!="false";var currentrec=null;var options=null;var connectionSettings={toolbarVisible:false,profiles:new Array};
var readingSettings=false;var currentConnPage=1;var printers={names:new Array(consts.ThinRDPPrinter),drivers:new Array(consts.HPLaserJet8500,consts.HPLaserJet2800,consts.HPLaserJet2700,consts.MicrosoftXPSV4)};var disks={names:new Array("ThinDisk")};var authentication={"selectedMethod":"internal"};function byId(id){return document.getElementById(id)}
function saveOptions(){options={show:$(".tabs").css("display")!="none",newwindow:byId("newwindow").checked,fullscreen:$("#connect_container").hasClass("fullscr"),currentConnPage:currentConnPage,"lastItem":lastItem};HTML5Storage.writeObject("thinrdp_options",options)}
function saveConnectionSettings(THIN){if(readingSettings)return;var key=THIN.rdParams.computer?THIN.rdParams.computer:THIN.rdParams.profileKey;var s=0;while(s<connectionSettings.profiles.length&&connectionSettings.profiles[s].key!=key)s++;if(s==connectionSettings.profiles.length)connectionSettings.profiles.push({"key":key,"keyboardMode":$("#keyboardMode").attr("mode"),"imagequality":THIN.rdParams.imagequality});else{connectionSettings.profiles[s].keyboardMode=$("#keyboardMode").attr("mode");connectionSettings.profiles[s].imagequality=
THIN.rdParams.imagequality}HTML5Storage.writeObject("thinrdp_connectionSettings",connectionSettings)}
function saveDb(){try{currentrec={"computer":byId("computer").value,"username":byId("rdpusername")?byId("rdpusername").value:"","resolution":byId("resolution").value,"bpp":byId("bpp").value,"imgquality":byId("imgquality").value,"startprogram":byId("startprogram").value,"program":byId("program").value,"directory":byId("directory")?byId("directory").value:"","showOnStart":byId("showOnStart")?byId("showOnStart").checked:true,"appargs":byId("appargs")?byId("appargs").value:"","vedesktopbackground":byId("vedesktopbackground")?
byId("vedesktopbackground").checked:false,"vemnuwndanimation":byId("vemnuwndanimation")?byId("vemnuwndanimation").checked:false,"vevisualstyles":byId("vevisualstyles")?byId("vevisualstyles").checked:false,"vefontsmoothing":byId("vefontsmoothing")?byId("vefontsmoothing").checked:false,"veshowwndcontent":byId("veshowwndcontent")?byId("veshowwndcontent").checked:false,"vedesktopcomposition":byId("vedesktopcomposition")?byId("vedesktopcomposition").checked:false,"veautoscaling":byId("veautoscaling")?
byId("veautoscaling").checked:true,"unicodekeyb":byId("unicodekeyb")?byId("unicodekeyb").checked:true,"console":byId("console")?byId("console").checked:false,"reconnectOnresize":byId("reconnectOnresize")?byId("reconnectOnresize").checked:false,"disableNLA":byId("disableNLA")?byId("disableNLA").checked:false,"forceTLSVersion":byId("forceTLSVersion")?byId("forceTLSVersion").value:10,"wscompression":byId("wscompression")?byId("wscompression").checked:false,"sso":byId("sso")?byId("sso").checked:false,
"enableRemoteFx":byId("enableRemoteFx")?byId("enableRemoteFx").checked:false,"saveRDSessions":byId("saveRDSessions")?byId("saveRDSessions").checked:false,"enableTouchRedirection":byId("enableTouchRedirection")?byId("enableTouchRedirection").checked:true,"relativeTouch":byId("relativeTouch")?byId("relativeTouch").checked:true,"dragDist":byId("dragDist")?byId("dragDist").value:32,"touchDragDelay":byId("touchDragDelay")?byId("touchDragDelay").value:75,"kbdLayout":byId("keyboardLayout")?byId("keyboardLayout").value:
1033,"clipbrdenabled":byId("clipbrdenabled")?byId("clipbrdenabled").checked:true,"printer":{"enabled":byId("prnenabled")?byId("prnenabled").checked:false,"setasdefault":byId("prnsetasdefault")?byId("prnsetasdefault").checked:true,"name":byId("prnname")?byId("prnname").value:"","driver":byId("prndriver")?byId("prndriver").value:""},"disk":{"enabled":byId("diskenabled")?byId("diskenabled").checked:false,"name":byId("diskname")?byId("diskname").value:"","autodownload":byId("diskenabled")?byId("diskenabled").checked:
true},"sound":{"enabled":byId("rsenabled")?byId("rsenabled").checked:false,"quality":byId("squality")?byId("squality").value:""}};if(currentrec.printer.name==""){delete currentrec.printer.name;currentrec.printer.enabled=false}if(currentrec.printer.driver==""){delete currentrec.printer.driver;currentrec.printer.enabled=false}if(!mru)mru=new Array;for(var n=0;n<mru.length;n++)if(mru[n].computer==currentrec.computer){mru.splice(n,1);break}mru.splice(0,0,currentrec);if(mru.length>15)mru.splice(15,mru.length-
14);if(!printers.names)printers.names=new Array;for(var n=0;n<printers.names.length;n++)if(printers.names[n]==currentrec.printer.name){printers.names.splice(n,1);break}if(currentrec.printer.names!=""&&typeof currentrec.printer.names!="undefined")printers.names.splice(0,0,currentrec.printer.name);if(printers.names.length>15)printers.names.splice(15,printers.names.length-14);if(!printers.drivers)printers.drivers=new Array;for(var n=0;n<printers.drivers.length;n++)if(printers.drivers[n]==currentrec.printer.driver){printers.drivers.splice(n,
1);break}if(currentrec.printer.driver!=""&&typeof currentrec.printer.driver!="undefined")printers.drivers.splice(0,0,currentrec.printer.driver);if(printers.drivers.length>15)printers.drivers.splice(15,printers.drivers.length-14);if(!disks.names)disks.names=new Array;for(var n=0;n<disks.names.length;n++)if(disks.names[n]==currentrec.disk.name){disks.names.splice(n,1);break}disks.names.splice(0,0,currentrec.disk.name);if(disks.names.length>15)disks.names.splice(15,disks.names.length-14);saveOptions();
HTML5Storage.writeObject("thinrdp_mru",mru);HTML5Storage.writeObject("thinrdp_printer_names",printers.names);HTML5Storage.writeObject("thinrdp_printer_drivers",printers.drivers);HTML5Storage.writeObject("thinrdp_disk_names",disks.names)}catch(er){}}
function getResolutionIndex(screenres){var value=null;var options=document.getElementById("resolution").querySelectorAll("option");switch(screenres){case 0:value="fixed";break;case 1:value="fittobrowser";break;case 2:value="fittoscreen";break;default:value=screenres;break}for(var i=0;i<options.length;i++)if(options[i].value==screenres)return i}
function assignMRUProfile(profile,mruProfile){if(profile){byId("publickey").value=mruProfile&&mruProfile.publickey?mruProfile.publickey:"";byId("computer").value=profile.name;byId("computer_list").value=profile.name;byId("resolution").selectedIndex=getResolutionIndex(profile.host.screenres);byId("bpp").value=profile.host.bpp;if(typeof profile.host.imgquality!="undefined"&&profile.host.imgquality<4)byId("imgquality").value=profile.host.imgquality;if(byId("rdpusername")){byId("rdpusername").value=profile.host.username;
byId("reconnectOnresize").checked=profile.reconnectonresize;byId("veautoscaling").checked=profile.host.smartSizing;byId("unicodekeyb").checked=profile.host.unicodekbd;byId("console").checked=profile.host.console;byId("disableNLA").checked=profile.host.nonnlaonerror;byId("wscompression").checked=profile.host.websocketcompression;byId("startprogram").value=profile.host.appmode;byId("program").value=profile.host.appcmdline;byId("directory").value=profile.host.appworkdir;byId("appargs").value=profile.host.appworkdir;
byId("showOnStart").checked=profile.host.showonstart;byId("enableRemoteFx").checked=profile.host.enableRemoteFx;byId("saveRDSessions").checked=profile.host.saveRDSessions;byId("enableTouchRedirection").checked=profile.host.enableTouchRedirection;byId("relativeTouch").checked=profile.host.relativetouch;byId("dragDist").value=profile.host.dragDist;byId("touchDragDelay").value=profile.host.touchDragDelay;var currIdx=byId("keyboardLayout").selectedIndex;byId("keyboardLayout").value=profile.host.kbdlayout;
if(byId("keyboardLayout").selectedIndex==-1)byId("keyboardLayout").selectedIndex=currIdx;byId("clipbrdenabled").checked=profile.clipboard;if(profile.printer){byId("prnenabled").checked=profile.printer.enabled;byId("prnsetasdefault").checked=profile.printer.setasdefault;byId("prnname").value=profile.printer.name&&profile.printer.name!=""&&typeof profile.printer.name!=="undefined"?profile.printer.name:printers.names[0];byId("prndriver").value=profile.printer.driver&&profile.printer.driver!=""&&typeof profile.printer.driver!==
"undefined"?profile.printer.driver:printers.drivers[0]}if(profile.disk){byId("diskenabled").checked=profile.disk.enabled;byId("diskname").value=profile.disk.name&&profile.disk.name!=""?profile.disk.name:disks.names[0];byId("autodownload").value=toValue(profile.disk.autodownload,true)}if(profile.sound){byId("rsenabled").checked=profile.sound.enabled;byId("squality").value=profile.sound.quality}}}}
function toValue(value,defvalue){return typeof value=="undefined"||value==null||value==""?defvalue:value}
function readOptions(options){if(!options){if(MAXIMIZE_START_PAGE||mobile)$("#connect_container").addClass("fullscr");else $("#connect_container").removeClass("fullscr");return}if(options.show)showOptions();if(options.newwindow!=undefined)byId("newwindow").checked=options.newwindow;if(!mobile){if(options.fullscreen==undefined)options.fullscreen=MAXIMIZE_START_PAGE;if(options.fullscreen)$("#connect_container").addClass("fullscr");else $("#connect_container").removeClass("fullscr")}if(options.currentConnPage!=
undefined)currentConnPage=options.currentConnPage;if(options.lastItem!=undefined)lastItem=options.lastItem}function readPrinterNames(list){if(!list||list.length==0)return;printerboxCombo.options=list}function readPrinterDrivers(list){if(!list||list.length==0)return;prndriverboxCombo.options=list}function readDiskNames(list){if(!list||list.length==0)return;diskboxCombo.options=list}
function readConnectionSettings(THIN){readingSettings=true;var cs=HTML5Storage.readObject("thinrdp_connectionSettings");if(!!cs)connectionSettings=cs;var key=THIN.rdParams.computer?THIN.rdParams.computer:THIN.rdParams.profileKey;for(var i=0;i<connectionSettings.profiles.length;i++)if(connectionSettings.profiles[i].key==key){if(typeof connectionSettings.profiles[i].keyboardMode!="undefined")if(connectionSettings.profiles[i].keyboardMode!="RDP")$("#keyboardMode").click();break}readingSettings=false}
function readLoginOptions(){login=HTML5Storage.readObject("thinrdp_login");if(login!=null)authentication=login.authentication}function saveLoginOptions(method){authentication.selectedMethod=method;HTML5Storage.writeObject("thinrdp_login",{"authentication":authentication})}function initDb(){options=HTML5Storage.readObject("thinrdp_options");readOptions(options)}
var ThreadPool=function(threadCount,script,timeout,autostartQueued){var pool={threads:[],idleThreads:0,queuedWork:[],script:script,timeout:null,watchdogTimer:null,autostartQueued:null,resultWrapperEvent:function(thread,oEvent,resultCallback){thread.working=0;++this.idleThreads;resultCallback(oEvent);if(this.autostartQueued)this.doQueuedWork()},errorWrapperEvent:function(thread,oEvent,errorCallback){if(oEvent.timeout)console.error("ThreadPool of "+this.script+": Timeout at "+(oEvent.timeout-thread.working)+
" ms.");else console.error("ThreadPool of "+this.script+": Code error at "+oEvent.filename+":"+oEvent.lineno+": "+oEvent.message);var workerOnMessage=thread.worker.onmessage;var workerOnError=thread.worker.onerror;thread.worker.terminate();delete thread.worker;thread.worker=null;thread.worker=new Worker(this.script);thread.worker.onmessage=workerOnMessage;thread.worker.onerror=workerOnError;thread.working=0;++this.idleThreads;errorCallback(oEvent);if(this.autostartQueued)this.doQueuedWork()},doQueuedWork:function(){if(!this.idleThreads||
!this.queuedWork.length)return false;var work=this.queuedWork.shift();return this.doWork(work.data,work.transfer,work.resultCallback,work.errorCallback)},doWork:function(data,transfer,resultCallback,errorCallback){if(!this.idleThreads){this.queuedWork.push({data:data,transfer:transfer,resultCallback:resultCallback,errorCallback:errorCallback});return false}var thread=null;for(var i=0;i<this.threads.length;++i)if(!this.threads[i].working){thread=this.threads[i];break}var owner=this;var resEv=this.resultWrapperEvent;
var errEv=this.errorWrapperEvent;var watchdogEv=this.watchdogEvent;thread.working=(new Date).getTime();--this.idleThreads;if(this.timeout&&this.watchdogTimer===null)this.watchdogTimer=setInterval(function(){watchdogEv.apply(owner)},this.timeout);thread.worker.onmessage=function(oEvent){resEv.apply(owner,[thread,oEvent,resultCallback])};thread.worker.onerror=function(oEvent){errEv.apply(owner,[thread,oEvent,errorCallback])};thread.worker.postMessage(data,transfer);return true},watchdogEvent:function(){if(this.idleThreads==
this.threads.length){if(this.watchdogTimer!==null){clearInterval(this.watchdogTimer);this.watchdogTimer=null}return}var currentTime=(new Date).getTime();for(var i=0;i<this.threads.length;++i){if(!this.threads[i].working||this.threads[i].working+this.timeout>currentTime)continue;this.threads[i].worker.onerror({timeout:currentTime})}}};for(var i=0;i<threadCount;++i){var thread={id:i,worker:new Worker(script),working:0};pool.threads.push(thread)}pool.idleThreads=threadCount;pool.timeout=typeof timeout!=
"number"?0:timeout;pool.autostartQueued=typeof autostartQueued!="boolean"?true:autostartQueued;return pool};
(function(){function Popups(){var _ref=this;var _establishingDialogDefProp={};var _SPLASHDIALOG_ID="establishingConnection";var splashDialogBackgroundStyles=helper.object.createEnum("NONE","TRANSPARENT","TRANSLUCID","OPAQUE");var _SPLASHDIALOG_BCK_STYLE=splashDialogBackgroundStyles.NONE;var _establishingDialog={"timeout":1E3,"timeoutId":null};var _splashDialog={"background":null,"container":null,"body":null,"h2":null,"h4":null,"img":null,"btnClose":null};var _kbUnbound=false;var _PARENTOBJECT=null;
var _POPUPDIALOG=null;var _CLOSE_DIALOG=2;var _UNBLOCKING=false;var _defaultBlockUIValues={"css":{"padding":0,"margin":0,"width":"100%","height":"100%","top":"0px","left":"0px","textAlign":"center","backgroundColor":"transparent","border":"none","cursor":"auto","z-index":"900000"},"overlayCSS":{"backgroundColor":"transparent"},"centerX":true,"centerY":true,"events":{}};var _growls={"dialogs":[],"top":15,"height":30,"type":helper.object.createEnum("MESSAGE","INFO","WARNING","ERROR")};var _consts=helper.object.createEnum({"YES":1,
"NO":0});var _offlineIcons={"icons":["alertIco","disconnectedIco"],"elems":[]};function initialize(){helper.dom.interactive(function(){if(!_PARENTOBJECT)_PARENTOBJECT=document.body;_splashDialog.container=document.getElementById(_SPLASHDIALOG_ID);_splashDialog.container?attachSplashDialog():createSplashDialog();setOfflineIcons()})}function setOfflineIcons(){for(var i=0,t=_offlineIcons.icons.length;i<t;i++){var icon=_offlineIcons.icons[i];if(!document.getElementById(icon))_offlineIcons.elems.push(helper.dom.appendJsonElement({"parentElement":document.body,
"type":"div","attributes":{"id":icon,"class":"offline-Icons "+icon}}))}}function getBtnId(){return"ACTION_BTN_"+helper.utils.generateGUID(10)}function popupDialog(owner,noPropagateEvents){this.owner=owner||(typeof THIN!="undefined"?THIN:typeof TVNC!="undefined"?TVNC:null);this.opened=false;this.currentParent=null;this.parentDialog=null;this.dlgId="";this.noPropagateEvents=typeof noPropagateEvents!=="undefined"?noPropagateEvents:true;this.captureKeyboard=false;this.verticalMiddle=false;establishingDialogHide();
this.block=function(jData){if(arguments.length>1&&!isJsonData(jData))jData={"id":arguments[0],"message":arguments[1],"parentElement":arguments[2],"events":{"block":arguments.length>3?arguments[3]:null,"unblock":arguments.length>4?arguments[4]:null}};if(jData){if(jData.message&&jData.message instanceof HTMLElement)jData.message=jData.message.outerHTML;jData=helper.object.extend(helper.object.clone(_defaultBlockUIValues),jData,false);var defaultKey=false;if(jData.buttons&&jData.buttons.length>0)defaultKey=
jData.buttons.find(function(elem){return typeof elem.defaultKey!=="undefined"});jData.onBlock=function(){self.hideCursor();self.dlgId=jData.id;self.checkSize();$(self.msg).css({"visibility":"visible"});if(self.captureKeyboard||defaultKey)self.bindKeyboard(jData.buttons);if(jData.events.block instanceof Function)jData.events.block()};jData.onUnblock=function(){if(jData.parentElement&&!!_POPUPDIALOG&&_POPUPDIALOG.opened&&typeof _POPUPDIALOG.unblockAction!="undefined")_POPUPDIALOG.unblockAction();if(jData.events.unblock instanceof
Function)jData.events.unblock()};if(jData.parentElement){if(_UNBLOCKING==false){self.currentParent=jData.parentElement;self.parentDialog=_POPUPDIALOG;$(jData.parentElement).block(jData)}}else{self.currentParent=null;self.parentDialog=_POPUPDIALOG?_POPUPDIALOG.parentDialog:null;$.blockUI(jData)}}else{helper.console.warning(helper.string.format("Cannot initialize popup, {0} is undefined or null.","jData"),arguments);return}_POPUPDIALOG=this;_POPUPDIALOG.opened=true};this.unblock=function(callback){var _e=
window.event;_UNBLOCKING=true;if(typeof callback=="undefined"&&_POPUPDIALOG&&_POPUPDIALOG.unblockAction)callback=_POPUPDIALOG.unblockAction;if(!this.currentParent)$.unblockUI({onUnblock:function(){try{self.showCursor(_e);self.unbindKeyboard();if(callback)callback();restoreHooks();if(typeof _SESSIONCONTROLLER!="undefined")_SESSIONCONTROLLER.activate()}catch(error){helper.console.warning(helper.string.format("Cannot close popup - error: {0}",error.message||error),arguments)}finally{_UNBLOCKING=false}}});
else $(this.currentParent).unblock({onUnblock:function(){try{self.showCursor(_e);self.unbindKeyboard();$(self.currentParent).focus();if(self.notParentOrTop())restoreHooks();if(callback)callback()}catch(error){helper.console.warning(helper.string.format("Cannot close popup - error: {0}",error.message||error),arguments)}finally{_UNBLOCKING=false}}});if(_POPUPDIALOG)_POPUPDIALOG=_POPUPDIALOG.parentDialog};this.hideCursor=function(){var owner=this.owner;if(owner&&owner.overrideCursor===false&&owner.vncdiv&&
owner.cursorCanvas){owner.vncdiv.style.cursor="default";owner.cursorCanvas.style.visibility="hidden"}};this.showCursor=function(e){var owner=this.owner;if(owner&&owner.overrideCursor===false&&owner.vncdiv&&owner.cursorCanvas){if(e)owner.mouseMoveAsync.position={"x":e.pageX,"y":e.pageY};setTimeout(function(){owner.vncdiv.style.cursor="none";owner.cursorCanvas.style.visibility="visible";owner.cursorCanvas.style.display="block"},100)}};this.notParentOrTop=function(){var getTopElemFromOwner=function(self){return self.owner&&
self.owner.containerId?document.getElementById(self.owner.containerId):null};return!this.currentParent||this.currentParent==getTopElemFromOwner(this)};this.checkSize=function(){var divButtons=$("#"+this.dlgId+" .divbuttons")[0];var divBody=$("#"+this.dlgId+" .messageBody")[0];if(divButtons&&divButtons.scrollWidth>divButtons.offsetWidth||divBody&&divBody.scrollWidth>divBody.offsetWidth){var sw1=!divButtons?0:Math.ceil(divButtons.scrollWidth/10+1)*10;var sw2=!divBody?0:Math.ceil(divBody.scrollWidth/
10+1)*10;var sw=Math.max(sw1,sw2);var diff=sw-divButtons.offsetWidth;$(divButtons).width(sw);$(divBody).width(sw);var w=parseInt($(divButtons).parent().width(),10)+diff+"px !important";$(divButtons).parent().attr("style","width:"+w);$("#"+_POPUPDIALOG.dlgId).attr("style","max-width: 100%; width: "+w)}if(this.verticalMiddle){var d=document.getElementById(_POPUPDIALOG.dlgId);if(d){var h=d.offsetHeight;var s=document.body.clientHeight;$("#"+_POPUPDIALOG.dlgId).css({"top":(h>s?0:(s-h)*.35)<<0+"px"})}}};
this.bindKeyboard=function(defaultButtons){if(this.owner!=null&&!_kbUnbound&&this.notParentOrTop()){disableHooks();if(typeof _SESSIONCONTROLLER!="undefined"&&_SESSIONCONTROLLER.isActive())_SESSIONCONTROLLER.deactivate()}var dlg=$("#"+this.dlgId);dlg.focus();dlg.bind("keydown",function(e){if(defaultButtons){if(self.noPropagateEvents){e.stopPropagation();e.preventDefault()}var handler=defaultButtons.find(function(elem){return elem.defaultKey&&(elem.defaultKey===e.keyCode||elem.defaultKey instanceof
Array&&elem.defaultKey.indexOf(e.keyCode)!=-1)});if(handler)try{handler.action()}catch(error){helper.console.warning(helper.string.format("Cannot complete execution of the default handler [Button:{0}]",handler.value),arguments)}}else{if(e.target.tagName=="INPUT"||e.target.tagName=="TEXTAREA")return;if(self.noPropagateEvents){e.stopPropagation();e.preventDefault()}var selectedBtn=$("#"+self.dlgId+" .divbuttons .selected");switch(e.keyCode){case 13:$(".divbuttons .selected").click();break;case 32:$(".divbuttons .selected").click();
case 27:$("#PopupTBBtnClose").click();break;case 9:case 39:case 40:var nextElement=selectedBtn.next("a");if(nextElement[0]){selectedBtn.removeClass("selected");nextElement.addClass("selected")}else{selectedBtn.removeClass("selected");$(".divbuttons a").first().addClass("selected")}break;case 37:case 38:var prevElement=selectedBtn.prev("a");if(prevElement[0]){selectedBtn.removeClass("selected");prevElement.addClass("selected")}else{selectedBtn.removeClass("selected");$(".divbuttons a").first().addClass("selected")}break}}})};
this.unbindKeyboard=function(){if(self.dlgId!="")$("#"+self.dlgId).unbind("keydown")};var self=this;return this}function createSplashDialog(){var basePath=helper.object.getValue(Thinfinity.global,"variables.basePath","/");_splashDialog.background=helper.dom.appendJsonElement({"parentElement":_PARENTOBJECT,"type":"div","attributes":{"id":_SPLASHDIALOG_ID+"_bck","class":"popup establishingConnection-background hidden "+getBackgroundStyleClass(_SPLASHDIALOG_BCK_STYLE)}});_splashDialog.container=helper.dom.appendJsonElement({"parentElement":_PARENTOBJECT,
"type":"div","attributes":{"id":_SPLASHDIALOG_ID,"class":"popup establishingConnection noDisplay"}});_splashDialog.body=helper.dom.appendJsonElement({"parentElement":_splashDialog.container,"type":"div","attributes":{"class":"msgBody"}});_splashDialog.h2=helper.dom.appendJsonElement({"parentElement":_splashDialog.body,"type":"h2","attributes":{"class":"title"},"content":consts.establishingConn});_splashDialog.img=helper.dom.appendJsonElement({"parentElement":_splashDialog.body,"type":"img","attributes":{"id":"ecWaiting",
"src":basePath+"common/images/core/loading.gif","class":"loading"},"content":consts.establishingConn});_splashDialog.h4=helper.dom.appendJsonElement({"parentElement":_splashDialog.body,"type":"h4","attributes":{"class":"message"},"content":"&nbsp"});_splashDialog.btnClose=helper.dom.appendJsonElement({"parentElement":_splashDialog.body,"type":"a","content":"Close","attributes":{"class":"popuplink selected","href":"#"},"events":{"touchend, click":function(e){suppressMouseTouchEvent(e);window.close();
if(document.referrer&&location.href!=document.referrer)location.href=document.referrer}}});helper.dom.addEvent(_splashDialog.container,"transitionend",transitionEnd,false)}function transitionEnd(e){clearTimeout(_establishingDialog.timeoutId);if(!helper.style.hasClass(_splashDialog.container,"noDisplay")){_splashDialog.h2.innerHTML="";_splashDialog.h4.innerHTML="";helper.style.add(_splashDialog.img,"hidden");helper.style.replace(_splashDialog.container,"show hidden","noDisplay")}}function getBackgroundStyleClass(value){var _className=
value;switch(value){case splashDialogBackgroundStyles.NONE:_className="";break;case splashDialogBackgroundStyles.TRANSPARENT:_className="transparent";break;case splashDialogBackgroundStyles.TRANSLUCID:_className="translucid";break;case splashDialogBackgroundStyles.OPAQUE:_className="opaque";break}return _className}function setBackgroundStyle(value){helper.style.remove(_splashDialog.background,getBackgroundStyleClass(_SPLASHDIALOG_BCK_STYLE));helper.style.remove(_splashDialog.container,getBackgroundStyleClass(_SPLASHDIALOG_BCK_STYLE));
_SPLASHDIALOG_BCK_STYLE=value;helper.style.add(_splashDialog.background,getBackgroundStyleClass(_SPLASHDIALOG_BCK_STYLE));helper.style.add(_splashDialog.container,getBackgroundStyleClass(_SPLASHDIALOG_BCK_STYLE))}function attachSplashDialog(){_splashDialog.body=_splashDialog.container.querySelector(".msgBody");_splashDialog.h2=_splashDialog.body.querySelector(".title");_splashDialog.img=_splashDialog.body.querySelector(".ecWaiting");_splashDialog.h4=_splashDialog.body.querySelector(".message");_splashDialog.btnClose=
_splashDialog.body.querySelector(".btnClose");helper.dom.addEvent(_splashDialog.btnClose,["touchend","click"],function(e){suppressMouseTouchEvent(e);window.close();if(document.referrer&&location.href!=document.referrer)location.href=document.referrer})}function establishingDialogShow(title,text,animated,closeButton){if(_splashDialog.container){helper.style.add(_splashDialog.img,"display:"+(animated?"inline-block":"none")+";");helper.style.remove(_splashDialog.img,"hidden");helper.style.add(_splashDialog.btnClose,
"display:"+(closeButton?"inline-block":"none")+";");_splashDialog.h2.innerHTML=title;_splashDialog.h4.innerHTML=text;helper.style.replace(_splashDialog.container,"noDisplay hidden","show");if(_SPLASHDIALOG_BCK_STYLE!==splashDialogBackgroundStyles.NONE)helper.style.replace(_splashDialog.background,"hidden","show")}}function establishingDialogHide(){if(_splashDialog.container&&helper.style.hasClass(_splashDialog.container,"show")){clearTimeout(_establishingDialog.timeoutId);_establishingDialog.timeoutId=
setTimeout(transitionEnd,_establishingDialog.timeout);helper.style.replace(_splashDialog.container,"show","hidden");if(_SPLASHDIALOG_BCK_STYLE!==splashDialogBackgroundStyles.NONE)helper.style.replace(_splashDialog.background,"show","hidden")}}function isJsonData(data){return["json","object"].indexOf(helper.object.getDataTypeOf(data))>=0}function choiceDialog(jData){if(arguments.length>1&&!isJsonData(jData)){jData={"parentElement":arguments[0],"class":arguments[1],"id":arguments[2],"iconType":arguments[3],
"title":arguments[4],"message":arguments[5],"buttons":[],"preAction":arguments.length>9?arguments[9]:false,"noPropagateEvents":arguments.length>10?arguments[10]:false,"events":{"block":arguments.length>11?arguments[11]:null}};if(arguments[6]){var v=arguments[6][0].split(":")[0];var c=arguments[6][0].split(":")[1];jData.buttons.push({"value":v,"class":c?c:"","action":arguments[7],"id":getBtnId()});if(arguments[6].length>1){v=arguments[6][1].split(":")[0];c=arguments[6][1].split(":")[1];jData.buttons.push({"value":v,
"class":c?c:"","action":arguments[8],"id":getBtnId()})}}}if(jData){var titleRow="";var header="";var classes="popup";if(helper.object.getHTMLType(jData.message))jData.message=jData.message.outerHTML;if(jData.iconType==""||jData.iconType==null||typeof jData.iconType=="undefined")jData.iconType="disconnectedIco";if((typeof jData.title=="undefined"||typeof jData.title=="null"||jData.title=="")&&jData.title!="none")jData.title=window.document.title;if(jData.class!="")classes+=" "+jData.class;var container=
helper.dom.createJsonElement({"type":"div","attributes":{"class":classes,"tabindex":0,"id":jData.id}});if(jData.title!="none"){var header=helper.dom.appendJsonElement({"parentElement":container,"type":"div","attributes":{"class":"header"}});var h3=helper.dom.appendJsonElement({"parentElement":header,"type":"h3","content":jData.title})}var alertBody=helper.dom.appendJsonElement({"parentElement":container,"type":"div","attributes":{"class":"alertBody"}});var title=helper.dom.appendJsonElement({"parentElement":alertBody,
"type":"div","attributes":{"id":jData.iconType},"content":"&nbsp;"});if(helper.object.getHTMLType(jData.message))alertBody.appendChild(jData.message);else alertBody.innerHTML+=jData.message;var br=helper.dom.appendJsonElement({"parentElement":container,"type":"br"});var buttons=helper.dom.appendJsonElement({"parentElement":container,"type":"div","attributes":{"class":"divbuttons"}});var context=jData.parentElement&&jData.parentElement.ownerDocument?jData.parentElement.ownerDocument:document;var strAction;
var eBlock=null;var onBlockCallBack=function(){for(var i=0;i<jData.buttons.length;i++)if(jData.buttons[i]&&jData.buttons[i].action instanceof Function){var id=jData.buttons[i].id;helper.dom.addEvent(context.getElementById(id),["touchend","click"],detectTouchWrapper(jData.buttons[i].action))}if(eBlock)eBlock()};var hasSelected=false;for(var i=0;i<jData.buttons.length;i++){if(!jData.buttons[i].class)jData.buttons[i].class="";if(!hasSelected&&jData.buttons[i].class.indexOf("selected")!=-1)hasSelected=
true}for(var i=0;i<jData.buttons.length;i++){strAction=null;if(typeof jData.buttons[i].action==="string")if(jData.buttons[i].action=="")jData.buttons[i].action=function(){unblockDialog()};else{var errorMsg="Use event function instead of 'string function name'";helper.console.warning(errorMsg,arguments);alert(errorMsg)}else if(typeof jData.buttons[i].action==="function"){var fnTemp=null;if(jData.preAction){fnTemp=function(fn){unblockDialog();fn()}.bind(null,jData.buttons[i].action);jData.buttons[i].action=
fnTemp}else{fnTemp=function(fn){fn();unblockDialog()}.bind(null,jData.buttons[i].action);jData.buttons[i].action=fnTemp}}else jData.buttons[i].action=function(){unblockDialog()};if(i==0&&!hasSelected){if(!jData.buttons[i].class)jData.buttons[i].class="";jData.buttons[i].class+=" selected"}if(jData.buttons[i].id!=="undefined")jData.buttons[i].id=getBtnId();var anchor=helper.dom.appendJsonElement({"parentElement":buttons,"type":"a","attributes":{"class":"popuplink "+(jData.buttons[i].class?jData.buttons[i].class:
""),"id":jData.buttons[i].id},"content":jData.buttons[i].value});if(i+1<jData.buttons.length)helper.dom.appendJsonElement({"parentElement":buttons,"type":"span","content":"&nbsp;"})}helper.dom.appendJsonElement({"parentElement":buttons,"type":"input","attributes":{"type":"text","class":"hiddenInput"}});jData.message=container;var popup=new popupDialog(null,jData.noPropagateEvents);if(!jData.events)jData.events={};if(jData.events.block)eBlock=jData.events.block;jData.events.block=onBlockCallBack;popup.block(jData);
return popup}else{helper.console.warning(helper.string.format("Cannot initialize {0}, {1} is undefined or null.","choiceDialog","jData"),arguments);return}}function alertDialog(jData){if(arguments.length>1&&!isJsonData(jData)||arguments.length===1&&helper.object.getTypeOf(arguments[0])==="string"){jData={"parentElement":arguments[4],"class":arguments[3],"id":arguments[2],"title":arguments[1],"message":arguments[0],"buttons":[],"noPropagateEvents":arguments.length>8?arguments[8]:false};var txt=typeof arguments[7]!=
"undefined"&&arguments[7]!=""?arguments[7]:arguments[6]&&!/.*mozilla.*/.exec(navigator.userAgent.toLowerCase())?consts.Close:consts.ok;if(arguments[5])jData.buttons.push({"value":txt,"action":arguments[5]})}if(jData){if(jData.message&&jData.message instanceof HTMLElement)jData.message=jData.message.outerHTML;var classes="popup";if((typeof jData.title=="undefined"||typeof jData.title=="null"||jData.title=="")&&jData.title!="none")jData.title=window.document.title;if(typeof jData.id=="undefined"||typeof jData.id==
"null"||jData.id=="")jData.id="alertDlg";if(jData.buttons.length==0)jData.buttons.push({"value":consts.ok,"action":"","id":getBtnId()});else if(typeof jData.buttons[0].action=="undefined"||!jData.buttons[0].action)jData.buttons[0].action="";if(jData.buttons[0].id!=="undefined")jData.buttons[0].id=getBtnId();var callback=typeof jData.buttons[0].action!==""?jData.buttons[0].action:"";if(jData.class!=""&&typeof jData.class!="undefined")classes+=" "+jData.class;var container=helper.dom.createJsonElement({"type":"div",
"attributes":{"class":classes,"tabindex":0,"id":jData.id}});if(jData.title!="none"){var header=helper.dom.appendJsonElement({"parentElement":container,"type":"div","attributes":{"class":"header"}});var h3=helper.dom.appendJsonElement({"parentElement":header,"type":"h3","content":jData.title})}var alertBody=helper.dom.appendJsonElement({"parentElement":container,"type":"div","attributes":{"class":"alertBody"}});var title=helper.dom.appendJsonElement({"parentElement":alertBody,"type":"div","attributes":{"id":"alertIco"},
"content":"&nbsp;"});if(helper.object.getHTMLType(jData.message))alertBody.appendChild(jData.message);else alertBody.innerHTML+=jData.message;var br=helper.dom.appendJsonElement({"parentElement":container,"type":"br"});var buttons=helper.dom.appendJsonElement({"parentElement":container,"type":"div","attributes":{"class":"divbuttons"}});var anchor=helper.dom.appendJsonElement({"parentElement":buttons,"type":"a","attributes":{"class":"popuplink selected","id":jData.buttons[0].id},"content":jData.buttons[0].value});
if(typeof callback==="string"&&callback=="")callback=function(){Thinfinity.Popups.unblock()};jData.message=container;var eBlock=null;var onBlockCallBack=function(){var context=null;if(typeof callback==="function"){if(jData.parentElement&&jData.parentElement.ownerDocument)context=jData.parentElement.ownerDocument;else context=document;helper.dom.addEvent(context.getElementById(jData.buttons[0].id),["touchend","click"],detectTouchWrapper(callback,this))}else if(typeof callback==="string"&&callback!==
""){var errorMsg="Use event function instead of 'string function name'";helper.console.warning(errorMsg,arguments);alert(errorMsg)}if(eBlock)eBlock()};var popup=new popupDialog(null,jData.noPropagateEvents);if(!jData.events)jData.events={};if(jData.events.block)eBlock=jData.events.block;jData.events.block=onBlockCallBack;popup.block(jData)}else{helper.console.warning(helper.string.format("Cannot initialize {0}, {1} is undefined or null.","alertDialog","jData"),arguments);return}}function messageDialog(jData){if(arguments.length>
1&&!isJsonData(jData))jData={"owner":arguments.length>5?arguments[5]:null,"parentElement":arguments[4],"class":arguments[3],"id":arguments[2],"title":arguments[1],"message":arguments[0],"standard":false,"events":{"block":arguments.length>6?arguments[6]:null},"noPropagateEvents":arguments.length>8?arguments[8]:false};if(jData){if(jData.message&&jData.message instanceof HTMLElement)jData.message=jData.message.outerHTML;jData.owner=jData.owner||(typeof THIN!="undefined"?THIN:typeof TVNC!="undefined"?
TVNC:null);var classes="popup";if(typeof jData.title=="undefined"||typeof jData.title=="null"||jData.title=="")jData.title=window.document.title;if(typeof jData.id=="undefined"||typeof jData.id=="null"||jData.id=="")jData.id="mssgDlg";if(jData.class!=""&&typeof jData.class!="undefined")classes+=" "+jData.class;if(jData.standard){var standard=helper.dom.createJsonElement({"type":"div","attributes":{"class":"standard"}});var span=helper.dom.appendJsonElement({"parentElement":standard,"type":"span"});
if(helper.object.getHTMLType(jData.message))span.appendChild(jData.message);else span.innerHTML=jData.message}var container=helper.dom.createJsonElement({"type":"div","attributes":{"class":classes,"tabindex":0,"id":jData.id}});if(jData.title!="none"){var header=helper.dom.appendJsonElement({"parentElement":container,"type":"div","attributes":{"class":"header"}});var h3=helper.dom.appendJsonElement({"parentElement":header,"type":"h3","content":jData.title})}var alertBody=helper.dom.appendJsonElement({"parentElement":container,
"type":"div","attributes":{"class":"alertBody"}});if(helper.object.getHTMLType(jData.message))alertBody.appendChild(jData.message);else alertBody.innerHTML+=jData.message;jData.message=container;var eBlock=null;var popup=new popupDialog(jData.owner,jData.noPropagateEvents);var onBlockCallBack=function(){if(eBlock)eBlock()};if(!jData.events)jData.events={};if(jData.events.block)eBlock=jData.events.block;jData.events.block=onBlockCallBack;popup.block(jData)}else{helper.console.warning(helper.string.format("Cannot initialize {0}, {1} is undefined or null.",
"messageDialog","jData"),arguments);return}}function growlDialog(jData){if(jData){var ht=_growls.top+_growls.height;var top=_growls.top+ht*_growls.dialogs.length;var type=helper.object.getValue(jData,"type",_growls.type.MESSAGE);var extraClass=_growls.type.getKey(type).toLowerCase();var destroy=function(e,container){return new Promise(function(resolve){if(e){e.preventDefault();e.stopPropagation();var src=e.srcElement||e.target;container=src.className.indexOf("growlDialogContainer")!=-1?src:src.parentElement}if(container.destroyed){resolve();
return}var nTop=container.nTop;helper.style.replace(container,"visible","hidden");setTimeout(function(){if(container?.parentElement)container.parentElement.removeChild(container);var dialog=null;var ridx=-1;for(var i=0,t=_growls.dialogs.length;i<t;i++){dialog=_growls.dialogs[i];if(dialog===container)ridx=i;else if(dialog.nTop>=nTop){dialog.nTop=_growls.dialogs[i].nTop-ht;dialog.style.top=dialog.nTop+"px"}}_growls.dialogs.splice(ridx,1);setTimeout(resolve,250)},500);container.destroyed=true})};var updateMessage=
function(msg){if(messageContainer){messageContainer.innerHTML=msg;messageContainer.title=msg}};var growlDialogContainer=helper.dom.createJsonElement({"type":"div","attributes":{"class":"growlDialogContainer hidden "+extraClass,"style":"top:"+top+"px","nTop":top}});helper.dom.addEvent(growlDialogContainer,["touchend","click"],function(e){suppressMouseTouchEvent(e);destroy(e);if(helper.object.existsPath(jData,"events.click"))jData.events.click(e)},false);var messageContainer=helper.dom.appendJsonElement({"parentElement":growlDialogContainer,
"type":"div","attributes":{"class":"messageContainer","title":jData.message.replace(/<[^>]*>/g,"")},"content":jData.message});var xContainer=helper.dom.appendJsonElement({"parentElement":growlDialogContainer,"type":"div","attributes":{"class":"xContainer thin-cancel-circled"}});document.body.appendChild(growlDialogContainer);helper.style.replace(growlDialogContainer,"hidden","visible");_growls.dialogs.push(growlDialogContainer);growlDialogContainer.destroyed=false;var obj={};Object.defineProperty(obj,
"destroy",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return destroy(null,growlDialogContainer)}});Object.defineProperty(obj,"destroyed",{"enumerable":true,"configurable":false,"get":function(){return growlDialogContainer.destroyed}});Object.defineProperty(obj,"message",{"enumerable":true,"configurable":false,"set":updateMessage});return obj}else return null}function unblockGrowls(){if(_growls&&_growls.dialogs){_growls.dialogs.forEach(function(elem){helper.style.replace(elem,
"visible","hidden");elem.parentElement.removeChild(elem)});_growls.dialogs=[]}}function unblockDialog(callback){if(typeof _POPUPDIALOG!=="undefined"&&_POPUPDIALOG!==null)_POPUPDIALOG.unblock(callback)}function disableHooks(){if(typeof THIN!="undefined"&&!_kbUnbound&&typeof THIN.unbindKeyboardEvents!="undefined"){var parentElem=_POPUPDIALOG&&_POPUPDIALOG.dlgId?document.getElementById(_POPUPDIALOG.dlgId):null;if(parentElem&&parentElem.parentElement)helper.dom.addEvent(parentElem.parentElement,"click",
cancelClickPropagation);THIN.unbindKeyboardEvents();_kbUnbound=true}}function restoreHooks(){if(typeof THIN!="undefined"&&_kbUnbound&&typeof THIN.bindKeyboardEvents!="undefined"){var parentElem=_POPUPDIALOG&&_POPUPDIALOG.dlgId?document.getElementById(_POPUPDIALOG.dlgId):null;if(parentElem&&parentElem.parentElement)helper.dom.removeEvent(parentElem.parentElement,"click",cancelClickPropagation);THIN.bindKeyboardEvents();_kbUnbound=false}}function cancelClickPropagation(e){e.stopPropagation()}function suppressMouseTouchEvent(e){try{if(window["TouchEvent"]&&
e&&e instanceof TouchEvent){if(e.preventDefault)e.preventDefault();if(e.stopPropagation)e.stopPropagation()}}catch(err){helper.console.warning("[suppressMouseTouchEvent] Failed while trying to handle touch and mouse events. ",arguments)}}function detectTouchWrapper(callback,ctx){return function(e){suppressMouseTouchEvent(e);callback.apply(ctx,arguments)}}function unblockAll(){$.unblockUI()}initialize();Object.defineProperty(_establishingDialogDefProp,"show",{"enumerable":true,"configurable":false,
"writable":false,"value":establishingDialogShow});Object.defineProperty(_establishingDialogDefProp,"hide",{"enumerable":true,"configurable":false,"writable":false,"value":establishingDialogHide});Object.defineProperty(_establishingDialogDefProp,"backgroundStyle",{"enumerable":true,"configurable":false,"get":function(){return _SPLASHDIALOG_BCK_STYLE},"set":setBackgroundStyle});Object.defineProperty(_ref,"establishing",{"enumerable":true,"configurable":false,"get":function(){return _establishingDialogDefProp}});
Object.defineProperty(_ref,"CONSTS",{"enumerable":false,"configurable":false,"get":function(){return _consts}});Object.defineProperty(_ref,"popup",{"enumerable":true,"configurable":false,"writable":false,"value":popupDialog});Object.defineProperty(_ref,"choice",{"enumerable":true,"configurable":false,"writable":false,"value":choiceDialog});Object.defineProperty(_ref,"alert",{"enumerable":true,"configurable":false,"writable":false,"value":alertDialog});Object.defineProperty(_ref,"message",{"enumerable":true,
"configurable":false,"writable":false,"value":messageDialog});Object.defineProperty(_ref,"growl",{"enumerable":true,"configurable":false,"writable":false,"value":growlDialog});Object.defineProperty(_ref.growl,"type",{"enumerable":true,"configurable":false,"get":function(){return _growls.type}});Object.defineProperty(_ref.growl,"unblockAll",{"enumerable":true,"configurable":false,"writable":false,"value":unblockGrowls});Object.defineProperty(_ref,"unblock",{"enumerable":true,"configurable":false,"writable":false,
"value":unblockDialog});Object.defineProperty(_ref,"unblockDialogs",{"enumerable":true,"configurable":false,"writable":false,"value":unblockAll});Object.defineProperty(_ref,"disableHooks",{"enumerable":true,"configurable":false,"writable":false,"value":disableHooks});Object.defineProperty(_ref,"restoreHooks",{"enumerable":true,"configurable":false,"writable":false,"value":restoreHooks});Object.defineProperty(_establishingDialogDefProp,"backgroundStyles",{"enumerable":true,"configurable":false,"get":function(){return splashDialogBackgroundStyles}})}
try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(!Thinfinity.Popups)Thinfinity.Popups=new Popups})();function csHTMLComponent(){}
csHTMLComponent.prototype={extend:function(ext){for(var e in ext)this[e]=ext[e]},createElement:function(type,attrColl,content){var elem=document.createElement(type);if(attrColl)for(var a in attrColl)if(a==="style"){var s=attrColl[a].replace(/ /g).split(";");s.forEach(function(item){var kvp=item.split(":");elem.style[kvp[0]]=kvp[1]})}else elem.setAttribute(a,attrColl[a]);elem.className+=" preventTouchExecution";if(content)elem.innerHTML=content;return elem},appendElement:function(parentElement,type,
attrColl,content){var elem=this.createElement(type,attrColl,content);parentElement.appendChild(elem);return elem},prependElement:function(parentElement,type,attrColl,content){var elem=this.createElement(type,attrColl,content);$(parentElement).prepend(elem);return elem}};csToolbar.prototype=new csHTMLComponent;
function csToolbar(id,jInfo,thinrdp){if(typeof id=="undefined")return;if(typeof jInfo=="undefined")return;var self=this;this.id=id;this.buttons=[];this.closeMenuTimer=null;this.buttonSelected=null;this.closeSubmenuTimer=null;this.optionSelected=null;this.itemClass="";this.tb=null;var thinrdp=typeof THIN!="undefined"?THIN:thinrdp;this.refreshLayout=function(){var w=20;var elems=self.buttons;for(e=0;e<self.buttons.length;e++){if($(self.buttons[e]).css("display")!="none")w+=$(self.buttons[e]).outerWidth(true);
self.buttons[e].mouseIn=0}$("#"+self.id).width(w)};this.attachEvents=function(elem,eventsObj){if(eventsObj.type==="action"){elem.event=eventsObj.event;let handler=function(e){e.preventDefault();e.stopPropagation();self.hideMenus();if(this.event)this.event(e)};$(elem).on("click",handler);$(elem).on("touchend",handler)}else if(eventsObj.type==="onoff"){elem.events=eventsObj.events;let handler=function(e){e.preventDefault();e.stopPropagation();self.hideMenus();if($(this).hasClass("pressed")){$(this).removeClass("pressed");
if(typeof this.events.toggle!="undefined"&&typeof this.events.toggle!="undefined")this.events.toggle(this);else if(typeof this.events!="undefined"&&typeof this.events.release!="undefined")this.events.release(this)}else{$(this).addClass("pressed");if(typeof this.events.toggle!="undefined"&&typeof this.events.toggle!="undefined")this.events.toggle(this);else if(typeof this.events!="undefined"&&typeof this.events.press!="undefined")this.events.press(this)}};$(elem).on("click",handler);$(elem).on("touchend",
handler)}else if(eventsObj.type==="submenu"){$(elem).addClass("subMenu");self.addSubMenu(elem,eventsObj.options);elem.events=eventsObj.events;$(elem).on("mouseenter touchend",function(){if(typeof this.events!="undefined"&&typeof this.events.mouseenter!="undefined")this.events.mouseenter(this);self.activeSubmenu(this)}).on("mouseleave",function(){this.mouseIn--})}};this.addMenu=function(id,options){var menu=this.appendElement(document.body,"DIV",{"id":id+"_sm","class":"toolbarMenu","style":"display:none"});
$(menu).on("mouseenter",function(){if(self.buttonSelected)self.buttonSelected.mouseIn++}).on("mouseleave",function(){if(self.buttonSelected)self.buttonSelected.mouseIn--});for(var op=0;op<options.length;op++){var opt=this.appendElement(menu,"DIV",{"id":options[op].id?options[op].id:id+"_sm_"+op},options[op].text);if(typeof options[op].attributes!="undefined")for(var at in options[op].attributes)$(opt).attr(at,options[op].attributes[at]);if(opt.className.indexOf("preventTouchExecution")==-1)opt.className+=
" preventTouchExecution";this.attachEvents(opt,options[op])}};this.clickMenuButton=function(button){button.pressed=!button.pressed;if(!button.pressed)self.releaseMenuButton(button);else{if(self.buttonSelected)self.releaseMenuButton(self.buttonSelected);self.activeMenuButton(button)}};this.activeMenuButton=function(button){$(button).addClass("pressed");$("#"+$(button).attr("id")+"_sm").css("left",$(button).offset().left-(document.body.scrollLeft||window.pageXOffset)).show();button.mouseIn=1;self.buttonSelected=
button;self.closeMenuTimer=window.setInterval(function(){if(!self.isOnMenu())self.releaseMenuButton(self.buttonSelected)},300)};this.releaseMenuButton=function(button){if(self.closeMenuTimer)window.clearInterval(self.closeMenuTimer);if(button){$(button).removeClass("pressed");$("#"+$(button).attr("id")+"_sm").hide();button.mouseIn=0;button.pressed=false}self.buttonSelected=null};this.hideMenus=function(){if(this.optionSelected)this.releaseSubmenu(this.optionSelected);if(this.buttonSelected)this.releaseMenuButton(this.buttonSelected)};
this.isOnMenu=function(){return self.buttonSelected!=null&&self.buttonSelected.mouseIn>0||this.isOnSubmenu()};this.addSubMenu=function(option,subOptions){var id=$(option).attr("id")+"_sm";var menu=this.appendElement(document.body,"DIV",{"id":id,"class":"toolbarMenu","style":"display:none"});$(menu).on("mouseenter",function(){if(self.optionSelected)self.optionSelected.mouseIn++}).on("mouseleave",function(){if(self.optionSelected)self.optionSelected.mouseIn--});for(var op=0;op<subOptions.length;op++){var opt=
this.appendElement(menu,"DIV",{"id":subOptions[op].id?subOptions[op].id:id+"_"+op},subOptions[op].text);this.attachEvents(opt,subOptions[op]);if(typeof subOptions[op].attributes!="undefined")for(var at in subOptions[op].attributes)$(opt).attr(at,subOptions[op].attributes[at]);if(opt.className.indexOf("preventTouchExecution")==-1)opt.className+=" preventTouchExecution"}};this.activeSubmenu=function(option){$(option).addClass("pressed");$("#"+$(option).attr("id")+"_sm").css("left",$(option).offset().left+
$(option).outerWidth(true)-(document.body.scrollLeft||window.pageXOffset)).css("top",$(option).offset().top-(document.body.scrollTop||window.pageYOffset)).show();option.mouseIn=1;if(self.optionSelected)self.releaseSubmenu(self.optionSelected);self.optionSelected=option;self.closeSubmenuTimer=window.setInterval(function(){if(!self.isOnSubmenu())self.releaseSubmenu(self.optionSelected)},300)};this.releaseSubmenu=function(option){if(self.closeSubmenuTimer)window.clearInterval(self.closeSubmenuTimer);
if(option){$(option).removeClass("pressed");$("#"+$(option).attr("id")+"_sm").hide();option.mouseIn=0;option.pressed=false}self.optionSelected=null};this.isOnSubmenu=function(){return self.optionSelected!=null&&self.optionSelected.mouseIn>0};this.addButton=function(btnObj){if(self.itemClass!=""){var attr=btnObj.attributes["class"];if(typeof attr!="undefined")btnObj.attributes["class"]=self.itemClass+" "+attr;else btnObj.attributes["class"]=self.itemClass}var button=this.appendElement(self.tb,"DIV",
btnObj.attributes,btnObj.html);if(btnObj.type==="tbsubmenu"){button.pressed=false;this.addMenu(btnObj.attributes.id,btnObj.options);let handlerClick=function(){self.clickMenuButton(this)};$(button).on("click",handlerClick).on("touchend",handlerClick).on("mouseleave",function(){this.mouseIn--}).on("mouseenter",function(){if(self.buttonSelected&&self.buttonSelected!=this)self.clickMenuButton(this);else this.mouseIn++})}else if(typeof btnObj.events!="undefined"){button.events={};for(var ev=0;ev<btnObj.events.length;ev++){let events=
[];if(btnObj.events[ev].name==="click")events.push("touchend","mouseup");else events.push(btnObj.events[ev].name);events.forEach(en=>{button.events[en]=btnObj.events[ev].action;$(button).on(en,function(e){button.events[e.type](e)})})}}self.buttons.push(button)};this.addButtons=function(buttons){if(!!buttons)for(var b=0;b<buttons.length;b++)this.addButton(buttons[b])};this.purgeOptions=function(buttons,restrictions){for(var tbr=0;tbr<restrictions.length;tbr++){var tbPath=restrictions[tbr].split(".");
var n=0;while(n<buttons.length&&buttons[n].attributes.id!=tbPath[0])n++;if(n<buttons.length)if(tbPath.length==1)buttons.splice(n,1);else{var elements=buttons[n].options;var level=1;while(typeof elements!="undefined"&&level<tbPath.length){n=0;while(n<elements.length&&elements[n].id!=tbPath[level])n++;if(n<elements.length&&level<tbPath.length-1)elements=elements[n].options;level++}if(level==tbPath.length&&n<elements.length)elements.splice(n,1);else console.log("item related to toolbar restriction "+
tbPath.join(".")+" not found")}else console.log("item related to toolbar restriction "+tbPath.join(".")+" not found")}};this.removeOption=function(itemName){var optBtn=document.getElementById(itemName);if(optBtn){this.removeSubMenu(itemName);$(optBtn).off();optBtn.parentElement.removeChild(optBtn)}};this.removeSubMenu=function(itemName){var sm=document.getElementById(itemName+"_sm");if(sm){var options=$(sm).find("div");for(var d=options.length-1;d>=0;d--)this.removeOption(options[d].id);$(sm).off();
sm.parentElement.removeChild(sm)}};this.destroy=function(){if(this.tb==null)return;var options=$(this.tb).find("."+self.itemClass);for(var o=options.length-1;o>=0;o--)this.removeOption(options[o].getAttribute("id"));if(this.tb.parentElement!=null)this.tb.parentElement.removeChild(this.tb);this.tb=null};this.show=function(){self.tb.style.visibility="visible"};this.hide=function(){self.tb.style.visibility="hidden"};this.expand=function(){if(!this.isVisible())$("#tbRdpHandle"+self.id).click()};this.contract=
function(){if(this.isVisible())$("#tbRdpHandle"+self.id).click()};jInfo.attributes.id=id;this.tb=this.appendElement(document.body,"DIV",jInfo.attributes);if(typeof jInfo.itemClass!="undefined")self.itemClass=jInfo.itemClass;this.addButtons(jInfo.buttons);var tbRdpHandle=this.appendElement(this.tb,"DIV",{"id":"tbRdpHandle"+self.id,"class":"tbRdpHandle flppd"},"<hr/>");let handler=function(e){e.preventDefault();e.stopPropagation();if($("#tbRdpHandle"+self.id).hasClass("flppd")){$("#"+self.id).animate({"top":"0px"},
200);$("#tbRdpHandle"+self.id).removeClass("flppd")}else{$("#"+self.id).animate({"top":"-"+$("#"+self.id).outerHeight(true)+"px"},200);$("#tbRdpHandle"+self.id).addClass("flppd")}};$("#tbRdpHandle"+self.id).on("click",handler);$("#tbRdpHandle"+self.id).on("touchend",handler);this.isVisible=function(){return!$("#tbRdpHandle"+self.id).hasClass("flppd")};return this}csNavigatorControl.prototype=new csHTMLComponent;
function csNavigatorControl(settings){this.NCM_SIMPLE=0;this.NCM_WINDROSE=1;this.NCM_MINIM=2;var self=this;var mode=this.NCM_SIMPLE;this.visible=false;this.offset=1;for(var s in settings)this[s]=settings[s];this.setMode=function(m){if(m<this.NCM_SIMPLE||m>this.NCM_MINIM)return false;mode=m};this.move=function(x,y){if(!!this.onMove)this.onMove(x,y)};this.zoomIn=function(){if(!!this.onZoomIn)this.onZoomIn()};this.zoomOut=function(){if(!!this.onZoomOut)this.onZoomOut()};this.shrinkToBrowser=function(){if(!!this.onShrinkToBrowser)this.onShrinkToBrowser()};
this.actualPixels=function(){if(!!this.onActualPixels)this.onActualPixels()};this.insertPane=function(){var navControl=document.getElementById("navControl");if(!navControl){var navControl=this.createElement("div",{"id":"navControl","style":"display:none"},null);if(mode==this.NCM_WINDROSE)navControl.className="windrose"}else navControl.innerHTML="";if(mode!=this.NCM_MINIM){this.appendElement(navControl,"div",{"class":"navCtrl_button","id":"move_up"},null);this.appendElement(navControl,"div",{"class":"navCtrl_button",
"id":"move_left"},null)}this.appendElement(navControl,"div",{"class":"navCtrl_button","id":"zoom_out"},null);this.appendElement(navControl,"div",{"class":"navCtrl_button","id":"zoom_in"},null);this.appendElement(navControl,"div",{"class":"navCtrl_button","id":"zoom_shrink"},null);this.appendElement(navControl,"div",{"class":"navCtrl_button","id":"zoom_actual"},null);if(mode!=this.NCM_MINIM){this.appendElement(navControl,"div",{"class":"navCtrl_button","id":"move_right"},null);this.appendElement(navControl,
"div",{"class":"navCtrl_button","id":"move_down"},null)}document.body.appendChild(navControl);$("#move_up, #move_down, #move_left, #move_right, #zoom_in, #zoom_out, #zoom_shrink, #zoom_actual").bind("click",function(e){switch((e.target||e.srcElement).id){case "move_up":self.move(0,-self.offset);break;case "move_down":self.move(0,self.offset);break;case "move_left":self.move(-self.offset,0);break;case "move_right":self.move(self.offset,0);break;case "zoom_in":self.zoomIn();break;case "zoom_out":self.zoomOut();
break;case "zoom_shrink":self.shrinkToBrowser();break;case "zoom_actual":self.actualPixels();break}e.stopPropagation()})};this.show=function(){var z=this.onGetZIndex?this.onGetZIndex():99999999;$("#navControl").css("z-index",z).show();this.visible=true};this.hide=function(){$("#navControl").hide();this.visible=false};this.isVisible=function(){return this.visible};return this}
(function(){function VisualEffect(args){var _ref=this;var _args={"id":null,"container":null,"btnCancelId":"cancelRecnx","allowReconnectionDialog":true,"reconnection":{"timeout":2E4},"events":{"onCancel":null}};var _elements={"wall":null,"panel":null,"button":null};function initialize(args){helper.object.parseAttributes(_args,args,"MATCH");if(supportGrayScale())helper.style.replace(_args.container,"grayscale","color")}function supportGrayScale(){var supportGrayscale=false;switch(true){case agentInfo.isMSIE&&
agentInfo.msieVersion<=10:break;default:supportGrayscale=true;break}return supportGrayscale}function getNextHighestZindex(obj){var highestIndex=0;var currentIndex=0;var elArray=Array();if(obj)elArray=obj.getElementsByTagName("*");else elArray=document.getElementsByTagName("*");for(var i=0;i<elArray.length;i++){if(elArray[i].currentStyle)currentIndex=parseFloat(elArray[i].currentStyle["zIndex"]);else if(window.getComputedStyle)currentIndex=parseFloat(document.defaultView.getComputedStyle(elArray[i],
null).getPropertyValue("z-index"));if(!isNaN(currentIndex)&&currentIndex>highestIndex)highestIndex=currentIndex}return highestIndex+1}function toGrayScale(connectionLost){if(!_elements.wall){_elements.wall=helper.dom.appendJsonElement({"parentElement":_args.container,"type":"div","attributes":{"id":_args.id,"class":"reconnectDivId in","style":helper.string.format("z-index:{0};",getNextHighestZindex(document.body))}});if(supportGrayScale())helper.style.replace(_args.container,"color","grayscale")}if(connectionLost&&
_args.allowReconnectionDialog&&!_elements.panel)setAbortPanel();return true}function setAbortPanel(){_elements.panel=helper.dom.appendJsonElement({"parentElement":_args.container,"type":"div","attributes":{"style":helper.string.format("-webkit-box-shadow: 1px 1px 15px #000;-moz-box-shadow: 1px 1px 15px #000; position:absolute; top:50%; left:50%; transform:translate3d(-50%, -50%, 0); ;z-index:{0}; padding:20px;;-moz-border-radius: 7px;border-radius: 7px; font-size:14px; font-weight:normal; text-align:center",
getNextHighestZindex(document.body)),"class":"popup connectionLost"},"content":consts.connLostReconnecting+"</br>"});_elements.button=helper.dom.appendJsonElement({"parentElement":_elements.panel,"type":"button","attributes":{"id":_args.btnCancelId,"class":"p-button"},"events":{"click":function(e){if(helper.object.existsPath(_args,"events.onCancel"))try{_args.events.onCancel(e)}catch(error){helper.console.error(error.message,error,arguments)}}},"content":consts.abort})}function toColor(){if(_elements.wall){helper.style.replace(_elements.wall,
"in","out");helper.style.replace(_args.container,"grayscale","color");if(_elements.panel){_args.container.removeChild(_elements.panel);_elements.button=null;_elements.panel=null}_args.container.removeChild(_elements.wall);_elements.wall=null}return true}initialize(args);Object.defineProperty(_ref,"toGrayScale",{"enumerable":true,"configurable":false,"value":toGrayScale});Object.defineProperty(_ref,"toColor",{"enumerable":true,"configurable":false,"value":toColor});return this}try{Thinfinity!=undefined}catch(e){Thinfinity=
{}}Thinfinity.VisualEffect=VisualEffect})();
function Plugin(){function getActiveXObject(name){try{return new ActiveXObject(name)}catch(e){}}function getNavigatorPlugin(name){for(key in navigator.plugins){var plugin=navigator.plugins[key];if(plugin.name==name)return plugin}}function getDefaultPDFPlugin(){for(var key in navigator.plugins){var plugin=navigator.plugins[key];if(plugin.name){var n=plugin.name.toLowerCase();if(n.indexOf("pdf")!=-1&&n.indexOf("webkit")!=-1)return plugin}}if(typeof window.pdfjsSupport!="undefined")return{}}function isPDFPluginInstalled(){var plugin=
null;switch(true){case agentInfo.isMSIE:if(agentInfo.msieVersion<=11)plugin=getActiveXObject("AcroPDF.PDF")||getActiveXObject("PDF.PdfCtrl");else plugin={};break;case agentInfo.isFirefox:case agentInfo.isChrome:case agentInfo.isOpera:case agentInfo.isSafari:case agentInfo.isYandex:plugin={};break;default:if(agentInfo.isIOS&&agentInfo.isTouch&&agentInfo.iosVersion>=8)plugin={};else plugin=getNavigatorPlugin("Adobe Acrobat")||getNavigatorPlugin("Chrome PDF Viewer")||getNavigatorPlugin("Chromium PDF Viewer")||
getNavigatorPlugin("WebKit built-in PDF")||getDefaultPDFPlugin();break}return plugin!=null&&typeof plugin!="undefined"}Object.defineProperty(this,"isPDFInstalled",{"enumerable":true,"configurable":false,"writeble":false,"value":isPDFPluginInstalled});return this}var plugin=new Plugin;
function CanvasPrinter(events){var self=this;this.PM_NONE=-1;this.PM_FULLCOLOR=0;this.PM_GRAYSCALED=1;this.PM_INVERTEDGRAYSCALE=2;this.PM_BLACKANDWHITE=3;this.drawBorder=false;this.useIFrame=true;this.printMode=this.PM_BLACKANDWHITE;this.title="";this.footer="";this.window=window;this.events=events;this.prnW=null;this.printFrameRef=null;var PIXEL_WIDTH=144*10;var debugging=helper.url.gup("debug")=="1";var _queuePrinting={"startPrintingTime":null,"printingInterval":null,"printingIntervalTime":500,
"maxDelayPrintingTime":12E4,"isPrinting":false};this.getCanvasPrinterMode=function(mode){mode=helper.object.convertTo(mode,"number");if(!isNaN(mode)&&(mode<this.PM_NONE||mode>this.PM_BLACKANDWHITE))mode=this.PM_NONE;return mode};this.getPrintIFrame=function(){var ifrm=document.createElement("iframe");ifrm.style.position="absolute";if(agentInfo.isMobile==true&&agentInfo.isChrome==true)ifrm.id="iframeToPrint";ifrm.style.left="-20000px";document.body.appendChild(ifrm);return ifrm};this.destroyPrintIFrame=
function(){try{if(self.printFrameRef!=null){helper.dom.removeEvent(window,"onmessage",self.dispatchPrint);document.body.removeChild(self.printFrameRef);delete self.printFrameRef;delete self.prnW}}catch(error){}finally{self.printFrameRef=null;self.prnW=null}};this.cloneCanvas=function(srcCanvas){if(debugging)logDebug("start cloneCanvas");var newCanvas=document.createElement("canvas");newCanvas.width=srcCanvas.width;newCanvas.height=srcCanvas.height;var context=newCanvas.getContext("2d",{willReadFrequently:true});
context.drawImage(srcCanvas,0,0);if(this.drawBorder)context.strokeRect(0,0,srcCanvas.width,srcCanvas.height);if(debugging)logDebug("end cloneCanvas");return newCanvas};this.grayScaledCanvas=function(srcCanvas,inverted){if(debugging){logDebug("start grayScaledCanvas");logDebug("getContext")}var srcContext=srcCanvas.getContext("2d",{willReadFrequently:true});if(debugging)logDebug("getImageData");var imgPixels=srcContext.getImageData(0,0,srcCanvas.width,srcCanvas.height);var data=imgPixels.data;if(debugging)logDebug("proccess");
if(inverted)for(var i=0;i<imgPixels.data.length;i+=4){var avg=(data[i]+data[i+1]+data[i+2])/3;data[i]=data[i+1]=data[i+2]=255^avg}else for(var i=0;i<imgPixels.data.length;i+=4){var avg=(data[i]+data[i+1]+data[i+2])/3;data[i]=data[i+1]=data[i+2]=avg}if(debugging)logDebug("create new canvas");var newCanvas=document.createElement("canvas");if(debugging)logDebug("get ctx");var ctx=newCanvas.getContext("2d",{willReadFrequently:true});newCanvas.width=srcCanvas.width;newCanvas.height=srcCanvas.height;if(debugging)logDebug("putImageData");
ctx.putImageData(imgPixels,0,0,0,0,imgPixels.width,imgPixels.height);if(this.drawBorder)ctx.strokeRect(0,0,imgPixels.width,imgPixels.height);if(debugging)logDebug("end grayScaledCanvas");return newCanvas};this.BWCanvas=function(srcCanvas){if(debugging)logDebug("start BWCanvas");if(debugging)logDebug("getContext");var srcContext=srcCanvas.getContext("2d");if(debugging)logDebug("getImageData");var imgPixels=srcContext.getImageData(0,0,srcCanvas.width,srcCanvas.height);var data=imgPixels.data;var bgColor=
data[0]*255*255*255+data[1]*255*255+data[2]*255;if(debugging)logDebug("proccess");for(var i=0;i<data.length;i+=4){var color=data[i]*255*255*255+data[i+1]*255*255+data[i+2]*255;data[i]=data[i+1]=data[i+2]=color==bgColor?255:0}if(debugging)logDebug("create new canvas");var newCanvas=document.createElement("canvas");if(debugging)logDebug("get ctx");var ctx=newCanvas.getContext("2d",{willReadFrequently:true});newCanvas.width=srcCanvas.width;newCanvas.height=srcCanvas.height;if(debugging)logDebug("putImageData");
ctx.putImageData(imgPixels,0,0,0,0,imgPixels.width,imgPixels.height);if(this.drawBorder)ctx.strokeRect(0,0,imgPixels.width,imgPixels.height);if(debugging)logDebug("end BWCanvas");return newCanvas};this.setTitle=function(value){this.title=value};this.setFooter=function(value){this.footer=value};this.getScreenShot=function(canvas,mode,width,height,success){if(debugging)logDebug("GetScreenShot. Mode="+mode);if(canvas){var wc=width/canvas.width;var hc=height/canvas.height;var co=Math.min(1,wc,hc);var img=
new Image;img.width=canvas.width*co;img.height=canvas.height*co;img.onload=function(e){img.onload=null;if(e.target!=undefined&&typeof e.target.complete=="undefined"||e.target.complete==true){if(debugging)logDebug("GetScreenshot - img.onload - no retries");success(img)}else{var maxTimes=10;var countTimes=0;function retryLoadImage(){setTimeout(function(){if(countTimes>maxTimes){if(debugging)logDebug("GetScreenshot - retryLoadImage - countTimes overflow: "+countTimes);return}else if(e.target!=undefined&&
typeof e.target.complete=="undefined"||e.target.complete==true){if(debugging)logDebug("GetScreenshot - retryLoadImage - countTimes: "+countTimes);success(img)}else retryLoadImage();countTimes++},50)}}};if(debugging)logDebug("GetScreenshot - create new canvas");var newCanvas=this.printableCanvas(canvas,mode);if(debugging)logDebug("GetScreenshot - apply src");img.src=newCanvas.toDataURL("image/jpeg");if(debugging)logDebug("GetScreenshot - done")}else if(debugging)logDebug("GetScreenshot - canvas don't exists!")};
this.printableCanvas=function(canvas,mode){if(typeof mode=="undefined")mode=this.printMode;switch(mode){case this.PM_FULLCOLOR:return this.cloneCanvas(canvas);break;case this.PM_GRAYSCALED:return this.grayScaledCanvas(canvas);break;case this.PM_INVERTEDGRAYSCALE:return this.grayScaledCanvas(canvas,true);break;case this.PM_BLACKANDWHITE:return this.BWCanvas(canvas);break}};this.print=function(canvas){if(canvas)if(agentInfo.isMSIE&&agentInfo.msieVersion<=11){self.canvas=canvas;var prnInstance=window.open("",
"prnW","title='Printing',width=1,height=1,outerWidth=1, outerHeight=1",false);prnInstance.document.title=this.title;$(prnInstance.document.head).append('<style>@media print { @page{ size: 8.5in 11in landscape; } header:after {content: "'+this.title+'";} } img { width: 10.5in !important; max-width: 10.5in !important; } html,body,div {margin:0px;padding:0px;width:100%;display:table-cell;'+"text-align:center;vertical-align:middle;}</style>");var div=prnInstance.document.createElement("div");var cnv=
self.printableCanvas(canvas);var coef=cnv.height/cnv.width;var img=prnInstance.document.createElement("image");img.width=PIXEL_WIDTH;img.height=Math.floor(PIXEL_WIDTH*coef);div.appendChild(img);prnInstance.document.body.appendChild(div);img.onload=function(){function printLoadedImage(){prnInstance.focus();prnInstance.print();prnInstance.close()}if(typeof img.complete=="undefined"||img.complete==true)printLoadedImage();else{var maxTimes=10;var countTimes=0;function retryLoadImage(){setTimeout(function(){if(countTimes>
maxTimes)return;else if(img.complete)printLoadedImage();else retryLoadImage();countTimes++},50)}}};var cnv=self.printableCanvas(self.canvas);img.src=cnv.toDataURL("image/png")}else{self.destroyPrintIFrame();if(typeof keyboardHelper!="undefined"&&keyboardHelper!=null){var cnv=self.printableCanvas(canvas);if(cnv){var src=cnv.toDataURL("image/png");var img=document.createElement("img");var prnBefore=document.getElementById("prnBefore");img.style.display="inline";img.style.zIndex=9999999999999;img.style.position=
"absolute";img.style.top="0px";img.style.left="0px";document.body.insertBefore(img,prnBefore);img.onload=function(e){img.width=e.target.width;img.height=e.target.height;img.style.width=img.width+"px";img.style.height=img.height+"px";setTimeout(function(){prnBefore.style.visibility="hidden";window.focus();window.print();setTimeout(function(){document.body.removeChild(img);prnBefore.style.visibility="visible";window.focus();try{if(typeof thinZS!="undefined")thinZS.zoomDesktop(1)}catch(error){}keyboardHelper.getFocus()},
1E3);return},250)};img.src=src}}else{helper.dom.addEvent(window,"onmessage",self.dispatchPrint);if(self.useIFrame){self.printFrameRef=this.getPrintIFrame();self.prnW=self.printFrameRef.contentWindow||self.printFrameRef.contentDocument;detectingPrintEnd()}else self.prnW=window.open("","prnW","",true);self.canvas=canvas;self.prnW.location.href=`${Thinfinity.global.variables.basePath}print.html`}}else if(typeof this.events!="undefined"&&typeof this.events.onCanvasNotFound!="undefined")this.events.onCanvasNotFound();
else $(window).trigger("CANVASNOTFOUND")};function detectingPrintEnd(){function done(){clearInterval(_queuePrinting["printingInterval"]);_queuePrinting.isPrinting=false;helper.dom.removeEvent(window,"onmessage",self.dispatchPrint);window.focus()}_queuePrinting["startPrintingTime"]=(new Date).getTime();clearInterval(_queuePrinting["printingInterval"]);_queuePrinting["printingInterval"]=setInterval(function(){if(document.activeElement&&!document.hasFocus())_queuePrinting.isPrinting=true;else done();
if((new Date).getTime()-_queuePrinting["startPrintingTime"]>_queuePrinting["maxDelayPrintingTime"]){clearInterval(_queuePrinting["printingInterval"]);_queuePrinting.isPrinting=false}},_queuePrinting["printingIntervalTime"])}this.dispatchPrint=function(e){var obj=null;if(e&&e.data)try{var type=helper.object.getDataTypeOf(e.data);obj=type==="object"?e.data:type==="json"?JSON.parse(e.data):null}catch(error){obj=null}if(obj&&obj.evt&&obj.evt=="PRINT_SCREEN"){var cnv=self.printableCanvas(self.canvas);
obj={"evt":"PRINT","title":self.title,"src":cnv.toDataURL("image/png")};self.prnW.postMessage(JSON.stringify(obj),"*")}};if(window.addEventListener)window.addEventListener("message",self.dispatchPrint,false);else window.attachEvent("onmessage",self.dispatchPrint);return this}
(function(){function PrintScreenPreview(args){var _ref=this;var _args={"parentElement":null,"methods":{"getCanvas":null,"getInfo":null,"getCanvasPrinter":null,"printScreen":null},"elements":{"body":".printBody","btnPrint":".btnPrintScreenPreview","btnClose":".btnCloseScreenPreview","btnBAW":".pspBlackAndWhite","btnInvGray":".pspInvertedGrayScaled","btnGray":".pspGrayScaled","btnColor":".pspFullColor"}};var _wPrintScreenPreview=null;var _canvasPrinter=null;function initialize(args){helper.object.parseAttributes(_args,
args,"MATCH");if(_args.methods.getCanvasPrinter)_canvasPrinter=_args.methods.getCanvasPrinter();if(!_canvasPrinter)_canvasPrinter=getDefaultCanvasPrinter();if(_args.parentElement){helper.style.addClass(_args.parentElement,"printScreenPreviewPopup");helper.style.removeClass(_args.parentElement,"hidden");for(var elem in _args.elements)if(typeof _args.elements[elem]==="string")_args.elements[elem]=_args.parentElement.querySelector(_args.elements[elem])}}function getDefaultCanvasPrinter(){if(typeof CanvasPrinter!==
"undefined")return new CanvasPrinter({onCanvasNotFound:function(){helper.console.warning(helper.string.format("WARNING: Canvas not found",""),arguments)}});else helper.console.warning(helper.string.format("WARNING: CanvasPrinter not found",""),arguments);return null}function attachEvents(){helper.dom.addEvent(_args.elements.btnPrint,["touchend","click"],e=>{suppressMouseTouchEvent(e);_wPrintScreenPreview.print(function(){_wPrintScreenPreview.hide()},true)});helper.dom.addEvent(_args.elements.btnClose,
["touchend","click"],e=>{suppressMouseTouchEvent(e);closePrintScreenPreview()});helper.dom.addEvent(_args.elements.btnBAW,["touchend","click"],e=>{suppressMouseTouchEvent(e);_wPrintScreenPreview.setPrnScrMode(_args.elements.btnBAW,_canvasPrinter.PM_BLACKANDWHITE)});helper.dom.addEvent(_args.elements.btnGray,["touchend","click"],e=>{suppressMouseTouchEvent(e);_wPrintScreenPreview.setPrnScrMode(_args.elements.btnGray,_canvasPrinter.PM_GRAYSCALED)});helper.dom.addEvent(_args.elements.btnInvGray,["touchend",
"click"],e=>{suppressMouseTouchEvent(e);_wPrintScreenPreview.setPrnScrMode(_args.elements.btnInvGray,_canvasPrinter.PM_INVERTEDGRAYSCALE)});helper.dom.addEvent(_args.elements.btnColor,["touchend","click"],e=>{suppressMouseTouchEvent(e);_wPrintScreenPreview.setPrnScrMode(_args.elements.btnColor,_canvasPrinter.PM_FULLCOLOR)})}function initializePrintScreenPreview(){var self=this;var _printScreenMode=-1;var _srcElem=_args.methods.getCanvas();var _tempCanvas=null;this.show=function(){var self=this;helper.style.addClass(_args.elements.btnPrint,
"disabled");_args.parentElement.querySelectorAll(".pspscreenshot").forEach(function(elem){elem.innerHTML='<img src="'+Thinfinity.global.variables.basePath+'"/common/images/core/loadajax.gif"/>';helper.style.removeClass(elem,"selected")});$.blockUI({message:_args.parentElement,css:{"background":"transparent","top":"0px","left":"0px","padding":"0px","margin":"0px","width":"100%","height":"100%","textAlign":"center","border":"none","cursor":"auto"},centerX:true,centerY:true,onBlock:function(){_args.parentElement.style.visibility=
"visible";Thinfinity.Popups.disableHooks();self.bindKeyboard();_args.parentElement.focus();_canvasPrinter.drawBorder=true;var s=helper.size.get(_args.elements.btnBAW);var w=Math.floor(s.width*.9);var h=Math.floor(s.height*.9);_tempCanvas=self.getSrcCanvas();_canvasPrinter.getScreenShot(_tempCanvas,_canvasPrinter.PM_BLACKANDWHITE,w,h,function(img){setPrintPreviewImage(_args.elements.btnBAW,img)});_canvasPrinter.getScreenShot(_tempCanvas,_canvasPrinter.PM_GRAYSCALED,w,h,function(img){setPrintPreviewImage(_args.elements.btnGray,
img)});_canvasPrinter.getScreenShot(_tempCanvas,_canvasPrinter.PM_INVERTEDGRAYSCALE,w,h,function(img){setPrintPreviewImage(_args.elements.btnInvGray,img)});_canvasPrinter.getScreenShot(_tempCanvas,_canvasPrinter.PM_FULLCOLOR,w,h,function(img){setPrintPreviewImage(_args.elements.btnColor,img)})}})};this.hide=function(){this.unbindEvents();$.unblockUI({onUnblock:function(){Thinfinity.Popups.restoreHooks()}})};this.unbindEvents=function(){this.unbindKeyboard()};this.bindKeyboard=function(){helper.dom.addEvent(_args.parentElement,
"keydown",parentElement_keydown)};this.unbindKeyboard=function(){helper.dom.removeEvent(_args.parentElement,"keydown",parentElement_keydown)};function parentElement_keydown(e){if(e.keyCode=="27"){e.stopPropagation();_args.elements.btnClose.click()}}this.getSrcCanvas=function(){var srcCanvas=document.createElement("canvas");srcCanvas.width=_srcElem instanceof HTMLVideoElement?_srcElem.videoWidth:_srcElem.width;srcCanvas.height=_srcElem instanceof HTMLVideoElement?_srcElem.videoHeight:_srcElem.height;
var srcContext=srcCanvas.getContext("2d",{willReadFrequently:true});srcContext.drawImage(_srcElem,0,0);return srcCanvas};this.setPrnScrMode=function(elem,mode){_args.parentElement.querySelectorAll(".pspscreenshot").forEach(function(elem){helper.style.removeClass(elem,"selected")});helper.style.addClass(elem,"selected");_printScreenMode=mode;helper.style.removeClass(_args.parentElement,"disabled")};this.print=function(callback,useTempCanvas){if(_printScreenMode!=-1){var info=_args.methods.getInfo();
var _printCanvas=null;if(useTempCanvas===true)_printCanvas=_tempCanvas;else _printCanvas=this.getSrcCanvas();args.methods.printScreen(_printCanvas,info.title,info.detail,_printScreenMode,callback)}};this.setPrintScreenMode=function(mode){_printScreenMode=helper.object.getTypeOf(mode)=="string"&&"PM_FULLCOLOR;PM_INVERTEDGRAYSCALE;PM_GRAYSCALED;PM_BLACKANDWHITE".indexOf(mode.toUpperCase())!=-1?_canvasPrinter[mode.toUpperCase()]:_canvasPrinter.getCanvasPrinterMode(mode)};return this}function showPrintScreenPreview(){if(!_wPrintScreenPreview){_wPrintScreenPreview=
new initializePrintScreenPreview;attachEvents()}if(helper.object.existsPath(window,"customSettings.printScreen.defaultPrintMode")){_wPrintScreenPreview.setPrintScreenMode(window.customSettings.printScreen.defaultPrintMode);_wPrintScreenPreview.print(null)}else _wPrintScreenPreview.show()}function closePrintScreenPreview(){_wPrintScreenPreview.hide()}function setPrintPreviewImage(elem,img){var oldImg=elem.getElementsByTagName("img")[0];if(oldImg)elem.removeChild(oldImg);elem.appendChild(img)}function getCanvasPrinter(){return _canvasPrinter}
function suppressMouseTouchEvent(e){try{if(window["TouchEvent"]&&e&&e instanceof TouchEvent){if(e.preventDefault)e.preventDefault();if(e.stopPropagation)e.stopPropagation()}}catch(err){helper.console.warning("[suppressMouseTouchEvent] Failed while trying to handle touch and mouse events. ",arguments)}}initialize(args);Object.defineProperty(_ref,"show",{"enumerable":true,"configurable":false,"writable":false,"value":showPrintScreenPreview});Object.defineProperty(_ref,"hide",{"enumerable":true,"configurable":false,
"writable":false,"value":closePrintScreenPreview});Object.defineProperty(_ref,"set",{"enumerable":true,"configurable":false,"writable":false,"value":setPrintPreviewImage});Object.defineProperty(_ref,"getCanvasPrinter",{"enumerable":true,"configurable":false,"writable":false,"value":getCanvasPrinter});return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.PrintScreenPreview=PrintScreenPreview})();
function PrintDialog(args){var _args={"parentObject":null,"onHide":null,"onAssignDocument":null,"defaultMethod":PrintDialog.printMethods.DEFAULT,"bypassDialog":false,"owner":null};var _domElements={"backgroundBlock":null,"previewContainer":null,"bodyContainer":null,"printDocumentContainer":null,"printDialogIFrameContainer":null,"PDFNotSupported":null,"supportReader":null,"notSupportReader":null,"radioContainer":null,"direct":null,"directLabel":null,"btnCancel":null,"btnOk":null,"btnClose":null,"btnPrint":null,
"chkAsDefaultPrintMethod":null,"chkAsDefaultPrintMethodLabel":null,"printGrowUIOptions1":null,"printGrowUIOptions2":null,"printGrowUIbtnActive":null,"printGrowUIbtnInactive":null};var _storageData={"radioId":"DIRECT","byPassValue":false};var _localStorageKey="printPreview_data";var _documentsQueue=[];var _currentDocument=null;var _queuePrinting={"interval":null,"isBusy":false,"isPrinting":false,"printingInterval":null,"printingIntervalTime":250,"maxDelayPrintingTime":18E4,"startPrintingTime":null};
var _growl={"container":null,"timeoutId":null,"starttime":null,"minTimeout":2E3,"isVisible":false,"ready":null};var _growlError={"container":null,"timeout":2500,"isVisible":false};var _isDirectPrint=false;var _supportPreview=true;var _supportPrint=false;var _supportDirectMethods={"PREVIEW":false,"DIRECT":false};var _validSource={"maxRetries":5,"timeout":5E3,"retriesCount":0,"timeBeforeRetry":500,"pending":{}};var _enumDocStates=helper.object.createEnum({"error":-1,"loading":1,"completed":2,"assigned":3,
"validating":4,"loaded":5,"done":6});function initialize(args){helper.object.parseAttributes(_args,args,"MATCH");var tempData=helper.storage.get(_localStorageKey);if(tempData!=null)_storageData=tempData;if(_args.parentObject==null||_args.parentObject==undefined)_args.parentObject=document.body;if(_args.parentObject!=null){_supportPrint=helper.printer.supportPrint;_supportDirectMethods=helper.printer.printMethods;assignElements();setPrintMethod();helper.dom.addEvent(_args.parentObject,"keydown",parent_keydown)}}
function assignElements(){_domElements.backgroundBlock=helper.dom.appendJsonElement({"type":"div","id":"printDialogBackground-block","parentElement":_args.parentObject});_domElements.previewContainer=document.getElementById("printDialogPreviewContainer");_domElements.bodyContainer=document.getElementById("printDialogBodyContainer");_domElements.printDocumentContainer=document.getElementById("printDialogFileContainer");_domElements.printDialogIFrameContainer=document.getElementById("printDialogIFrameContainer");
_domElements.PDFNotSupported=document.getElementById("printDialogPDFNotSupported");_domElements.supportReader=document.getElementById("printDialogSupportReader");_domElements.notSupportReader=document.getElementById("printDialogNotSupportReader");_domElements.radioContainer=document.getElementById("printDialogModeContainer");_domElements.direct=document.getElementById("printDialogDirect");_domElements.directLabel=document.getElementById("printDialogDirectLabel");_domElements.btnCancel=document.getElementById("printDialogBtnCancel");
_domElements.btnOk=document.getElementById("printDialogBtnOk");_domElements.btnClose=document.getElementById("printDialogBtnClose");_domElements.btnPrint=document.getElementById("printDialogBtnPrint");_domElements.chkAsDefaultPrintMethod=document.getElementById("printDialogPrintMethod");_domElements.chkAsDefaultPrintMethodLabel=document.getElementById("printDialogPrintMethodLabel");_domElements.printGrowUIOptions1=document.getElementById("printGrowUIOptions1");_domElements.printGrowUIOptions2=document.getElementById("printGrowUIOptions2");
_domElements.printGrowUIbtnActive=document.getElementById("printGrowUIbtnActive");_domElements.printGrowUIbtnInactive=document.getElementById("printGrowUIbtnInactive");helper.dom.removeEvent(_domElements.printGrowUIbtnActive,["touchend","click"],toggleByPassPreviewDialog);helper.dom.removeEvent(_domElements.printGrowUIbtnInactive,["touchend","click"],toggleByPassPreviewDialog);helper.dom.removeEvent(_domElements.chkAsDefaultPrintMethod,["touchend"],checkboxes_touchEnd);helper.dom.removeEvent(_domElements.direct,
["touchend"],checkboxes_touchEnd);helper.dom.addEvent(_domElements.printGrowUIbtnActive,["touchend","click"],toggleByPassPreviewDialog);helper.dom.addEvent(_domElements.printGrowUIbtnInactive,["touchend","click"],toggleByPassPreviewDialog);helper.dom.addEvent(_domElements.chkAsDefaultPrintMethod,["touchend"],checkboxes_touchEnd);helper.dom.addEvent(_domElements.direct,["touchend"],checkboxes_touchEnd);_domElements.direct.mode="DIRECT";helper.dom.removeEvent(_domElements.radioContainer,"change",radioContainer_change);
if(!agentInfo.isMobile||!agentInfo.isAndroid)helper.dom.addEvent(_domElements.radioContainer,"change",radioContainer_change);_domElements.btnOk.from="ok";_domElements.btnPrint.from="print";helper.dom.removeEvent(_domElements.btnOk,["touchend","click"],btnPrintOk_click);helper.dom.removeEvent(_domElements.btnClose,["touchend","click"],btnCloseCancel_click);helper.dom.removeEvent(_domElements.btnPrint,["touchend","click"],btnPrintOk_click);helper.dom.addEvent(_domElements.btnCancel,["touchend","click"],
btnCloseCancel_click);helper.dom.addEvent(_domElements.btnOk,["touchend","click"],btnPrintOk_click);helper.dom.addEvent(_domElements.btnClose,["touchend","click"],btnCloseCancel_click);helper.dom.addEvent(_domElements.btnPrint,["touchend","click"],btnPrintOk_click);helper.dom.addEvent(_domElements.btnCancel,["touchend","click"],btnCloseCancel_click);_growl.container=document.getElementById("printGrowUIDialog");if(_growl.container!=null){helper.dom.addEvent(_growl.container,"mouseout",growlUI_mouseOut);
helper.dom.addEvent(_growl.container,["touchend","click"],growlUI_click);if(_domElements.printGrowUIOptions1){var img=helper.dom.createJsonElement({"type":"div","attributes":{"class":"printingIcon"}});_growl.container.insertBefore(img,_domElements.printGrowUIOptions1)}}_growlError.container=document.getElementById("printGrowUIErrorDialog");helper.dom.addEvent(_growlError.container,["touchend","click"],growlUIError_click)}function getSelectedOption(){if(!_supportPrint)return"PREVIEW";else if(_domElements.direct.checked)return _domElements.direct.mode;
else return"DIRECT"}function setDefaultPrintMethod(){if(_args.defaultMethod==PrintDialog.printMethods.DIRECT_PRINT)_domElements.direct.checked=true}function toggleByPassButtons(){var optSelected=getSelectedOption();if(_supportDirectMethods[optSelected]&&(_args.bypassDialog||_storageData.byPassValue)){helper.style.add(_domElements.printGrowUIbtnInactive,{"display":"none"});helper.style.add(_domElements.printGrowUIbtnActive,{"display":""})}else{helper.style.add(_domElements.printGrowUIbtnActive,{"display":"none"});
helper.style.add(_domElements.printGrowUIbtnInactive,{"display":""})}}function setPrintMethod(){if(_args.defaultMethod==PrintDialog.printMethods.DEFAULT||!PrintDialog.printMethods.hasValue(_args.defaultMethod))switch(_storageData.radioId){case "DIRECT":_domElements.direct.checked=true;break;default:setDefaultPrintMethod();break}else setDefaultPrintMethod()}function popDocument(fileName){var doc=null;if(fileName&&_validSource.pending)for(var k in _validSource.pending)if(fileName.indexOf(k)!=-1){doc=
_validSource.pending[k];delete _validSource.pending[k]}return doc}function validateSource(doc){if(doc.state<_enumDocStates.validating||doc.state===_enumDocStates.validating&&doc.xhrstatus!==200){_validSource.pending[doc.id]=doc;doc.state=_enumDocStates.validating;if(doc.xhrstatus===200)onSuccessSource(doc);else{var getResourceName=function(xhr){return popDocument(xhr.status!==200?doc.id:helper.url.parseUrl(xhr.responseURL).resource||doc.id)};helper.ajax.get({"url":doc.url,"readystatechange":function(state,
status,xhr){var xUrl=null;switch(xhr.readyState){case 0:case 1:break;case 2:xUrl=getResourceName(xhr);xUrl.xhrstatus=status;if(status===200)setTimeout(function(rUrl){onSuccessSource(rUrl)},500,xUrl);else{xUrl.failureFired=true;if(xhr&&xhr.abort instanceof Function)xhr.abort();onFailureSource(xUrl)}break;case 3:break;case 4:default:if(xhr&&xhr.abort instanceof Function)xhr.abort();xUrl=getResourceName(xhr);if(xUrl)if(xUrl.xhrstatus!==200&&!xUrl.failureFired){xUrl.xhrstatus=status;onFailureSource(xUrl)}break}}})}}}
function addOrUpdateDocument(id,url,title,preview,isLoading,printHandler){var item=null;if(_documentsQueue.length>0)for(var i=0;i<_documentsQueue.length;i++)if(_documentsQueue[i].id===id){_documentsQueue[i].isLoading=isLoading;if(_documentsQueue[i].state<_enumDocStates.validating)_documentsQueue[i].state=!isLoading?_enumDocStates.completed:_enumDocStates.loading;item=_documentsQueue[i];item.lastModified=(new Date).getTime();break}if(item===null){item={"id":id,"url":url,"title":title,"preview":preview,
"isLoading":isLoading,"state":isLoading?_enumDocStates.loading:_enumDocStates.completed,"isProgressAvailable":false,"lastModified":(new Date).getTime(),"printHandler":printHandler,"xhrstatus":0};_documentsQueue.push(item)}return item}function detectingPrintEnd(popDoc){function done(){clearInterval(_queuePrinting.printingInterval);_queuePrinting.isPrinting=false;_queuePrinting.isBusy=false;if(popDoc)popCurrentQueueDoc();checkDocumentInQueue()}_queuePrinting.startPrintingTime=(new Date).getTime();clearInterval(_queuePrinting.printingInterval);
_queuePrinting.printingInterval=setInterval(function(){if(document.activeElement&&(!document.hasFocus()&&document.activeElement.id==_domElements.printDocumentContainer.id))_queuePrinting.isPrinting=true;else done();if((new Date).getTime()-_queuePrinting.startPrintingTime>_queuePrinting.maxDelayPrintingTime)done()},_queuePrinting.printingIntervalTime)}function checkDocumentInQueue(){var doc=null;if(_currentDocument){if(_currentDocument.state>=_enumDocStates.assigned&&_currentDocument.state<=_enumDocStates.loaded)return;
doc=_documentsQueue.find(function(elem){return elem.state===_enumDocStates.completed&&elem.id===_currentDocument.id});if(!doc)doc=_documentsQueue.find(function(elem){return elem.state===_enumDocStates.completed});if(!doc&&!_queuePrinting.isBusy)checkDocumentInQueue()}else if(!_queuePrinting.isBusy){doc=getNextDocument();if(!(doc&&(_currentDocument===null||_currentDocument.id===doc.id&&doc.state<_enumDocStates.validating)))doc=null}if(doc)prepareNextDocumentToPrint(doc)}function setDocument(url,title,
preview,isLoading,printHandler){var fileName=helper.url.parseUrl(url).resource;if(fileName===null){fileName=url;var len=fileName.indexOf("?");if(len!==-1)fileName=fileName.substr(0,len);len=fileName.indexOf("/");if(len!==-1)fileName=fileName.substr(len)}helper.console.log(helper.string.format("url: {0}, fileName: {1}, title: {2} ,preview: {3} ,isLoading: {4}",url,fileName,title,preview,isLoading),arguments);addOrUpdateDocument(fileName,url,title,preview,isLoading,printHandler);checkDocumentInQueue()}
function getNextDocument(){var item=_documentsQueue.find(function(elem){return elem.state===_enumDocStates.completed});if(!item)item=_documentsQueue.find(function(elem){return elem.state===_enumDocStates.loading&&elem.isLoading});return item}function releaseQueueDocuments(){for(var i=_documentsQueue.length-1;i>=0;i--)if(_documentsQueue[i].state===_enumDocStates.error||_documentsQueue[i].state>=_enumDocStates.done||_currentDocument.url===_documentsQueue[i].url)_documentsQueue.splice(i,1);_queuePrinting.isBusy=
false}function prepareNextDocumentToPrint(doc){_currentDocument=doc;_queuePrinting.isBusy=true;if(!doc||doc.id==undefined||doc.id===null||doc.id==""){helper.console.warning("Print Error - cannot convert document");doc.state=_enumDocStates.error;closeGrowlPopup();hide();setTimeout(function(){showGrowlErrorPopup()},400);return}if(doc.state<_enumDocStates.validating||doc.state===_enumDocStates.validating&&!doc.isLoading){if(doc.isLoading!=undefined){doc.isProgressAvailable=true;helper.dom.removeEvent(_growl.container,
"mouseout",growlUI_mouseOut)}else doc.isProgressAvailable=false;_domElements.printDocumentContainer.title=doc.title;hide();if(doc.isLoading==undefined||doc.isLoading){if(!_growl.isVisible){_growl.isVisible=true;toggleByPassButtons();showGrowlPopup()}}else{setPrintMethod();closeGrowlPopup()}}}function popCurrentQueueDoc(){_queuePrinting.isBusy=false;releaseQueueDocuments();if(_currentDocument)_currentDocument=null;checkDocumentInQueue()}function assignDocument(doc){$(_domElements.printDocumentContainer).off("load",
directPrintLoaded);if(doc.id==undefined||doc.id==null||doc.url==""){helper.console.warning("Print Error - cannot convert document");setTimeout(function(){showGrowlErrorPopup()},400);return}doc.state=_enumDocStates.loaded;if(doc.preview){assignSourceDocument(doc.url);show(doc)}else{var so=_args.bypassDialog?getSelectedOption():_storageData.byPassValue?_storageData.radioId:"DEFAULT";switch(so){case "DIRECT":$(_domElements.printDocumentContainer).on("load",directPrintLoaded);assignSourceDocument(doc.url);
break;case "DEFAULT":default:assignSourceDocument(doc.url);show(doc);break}}}function printDocument(doc){$(_domElements.printDocumentContainer).off("load",directPrintLoaded);switch(_storageData.radioId){case "DIRECT":default:directPrintLoaded();break}}function onSuccessSource(doc){_growl.isVisible=false;$.unblockUI({"fadeOut":300});assignDocument(doc)}function onFailureSource(doc){_validSource.retriesCount++;if(doc&&_validSource.retriesCount<_validSource.maxRetries){helper.console.warning("failed to get resource, trying again",
arguments);setTimeout(function(){delete doc.failureFired;validateSource(doc)},_validSource.timeBeforeRetry)}else{_validSource.retriesCount=0;_growl.isVisible=false;$.unblockUI({"fadeOut":300});hide();setTimeout(function(){showGrowlErrorPopup()},400)}}function assignSourceDocument(url){if(_supportPreview)if(!(_supportPrint||agentInfo.isMSIE||agentInfo.isFirefox)){var directPrint=function(elem){$(_domElements.printDocumentContainer)[0].src="data:"+elem.mimeType+";base64,"+elem.base64};getDocumentBase64Object(url,
directPrint)}else{_domElements.printDocumentContainer.setAttribute("src","about:blank");_domElements.printDocumentContainer.focus();if(agentInfo.isMSIE&&agentInfo.msieVersion>=12)if(_args.onAssignDocument)_args.onAssignDocument();if(_args.owner&&_args.owner.httpConnection!==""){_domElements.printDocumentContainer.setAttribute("src",helper.url.parseUrl(_args.owner.httpConnection+"/remotePrint.html?_gwsid="+Thinfinity.global.variables.gwsid).toUrl());_domElements.printDocumentContainer.onload=function(e){_domElements.printDocumentContainer.contentWindow.postMessage({"cmd":"setDocument",
"url":url},"*")}}else _domElements.printDocumentContainer.setAttribute("src",url)}}function getArrayBufferFromUrl(urlFile,success,failure){var lastIndexOf=urlFile.lastIndexOf(".");var documentName=urlFile;if(lastIndexOf!=-1){documentName=urlFile.substr(0,lastIndexOf);if(documentName.indexOf("/")!=-1)documentName=documentName.substr(documentName.lastIndexOf("/")+1,documentName.length-documentName.lastIndexOf("/"))}helper.ajax.get({"url":urlFile,"async":true,"type":helper.ajax.responseType.ARRAYBUFFER,
"success":function(response,status,xhr){if(status===200)success({"name":documentName,"arrayBuffer":response,"mimeType":MimeType.get(urlFile)});else if(failure)failure({"name":documentName,"error":status,"message":xhr.statusText})},"error":function(e,status,xhr){if(failure)failure({"name":documentName,"error":status,"message":e.message||xhr.statusText})}})}function getDocumentBase64Object(file,success,failure){getArrayBufferFromUrl(file,function(response){var uInt8Array=new Uint8Array(response.arrayBuffer);
var i=uInt8Array.length;var binaryString=new Array(i);while(i--)binaryString[i]=String.fromCharCode(uInt8Array[i]);var dataBinary=binaryString.join("");var data64=window.btoa(dataBinary);success({"name":response.name,"base64":data64,"mimeType":response.mimeType})},failure)}function directPrintLoaded(e){if(_currentDocument.printHandler instanceof Function){getArrayBufferFromUrl(_currentDocument.url,_currentDocument.printHandler,function(e){helper.console.warning("Cannot read arrayBuffer from url file",
arguments)});popCurrentQueueDoc();_queuePrinting.isPrinting=false}else setTimeout(function(){if(!_supportPrint){window.open(_currentDocument.url,"_blank");popCurrentQueueDoc();_queuePrinting.isPrinting=false}else{try{document.activeElement.blur();if(_args.owner&&_args.owner.httpConnection!=="")_domElements.printDocumentContainer.contentWindow.postMessage({"cmd":"print"},"*");else{_domElements.printDocumentContainer.contentWindow.document.body.focus();_domElements.printDocumentContainer.contentWindow.focus();
_domElements.printDocumentContainer.focus();_domElements.printDocumentContainer.contentWindow.print()}detectingPrintEnd(true)}catch(error){detectingPrintEnd(true)}_currentDocument.state=_enumDocStates.done}},500)}function closeGrowlPopup(){_validSource.retriesCount=0;if(_currentDocument.state===_enumDocStates.completed){_currentDocument.state=_enumDocStates.assigned;validateSource(_currentDocument)}}function showGrowlPopup(){_growl.starttime=(new Date).getTime();if(_currentDocument){if(_currentDocument.isProgressAvailable!=
true)_growl.timeoutId=setTimeout(function(){if(!_currentDocument.isLoading)closeGrowlPopup()},_growl.minTimeout);$.blockUI({message:$(_growl.container),fadeIn:_currentDocument.isProgressAvailable?150:300,showOverlay:false,centerY:false,css:{width:"300px",top:"10px",left:"",right:"10px",border:"1px solid #42a7e6",padding:"5px",backgroundColor:"#3297d6","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px",opacity:.9,color:"#fff"}})}else helper.console.warning("Current document is undefined or null, cannot show growl popup",
arguments)}function showGrowlErrorPopup(){_growlError.isVisible=true;setTimeout(function(){popCurrentQueueDoc()},_growlError.timeout);$.blockUI({"message":$(_growlError.container),"fadeIn":300,"showOverlay":false,"centerY":false,"timeout":_growlError.timeout,"css":{"width":"300px","top":"10px","left":"","right":"10px","border":"1px solid #840103","padding":"5px","backgroundColor":"#b91b1b","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px","opacity":.9,"color":"#fff"}})}
function toggleByPassPreviewDialog(e){e.stopPropagation();e.preventDefault();var optSelected=getSelectedOption();if(_supportDirectMethods[optSelected])_storageData.byPassValue=!_storageData.byPassValue;else if(_storageData.byPassValue)_storageData.byPassValue=false;helper.storage.set(_localStorageKey,_storageData);toggleByPassButtons();return false}function show(doc){var tempData=helper.storage.get(_localStorageKey);if(tempData!=null)_storageData=tempData;else helper.storage.set(_localStorageKey,
_storageData);if(!plugin.isPDFInstalled()){_supportPreview=false;helper.style.addClass(_domElements.previewContainer,"noPDFInstalled");if(agentInfo.isWindows&&!agentInfo.isMobile){helper.style.add(_domElements.notSupportReader,{"display":"none"});helper.style.add(_domElements.supportReader,{"display":""})}else{helper.style.add(_domElements.supportReader,{"display":"none"});helper.style.add(_domElements.notSupportReader,{"display":""})}}else helper.style.add(_domElements.PDFNotSupported,{"display":"none"});
var screenElements=[_domElements.btnOk,_domElements.btnPrint,_domElements.btnCancel,_domElements.btnClose];screenElements.forEach(function(elem){helper.style.add(elem,{"display":"none"})});if(doc.preview)helper.style.add(_domElements.btnClose,{"display":""});else{_domElements.chkAsDefaultPrintMethod.checked=_storageData.byPassValue;if(_supportPrint){helper.style.add(_domElements.direct,{"display":"none"});helper.style.add(_domElements.directLabel,{"display":"none"});helper.style.add(_domElements.btnOk,
{"display":""});helper.style.add(_domElements.btnCancel,{"display":""});_domElements.chkAsDefaultPrintMethod.removeAttribute("disabled");helper.style.removeClass(_domElements.chkAsDefaultPrintMethodLabel,"disabled")}else{helper.style.add(_domElements.direct,{"display":"none"});helper.style.add(_domElements.directLabel,{"display":"none"});helper.style.add(_domElements.btnPrint,{"display":""});helper.style.add(_domElements.btnClose,{"display":""});if(_currentDocument.printHandler instanceof Function)_domElements.btnPrint.value=
helper.string.sprintf(helper.dictionary.getValue("mtSaveFile"));else _domElements.btnPrint.value=helper.string.sprintf(helper.dictionary.getValue("download"));_domElements.chkAsDefaultPrintMethod.setAttribute("disabled","disabled");helper.style.addClass(_domElements.chkAsDefaultPrintMethodLabel,"disabled")}}$(_domElements.backgroundBlock).show();$(_domElements.previewContainer).fadeIn("fast");$(_domElements.previewContainer).focus()}function hide(){if(agentInfo.isMSIE&&agentInfo.msieVersion>=12){if(_args.onHide)_args.onHide();
_domElements.previewContainer.style.display="none";_domElements.backgroundBlock.style.display="none"}else{$(_domElements.previewContainer).fadeOut("fast");$(_domElements.backgroundBlock).fadeOut("slow")}}function growlUI_click(e){clearTimeout(_growl.timeoutId);$(_domElements.printDocumentContainer).off("load",directPrintLoaded);_domElements.chkAsDefaultPrintMethod.checked=false;_storageData.byPassValue=false;helper.storage.set(_localStorageKey,_storageData);_growl.timeoutId=null;_growl.isVisible=
false;if(_currentDocument&&_currentDocument.isProgressAvailable!=true){$.unblockUI({"fadeOut":300});assignSourceDocument(_currentDocument.url);show(_currentDocument)}}function growlUI_mouseOut(e){if(_growl.isVisible==true){clearTimeout(_growl.timeoutId);var mlDif=_growl.starttime+_growl.timeout-(new Date).getTime();if(mlDif<1500)mlDif=1500;if(_currentDocument&&_currentDocument.isProgressAvailable!=true)_growl.timeoutId=setTimeout(function(){if(!_currentDocument.isLoading)closeGrowlPopup()},mlDif)}}
function growlUIError_click(e){$.unblockUI({"fadeOut":300});_growlError.isVisible=false}function checkbox_Change(e){if(!_supportPrint){_domElements.chkAsDefaultPrintMethod.setAttribute("disabled","disabled");helper.style.addClass(_domElements.chkAsDefaultPrintMethodLabel,"disabled");_domElements.btnPrint.value=helper.string.sprintf(helper.dictionary.getValue("download"))}else{_storageData.byPassValue=false;helper.style.removeClass(_domElements.chkAsDefaultPrintMethodLabel,"disabled");_domElements.chkAsDefaultPrintMethod.removeAttribute("disabled");
_domElements.chkAsDefaultPrintMethod.checked=false}helper.storage.set(_localStorageKey,_storageData)}function checkboxes_touchEnd(e){if(e.preventDefault)e.preventDefault();this.checked=!this.checked}function radioContainer_change(e){_storageData.radioId=getSelectedOption();if(!_supportPrint){_domElements.chkAsDefaultPrintMethod.setAttribute("disabled","disabled");helper.style.addClass(_domElements.chkAsDefaultPrintMethodLabel,"disabled");helper.style.add(_domElements.btnOk,{"display":"none"});helper.style.add(_domElements.btnPrint,
{"display":""})}else{_domElements.chkAsDefaultPrintMethod.removeAttribute("disabled");helper.style.removeClass(_domElements.chkAsDefaultPrintMethodLabel,"disabled")}helper.storage.set(_localStorageKey,_storageData)}function btnPrintOk_click(e){if(e.preventDefault)e.preventDefault();hide();_storageData.radioId=getSelectedOption();_storageData.byPassValue=_domElements.chkAsDefaultPrintMethod.checked;helper.storage.set(_localStorageKey,_storageData);if(!_currentDocument||_currentDocument.preview){popCurrentQueueDoc();
return}var tgt=e.srcElement||e.target;if(_storageData.radioId==="DIRECT"&&tgt.from!=="print"){directPrintLoaded();hide()}else printDocument(_currentDocument)}function btnCloseCancel_click(e){if(e.preventDefault)e.preventDefault();hide();popCurrentQueueDoc()}function parent_keydown(e){if(e.keyCode==27&&_currentDocument&&!_currentDocument.isProgressAvailable){if(_growl.isVisible){clearTimeout(_growl.timeoutId);closeGrowlPopup()}else{hide();document.getElementById(_storageData.radioId).checked=true;
_domElements.chkAsDefaultPrintMethod.checked=_storageData.byPassValue}popCurrentQueueDoc()}}Object.defineProperty(this,"setDocument",{"enumerable":true,"configurable":false,"value":setDocument});Object.defineProperty(this,"show",{"enumerable":true,"configurable":false,"value":show});Object.defineProperty(this,"hide",{"enumerable":true,"configurable":false,"value":hide});Object.defineProperty(this,"isPrinting",{"enumerable":true,"configurable":false,"get":function(){return _queuePrinting.isBusy}});
Object.defineProperty(this,"defaultPrintMethod",{"enumerable":true,"configurable":false,"get":function(){return _args.defaultMethod},"set":function(value){_args.defaultMethod=helper.object.isNumber(value)?value:PrintDialog.printMethods.DEFAULT;setDefaultPrintMethod(_args.defaultMethod)}});Object.defineProperty(this,"bypassPrintDialog",{"enumerable":true,"configurable":false,"get":function(){return _args.bypassDialog},"set":function(value){_args.bypassDialog=helper.object.convertTo(value,"boolean")}});
initialize(args);return this}PrintDialog.printMethods=helper.object.createEnum("DEFAULT","DIRECT_PRINT");
(function(){var _keys={"delete":8,"return":13,"shift":16,"ctrl":17,"alt":18,"space":32,"point":46,"deadKey":229};function MobileKeyboard(args){var _ref=this;var _args={"input":null,"output":null,"methods":{"isPrintableKey":null,"isControlCharacter":null}};var _locationTypes={"VIRTUALKEYBOARD":0,"PHYSICALKEYBOARD":1};var _captured="";var _keyboardHandler=null;function initialize(){_args=helper.object.parseAttributes(_args,args);var msg=helper.string.format('Cannot initialize "Mobile Keyboard", "{0}" argument cannot be null');
if(!_args.input){var str=helper.string.format(msg,"input");helper.console.warning(str,arguments);throw new Error(str);}if(!_args.output){var str=helper.string.format(msg,"output");helper.console.warning(str,arguments);throw new Error(str);}var browserModel=agentInfo.isChrome?"chrome":agentInfo.isSafari?"safari":agentInfo.isFirefox?"firefox":"chrome";_keyboardHandler=Thinfinity.Driver.MobileKeyboardHandlers.get(browserModel);if(_keyboardHandler){_keyboardHandler=new _keyboardHandler;_keyboardHandler.initialize({"input":_args.input,
"output":output,"keys":_keys,"methods":_args.methods,"locationTypes":_locationTypes});var extendProp=["dispose"];extendProp.forEach(function(ep){if(!_ref[ep]&&_keyboardHandler[ep])if(_keyboardHandler[ep]instanceof Function)Object.defineProperty(_ref,ep,{"enumerable":true,"configurable":false,"writable":false,"value":_keyboardHandler[ep]})})}else{msg=helper.string.format('Cannot initialize "Mobile Keyboard", none drivers was found');helper.console.warning(str,arguments);throw new Error(str);}}function output(keycode,
charCode,action,location){keycode=keycode||0;charCode=charCode||0;location=location||0;if(keycode===0&&_args.methods.isControlCharacter(charCode)){keycode=charCode;charCode=0}_args.output(keycode,charCode,action,location)}initialize();Object.defineProperty(_ref,"locationType",{"enumerable":true,"configurable":false,"get":function(){return _keyboardHandler.lastLocationType}});Object.defineProperty(_ref,"enumLocationType",{"enumerable":true,"configurable":false,"get":function(){return _locationTypes}});
Object.defineProperty(_ref,"enumKeys",{"enumerable":true,"configurable":false,"get":function(){return _keys}});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(Thinfinity.Driver===undefined)Thinfinity.Driver={};Thinfinity.Driver.MobileKeyboard=MobileKeyboard;Object.defineProperty(Thinfinity.Driver.MobileKeyboard,"enumKeys",{"enumerable":true,"configurable":false,"get":function(){return _keys}})})();
(function(){function MobileKeyboardHandlers(){var _ref=this;var _handlers={};function initialize(){}function getHandler(name){if(name&&name!=""&&_handlers[name])return _handlers[name].handler}function addHandler(name,handler){if(name&&name!=""&&!_handlers[name]&&handler){_handlers[name]={"handler":handler};return true}else return false}function removeHandler(name,handler){if(name&&name!=""&&_handlers[name]&&_handlers[name].handler===handler){delete _handlers[name];return true}else return false}initialize();
Object.defineProperty(_ref,"get",{"enumerable":true,"configurable":false,"writable":false,"value":function(name){return getHandler(name)}});Object.defineProperty(_ref,"add",{"enumerable":true,"configurable":false,"writable":false,"value":function(name,handler){return addHandler(name,handler)}});Object.defineProperty(_ref,"remove",{"enumerable":true,"configurable":false,"value":function(name,handler){return removeHandler(name,handler)}});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(Thinfinity.Driver===
undefined)Thinfinity.Driver={};Thinfinity.Driver.MobileKeyboardHandlers=new MobileKeyboardHandlers})();
(function(){function MobileKeyboardForChrome(){var _ref=this;var _args={"input":null,"output":null,"keys":null,"methods":{"isPrintableKey":null,"isControlCharacter":null},"locationTypes":null};var _name="chrome";var _downKeys=[];var _enumKeyState=helper.object.createEnum({"INITIAL_STATE":-1,"PRESSED":0,"RELEASED":1});var _modifierKeys={"shift":_enumKeyState.INITIAL_STATE,"ctrl":_enumKeyState.INITIAL_STATE,"alt":_enumKeyState.INITIAL_STATE};var _modifierKeysList=[];var _maxKeys=10;var _minPressKeyDetection=
50;function initialize(args){_args=helper.object.parseAttributes(_args,args);Array.prototype.push.apply(_modifierKeysList,[_args.keys.shift,_args.keys.ctrl,_args.keys.alt]);var str=null;var msg=helper.string.format('Cannot initialize "Mobile Keyboard for {0}", "{1}" argument {2}');if(!_args.input){str=helper.string.format(msg,_name,"input","cannot be null");helper.console.warning(str,arguments);throw new Error(str);}if(!_args.output&&!(_args.output instanceof Function)){str=helper.string.format(msg,
_name,"output","is not valid function");helper.console.warning(str,arguments);throw new Error(str);}if(agentInfo.isAndroid)_args.input.value=String.fromCharCode(_args.keys.point);attachEvents()}function dispose(){detachEvents();_args.input=null;_args.output=null;_captured=null;return true}function attachEvents(){helper.dom.addEvent(_args.input,"keydown",keydown_handler);helper.dom.addEvent(_args.input,"keypress",keypress_handler);helper.dom.addEvent(_args.input,"change",change_handler);helper.dom.addEvent(_args.input,
"input",input_handler);helper.dom.addEvent(_args.input,"keyup",keyup_handler)}function detachEvents(){helper.dom.removeEvent(_args.input,"keydown",keydown_handler);helper.dom.removeEvent(_args.input,"keypress",keypress_handler);helper.dom.removeEvent(_args.input,"change",change_handler);helper.dom.removeEvent(_args.input,"input",input_handler);helper.dom.removeEvent(_args.input,"keyup",keyup_handler)}function getKeyInfo(e){var keyCode=e.keyCode||e.which||0;var charCode=e.charCode&&e.charCode!=0?e.charCode:
e.key&&e.key.length===1?e.key.charCodeAt(0):e.data&&e.data.length===1?e.data.charCodeAt(0):0;var location=e.location||e.keyLocation||(e.originalEvent?e.originalEvent.location||e.originalEvent.keyLocation:0);var value=0;if(keyCode===0&&charCode!==0&&_args.methods.isControlCharacter(charCode)){keyCode=charCode;charCode=0}if(keyCode===0&&charCode===0)if(e.key);else if(e.inputType)switch(e.inputType.toUpperCase()){case "DELETECONTENTBACKWARD":keyCode=_args.keys.delete;break;default:break}if(keyCode!==
0)value=keyCode;else value=charCode;return{"keyCode":keyCode,"charCode":charCode,"location":location,"value":value}}function resetInput(){_args.input.value=String.fromCharCode(_args.keys.point);setTimeout(function(){if(_args.input)_args.input.selectionStart=_args.input.selectionEnd=1},0)}function sendModifierKey(e){var isPressed=null;var processed=false;for(var kvp in _modifierKeys){isPressed=e.keyCode===_args.keys[kvp]&&e.type!=="keyup"||e[kvp+"Key"];if(isPressed!==undefined){if(isPressed&&_modifierKeys[kvp]!==
_enumKeyState.PRESSED){_args.output(_args.keys[kvp],0,"down",0);_modifierKeys[kvp]=_enumKeyState.PRESSED}else if(!isPressed&&_modifierKeys[kvp]===_enumKeyState.PRESSED){_args.output(_args.keys[kvp],0,"up",0);_modifierKeys[kvp]=_enumKeyState.RELEASED}if(e.keyCode===_args.keys[kvp])processed=_modifierKeys[kvp]!=_enumKeyState.INITIAL_STATE}}return!processed}function pushKey(keyItem){_downKeys.push(keyItem);if(_downKeys.length>_maxKeys)_downKeys.splice(0,1)}function keydown_handler(e){var ki=getKeyInfo(e);
if(sendModifierKey(e))if(ki.value!=0&&ki.value!=_args.keys.deadKey){var idx=isLastKey(e,ki);if(idx>-1)if(_downKeys[idx].timeStamp!=e.timeStamp){_args.output(ki.keyCode,ki.charCode,"down",ki.location);_args.output(ki.keyCode,ki.charCode,"up",ki.location);_downKeys[idx].timeStamp=e.timeStamp;return}else return;_args.output(ki.keyCode,ki.charCode,"down",ki.location);pushKey({"id":ki.value,"key":e.key,"which":e.which,"keyCode":ki.keyCode,"charCode":ki.charCode,"code":e.code,"location":ki.location,"ctrl":e.ctrlKey,
"shift":e.shiftKey,"alt":e.altKey,"timeStamp":e.timeStamp,"type":e.type,"state":_enumKeyState.PRESSED})}else;}function keypress_handler(e){var ki=getKeyInfo(e);if(sendModifierKey(e))if(ki.value!=0&&ki.value!=_args.keys.deadKey){var idx=isLastKey(e,ki);if(idx>-1)if(_downKeys[idx].timeStamp-e.timeStamp>_minPressKeyDetection){_args.output(ki.keyCode,ki.charCode,"down",ki.location);_args.output(ki.keyCode,ki.charCode,"up",ki.location);_downKeys[idx].timeStamp=e.timeStamp;return}else return;_args.output(ki.keyCode,
ki.charCode,"down",ki.location);pushKey({"id":ki.value,"key":e.key,"which":e.which,"keyCode":ki.keyCode,"charCode":ki.charCode,"code":e.code,"location":ki.location,"ctrl":e.ctrlKey,"shift":e.shiftKey,"alt":e.altKey,"timeStamp":e.timeStamp,"type":e.type,"state":_enumKeyState.PRESSED})}}function change_handler(e){}function input_handler(e){var ki=getKeyInfo(e);if(sendModifierKey(e))if(ki.value&&ki.value!=_args.keys.deadKey){var idx=isLastKey(e,ki);var found=false;if(idx>-1){ki.keyCode=ki.keyCode||_downKeys[idx].keyCode;
ki.charCode=ki.charCode||_downKeys[idx].charCode;found=true}if(found&&_downKeys[idx].state!==_enumKeyState.PRESSED||idx===-1&&!found)_args.output(ki.keyCode,ki.charCode,"down",ki.location);_args.output(ki.keyCode,ki.charCode,"up",ki.location);if(found)_downKeys[idx].state=_enumKeyState.RELEASED;resetInput()}else if(ki.keyCode===0&&ki.charCode===0)if(["insertCompositionText","insertText"].indexOf(e.inputType)!==-1){var text=_args.input.value;resetInput();var strIdx=text[0].charCodeAt(0)===_args.keys.point&&
text.length>1?1:text[0]!==""&&text.length>0?0:-1;if(strIdx!=-1)for(var i=strIdx;i<text.length;i++){var cc=text.substr(i,1).charCodeAt(0);_args.output(0,cc,"down",0);_args.output(0,cc,"up",0)}}}function keyup_handler(e){var ki=getKeyInfo(e);if(sendModifierKey(e))if(ki.value!=0&&ki.value!=_args.keys.deadKey){var idx=findUpKey(e,ki);if(idx>-1&&_downKeys[idx].state===_enumKeyState.PRESSED){_args.output(ki.keyCode,ki.charCode,"up",ki.location);_downKeys[idx].state=_enumKeyState.RELEASED}}else;}function isLastKey(e,
keyInfo){var idx=_downKeys.length-1;var found=false;if(idx>-1){var item=_downKeys[idx];if(e.key===undefined&&e.keyCode===undefined&&e.charCode===undefined){var v=null;if(e.data&&e.data.length===1){v=e.data.charCodeAt(0);found=e.data===item.key||v===item.keyCode||v===item.charCode}else if(e.data===null&&keyInfo)found=item.key===keyInfo.keyCode||item.keyCode===keyInfo.keyCode||item.charCode===keyInfo.charCode}else if(e.type==="keydown"&&item.state===_enumKeyState.RELEASED){_downKeys.splice(idx,1);found=
false}else found=item.key===e.key||item.keyCode===e.keyCode&&e.keyCode!==0||item.which===e.which&&e.which!==0||item.charCode===e.charCode&&e.charCode!==0}return found?idx:-1}function findKey(prop,value){var len=_downKeys.length;var idx=len-1;var doStop=false;while(!doStop&&idx>=0)if(_downKeys[idx][prop]===value){doStop=true;if(_downKeys[idx].state===_enumKeyState.RELEASED)idx=-2}else idx--;return idx}function findUpKey(e){var idx=-1;var keys=["key","which","code","id"];var k=0;var doStop=false;while(!doStop&&
k<keys.length){idx=findKey(keys[k],k!==3?e[keys[k]]:e.charCode||e.keyCode);if(idx!=-1)doStop=true;k++}return idx}Object.defineProperty(_ref,"initialize",{"enumerable":true,"configurable":false,"writable":false,"value":function(args){return initialize(args)}});Object.defineProperty(_ref,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return dispose()}});Object.defineProperty(_ref,"lastLocationType",{"enumerable":true,"configurable":false,"get":function(){return _args.locationTypes.VIRTUALKEYBOARD}});
return _ref}if(helper.object.existsPath(window,"Thinfinity.Driver.MobileKeyboardHandlers"))Thinfinity.Driver.MobileKeyboardHandlers.add("chrome",MobileKeyboardForChrome)})();
(function(){function MobileKeyboardForSafari(){var _ref=this;var _args={"input":null,"output":null,"keys":null,"methods":{"isPrintableKey":null},"locationTypes":null};var _captured="";var _name="ios";var _keyDown=false;var _modifiersKeyCode={shift:{keyCode:16,charCode:0,location:1},ctrl:{keyCode:17,charCode:0,location:1},alt:{keyCode:18,charCode:0,location:1}};var _lastEvt={"down":0,"up":0};var _retort={"time":50,"lastEvent":null,"timeoutId":null,"lastValue":null,"spaceFlag":false};var _downKeys=
[];var _repeatKeys={8:125};var _repeatKeyIntervalId=null;var _repeatActive=false;var _klogs=["type","keyCode","charCode","key","which","ctrlKey","shiftKey","altKey","location"];var _lastLocationType=null;var _lastKeyboardInput=null;function initialize(args){_args=helper.object.parseAttributes(_args,args);var msg=helper.string.format('Cannot initialize "Mobile Keyboard for {0}", "{1}" argument {2}');if(!_args.input){var str=helper.string.format(msg,_name,"input","cannot be null");helper.console.warning(str,
arguments);throw new Error(str);}if(!_args.output&&!(_args.output instanceof Function)){var str=helper.string.format(msg,_name,"output","is not valid function");helper.console.warning(str,arguments);throw new Error(str);}var pyoff=window.pageYOffset;_args.input.focus();setTimeout(function(){var pyo=Math.abs(window.pageYOffset-pyoff);if(pyo>10&&pyo<100){_lastLocationType=_args.locationTypes.PHYSICALKEYBOARD;if(_lastKeyboardInput!=_lastLocationType){helper.console.log(helper.string.format("Keyboard input has changed: {0} - from initialize",
_lastLocationType===_args.locationTypes.PHYSICALKEYBOARD?"physical":"virtual"),arguments);_lastKeyboardInput=_lastLocationType}}_args.input.blur()},300);attachEvents()}function dispose(){detachEvents();_args.input=null;_args.output=null;_captured=null;return true}function attachEvents(){helper.dom.addEvent(_args.input,"keydown",keydown_handler);helper.dom.addEvent(_args.input,"keypress",keypress_handler);helper.dom.addEvent(_args.input,"change",change_handler);helper.dom.addEvent(_args.input,"input",
input_handler);helper.dom.addEvent(_args.input,"keyup",keyup_handler)}function detachEvents(){helper.dom.removeEvent(_args.input,"keydown",keydown_handler);helper.dom.removeEvent(_args.input,"keypress",keypress_handler);helper.dom.removeEvent(_args.input,"change",change_handler);helper.dom.removeEvent(_args.input,"input",input_handler);helper.dom.removeEvent(_args.input,"keyup",keyup_handler)}function logKey(e){var str="";_klogs.forEach(function(name){str+=name+": "+e[name]+", "});return str}function getLocation(e){return e.location||
e.keyLocation||(e.originalEvent?e.originalEvent.location||e.originalEvent.keyLocation:0)}function keydown_handler(e){e=e||window.srcEvent;var tgt=e.currentTarget||e.srcElement||e.target;var phyKey=document===tgt;var cc=e.charCode!=0?e.charCode:e.charCode==0&&e.key.length==1?e.key.charCodeAt(0):0;var kc=e.keyCode;var key=cc||kc;var len=_downKeys?_downKeys.length:0;if(_keyDown&&phyKey&&(new Date).getTime()-_lastEvt.down<100&&len>0&&_downKeys[len-1].id===key){helper.console.log("retort down: "+kc);return}_lastLocationType=
phyKey?_args.locationTypes.PHYSICALKEYBOARD:_args.locationTypes.VIRTUALKEYBOARD;if(_lastKeyboardInput!=_lastLocationType){helper.console.log(helper.string.format("Keyboard input has changed: {0} - from keydown.",_lastLocationType===_args.locationTypes.PHYSICALKEYBOARD?"physical":"virtual"),arguments);_lastKeyboardInput=_lastLocationType}var eloc=getLocation(e);var whichFromKey=null;try{whichFromKey=e.key.length===1?e.key.toUpperCase().charCodeAt():null}catch(error){}var which=whichFromKey&&isValidKeyCode(whichFromKey)?
whichFromKey:e.which||e.keyCode;if(_args.methods.isPrintableKey(cc))kc=0;else{if(kc==0)kc=cc;cc=0}_downKeys.push({"id":key,"key":e.key,"keyCode":kc,"charCode":cc,"code":e.code,"location":eloc,"ctrl":e.ctrlKey,"shift":e.shiftKey,"alt":e.altKey,"physicalKeyboard":phyKey,"which":which});_keyDown=true;_lastEvt.down=(new Date).getTime();if(phyKey)_args.output(which?which:kc,which?0:cc,"down",eloc);clearInterval(_repeatKeyIntervalId);_repeatActive=false;if(_repeatKeys[kc]){var ft=!phyKey;_repeatKeyIntervalId=
setInterval(function(){if(ft)_args.output(kc,cc,"down",eloc);_args.output(kc,cc,"up",eloc);ft=true;_repeatActive=true},_repeatKeys[kc])}if(_downKeys.length>8)_downKeys.shift()}function isValidKeyCode(keyCode){if(keyCode>=48&&keyCode<=57||keyCode>=65&&keyCode<=90)return true;return false}function keypress_handler(e){}function change_handler(e){}function input_handler(e){if(!_keyDown){clearInterval(_repeatKeyIntervalId);var value=_args.input.value;if(_retort.spaceFlag&&value===" ")retortSpace(_args.input,
_captured);else{_retort.lastValue=value;_args.input.value="";var hDeleteKeys=0;var idx=0;if(_captured!="")while(_captured.length>idx&&value.length>idx)if(_captured[idx]===value[idx])idx++;else break;if(idx>0&&_captured.length>idx){hDeleteKeys=_captured.length-idx;for(var i=0;i<hDeleteKeys;i++){_args.output(0,_args.keys.delete,"down",0);_args.output(0,_args.keys.delete,"up",0)}_captured=_captured.substr(0,_captured.length-hDeleteKeys)}value=value.substr(idx,value.length);for(var i=0;i<value.length;i++){var lc=
value.substr(i,1);var cc=lc.charCodeAt(0);if(cc===_args.keys.space){_captured="";_args.output(0,_args.keys.space,"down",0);_args.output(0,_args.keys.space,"up",0)}else{_args.output(0,cc,"down",0);_args.output(0,cc,"up",0);_captured+=lc}}_retort.spaceFlag=true;clearTimeout(_retort.timeoutId);_retort.timeoutId=setTimeout(function(){retortSpace()},150)}}}function keyup_handler(e){e=e||window.srcEvent;clearInterval(_repeatKeyIntervalId);var tgt=e.currentTarget||e.srcElement||e.target;var phyKey=document===
tgt;var len=_downKeys?_downKeys.length:0;if(!phyKey&&len>1){var i=0;while(i<_downKeys.length-1)if(_downKeys[i].physicalKeyboard===false){var fk=_downKeys.splice(i,1)[0];_args.output(fk.keyCode,fk.charCode,"down",fk.location);_args.output(fk.keyCode,fk.charCode,"up",fk.location)}else i++}var idx=findUpKey(e);var sk=null;if(idx>-1)sk=_downKeys[idx];if(!_keyDown&&phyKey&&(new Date).getTime()-_lastEvt.up<100&&idx==-1)return;_lastEvt.up=(new Date).getTime();var sk=sk?shiftUpKey(e):null;if(_repeatActive)return;
var kc=null,eloc=null,cc=null;if(!sk){cc=e.charCode!=0?e.charCode:e.charCode==0&&e.key.length==1?e.key.charCodeAt(0):0;kc=e.keyCode;eloc=getLocation(e)}if(phyKey)if(sk)_args.output(sk.which?sk.which:sk.keyCode,sk.which?0:sk.charCode,"up",sk.location);else _args.output(kc,cc,"up",eloc);else if(sk){var isModifier=checkModifier(sk.keyCode);var hasModifier=sk.shift||sk.ctrl||sk.alt;if(!isModifier)applyModifiersKey({shift:sk.shift,ctrl:sk.ctrl,alt:sk.alt},"down",sk);_args.output(hasModifier&&sk.which?
sk.which:sk.keyCode,hasModifier&&sk.which?0:sk.charCode,"down",sk.location);_args.output(hasModifier&&sk.which?sk.which:sk.keyCode,hasModifier&&sk.which?0:sk.charCode,"up",sk.location);if(!isModifier)applyModifiersKey({shift:sk.shift,ctrl:sk.ctrl,alt:sk.alt},"up",sk);_args.input.value=" ";_keyDown=false;return}else if(e.keyCode===undefined)pushLastChar(e);else switch(e.keyCode){case _args.keys.delete:_args.output(0,_args.keys.delete,"down",0);_args.output(0,_args.keys.delete,"up",0);_captured=_captured.substr(0,
_captured.length-1);if(_args.input.value===""){_args.input.value=" ";_args.input.selectionStart=_args.input.selectionEnd=1}break;case _args.keys.return:_args.output(0,_args.keys.return,"down",0);_args.output(0,_args.keys.return,"up",0);_captured="";_args.input.value=" ";break;case _args.keys.space:_args.output(0,_args.keys.space,"down",0);_args.output(0,_args.keys.space,"up",0);_captured="";_args.input.value=" ";break;default:break}_keyDown=false}function findUpKey(e){var idx=-1;if(e.key&&_downKeys.length>
0){var key=e.charCode||e.keyCode;var idx=_downKeys.findIndex(function(elem){return elem.key===e.key});if(idx==-1)idx=_downKeys.findIndex(function(elem){return elem.which===e.which});if(idx==-1)idx=_downKeys.findIndex(function(elem){return elem.code===e.code});if(idx==-1)idx=_downKeys.findIndex(function(elem){return elem.id===key})}return idx}function shiftUpKey(e){var fk=null;var idx=findUpKey(e);if(idx!=-1&&idx<_downKeys.length)fk=_downKeys.splice(idx,1)[0];return fk}function pushLastChar(e){var str=
_args.input.value;var lc=str.substr(str.length-1,1);str=lc.charCodeAt(0);_args.output(0,str,"down",0);_args.output(0,str,"up",0);_captured+=lc}function retortSpace(){clearTimeout(_retort.timeoutId);_captured="";_args.output(0,_args.keys.space,"down",0);_args.output(0,_args.keys.space,"up",0);_retort.lastValue="";_retort.spaceFlag=false;_args.input.value="";return}function checkModifier(keyCode){for(var i in _modifiersKeyCode)if(_modifiersKeyCode[i].keyCode===keyCode)return true;return false}function applyModifiersKey(keys,
direction){for(var name in keys)if(keys[name]===true)_args.output(_modifiersKeyCode[name].keyCode,_modifiersKeyCode[name].charCode,direction,_modifiersKeyCode[name].location)}Object.defineProperty(_ref,"initialize",{"enumerable":true,"configurable":false,"writable":false,"value":function(args){return initialize(args)}});Object.defineProperty(_ref,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return dispose()}});Object.defineProperty(_ref,"lastLocationType",
{"enumerable":true,"configurable":false,"get":function(){return _lastLocationType}});return _ref}if(helper.object.existsPath(window,"Thinfinity.Driver.MobileKeyboardHandlers"))Thinfinity.Driver.MobileKeyboardHandlers.add("safari",MobileKeyboardForSafari)})();
(function(){function MobileKeyboardForFirefox(){var _ref=this;var _args={"input":null,"output":null,"keys":null,"locationTypes":null};var _captured="";var _name="firefox";var _retort={"time":50,"lastEvent":null,"lastValue":null};var _lastLocationType=null;function initialize(args){_args=helper.object.parseAttributes(_args,args);var msg=helper.string.format('Cannot initialize "Mobile Keyboard for {0}", "{1}" argument {2}');if(!_args.input){var str=helper.string.format(msg,_name,"input","cannot be null");
helper.console.warning(str,arguments);throw new Error(str);}if(!_args.output&&!(_args.output instanceof Function)){var str=helper.string.format(msg,_name,"output","is not valid function");helper.console.warning(str,arguments);throw new Error(str);}attachEvents()}function dispose(){detachEvents();_args.input=null;_args.output=null;_captured=null;return true}function attachEvents(){helper.dom.addEvent(_args.input,"keydown",keydown_handler);helper.dom.addEvent(_args.input,"keypress",keypress_handler);
helper.dom.addEvent(_args.input,"change",change_handler);helper.dom.addEvent(_args.input,"input",input_handler);helper.dom.addEvent(_args.input,"keyup",keyup_handler)}function detachEvents(){helper.dom.removeEvent(_args.input,"keydown",keydown_handler);helper.dom.removeEvent(_args.input,"keypress",keypress_handler);helper.dom.removeEvent(_args.input,"change",change_handler);helper.dom.removeEvent(_args.input,"input",input_handler);helper.dom.removeEvent(_args.input,"keyup",keyup_handler)}function getLocation(e){return e.location||
e.keyLocation||(e.originalEvent?e.originalEvent.location||e.originalEvent.keyLocation:0)}function keydown_handler(e){e=e||window.srcEvent;var tgt=e.currentTarget||e.srcElement||e.target;_lastLocationType=document===tgt?_args.locationTypes.PHYSICALKEYBOARD:_args.locationTypes.VIRTUALKEYBOARD}function keypress_handler(e){}function change_handler(e){}function input_handler(e){if((new Date).getTime()-_retort.lastEvent>_retort.time||value.substr(value.length-1,1)===" "){_retort.lastEvent=(new Date).getTime();
var value=_args.input.value;var hDeleteKeys=0;var idx=0;if(_captured!="")if(value==="")hDeleteKeys=_captured.length;else{while(_captured.length>idx&&value.length>idx)if(_captured[idx]===value[idx])idx++;else break;hDeleteKeys=_captured.length-idx}if(hDeleteKeys>0){for(var i=0;i<hDeleteKeys;i++){_args.output(0,_args.keys.delete,"down",0);_args.output(0,_args.keys.delete,"up",0)}_captured=_captured.substr(0,_captured.length-hDeleteKeys)}value=value.substr(idx,value.length);for(var i=0;i<value.length;i++){var lc=
value.substr(i,1);var cc=lc.charCodeAt(0);if(cc===_args.keys.space){_captured="";_args.output(0,_args.keys.space,"down",0);_args.output(0,_args.keys.space,"up",0);_args.input.value=value.substr(1,value.length-1)}else{_args.output(0,cc,"down",0);_args.output(0,cc,"up",0);_captured+=lc}}}}function keyup_handler(e){if(e.keyCode===_args.keys.return){_args.output(0,_args.keys.return,"down",0);_args.output(0,_args.keys.return,"up",0);_captured="";_args.input.value=""}else if(e.keyCode!==_args.keys.space&&
_args.input.value===""){_args.output(0,_args.keys.delete,"down",0);_args.output(0,_args.keys.delete,"up",0)}}Object.defineProperty(_ref,"initialize",{"enumerable":true,"configurable":false,"writable":false,"value":function(args){return initialize(args)}});Object.defineProperty(_ref,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return dispose()}});Object.defineProperty(_ref,"lastLocationType",{"enumerable":true,"configurable":false,"get":function(){return _lastLocationType}});
return _ref}if(helper.object.existsPath(window,"Thinfinity.Driver.MobileKeyboardHandlers"))Thinfinity.Driver.MobileKeyboardHandlers.add("firefox",MobileKeyboardForFirefox)})();
(function(){function Font(){var _ref=this;var _anchor=null;var _font={"separation":1,"default":{"size":12,"style":"normal","weight":"normal","family":"Arial"}};function initialize(){try{if(window.document&&window.document.body){_anchor=document.createElement("a");_anchor.style.position="absolute";_anchor.style.top="-5000px";_anchor.style.left="-5000px";window.document.body.appendChild(_anchor)}else setTimeout(initialize,200)}catch(error){return error}}function getSize(text,font){try{var width=0;var height=
0;font=validateFont(font);var fs=font.size;for(var index=0;index<text.toString().length;index++){var letter=text.toString().substring(index+1,index);var size=calcSize(letter,font);width+=size.width+_font.separation;height=size.height>height?size.height:height}return{"width":width,"height":height}}catch(error){return error}}function getWidth(text,font){try{var width=0;font=validateFont(font);var fs=font.size;for(var index=0;index<text.toString().length;index++){var letter=text.toString().substring(index+
1,index);var w=calcSize(letter,font).width;width+=w+_font.separation}return width}catch(error){return error}}function getHeight(text,font){try{var height=0;font=validateFont(font);var fs=font.size;for(var index=0;index<text.toString().length;index++){var letter=text.toString().substring(index+1,index);var h=calcSize(letter,font).height;height=h>height?h:height}return height}catch(error){return error}}function getPhraseSize(text,font){try{var width=0;var height=0;font=validateFont(font);var fs=font.size;
var size={"width":0,"height":0};if(typeof text=="string"){var pattern=/<br>|<br\/>|\\n\\r|\\\\n\\\\r|\\n|\\\\n/g;var m=text.match(pattern);var newText=text;if(m!=null){var s=text.split(pattern);var w=0;var h=0;for(var index in s){var temp=calcSize(s[index],font);if(temp.width>w)w=temp.width;if(temp.height>h)h=temp.height}size.width=w;size.height=h*s.length}else size=calcSize(newText,font)}return size}catch(error){return error}}function getValue(value){try{if(helper.object.isNumber(value))return value;
else if(typeof(value=="string")){var re=new RegExp("[0-9]*");var regExpExec=re.exec(value);if(regExpExec!=null&&regExpExec[0]!=undefined&&regExpExec[0]!=""&&regExpExec[0]!=null)return helper.object.convertTo(regExpExec[0],"int")}}catch(error){return _font.default.size}}function getFontDescription(elem){if(elem)return{"fontSize":helper.style.getAttribute(elem,"font-size"),"fontFamily":helper.style.getAttribute(elem,"font-family"),"fontWeight":helper.style.getAttribute(elem,"font-weight"),"fontStyle":helper.style.getAttribute(elem,
"font-style")}}function validateFont(font){try{if(font==null||font==undefined)font={};else font=helper.object.clone(font);var dSize=_font.default.size;var dStyle=_font.default.style;var dFontName=_font.default.family;var dWeight=_font.default.weight;for(var prop in font)switch(prop.toUpperCase()){case "SIZE":case "FONTSIZE":font.size=font[prop];break;case "NAME":case "FONTNAME":case "FONTFAMILY":font.name=font[prop];break;case "WEIGHT":case "FONTWEIGHT":font.weight=font[prop];break;case "STYLE":case "FONTSTYLE":font.style=
font[prop];break}if(font.name==undefined)font.name=dFontName;else font.name=font.name.toLowerCase();if(font.style==undefined)font.style=dStyle;else font.style=font.style.toLowerCase();if(font.weight==undefined)font.weight=dWeight;else if(!helper.object.isNumber(font.weight))font.weight=font.weight.toLowerCase();if(font.size==undefined)font.size=dSize}catch(error){return error}return font}function calcSize(text,font){try{if(_anchor==null)initialize();_anchor.style.fontFamily=font.name;_anchor.style.fontSize=
font.size;_anchor.style.fontStyle=font.style;if(_anchor.style.fontWeight)_anchor.style.fontWeight=font.weight;_anchor.innerHTML=text;var size=helper.size.get(_anchor);return size}catch(error){return error}}initialize();Object.defineProperty(this,"get",{"enumerable":true,"configurable":false,"writeable":false,"value":getSize});Object.defineProperty(this,"getFont",{"enumerable":true,"configurable":false,"writeable":false,"value":getFontDescription});Object.defineProperty(this,"getWidth",{"enumerable":true,
"configurable":false,"writeable":false,"value":getWidth});Object.defineProperty(this,"getHeight",{"enumerable":true,"configurable":false,"writeable":false,"value":getHeight});Object.defineProperty(this,"getPhraseSize",{"enumerable":true,"configurable":false,"writeable":false,"value":getPhraseSize});helper.console.log(helper.string.format("Initializing {0} class - {1}","Font",(new Date).toString()),arguments);return this}if(typeof window.helperPlugins=="undefined")helperPlugins={};helperPlugins.Font=
Font;if(typeof window.helper!="undefined")helper.registerPlugin("font",Font)})();
(function(){function AnimationFrame(args){var _ref=this;var _args={fps:window.agentInfo?.isMobile?15:30,time:0};var _animationWorker=null;var _isRunning=false;var _hasFocus=true;var _callbackRequest=[];function initialize(args){try{_args.time=parseInt(1E3/_args.fps,10);_animationWorker=new Worker("<%=@BASEURL%>common/workers/animation.frame.worker.js");if(_animationWorker)_animationWorker.onmessage=e=>{if(e.data.cmd==="tick")runCallbacks()};if(typeof Thinfinity.TabFocusHook!=="undefined")initializeTabFocus();
helper.object.parseAttributes(_args,args)}catch(error){return error}}function startWorker(){if(!_isRunning){_isRunning=true;_animationWorker.postMessage({cmd:"start",value:_args.time})}}function stopWorker(){if(_isRunning){_isRunning=false;_animationWorker.postMessage({cmd:"stop"});runCallbacks()}}function runCallbacks(){let tempCB=_callbackRequest;_callbackRequest=[];tempCB.forEach(cb=>{cb()})}function initializeTabFocus(){Thinfinity.TabFocusHook.on("visible",function(e){checkState(true)}).on("focus",
function(e){checkState(true)}).on("hidden",function(e){checkState(false)}).on("blur",function(e){checkState(false)}).on("visibility",function(e){checkState(["visible"].indexOf(e.visibilityState)!==-1)})}function checkState(hasFocus){_hasFocus=hasFocus;if(_hasFocus)stopWorker();else startWorker()}function request(callback){if(_hasFocus)window.requestAnimationFrame(callback);else _callbackRequest.push(callback)}initialize();Object.defineProperty(_ref,"request",{"enumerable":true,"configurable":false,
"writeable":false,"value":request});helper.console.log(helper.string.format("Initializing {0} class - {1}","Font",(new Date).toString()),arguments);return _ref}if(typeof window.helperPlugins=="undefined")helperPlugins={};helperPlugins.AnimationFrame=AnimationFrame;if(typeof window.helper!="undefined")helper.registerPlugin("animationFrame",AnimationFrame)})();
(function(){function Draggable(args){var _ref=this;var _args={"dragElem":null,"container":null,"key":null,"initialPos":{"x":50,"y":50},"events":{"drag":null,"drop":null}};var _events={};var _settings={"threshold":10};var _pos={"x":0,"y":0,"x1":0,"y1":0};var _key="_ _ #thinfinity draggable elem# _ _";var _data={"x":50,"y":50};var _isDragging=false;function initialize(){helper.object.parseAttributes(_args,args);if(!_args.container||!(_args.container instanceof HTMLElement))throw new Error("Cannot initialize draggable class. Container element is undefined or null");
if(!_args.dragElem||!(_args.dragElem instanceof HTMLElement))_args.dragElem=_args.container;var key=_args.key;if(!key||key=="")key=_args.container.name&&_args.container.name!=""?_args.container.name:_args.container.id&&_args.container.id!=""?_args.container.id:_key;_key=key;_data={"x":_args.initialPos.x,"y":_args.initialPos.y};read();checkBounds();_args.container.style.top=_data.y+"px";_args.container.style.left=_data.x+"px";for(var evtName in _args.events)if(_args.events[evtName]instanceof Function)on(evtName,
_args.events[evtName]);start()}function checkBounds(){var maxX=(window.environment.currentWidth||screen.width)-(_args.container.offsetWidth?_args.container.offsetWidth:16);var maxY=(window.environment.currentHeight||screen.height)-(_args.container.offsetHeight?_args.container.offsetHeight:16);if(_data.x>maxX)_data.x=maxX;if(_data.y>maxY)_data.y=maxY}function read(){var temp=helper.storage.get(_key);if(temp)helper.object.parseAttributes(_data,temp)}function write(){helper.storage.set(_key,_data)}function getCoords(e){return{"x":typeof e.pageX!=
"undefined"?e.pageX:(e.changedTouches||e.touches)[0].pageX,"y":typeof e.pageY!="undefined"?e.pageY:(e.changedTouches||e.touches)[0].pageY}}function ondrag(e){e=e||window.event;var pos=getCoords(e);if(_isDragging||Math.abs(Math.max(pos.x,pos.y)-Math.abs(Math.max(_pos.x1,_pos.y1)))>_settings.threshold){_isDragging=true;e.preventDefault();e.stopPropagation();var y=0;var x=0;_pos.x=_pos.x1-pos.x;_pos.y=_pos.y1-pos.y;_pos.x1=pos.x;_pos.y1=pos.y;y=_args.container.offsetTop-_pos.y;x=_args.container.offsetLeft-
_pos.x;if(y<0)y=0;if(x<0)x=0;_args.container.style.top=y+"px";_args.container.style.left=x+"px";fireEvent("drag",{"x":x,"y":y})}}function ondrop(e){var ret=!_isDragging;e=e||window.event;if(_isDragging){e.preventDefault();e.stopPropagation()}var pos=getCoords(e);_isDragging=false;detachHandler();_data.x=_args.container.offsetLeft;_data.y=_args.container.offsetTop;fireEvent("drop",{"x":_data.x,"y":_data.y});write();return ret}function detachHandler(){helper.dom.removeEvent(document,"touchmove",ondrag);
helper.dom.removeEvent(document,"touchend",ondrop);helper.dom.removeEvent(document,"touchleave",ondrop);helper.dom.removeEvent(document,"mousemove",ondrag);helper.dom.removeEvent(document,"mouseup",ondrop);helper.dom.removeEvent(document,"mouseleave",ondrop);helper.dom.removeEvent(_args.dragElem,"mouseup",ondrop);helper.dom.removeEvent(_args.dragElem,"touchend",ondrop)}function mousedown(e){e=e||window.event;if(!agentInfo.isMobile&&(!e.srcElement||e.srcElement.nodeName!=="INPUT")){e.preventDefault();
e.stopPropagation()}var pos=getCoords(e);_pos.x1=pos.x;_pos.y1=pos.y;_isDragging=false;if(agentInfo.isMobile){helper.dom.addEvent(document,"touchmove",ondrag);helper.dom.addEvent(document,"touchend",ondrop);helper.dom.addEvent(document,"touchleave",ondrop);helper.dom.addEvent(_args.dragElem,"touchend",ondrop)}else{helper.dom.addEvent(document,"mousemove",ondrag);helper.dom.addEvent(document,"mouseup",ondrop);helper.dom.addEvent(document,"mouseleave",ondrop);helper.dom.addEvent(_args.dragElem,"mouseup",
ondrop)}}function start(){helper.dom.addEvent(_args.dragElem,agentInfo.isMobile?"ontouchstart":"onmousedown",mousedown)}function stop(){helper.dom.removeEvent(_args.dragElem,agentInfo.isMobile?"ontouchstart":"onmousedown",mousedown)}function on(eventName,handler){if(eventName==undefined||eventName==null||eventName=="")return"Event is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";if(_events[eventName]==undefined)_events[eventName]=[];_events[eventName].push(handler)}
function off(eventName,handler){if(eventName==undefined||eventName==null||eventName=="")return"Event is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";if(_events[eventName])for(var i=_events[eventName].length-1;i>=0;i--)if(_events[eventName][i]===handler)_events[eventName].splice(i,1)}function fireEvent(eventName,data){if(_events[eventName]&&_events[eventName].length>0)for(var i=0;i<_events[eventName].length;i++)try{setTimeout(function(args){_events[eventName][args[0]](data)},
0,[i])}catch(error){}}initialize();Object.defineProperty(_ref,"start",{"enumerable":true,"configurable":false,"writable":false,"value":start});Object.defineProperty(_ref,"stop",{"enumerable":true,"configurable":false,"writable":false,"value":stop});Object.defineProperty(_ref,"on",{"enumerable":true,"configurable":false,"writable":false,"value":on});Object.defineProperty(_ref,"off",{"enumerable":true,"configurable":false,"writable":false,"value":off});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity=
{}}Thinfinity.Draggable=Draggable})();
(function(){function LabelConfig(){var _ref=this;var _root_label={"id":"{00000000-0000-0000-0000-000000000000}","name":"","icon":"thin-home","path":"\\","profileType":0};var _mask_label="{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}";function newLabel(){return helper.utils.maskToGUID(_mask_label)}Object.defineProperty(_ref,"newLabel",{"enumerable":true,"configurable":false,"writable":false,"value":newLabel});Object.defineProperty(_ref,"root",{"enumerable":true,"configurable":false,"get":function(){return _root_label}});
return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.LabelConfig=new LabelConfig})();
(function(){var _registeredPlugin={};function registerPlugin(name,plugin){if(_registeredPlugin[name]==undefined)_registeredPlugin[name]=new plugin}function WindowManager(args){var _ref=this;var _editors={};var _args={"container":null,"options":null};function initialize(){var iframe;helper.object.parseAttributes(_args,args);var options=_args.options;for(var e=0;e<options.length;e++){_editors[options[e].name]=helper.object.clone({"editor":null,"slide":null,"window":null,"timeout":null,"active":false});
_editors[options[e].name].slide=helper.dom.appendJsonElement({"type":"div","parentElement":document.body,"attributes":{"id":options[e].name+"Slide","class":"editorSlider"}});iframe=helper.dom.appendJsonElement({"type":"iframe","parentElement":_editors[options[e].name].slide,"attributes":{"id":options[e].name+"Frame","src":options[e].src}});iframe.setAttribute("allowtransparency","allowtransparency");_editors[options[e].name].window=iframe.contentWindow}_args.manager=_ref;initializePlugins()}function initializePlugins(){for(var name in _registeredPlugin)if(_registeredPlugin[name].initialize){_registeredPlugin[name].initialize(_args);
Object.defineProperty(_ref,name,{"enumerable":true,"configurable":false,"writable":false,"value":_registeredPlugin[name]})}}function get(editorName,attribute){return _editors[editorName]?attribute?_editors[editorName][attribute]:_editors[editorName]:null}function set(editorName,attribute,value){_editors[editorName][attribute]=value}initialize();Object.defineProperty(_ref,"get",{"enumerable":false,"configurable":false,"writable":false,"value":get});Object.defineProperty(_ref,"set",{"enumerable":false,
"configurable":false,"writable":false,"value":set});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(Thinfinity.Window==undefined)Thinfinity.Window={};Thinfinity.Window.Manager=WindowManager;Object.defineProperty(Thinfinity.Window.Manager,"registerPlugin",{"enumerable":true,"configurable":false,"writable":false,"value":registerPlugin})})();
(function(){function Child(args){var _ref=this;var _args={"manager":null,"container":null};var _editorName="profileEditor";var _firstTime=true;function initialize(args){helper.object.parseAttributes(_args,args)}function getQueryString(queryParams){var qp="";if(queryParams)for(var kvp in queryParams)qp+="&"+kvp+"="+queryParams[kvp];return qp}function editProfile(jArgs){var editor=_args.manager.get(_editorName);if(_firstTime){helper.dom.addEvent(editor.slide.firstChild,"load",function(){slideAnimate(editor)});
editor.window.location.href="thinrdp.profileeditor."+jArgs.scraper+"."+jArgs.extension+"?pk="+jArgs.publickey+"&priv="+jArgs.priv+getQueryString(jArgs.queryParams);_firstTime=false}else slideAnimate(editor)}function editFinish(){var editor=_args.manager.get(_editorName);slideAnimate(editor)}function slideAnimate(editor){setTimeout(function(){var newStyle,oldStyle;if(typeof forceValue!="undefined")if(forceValue=="slide-in"){if(!helper.style.hasClass(editor.slide,"slide-in")){newStyle="slide-in";oldStyle=
"slide-out"}}else{if(forceValue=="slide-out")if(!helper.style.hasClass(editor.slide,"slide-out")){newStyle="slide-out";oldStyle="slide-in"}}else if(helper.style.hasClass(editor.slide,"slide-in")){newStyle="slide-out";oldStyle="slide-in"}else{newStyle="slide-in";oldStyle="slide-out"}helper.style.addClass(editor.slide,helper.url.gup("mode",editor.window));helper.style.replace(editor.slide,oldStyle,newStyle);helper.style.replace(_args.container,newStyle,oldStyle);if(newStyle=="slide-in"){if(_editorName!=
"profileEditor")editor.window.document.body.style.display="block";editor.window.focus();editor.active=true}else{if(_editorName!="profileEditor")editor.window.document.body.style.display="none";editor.window.blur();editor.active=false}},250)}Object.defineProperty(_ref,"initialize",{"enumerable":false,"configurable":false,"writable":false,"value":initialize});Object.defineProperty(_ref,"show",{"enumerable":false,"configurable":false,"writable":false,"value":editProfile});Object.defineProperty(_ref,
"hide",{"enumerable":false,"configurable":false,"writable":false,"value":editFinish});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(Thinfinity.Window==undefined)Thinfinity.Window={};Thinfinity.Window.Child=Child;if(Thinfinity.Window.Manager&&Thinfinity.Window.Manager.registerPlugin)Thinfinity.Window.Manager.registerPlugin("child",Child)})();
(function(){function Controller(args){function ControllerCore(args){var _ref=this;var _args={"API":null,"serverUrl":null,"events":{"ready":null,"openProfile":null,"login":null,"logout":null,"error":null},"elements":{"container":null},"methods":{"getProfileType":null}};var _scraper=null;var _components={"dataProvider":null};var _currentUser="";var _profileData=null;var fireEvent=null;var _userInfo=null;var _profileInfo=[];var _currentEditor=null;function initialize(args){helper.object.parseAttributes(_args,
args);var te=new Thinfinity.Events({"owner":_ref,"events":_args.events});fireEvent=te.fireEvent;if(_args.API&&typeof _args.API==="string"){_scraper=_args.API;_args.API=window[args.API]}initializeDataProvider();_components.wndManager=new Thinfinity.Window.Manager({"container":_args.elements.container,"options":[{"name":"profileEditor","src":"about:blank"}]})}function initializeDataProvider(){_components.dataProvider=new _args.API(_args.serverUrl,{"mode":_args.API.mode.API});if(_components.dataProvider){var _interface=
{"login":"function","logout":"function","getUserInfo":"function","getProfiles":"function","profileType":"object"};var invalidInterface=[];for(var kvp in _interface)if(!_components.dataProvider[kvp])invalidInterface.push("invalid method ["+kvp+"], is null or undefined");else if(helper.object.getDataTypeOf(_components.dataProvider[kvp])!==_interface[kvp])invalidInterface.push("invalid method ["+kvp+"], is null or undefined");if(invalidInterface.length>0){invalidInterface.unshift("Data provider error:");
var str=invalidInterface.join("\n\r\t");helper.console.warning(str);fireEvent("error",{"title":"error","message":str})}}else{helper.console.warning(consts.cannotCreateAPI);fireEvent("error",{"title":"error","message":consts.cannotCreateAPI})}}function doLogin(){location.href=helper.url.parseUrl(location.href).toUrl("-r-a")+"?signin"}function doLogout(){if(typeof _components.dataProvider!="undefined"&&_components.dataProvider!=null)_components.dataProvider.logout(function(data){jsdata="";if(data!=
"")jsdata=JSON.parse(data);fireEvent("logout",{"error":0})},function(obj){fireEvent("logout",obj)})}function getUserInfo(callback){_components.dataProvider.getUserInfo(function(data){_userInfo=data;_currentUser=data.data.username;if(callback)callback(data)})}function start(){getUserInfo(function(){getProfiles(function(data){_components.dataProvider.pingStart()})})}function getProfiles(callback){var authenticated=_components.dataProvider.authenticated;if(_args.methods.getProfileType)profType=_args.methods.getProfileType();
if(!profType)profType=authenticated?_components.dataProvider.profileType.PRIVATE:_components.dataProvider.profileType.MRU;_components.dataProvider.getProfiles(profType,function(data){_profileInfo[profType]=data;data.profiles.forEach(function(p){p.isPrivate=authenticated});applyProfilesData(data);callback(data)})}function applyProfilesData(data){_profileData=data;fireEvent("ready",{"username":_userInfo.data.username,"canLogin":_userInfo.data.permissions.canLogin,"canLogout":_userInfo.data.permissions.canLogout,
"enable":_profileData.profiles[0].enable,"permissions":_userInfo.data.permissions,"scraper":_profileData.profiles[0].scraperId,"profile":_profileData.profiles.length>0})}function getCurrentProfile(){return _profileData&&_profileData.profiles.length>0?_profileData.profiles[0]:null}function editProfile(){var p=getCurrentProfile();if(p&&p.scraperId){_currentEditor=_components.wndManager.child;_currentEditor.show({"publickey":p.publickey,"priv":p.isPrivate,"scraper":window.cookiePrefix,"extension":"smb.html"})}else fireEvent("error",
{"message":"Cannot edit undefined or null profile"})}function closeCurrentEditor(){if(_currentEditor)_currentEditor.hide()}function setDataObject(value){_dataObject=value}function getDataObject(value){return _dataObject}initialize(args);Object.defineProperty(_ref,"login",{"enumerable":false,"configurable":false,"writable":false,"value":doLogin});Object.defineProperty(_ref,"logout",{"enumerable":false,"configurable":false,"writable":false,"value":doLogout});Object.defineProperty(_ref,"profile",{"enumerable":false,
"configurable":false,"get":function(){return getCurrentProfile()}});Object.defineProperty(_ref,"start",{"enumerable":false,"configurable":false,"writable":false,"value":start});Object.defineProperty(_ref,"edit",{"enumerable":false,"configurable":false,"writable":false,"value":editProfile});Object.defineProperty(_ref,"closeCurrentEditor",{"enumerable":false,"configurable":false,"writable":false,"value":closeCurrentEditor});Object.defineProperty(_ref,"currentUser",{"enumerable":true,"configurable":false,
"get":function(){return _currentUser}});Object.defineProperty(_ref,"dataProvider",{"enumerable":true,"configurable":false,"get":function(){return _components.dataProvider}});Object.defineProperty(_ref,"dataObject",{"enumerable":true,"configurable":false,"get":getDataObject,"set":setDataObject});return _ref}function initialize(){return new ControllerCore(args)}return initialize()}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(Thinfinity.Controller==undefined)Thinfinity.Controller=Controller})();
!function(nt){!function(r,e,t){var i=function t(i){var n=e[i];return n||r[i][0].call(n=e[i]={exports:{}},t,n,n.exports),n.exports}(t[0]);i.util.global.protobuf=i,"function"==typeof define&&define.amd&&define(["long"],function(t){return t&&t.isLong&&(i.util.Long=t,i.configure()),i}),"object"==typeof module&&module&&module.exports&&(module.exports=i)}({1:[function(t,i,n){i.exports=function(t,i){var n=Array(arguments.length-1),s=0,r=2,o=!0;for(;r<arguments.length;)n[s++]=arguments[r++];return new Promise(function(r,
e){n[s]=function(t){if(o)if(o=!1,t)e(t);else{for(var i=Array(arguments.length-1),n=0;n<i.length;)i[n++]=arguments[n];r.apply(null,i)}};try{t.apply(i||null,n)}catch(t){o&&(o=!1,e(t))}})}},{}],2:[function(t,i,n){n.length=function(t){var i=t.length;if(!i)return 0;for(var n=0;1<--i%4&&"="==(t[0|i]||"");)++n;return Math.ceil(3*t.length)/4-n};for(var h=Array(64),f=Array(123),r=0;r<64;)f[h[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;n.encode=function(t,i,n){for(var r,e=null,s=[],o=0,u=0;i<n;){var f=t[i++];
switch(u){case 0:s[o++]=h[f>>2],r=(3&f)<<4,u=1;break;case 1:s[o++]=h[r|f>>4],r=(15&f)<<2,u=2;break;case 2:s[o++]=h[r|f>>6],s[o++]=h[63&f],u=0}8191<o&&((e=e||[]).push(String.fromCharCode.apply(String,s)),o=0)}return u&&(s[o++]=h[r],s[o++]=61,1===u&&(s[o++]=61)),e?(o&&e.push(String.fromCharCode.apply(String,s.slice(0,o))),e.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var a="invalid encoding";n.decode=function(t,i,n){for(var r,e=n,s=0,o=0;o<t.length;){var u=t.charCodeAt(o++);if(61==u&&
1<s)break;if((u=f[u])===nt)throw Error(a);switch(s){case 0:r=u,s=1;break;case 1:i[n++]=r<<2|(48&u)>>4,r=u,s=2;break;case 2:i[n++]=(15&r)<<4|(60&u)>>2,r=u,s=3;break;case 3:i[n++]=(3&r)<<6|u,s=0}}if(1===s)throw Error(a);return n-e},n.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},{}],3:[function(t,i,n){function c(i,n){"string"==typeof i&&(n=i,i=nt);var f=[];function h(t){if("string"!=typeof t){var i=a();if(c.verbose&&console.log("codegen: "+i),i=
"return "+i,t){for(var n=Object.keys(t),r=Array(n.length+1),e=Array(n.length),s=0;s<n.length;)r[s]=n[s],e[s]=t[n[s++]];return r[s]=i,Function.apply(null,r).apply(null,e)}return Function(i)()}for(var o=Array(arguments.length-1),u=0;u<o.length;)o[u]=arguments[++u];if(u=0,t=t.replace(/%([%dfijs])/g,function(t,i){var n=o[u++];switch(i){case "d":case "f":return""+ +(""+n);case "i":return""+Math.floor(n);case "j":return JSON.stringify(n);case "s":return""+n}return"%"}),u!==o.length)throw Error("parameter count mismatch");
return f.push(t),h}function a(t){return"function "+(t||n||"")+"("+(i&&i.join(",")||"")+"){\n  "+f.join("\n  ")+"\n}"}return h.toString=a,h}(i.exports=c).verbose=!1},{}],4:[function(t,i,n){function r(){this.i={}}(i.exports=r).prototype.on=function(t,i,n){return(this.i[t]||(this.i[t]=[])).push({fn:i,ctx:n||this}),this},r.prototype.off=function(t,i){if(t===nt)this.i={};else if(i===nt)this.i[t]=[];else for(var n=this.i[t],r=0;r<n.length;)n[r].fn===i?n.splice(r,1):++r;return this},r.prototype.emit=function(t){var i=
this.i[t];if(i){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<i.length;)i[r].fn.apply(i[r++].ctx,n)}return this}},{}],5:[function(t,i,n){i.exports=u;var s=t(1),o=t(7)("fs");function u(n,r,e){return r="function"==typeof r?(e=r,{}):r||{},e?!r.xhr&&o&&o.readFile?o.readFile(n,function(t,i){return t&&"undefined"!=typeof XMLHttpRequest?u.xhr(n,r,e):t?e(t):e(null,r.binary?i:i.toString("utf8"))}):u.xhr(n,r,e):s(u,this,n,r)}u.xhr=function(t,n,r){var e=new XMLHttpRequest;e.onreadystatechange=
function(){if(4!==e.readyState)return nt;if(0!==e.status&&200!==e.status)return r(Error("status "+e.status));if(n.binary){if(!(t=e.response))for(var t=[],i=0;i<e.responseText.length;++i)t.push(255&e.responseText.charCodeAt(i));return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(t):t)}return r(null,e.responseText)},n.binary&&("overrideMimeType"in e&&e.overrideMimeType("text/plain; charset=x-user-defined"),e.responseType="arraybuffer"),e.open("GET",t),e.send()}},{1:1,7:7}],6:[function(t,i,n){function r(t){function i(t,
i,n,r){var e=i<0?1:0;t(0===(i=e?-i:i)?0<1/i?0:2147483648:isNaN(i)?2143289344:3.4028234663852886E38<i?(e<<31|2139095040)>>>0:i<1.1754943508222875E-38?(e<<31|Math.round(i/1.401298464324817E-45))>>>0:(e<<31|127+(t=Math.floor(Math.log(i)/Math.LN2))<<23|8388607&Math.round(i*Math.pow(2,-t)*8388608))>>>0,n,r)}function n(t,i,n){t=t(i,n),i=2*(t>>31)+1,n=t>>>23&255,t&=8388607;return 255==n?t?NaN:1/0*i:0==n?1.401298464324817E-45*i*t:i*Math.pow(2,n-150)*(8388608+t)}function r(t,i,n){u[0]=t,i[n]=f[0],i[n+1]=f[1],
i[n+2]=f[2],i[n+3]=f[3]}function e(t,i,n){u[0]=t,i[n]=f[3],i[n+1]=f[2],i[n+2]=f[1],i[n+3]=f[0]}function s(t,i){return f[0]=t[i],f[1]=t[i+1],f[2]=t[i+2],f[3]=t[i+3],u[0]}function o(t,i){return f[3]=t[i],f[2]=t[i+1],f[1]=t[i+2],f[0]=t[i+3],u[0]}var u,f,h,a,c;function l(t,i,n,r,e,s){var o,u=r<0?1:0;0===(r=u?-r:r)?(t(0,e,s+i),t(0<1/r?0:2147483648,e,s+n)):isNaN(r)?(t(0,e,s+i),t(2146959360,e,s+n)):1.7976931348623157E308<r?(t(0,e,s+i),t((u<<31|2146435072)>>>0,e,s+n)):r<2.2250738585072014E-308?(t((o=r/4.9E-324)>>>
0,e,s+i),t((u<<31|o/4294967296)>>>0,e,s+n)):(t(4503599627370496*(o=r*Math.pow(2,-(r=1024===(r=Math.floor(Math.log(r)/Math.LN2))?1023:r)))>>>0,e,s+i),t((u<<31|r+1023<<20|1048576*o&1048575)>>>0,e,s+n))}function d(t,i,n,r,e){i=t(r,e+i),t=t(r,e+n),r=2*(t>>31)+1,e=t>>>20&2047,n=4294967296*(1048575&t)+i;return 2047==e?n?NaN:1/0*r:0==e?4.9E-324*r*n:r*Math.pow(2,e-1075)*(n+4503599627370496)}function p(t,i,n){h[0]=t,i[n]=a[0],i[n+1]=a[1],i[n+2]=a[2],i[n+3]=a[3],i[n+4]=a[4],i[n+5]=a[5],i[n+6]=a[6],i[n+7]=a[7]}
function v(t,i,n){h[0]=t,i[n]=a[7],i[n+1]=a[6],i[n+2]=a[5],i[n+3]=a[4],i[n+4]=a[3],i[n+5]=a[2],i[n+6]=a[1],i[n+7]=a[0]}function b(t,i){return a[0]=t[i],a[1]=t[i+1],a[2]=t[i+2],a[3]=t[i+3],a[4]=t[i+4],a[5]=t[i+5],a[6]=t[i+6],a[7]=t[i+7],h[0]}function y(t,i){return a[7]=t[i],a[6]=t[i+1],a[5]=t[i+2],a[4]=t[i+3],a[3]=t[i+4],a[2]=t[i+5],a[1]=t[i+6],a[0]=t[i+7],h[0]}return"undefined"!=typeof Float32Array?(u=new Float32Array([-0]),f=new Uint8Array(u.buffer),c=128===f[3],t.writeFloatLE=c?r:e,t.writeFloatBE=
c?e:r,t.readFloatLE=c?s:o,t.readFloatBE=c?o:s):(t.writeFloatLE=i.bind(null,w),t.writeFloatBE=i.bind(null,m),t.readFloatLE=n.bind(null,g),t.readFloatBE=n.bind(null,j)),"undefined"!=typeof Float64Array?(h=new Float64Array([-0]),a=new Uint8Array(h.buffer),c=128===a[7],t.writeDoubleLE=c?p:v,t.writeDoubleBE=c?v:p,t.readDoubleLE=c?b:y,t.readDoubleBE=c?y:b):(t.writeDoubleLE=l.bind(null,w,0,4),t.writeDoubleBE=l.bind(null,m,4,0),t.readDoubleLE=d.bind(null,g,0,4),t.readDoubleBE=d.bind(null,j,4,0)),t}function w(t,
i,n){i[n]=255&t,i[n+1]=t>>>8&255,i[n+2]=t>>>16&255,i[n+3]=t>>>24}function m(t,i,n){i[n]=t>>>24,i[n+1]=t>>>16&255,i[n+2]=t>>>8&255,i[n+3]=255&t}function g(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16|t[i+3]<<24)>>>0}function j(t,i){return(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3])>>>0}i.exports=r(r)},{}],7:[function(t,i,n){function r(t){try{var i=eval("require")(t);if(i&&(i.length||Object.keys(i).length))return i}catch(t){}return null}i.exports=r},{}],8:[function(t,i,n){var e=n.isAbsolute=function(t){return/^(?:\/|\w+:)/.test(t)},
r=n.normalize=function(t){var i=(t=t.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=e(t),t="";n&&(t=i.shift()+"/");for(var r=0;r<i.length;)".."===i[r]?0<r&&".."!==i[r-1]?i.splice(--r,2):n?i.splice(r,1):++r:"."===i[r]?i.splice(r,1):++r;return t+i.join("/")};n.resolve=function(t,i,n){return n||(i=r(i)),!e(i)&&(t=(t=n?t:r(t)).replace(/(?:\/|^)[^/]+$/,"")).length?r(t+"/"+i):i}},{}],9:[function(t,i,n){i.exports=function(i,n,t){var r=t||8192,e=r>>>1,s=null,o=r;return function(t){if(t<1||e<t)return i(t);
r<o+t&&(s=i(r),o=0);t=n.call(s,o,o+=t);return 7&o&&(o=1+(7|o)),t}}},{}],10:[function(t,i,n){n.length=function(t){for(var i,n=0,r=0;r<t.length;++r)(i=t.charCodeAt(r))<128?n+=1:i<2048?n+=2:55296==(64512&i)&&56320==(64512&t.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},n.read=function(t,i,n){if(n-i<1)return"";for(var r,e=null,s=[],o=0;i<n;)(r=t[i++])<128?s[o++]=r:191<r&&r<224?s[o++]=(31&r)<<6|63&t[i++]:239<r&&r<365?(r=((7&r)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536,s[o++]=55296+(r>>10),s[o++]=
56320+(1023&r)):s[o++]=(15&r)<<12|(63&t[i++])<<6|63&t[i++],8191<o&&((e=e||[]).push(String.fromCharCode.apply(String,s)),o=0);return e?(o&&e.push(String.fromCharCode.apply(String,s.slice(0,o))),e.join("")):String.fromCharCode.apply(String,s.slice(0,o))},n.write=function(t,i,n){for(var r,e,s=n,o=0;o<t.length;++o)(r=t.charCodeAt(o))<128?i[n++]=r:(r<2048?i[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(e=t.charCodeAt(o+1)))?(++o,i[n++]=(r=65536+((1023&r)<<10)+(1023&e))>>18|240,i[n++]=r>>12&63|128):i[n++]=
r>>12|224,i[n++]=r>>6&63|128),i[n++]=63&r|128);return n-s}},{}],11:[function(t,i,n){i.exports=e;var r=/\/|\./;function e(t,i){r.test(t)||(t="google/protobuf/"+t+".proto",i={nested:{google:{nested:{protobuf:{nested:i}}}}}),e[t]=i}e("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),e("duration",{Duration:i={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),e("timestamp",{Timestamp:i}),e("empty",{Empty:{fields:{}}}),e("struct",{Struct:{fields:{fields:{keyType:"string",
type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),e("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",
id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),e("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),e.get=function(t){return e[t]||null}},{}],12:[function(t,i,n){var l=t(15),
d=t(37);function o(t,i,n,r){var e=!1;if(i.resolvedType)if(i.resolvedType instanceof l){t("switch(d%s){",r);for(var s=i.resolvedType.values,o=Object.keys(s),u=0;u<o.length;++u)s[o[u]]!==i.typeDefault||e||(t("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),i.repeated||t("break"),e=!0),t("case%j:",o[u])("case %i:",s[o[u]])("m%s=%j",r,s[o[u]])("break");t("}")}else t('if(typeof d%s!=="object")',r)("throw TypeError(%j)",i.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,n,r);
else{var f=!1;switch(i.type){case "double":case "float":t("m%s=Number(d%s)",r,r);break;case "uint32":case "fixed32":t("m%s=d%s>>>0",r,r);break;case "int32":case "sint32":case "sfixed32":t("m%s=d%s|0",r,r);break;case "uint64":f=!0;case "int64":case "sint64":case "fixed64":case "sfixed64":t("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,f)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',
r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,f?"true":"");break;case "bytes":t('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case "string":t("m%s=String(d%s)",r,r);break;case "bool":t("m%s=Boolean(d%s)",r,r)}}return t}function p(t,i,n,r){if(i.resolvedType)i.resolvedType instanceof l?t("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",
r,n,r,r,n,r,r):t("d%s=types[%i].toObject(m%s,o)",r,n,r);else{var e=!1;switch(i.type){case "double":case "float":t("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case "uint64":e=!0;case "int64":case "sint64":case "fixed64":case "sfixed64":t('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,e?"true":"",r);
break;case "bytes":t("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:t("d%s=m%s",r,r)}}return t}n.fromObject=function(t){var i=t.fieldsArray,n=d.codegen(["d"],t.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!i.length)return n("return new this.ctor");n("var m=new this.ctor");for(var r=0;r<i.length;++r){var e=i[r].resolve(),s=d.safeProp(e.name);e.map?(n("if(d%s){",s)('if(typeof d%s!=="object")',
s)("throw TypeError(%j)",e.fullName+": object expected")("m%s={}",s)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",s),o(n,e,r,s+"[ks[i]]")("}")("}")):e.repeated?(n("if(d%s){",s)("if(!Array.isArray(d%s))",s)("throw TypeError(%j)",e.fullName+": array expected")("m%s=[]",s)("for(var i=0;i<d%s.length;++i){",s),o(n,e,r,s+"[i]")("}")("}")):(e.resolvedType instanceof l||n("if(d%s!=null){",s),o(n,e,r,s),e.resolvedType instanceof l||n("}"))}return n("return m")},n.toObject=function(t){var i=t.fieldsArray.slice().sort(d.compareFieldsById);
if(!i.length)return d.codegen()("return {}");for(var n=d.codegen(["m","o"],t.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],e=[],s=[],o=0;o<i.length;++o)i[o].partOf||(i[o].resolve().repeated?r:i[o].map?e:s).push(i[o]);if(r.length){for(n("if(o.arrays||o.defaults){"),o=0;o<r.length;++o)n("d%s=[]",d.safeProp(r[o].name));n("}")}if(e.length){for(n("if(o.objects||o.defaults){"),o=0;o<e.length;++o)n("d%s={}",d.safeProp(e[o].name));n("}")}if(s.length){for(n("if(o.defaults){"),o=0;o<s.length;++o){var u,
f=s[o],h=d.safeProp(f.name);f.resolvedType instanceof l?n("d%s=o.enums===String?%j:%j",h,f.resolvedType.valuesById[f.typeDefault],f.typeDefault):f.long?n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",f.typeDefault.low,f.typeDefault.high,f.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,f.typeDefault.toString(),f.typeDefault.toNumber()):f.bytes?(u="["+Array.prototype.slice.call(f.typeDefault).join(",")+"]",n("if(o.bytes===String)d%s=%j",
h,String.fromCharCode.apply(String,f.typeDefault))("else{")("d%s=%s",h,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")):n("d%s=%j",h,f.typeDefault)}n("}")}for(var a=!1,o=0;o<i.length;++o){var f=i[o],c=t.e.indexOf(f),h=d.safeProp(f.name);f.map?(a||(a=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),p(n,f,c,h+"[ks2[j]]")("}")):f.repeated?(n("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),p(n,f,c,h+"[j]")("}")):
(n("if(m%s!=null&&m.hasOwnProperty(%j)){",h,f.name),p(n,f,c,h),f.partOf&&n("if(o.oneofs)")("d%s=%j",d.safeProp(f.partOf.name),f.name)),n("}")}return n("return d")}},{15:15,37:37}],13:[function(t,i,n){i.exports=function(t){var i=h.codegen(["r","l"],t.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(t.fieldsArray.filter(function(t){return t.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");t.group&&i("if((t&7)===4)")("break");
i("switch(t>>>3){");for(var n=0;n<t.fieldsArray.length;++n){var r=t.e[n].resolve(),e=r.resolvedType instanceof u?"int32":r.type,s="m"+h.safeProp(r.name);i("case %i: {",r.id),r.map?(i("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),f.defaults[r.keyType]!==nt?i("k=%j",f.defaults[r.keyType]):i("k=null"),f.defaults[e]!==nt?i("value=%j",f.defaults[e]):i("value=null"),i("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),
f.basic[e]===nt?i("value=types[%i].decode(r,r.uint32())",n):i("value=r.%s()",e),i("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),f.long[r.keyType]!==nt?i('%s[typeof k==="object"?util.longToHash(k):k]=value',s):i("%s[k]=value",s)):r.repeated?(i("if(!(%s&&%s.length))",s,s)("%s=[]",s),f.packed[e]!==nt&&i("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,e)("}else"),f.basic[e]===nt?i(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",
s,n):i("%s.push(r.%s())",s,e)):f.basic[e]===nt?i(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,n):i("%s=r.%s()",s,e),i("break")("}")}for(i("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<t.e.length;++n){var o=t.e[n];o.required&&i("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})","missing required '"+o.name+"'")}return i("return m")};var u=t(15),f=t(36),h=t(37)},{15:15,36:36,37:37}],14:[function(t,i,n){i.exports=function(t){for(var i,
n=c.codegen(["m","w"],t.name+"$encode")("if(!w)")("w=Writer.create()"),r=t.fieldsArray.slice().sort(c.compareFieldsById),e=0;e<r.length;++e){var s=r[e].resolve(),o=t.e.indexOf(s),u=s.resolvedType instanceof h?"int32":s.type,f=a.basic[u];i="m"+c.safeProp(s.name),s.map?(n("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",i,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",i)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|a.mapKey[s.keyType],s.keyType),f===nt?n("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",
o,i):n(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|f,u,i),n("}")("}")):s.repeated?(n("if(%s!=null&&%s.length){",i,i),s.packed&&a.packed[u]!==nt?n("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",i)("w.%s(%s[i])",u,i)("w.ldelim()"):(n("for(var i=0;i<%s.length;++i)",i),f===nt?l(n,s,o,i+"[i]"):n("w.uint32(%i).%s(%s[i])",(s.id<<3|f)>>>0,u,i)),n("}")):(s.optional&&n("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",i,s.name),f===nt?l(n,s,o,i):n("w.uint32(%i).%s(%s)",(s.id<<3|f)>>>0,u,i))}return n("return w")};
var h=t(15),a=t(36),c=t(37);function l(t,i,n,r){i.resolvedType.group?t("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,(i.id<<3|3)>>>0,(i.id<<3|4)>>>0):t("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,(i.id<<3|2)>>>0)}},{15:15,36:36,37:37}],15:[function(t,i,n){i.exports=s;var f=t(24),r=(((s.prototype=Object.create(f.prototype)).constructor=s).className="Enum",t(23)),e=t(37);function s(t,i,n,r,e,s){if(f.call(this,t,n),i&&"object"!=typeof i)throw TypeError("values must be an object");if(this.valuesById=
{},this.values=Object.create(this.valuesById),this.comment=r,this.comments=e||{},this.valuesOptions=s,this.reserved=nt,i)for(var o=Object.keys(i),u=0;u<o.length;++u)"number"==typeof i[o[u]]&&(this.valuesById[this.values[o[u]]=i[o[u]]]=o[u])}s.fromJSON=function(t,i){t=new s(t,i.values,i.options,i.comment,i.comments);return t.reserved=i.reserved,t},s.prototype.toJSON=function(t){t=!!t&&!!t.keepComments;return e.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,
"reserved",this.reserved&&this.reserved.length?this.reserved:nt,"comment",t?this.comment:nt,"comments",t?this.comments:nt])},s.prototype.add=function(t,i,n,r){if(!e.isString(t))throw TypeError("name must be a string");if(!e.isInteger(i))throw TypeError("id must be an integer");if(this.values[t]!==nt)throw Error("duplicate name '"+t+"' in "+this);if(this.isReservedId(i))throw Error("id "+i+" is reserved in "+this);if(this.isReservedName(t))throw Error("name '"+t+"' is reserved in "+this);if(this.valuesById[i]!==
nt){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+i+" in "+this);this.values[t]=i}else this.valuesById[this.values[t]=i]=t;return r&&(this.valuesOptions===nt&&(this.valuesOptions={}),this.valuesOptions[t]=r||null),this.comments[t]=n||null,this},s.prototype.remove=function(t){if(!e.isString(t))throw TypeError("name must be a string");var i=this.values[t];if(null==i)throw Error("name '"+t+"' does not exist in "+this);return delete this.valuesById[i],delete this.values[t],delete this.comments[t],
this.valuesOptions&&delete this.valuesOptions[t],this},s.prototype.isReservedId=function(t){return r.isReservedId(this.reserved,t)},s.prototype.isReservedName=function(t){return r.isReservedName(this.reserved,t)}},{23:23,24:24,37:37}],16:[function(t,i,n){i.exports=o;var r,u=t(24),e=(((o.prototype=Object.create(u.prototype)).constructor=o).className="Field",t(15)),f=t(36),h=t(37),a=/^required|optional|repeated$/;function o(t,i,n,r,e,s,o){if(h.isObject(r)?(o=e,s=r,r=e=nt):h.isObject(e)&&(o=s,s=e,e=
nt),u.call(this,t,s),!h.isInteger(i)||i<0)throw TypeError("id must be a non-negative integer");if(!h.isString(n))throw TypeError("type must be a string");if(r!==nt&&!a.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(e!==nt&&!h.isString(e))throw TypeError("extend must be a string");this.rule=(r="proto3_optional"===r?"optional":r)&&"optional"!==r?r:nt,this.type=n,this.id=i,this.extend=e||nt,this.required="required"===r,this.optional=!this.required,this.repeated="repeated"===
r,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!h.Long&&f.long[n]!==nt,this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.o=null,this.comment=o}o.fromJSON=function(t,i){return new o(t,i.id,i.type,i.rule,i.extend,i.options,i.comment)},Object.defineProperty(o.prototype,"packed",{get:function(){return null===this.o&&(this.o=!1!==this.getOption("packed")),this.o}}),o.prototype.setOption=function(t,
i,n){return"packed"===t&&(this.o=null),u.prototype.setOption.call(this,t,i,n)},o.prototype.toJSON=function(t){t=!!t&&!!t.keepComments;return h.toObject(["rule","optional"!==this.rule&&this.rule||nt,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:nt])},o.prototype.resolve=function(){var t;return this.resolved?this:((this.typeDefault=f.defaults[this.type])===nt?(this.resolvedType=(this.declaringField||this).parent.lookupTypeOrEnum(this.type),this.resolvedType instanceof
r?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof e&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(this.options.packed===nt||!this.resolvedType||this.resolvedType instanceof
e)||delete this.options.packed,Object.keys(this.options).length||(this.options=nt)),this.long?(this.typeDefault=h.Long.fromNumber(this.typeDefault,"u"==(this.type[0]||"")),Object.freeze&&Object.freeze(this.typeDefault)):this.bytes&&"string"==typeof this.typeDefault&&(h.base64.test(this.typeDefault)?h.base64.decode(this.typeDefault,t=h.newBuffer(h.base64.length(this.typeDefault)),0):h.utf8.write(this.typeDefault,t=h.newBuffer(h.utf8.length(this.typeDefault)),0),this.typeDefault=t),this.map?this.defaultValue=
h.emptyObject:this.repeated?this.defaultValue=h.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof r&&(this.parent.ctor.prototype[this.name]=this.defaultValue),u.prototype.resolve.call(this))},o.d=function(n,r,e,s){return"function"==typeof r?r=h.decorateType(r).name:r&&"object"==typeof r&&(r=h.decorateEnum(r).name),function(t,i){h.decorateType(t.constructor).add(new o(i,n,r,e,{default:s}))}},o.u=function(t){r=t}},{15:15,24:24,36:36,37:37}],17:[function(t,i,n){var r=i.exports=t(18);
r.build="light",r.load=function(t,i,n){return(i="function"==typeof i?(n=i,new r.Root):i||new r.Root).load(t,n)},r.loadSync=function(t,i){return(i=i||new r.Root).loadSync(t)},r.encoder=t(14),r.decoder=t(13),r.verifier=t(40),r.converter=t(12),r.ReflectionObject=t(24),r.Namespace=t(23),r.Root=t(29),r.Enum=t(15),r.Type=t(35),r.Field=t(16),r.OneOf=t(25),r.MapField=t(20),r.Service=t(33),r.Method=t(22),r.Message=t(21),r.wrappers=t(41),r.types=t(36),r.util=t(37),r.ReflectionObject.u(r.Root),r.Namespace.u(r.Type,
r.Service,r.Enum),r.Root.u(r.Type),r.Field.u(r.Type)},{12:12,13:13,14:14,15:15,16:16,18:18,20:20,21:21,22:22,23:23,24:24,25:25,29:29,33:33,35:35,36:36,37:37,40:40,41:41}],18:[function(t,i,n){var r=n;function e(){r.util.u(),r.Writer.u(r.BufferWriter),r.Reader.u(r.BufferReader)}r.build="minimal",r.Writer=t(42),r.BufferWriter=t(43),r.Reader=t(27),r.BufferReader=t(28),r.util=t(39),r.rpc=t(31),r.roots=t(30),r.configure=e,e()},{27:27,28:28,30:30,31:31,39:39,42:42,43:43}],19:[function(t,i,n){i=i.exports=
t(17);i.build="full",i.tokenize=t(34),i.parse=t(26),i.common=t(11),i.Root.u(i.Type,i.parse,i.common)},{11:11,17:17,26:26,34:34}],20:[function(t,i,n){i.exports=s;var o=t(16),r=(((s.prototype=Object.create(o.prototype)).constructor=s).className="MapField",t(36)),u=t(37);function s(t,i,n,r,e,s){if(o.call(this,t,i,r,nt,nt,e,s),!u.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}s.fromJSON=function(t,i){return new s(t,i.id,i.keyType,i.type,i.options,
i.comment)},s.prototype.toJSON=function(t){t=!!t&&!!t.keepComments;return u.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:nt])},s.prototype.resolve=function(){if(this.resolved)return this;if(r.mapKey[this.keyType]===nt)throw Error("invalid key type: "+this.keyType);return o.prototype.resolve.call(this)},s.d=function(n,r,e){return"function"==typeof e?e=u.decorateType(e).name:e&&"object"==typeof e&&(e=u.decorateEnum(e).name),
function(t,i){u.decorateType(t.constructor).add(new s(i,n,r,e))}}},{16:16,36:36,37:37}],21:[function(t,i,n){i.exports=e;var r=t(39);function e(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)this[i[n]]=t[i[n]]}e.create=function(t){return this.$type.create(t)},e.encode=function(t,i){return this.$type.encode(t,i)},e.encodeDelimited=function(t,i){return this.$type.encodeDelimited(t,i)},e.decode=function(t){return this.$type.decode(t)},e.decodeDelimited=function(t){return this.$type.decodeDelimited(t)},
e.verify=function(t){return this.$type.verify(t)},e.fromObject=function(t){return this.$type.fromObject(t)},e.toObject=function(t,i){return this.$type.toObject(t,i)},e.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},{39:39}],22:[function(t,i,n){i.exports=r;var h=t(24),a=(((r.prototype=Object.create(h.prototype)).constructor=r).className="Method",t(37));function r(t,i,n,r,e,s,o,u,f){if(a.isObject(e)?(o=e,e=s=nt):a.isObject(s)&&(o=s,s=nt),i!==nt&&!a.isString(i))throw TypeError("type must be a string");
if(!a.isString(n))throw TypeError("requestType must be a string");if(!a.isString(r))throw TypeError("responseType must be a string");h.call(this,t,o),this.type=i||"rpc",this.requestType=n,this.requestStream=!!e||nt,this.responseType=r,this.responseStream=!!s||nt,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=f}r.fromJSON=function(t,i){return new r(t,i.type,i.requestType,i.responseType,i.requestStream,i.responseStream,i.options,i.comment,i.parsedOptions)},
r.prototype.toJSON=function(t){t=!!t&&!!t.keepComments;return a.toObject(["type","rpc"!==this.type&&this.type||nt,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:nt,"parsedOptions",this.parsedOptions])},r.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),
h.prototype.resolve.call(this))}},{24:24,37:37}],23:[function(t,i,n){i.exports=c;var e,s,o,r=t(24),u=(((c.prototype=Object.create(r.prototype)).constructor=c).className="Namespace",t(16)),f=t(37),h=t(25);function a(t,i){if(!t||!t.length)return nt;for(var n={},r=0;r<t.length;++r)n[t[r].name]=t[r].toJSON(i);return n}function c(t,i){r.call(this,t,i),this.nested=nt,this.f=null}function l(t){return t.f=null,t}c.fromJSON=function(t,i){return(new c(t,i.options)).addJSON(i.nested)},c.arrayToJSON=a,c.isReservedId=
function(t,i){if(t)for(var n=0;n<t.length;++n)if("string"!=typeof t[n]&&t[n][0]<=i&&t[n][1]>i)return!0;return!1},c.isReservedName=function(t,i){if(t)for(var n=0;n<t.length;++n)if(t[n]===i)return!0;return!1},Object.defineProperty(c.prototype,"nestedArray",{get:function(){return this.f||(this.f=f.toArray(this.nested))}}),c.prototype.toJSON=function(t){return f.toObject(["options",this.options,"nested",a(this.nestedArray,t)])},c.prototype.addJSON=function(t){if(t)for(var i,n=Object.keys(t),r=0;r<n.length;++r)i=
t[n[r]],this.add((i.fields!==nt?e:i.values!==nt?o:i.methods!==nt?s:i.id!==nt?u:c).fromJSON(n[r],i));return this},c.prototype.get=function(t){return this.nested&&this.nested[t]||null},c.prototype.getEnum=function(t){if(this.nested&&this.nested[t]instanceof o)return this.nested[t].values;throw Error("no such enum: "+t);},c.prototype.add=function(t){if(!(t instanceof u&&t.extend!==nt||t instanceof e||t instanceof h||t instanceof o||t instanceof s||t instanceof c))throw TypeError("object must be a valid nested object");
if(this.nested){var i=this.get(t.name);if(i){if(!(i instanceof c&&t instanceof c)||i instanceof e||i instanceof s)throw Error("duplicate name '"+t.name+"' in "+this);for(var n=i.nestedArray,r=0;r<n.length;++r)t.add(n[r]);this.remove(i),this.nested||(this.nested={}),t.setOptions(i.options,!0)}}else this.nested={};return(this.nested[t.name]=t).onAdd(this),l(this)},c.prototype.remove=function(t){if(!(t instanceof r))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+
" is not a member of "+this);return delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=nt),t.onRemove(this),l(this)},c.prototype.define=function(t,i){if(f.isString(t))t=t.split(".");else if(!Array.isArray(t))throw TypeError("illegal path");if(t&&t.length&&""===t[0])throw Error("path must be relative");for(var n=this;0<t.length;){var r=t.shift();if(n.nested&&n.nested[r]){if(!((n=n.nested[r])instanceof c))throw Error("path conflicts with non-namespace objects");}else n.add(n=new c(r))}return i&&
n.addJSON(i),n},c.prototype.resolveAll=function(){for(var t=this.nestedArray,i=0;i<t.length;)t[i]instanceof c?t[i++].resolveAll():t[i++].resolve();return this.resolve()},c.prototype.lookup=function(t,i,n){if("boolean"==typeof i?(n=i,i=nt):i&&!Array.isArray(i)&&(i=[i]),f.isString(t)&&t.length){if("."===t)return this.root;t=t.split(".")}else if(!t.length)return this;if(""===t[0])return this.root.lookup(t.slice(1),i);var r=this.get(t[0]);if(r)if(1===t.length){if(!i||~i.indexOf(r.constructor))return r}else{if(r instanceof
c&&(r=r.lookup(t.slice(1),i,!0)))return r}else for(var e=0;e<this.nestedArray.length;++e)if(this.f[e]instanceof c&&(r=this.f[e].lookup(t,i,!0)))return r;return null===this.parent||n?null:this.parent.lookup(t,i)},c.prototype.lookupType=function(t){var i=this.lookup(t,[e]);if(i)return i;throw Error("no such type: "+t);},c.prototype.lookupEnum=function(t){var i=this.lookup(t,[o]);if(i)return i;throw Error("no such Enum '"+t+"' in "+this);},c.prototype.lookupTypeOrEnum=function(t){var i=this.lookup(t,
[e,o]);if(i)return i;throw Error("no such Type or Enum '"+t+"' in "+this);},c.prototype.lookupService=function(t){var i=this.lookup(t,[s]);if(i)return i;throw Error("no such Service '"+t+"' in "+this);},c.u=function(t,i,n){e=t,s=i,o=n}},{16:16,24:24,25:25,37:37}],24:[function(t,i,n){(i.exports=e).className="ReflectionObject";var r,o=t(37);function e(t,i){if(!o.isString(t))throw TypeError("name must be a string");if(i&&!o.isObject(i))throw TypeError("options must be an object");this.options=i,this.parsedOptions=
null,this.name=t,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(e.prototype,{root:{get:function(){for(var t=this;null!==t.parent;)t=t.parent;return t}},fullName:{get:function(){for(var t=[this.name],i=this.parent;i;)t.unshift(i.name),i=i.parent;return t.join(".")}}}),e.prototype.toJSON=function(){throw Error();},e.prototype.onAdd=function(t){this.parent&&this.parent!==t&&this.parent.remove(this),this.parent=t,this.resolved=!1;t=t.root;t instanceof r&&
t.h(this)},e.prototype.onRemove=function(t){t=t.root;t instanceof r&&t.a(this),this.parent=null,this.resolved=!1},e.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},e.prototype.getOption=function(t){return this.options?this.options[t]:nt},e.prototype.setOption=function(t,i,n){return n&&this.options&&this.options[t]!==nt||((this.options||(this.options={}))[t]=i),this},e.prototype.setParsedOption=function(i,t,n){this.parsedOptions||(this.parsedOptions=
[]);var r,e,s=this.parsedOptions;return n?(r=s.find(function(t){return Object.prototype.hasOwnProperty.call(t,i)}))?(e=r[i],o.setProperty(e,n,t)):((r={})[i]=o.setProperty({},n,t),s.push(r)):((e={})[i]=t,s.push(e)),this},e.prototype.setOptions=function(t,i){if(t)for(var n=Object.keys(t),r=0;r<n.length;++r)this.setOption(n[r],t[n[r]],i);return this},e.prototype.toString=function(){var t=this.constructor.className,i=this.fullName;return i.length?t+" "+i:t},e.u=function(t){r=t}},{37:37}],25:[function(t,
i,n){i.exports=o;var e=t(24),r=(((o.prototype=Object.create(e.prototype)).constructor=o).className="OneOf",t(16)),s=t(37);function o(t,i,n,r){if(Array.isArray(i)||(n=i,i=nt),e.call(this,t,n),i!==nt&&!Array.isArray(i))throw TypeError("fieldNames must be an Array");this.oneof=i||[],this.fieldsArray=[],this.comment=r}function u(t){if(t.parent)for(var i=0;i<t.fieldsArray.length;++i)t.fieldsArray[i].parent||t.parent.add(t.fieldsArray[i])}o.fromJSON=function(t,i){return new o(t,i.oneof,i.options,i.comment)},
o.prototype.toJSON=function(t){t=!!t&&!!t.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:nt])},o.prototype.add=function(t){if(t instanceof r)return t.parent&&t.parent!==this.parent&&t.parent.remove(t),this.oneof.push(t.name),this.fieldsArray.push(t),u(t.partOf=this),this;throw TypeError("field must be a Field");},o.prototype.remove=function(t){if(!(t instanceof r))throw TypeError("field must be a Field");var i=this.fieldsArray.indexOf(t);if(i<0)throw Error(t+
" is not a member of "+this);return this.fieldsArray.splice(i,1),-1<(i=this.oneof.indexOf(t.name))&&this.oneof.splice(i,1),t.partOf=null,this},o.prototype.onAdd=function(t){e.prototype.onAdd.call(this,t);for(var i=0;i<this.oneof.length;++i){var n=t.get(this.oneof[i]);n&&!n.partOf&&(n.partOf=this).fieldsArray.push(n)}u(this)},o.prototype.onRemove=function(t){for(var i,n=0;n<this.fieldsArray.length;++n)(i=this.fieldsArray[n]).parent&&i.parent.remove(i);e.prototype.onRemove.call(this,t)},o.d=function(){for(var n=
Array(arguments.length),t=0;t<arguments.length;)n[t]=arguments[t++];return function(t,i){s.decorateType(t.constructor).add(new o(i,n)),Object.defineProperty(t,i,{get:s.oneOfGetter(n),set:s.oneOfSetter(n)})}}},{16:16,24:24,37:37}],26:[function(t,i,n){(i.exports=it).filename=null,it.defaults={keepCase:!1};var I=t(34),F=t(29),L=t(35),U=t(16),q=t(20),R=t(25),z=t(15),Z=t(33),B=t(22),P=t(36),H=t(37),X=/^[1-9][0-9]*$/,C=/^-?[1-9][0-9]*$/,D=/^0[x][0-9a-fA-F]+$/,J=/^-?0[x][0-9a-fA-F]+$/,W=/^0[0-7]+$/,G=/^-?0[0-7]+$/,
K=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Q=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Y=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,tt=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function it(t,i,n){i instanceof F||(n=i,i=new F);var r,e,s,o,h,u,f,a=(n=n||it.defaults).preferTrailingComment||!1,c=I(t,n.alternateCommentMode||!1),l=c.next,d=c.push,p=c.peek,v=c.skip,b=c.cmnt,y=!0,w=!1,m=i,g=n.keepCase?function(t){return t}:H.camelCase;function j(t,i,n){var r=it.filename;return n||(it.filename=null),
Error("illegal "+(i||"token")+" '"+t+"' ("+(r?r+", ":"")+"line "+c.line+")")}function k(){var t,i=[];do if('"'!==(t=l())&&"'"!==t)throw j(t);while(i.push(l()),v(t),'"'===(t=p())||"'"===t);return i.join("")}function O(i){var n=l();switch(n){case "'":case '"':return d(n),k();case "true":case "TRUE":return!0;case "false":case "FALSE":return!1}try{var t=n,r=!0,e=1;switch("-"==(t[0]||"")&&(e=-1,t=t.substring(1)),t){case "inf":case "INF":case "Inf":return e*(1/0);case "nan":case "NAN":case "Nan":case "NaN":return NaN;
case "0":return 0}if(X.test(t))return e*parseInt(t,10);if(D.test(t))return e*parseInt(t,16);if(W.test(t))return e*parseInt(t,8);if(K.test(t))return e*parseFloat(t);throw j(t,"number",r);}catch(t){if(i&&Y.test(n))return n;throw j(n,"value");}}function E(t,i){for(var n;!i||'"'!==(n=p())&&"'"!==n?t.push([n=A(l()),v("to",!0)?A(l()):n]):t.push(k()),v(",",!0););v(";")}function A(t,i){switch(t){case "max":case "MAX":case "Max":return 536870911;case "0":return 0}if(i||"-"!=(t[0]||"")){if(C.test(t))return parseInt(t,
10);if(J.test(t))return parseInt(t,16);if(G.test(t))return parseInt(t,8)}throw j(t,"id");}function x(t,i){switch(i){case "option":return $(t,i),v(";"),1;case "message":return T(t),1;case "enum":return V(t),1;case "service":var h,n=t,r=i;if(Q.test(r=l()))return S(h=new Z(r),function(t){if(!x(h,t)){if("rpc"!==t)throw j(t);var i=h,n=b(),r=t;if(!Q.test(t=l()))throw j(t,"name");var e,s,o,u=t;if(v("("),v("stream",!0)&&(s=!0),!Y.test(t=l()))throw j(t);if(e=t,v(")"),v("returns"),v("("),v("stream",!0)&&(o=
!0),!Y.test(t=l()))throw j(t);t=t,v(")");var f=new B(u,r,e,t,s,o);f.comment=n,S(f,function(t){if("option"!==t)throw j(t);$(f,t),v(";")}),i.add(f)}}),n.add(h),1;throw j(r,"service name");case "extend":var e,s=t,n=i;if(Y.test(n=l()))return e=n,S(null,function(t){switch(t){case "required":case "repeated":N(s,t,e);break;case "optional":N(s,w?"proto3_optional":"optional",e);break;default:if(!w||!Y.test(t))throw j(t);d(t),N(s,"optional",e)}}),1;throw j(n,"reference");}}function S(t,i,n){var r,e=c.line;
if(t&&("string"!=typeof t.comment&&(t.comment=b()),t.filename=it.filename),v("{",!0)){for(;"}"!==(r=l());)i(r);v(";",!0)}else n&&n(),v(";"),t&&("string"!=typeof t.comment||a)&&(t.comment=b(e)||t.comment)}function T(t,i){if(!Q.test(i=l()))throw j(i,"type name");var u=new L(i);S(u,function(t){if(!x(u,t))switch(t){case "map":var i=u,n=(v("<"),l());if(P.mapKey[n]===nt)throw j(n,"type");v(",");var r=l();if(!Y.test(r))throw j(r,"type");v(">");var e=l();if(!Q.test(e))throw j(e,"name");v("=");var s=new q(g(e),
A(l()),n,r);S(s,function(t){if("option"!==t)throw j(t);$(s,t),v(";")},function(){M(s)}),i.add(s);break;case "required":case "repeated":N(u,t);break;case "optional":N(u,w?"proto3_optional":"optional");break;case "oneof":e=u,n=t;if(!Q.test(n=l()))throw j(n,"name");var o=new R(g(n));S(o,function(t){"option"===t?($(o,t),v(";")):(d(t),N(o,"optional"))}),e.add(o);break;case "extensions":E(u.extensions||(u.extensions=[]));break;case "reserved":E(u.reserved||(u.reserved=[]),!0);break;default:if(!w||!Y.test(t))throw j(t);
d(t),N(u,"optional")}}),t.add(u)}function N(t,i,n){var r=l();if("group"===r){var e,s,o=t,u=i,f=l();if(Q.test(f))return s=H.lcFirst(f),f===s&&(f=H.ucFirst(f)),v("="),h=A(l()),(e=new L(f)).group=!0,(s=new U(s,h,f,u)).filename=it.filename,S(e,function(t){switch(t){case "option":$(e,t),v(";");break;case "required":case "repeated":N(e,t);break;case "optional":N(e,w?"proto3_optional":"optional");break;case "message":T(e);break;case "enum":V(e);break;default:throw j(t);}}),void o.add(e).add(s);throw j(f,
"name");}for(;r.endsWith(".")||p().startsWith(".");)r+=l();if(!Y.test(r))throw j(r,"type");var h=l();if(!Q.test(h))throw j(h,"name");h=g(h),v("=");var a=new U(h,A(l()),r,i,n);S(a,function(t){if("option"!==t)throw j(t);$(a,t),v(";")},function(){M(a)}),"proto3_optional"===i?(u=new R("_"+h),a.setOption("proto3_optional",!0),u.add(a),t.add(u)):t.add(a),w||!a.repeated||P.packed[r]===nt&&P.basic[r]!==nt||a.setOption("packed",!1,!0)}function V(t,i){if(!Q.test(i=l()))throw j(i,"name");var s=new z(i);S(s,
function(t){switch(t){case "option":$(s,t),v(";");break;case "reserved":E(s.reserved||(s.reserved=[]),!0);break;default:var i=s,n=t;if(!Q.test(n))throw j(n,"name");v("=");var r=A(l(),!0),e={options:nt,setOption:function(t,i){this.options===nt&&(this.options={}),this.options[t]=i}};return S(e,function(t){if("option"!==t)throw j(t);$(e,t),v(";")},function(){M(e)}),void i.add(n,r,e.comment,e.options)}}),t.add(s)}function $(t,i){var n=v("(",!0);if(!Y.test(i=l()))throw j(i,"name");var r,e=i,s=e,n=(n&&
(v(")"),s=e="("+e+")",i=p(),tt.test(i)&&(r=i.slice(1),e+=i,l())),v("="),function t(i,n){if(v("{",!0)){for(var r={};!v("}",!0);){if(!Q.test(h=l()))throw j(h,"name");if(null===h)throw j(h,"end of input");var e,s,o=h;if(v(":",!0),"{"===p())e=t(i,n+"."+h);else if("["===p()){if(e=[],v("[",!0)){for(;s=O(!0),e.push(s),v(",",!0););v("]"),void 0!==s&&_(i,n+"."+h,s)}}else e=O(!0),_(i,n+"."+h,e);var u=r[o];u&&(e=[].concat(u).concat(e)),r[o]=e,v(",",!0),v(";",!0)}return r}var f=O(!0);_(i,n,f);return f}(t,e));
i=s,e=n,s=r,(n=t).setParsedOption&&n.setParsedOption(i,e,s)}function _(t,i,n){t.setOption&&t.setOption(i,n)}function M(t){if(v("[",!0)){for(;$(t,"option"),v(",",!0););v("]")}}for(;null!==(h=l());)switch(h){case "package":if(!y)throw j(h);if(r!==nt)throw j("package");if(r=l(),!Y.test(r))throw j(r,"name");m=m.define(r),v(";");break;case "import":if(!y)throw j(h);switch(f=u=void 0,p()){case "weak":f=s=s||[],l();break;case "public":l();default:f=e=e||[]}u=k(),v(";"),f.push(u);break;case "syntax":if(!y)throw j(h);
if(v("="),o=k(),!(w="proto3"===o)&&"proto2"!==o)throw j(o,"syntax");v(";");break;case "option":$(m,h),v(";");break;default:if(x(m,h)){y=!1;continue}throw j(h);}return it.filename=null,{package:r,imports:e,weakImports:s,syntax:o,root:i}}},{15:15,16:16,20:20,22:22,25:25,29:29,33:33,34:34,35:35,36:36,37:37}],27:[function(t,i,n){i.exports=f;var r,e=t(39),s=e.LongBits,o=e.utf8;function u(t,i){return RangeError("index out of range: "+t.pos+" + "+(i||1)+" > "+t.len)}function f(t){this.buf=t,this.pos=0,this.len=
t.length}function h(){return e.Buffer?function(t){return(f.create=function(t){return e.Buffer.isBuffer(t)?new r(t):c(t)})(t)}:c}var a,c="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new f(t);throw Error("illegal buffer");}:function(t){if(Array.isArray(t))return new f(t);throw Error("illegal buffer");};function l(){var t=new s(0,0),i=0;if(!(4<this.len-this.pos)){for(;i<3;++i){if(this.pos>=this.len)throw u(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<
7*i)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*i)>>>0,t}for(;i<4;++i)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*i)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(i=0,4<this.len-this.pos)for(;i<5;++i){if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return t}else for(;i<5;++i){if(this.pos>=this.len)throw u(this);
if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding");}function d(t,i){return(t[i-4]|t[i-3]<<8|t[i-2]<<16|t[i-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw u(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}f.create=h(),f.prototype.c=e.Array.prototype.subarray||e.Array.prototype.slice,f.prototype.uint32=(a=4294967295,function(){if(a=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(a=(a|(127&this.buf[this.pos])<<
7)>>>0,this.buf[this.pos++]<128||(a=(a|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128||(a=(a|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128||(a=(a|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128||!((this.pos+=5)>this.len))))))return a;throw this.pos=this.len,u(this,10);}),f.prototype.int32=function(){return 0|this.uint32()},f.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},f.prototype.bool=function(){return 0!==this.uint32()},f.prototype.fixed32=
function(){if(this.pos+4>this.len)throw u(this,4);return d(this.buf,this.pos+=4)},f.prototype.sfixed32=function(){if(this.pos+4>this.len)throw u(this,4);return 0|d(this.buf,this.pos+=4)},f.prototype.float=function(){if(this.pos+4>this.len)throw u(this,4);var t=e.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},f.prototype.double=function(){if(this.pos+8>this.len)throw u(this,4);var t=e.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},f.prototype.bytes=function(){var t=this.uint32(),
i=this.pos,n=this.pos+t;if(n>this.len)throw u(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(i,n):i===n?(t=e.Buffer)?t.alloc(0):new this.buf.constructor(0):this.c.call(this.buf,i,n)},f.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},f.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw u(this,t);this.pos+=t}else{do if(this.pos>=this.len)throw u(this);while(128&this.buf[this.pos++])}return this},f.prototype.skipType=function(t){switch(t){case 0:this.skip();
break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos);}return this},f.u=function(t){r=t,f.create=h(),r.u();var i=e.Long?"toLong":"toNumber";e.merge(f.prototype,{int64:function(){return l.call(this)[i](!1)},uint64:function(){return l.call(this)[i](!0)},sint64:function(){return l.call(this).zzDecode()[i](!1)},fixed64:function(){return p.call(this)[i](!0)},
sfixed64:function(){return p.call(this)[i](!1)}})}},{39:39}],28:[function(t,i,n){i.exports=s;var r=t(27),e=((s.prototype=Object.create(r.prototype)).constructor=s,t(39));function s(t){r.call(this,t)}s.u=function(){e.Buffer&&(s.prototype.c=e.Buffer.prototype.slice)},s.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},s.u()},{27:27,39:39}],
29:[function(t,i,n){i.exports=f;var r,d,p,e=t(23),s=(((f.prototype=Object.create(e.prototype)).constructor=f).className="Root",t(16)),o=t(15),u=t(25),v=t(37);function f(t){e.call(this,"",t),this.deferred=[],this.files=[]}function b(){}f.fromJSON=function(t,i){return i=i||new f,t.options&&i.setOptions(t.options),i.addJSON(t.nested)},f.prototype.resolvePath=v.path.resolve,f.prototype.fetch=v.fetch,f.prototype.load=function t(i,s,e){"function"==typeof s&&(e=s,s=nt);var o=this;if(!e)return v.asPromise(t,
o,i,s);var u=e===b;function f(t,i){if(e){var n=e;if(e=null,u)throw t;n(t,i)}}function h(t){var i=t.lastIndexOf("google/protobuf/");if(-1<i){t=t.substring(i);if(t in p)return t}return null}function a(t,i){try{if(v.isString(i)&&"{"==(i[0]||"")&&(i=JSON.parse(i)),v.isString(i)){d.filename=t;var n,r=d(i,o,s),e=0;if(r.imports)for(;e<r.imports.length;++e)(n=h(r.imports[e])||o.resolvePath(t,r.imports[e]))&&c(n);if(r.weakImports)for(e=0;e<r.weakImports.length;++e)(n=h(r.weakImports[e])||o.resolvePath(t,r.weakImports[e]))&&
c(n,!0)}else o.setOptions(i.options).addJSON(i.nested)}catch(t){f(t)}u||l||f(null,o)}function c(n,r){if(n=h(n)||n,!~o.files.indexOf(n))if(o.files.push(n),n in p)u?a(n,p[n]):(++l,setTimeout(function(){--l,a(n,p[n])}));else if(u){var t;try{t=v.fs.readFileSync(n).toString("utf8")}catch(t){return void(r||f(t))}a(n,t)}else++l,o.fetch(n,function(t,i){--l,e&&(t?r?l||f(null,o):f(t):a(n,i))})}var l=0;v.isString(i)&&(i=[i]);for(var n,r=0;r<i.length;++r)(n=o.resolvePath("",i[r]))&&c(n);return u?o:(l||f(null,
o),nt)},f.prototype.loadSync=function(t,i){if(v.isNode)return this.load(t,i,b);throw Error("not supported");},f.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(t){return"'extend "+t.extend+"' in "+t.parent.fullName}).join(", "));return e.prototype.resolveAll.call(this)};var h=/^[A-Z]/;function a(t,i){var n,r=i.parent.lookup(i.extend);if(r)return n=new s(i.fullName,i.id,i.type,i.rule,nt,i.options),r.get(n.name)||((n.declaringField=
i).extensionField=n,r.add(n)),1}f.prototype.h=function(t){if(t instanceof s)t.extend===nt||t.extensionField||a(0,t)||this.deferred.push(t);else if(t instanceof o)h.test(t.name)&&(t.parent[t.name]=t.values);else if(!(t instanceof u)){if(t instanceof r)for(var i=0;i<this.deferred.length;)a(0,this.deferred[i])?this.deferred.splice(i,1):++i;for(var n=0;n<t.nestedArray.length;++n)this.h(t.f[n]);h.test(t.name)&&(t.parent[t.name]=t)}},f.prototype.a=function(t){var i;if(t instanceof s)t.extend!==nt&&(t.extensionField?
(t.extensionField.parent.remove(t.extensionField),t.extensionField=null):-1<(i=this.deferred.indexOf(t))&&this.deferred.splice(i,1));else if(t instanceof o)h.test(t.name)&&delete t.parent[t.name];else if(t instanceof e){for(var n=0;n<t.nestedArray.length;++n)this.a(t.f[n]);h.test(t.name)&&delete t.parent[t.name]}},f.u=function(t,i,n){r=t,d=i,p=n}},{15:15,16:16,23:23,25:25,37:37}],30:[function(t,i,n){i.exports={}},{}],31:[function(t,i,n){n.Service=t(32)},{32:32}],32:[function(t,i,n){i.exports=r;var u=
t(39);function r(t,i,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");u.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!i,this.responseDelimited=!!n}((r.prototype=Object.create(u.EventEmitter.prototype)).constructor=r).prototype.rpcCall=function t(n,i,r,e,s){if(!e)throw TypeError("request must be specified");var o=this;if(!s)return u.asPromise(t,o,n,i,r,e);if(!o.rpcImpl)return setTimeout(function(){s(Error("already ended"))},0),nt;try{return o.rpcImpl(n,i[o.requestDelimited?
"encodeDelimited":"encode"](e).finish(),function(t,i){if(t)return o.emit("error",t,n),s(t);if(null===i)return o.end(!0),nt;if(!(i instanceof r))try{i=r[o.responseDelimited?"decodeDelimited":"decode"](i)}catch(t){return o.emit("error",t,n),s(t)}return o.emit("data",i,n),s(null,i)})}catch(t){return o.emit("error",t,n),setTimeout(function(){s(t)},0),nt}},r.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{39:39}],33:[function(t,
i,n){i.exports=o;var r=t(23),s=(((o.prototype=Object.create(r.prototype)).constructor=o).className="Service",t(22)),u=t(37),f=t(31);function o(t,i){r.call(this,t,i),this.methods={},this.l=null}function e(t){return t.l=null,t}o.fromJSON=function(t,i){var n=new o(t,i.options);if(i.methods)for(var r=Object.keys(i.methods),e=0;e<r.length;++e)n.add(s.fromJSON(r[e],i.methods[r[e]]));return i.nested&&n.addJSON(i.nested),n.comment=i.comment,n},o.prototype.toJSON=function(t){var i=r.prototype.toJSON.call(this,
t),n=!!t&&!!t.keepComments;return u.toObject(["options",i&&i.options||nt,"methods",r.arrayToJSON(this.methodsArray,t)||{},"nested",i&&i.nested||nt,"comment",n?this.comment:nt])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this.l||(this.l=u.toArray(this.methods))}}),o.prototype.get=function(t){return this.methods[t]||r.prototype.get.call(this,t)},o.prototype.resolveAll=function(){for(var t=this.methodsArray,i=0;i<t.length;++i)t[i].resolve();return r.prototype.resolve.call(this)},
o.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);return t instanceof s?e((this.methods[t.name]=t).parent=this):r.prototype.add.call(this,t)},o.prototype.remove=function(t){if(t instanceof s){if(this.methods[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.methods[t.name],t.parent=null,e(this)}return r.prototype.remove.call(this,t)},o.prototype.create=function(t,i,n){for(var r,e=new f.Service(t,i,n),s=0;s<this.methodsArray.length;++s){var o=
u.lcFirst((r=this.l[s]).resolve().name).replace(/[^$\w_]/g,"");e[o]=u.codegen(["r","c"],u.isReserved(o)?o+"_":o)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return e}},{22:22,23:23,31:31,37:37}],34:[function(t,i,n){i.exports=s;var O=/[\s{}=;:[\],'"()<>]/g,E=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,A=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,x=/^ *[*/]+ */,S=/^\s*\*?\/*/,T=/\n/g,N=/\s/,r=/\\(.?)/g,e={0:"\x00",r:"\r",n:"\n",t:"\t"};function V(t){return t.replace(r,
function(t,i){switch(i){case "\\":case "":return i;default:return e[i]||""}})}function s(h,a){h=h.toString();var c=0,l=h.length,d=1,f=0,p={},v=[],b=null;function y(t){return Error("illegal "+t+" (line "+d+")")}function w(t){return h[0|t]||""}function m(t,i,n){var r,e={type:h[0|t++]||"",lineEmpty:!1,leading:n},n=a?2:3,s=t-n;do if(--s<0||"\n"==(r=h[0|s]||"")){e.lineEmpty=!0;break}while(" "===r||"\t"===r);for(var o=h.substring(t,i).split(T),u=0;u<o.length;++u)o[u]=o[u].replace(a?S:x,"").trim();e.text=
o.join("\n").trim(),p[d]=e,f=d}function g(t){var i=j(t),t=h.substring(t,i);return/^\s*\/\//.test(t)}function j(t){for(var i=t;i<l&&"\n"!==w(i);)i++;return i}function r(){if(0<v.length)return v.shift();if(b){var t="'"===b?A:E,i=(t.lastIndex=c-1,t.exec(h));if(i)return c=t.lastIndex,k(b),b=null,V(i[1]);throw y("string");}var n,r,e,s,o,u=0===c;do{if(c===l)return null;for(n=!1;N.test(e=w(c));)if("\n"===e&&(u=!0,++d),++c===l)return null;if("/"===w(c)){if(++c===l)throw y("comment");if("/"===w(c))if(a){if(o=
!1,g((s=c)-1))for(o=!0;(c=j(c))!==l&&(c++,u&&g(c)););else c=Math.min(l,j(c)+1);o&&(m(s,c,u),u=!0),d++}else{for(o="/"===w(s=c+1);"\n"!==w(++c);)if(c===l)return null;++c,o&&(m(s,c-1,u),u=!0),++d}else{if("*"!==(e=w(c)))return"/";s=c+1,o=a||"*"===w(s);do if("\n"===e&&++d,++c===l)throw y("comment");while(r=e,e=w(c),"*"!==r||"/"!==e);++c,o&&(m(s,c-2,u),u=!0)}n=!0}}while(n);var f=c;if(O.lastIndex=0,!O.test(w(f++)))for(;f<l&&!O.test(w(f));)++f;t=h.substring(c,c=f);return'"'!=t&&"'"!=t||(b=t),t}function k(t){v.push(t)}
function e(){if(!v.length){var t=r();if(null===t)return null;k(t)}return v[0]}return Object.defineProperty({next:r,peek:e,push:k,skip:function(t,i){var n=e();if(n===t)return r(),!0;if(i)return!1;throw y("token '"+n+"', '"+t+"' expected");},cmnt:function(t){var i,n=null;return t===nt?(i=p[d-1],delete p[d-1],i&&(a||"*"===i.type||i.lineEmpty)&&(n=i.leading?i.text:null)):(f<t&&e(),i=p[t],delete p[t],!i||i.lineEmpty||!a&&"/"!==i.type||(n=i.leading?null:i.text)),n}},"line",{get:function(){return d}})}s.unescape=
V},{}],35:[function(t,i,n){i.exports=m;var o=t(23),u=(((m.prototype=Object.create(o.prototype)).constructor=m).className="Type",t(15)),f=t(25),h=t(16),a=t(20),c=t(33),e=t(21),s=t(27),l=t(42),d=t(37),p=t(14),v=t(13),b=t(40),y=t(12),w=t(41);function m(t,i){o.call(this,t,i),this.fields={},this.oneofs=nt,this.extensions=nt,this.reserved=nt,this.group=nt,this.p=null,this.e=null,this.v=null,this.b=null}function r(t){return t.p=t.e=t.v=null,delete t.encode,delete t.decode,delete t.verify,t}Object.defineProperties(m.prototype,
{fieldsById:{get:function(){if(!this.p){this.p={};for(var t=Object.keys(this.fields),i=0;i<t.length;++i){var n=this.fields[t[i]],r=n.id;if(this.p[r])throw Error("duplicate id "+r+" in "+this);this.p[r]=n}}return this.p}},fieldsArray:{get:function(){return this.e||(this.e=d.toArray(this.fields))}},oneofsArray:{get:function(){return this.v||(this.v=d.toArray(this.oneofs))}},ctor:{get:function(){return this.b||(this.ctor=m.generateConstructor(this)())},set:function(t){for(var i=t.prototype,n=(i instanceof
e||((t.prototype=new e).constructor=t,d.merge(t.prototype,i)),t.$type=t.prototype.$type=this,d.merge(t,e,!0),this.b=t,0);n<this.fieldsArray.length;++n)this.e[n].resolve();for(var r={},n=0;n<this.oneofsArray.length;++n)r[this.v[n].resolve().name]={get:d.oneOfGetter(this.v[n].oneof),set:d.oneOfSetter(this.v[n].oneof)};n&&Object.defineProperties(t.prototype,r)}}}),m.generateConstructor=function(t){for(var i,n=d.codegen(["p"],t.name),r=0;r<t.fieldsArray.length;++r)(i=t.e[r]).map?n("this%s={}",d.safeProp(i.name)):
i.repeated&&n("this%s=[]",d.safeProp(i.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},m.fromJSON=function(t,i){for(var n=new m(t,i.options),r=(n.extensions=i.extensions,n.reserved=i.reserved,Object.keys(i.fields)),e=0;e<r.length;++e)n.add((void 0!==i.fields[r[e]].keyType?a:h).fromJSON(r[e],i.fields[r[e]]));if(i.oneofs)for(r=Object.keys(i.oneofs),e=0;e<r.length;++e)n.add(f.fromJSON(r[e],i.oneofs[r[e]]));if(i.nested)for(r=Object.keys(i.nested),
e=0;e<r.length;++e){var s=i.nested[r[e]];n.add((s.id!==nt?h:s.fields!==nt?m:s.values!==nt?u:s.methods!==nt?c:o).fromJSON(r[e],s))}return i.extensions&&i.extensions.length&&(n.extensions=i.extensions),i.reserved&&i.reserved.length&&(n.reserved=i.reserved),i.group&&(n.group=!0),i.comment&&(n.comment=i.comment),n},m.prototype.toJSON=function(t){var i=o.prototype.toJSON.call(this,t),n=!!t&&!!t.keepComments;return d.toObject(["options",i&&i.options||nt,"oneofs",o.arrayToJSON(this.oneofsArray,t),"fields",
o.arrayToJSON(this.fieldsArray.filter(function(t){return!t.declaringField}),t)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:nt,"reserved",this.reserved&&this.reserved.length?this.reserved:nt,"group",this.group||nt,"nested",i&&i.nested||nt,"comment",n?this.comment:nt])},m.prototype.resolveAll=function(){for(var t=this.fieldsArray,i=0;i<t.length;)t[i++].resolve();for(var n=this.oneofsArray,i=0;i<n.length;)n[i++].resolve();return o.prototype.resolveAll.call(this)},m.prototype.get=
function(t){return this.fields[t]||this.oneofs&&this.oneofs[t]||this.nested&&this.nested[t]||null},m.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof h&&t.extend===nt){if((this.p||this.fieldsById)[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),
(this.fields[t.name]=t).message=this,t.onAdd(this),r(this)}return t instanceof f?(this.oneofs||(this.oneofs={}),(this.oneofs[t.name]=t).onAdd(this),r(this)):o.prototype.add.call(this,t)},m.prototype.remove=function(t){if(t instanceof h&&t.extend===nt){if(this.fields&&this.fields[t.name]===t)return delete this.fields[t.name],t.parent=null,t.onRemove(this),r(this);throw Error(t+" is not a member of "+this);}if(t instanceof f){if(this.oneofs&&this.oneofs[t.name]===t)return delete this.oneofs[t.name],
t.parent=null,t.onRemove(this),r(this);throw Error(t+" is not a member of "+this);}return o.prototype.remove.call(this,t)},m.prototype.isReservedId=function(t){return o.isReservedId(this.reserved,t)},m.prototype.isReservedName=function(t){return o.isReservedName(this.reserved,t)},m.prototype.create=function(t){return new this.ctor(t)},m.prototype.setup=function(){for(var t=this.fullName,i=[],n=0;n<this.fieldsArray.length;++n)i.push(this.e[n].resolve().resolvedType);this.encode=p(this)({Writer:l,types:i,
util:d}),this.decode=v(this)({Reader:s,types:i,util:d}),this.verify=b(this)({types:i,util:d}),this.fromObject=y.fromObject(this)({types:i,util:d}),this.toObject=y.toObject(this)({types:i,util:d});var r,t=w[t];return t&&((r=Object.create(this)).fromObject=this.fromObject,this.fromObject=t.fromObject.bind(r),r.toObject=this.toObject,this.toObject=t.toObject.bind(r)),this},m.prototype.encode=function(t,i){return this.setup().encode(t,i)},m.prototype.encodeDelimited=function(t,i){return this.encode(t,
i&&i.len?i.fork():i).ldelim()},m.prototype.decode=function(t,i){return this.setup().decode(t,i)},m.prototype.decodeDelimited=function(t){return t instanceof s||(t=s.create(t)),this.decode(t,t.uint32())},m.prototype.verify=function(t){return this.setup().verify(t)},m.prototype.fromObject=function(t){return this.setup().fromObject(t)},m.prototype.toObject=function(t,i){return this.setup().toObject(t,i)},m.d=function(i){return function(t){d.decorateType(t,i)}}},{12:12,13:13,14:14,15:15,16:16,20:20,21:21,
23:23,25:25,27:27,33:33,37:37,40:40,41:41,42:42}],36:[function(t,i,n){var t=t(37),e=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function r(t,i){var n=0,r={};for(i|=0;n<t.length;)r[e[n+i]]=t[n++];return r}n.basic=r([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=r([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",t.emptyArray,null]),n.long=r([0,0,0,1,1],7),n.mapKey=r([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=r([1,5,0,0,0,5,5,0,0,0,1,
1,0])},{37:37}],37:[function(n,t,i){var r,e,s=t.exports=n(39),o=n(30),u=(s.codegen=n(3),s.fetch=n(5),s.path=n(8),s.fs=s.inquire("fs"),s.toArray=function(t){if(t){for(var i=Object.keys(t),n=Array(i.length),r=0;r<i.length;)n[r]=t[i[r++]];return n}return[]},s.toObject=function(t){for(var i={},n=0;n<t.length;){var r=t[n++],e=t[n++];e!==nt&&(i[r]=e)}return i},/\\/g),f=/"/g,h=(s.isReserved=function(t){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(t)},
s.safeProp=function(t){return!/^[$\w_]+$/.test(t)||s.isReserved(t)?'["'+t.replace(u,"\\\\").replace(f,'\\"')+'"]':"."+t},s.ucFirst=function(t){return(t[0]||"").toUpperCase()+t.substring(1)},/_([a-z])/g),a=(s.camelCase=function(t){return t.substring(0,1)+t.substring(1).replace(h,function(t,i){return i.toUpperCase()})},s.compareFieldsById=function(t,i){return t.id-i.id},s.decorateType=function(t,i){return t.$type?(i&&t.$type.name!==i&&(s.decorateRoot.remove(t.$type),t.$type.name=i,s.decorateRoot.add(t.$type)),
t.$type):(i=new (r=r||n(35))(i||t.name),s.decorateRoot.add(i),i.ctor=t,Object.defineProperty(t,"$type",{value:i,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:i,enumerable:!1}),i)},0);s.decorateEnum=function(t){var i;return t.$type||(i=new (e=e||n(15))("Enum"+a++,t),s.decorateRoot.add(i),Object.defineProperty(t,"$type",{value:i,enumerable:!1}),i)},s.setProperty=function(t,i,n){if("object"!=typeof t)throw TypeError("dst must be an object");if(i)return function t(i,n,r){var e=n.shift();
return"__proto__"!==e&&"prototype"!==e&&(0<n.length?i[e]=t(i[e]||{},n,r):((n=i[e])&&(r=[].concat(n).concat(r)),i[e]=r)),i}(t,i=i.split("."),n);throw TypeError("path must be specified");},Object.defineProperty(s,"decorateRoot",{get:function(){return o.decorated||(o.decorated=new (n(29)))}})},{15:15,29:29,3:3,30:30,35:35,39:39,5:5,8:8}],38:[function(t,i,n){i.exports=e;var r=t(39);function e(t,i){this.lo=t>>>0,this.hi=i>>>0}var s=e.zero=new e(0,0),o=(s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=
function(){return this},s.length=function(){return 1},e.zeroHash="\x00\x00\x00\x00\x00\x00\x00\x00",e.fromNumber=function(t){var i,n;return 0===t?s:(n=(t=(i=t<0)?-t:t)>>>0,t=(t-n)/4294967296>>>0,i&&(t=~t>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++t&&(t=0))),new e(n,t))},e.from=function(t){if("number"==typeof t)return e.fromNumber(t);if(r.isString(t)){if(!r.Long)return e.fromNumber(parseInt(t,10));t=r.Long.fromString(t)}return t.low||t.high?new e(t.low>>>0,t.high>>>0):s},e.prototype.toNumber=function(t){var i;
return!t&&this.hi>>>31?(t=1+~this.lo>>>0,i=~this.hi>>>0,-(t+4294967296*(i=t?i:i+1>>>0))):this.lo+4294967296*this.hi},e.prototype.toLong=function(t){return r.Long?new r.Long(0|this.lo,0|this.hi,!!t):{low:0|this.lo,high:0|this.hi,unsigned:!!t}},String.prototype.charCodeAt);e.fromHash=function(t){return"\x00\x00\x00\x00\x00\x00\x00\x00"===t?s:new e((o.call(t,0)|o.call(t,1)<<8|o.call(t,2)<<16|o.call(t,3)<<24)>>>0,(o.call(t,4)|o.call(t,5)<<8|o.call(t,6)<<16|o.call(t,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(255&
this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},e.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},e.prototype.length=function(){var t=this.lo,i=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0==n?0==i?t<16384?t<128?
1:2:t<2097152?3:4:i<16384?i<128?5:6:i<2097152?7:8:n<128?9:10}},{39:39}],39:[function(t,i,n){var r=n;function e(t,i,n){for(var r=Object.keys(i),e=0;e<r.length;++e)t[r[e]]!==nt&&n||(t[r[e]]=i[r[e]]);return t}function s(t){function n(t,i){if(!(this instanceof n))return new n(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:Error().stack||""}),i&&e(this,i)}return n.prototype=Object.create(Error.prototype,
{constructor:{value:n,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return t},set:nt,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),n}r.asPromise=t(1),r.base64=t(2),r.EventEmitter=t(4),r.float=t(6),r.inquire=t(7),r.utf8=t(10),r.pool=t(9),r.LongBits=t(38),r.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),r.global=r.isNode&&
global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},r.isString=function(t){return"string"==typeof t||t instanceof String},r.isObject=function(t){return t&&"object"==typeof t},r.isset=r.isSet=function(t,i){var n=t[i];return null!=n&&t.hasOwnProperty(i)&&("object"!=typeof n||0<
(Array.isArray(n)?n:Object.keys(n)).length)},r.Buffer=function(){try{var t=r.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),r.y=null,r.w=null,r.newBuffer=function(t){return"number"==typeof t?r.Buffer?r.w(t):new r.Array(t):r.Buffer?r.y(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=
/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(t){return t?r.LongBits.from(t).toHash():r.LongBits.zeroHash},r.longFromHash=function(t,i){t=r.LongBits.fromHash(t);return r.Long?r.Long.fromBits(t.lo,t.hi,i):t.toNumber(!!i)},r.merge=e,r.lcFirst=function(t){return(t[0]||"").toLowerCase()+t.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(t){for(var n={},i=0;i<t.length;++i)n[t[i]]=1;return function(){for(var t=Object.keys(this),
i=t.length-1;-1<i;--i)if(1===n[t[i]]&&this[t[i]]!==nt&&null!==this[t[i]])return t[i]}},r.oneOfSetter=function(n){return function(t){for(var i=0;i<n.length;++i)n[i]!==t&&delete this[n[i]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r.u=function(){var n=r.Buffer;n?(r.y=n.from!==Uint8Array.from&&n.from||function(t,i){return new n(t,i)},r.w=n.allocUnsafe||function(t){return new n(t)}):r.y=r.w=null}},{1:1,10:10,2:2,38:38,4:4,6:6,7:7,9:9}],40:[function(t,i,n){i.exports=function(t){var i=
f.codegen(["m"],t.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n=t.oneofsArray,r={};n.length&&i("var p={}");for(var e=0;e<t.fieldsArray.length;++e){var s,o=t.e[e].resolve(),u="m"+f.safeProp(o.name);o.optional&&i("if(%s!=null&&m.hasOwnProperty(%j)){",u,o.name),o.map?(i("if(!util.isObject(%s))",u)("return%j",h(o,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),function(t,i,n){switch(i.keyType){case "int32":case "uint32":case "sint32":case "fixed32":case "sfixed32":t("if(!util.key32Re.test(%s))",
n)("return%j",h(i,"integer key"));break;case "int64":case "uint64":case "sint64":case "fixed64":case "sfixed64":t("if(!util.key64Re.test(%s))",n)("return%j",h(i,"integer|Long key"));break;case "bool":t("if(!util.key2Re.test(%s))",n)("return%j",h(i,"boolean key"))}}(i,o,"k[i]"),a(i,o,e,u+"[k[i]]")("}")):o.repeated?(i("if(!Array.isArray(%s))",u)("return%j",h(o,"array"))("for(var i=0;i<%s.length;++i){",u),a(i,o,e,u+"[i]")("}")):(o.partOf&&(s=f.safeProp(o.partOf.name),1===r[o.partOf.name]&&i("if(p%s===1)",
s)("return%j",o.partOf.name+": multiple values"),r[o.partOf.name]=1,i("p%s=1",s)),a(i,o,e,u)),o.optional&&i("}")}return i("return null")};var o=t(15),f=t(37);function h(t,i){return t.name+": "+i+(t.repeated&&"array"!==i?"[]":t.map&&"object"!==i?"{k:"+t.keyType+"}":"")+" expected"}function a(t,i,n,r){if(i.resolvedType)if(i.resolvedType instanceof o){t("switch(%s){",r)("default:")("return%j",h(i,"enum value"));for(var e=Object.keys(i.resolvedType.values),s=0;s<e.length;++s)t("case %i:",i.resolvedType.values[e[s]]);
t("break")("}")}else t("{")("var e=types[%i].verify(%s);",n,r)("if(e)")("return%j+e",i.name+".")("}");else switch(i.type){case "int32":case "uint32":case "sint32":case "fixed32":case "sfixed32":t("if(!util.isInteger(%s))",r)("return%j",h(i,"integer"));break;case "int64":case "uint64":case "sint64":case "fixed64":case "sfixed64":t("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",h(i,"integer|Long"));break;case "float":case "double":t('if(typeof %s!=="number")',
r)("return%j",h(i,"number"));break;case "bool":t('if(typeof %s!=="boolean")',r)("return%j",h(i,"boolean"));break;case "string":t("if(!util.isString(%s))",r)("return%j",h(i,"string"));break;case "bytes":t('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",h(i,"buffer"))}return t}},{15:15,37:37}],41:[function(t,i,n){var o=t(21);n[".google.protobuf.Any"]={fromObject:function(t){if(t&&t["@type"]){var i,n=t["@type"].substring(1+t["@type"].lastIndexOf("/")),n=this.lookup(n);if(n)return~(i=
"."==(t["@type"][0]||"")?t["@type"].slice(1):t["@type"]).indexOf("/")||(i="/"+i),this.create({type_url:i,value:n.encode(n.fromObject(t)).finish()})}return this.fromObject(t)},toObject:function(t,i){var n,r,e="",s="";return i&&i.json&&t.type_url&&t.value&&(s=t.type_url.substring(1+t.type_url.lastIndexOf("/")),e=t.type_url.substring(0,1+t.type_url.lastIndexOf("/")),(n=this.lookup(s))&&(t=n.decode(t.value))),!(t instanceof this.ctor)&&t instanceof o?(n=t.$type.toObject(t,i),r="."===t.$type.fullName[0]?
t.$type.fullName.slice(1):t.$type.fullName,n["@type"]=s=(e=""===e?"type.googleapis.com/":e)+r,n):this.toObject(t,i)}}},{21:21}],42:[function(t,i,n){i.exports=c;var r,e=t(39),s=e.LongBits,o=e.base64,u=e.utf8;function f(t,i,n){this.fn=t,this.len=i,this.next=nt,this.val=n}function h(){}function a(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function c(){this.len=0,this.head=new f(h,0,0),this.tail=this.head,this.states=null}function l(){return e.Buffer?function(){return(c.create=
function(){return new r})()}:function(){return new c}}function d(t,i,n){i[n]=255&t}function p(t,i){this.len=t,this.next=nt,this.val=i}function v(t,i,n){for(;t.hi;)i[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;127<t.lo;)i[n++]=127&t.lo|128,t.lo=t.lo>>>7;i[n++]=t.lo}function b(t,i,n){i[n]=255&t,i[n+1]=t>>>8&255,i[n+2]=t>>>16&255,i[n+3]=t>>>24}c.create=l(),c.alloc=function(t){return new e.Array(t)},e.Array!==Array&&(c.alloc=e.pool(c.alloc,e.Array.prototype.subarray)),c.prototype.g=
function(t,i,n){return this.tail=this.tail.next=new f(t,i,n),this.len+=i,this},(p.prototype=Object.create(f.prototype)).fn=function(t,i,n){for(;127<t;)i[n++]=127&t|128,t>>>=7;i[n]=t},c.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new p((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},c.prototype.int32=function(t){return t<0?this.g(v,10,s.fromNumber(t)):this.uint32(t)},c.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},c.prototype.int64=
c.prototype.uint64=function(t){t=s.from(t);return this.g(v,t.length(),t)},c.prototype.sint64=function(t){t=s.from(t).zzEncode();return this.g(v,t.length(),t)},c.prototype.bool=function(t){return this.g(d,1,t?1:0)},c.prototype.sfixed32=c.prototype.fixed32=function(t){return this.g(b,4,t>>>0)},c.prototype.sfixed64=c.prototype.fixed64=function(t){t=s.from(t);return this.g(b,4,t.lo).g(b,4,t.hi)},c.prototype.float=function(t){return this.g(e.float.writeFloatLE,4,t)},c.prototype.double=function(t){return this.g(e.float.writeDoubleLE,
8,t)};var y=e.Array.prototype.set?function(t,i,n){i.set(t,n)}:function(t,i,n){for(var r=0;r<t.length;++r)i[n+r]=t[r]};c.prototype.bytes=function(t){var i,n=t.length>>>0;return n?(e.isString(t)&&(i=c.alloc(n=o.length(t)),o.decode(t,i,0),t=i),this.uint32(n).g(y,n,t)):this.g(d,1,0)},c.prototype.string=function(t){var i=u.length(t);return i?this.uint32(i).g(u.write,i,t):this.g(d,1,0)},c.prototype.fork=function(){return this.states=new a(this),this.head=this.tail=new f(h,0,0),this.len=0,this},c.prototype.reset=
function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new f(h,0,0),this.len=0),this},c.prototype.ldelim=function(){var t=this.head,i=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=i,this.len+=n),this},c.prototype.finish=function(){for(var t=this.head.next,i=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,i,n),n+=t.len,t=t.next;return i},c.u=function(t){r=
t,c.create=l(),r.u()}},{39:39}],43:[function(t,i,n){i.exports=s;var r=t(42),e=((s.prototype=Object.create(r.prototype)).constructor=s,t(39));function s(){r.call(this)}function o(t,i,n){t.length<40?e.utf8.write(t,i,n):i.utf8Write?i.utf8Write(t,n):i.write(t,n)}s.u=function(){s.alloc=e.w,s.writeBytesBuffer=e.Buffer&&e.Buffer.prototype instanceof Uint8Array&&"set"===e.Buffer.prototype.set.name?function(t,i,n){i.set(t,n)}:function(t,i,n){if(t.copy)t.copy(i,n,0,t.length);else for(var r=0;r<t.length;)i[n++]=
t[r++]}},s.prototype.bytes=function(t){var i=(t=e.isString(t)?e.y(t,"base64"):t).length>>>0;return this.uint32(i),i&&this.g(s.writeBytesBuffer,i,t),this},s.prototype.string=function(t){var i=e.Buffer.byteLength(t);return this.uint32(i),i&&this.g(o,i,t),this},s.u()},{39:39,42:42}]},{},[19])}();
(function(){var protocols=helper.object.createEnum("WEBSOCKET","AJAX");var states=helper.object.createEnum("INITIALIZING","READY","SERVERCONNECTED","CONNECTING","RECONNECTING","CONNECTED","UNSTABLE","LOST","CLOSING","CLOSED");var errCodes=helper.object.createEnum({"TIMEOUT":-1,"RESTART":-2,"CONTINUE":100,"SWITCHING_PROTOCOLS":101,"OK":200,"CREATED":201,"ACCEPTED":202,"PARTIAL_INFORMATION":203,"NO_CONTENT":204,"RESET_CONTENT":205,"PARTIAL_CONTENT":206,"MULTIPLE_CHOICES":300,"MOVED_PERMANENTLY":301,
"MOVED_TEMPORARILY":302,"SEE_OTHER":303,"NOT_MODIFIED":304,"USE_PROXY":305,"BAD_REQUEST":400,"UNAUTHORIZED":401,"PAYMENT_REQUIRED":402,"FORBIDDEN":403,"NOT_FOUND":404,"METHOD_NOT_ALLOWED":405,"NOT_ACCEPTABLE":406,"PROXY_AUTHENTICATION_REQUIRED":407,"REQUEST_TIME_OUT":408,"CONFLICT":409,"GONE":410,"LENGTH_REQUIRED":411,"PRECONDITION_FAILED":412,"REQUEST_ENTITY_TOO_LARGE":413,"REQUEST_URL_TOO_LARGE":414,"UNSUPPORTED_MEDIA_TYPE":415,"SERVER_ERROR":500,"NOT_IMPLEMENTED":501,"BAD_GATEWAY":502,"OUT_OF_RESOURCES":503,
"GATEWAY_TIME_OUT":504,"HTTP_VERSION_NOT_SUPPORTED":505,"UNKNOWN":1006});var wsStates=helper.object.createEnum("CONNECTING","OPEN","CLOSING","CLOSED");var _decodeData=null;var _encodeData=null;var _comm=null;function Communication(args){var _ref=this;var _estimatedState=states.INITIALIZING;var _args={"protocol":protocols.WEBSOCKET,"withCredentials":false,"payload":false,"webSocket":{"maxTimeToOpen":1E4,"events":{"open":null,"message":null,"close":null,"error":null}},"methods":{"arraybufferToString":null},
"properties":null,"events":{"stateChange":null,"error":null}};var _protocol=null;var _ws=null;var _wsParams={"maxTimeId":null,"open":false,"closed":false,"url":null,"fastConnectTime":1E3};var _connection={"lastContactTime":null,"lostConnection":false,"unstableTime":1E4,"lostTime":25E3,"restartTime":33E3,"checkIntervalTime":1500,"maxPingTime":1500,"pingIntervalTime":15E3,"pingIntervalId":null,"pingTimeoutId":null,"wsReopenTime":2E3,"wsReopenTimeoutId":null,"unstableTimeoutId":null,"maxPing":1,"pingCount":0,
"state":states.INITIALIZING};var _timeoutDetected=false;var _pings={};var _arToStr=null;var _onmsg=null;var _noop=function(){};var _chunk={"success":function(){},"error":function(){},"url":null,"xhr":null,"id":null};var _lowNetworkDetection={"initTime":null,"openTime":null};var _commData;var _checkWorker=null;var _wsWOL={"enabled":false,"intervalId":null,"intervalTime":3E4};function initialize(){helper.object.parseAttributes(_args,args);_arToStr=_args.methods.arraybufferToString||function(data){var ar=
[];var len=data.byteLength;for(var i=0;i<len;i++)ar.push(String.fromCharCode(data[i]));return ar.join()};_onmsg=_args.webSocket.events.message;if(!_args.events.stateChange)_args.events.stateChange=_noop;if(!_args.events.error)_args.events.error=_noop;setProtocol(_args.protocol);initProtocolBuffer();_connection.state=states.READY;fireConnectionEvent(states.READY);_checkWorker=new Worker("<%=@BASEURL%>common/workers/thinfinity.communication.status.worker.js");_checkWorker.onmessage=function(e){if(e.data.cmd===
"check")checkStatus()}}function initProtocolBuffer(){if(typeof protobuf!="undefined"&&["RDP","FMX"].indexOf(window.cookiePrefix)!==-1){_commData=new protobuf.Type("CommandData");_commData.add(new protobuf.Field("type",1,"uint32"));_commData.add(new protobuf.Field("cmd",2,"string"));_commData.add(new protobuf.Field("data",3,"bytes"));let root=(new protobuf.Root).define("CommandData");root.add(_commData)}else helper.console.log(`Protocol Buffer is not available`);assignEncoder()}function assignEncoder(){if(!_encodeData)if(_commData)_encodeData=
(cmd,type,data)=>{var cd=_commData.create({"type":type==null?0:type,cmd,data});return _commData.encode(cd).finish()};else _encodeData=cmd=>{return cmd}}function setProtocol(value){switch(value){case protocols.AJAX:case protocols.WEBSOCKET:_protocol=value;break}return _protocol}function setEstimateState(value){if(_protocol===protocols.AJAX){if(states.hasValue(value))_estimatedState=value;if([states.CONNECTING,states.CONNECTED].indexOf(value)!=-1)checkingConnectionStatus()}return _estimatedState}function startAjax(){_connection.lastContactTime=
(new Date).getTime();_protocol=protocols.AJAX;setEstimateState(states.CONNECTING)}function restartAjax(state){if(_protocol===protocols.AJAX){if(state===undefined)state=Thinfinity.Communication.state.SERVERCONNECTED;_connection.lastContactTime=(new Date).getTime();setEstimateState(state)}}function sendAjax(params){if(_args.withCredentials!=undefined)params.withCredentials=_args.withCredentials;return helper.ajax[(params.method||"get").toLowerCase()](params)}function releaseQueue(queueName){helper.ajax.releaseQueue(queueName)}
function checkStatus(){if(_estimatedState>=states.CONNECTING&&_estimatedState<states.CLOSING){var elapsedTime=(new Date).getTime()-_connection.lastContactTime;if(elapsedTime<_connection.unstableTime){if(_timeoutDetected)cancelEchoPing();_timeoutDetected=false;clearTimeout(_connection.unstableTimeoutId);if(_connection.state!=states.CONNECTED){fireConnectionEvent(states.CONNECTED);_connection.state=states.CONNECTED}}else if(elapsedTime<_connection.lostTime){clearTimeout(_connection.wsReopenTimeoutId);
clearTimeout(_connection.unstableTimeoutId);if(_connection.state<states.UNSTABLE&&!_timeoutDetected){_connection.pingCount=0;_timeoutDetected=true;timeoutProcedure(reopen)}else if(_connection.state<states.UNSTABLE){_connection.pingCount=0;helper.console.warning("The connection has become unstable",arguments);fireConnectionEvent(states.UNSTABLE);_connection.state=states.UNSTABLE;unstableProcedure(reopen)}}else{if(_connection.state<states.LOST){fireConnectionEvent(states.LOST);_connection.state=states.LOST;
lostProcedure(reopen)}if(elapsedTime>_connection.restartTime){releaseOldWebSocket();stop();fireErrorEvent(states.getKey(states.LOST),errCodes.RESTART,errCodes.getKey(errCodes.RESTART))}}}else if(_estimatedState===states.CLOSED&&_args.properties.sessionEnd===true)_checkWorker.postMessage({"cmd":"stop"})}function checkingConnectionStatus(){_checkWorker.postMessage({"cmd":"start","value":_connection.checkIntervalTime})}function releaseOldWebSocket(){if(_ws&&!_wsWOL.enabled)try{_ws.onclose=function(){};
_ws.onerror=function(){};_ws.onmessage=function(){};_ws.close();_ws=null}catch(error){}}function webSocketStop(e){clearTimeout(_wsParams.maxTimeId);if(!_args.properties.sessionEnd){if(_wsParams.open){fireConnectionEvent(states.UNSTABLE);_connection.state=states.UNSTABLE;_connection.lastContactTime=(new Date).getTime()-_connection.restartTime}var cs={"code":errCodes.UNKNOWN,"message":errCodes.getKey(errCodes.UNKNOWN)};if(e.code){cs.code=e.code;cs.message=e.reason}if(!_wsParams.closed)if(_estimatedState!==
states.UNSTABLE)cs={"code":errCodes.RESTART,"message":errCodes.getKey(errCodes.RESTART)};_wsParams.closed=true;fireWSErrorEvent(errCodes.getKey(cs.code),cs.code,cs.message)}else{stop();_args.webSocket.events.close(e);if(!_wsParams.closed)fireConnectionEvent(states.CLOSED);_wsParams.closed=true}}function openWebSocket(url,fastConnectCallback){if(_estimatedState<=states.CLOSING){releaseOldWebSocket();helper.console.log("open new Web Socket",arguments);helper.webSocket(url,"arraybuffer").then(function(ws){_ws=
ws;_lowNetworkDetection.initTime=Date.now();_connection.pingCount=0;clearTimeout(_wsParams.maxTimeId);fireConnectionEvent(states.CONNECTING);_wsParams.url=url;_wsParams.maxTimeId=setTimeout(function(){helper.console.warning("WebSocket: is not responding...");if(!fastConnectCallback){if(!_wsParams.open){if(_ws)_ws.close();helper.console.warning("requesting to switch to Ajax mode.")}fireWSErrorEvent(errCodes.getKey(errCodes.TIMEOUT),errCodes.TIMEOUT,errCodes.getKey(errCodes.TIMEOUT))}else fastConnectCallback()},
fastConnectCallback?_wsParams.fastConnectTime:_args.webSocket.maxTimeToOpen);_ws.onopen=function(){helper.console.log("onopen",arguments);_wsParams.open=true;_wsParams.closed=false;_connection.lastContactTime=(new Date).getTime();checkingConnectionStatus();_lowNetworkDetection.openTime=Date.now();_lowNetworkDetection.speed=_lowNetworkDetection.openTime-_lowNetworkDetection.initTime;if(_lowNetworkDetection.speed>500)helper.console.warning("Low network access, detected latency: "+_lowNetworkDetection.speed.toString(),
arguments);clearTimeout(_wsParams.maxTimeId);fireConnectionEvent(states.CONNECTED);backToNormal();if(_args.webSocket.events.open)_args.webSocket.events.open();keepServerAlive()};_ws.onmessage=function(msg){_connection.lastContactTime=(new Date).getTime();if(_decodeData)msg=_decodeData(msg);if(msg?.data&&msg.data instanceof ArrayBuffer)if(msg.data.byteLength===11)try{if(_arToStr((new Zlib.RawInflate((new Uint8Array(msg.data)).subarray(7))).decompress())=="{}"){var t=(new Date).getTime();cancelEchoPing();
if(!_args.payload)return}}catch(error){}_onmsg(msg);msg=null};_ws.onerror=function(e){helper.console.warning(helper.string.format("onerror -- ws error - sessionEnd: {0}",_args.properties.sessionEnd),arguments);webSocketStop(e);stopServerAlive()};_ws.onclose=function(e){helper.console.warning(helper.string.format("Websocket has been closed. Code: {0} Reason: {1}",e.code,e.reason),arguments);webSocketStop(e);stopServerAlive()}}).catch(function(e){helper.console.warning(helper.string.format("onerror -- ws error - sessionEnd: {0}",
_args.properties.sessionEnd),arguments);webSocketStop(e)})}}function restartWebSocketFlow(state){if(_wsWOL.enabled)return;if(!_wsParams.closed){_wsParams.closed=true;fireConnectionEvent(states.CLOSING);fireConnectionEvent(states.CLOSED)}if(_ws)_ws.close();stop();_estimatedState=states.SERVERCONNECTED;reopen()}function setChunkHandlers(jData){_chunk.success=jData.success;_chunk.error=jData.error;_chunk.url=jData.url;_chunk.id=jData.id}function restart(protocol){if(protocol===undefined)protocol=_protocol;
switch(protocol){case protocols.AJAX:restartAjax();break;case protocols.WEBSOCKET:restartWebSocketFlow();break}}function reset(){if(_ws)_ws.close();stop();fireConnectionEvent(states.READY)}function getNextChunk(){if(_protocol===protocols.AJAX){if(_chunk.xhr)return;_chunk.xhr=helper.ajax.get({"url":_chunk.url,"withCredentials":_args.withCredentials,"dataType":"json","success":function(data){_chunk.xhr=null;_connection.lastContactTime=(new Date).getTime();_chunk.success(data)},"abort":function(e,status,
xhr){_chunk.xhr=null;if(_estimatedState<=states.UNSTABLE){_connection.lastContactTime=(new Date).getTime();_chunk.success({})}},"error":function(e,status,xhr){_chunk.xhr=null;_connection.lastContactTime=(new Date).getTime()-_connection.lostTime;_chunk.error(e,xhr)}})}}function sendWebSocket(cmd,type){if(_ws&&_estimatedState>=states.RECONNECTING&&_estimatedState<=states.CLOSING&&!_wsParams.closed)_ws.send(_encodeData(cmd,type))}function post(params){if(_args.withCredentials!=undefined)params.withCredentials=
_args.withCredentials;helper.ajax.post(params)}function wsClose(){if(_wsWOL.enabled)return;fireConnectionEvent(states.CLOSING);setTimeout(function(){fireConnectionEvent(states.CLOSED);if(_ws)_ws.close()},100)}function wsWOL(enabled){if(_wsWOL.enabled!==enabled)if(enabled){_wsWOL.enabled=true;stop();clearInterval(_wsWOL.intervalId);_wsWOL.intervalId=setInterval(function(){_ws.send("cmd=ping")},_wsWOL.intervalTime)}else{_wsWOL.enabled=false;_checkWorker.postMessage({"cmd":"start","value":_connection.checkIntervalTime})}}
function dispose(){releaseOldWebSocket();if(_chunk.xhr){_chunk.success=_noop;_chunk.error=_noop;_chunk.abort=_noop;_chunk.xhr.abort()}stop()}function stop(){clearTimeout(_wsParams.maxTimeId);_checkWorker.postMessage({"cmd":"stop"});cancelEchoPing()}function backToNormal(){clearTimeout(_connection.wsReopenTimeoutId);clearTimeout(_connection.unstableTimeoutId);clearTimeout(_connection.pingTimeoutId)}function fireConnectionEvent(state){if(state!=_estimatedState){_estimatedState=state;_args.events.stateChange(_estimatedState)}}
function sendWSPing(callback){if(_connection.pingCount<_connection.maxPing&&_connection.pingTimeoutId==null){_connection.pingCount++;if(_connection.state===states.UNSTABLE){var sp=_ws.readyState===wsStates.OPEN?"sending ping":"connection is not open";helper.console.warning("Unstable connection, "+sp+", readyState: "+wsStates.getKey(_ws.readyState))}if(_ws.readyState===wsStates.OPEN){_connection.pingTimeoutId=setTimeout(function(){_connection.pingTimeoutId=null;callback(false)},_connection.maxPingTime);
_ws.send("cmd=ping")}else callback(false)}}function sendAjaxPing(callback){if(_connection.pingCount<_connection.maxPing&&_connection.pingTimeoutId==null){_connection.pingCount++;_connection.pingTimeoutId=setTimeout(function(){_connection.pingTimeoutId=null;callback(false)},_connection.maxPingTime);helper.ajax.get({"url":"cmd?cmd=ping&id="+_chunk.id,"dataType":helper.ajax.responseType.TEXT,"cache":false,"timeout":_connection.maxPingTime,"withCredentials":_args.withCredentials,"success":function(data){clearTimeout(_connection.pingTimeoutId);
callback(true)},"error":function(e,status,xhr){callback(false)}})}}function cancelEchoPing(){_connection.pingCount=0;clearTimeout(_connection.pingTimeoutId);_connection.pingTimeoutId=null}function reopen(){if(!_args.properties.sessionEnd)return _protocol===protocols.AJAX?reopenAjax():reopenWS();else return false}function reopenWS(callback){if(_ws.readyState>wsStates.OPEN&&_connection.state<states.LOST){fireConnectionEvent(states.RECONNECTING);openWebSocket(_wsParams.url,callback)}}function reopenAjax(callback){fireConnectionEvent(states.RECONNECTING)}
function fireErrorEvent(name,code,message){try{_args.events.error(new CustomEvent(name,{"detail":{"code":code,"message":message}}))}catch(error){helper.console.warning("fireErrorEvent trough exception: "+error.message,arguments,error)}}function fireWSErrorEvent(name,code,message){_args.webSocket.events.error(new CustomEvent(name,{"detail":{"code":code,"message":message}}))}function timeoutProcedure(callback){sendPing(callback)}function unstableProcedure(callback){sendPing(callback)}function keepServerAlive(){clearInterval(_connection.pingIntervalId);
_connection.pingIntervalId=setInterval(function(){if(_protocol===protocols.WEBSOCKET)if(_ws?.readyState===wsStates.OPEN)_ws.send("cmd=ping")},_connection.pingIntervalTime)}function stopServerAlive(){clearInterval(_connection.pingIntervalId)}function sendPing(callback){if(_protocol===protocols.WEBSOCKET)if(!_wsParams.closed)sendWSPing(callback);else reopenWS(callback);else if(_protocol===protocols.AJAX)sendAjaxPing(function(response){if(response)_connection.lastContactTime=(new Date).getTime()})}function lostProcedure(callback){if(_protocol===
protocols.WEBSOCKET){if(_ws.readyState>=wsStates.CLOSING)reopen(callback)}else;}function createPing(name,jData){var name=name||helper.utils.generateGUID(12);if(_pings[name])clearInterval(_pings[name]);_pings[name]=setInterval(function(){sendAjax({url:jData.url,dataType:helper.ajax.responseType.DOCUMENT,cache:false,timeout:typeof(jData.timeout!="undefined")?jData.timeout:1E3,error:jData.error,success:jData.success})},jData.intervalTime);return name}function disposePing(name){stopServerAlive();if(name&&
_pings[name])clearInterval(_pings[name])}function recvPingResponse(){_connection.lastContactTime=(new Date).getTime()}function forceReconnect(){_connection.lastContactTime=(new Date).getTime()-_connection.unstableTime}initialize();Object.defineProperty(_ref,"state",{"enumerable":true,"configurable":false,"get":function(){return _estimatedState}});Object.defineProperty(_ref,"protocol",{"enumerable":true,"configurable":false,"get":function(){return _protocol},"set":function(value){return setProtocol(value)}});
Object.defineProperty(_ref,"restart",{"enumerable":true,"configurable":false,"writable":false,"value":restart});Object.defineProperty(_ref,"reset",{"enumerable":true,"configurable":false,"writable":false,"value":reset});Object.defineProperty(_ref,"get",{"enumerable":true,"configurable":false,"writable":false,"value":sendAjax});Object.defineProperty(_ref,"send",{"enumerable":true,"configurable":false,"writable":false,"value":sendAjax});Object.defineProperty(_ref,"post",{"enumerable":true,"configurable":false,
"writable":false,"value":post});Object.defineProperty(_ref,"releaseQueue",{"enumerable":true,"configurable":false,"writable":false,"value":releaseQueue});Object.defineProperty(_ref,"queueLength",{"enumerable":true,"configurable":false,"writable":false,"value":function(queueName){return helper.ajax.queueLength(queueName)}});Object.defineProperty(_ref,"getNextChunk",{"enumerable":true,"configurable":false,"writable":false,"value":getNextChunk});Object.defineProperty(_ref,"setChunkHandlers",{"enumerable":true,
"configurable":false,"writable":false,"value":setChunkHandlers});Object.defineProperty(_ref,"start",{"enumerable":true,"configurable":false,"writable":false,"value":startAjax});Object.defineProperty(_ref,"wsOpen",{"enumerable":true,"configurable":false,"writable":false,"value":function(url){return openWebSocket(url)}});Object.defineProperty(_ref,"wsSend",{"enumerable":true,"configurable":false,"writable":false,"value":sendWebSocket});Object.defineProperty(_ref,"binaryType",{"enumerable":true,"configurable":false,
"get":function(){return _ws?_ws.binaryType:undefined}});Object.defineProperty(_ref,"wsClose",{"enumerable":true,"configurable":false,"writable":false,"value":wsClose});Object.defineProperty(_ref,"wsWOL",{"enumerable":true,"configurable":false,"writable":false,"value":wsWOL});Object.defineProperty(_ref,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":dispose});Object.defineProperty(_ref,"createPing",{"enumerable":true,"configurable":false,"writable":false,"value":createPing});
Object.defineProperty(_ref,"disposePing",{"enumerable":true,"configurable":false,"writable":false,"value":disposePing});Object.defineProperty(_ref,"forceReconnect",{"enumerable":true,"configurable":false,"writable":false,"value":forceReconnect});Object.defineProperty(_ref,"serverConnected",{"enumerable":true,"configurable":false,"get":function(){return _estimatedState>=states.SERVERCONNECTED},"set":function(value){fireConnectionEvent(value?states.SERVERCONNECTED:states.READY)}});Object.defineProperty(_ref,
"connected",{"enumerable":true,"configurable":false,"get":function(){return _estimatedState>=states.SERVERCONNECTED&&_estimatedState<states.CLOSING}});Object.defineProperty(_ref,"recvPingResponse",{"enumerable":true,"configurable":false,"writable":false,"value":recvPingResponse});Object.defineProperty(_ref,"resetEncoding",{"enumerable":true,"configurable":false,"writable":false,"value":assignEncoder});_comm=_ref;return _ref}function registerEncoding(encoding){if(encoding){if(encoding.encode)_encodeData=
encoding.encode;if(encoding.decode)_decodeData=encoding.decode}}function unregisterEncoding(){_decodeData=_encodeData=null;if(_comm)_comm.resetEncoding()}Object.defineProperty(Communication,"protocol",{"enumerable":true,"configurable":false,"get":function(){return protocols}});Object.defineProperty(Communication,"state",{"enumerable":true,"configurable":false,"get":function(){return states}});Object.defineProperty(Communication,"errorCode",{"enumerable":true,"configurable":false,"get":function(){return errCodes}});
Object.defineProperty(Communication,"registerEncoding",{"enumerable":true,"configurable":false,"writable":false,"value":registerEncoding});Object.defineProperty(Communication,"unregisterEncoding",{"enumerable":true,"configurable":false,"writable":false,"value":unregisterEncoding});try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.Communication=Communication})();
(function(){function StatusInfo(args){var _ref=this;var _args={"container":null,"variables":null};var _statusContainer=null;var _header=null;var _close=null;var _body=null;var _update={"time":1E3,"intervalId":null};var _variables=[];var _idx=0;function initialize(){helper.object.parseAttributes(_args,args)}function initializeStatus(){if(!_args.container)_args.container=document.body;_statusContainer=helper.dom.appendJsonElement({"parentElement":_args.container,"type":"div","attributes":{"style":"position:absolute;zIndex:999999999;width:auto;height:auto;min-width:150px;min-height:45px;backgroundColor:#d6d6d6;top:20px;left:20px;display:none;"}});
_header=helper.dom.appendJsonElement({"parentElement":_statusContainer,"type":"div","attributes":{"style":"height:20px;margin:0px;top:0px;left:0px;backgroundColor:#3297d6;color:#ffffff;fontWeight:400;lineHeight:22px;fontSize:10pt;padding-left:5px;borderBottom: 1px solid #a7a7a7;"},"content":"Status"});_close=helper.dom.appendJsonElement({"parentElement":_header,"type":"div","attributes":{"style":"height: 14px; margin: 0px;top: 0px;marginRight: 6px;color: rgb(255, 255, 255);fontWeight: 400;lineHeight: 22px;fontSize: 10pt;paddingLeft: 5px;display: inline-block;float: right;"},
"events":{"click":hideStatus},"content":"X"});_body=helper.dom.appendJsonElement({"parentElement":_statusContainer,"type":"div","attributes":{"style":"width:100%;height:auto;"}});if(_args.variables)_args.variables.forEach(function(item){addVariable(item)});if(Thinfinity.Draggable)new Thinfinity.Draggable({"container":_statusContainer,"dragElem":_header});helper.dom.addEvent(window,"newStatusAPIVariables",getVariables);getVariables()}function getVariables(){if(Thinfinity.StatusAPI)addVariables(Thinfinity.StatusAPI.dump("STATUSINFO"))}
function addVariables(variables){if(variables instanceof Array)variables.forEach(function(item){addVariable(item)});else return addVariable(variables)}function addVariable(jData){var item={"name":jData.name,"title":jData.title,"index":jData.index||_idx,"get":jData.get,"obj":jData.obj,"style":jData.style,"draw":false};_variables.push(item);_idx=item.idx++;return drawVariable(item)}function appendRow(index,row){if(_body&&row){var bRow;var list=_body.querySelectorAll(".row");var i=0;while(!bRow&&i<list.length){if(index<
list[i].index)bRow=list[i];i++}if(bRow)_body.insertBefore(row,bRow);else _body.appendChild(row)}}function drawVariable(jData){if(!jData.elems){var _row=helper.dom.createJsonElement({"type":"div","attributes":{"style":"width:100%;height:20px;borderBottom:1px solid #cccccc;","class":"row","index":jData.index}});var _name=helper.dom.appendJsonElement({"parentElement":_row,"type":"div","attributes":{"style":"width:auto;display:inline-block;float:left;marginLeft:5px;marginRight:10px;fontSize:10pt;"},"content":jData.title+
" :"});var _value=helper.dom.appendJsonElement({"parentElement":_row,"type":"div","attributes":{"style":"width:auto;display:inline-block;float:right;marginRight:5px;fontSize:10pt;"},"content":jData.get?jData.get():"undefined"});jData.elems={"row":_row,"name":_name,"value":_value};jData.draw=false}if(_body)appendRow(jData.index,jData.elems.row);return _value}function removeVariable(name){for(var i=0,t=_variables.length;i<t;i++)if(_variables.name===name){_body.removeChild(_variables.row);_variables.splice(i,
1)}}function updateInfo(){clearInterval(_update.intervalId);_update.intervalId=setInterval(function(){refreshVariables()},_update.time);refreshVariables()}function refreshVariables(){_variables.forEach(function(item){if(!item.draw)drawVariable(item);var value=item.get?item.get():"undefined";item.elems.value.innerText=value;if(item.style)helper.style.add(item.elems.value,item.style(value))})}function showStatus(){if(!_statusContainer)initializeStatus();helper.style.add(_statusContainer,{"display":"block"});
updateInfo()}function hideStatus(){helper.style.add(_statusContainer,{"display":"none"});clearInterval(_update.intervalId)}initialize();Object.defineProperty(_ref,"show",{"enumerable":false,"configurable":false,"writable":false,"value":showStatus});Object.defineProperty(_ref,"hide",{"enumerable":false,"configurable":false,"writable":false,"value":hideStatus});Object.defineProperty(_ref,"add",{"enumerable":false,"configurable":false,"writable":false,"value":addVariables});Object.defineProperty(_ref,
"remove",{"enumerable":false,"configurable":false,"writable":false,"value":removeVariable});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.StatusInfo=new StatusInfo({})})();
(function(){var __instance__=null;var _awaitServ=[];var _permissions=null;function awaitService(){return new Promise(function(resolve,reject){if(__instance__)resolve(__instance__);else _awaitServ.push({"resolve":resolve,"reject":reject})})}function executeAwaitServ(){_awaitServ.forEach(function(prom){try{prom.resolve(__instance__)}catch(e){}});_awaitServ=null}function setPermissions(permissions){if(permissions&&helper.object.getDataTypeOf(permissions)==="json")_permissions=permissions}function Component(args){try{if(Thinfinity.Component.Extend)return new Thinfinity.Component.Extend(args)}catch(e){helper.console.warning("Cannot construct Thinfinity.Component",
arguments)}}function RegistrationServices(args){var _ref=this;var _args={"components":null,"constructors":null,"owner":null,"getAuthorization":null,"permissions":null};var _negotiationCommands={"registration":"component.require.registration","response":"component.registration.response","ready":"thinfinity.components.registration.services.ready"};var fireEvent=null;var _registeredObjects={};var _registeredComponents={};var _loadedComponents={};var _waitComponents={};var _registeredAPIS={};var _waitAPIs=
{};var _waitRegisteredComponents={};function initialize(args){helper.object.parseAttributes(_args,args);var te=new Thinfinity.Events({"owner":_ref,"events":_args.events});fireEvent=te.fireEvent;attachHandlers();defineExternalProperties();initializeComponents(_args.components);fireCustomEvent(_negotiationCommands.ready,null)}function attachHandlers(){helper.dom.addEvent(window,_negotiationCommands.registration,requireRegistration)}function detachHandlers(){helper.dom.removeEvent(window,_negotiationCommands.registration,
requireRegistration)}function fireCustomEvent(name,data){window.dispatchEvent(new CustomEvent(name,{"detail":data}))}function requireRegistration(){fireCustomEvent(_negotiationCommands.response,{"owner":_ref})}function registerComponent(component){if(component.name&&!_registeredComponents[component.name]){_registeredComponents[component.name]=component;return true}else{helper.console.warning("This component is already registered",arguments);return false}}function unregisterComponent(component){if(component.name&&
_registeredComponents[component.name]&&_registeredComponents[component.name]===component){delete _registeredComponents[component.name];return true}else{helper.console.warning("This component is not registered",arguments);return false}}function loadAPI(name){return new Promise(function(resolve){name=name.toUpperCase();if(_loadedComponents[name]){var comp=_loadedComponents[name];if(comp.api)helper.dom.loadFile(component.api).then(resolve).catch(reject);else reject(false)}else{if(!_waitComponents[name])_waitComponents[name]=
[];_waitComponents[name].push(function(){var comp=_loadedComponents[name];if(comp.api)helper.dom.loadFile(comp.api).then(resolve).catch(reject);else reject(false)})}})}function getAPI(name){return new Promise(function(resolve,reject){return loadAPI(name.toUpperCase()).then(function(){if(_registeredAPIS[name])resolve(_registeredAPIS[name]);else{if(!_waitAPIs[name])_waitAPIs[name]=[];_waitAPIs[name].push(resolve)}}).catch(reject)})}function checkForPendingAPIs(name){name=name.toUpperCase();if(_waitAPIs[name]){_waitAPIs[name].forEach(function(resolve){try{resolve(_registeredAPIS[name])}catch(e){}});
delete _waitAPIs[name]}}function checkForPendingComponent(name){name=name.toUpperCase();if(_waitComponents[name]){_waitComponents[name].forEach(function(resolve){try{resolve()}catch(e){}});delete _waitComponents[name]}}function checkForPendingRegisteredObjects(name){name=name.toUpperCase();if(_waitRegisteredComponents[name]){_waitRegisteredComponents[name].forEach(function(resolve){try{resolve(_registeredObjects[name])}catch(e){}});delete _waitRegisteredComponents[name]}}function loadScript(component,
name){return new Promise(function(resolve,reject){if(component.enabled!==false){var proms=[];var url=component.url;if(url)proms.push(helper.dom.loadFile(url));else helper.console.warning("Component initialization error, this components does not match with the minimal required parameters.",arguments);Promise.all(proms).then(function(){resolve({"name":name,"component":component})}).catch(reject)}else reject("Component is not enabled")})}function hasPermission(name){if(_permissions&&_permissions[name]){var perm=
_permissions[name];if(perm.required)return helper.object.getValue(_args.permissions,perm.required,false);else return true}else return true}function initializeComponents(components){for(var name in components){var component=components[name];name=name.toUpperCase();if(hasPermission(name)&&component.enabled!==false&&component.scrapers&&component.scrapers.indexOf(cookiePrefix)!==-1){component.name=name;if(component.files){var constructorComp=component.files.find(function(item){return item.isConstructor===
true});if(!constructorComp&&component.files.length>0)constructorComp=component.files[0];if(constructorComp){_loadedComponents[name]=component;_loadedComponents[name].loaded=false;loadComponent(name,constructorComp)}}}}}function loadComponent(name,component){loadScript(component,name).then(function(){_loadedComponents[name].loaded=true;if(_loadedComponents[name].events&&_loadedComponents[name].events.sucess)_loadedComponents[name].events.sucess();checkForPendingComponent(name)}).catch(function(msg){if(_loadedComponents[name].events&&
_loadedComponents[name].events.error)_loadedComponents[name].events.error(e)})}function registerObject(name,obj){name=name.toUpperCase();if(hasPermission(name))if(!_registeredObjects[name]){_registeredObjects[name]=obj;checkForPendingRegisteredObjects(name);return true}else{helper.console.warning("This object is already registered",arguments);return false}}function unregisterObject(name,obj){name=name.toUpperCase();if(_registeredObjects[name]&&_registeredObjects[name]===obj){delete _registeredObjects[name];
return true}else{helper.console.warning("This object is not registered",arguments);return false}}function getRegisteredObject(name){return _registeredObjects[name.toUpperCase()]}function getAsyncRegisteredObject(name){return new Promise(function(resolve,reject){if(_registeredObjects[name.toUpperCase()])resolve(_registeredObjects[name.toUpperCase()]);else{if(!_waitRegisteredComponents[name])_waitRegisteredComponents[name]=[];_waitRegisteredComponents[name].push(resolve)}})}function getPermissions(name){return new Promise(function(resolve,
reject){if(!(name instanceof Array))name=[name];var permissions=null;name.forEach(function(itemName){if(_args.permissions[itemName]){if(!permissions)permissions={};permissions[name]=_args.permissions[itemName]}else{itemName=itemName.toUpperCase();var key=Object.keys(_args.permissions).find(function(key){return key.toUpperCase()===itemName});if(_args.permissions[key]){if(!permissions)permissions={};permissions[itemName]=_args.permissions[key]}}});resolve(permissions)})}function getObjectConfig(name){return new Promise(function(resolve,
reject){if(name){name=name.toUpperCase();if(_loadedComponents[name])resolve(_loadedComponents[name]);else reject("This component is not loaded")}else reject("Name is null or undefined")})}function registerAPI(name,object){name=name.toUpperCase();if(hasPermission(name)){if(_registeredAPIS[name])_registeredAPIS[name]={};_registeredAPIS[name]=object;checkForPendingAPIs(name)}}function defineExternalProperties(){if(_args.owner){if(!_args.owner.registerComponentObject)Object.defineProperty(_args.owner,
"registerComponentObject",{"enumerable":false,"configurable":false,"writable":false,"value":registerObject});if(!_args.owner.unregisterComponentObject)Object.defineProperty(_args.owner,"unregisterComponentObject",{"enumerable":false,"configurable":false,"writable":false,"value":unregisterObject})}}function requirePanel(params){if(params&&params.constructorName&&_args.constructors[params.constructorName]){params.getAuthorization=_args.getAuthorization;return _args.constructors[params.constructorName](params)}}
function dispose(){var kvp=null;for(kvp in _registeredObjects)if(_registeredObjects[kvp]){if(_registeredObjects[kvp].destroy)_registeredObjects[kvp].destroy();if(_registeredObjects[kvp].dispose)_registeredObjects[kvp].dispose();unregisterObject(kvp,_registeredObjects[kvp])}for(kvp in _registeredComponents)if(_registeredComponents[kvp]){if(_registeredComponents[kvp].destroy)_registeredComponents[kvp].destroy();if(_registeredComponents[kvp].dispose)_registeredComponents[kvp].dispose();unregisterComponent(_registeredComponents[kvp])}detachHandlers();
_ref=null}initialize(args);Object.defineProperty(_ref,"register",{"enumerable":true,"configurable":false,"writable":false,"value":registerComponent});Object.defineProperty(_ref,"unregister",{"enumerable":true,"configurable":false,"writable":false,"value":unregisterComponent});Object.defineProperty(_ref,"registerObject",{"enumerable":true,"configurable":false,"writable":false,"value":registerObject});Object.defineProperty(_ref,"unregisterObject",{"enumerable":true,"configurable":false,"writable":false,
"value":unregisterObject});Object.defineProperty(_ref,"getRegisteredObject",{"enumerable":true,"configurable":false,"writable":false,"value":getRegisteredObject});Object.defineProperty(_ref,"getAsyncRegisteredObject",{"enumerable":true,"configurable":false,"writable":false,"value":getAsyncRegisteredObject});Object.defineProperty(_ref,"getPermissions",{"enumerable":true,"configurable":false,"writable":false,"value":getPermissions});Object.defineProperty(_ref,"getObjectConfig",{"enumerable":true,"configurable":false,
"writable":false,"value":getObjectConfig});Object.defineProperty(_ref,"registerAPI",{"enumerable":true,"configurable":false,"writable":false,"value":registerAPI});Object.defineProperty(_ref,"requirePanel",{"enumerable":true,"configurable":false,"writable":false,"value":requirePanel});Object.defineProperty(_ref,"getAPI",{"enumerable":true,"configurable":false,"writable":false,"value":getAPI});Object.defineProperty(_ref,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":dispose});
__instance__=_ref;executeAwaitServ();return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.Component=Component;Object.defineProperty(Thinfinity.Component,"RegistrationServices",{"enumerable":false,"configurable":false,"writable":false,"value":RegistrationServices});Object.defineProperty(Thinfinity.Component,"setPermissions",{"enumerable":false,"configurable":false,"writable":false,"value":setPermissions});Object.defineProperty(Thinfinity.Component,"await",{"enumerable":false,"configurable":false,
"writable":false,"value":awaitService})})();
(function(){var _enumErrors=helper.object.createEnum({ERROR:-1,TIMEOUT:-2});function ComponentExtend(args){var _ref=this;var _args={"events":null};var _service=null;var _negotiationCommands={"registration":"component.require.registration","response":"component.registration.response"};var _name="thin.comp."+helper.utils.maskToGUID("xxx-x-xxx");var fireEvent=null;var _timeout={id:null,time:500,maxTries:25,count:0};var _registered=false;function initialize(args){helper.object.parseAttributes(_args,args);
var te=new Thinfinity.Events({"owner":_ref,"events":_args.events});fireEvent=te.fireEvent;attachHandlers();requireRegistration()}function attachHandlers(){helper.dom.addEvent(window,_negotiationCommands.response,registrationResponse)}function detachHandlers(){helper.dom.removeEvent(window,_negotiationCommands.response,registrationResponse)}function fireCustomEvent(name,data){window.dispatchEvent(new CustomEvent(name,data))}function requireRegistration(){if(!_registered){clearTimeout(_timeout.id);
fireCustomEvent(_negotiationCommands.registration,{});if(_timeout.maxTries===0||_timeout.count<_timeout.maxTries)_timeout.id=setTimeout(function(){requireRegistration()},_timeout.time);else registrationFails(_enumErrors.TIMEOUT,`Timeout, cannot 'require registration' service.`);_timeout.count++}}function registrationResponse(e){if(e.detail&&e.detail.owner&&e.detail.owner.register){_registered=true;clearTimeout(_timeout.id);_service=e.detail.owner;detachHandlers();var result=_service.register(_ref);
if(result===true)fireEvent("ready",{});else registrationFails(_enumErrors.ERROR,result)}}function registrationFails(code,message){fireEvent("fail",{code,message})}function requirePanel(params){if(_service)return _service.requirePanel(params);else helper.console.warning("Thinfinity.Component.RegistrationServices is not defined, please try later",arguments)}function getRegisteredObject(name){if(_service)return _service.getRegisteredObject(name);else helper.console.warning("Thinfinity.Component.RegistrationServices is not defined, please try later",
arguments)}function getAsyncRegisteredObject(name){return new Promise(function(resolve,reject){if(_service)resolve(_service.getRegisteredObject(name));else reject("Thinfinity.Component.RegistrationServices is not defined, please try later",arguments)})}function getObjectConfig(name){return new Promise(function(resolve,reject){if(_service)resolve(_service.getObjectConfig(name));else reject("Thinfinity.Component.RegistrationServices is not defined, please try later",arguments)})}function getPermissions(name){return new Promise(function(resolve,
reject){if(_service)resolve(_service.getPermissions(name));else reject("Thinfinity.Component.RegistrationServices is not defined, please try later",arguments)})}function destroy(){detachHandlers();var msg="disconnected";fireEvent("destroy",{"message":msg});fireEvent=null;_ref=null}Object.defineProperty(_ref,"requirePanel",{"enumerable":true,"configurable":false,"writable":false,"value":requirePanel});Object.defineProperty(_ref,"getRegisteredObject",{"enumerable":true,"configurable":false,"writable":false,
"value":getRegisteredObject});Object.defineProperty(_ref,"getAsyncRegisteredObject",{"enumerable":true,"configurable":false,"writable":false,"value":getAsyncRegisteredObject});Object.defineProperty(_ref,"getPermissions",{"enumerable":true,"configurable":false,"writable":false,"value":getPermissions});Object.defineProperty(_ref,"getObjectConfig",{"enumerable":true,"configurable":false,"writable":false,"value":getObjectConfig});Object.defineProperty(_ref,"name",{"enumerable":true,"configurable":false,
"get":function(){return _name}});Object.defineProperty(_ref,"eCodes",{"enumerable":true,"configurable":false,"get":function(){return _enumErrors}});Object.defineProperty(_ref,"destroy",{"enumerable":true,"configurable":false,"writable":false,"value":destroy});initialize(args);return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(Thinfinity.Component){Thinfinity.Component.Extend=ComponentExtend;if(!Thinfinity.Component.hasOwnProperty("eCodes"))Object.defineProperty(Thinfinity.Component,"eCodes",
{"enumerable":true,"configurable":false,"get":function(){return _enumErrors}})}})();(function(){function Permissions(){var _ref=this;var _permissions={"WORKMONITOR":{"required":"workMonitor.trackUserActivity"}};function initialize(){if(helper.object.existsPath(window,"Thinfinity.Component.setPermissions"))Thinfinity.Component.setPermissions(_permissions);else helper.console.warning("Cannot set permissions, Thinfinity.Component is undefined or null",arguments)}initialize()}new Permissions})();
(function(){function PanelConstructor(args){var _ref=this;var _name=helper.utils.maskToGUID("PANEL-xxxx-xx-xxx");var _elems={"caption":null,"container":null,"resizeContainer":null,"footer":null,"body":null};var _args={"parentElement":null,"params":null,"getAuthorization":null};function initialize(args){helper.object.parseAttributes(_args,args);if(!_args.params)_args.params={};var draggable=_args.params.draggable&&Thinfinity.Draggable;if(draggable)_elems.resizeContainer=helper.dom.appendJsonElement({"parentElement":_args.parentElement,
"type":"div","attributes":{"class":"component-resize-panel hidden"}});_elems.container=helper.dom.appendJsonElement({"parentElement":draggable?_elems.resizeContainer:_args.parentElement,"type":"div","attributes":{"class":"component-panel hidden"}});if(_args.params.caption)if(_args.params.caption.icons)_elems.footer=helper.dom.appendJsonElement({"parentElement":_args.container,"type":"div","attributes":{"class":"component-caption"}});_elems.body=helper.dom.appendJsonElement({"parentElement":_elems.container,
"type":"div","attributes":{"class":"component-body"}});if(_args.params.footer)if(_args.params.footer.buttons){_elems.footer=helper.dom.appendJsonElement({"parentElement":_args.container,"type":"div","attributes":{"class":"component-footer"}});_args.params.footer.buttons.forEach(function(button){var btn=helper.dom.appendJsonElement({"parentElement":_elems.footer,"type":"div","attributes":{"class":"component-button"},"events":button.events})})}if(draggable)if(Thinfinity.Draggable)_draggable=new Thinfinity.Draggable({"container":_elems.resizeContainer,
"dragElem":_elems.container,"key":"thinfinity.panel.component"});else helper.console.warning("Thinfinity.Draggable class is not loaded, please add class reference first",arguments)}function show(){var _showCallback=function(allow){if(allow){var elem=_elems.resizeContainer||_elems.container;if(!helper.style.hasClass(elem,"show"))helper.style.replace(elem,"hidden","show")}};if(_args.getAuthorization)_args.getAuthorization(_name,_showCallback);else _showCallback(true)}function hide(){var elem=_elems.resizeContainer||
_elems.container;if(!helper.style.hasClass(elem,"hidden"))helper.style.replace(elem,"show","hidden")}function getContainer(filter){return _elems.container}function getBody(){return _elems.body}function destroy(){var elem=_elems.resizeContainer||_elems.container;if(elem){elem.parentElement.removeChild(elem);elem=null}_ref=null;return true}initialize(args);Object.defineProperty(_ref,"show",{"enumerable":true,"configurable":false,"writable":false,"value":show});Object.defineProperty(_ref,"hide",{"enumerable":true,
"configurable":false,"writable":false,"value":hide});Object.defineProperty(_ref,"container",{"enumerable":true,"configurable":false,"get":getContainer});Object.defineProperty(_ref,"body",{"enumerable":true,"configurable":false,"get":getBody});Object.defineProperty(_ref,"destroy",{"enumerable":true,"configurable":false,"writable":false,"value":destroy});return _ref}try{Thinfinity!=undefined;Thinfinity.Component.Panel=PanelConstructor}catch(e){}})();
(function(){var _types=helper.object.createEnum("TAP","PAN","PRESS","PRESSANDRELEASE","PINCH","SWIPE","PRESSANDTAP","PANANDTAP","RELEASE","SWIPEFROMEDGE");var _onStates=helper.object.createEnum("BEFORE","WHILE","AFTER","ALL");function GesturesConfigurator(args){var _ref=this;var _plugin=Hammer;var _pluginInstance=null;var _eventsDetails={};var _typeRecognizers=[{type:_types.TAP,recognizer:"Tap",comparor:["pointers","taps"]},{type:_types.PAN,recognizer:"Pan",comparor:["pointers","direction"],on:[{state:_onStates.BEFORE,
listeners:["start"]},{state:_onStates.WHILE,listeners:["move"]},{state:_onStates.AFTER,listeners:["end","cancel"]}]},{type:_types.PRESS,recognizer:"Press",comparor:["pointers"]},{type:_types.PRESSANDRELEASE,recognizer:"Press",comparor:["pointers"]},{type:_types.PINCH,recognizer:"Pinch",comparor:["pointers"],on:[{state:_onStates.BEFORE,listeners:["start"]},{state:_onStates.WHILE,listeners:["move"]},{state:_onStates.AFTER,listeners:["end","cancel"]}]},{type:_types.SWIPE,recognizer:"Swipe",comparor:["pointers",
"direction"]},{type:_types.PRESSANDTAP,recognizer:pressAndTapRecognizer,comparor:[]},{type:_types.PANANDTAP,recognizer:panAndTapRecognizer,comparor:[]},{type:_types.RELEASE,recognizer:releaseRecognizer,comparor:[]},{type:_types.SWIPEFROMEDGE,recognizer:swipeFromEdgeRecognizer,comparor:["direction"]}];var _args={listenElement:null,instanceOptions:{domEvents:true},gestures:[],middleware:null,middlewares:[],actions:{}};function initialize(){setArgs(args)}function startRecognition(){if(_pluginInstance)stopRecognition();
if(!_args.listenElement){helper.console.warning("[GesturesConfigurator] No _args.listenElement was provided for TouchManager.");return}_pluginInstance=new _plugin["Manager"](_args.listenElement);_pluginInstance.set(_args.instanceOptions);configureEventDetails();configureEvents();adaptRecognizers();configureHandlers()}function clearGesturesAndDetails(){_args.gestures=[];_eventsDetails={}}function configureEvents(){var flatRecognizers=Object.keys(_eventsDetails).map(function(k){return _eventsDetails[k].recognizers}).reduce(function(acc,
x){return acc.concat(x)},[]);_pluginInstance.add(flatRecognizers.filter(function(t){return!!!t.type}).sort(function(a,b){if(a.options.type===_types.TAP&&a.options.type===b.options.type&&a.options.pointers===b.options.pointers)if(a.options.taps>b.options.taps)return-1;else if(a.options.taps<b.options.taps)return 1;else return 0;return 0}));_pluginInstance.add(flatRecognizers.filter(function(t){return t.type==="PLUGINEVENT"}).map(function(t){return t.recognizer}));flatRecognizers.filter(function(t){return t.type===
"DOMEVENTLISTENER"}).forEach(function(t){t.elem.addEventListener(t.event,t.handler,false)})}function configureHandlers(){var detailsArr=Object.keys(_eventsDetails).map(function(k){return _eventsDetails[k]});var flatRecognizers=detailsArr.map(function(t){return t.recognizers}).reduce(function(acc,x){return acc.concat(x)},[]);_pluginInstance.on(detailsArr.reduce(function(accum,value){return accum.concat(value.listenTo)},[]).join(" "),onGesture);flatRecognizers.filter(function(t){return!!t.type&&t.type===
"PLUGINEVENT"}).forEach(function(t){_pluginInstance.on(createListenerName(t.recognizer.options.event,t.listenTo||"").join(" "),t.handler)})}function detachDomEvents(){var flatRecognizers=Object.keys(_eventsDetails).map(function(k){return _eventsDetails[k].recognizers}).reduce(function(acc,x){return acc.concat(x)},[]);flatRecognizers.filter(function(t){return t.type==="DOMEVENTLISTENER"}).forEach(function(t){t.elem.removeEventListener(t.event,t.handler,false);if(t.relatedHandlers)t.relatedHandlers.forEach(function(rh){rh.elem.removeEventListener(rh.event,
rh.handler,false)})})}function stopRecognition(){detachDomEvents();if(_pluginInstance){_pluginInstance.stop();_pluginInstance.destroy()}clearGesturesAndDetails();_pluginInstance=null}function compareGestures(g,t){var gType=g.type;var tType=t.type;if(gType===tType){var typeRecog=_typeRecognizers.filter(function(t){return t.type===gType})[0];if(typeRecog.comparor&&typeRecog.comparor.length>0)return typeRecog.comparor.every(function(val){return g[val]===t[val]});else return true}return false}function setArgs(optArgs){optArgs=
helper.object.clone(optArgs);if(optArgs.gestures){optArgs.gestures.forEach(function(t){try{t.type=typeof t.type==="string"&&_types[t.type.toUpperCase()]!==null&&_types[t.type.toUpperCase()]!==undefined?_types[t.type.toUpperCase()]:null;t.action=(Array.isArray(t.action)?t.action:[t.action]).filter(function(ac){ac=ac?.name??ac;return typeof ac==="string"&&ac.trim().length>0});t.action=t.action.map(function(ac){const {name,...content}=typeof ac==="string"?{name:ac.toUpperCase()}:{...ac,name:ac.name.toUpperCase()};
const onState=_onStates[content.on?.toUpperCase?.()]??null;return{name,...content,on:onState}})}catch(err){helper.console.warning("[GesturesConfigurator] Something went wrong while adding gesture ["+JSON.stringify(t)+"].");t.type=null}});optArgs.gestures=optArgs.gestures.filter(function(t){return t.type!==null});var gesturesConfiguration=optArgs.gestures;var nativeGestures=[];_args.gestures.forEach(function(t){var overriden=gesturesConfiguration.filter(function(g){return compareGestures(g,t)})[0];
if(!overriden)nativeGestures.push(t)});optArgs.gestures=optArgs.gestures.concat(nativeGestures)}helper.object.parseAttributes(_args,optArgs);if(optArgs.actions){optArgs.actions=Object.keys(optArgs.actions).reduce(function(obj,key){obj[key.toUpperCase()]=optArgs.actions[key];return obj},{});helper.object.extend(_args.actions,optArgs.actions)}}function getMiddleware(opts){var foundmw=null;for(var i=0,len=_args.middlewares.length;i<len&&!foundmw;i++){mw=_args.middlewares[i];var keys=Object.keys(mw).filter(function(t){return t!==
"processor"});var same=true;for(var k=0,klen=keys.length;k<klen&&same;k++)same=mw[keys[k]]===opts[keys[k]];foundmw=same?mw:null}return foundmw}const sensitivity={_ctx:[],_getActionCtx:function({action}){let ac=sensitivity._ctx.find(t=>t.name==action);if(!ac){ac={name:action,sensitivity:{...sensitivity._getCtx()}};sensitivity._ctx.push(ac)}return ac.sensitivity},_setCall:function({action,value},val,{add=false}={}){const ctx=sensitivity._getActionCtx({action});if(ctx)ctx.calls=add?ctx.calls+val<value?
ctx.calls+val:0:val},_getCtx:function(){return{calls:0}},call:function({action,value}){sensitivity._setCall({action,value},1,{add:true})},reset:function({action,value}){sensitivity._setCall({action,value},0)},isValid:function({action,value}){try{const ctx=sensitivity._getActionCtx({action});const {calls=0}=ctx??{};return calls%value==0}catch{console.log("[sensitivity] Error while validating sensitibity.");return true}}};function buildSensitivityHandlers(action,{value=1}={}){const shandlers=Object.keys(sensitivity).reduce((o,
fnName)=>{if(typeof sensitivity[fnName]==="function")o[fnName]=sensitivity[fnName].bind(this,{action,value});return o},{});return shandlers}function buildSubActionHandler(e,subactions){const handler=onstate=>{onGesture(e,null,onstate,subactions)};return handler}function onGesture(e,forcedType,forcedState,forcedActions){const [_type,listener]=(forcedType??e.type)?.split("_")??[];const type=_type?`${_type}_`:undefined;const evType=_eventsDetails[type].details?.type;const typeConfig=_typeRecognizers.find(t=>
t.type==evType);const typeOnState=forcedState??typeConfig?.on?.find(({listeners=[]}={})=>listeners.includes(listener))?.state;const eventActions=forcedActions??_eventsDetails[type].action;const actionsArr=Array.isArray(eventActions)?eventActions:[eventActions];let actions=actionsArr.map(function({name,on,subactions,...args}){subactions=subactions??[];on=typeof on==="string"?_onStates[on.toUpperCase()]:on;name=name?.toUpperCase?.()??name;return{name,on:on??_onStates[_args.actions[name]?.on?.toUpperCase?.()]??
_onStates.ALL,args:{...(args??{}),...{triggerAction:buildSubActionHandler(e,subactions),sensitivityValue:args.sensitivity,sensitivity:buildSensitivityHandlers(name,{value:args.sensitivity})}},subactions,callback:_args.actions[name.toUpperCase?.()]?.handler??_args.actions[name.toUpperCase?.()]}});actions=typeConfig?.on||forcedState?actions.filter(t=>t.on==_onStates.ALL||t.on===typeOnState):actions;if(actions.length>0){var executeActions=checkMiddleWares(e,_eventsDetails[type]);if(executeActions){var middlewr=
getMiddleware(_eventsDetails[type].details),_actionArgs=[e];try{if(middlewr&&middlewr.processor){var middlewres=middlewr.processor.call(this,e,_eventsDetails[type].details);if(middlewres)_actionArgs.push(middlewres)}}catch(err){helper.console.log("[GesturesConfigurator] Failed while executing middleware processor. "+JSON.stringify(middlewr))}for(let i=0,len=actions.length;i<len;i++){const t=actions[i];try{if(t.callback)t.callback.apply(this,[..._actionArgs,t.args])}catch(err){helper.console.error("[GesturesConfigurator] Error while executing action. "+
JSON.stringify(t),err)}}}}}function createListenerName(event,action){action=Array.isArray(action)?action:[action];return action.map(function(t){return event+t})}function parseGestureOptions(opts){var details={listenTo:[]};var type=opts.type;var addDefault=true;if(opts.direction)opts.direction=Hammer[opts.direction];opts.event=_types.getKey(type)+helper.utils.generateGUID(10)+"_";switch(opts.type){case _types.PRESSANDTAP:opts.pointers=1;opts.threshold=typeof opts.threshold==="number"?opts.threshold:
5;opts.time=typeof opts.time==="number"?opts.time:100;addDefault=false;break;case _types.PANANDTAP:opts.pointers=1;opts.threshold=typeof opts.threshold==="number"?opts.threshold:15;addDefault=false;break;case _types.SWIPEFROMEDGE:opts.direction=Hammer["DIRECTION_HORIZONTAL"];addDefault=false;break;case _types.PAN:details.listenTo.push.apply(details.listenTo,createListenerName(opts.event,["start","move","end","cancel"]));break;case _types.PINCH:details.listenTo.push.apply(details.listenTo,createListenerName(opts.event,
["start","move","end","cancel"]));break;case _types.PRESSANDRELEASE:details.listenTo.push.apply(details.listenTo,createListenerName(opts.event,["up"]));addDefault=false;break}if(addDefault)details.listenTo.push(opts.event);return{"options":opts,"details":details}}function detectTouchStart(e,gestureOpts){if(_eventsDetails[gestureOpts.event])_eventsDetails[gestureOpts.event]["pnttap"]=e.timeStamp}function checkMiddleWares(e,evDetails){var executeActions=true;try{if(evDetails.details.middleware)executeActions=
evDetails.details.middleware.call(this,e,evDetails.details)!==false;else if(_args.middleware&&executeActions)executeActions=_args.middleware.call(this,e,evDetails.details)!==false}catch(err){executeActions=true}return executeActions}function pressAndTapRecognizer(gestureOpts){var recognizers=[];var touchStartHandler=function(e){detectTouchStart(e,gestureOpts)};var resetGesture=function(){if(_eventsDetails[gestureOpts.event]["pntpressxy"]){_args.listenElement.removeEventListener("touchstart",touchStartHandler);
_eventsDetails[gestureOpts.event]["pntpressxy"]=null}};var press={"recognizer":new _plugin["Press"](gestureOpts),"type":"PLUGINEVENT","handler":function(e){if(checkMiddleWares(e,_eventsDetails[gestureOpts.event])){_eventsDetails[gestureOpts.event]["pntpressxy"]=e.center;_args.listenElement.addEventListener("touchstart",touchStartHandler)}else resetGesture()}};recognizers.push(press);var _touchmove_pnt=function(e){var currentPos=e.touches.length===1?{x:e.touches[0].pageX,y:e.touches[0].pageY}:{x:e.pageX,
y:e.pageY};var pressPos=_eventsDetails[gestureOpts.event]["pntpressxy"];if(pressPos&&e.touches.length===1){var a=pressPos.x-currentPos.x;var b=pressPos.y-currentPos.y;var distance=Math.sqrt(a*a+b*b);if(distance>15)resetGesture()}};recognizers.push({"type":"DOMEVENTLISTENER","elem":_args.listenElement,"event":"touchmove","handler":_touchmove_pnt,"relatedHandlers":[{"elem":_args.listenElement,"event":"touchstart","handler":touchStartHandler}]});var _touchend_pnt=function(e){var tapTimestamp=_eventsDetails[gestureOpts.event]["pnttap"];
if(!tapTimestamp)resetGesture();else if(Math.abs(tapTimestamp-e.timeStamp)<=300)onGesture(e,gestureOpts.event);_eventsDetails[gestureOpts.event]["pnttap"]=null};recognizers.push({"type":"DOMEVENTLISTENER","elem":_args.listenElement,"event":"touchend","handler":_touchend_pnt,"relatedHandlers":[{"elem":_args.listenElement,"event":"touchstart","handler":touchStartHandler}]});return recognizers}function panAndTapRecognizer(gestureOpts){var touchStartHandler=function(e){detectTouchStart(e,gestureOpts)};
var resetGesture=function(){_args.listenElement.removeEventListener("touchstart",touchStartHandler)};var recognizers=[];var pan={"recognizer":new _plugin["Pan"](gestureOpts),"type":"PLUGINEVENT","listenTo":["start","end"],"handler":function(e){if(checkMiddleWares(e,_eventsDetails[gestureOpts.event]))if(e.type.indexOf("start")!==-1)_args.listenElement.addEventListener("touchstart",touchStartHandler);else resetGesture();else resetGesture()}};recognizers.push(pan);var _touchend_pant=function(e){var tapTimestamp=
_eventsDetails[gestureOpts.event]["pnttap"];if(!tapTimestamp)resetGesture();else if(Math.abs(tapTimestamp-e.timeStamp)<=300)onGesture(e,gestureOpts.event);_eventsDetails[gestureOpts.event]["pnttap"]=null};recognizers.push({"type":"DOMEVENTLISTENER","elem":_args.listenElement,"event":"touchend","handler":_touchend_pant,"relatedHandlers":[{"elem":_args.listenElement,"event":"touchstart","handler":touchStartHandler}]});return recognizers}function releaseRecognizer(gestureOpts){return{"type":"DOMEVENTLISTENER",
"elem":_args.listenElement,"event":"touchend","handler":function(e){onGesture.call(this,e,gestureOpts.event)}}}function getSwipeStartPosition(e){var delta_x=e.deltaX;var delta_y=e.deltaY;var final_x=e.srcEvent.pageX||e.srcEvent.screenX||0;var final_y=e.srcEvent.pageY||e.srcEvent.screenY||0;return{x:final_x-delta_x,y:final_y-delta_y}}function swipeFromEdgeRecognizer(gestureOpts){var recognizers=[];var direction=gestureOpts.swipeDirection?gestureOpts.swipeDirection.toLowerCase():"left";var swipeFromEdge=
{"recognizer":new _plugin["Swipe"](gestureOpts),"type":"PLUGINEVENT","listenTo":[direction],"handler":function(e){var startPos=getSwipeStartPosition(e);var distance=direction==="left"?environment.availWidth-startPos.x:startPos.x;if(distance>=0&&distance<=20)onGesture.call(this,e,gestureOpts.event)}};recognizers.push(swipeFromEdge);return recognizers}function createRecognizers(type,gestureOpts){var recognizers=[];var t=_typeRecognizers.filter(function(t){return t.type===type})[0].recognizer;if(t){var recogs=
typeof t==="function"?t.call(this,gestureOpts):new _plugin[t](gestureOpts);recogs=Array.isArray(recogs)?recogs:[recogs];recognizers.push.apply(recognizers,recogs)}return recognizers}function recognizeAllWith(recog,recogWith){var flatRecogs=recog.map(function(t){return t.recognizers}).reduce(function(acc,x){return acc.concat(x)},[]).reduce(function(acc,x){return acc.concat(!!!x.type?x:x.recognizer?x.recognizer:[])},[]);var flatRecogWith=recogWith.map(function(t){return t.recognizers}).reduce(function(acc,
x){return acc.concat(x)},[]).reduce(function(acc,x){return acc.concat(!!!x.type?x:x.recognizer?x.recognizer:[])},[]);flatRecogs.forEach(function(t){t.recognizeWith(flatRecogWith)})}function recogAndRequestFailure(recogs,sameKey,sortBy){var maxSame=Math.max.apply(null,recogs.map(function(t){return t.details[sameKey]}));for(var ix=maxSame;ix>=0;ix--){var maxBy=Math.max.apply(null,recogs.map(function(t){return t.details[sortBy]}));for(var i=maxBy;i>=0;i--){var iitems=recogs.filter(function(t){return t.details[sameKey]===
ix&&t.details[sortBy]===i});var iless=recogs.filter(function(t){return t.details[sameKey]===ix&&t.details[sortBy]<i});var imore=recogs.filter(function(t){return t.details[sameKey]===ix&&t.details[sortBy]>i});iitems.forEach(function(t){t.recognizers[0].recognizeWith(iless.map(function(p){return p.recognizers[0]}));t.recognizers[0].requireFailure(imore.map(function(p){return p.recognizers[0]}))})}}}function adaptRecognizers(){var recognizers=Object.keys(_eventsDetails).map(function(k){return _eventsDetails[k]});
recogAndRequestFailure(recognizers.filter(function(t){return t.details.type===_types.TAP}),"pointers","taps");var pressAndRelease=recognizers.filter(function(t){return t.details.type===_types.PRESSANDRELEASE&&t.details.pointers===1});var press=recognizers.filter(function(t){return t.details.type===_types.PRESS&&t.details.pointers===1});recognizeAllWith(pressAndRelease,press);recognizeAllWith(press,pressAndRelease);var pressAndTap=recognizers.filter(function(t){return t.details.type===_types.PRESSANDTAP});
var pressAndRelease=recognizers.filter(function(t){return t.details.type===_types.PRESSANDRELEASE&&t.details.pointers===1});recognizeAllWith(pressAndTap,press);recognizeAllWith(press,pressAndTap);recognizeAllWith(pressAndRelease,pressAndTap);recognizeAllWith(pressAndTap,pressAndRelease);var panAndTap=recognizers.filter(function(t){return t.details.type===_types.PANANDTAP});var pan=recognizers.filter(function(t){return t.details.type===_types.PAN&&t.details.pointers===1});recognizeAllWith(panAndTap,
pan);recognizeAllWith(pan,panAndTap);var allSwipes=recognizers.filter(function(t){return t.details.type===_types.SWIPE});var swipeFromEdge=recognizers.filter(function(t){return t.details.type===_types.SWIPEFROMEDGE});var allPans=recognizers.filter(function(t){return t.details.type===_types.PAN});recognizeAllWith(allSwipes,allPans);recognizeAllWith(swipeFromEdge,allPans)}function configureEventDetails(){for(var i=0,len=_args.gestures.length;i<len;i++){var gestureDetails=_args.gestures[i];if(gestureDetails&&
gestureDetails.type!==null&&gestureDetails.type!==undefined)try{var parsedOptions=parseGestureOptions(gestureDetails);var gestureOpts=parsedOptions.options;_eventsDetails[gestureOpts.event]=_eventsDetails[gestureOpts.event]||{};_eventsDetails[gestureOpts.event]["details"]=gestureDetails;_eventsDetails[gestureOpts.event]["listenTo"]=parsedOptions.details.listenTo;gestureDetails.action.forEach(function({name}){if(name.trim().length>0&&!_args.actions[name])helper.console.warning("[GesturesConfigurator] Action not defined: ["+
name+"] .")});_eventsDetails[gestureOpts.event]["action"]=gestureDetails.action;_eventsDetails[gestureOpts.event]["recognizers"]=createRecognizers(gestureDetails.type,gestureOpts)}catch(err){helper.console.log("[GesturesConfigurator]: Error while adding gesture. ( "+JSON.stringify(gestureDetails)+" )")}else helper.console.log("[GesturesConfigurator]: Gesture does not have a valid type. ( "+JSON.stringify(gestureDetails)+" )")}}initialize();Object.defineProperty(_ref,"initialized",{"enumerable":true,
"configurable":false,"get":function(){return _pluginInstance!==null}});Object.defineProperty(_ref,"set",{"enumerable":false,"configurable":false,"writable":false,"value":setArgs});Object.defineProperty(_ref,"stopRecognition",{"enumerable":true,"configurable":false,"writable":false,"value":stopRecognition});Object.defineProperty(_ref,"startRecognition",{"enumerable":true,"configurable":false,"writable":false,"value":startRecognition});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Object.defineProperty(GesturesConfigurator,
"types",{"enumerable":true,"configurable":false,"writable":false,"value":_types});Object.defineProperty(GesturesConfigurator,"onStates",{"enumerable":true,"configurable":false,"writable":false,"value":_onStates});Thinfinity.GesturesConfigurator=GesturesConfigurator})();
(function(){function DriverVideoCanvas(args){var _ref=this;var _baseZIndex=8E5;var _args={container:null,left:0,top:0,properties:null};var _canvas=null;var _context=null;var _registeredDrawCmds={};function initialize(){helper.object.parseAttributes(_args,args);_registeredDrawCmds("SB",drawCmdScreenBlt)}function processFrame(win){let id=productId+"_canvas_"+win.hwnd;let div=document.getElementById(id);if(!div){div=document.createElement("div");div.style.position="absolute";div.style.left=win.left-
_args.left+"px";div.style.top=win.top-_args.top+"px";div.style.zIndex=_baseZIndex+win.zidx*10;div.width=win.width;div.height=win.height;div.style.width=win.width+"px";div.style.height=win.height+"px";div.style.display="inline-block";div.style.overflow="hidden";if(win.wndClass)div.setAttribute("wndClass",win.wndClass);if(!win.parent){div.mask=new Object;div.mask.color="#000";div.mask.visible=false;_canvas=document.createElement("canvas");_canvas.style.left="0px";_canvas.style.top="0px";_canvas.width=
win.width;_canvas.height=win.height;_canvas.style.position="absolute";_canvas.style.zIndex=1;_canvas.style.width=win.width;_canvas.style.height=win.height;_canvas.hwnd=win.hwnd;_canvas=div.canvas=_canvas;_context=_canvas.getContext("2d",{willReadFrequently:true});div.appendChild(_canvas)}div.id=productId+"_canvas_"+win.hwnd;var parentDiv=_args.container;if(helper.object.validate(win.parent)&&win.parent!=0){div.parent=win.parent;parentDiv=document.getElementById(productId+"_canvas_"+win.parent);if(parentDiv)parentDiv.appendChild(div);
else{div.style.display="none";div.style.visibility="hidden";_args.container.appendChild(div)}}else _args.container.appendChild(div);for(var i=_args.container.childNodes.length-1;i>=0;i--){var elem=_args.container.childNodes[i];if(elem.parent){var parentCanvas=document.getElementById(productId+"_canvas_"+elem.parent);if(parentCanvas){parentCanvas.appendChild(elem);elem.style.display="inline"}}}}if(typeof win.className!="undefined")div.className=win.className;var vw=helper.object.validate(win.width);
if(win.width==0||win.height==0){div.style.visibility="hidden";div.style.display="none"}else{if(helper.object.validate(win.left)&&(win.width==div.width&&win.height==div.height||div.width*div.height==0)){div.style.left=win.left-_args.properties.viewLeft+"px";div.style.top=win.top-_args.properties.viewTop+"px"}if(vw&&(win.width!=div.width||win.height!=div.height)||div.resizing)if(div.width*div.height==0){div.width=win.width;div.height=win.height;div.style.width=win.width+"px";div.style.height=win.height+
"px";_canvas.width=win.width;_canvas.height=win.height;_canvas.style.width=win.width+"px";_canvas.style.height=win.height+"px"}else;if(vw){if(productId!="virtualui")div.style.display="block";div.style.visibility="visible"}div.style.zIndex=_baseZIndex+win.zidx*10}return div}function getImgQueueItemWidth(){if(!this.image.data)return this.encoded.width;return this.image.data.width}function getImgQueueItemHeight(){if(!this.image.data)return this.encoded.height;return this.image.data.height}function processData(d,
i,t,x,y,w,h,sx,sy,sw,sh){if(!d){if(!sw||!sh){logError("drawImgQueueItem(): image of type "+t+", sw and sh are null for idx # "+i+", error: ");return}drawError(_context,"#800080","#FFFFFF",x,y,sw,sh);return}if(t=="img"){if(!w)w=this.getWidth();if(!h)h=this.getHeight();if(sx!=null&&sy!=null){if(!sw)sw=w;if(!sh)sh=h;_context.drawImage(d,sx,sy,sw,sh,x,y,w,h)}else _context.drawImage(d,x,y,w,h)}else if(t=="canvas")if(sx!=null&&sy!=null){if(!sw)sw=this.getWidth();if(!sh)sh=this.getHeight();_context.putImageData(d,
x-sx,y-sy,sx,sy,sw,sh)}else _context.putImageData(d,x,y);else{logError("drawImgQueueItem(): unknown image->type for idx # "+i+", error: ");return}}function drawError(context,fillStyle,strokeStyle,x,y,w,h){_context.fillStyle=fillStyle;_context.strokeStyle=strokeStyle;w-=1;h-=1;_context.beginPath();_context.rect(x,y,w,h);_context.moveTo(x,y);_context.lineTo(x+w,y+h);_context.moveTo(x,y+h);_context.lineTo(x+w,y);_context.closePath();_context.fill();_context.stroke()}function registerDrawCmds(cmd,handler){if(!_registeredDrawCmds[cmd.c])_registeredDrawCmds[cmd.c]=
handler}function processDrawCmds(cmd){if(_registeredDrawCmds[cmd.c])_registeredDrawCmds[cmd.c](cmd)}function drawCmdScreenBlt(cmd){try{_context.putImageData(_context.getImageData(cmd.sx,cmd.sy,cmd.cx,cmd.cy),cmd.x,cmd.y)}catch(e){}}initialize();Object.defineProperty(_ref,"processData",{"enumerable":true,"configurable":false,"writable":false,"value":processData});Object.defineProperty(_ref,"processDrawCmds",{"enumerable":true,"configurable":false,"writable":false,"value":processDrawCmds});Object.defineProperty(_ref,
"processFrame",{"enumerable":true,"configurable":false,"writable":false,"value":processFrame});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(!Thinfinity.Driver)Thinfinity.Driver={};Thinfinity.Driver.Canvas=DriverVideoCanvas})();
(function(){var _enumDecoder=helper.object.createEnum({"JMUXER":0,"BSD":1,"BSDWORKER":2,"TINYBSD":3,"CANVAS":4});var _eCodes=helper.object.createEnum({"NONE_PICTURE_PROCESSED":1});function DriverVideo(args){var _ref=this;var _args={"id":null,"container":null,"player":null,"methods":{"sendCmd":null,"registerCanvas":null},"events":{"keyframe":null,"processDataEcho":null,"pictureSize":null,"error":null},"decoderType":null};var _decoder=null;var _display=null;var attachHandlers=function(){};var detachHandlers=
function(){};var _paused=false;var _statusId=null;var _thresholdFlowControl=.05;var _noop=function(){};var _state={"buffer":[],"size:":null,"isHidden":false,"notified":false,"hook":false};var processH264=function(){};var _openGLShader=null;var _yuvSurfaceShader=null;var _yTexture=null;var _uTexture=null;var _vTexture=null;var _renderStateId=1;var _fps={0:35,3:60};var _smooth={"timespan":null,"lastTimespanPicture":0,"pictures":[],"run":false};var _pkt=1;var _size={width:0,height:0};var _onStartEvent=
{enabled:true,maxPictureReadyTime:3500,timeoutId:null};function initialize(){helper.object.parseAttributes(_args,args);if(typeof _args.decoderType!=="undefined"&&_enumDecoder.hasValue(_args.decoderType))_decoderType=_args.decoderType;else _decoderType=Thinfinity.Driver.OpenGLShader?_enumDecoder.TINYBSD:JH264?_enumDecoder.JMUXER:H264bsdDecoder?_enumDecoder.BSD:_enumDecoder.BSDWORKER;helper.console.warning(`Initialize Driver Video, running with ${_enumDecoder.getKey(_decoderType)} decoder `,arguments);
initializeMethods();if(!_args.container)_args.container=document.body;if(initializePlayer()){initializeH264();attachHandlers();Thinfinity.TabFocusHook.on("focus",tabFocus).on("blur",tabBlur);_state.hook=_state.isHidden=Thinfinity.TabFocusHook.isHidden||!document.hasFocus();setTimeout(removeFocusHandlers,6E4)}}function initializePlayer(){var initialized=false;try{var player=null;if(typeof _args.player==="string")player=document.getElementById(_args.player);else player=_args.player;if(!(player instanceof
HTMLVideoElement)){var id=typeof _args.player==="string"?_args.player:"player";switch(_decoderType){case _enumDecoder.BSD:case _enumDecoder.BSDWORKER:player=document.createElement("canvas");player.id=id;player.style.position="absolute";player.style.top="0px";break;case _enumDecoder.JMUXER:player=document.createElement("video");player.autoplay=true;player.muted=true;player.id=id;player.setAttribute("muted","true");player.setAttribute("autoplay","true");player.setAttribute("controls","false");player.controls=
false;player.style.position="absolute";break;case _enumDecoder.TINYBSD:_openGLShader=new Thinfinity.Driver.OpenGLShader;player=document.createElement("canvas");player.id=id;player.style.position="absolute";player.style.top="0px";const gl=player.getContext("webgl",{preserveDrawingBuffer:true});_yuvSurfaceShader=_openGLShader.YUVSurfaceShader_YUVSurfaceShader.create(gl);_yTexture=_openGLShader.Texture.create(gl,gl.LUMINANCE);_uTexture=_openGLShader.Texture.create(gl,gl.LUMINANCE);_vTexture=_openGLShader.Texture.create(gl,
gl.LUMINANCE);break}}_args.methods.registerCanvas(player);_args.container.appendChild(player);_state.size=helper.size.get(player);_args.player=player;initialized=true}catch(error){var msg="Cannot initialize H264 video. "+error.message||error;helper.console.warning(msg,arguments);_args.events.error(msg);initialized=false}return initialized}function decodeLoop(){if(status===_decoder.NO_INPUT)return;status=_decoder.decode();setTimeout(decodeLoop,0)}function checkSize(w,h){if(_args.events.pictureSize)if(_size.width!=
w||_size.height!=h){_size.width=w;_size.height=h;_args.events.pictureSize(w,h)}}function initializeH264(){var _events={"keyframe":null,"error":null};helper.object.parseAttributes(_events,_args.events);let origKeyframeEvt=_events.keyframe;if(origKeyframeEvt)_events.keyframe=function(){if(_onStartEvent.timeoutId)clearTimeout(_onStartEvent.timeoutId);_onStartEvent.timeoutId=null;origKeyframeEvt.apply(null,arguments)};else _events.keyframe=function(){if(_onStartEvent.timeoutId)clearTimeout(_onStartEvent.timeoutId);
_onStartEvent.timeoutId=null};let processWorkerMessage=null;switch(_decoderType){case _enumDecoder.JMUXER:attachHandlers=function(){attachVideoHandlers(player)};detachHandlers=function(){detachVideoHandler(_args.player)};_decoder=new JH264({node:_args.player,mode:"video",flushingTime:0,fps:_fps[_enumDecoder.JMUXER],clearBuffer:true,debug:false,events:_events});processH264=function(chunk){if(_state.hook){_state.buffer.push(chunk);pauseHandler()}else _decoder.feed({"video":chunk,"duration":0})};break;
case _enumDecoder.BSD:_decoder=new H264bsdDecoder(Module);processH264=function(chunk){_decoder.queueInput((new Uint8Array(chunk)).buffer)};decodeLoop();attachHandlers=attachCanvasHandler;detachHandlers=detachCanvasHandler;_display=new H264bsdCanvas(_args.player);break;case _enumDecoder.BSDWORKER:_decoder=new Worker(helper.url.parseUrl(location.href).toUrl("-vp-a")+"common/plugin/h264bsd/h264bsd_worker.min.js");processH264=function(chunk){var copy=new Uint8Array(chunk);_decoder.postMessage({"type":"queueInput",
"data":copy.buffer},[copy.buffer])};processWorkerMessage=function(e){var message=e.data;if(!message.hasOwnProperty("type"))return;switch(message.type){case "pictureParams":return;croppingParams=message.croppingParams;if(croppingParams===null){_args.player.width=message.width;_args.player.height=message.height}else{_args.player.width=croppingParams.width;_args.player.height=croppingParams.height}break;case "noInput":break;case "pictureReady":_display.drawNextOutputPicture(message.width,message.height,
message.croppingParams,new Uint8Array(message.data));break;case "decoderReady":helper.console.log("Decoder ready");break;case "decodeError":helper.console.warning("Decoder error");break}};attachHandlers=function(){_decoder.onmessage=processWorkerMessage};detachHandlers=function(){processWorkerMessage=_decoder.onmessage=null};_display=new H264bsdCanvas(_args.player);break;case _enumDecoder.TINYBSD:_smooth.timespan=1E3/_fps[_decoderType];var brokerPath=helper.url.parseUrl(location.href).toUrl("-vp-a-r");
if(Thinfinity.global.variables.basePath!=""&&Thinfinity.global.variables.basePath!="/")brokerPath=brokerPath.substring(0,brokerPath.length-1)+Thinfinity.global.variables.basePath;_decoder=new Worker(brokerPath+"common/plugin/tinyh264/tinyh264.worker.js");processH264=function(chunk){var copy=new Uint8Array(chunk);_decoder.postMessage({"type":"decode","data":copy.buffer,"offset":copy.byteOffset,"length":copy.byteLength,"renderStateId":_renderStateId,"monitorId":_args.id,"pkt":_pkt},[copy.buffer]);_pkt++};
processWorkerMessage=function(e){var message=e.data;if(_args.events.processDataEcho)_args.events.processDataEcho({pkt:_pkt,p:message.pkt});if(!message.hasOwnProperty("type"))return;switch(message.type){case "pictureParams":break;case "noInput":break;case "pictureReady":if(_onStartEvent.timeoutId)clearTimeout(_onStartEvent.timeoutId);_onStartEvent.timeoutId=null;var d=(new Date).getTime();_smooth.lastTimespanPicture+=_smooth.timespan;if(_smooth.lastTimespanPicture<d)_smooth.lastTimespanPicture=d-1;
_smooth.pictures.push({"t":parseInt(_smooth.lastTimespanPicture,10),"m":message});break;case "decoderReady":helper.console.log("Decoder ready");_smooth.lastTimespanPicture=(new Date).getTime();if(!_smooth.run)drawSmoothPictures();break;case "decodeError":helper.console.warning("Decoder error");break;default:helper.console.warning(`Unknown type: ${message.type}`);break}};attachHandlers=function(){_decoder.onmessage=processWorkerMessage};detachHandlers=function(){processWorkerMessage=_decoder.onmessage=
null};break}}function findLastIndexOf(t,l){let b=true;let i=0;let idx=-1;while(b){if(i<l&&_smooth.pictures[i].t<=t)idx=i;else b=false;i++}return idx}function animationFrameCallback(){var len=_smooth.pictures.length;var d=Date.now();if(len>0&&_smooth.pictures[0].t<=d){let idx=len>0?len>1?findLastIndexOf(d,len):0:-1;if(len>1&&idx+1<len)_smooth.pictures=_smooth.pictures.slice(idx,len);let item=_smooth.pictures.shift();openGL_drawPicture(item.m)}if(_smooth.run)helper.animationFrame.request(animationFrameCallback)}
function drawSmoothPictures(){_smooth.run=true;helper.animationFrame.request(animationFrameCallback)}function stopSmoothPictures(){_smooth.run=false}function openGL_drawPicture(message){let height=message.height;let width=message.width;let buffer=new Uint8Array(message.data);const stride=width;const sourceWidth=_args.player.width;const sourceHeight=_args.player.height;const maxXTexCoord=sourceWidth/width;const maxYTexCoord=sourceHeight/height;const lumaSize=stride*height;const chromaSize=lumaSize>>
2;const yBuffer=buffer.subarray(0,lumaSize);const uBuffer=buffer.subarray(lumaSize,lumaSize+chromaSize);const vBuffer=buffer.subarray(lumaSize+chromaSize,lumaSize+2*chromaSize);const chromaHeight=height>>1;const chromaStride=stride>>1;_yTexture.image2dBuffer(yBuffer,stride,height);_uTexture.image2dBuffer(uBuffer,chromaStride,chromaHeight);_vTexture.image2dBuffer(vBuffer,chromaStride,chromaHeight);_yuvSurfaceShader.setTexture(_yTexture,_uTexture,_vTexture);_yuvSurfaceShader.updateShaderData({w:_args.player.width,
h:_args.player.height},{maxXTexCoord,maxYTexCoord});_yuvSurfaceShader.draw()}function initializeMethods(){for(var name in _args.methods)if(!_args.methods[name]||!_args.methods[name]instanceof Function)_args.methods[name]=_noop}function attachVideoHandlers(elem){helper.dom.addEvent(elem,"pause",pauseHandler,false);helper.dom.addEvent(elem,"play",resumeHandler,false);helper.dom.addEvent(elem,"timeupdate",timeupdateHandler,false)}function detachVideoHandler(elem){helper.dom.removeEvent(elem,"pause",
pauseHandler,false);helper.dom.removeEvent(elem,"play",resumeHandler,false);helper.dom.removeEvent(elem,"timeupdate",timeupdateHandler,false)}function attachCanvasHandler(){_decoder.onPictureReady=onPictureReady;_decoder.onHeadersReady=onHeadersReady}function detachCanvasHandler(){_decoder.onPictureReady=null;_decoder.onHeadersReady=null;onPictureReady=_noop;onHeadersReady=_noop}function onPictureReady(){if(_onStartEvent.timeoutId)clearTimeout(_onStartEvent.timeoutId);_onStartEvent.timeoutId=null;
var width=_decoder.outputPictureWidth();var height=_decoder.outputPictureHeight();var croppingParams=_decoder.croppingParams();var data=_decoder.nextOutputPicture();_display.drawNextOutputPicture(width,height,croppingParams,data);checkSize(width,height)}function onHeadersReady(){}function processData(arrayView){let _w=arrayView[0]<<8|arrayView[1];let _h=arrayView[2]<<8|arrayView[3];if(_args.player.width!==_w||_args.player.height!==_h){_args.player.width=_w;_args.player.height=_h;checkSize(_w,_h);
helper.console.log(`Frame size updated, new size: ${_w}x${_h}`,arguments);if(_onStartEvent.enabled){_onStartEvent.timeoutId=setTimeout(()=>{helper.console.warning(`None image picture was processed, firing event`);_args.events.error({code:_eCodes.NONE_PICTURE_PROCESSED,message:consts.h264NonePictureProcessed})},_onStartEvent.maxPictureReadyTime);_onStartEvent.enabled=false}}processH264(arrayView.subarray(4))}function tabFocus(){if(_state.buffer)if(_state.buffer.length>0)setTimeout(function(){_state.hook=
false;_state.buffer.forEach(function(chunk){processH264(chunk)});_state.buffer=null;removeFocusHandlers();resumeHandler()},100)}function tabBlur(){if(_state.isHidden!=null){var s=helper.size.get(_args.player);_state.isHidden=Thinfinity.TabFocusHook.isHidden;if(_state.isHidden&&_state.buffer&&_state.buffer.length==0&&_state.size.width===s.width&&_state.size.height===s.height)_state.hook=true}else removeFocusHandlers()}function removeFocusHandlers(){if(_state.buffer===null||_state.buffer.length==0)Thinfinity.TabFocusHook.off("focus",
tabFocus).off("blur",tabBlur)}function pauseHandler(e){if(!_paused||arguments[1]===true){_paused=true;_args.methods.sendCmd("cmd=video&subcmd=pause")}}function resumeHandler(e){if(_paused||arguments[1]===true){_paused=false;_args.methods.sendCmd("cmd=video&subcmd=resume");if(_decoder.mediaSource.duration.toString()!="NaN"&&_decoder.mediaSource.sourceBuffers.length>0&&_decoder.mediaSource.sourceBuffers[0].buffered.length>0)_args.player.currentTime=_decoder.mediaSource.sourceBuffers[0].buffered.end(0)}}
function timeupdateHandler(e){if(_args.player&&_decoder&&_decoder.mediaSource.sourceBuffers.length>0&&_decoder.mediaSource.sourceBuffers[0].buffered.length>0&&_decoder.mediaSource.sourceBuffers[0].buffered.end(0)-_args.player.currentTime>_thresholdFlowControl){_args.methods.sendCmd("cmd=video&subcmd=fc&bufferTime="+(_decoder.mediaSource.sourceBuffers[0].buffered.end(0)-_args.player.currentTime).toString());helper.console.log(helper.string.format("Difference: {0}",_decoder.mediaSource.sourceBuffers[0].buffered.end(0)-
_args.player.currentTime),arguments)}}function dispose(){if(_decoder.destroy)_decoder.destroy();clearInterval(_statusId);detachHandlers();stopSmoothPictures();_decoder=null}initialize();Object.defineProperty(_ref,"processH264",{"enumerable":true,"configurable":false,"writable":false,"value":processH264});Object.defineProperty(_ref,"processData",{"enumerable":true,"configurable":false,"writable":false,"value":processData});Object.defineProperty(_ref,"decoderType",{"enumerable":true,"configurable":false,
"get":function(){return _decoderType}});Object.defineProperty(_ref,"video",{"enumerable":true,"configurable":false,"writable":false,"value":_args.player});Object.defineProperty(_ref,"pause",{"enumerable":true,"configurable":false,"writable":false,"value":pauseHandler});Object.defineProperty(_ref,"resume",{"enumerable":true,"configurable":false,"writable":false,"value":resumeHandler});Object.defineProperty(_ref,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":dispose});return _ref}
try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(Thinfinity.Driver===undefined)Thinfinity.Driver={};Thinfinity.Driver.Video=DriverVideo;Object.defineProperty(Thinfinity.Driver.Video,"DECODER_TYPES",{configurable:false,enumerable:false,get:function(){return _enumDecoder}});Object.defineProperty(Thinfinity.Driver.Video,"ERROR_CODE",{configurable:false,enumerable:false,get:function(){return _eCodes}})})();
(function(){var _MAC_CMD={"RELEASED":0,"PRESSED":1,"SENT":2};Object.freeze(_MAC_CMD);function DKeyboard(args){var _ref=this;var _args={parentElement:null,events:{keyboardEvent:null,hook:null},properties:null,methods:{sendKey:null,inputAllowed:null,sendText:null},clipboard:false};var _IMEKeyCode=229;var _IMEKeyPressed=false;var _IMEKeyboardAvailable=["virtualui","thinrdp"].indexOf(productId)!==-1;var _IMEKeyExceptions="\u00b4\u00a8`^";var _caret=null;var _currentEvent=null;var _forceKeyPress=false;
var _macCmd=0;var _lastCharCode=0;var _firefoxAltGr=false;var _MAC_Firefox_CMD={isPressed:false,isCmd:false};var fireEvent=null;var _te={};var _heapKeys={16:0,17:0,18:0,93:0};var _pressedKeys=[];var _altKeyPressed=false;var _noKeyDown=[{"key":44,"name":"PRINTSCREEN"}];var _lastKeyCode=null;var _kbdInput=null;var _allowToSwitchApps=false;function initialize(){helper.object.parseAttributes(_args,args);if(!_args.parentElement)_args.parentElement=document.body;fireEvent=(new Thinfinity.Events({"owner":_te,
"events":_args.events})).fireEvent;createInputElement()}function createInputElement(){if(agentInfo.isMac){_kbdInput=helper.dom.appendJsonElement({parentElement:_args.parentElement,type:"textarea",attributes:{id:"kbdMacInput",name:"kbdMacInput",tabindex:"0",autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false",style:"color: #FFF; position: fixed; left: -2000px; top: 5px; overflow:hidden; width: 20px; height: 20px;"},content:"XXXX"});helper.dom.addEvent(_kbdInput,"focus",function(e){fireEvent("focus",
e)});helper.dom.addEvent(_kbdInput,"blur",function(e){e.mac=true;blur(e)});helper.dom.addEvent(_kbdInput,"keydown",macKeydown);helper.dom.addEvent(_kbdInput,"keypress",macKeypress);helper.dom.addEvent(_kbdInput,"keyup",macKeyup);if(_IMEKeyboardAvailable){helper.dom.addEvent(_kbdInput,"compositionstart",compositionStart);helper.dom.addEvent(_kbdInput,"compositionupdate",compositionUpdate);helper.dom.addEvent(_kbdInput,"compositionend",compositionEnd)}_kbdInput.focus()}else{var attributes={"id":"kbdWindowsInput",
"value":"","tabindex":"0","autocapitalize":"off","autocorrect":"off","autocomplete":"off","spellcheck":"false","style":"color: #000; fontSize:12px; position: fixed; left: -2000px; top: 5px; overflow:hidden; width: 20px; height: 20px;outline:1px;"};try{if(window.top.document)attributes.autofocus=true}catch(error){}_kbdInput=helper.dom.appendJsonElement({"parentElement":_args.parentElement,"type":"textarea","attributes":function(){var a={"id":"kbdWindowsInput","value":"","tabindex":"0","autocapitalize":"off",
"autocorrect":"off","autocomplete":"off","spellcheck":"false","style":"color: #000; fontSize:12px; position: fixed; left: -2000px; top: 5px; overflow:hidden; width: 20px; height: 20px;outline:1px;"};if(attributes.autofocus&&!_args.properties.isCrossDomain)a.autofocus="autofocus";return a}(),"events":{"focus":function(e){fireEvent("focus",{...e,...{mac:false}})},"blur":function(e){e.mac=false;blur(e)}}});helper.dom.addEvent(_kbdInput,"keydown",keydown);helper.dom.addEvent(_kbdInput,"keypress",keypress);
helper.dom.addEvent(_kbdInput,"keyup",keyup);if(_IMEKeyboardAvailable){helper.dom.addEvent(_kbdInput,"compositionstart",compositionStart);helper.dom.addEvent(_kbdInput,"compositionupdate",compositionUpdate);helper.dom.addEvent(_kbdInput,"compositionend",compositionEnd)}}}function noDetectedkeyDown(kc){return _noKeyDown.find(function(item){return kc===item.key})}function isIMEKey(e){return(e.which||e.keyCode)==_IMEKeyCode}function setCaret(cmd){if(_args.properties.hookKeyboard&&_kbdInput){_kbdInput.focus();
_caret=cmd}}function eventIndex(list,kcode){for(var k=0;k<list.length;k++)if(kcode==list[k].keyCode)return k;return-1}function containsKey(kcode){var result=false;for(var i=0;i<_pressedKeys.length;i++)if(_pressedKeys[i].keyCode==kcode){result=true;break}return result}function popEvent(kcode){var resultEvent=null;var EvIdx=eventIndex(_pressedKeys,kcode);if(EvIdx>-1){resultEvent=_pressedKeys[EvIdx];_pressedKeys.splice(EvIdx,1);popEvent(kcode)}return resultEvent}function isPrintableKey(keyCode){return keyCode>=
33&&keyCode<=126||keyCode>=193&&keyCode<=248}function isFunctionKey(keyCode){return keyCode>=112&&keyCode<=123||keyCode>=33&&keyCode<=40||keyCode>=45&&keyCode<=46||keyCode>=16&&keyCode<=20||keyCode>=91&&keyCode<=93||keyCode==13||keyCode==9||keyCode==8||keyCode==27||keyCode==144||keyCode==12||keyCode==224||keyCode==32||keyCode==145}function isAphaNumericKey(keyCode){return keyCode>=48&&keyCode<=57||keyCode>=65&&keyCode<=90||keyCode>=97&&keyCode<=122}function isControlCharacter(keyCode){return keyCode>=
0&&keyCode<=31}function isEditFunction(currentEvent){return currentEvent.ctrlKey&&(currentEvent.keyCode==67||currentEvent.keyCode==86||currentEvent.keyCode==88)&&_args.clipboard?.enable}function isNumPadKey(keyCode){var numBloq=agentInfo.isMac?12:144;switch(keyCode){case numBloq:case 111:case 106:case 109:case 107:return true;break;default:return false}}function getKeyCode(e){var kcode=e.which||e.keyCode;if(!(productId=="thinrdp"&&!_args.properties.kbdUnicode))if(kcode>=96&&kcode<=105)kcode-=48;if(agentInfo.isFirefox==
true)if(typeof e.key!="undefined"&&e.key.toLowerCase()=="dead")kcode=0;else if(kcode==0&&e.key!=undefined)kcode=e.key.charCodeAt();return kcode}function getCharCode(e){var cc=0;if(e.key!=undefined&&e.key.toLowerCase()!="dead"){var _cc=e.key.charCodeAt();if(e.keyCode==0||e.keyCode!=_cc||_cc>=58&&_cc<=63)cc=_cc}return cc}function getKeyEvent(e){var keybinfo={"type":e.type,"altKey":e.altKey,"ctrlKey":e.ctrlKey,"charCode":e.charCode,"keyCode":e.keyCode,"which":e.which,"shiftKey":e.shiftKey,"metaKey":e.metaKey};
if(_args.properties.kbdLogKeys===true)if(agentInfo.isMac);try{fireEvent("keyboardEvent",keybinfo)}catch(error){helper.console.warning("'keyboardEvent' calling attached method fail. message: "+error.message,error,arguments)}}function buildKeyEvent(e){var modificators=null;if(e.getModifierState)modificators={"alt":e.getModifierState("Alt"),"graph":e.getModifierState("AltGraph"),"ctrl":e.getModifierState("Control"),"meta":e.getModifierState("Meta")||e.getModifierState("OS"),"shift":e.getModifierState("Shift"),
"capsLock":e.getModifierState("CapsLock"),"scrollLock":e.getModifierState("Scroll"),"numLock":e.getModifierState("NumLock"),"location":e.location};else modificators={"alt":e.altKey,"graph":e.altGraphKey,"ctrl":e.ctrlKey,"meta":e.metaKey,"shift":e.shiftKey,"location":e.location};var buildKeyEventResult={"keyCode":getKeyCode(e),"timeStamp":e.timeStamp,"mod":modificators};if(agentInfo.isFirefox==true&&!_args.properties.kbdUnicode&&!isFunctionKey(e.keyCode))buildKeyEventResult["charCode"]=getCharCode(e);
buildKeyEventResult.isIMEKey=isIMEKey(e);return buildKeyEventResult}function loadKeyData(e){var charCode=agentInfo.isOpera?e.which:agentInfo.isFirefox&&e.charCode==0&&e.key!=undefined?e.key.charCodeAt():e.charCode;var IsZero=(e.keyCode||0)==0&&(charCode||0)==0;_forceKeyPress=!(isFunctionKey(e.keyCode)&&e.keyCode!=32)&&!e.altKey&&!e.ctrlKey;if(IsZero)return;if(_forceKeyPress||e.type=="keydown"){if(e.type=="keydown"&&_currentEvent&&!_forceKeyPress)popEvent(_currentEvent.keyCode);if(e.type=="keydown")_currentEvent=
null;var currentEvent=buildKeyEvent(e);if(e.type=="keydown"||e.type=="keypress"&&!_currentEvent){if(!containsKey(currentEvent.keyCode)){currentEvent.type=e.type;_pressedKeys.push(currentEvent)}if(e.type=="keypress"&&!_currentEvent)_currentEvent=currentEvent}if((isFunctionKey(e.keyCode)||(e.altKey||e.ctrlKey)&&e.altKey!=e.ctrlKey)&&!_forceKeyPress||!_args.properties.kbdUnicode){if(!isEditFunction(e)){sendKey(currentEvent,"down");e.stopPropagation();e.preventDefault()}}else if(e.type=="keydown"||!_currentEvent){_currentEvent=
currentEvent;_currentEvent.waitForKeyPress=true}}if(e.type=="keypress"&&_currentEvent){if(productId=="ZSC"&&isNumPadKey(_currentEvent.keyCode)==true)charCode=0;_currentEvent.charCode=charCode;_currentEvent.type=e.type;sendKey(_currentEvent,"down");_currentEvent.waitForKeyPress=false;e.stopPropagation();e.preventDefault();_forceKeyPress=false;_lastCharCode=charCode}else if(e.type=="keydown"){_forceKeyPress=(e.keyCode||0)==0&&(charCode||0)==0||(_lastCharCode||0)==0;_lastKeyCode=e.keyCode;_lastCharCode=
charCode}else;}function releaseKeyData(e){if(_currentEvent&&e.keyCode==_currentEvent.keyCode&&_currentEvent.waitForKeyPress){if(productId=="virtualui"&&_currentEvent.type=="keydown"&&isAphaNumericKey(e.keyCode)){sendKey(_currentEvent,"down");sendKey(_currentEvent,"up")}else;popEvent(e.keyCode);return}var keyDownEvent=popEvent(getKeyCode(e));var _sendKeyup=true;if(!keyDownEvent){_sendKeyup=false;if(noDetectedkeyDown(e.keyCode)){keyDownEvent=e;_sendKeyup=true;sendKey(keyDownEvent,"down")}}if(_sendKeyup){sendKey(keyDownEvent,
"up");e.stopPropagation();e.preventDefault()}}function sendKey(kevent,action){if(_args.properties.onlyKeyCode)_args.methods.sendKey(kevent.keyCode||0,0,action,kevent.mod.location);else _args.methods.sendKey(kevent.keyCode||0,kevent.charCode||0,action,(kevent.mod||kevent)["location"])}function keydown(e){if(_args.methods.inputAllowed(e)){if(_IMEKeyboardAvailable){if(!_IMEKeyPressed)_IMEKeyPressed=isIMEKey(e);if(_IMEKeyPressed)return true}loadKeyData(e);getKeyEvent(e);if(e.keyCode==18){_heapKeys["18"]++;
if(agentInfo.isFirefox&&e.ctrlKey)_firefoxAltGr=true}if(e.keyCode==32&&e.altKey)blur(e)}}function keypress(e){if(_args.methods.inputAllowed(e)){if(_IMEKeyboardAvailable&&_IMEKeyPressed)return true;loadKeyData(e);getKeyEvent(e)}}function keyup(e){if(_args.methods.inputAllowed(e)){if(_IMEKeyboardAvailable&&_IMEKeyPressed)return true;if(_allowToSwitchApps==true&&(e.keyCode==37||e.keyCode==39)&&e.ctrlKey==true&&e.altKey==true){var value="next";if(e.keyCode==37)value="previous";changeAppFocus(value);e.preventDefault();
e.stopPropagation();return}releaseKeyData(e);_lastKeyCode=0;getKeyEvent(e);if(e.keyCode==18)_heapKeys["18"]--;if(_firefoxAltGr&&[17,18].indexOf(e.keyCode)!=-1&&_heapKeys["18"]>0){_firefoxAltGr=false;_heapKeys["18"]--;var keyUpEvent=popEvent(18);sendKey(keyUpEvent,"up")}}}function compositionStart(e){if(_IMEKeyPressed||agentInfo.isFirefox&&agentInfo.isWindows||agentInfo.isMac){if(!agentInfo.isMSIE)_kbdInput.value="";if(agentInfo.isMac)_IMEKeyPressed=true;if(_caret){var pos=_caret.r;var size=_caret.rc;
helper.style.add(_kbdInput,{"visibility":"visible","zIndex":9999999,"left":pos.l+3+"px","top":pos.t+24+"px","width":"150px","height":20+"px","color":"#000"});size=pos=null}else helper.style.add(_kbdInput,{"visibility":"visible","zIndex":9999999,"left":"0px","top":"0px","width":"150px","height":20+"px","color":"#000"})}}function compositionUpdate(e){if(agentInfo.isMac&&e.data.length==1&&_IMEKeyExceptions.indexOf(e.data)!=-1)helper.style.add(_kbdInput,{"visibility":"visible","zIndex":0,"left":"-2000px",
"color":"#fff"})}function compositionEnd(e){if(_IMEKeyPressed||agentInfo.isFirefox&&agentInfo.isWindows){helper.style.add(_kbdInput,{"visibility":"visible","zIndex":0,"left":"-2000px","color":"#fff"});_args.methods.sendText(e.data);_kbdInput.value="";if(agentInfo.isMac||agentInfo.isWindows&&agentInfo.isMSIE)setTimeout(function(){if(agentInfo.isMac)_kbdInput.value="";_IMEKeyPressed=false},50);else _IMEKeyPressed=false;_kbdInput.focus();if(agentInfo.isMSIE){_kbdInput.parentElement.removeChild(_kbdInput);
fireEvent("onHook",false);_kbdInput.focus()}}}function blur(e){for(var keyCode in _heapKeys)_heapKeys[keyCode]=0;for(var i=0;i<_pressedKeys.length;i++){var pk=_pressedKeys[i];_args.methods.sendKey(pk.keyCode,pk.charCode||0,"up",pk.mod?pk.mod.location:0)}_pressedKeys=[];fireEvent("blur",e)}function focus(e){_heapKeys["18"]=0}function isFirefoxCmdKey(e){var kcode=getKeyCode(e);if(_MAC_Firefox_CMD.isPressed==true&&(kcode==67||kcode==86||kcode==88||e.charCode==99||e.charCode==118||e.charCode==120))return true;
else return false}function updateMacCmd(value){_macCmd=value}function macKeydown(e){if(_args.methods.inputAllowed(e)){var eloc=e.originalEvent?e.originalEvent.keyLocation||e.originalEvent.location:0;if(_IMEKeyboardAvailable){if(!_IMEKeyPressed||e.keyCode>=32&&e.keyCode<=126)_IMEKeyPressed=isIMEKey(e);if(_IMEKeyPressed)return true}var eloc=e.originalEvent?e.originalEvent.keyLocation||e.originalEvent.location:0;if(e.metaKey==false&&_macCmd!=_MAC_CMD.RELEASED){_macCmd=_MAC_CMD.RELEASED;_args.methods.sendKey(91,
0,"up",eloc)}var kcode=getKeyCode(e);if(kcode==93||agentInfo.isFirefox==true&&kcode==224&&e.key=="Meta"){_MAC_Firefox_CMD.isPressed=agentInfo.isFirefox?true:false;kcode=18}if(agentInfo.isFirefox==true)if(isFirefoxCmdKey(e)==true){_MAC_Firefox_CMD.isCmd=true;return}else{_MAC_Firefox_CMD.isCmd=false;if(_MAC_Firefox_CMD.isPressed==true&&e.keyCode!=224){_heapKeys["18"]++;_args.methods.sendKey(18,0,"down",eloc)}}if(isFunctionKey(kcode)||(e.altKey||e.ctrlKey)&&e.altKey!=e.ctrlKey)if(kcode==91||kcode==93){updateMacCmd(_MAC_CMD.PRESSED);
_lastKeyCode=kcode;return}else{if(kcode==18&&e.keyCode!=93&&e.keyCode!=224&&e.key!="Meta"){_heapKeys["17"]++;_args.methods.sendKey(17,0,"down",eloc);_heapKeys["18"]++;_args.methods.sendKey(18,0,"down",eloc)}else if(kcode>=16&&kcode<=18&&agentInfo.isFirefox==false){_heapKeys[kcode.toString()]++;if(kcode==18&&agentInfo.isFirefox==false)_args.methods.sendKey(kcode,0,"down",eloc)}else if(kcode==9&&e.altKey==true){_args.methods.sendKey(18,0,"down",eloc);_args.methods.sendKey(9,0,"down",eloc);_args.methods.sendKey(9,
0,"up",eloc);_args.methods.sendKey(18,0,"up",eloc);e.stopPropagation();e.preventDefault();return false}if(_heapKeys["18"]>0&&_args.properties.kbdUnicode==true)_lastKeyCode=kcode;else if(kcode!=18){_args.methods.sendKey(kcode,0,"down",eloc);if(!(productId=="thinrdp"&&!_args.properties.kbdUnicode&&e.altKey&&[219,221].indexOf(kcode)!=-1)){e.stopPropagation();e.preventDefault()}}}else if(_lastKeyCode==18||_heapKeys["18"]>0){_args.methods.sendKey(kcode,0,"down",eloc);if(agentInfo.isFirefox==false)_args.methods.sendKey(kcode,
0,"up",eloc);e.stopPropagation();e.preventDefault()}if(!e.altKey)_lastKeyCode=kcode;_altKeyPressed=e.altKey;if(!isMacModKey(e)){var elem=document.getElementById("kbdMacInput");elem.IMEPressed=isIMEKey(e)&&!elem.IMEPressed}getKeyEvent(e)}}function isMacModKey(e){return agentInfo.isMac&&(e.keyCode==16||e.keyCode==17||e.keyCode==18)}function macKeypress(e){if(_args.methods.inputAllowed(e)){var eloc=e.originalEvent?e.originalEvent.keyLocation||e.originalEvent.location:0;if(_IMEKeyboardAvailable&&_IMEKeyPressed)return true;
if(_macCmd!=_MAC_CMD.RELEASED&&agentInfo.isMac==true&&(agentInfo.isFirefox==true||agentInfo.isSafari==true))if(e.keyCode==99||e.keyCode==120||e.keyCode==118)return true;else{e.stopPropagation();e.preventDefault();return false}if(agentInfo.isFirefox==true&&isFirefoxCmdKey(e)==true)return;var eloc=e.originalEvent?e.originalEvent.keyLocation||e.originalEvent.location:0;var charCode=agentInfo.isOpera?e.which:e.charCode;var kcode=getKeyCode(e);if(_macCmd==_MAC_CMD.PRESSED)if(kcode!=67&&kcode!=86&&kcode!=
88){_args.methods.sendKey(_lastKeyCode,0,"down",eloc);updateMacCmd(_MAC_CMD.SENT);if(_args.properties.onlyKeyCode)_args.methods.sendKey(_lastKeyCode,0,"down",eloc);else _args.methods.sendKey(_lastKeyCode,charCode,"down",eloc)}else updateMacCmd(_MAC_CMD.RELEASED);else if(!e.altKey&&!_altKeyPressed)if(kcode!=0&&isFunctionKey(_lastKeyCode)||e.ctrlKey){e.stopPropagation();e.preventDefault();getKeyEvent(e);return}if(kcode>=16&&kcode<=18)_heapKeys[kcode.toString()]++;if(_args.properties.onlyKeyCode)_args.methods.sendKey(_lastKeyCode,
0,"down",eloc);else{if(productId=="ZSC"&&isNumPadKey(_lastKeyCode)==true)charCode=0;_lastCharCode=charCode;_pressedKeys.push({"keyCode":_lastKeyCode,"charCode":charCode});_args.methods.sendKey(_lastKeyCode,charCode,"down",eloc)}e.stopPropagation();e.preventDefault();getKeyEvent(e)}}function macKeyup(e){function resetInput(elem){elem.value="XXXX";if(elem.setSelectionRange)elem.setSelectionRange(0,elem.value.length);else{var r=elem.createTextRange();r.collapse(true);r.moveEnd("character",0);r.moveStart("character",
elem.value.length);r.select()}}if(_args.methods.inputAllowed(e)){var eloc=e.originalEvent?e.originalEvent.keyLocation||e.originalEvent.location:0;if(_IMEKeyboardAvailable&&_IMEKeyPressed)return true;var keyCode=e.keyCode;var kcode=getKeyCode(e);if(keyCode==93||agentInfo.isFirefox==true&&kcode==224&&e.key=="Meta"){keyCode=18;_MAC_Firefox_CMD.isPressed=false;if(_MAC_Firefox_CMD.isCmd==true){_MAC_Firefox_CMD.isCmd=false;_heapKeys={};return}}if(_allowToSwitchApps==true&&(e.keyCode==37||e.keyCode==39)&&
e.ctrlKey==true&&e.altKey==true){var value="next";if(e.keyCode==37)value="previous";changeAppFocus(value);e.preventDefault();e.stopPropagation();return}var eloc=e.originalEvent?e.originalEvent.keyLocation||e.originalEvent.location:0;if(keyCode==91||keyCode==93){if(_macCmd==_MAC_CMD.PRESSED&&_lastKeyCode==keyCode){_args.methods.sendKey(keyCode,0,"down",eloc);_args.methods.sendKey(keyCode,0,"up",eloc)}else if(_macCmd>=_MAC_CMD.PRESSED)_args.methods.sendKey(keyCode,0,"up",eloc);updateMacCmd(_MAC_CMD.RELEASED)}else if(keyCode==
18&&e.keyCode!=93&&(e.keyCode!=224&&e.key!="Meta")){if(_heapKeys[keyCode.toString()]<=0){_args.methods.sendKey(17,0,"down",eloc);_heapKeys["17"]++;_args.methods.sendKey(keyCode,0,"down",eloc);_heapKeys[keyCode.toString()]++}for(var k=0;k<_heapKeys[keyCode.toString()];k++){_args.methods.sendKey(keyCode,0,"up",eloc);_args.methods.sendKey(17,0,"up",eloc)}_heapKeys["17"]=0;_heapKeys[keyCode.toString()]=0;_lastKeyCode=0}else if(keyCode>=16&&keyCode<=18){if(_heapKeys[keyCode.toString()]<=0){_args.methods.sendKey(keyCode,
0,"down",eloc);_heapKeys[keyCode.toString()]++}for(var k=0;k<_heapKeys[keyCode.toString()];k++)_args.methods.sendKey(keyCode,0,"up",eloc);_heapKeys[keyCode.toString()]=0}else if(this.value!="XXXX"&&!this.IMEPressed){var str=this.value.replace("XXXX","");resetInput(this);for(var i=0;i<str.length;++i){key=str.charCodeAt(i);_args.methods.sendKey(0,key,"down",eloc);_args.methods.sendKey(0,key,"up",eloc);if(_args.properties.kbdLogKeys===true)logDebug("sendkey down and up : "+key+" ("+key+") - IMEPressed : "+
this.IMEPressed)}_lastKeyCode=0}else{_altKeyPressed=false;if(_lastKeyCode==18&&kcode!=18){_heapKeys[18]--;_args.methods.sendKey(18,0,"up",eloc)}else if(e.altKey)resetInput(this);var pEvent=popEvent(kcode);if(helper.object.existsPath(pEvent,"charCode")==true)_lastCharCode=pEvent.charCode;else _lastCharCode=0;if(pEvent!=null||!(_IMEKeyCode==_lastKeyCode)&&kcode!=0)_args.methods.sendKey(kcode,_lastCharCode,"up",eloc);else helper.console.log(helper.string.format("Missing keyup: {0}, lastCode: {1}",kcode,
_lastCharCode),arguments);_lastKeyCode=0;_lastCharCode=0}e.stopPropagation();e.preventDefault();getKeyEvent(e)}}function setSelectionRange(){if(_kbdInput){if(_kbdInput.value=="")_kbdInput.value="XXXX";if(_kbdInput.setSelectionRange)_kbdInput.setSelectionRange(0,_kbdInput.value.length);else if(_kbdInput.createTextRange){var r=_kbdInput.createTextRange();r.collapse(true);r.moveEnd("character",0);r.moveStart("character",_kbdInput.value.length);r.select()}_kbdInput.focus()}}function setFocus(){if(!document.hasFocus())document.body.focus();
if(_kbdInput)setTimeout(()=>{_kbdInput.focus()},250)}function dispose(){if(_kbdInput){_kbdInput.parentElement.removeChild(_kbdInput);_kbdInput=null}}initialize();Object.defineProperty(_ref,"focus",{enumerable:true,configurable:false,writable:false,value:setFocus});Object.defineProperty(_ref,"caret",{enumerable:true,configurable:false,get:function(){return _caret}});Object.defineProperty(_ref,"setSelectionRange",{enumerable:true,configurable:false,writable:false,value:setSelectionRange});Object.defineProperty(_ref,
"value",{enumerable:true,configurable:false,get:function(){return _kbdInput.value},set:function(value){return _kbdInput.value=value}});Object.defineProperty(_ref,"dispose",{enumerable:true,configurable:false,writable:false,value:dispose});if(agentInfo.isMac)Object.defineProperty(_ref,"updateMacCmd",{enumerable:true,configurable:false,writable:false,value:updateMacCmd});Object.defineProperty(_ref,"inputElement",{enumerable:true,configurable:false,get:function(){return _kbdInput}});Object.defineProperty(_ref,
"active",{enumerable:true,configurable:false,get:function(){return _active},set:function(value){_active=value}});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(Thinfinity.Driver===undefined)Thinfinity.Driver={};Thinfinity.Driver.Keyboard=DKeyboard;Object.defineProperty(Thinfinity.Driver.Keyboard,"MAC_CMD",{enumerable:true,configurable:false,get:function(){return _MAC_CMD}})})();
(function(){function DMouse(args,oInterface){var _ref=this;var _noop=()=>{return null};var _args={container:null,device:null,useDblClick:false,allowOverrideCursor:true,extra:{getElementFromPoint:_noop,preventDefault:_noop}};var _methods=null;var _properties=null;var _oInterface=null;var _mousePress={"down":0,"event":{"x":null,"y":null,"button":null},"pressTime":500,"currentTime":null,"threshold":agentInfo.isMobile?45:25};var _enumMousePressStatus={"RELEASED":0,"PRESSED":1,"SENT":2};var _doubleClickThreshold=
200;var _clickDistThreshold=10;var _lastDownDblClick=false;var _mobileClickCallback=null;var _buttonDown=null;var _upClick={timeout:null,cacheX:null,cacheY:null,cacheButton:null};var _downClick={timeout:null,cacheX:null,cacheY:null,cacheButton:null};var _mouseX=0;var _mouseY=0;var _pageX=0;var _pageY=0;var _cursorCanvas=null;var _mouseLeave=false;var _overrideCursor=null;var wheelsEventNames=["DOMMouseScroll","mousewheel"];var _isBorderButton=false;var moveCursorCanvas=null;var _mouseMoveAsync={"position":{"x":parseInt(window.environment.currentWidth/
2,10),"y":parseInt(window.environment.currentHeight/2,10)},enable:true};var fireEvent=null;var _defaultEventsProps={"async":false};var _defaultZIndex=500;var _mouseMask=null;var _mouseMaskEffect=null;var _effect=false;var isRequesting=false;var requestAnimation=_noop;var _displaySize=null;var _defaultDPI=96;var _delayedCurSync={lastTime:null,minTime:2E3,enabled:productId==="thinvnc"};var _requireUserInteractionAction=false;function initialize(){helper.object.parseAttributes(_args,args);fireEvent=
(new Thinfinity.Events({"owner":_ref,"events":_args.events})).fireEvent;_oInterface=oInterface;_methods=_oInterface.methods;_properties=_oInterface.properties;_displaySize=_args.device.display;_oInterface.on("setCursor",setCursor);_oInterface.on("drawCursor",drawCursor);_oInterface.on("resetCursor",resetCursor);_oInterface.on("hideCursor",hideCursor);_oInterface.on("removeCursor",removeCursorCanvas);_oInterface.on("overrideCursor",function(o,n){setOverrideCursor(_properties.overrideCursor)});_oInterface.on("playbackStart",
function(){if(_oInterface.properties.isServerControlMouse)createMouseMask()});_oInterface.on("requireUserInteractionAction",requireUserInteractionAction);if(agentInfo.isMSIE&&agentInfo.msieVersion>=9)wheelsEventNames.push("wheel");if(agentInfo.isMobile)helper.dom.addEvent(_args.container,"touchstart",onTouchStartMobile,{"passive":false});helper.dom.addEvent(_args.container,wheelsEventNames,wheel,{"passive":false});helper.dom.addEvent(_args.container,"mousedown",onTouchStart,{"passive":false});helper.dom.addEvent(document,
"click",onDocumentClick,{"passive":false});helper.dom.addEvent(_args.container,"mouseup",onTouchEnd,{"passive":false});helper.dom.addEvent(_args.container,"mousemove",onTouchMove,{"passive":false});helper.dom.addEvent(_args.container,"mouseleave",onTouchLeave,{"passive":false});helper.dom.addEvent(_args.container,"mouseenter",onMouseEnter,{"passive":false});if(_properties.mousePressAsRightButton){helper.dom.addEvent(_args.container,"touchstart",onTouchDeviceStart,{"passive":true});helper.dom.addEvent(_args.container,
"touchmove",onTouchDeviceMove,{"passive":true});helper.dom.addEvent(_args.container,"touchend",onTouchDeviceEnd,{"passive":true})}requestAnimation=agentInfo.isMobile?window.requestAnimationFrame:helper.animationFrame.request;if(!_properties.overrideCursor)moveCursorCanvas=moveCursorCanvas_async;else moveCursorCanvas=function(){};setOverrideCursor(_properties.overrideCursor);if(agentInfo.isTouch){_oInterface.on("mouseMove",mouseMove);_oInterface.on("mouseDown",mouseDown);_oInterface.on("mouseUp",mouseUp)}}
function createMouseMask(){if(!_mouseMask)_mouseMask=helper.dom.appendJsonElement({parentElement:_args.container,type:"div",attributes:{id:"mouseMask",class:"clickEffect noTransition hidden",style:""}})}function requireUserInteractionAction(e){_requireUserInteractionAction=true}function dispatchUserInteractionGesture(e){_requireUserInteractionAction=false;_oInterface.__prototype__.fireEvent("userInteractionAction",e,{async:false})}function setCursor(o){let t=typeof o;if(t==="object")if(_properties.overrideCursor){_args.container.originalImage=
o;if(_properties.cursorVisible)_args.container.style.cursor=o.url;else _args.container.style.cursor="none";if(agentInfo.isSafari)_currentCursor.check()}else{_args.container.style.cursor="none";if(!_cursorCanvas)_cursorCanvas=createCursorCanvas(o);updateCursorCanvas(_cursorCanvas,o)}else if(_properties.overrideCursor)_args.container.style.cursor=o;else if(_cursorCanvas)if(["visible","hidden"].indexOf(o)!==-1)_cursorCanvas.style.visibility=o;else _cursorCanvas.style.display=o}function resetCursor(){if(_properties.overrideCursor){if(_args.container.style.cursor===
"none"&&_args.container.originalImage!=="")_args.container.style.cursor=_args.container.originalImage.cursor}else{if(_cursorCanvas)delete _cursorCanvas.mask;_cursorCanvas=null}}function drawCursor(item,imgpart){item.draw(_cursorCanvas.canvas.context,imgpart.x,imgpart.y)}function hideCursor(){if(_properties.overrideCursor)_args.container.style.cursor="none";else if(_cursorCanvas)_cursorCanvas.style.visibility="hidden"}function removeCursorCanvas(){if(_cursorCanvas){delete _cursorCanvas.mask;_cursorCanvas.innerHTML=
"";try{_args.container.removeChild(_cursorCanvas)}catch(err){}_cursorCanvas=null}}function createCursorCanvas(win){let hwnd=win.hwnd||0;let id=productId+"_canvas_"+hwnd;let div=document.getElementById(id);if(!div){div=document.createElement("div");div.style.position="absolute";div.style.display="inline-block"}if(!win.parent){if(!div.canvas){let canvas=document.createElement("canvas");canvas.style.left="0px";canvas.style.top="0px";canvas.width=win.width;canvas.height=win.height;canvas.style.position=
"absolute";canvas.style.zIndex=1;canvas.style.width=win.width;canvas.style.height=win.height;canvas.hwnd=hwnd;div.canvas=canvas;div.appendChild(canvas)}if(!div.canvas.context)div.canvas.context=div.canvas.getContext("2d",{willReadFrequently:true})}div.style.pointerEvents="none";var strValue="translateZ(0)";if(typeof div.style.msTransform!="undefined")div.style.msTransform=strValue;else if(typeof div.style.MozTransform!="undefined")div.style.MozTransform=strValue;else if(typeof div.style.OTransform!=
"undefined")div.style.OTransform=strValue;else if(typeof div.style.WebkitTransform!="undefined")div.style.WebkitTransform=strValue;div.id=id;if(helper.object.validate(win.parent)&&win.parent!=0){div.parent=win.parent;let parentDiv=document.getElementById(productId+"_canvas_"+win.parent);if(parentDiv)parentDiv.appendChild(div);else{div.style.display="none";div.style.visibility="hidden";_args.container.appendChild(div)}}else _args.container.appendChild(div);return div}function updateCursorCanvas(div,
win){if(win){let w=typeof win.width!=="undefined"&&win.width>0?win.width:win?.src?.width&&win.src.width>0?win.src.width:null;let h=typeof win.height!=="undefined"&&win.height>0?win.height:win?.src?.height&&win.src.height>0?win.src.height:null;let hx=win.dx||win.x||0;let hy=win.dy||win.y||0;if(w==null||h==null)return;div.style.zIndex=_properties.baseZIndex+(win.zidx||_defaultZIndex)*10;div.width=w;div.height=h;div.style.width=w+"px";div.style.height=h+"px";let cu=_properties.CUEnabled;if(w==0||h==
0){div.style.visibility="hidden";div.style.display="none"}else{if(cu||typeof win.imgs!="undefined")div.canvas.context.clearRect(0,0,w,h);if(!_properties.isServerControlMouse)if(!_properties.overrideCursor&&_mouseLeave&&productId!=="thinvnc")div.style.visibility="hidden";else{div.style.display="block";div.style.visibility="visible"}if(w!=div.canvas.width){div.canvas.width=w;div.canvas.style.width=w+"px";div.width=w;div.style.width=w+"px"}if(h!=div.canvas.height){div.canvas.height=h;div.canvas.style.height=
h+"px";div.height=h;div.style.height=h+"px"}if(win.src)if(cu)div.canvas.context.drawImage(win.src,0,0,w,h);else div.canvas.context.drawImage(win.src,hx,hy,w,h)}if(typeof win.className!="undefined")div.className=win.className;let canvas=div.canvas;if(!win.parent)canvas.style.pointerEvents="none";if(typeof hx!="undefined"){div.hotspotX=hx;div.hotspotY=hy;let x=win.left+hx;let y=win.top+hy;if(win.dpi){let s=_defaultDPI/win.dpi;_cursorCanvas.style.transform=`scale(${s})`;x*=s;y*=s;hy/=s;hx/=s}div.canvas.style.top=
-hy+"px";div.canvas.style.left=-hx+"px";if(!_delayedCurSync.enabled||Date.now()-_delayedCurSync.lastTime>_delayedCurSync.minTime){div.style.top=y+"px";div.style.left=x+"px"}}}}function createCache(timer,x,y,button){return{timeout:timer,cacheX:x,cacheY:y,cacheButton:button}}function clearCacheUp(){window.clearTimeout(_upClick.timeout);_upClick=createCache(null,null,null,null)}function clearCacheDown(){window.clearTimeout(_downClick.timeout);_downClick=createCache(null,null,null,null)}function singleClickUp(){cd=
_upClick;_methods.sendMouse(cd.cacheX,cd.cacheY,cd.cacheButton,"up");if((agentInfo.isMobile||agentInfo.isTabletMode)&&_mobileClickCallback){_mobileClickCallback(cd.cacheX,cd.cacheY,cd.cacheButton,"down");if(agentInfo.isTabletMode)_mobileClickCallback=null}clearCacheUp()}function singleClickDown(){cd=_downClick;_methods.sendMouse(cd.cacheX,cd.cacheY,cd.cacheButton,"down");clearCacheDown()}function sendMouse(X,Y,button,command){_delayedCurSync.lastTime=Date.now();if(command=="down"){if(_buttonDown!=
null)sendMouse(X,Y,_buttonDown,"up");_buttonDown=button}else if(command=="up")_buttonDown=null;if(_properties.mouseBufferAvailable===true)alert("Buffer mouse is not working");else if(!_args.useDblClick)_methods.sendMouse(X,Y,button,command);else if(command=="down"){var dist=Math.sqrt((_downClick.cacheX-X)*(_downClick.cacheX-X)+(_downClick.cacheY-Y)*(_downClick.cacheY-Y));if(_downClick.cacheButton==button&&_downClick.timeout&&dist<_clickDistThreshold){window.clearTimeout(_downClick.timeout);window.clearTimeout(_upClick.timeout);
if(productId=="ZSC"){_downClick.cacheX=X;_downClick.cacheY=Y;_lastDownDblClick=false;_downClick.cacheButton=0;_upClick.cacheButton=0;singleClickDown();singleClickUp()}_downClick.cacheX=X;_downClick.cacheY=Y;_downClick.cacheButton|=4;_upClick.cacheButton|=4;_lastDownDblClick=true;singleClickDown()}else if(_downClick.cacheButton!=button||dist>_clickDistThreshold){if(_downClick.timeout){window.clearTimeout(_downClick.timeout);singleClickDown()}_downClick=createCache(window.setTimeout(singleClickDown,
_doubleClickThreshold),X,Y,button)}}else if(command=="up"){var dist=Math.sqrt((_upClick.cacheX-X)*(_upClick.cacheX-X)+(_upClick.cacheY-Y)*(_upClick.cacheY-Y));if(_lastDownDblClick){_upClick.cacheX=X;_upClick.cacheY=Y;_lastDownDblClick=false;singleClickUp()}else if(_upClick.cacheButton!=button||dist>_clickDistThreshold){if(_upClick.timeout){window.clearTimeout(_upClick.timeout);singleClickUp()}_upClick=createCache(window.setTimeout(singleClickUp,_doubleClickThreshold),X,Y,button)}}else logError("sendMouse received unexpected command: "+
command)}function checkRemotePointer(x,y){if(_cursorCanvas){let aw=0,ah=0,th=4;if(agentInfo.isMobile){aw=_displaySize.width;ah=_displaySize.height;th=0}else{aw=window.environment.availWidth;ah=window.environment.availHeight}aw*=_properties.zoomFactor;ah*=_properties.zoomFactor;if(_mouseLeave&&!_properties.overrideCursor||(_args.container.style.cursor!="default"&&x<=th||x>=aw-th||y>=ah-th)){if(_args.container.style.cursor!="default")_args.container.style.cursor="default";if(_cursorCanvas.style.visibility===
"visible"&&!_properties.isServerControlMouse)_cursorCanvas.style.visibility="hidden"}else if(!_mouseLeave&&!_isBorderButton&&!_properties.overrideCursor&&_args.container.style.cursor!="none"&&productId!="ZSC"){_args.container.style.cursor="none";if(_cursorCanvas.style.visibility!=="visible")_cursorCanvas.style.visibility="visible"}}}function domElementOnTop(){var onTop=false;var elems=document.querySelectorAll(".blockUI.blockMsg.blockElement:not(.hidden), .systemPopup.systemDlg:not(.hidden)");var e=
0;while(!onTop&&e<elems.length){if(helper.style.getComputedStyle(elems[e],"display")!="none")onTop=true;e++}return onTop}function findPos(obj){var curleft=0;var curtop=0;do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop}while(obj=obj.offsetParent);return[curleft,curtop]}function mouseDown(x,y,button){var e=arguments&&arguments.length>3?arguments[3]:null;if(!(agentInfo.isWindows&&agentInfo.isMSIE))_oInterface.__prototype__.fireEvent("setText",String.fromCharCode(32));if(!window.hasFocus)window.focus();
if(!document.hasFocus())document.body.focus();if(_properties.active&&_properties.mouseControl){var position=findPos(_args.container);var left=position[0];var top=position[1];if((agentInfo.isMobile==true||agentInfo.isTabletMode&&e&&_allowedTouchEvents.indexOf(e.type)!=-1)&&productId=="ZSC"){_mouseX=Math.round(x);_mouseY=Math.round(y)}else{var scale=_properties.scale;_mouseX=Math.round((x-left)/scale);_mouseY=Math.round((y-top)/scale)}sendMouse(_mouseX,_mouseY,button,"down");fireEvent("mouseDown",{x:_mouseX,
y:_mouseY,button:button},_defaultEventsProps)}if(_requireUserInteractionAction)dispatchUserInteractionGesture()}function mouseUp(x,y,button){var e=arguments&&arguments.length>3?arguments[3]:null;if(_properties.active&&_properties.mouseControl){var position=findPos(_args.container);var left=position[0];var top=position[1];if((agentInfo.isMobile==true||agentInfo.isTabletMode&&e&&_allowedTouchEvents.indexOf(e.type)!=-1)&&productId=="ZSC"){_mouseX=Math.round(x);_mouseY=Math.round(y)}else{var scale=_properties.scale;
_mouseX=Math.round((x-left)/scale);_mouseY=Math.round((y-top)/scale)}sendMouse(_mouseX,_mouseY,button,"up");fireEvent("mouseUp",{x:_mouseX,y:_mouseY,button:button},_defaultEventsProps)}}function mouseMove(x,y){if(_properties.active&&_properties.mouseControl){let position=findPos(_args.container);let left=position[0];let top=position[1];if(x<left)x=left;if(y<top)y=top;let zoomFactor=_properties.zoomFactor;let scale=_properties.scale;let mx=left+_displaySize.width*zoomFactor*scale;let my=top+_displaySize.height*
zoomFactor*scale;if(x>mx)x=mx;if(y>my)y=my;_mouseX=Math.round((x-left)/scale);_mouseY=Math.round((y-top)/scale);sendMouse(_mouseX,_mouseY,null,"move");moveCursorCanvas(x,y)}}function onMouseEnter(e){_mouseLeave=false;if(_properties.cursorVisible)if(!_properties.overrideCursor){if(_cursorCanvas){if(_cursorCanvas.style.visibility==="hidden")_cursorCanvas.style.visibility="visible";if(_cursorCanvas.style.display!=="block")_cursorCanvas.style.display="block";if(_args.container.style.cursor!=="none")_args.container.style.cursor=
"none"}}else _args.container.style.cursor=_args.container.originalImage?_args.container.originalImage.cursor:"default"}function onTouchDeviceStart(e){if(_properties.isServerControlMouse||!_properties.allowMouseCapture)return;var x=(e.changedTouches||e.touches)[0].pageX;var y=(e.changedTouches||e.touches)[0].pageY;_mousePress.down=_enumMousePressStatus.PRESSED;_mousePress.event.x=x;_mousePress.event.y=y;_mousePress.event.button=e.button;_mousePress.currentTime=(new Date).getTime()}function onTouchDeviceMove(e){if(_mousePress.down===
_enumMousePressStatus.PRESSED){if(_properties.isServerControlMouse||!_properties.allowMouseCapture)return;var x=typeof e.pageX!="undefined"?e.pageX:(e.changedTouches||e.touches)[0].pageX;var y=typeof e.pageY!="undefined"?e.pageY:(e.changedTouches||e.touches)[0].pageY;if(!isInsideOfArea(x-_mousePress.event.x,y-_mousePress.event.y,_mousePress.threshold))_mousePress.down=_enumMousePressStatus.RELEASED}}function onTouchDeviceEnd(e){if(_mousePress.down===_enumMousePressStatus.PRESSED){if(_properties.isServerControlMouse||
!_properties.allowMouseCapture)return;var button=2;if((new Date).getTime()-_mousePress.currentTime>_mousePress.pressTime){mouseDown(_pageX,_pageY,button);mouseUp(_pageX,_pageY,button)}}_mousePress.down=_enumMousePressStatus.RELEASED}function isInsideOfArea(x,y,rad){return Math.pow(x,2)+Math.pow(y,2)<=rad}function onDocumentClick(e){if(!document.hasFocus())fireEvent("documentClick",{},_defaultEventsProps)}function isTouchSource(e){return e?.sourceCapabilities?.firesTouchEvents===true}function onTouchStart(e){if(!_properties.allowMouseCapture||
_properties.isServerControlMouse||isTouchSource(e)||_args.extra.preventDefault(e)||!_properties.hookMouse&&agentInfo.isMobile)return;var overrideCursor=_properties.overrideCursor;if(domElementOnTop()){if(!overrideCursor&&_cursorCanvas&&_cursorCanvas.style.visibility==="visible")_cursorCanvas.style.visibility="hidden";return}else if(!overrideCursor&&_cursorCanvas&&_cursorCanvas.style.visibility==="hidden")_cursorCanvas.style.visibility="visible";var elem=_args.extra.getElementFromPoint(e);var evt=
null;if(elem){if(agentInfo.isMSIE){if(elem.switchMouseCursor!==false){evt=e.srcElement||e.target;if(evt)evt.style.cursor="default";if(_cursorCanvas&&_cursorCanvas.style.visibility==="visible")_cursorCanvas.style.visibility="hidden";if(!overrideCursor){_args.container.style.cursor="default";_cursorCanvas.canvas.style.cursor="default"}}}else if(elem.style.cursor!="none"&&_cursorCanvas&&_cursorCanvas.style.visibility==="visible")_cursorCanvas.style.visibility="hidden";return}else if(agentInfo.isMSIE&&
agentInfo.msieVersion<=10){evt=e.srcElement||e.target;if(evt)if(!overrideCursor&&productId!=="ZSC"&&(productId!=="thinrdp"||evt.style.cursor!==""&&evt.style.cursor!=="default"))evt.style.cursor="none"}else if(_cursorCanvas&&_cursorCanvas.style.visibility==="hidden")_cursorCanvas.style.visibility="visible";if(agentInfo.isMobile&&isTouchEvent(e)){var X,Y;if(productId==="ZSC"){X=serverMouseX(e,false);Y=serverMouseY(e,false)}else{X=(e.changedTouches||e.touches)[0].pageX;Y=(e.changedTouches||e.touches)[0].pageY}_pageX=
X;_pageY=Y;if((e.changedTouches||e.touches).length==1){var button=0;moveCursorCanvas(X,Y);mouseDown(X,Y,button)}else{var button=2;mouseDown(X,Y,button);mouseUp(X,Y,button)}}else{var pageX=agentInfo.isMobile?getMobileMouseLocationX(e):e.pageX;var pageY=agentInfo.isMobile?getMobileMouseLocationY(e):e.pageY;_pageX=pageX;_pageY=pageY;var button=e.button||0;_mousePress.down=_enumMousePressStatus.RELEASED;if(_properties.mousePressAsRightButton&&button<2){_mousePress.down=_enumMousePressStatus.PRESSED;_mousePress.event.x=
_pageX;_mousePress.event.y=_pageY;_mousePress.event.button=button;_mousePress.currentTime=(new Date).getTime()}else mouseDown(pageX,pageY,button)}if(e.preventDefault)e.preventDefault()}function onTouchMove(e){if(!_properties.allowMouseCapture||_properties.isServerControlMouse||isTouchSource(e)||_args.extra.preventDefault(e)||!_properties.hookMouse&&agentInfo.isMobile)return;var overrideCursor=_properties.overrideCursor;if(!overrideCursor)if(domElementOnTop()){if(_cursorCanvas&&_cursorCanvas.style.visibility!=
"hidden"){_cursorCanvas.style.visibility="hidden";if(_args.container.style.cursor==="none")_args.container.style.cursor="default"}return}else if(!_mouseLeave&&!_isBorderButton){if(_args.container.style.cursor!=="none"&&productId!=="ZSC")_args.container.style.cursor="none";if(_cursorCanvas&&_cursorCanvas.style.visibility=="hidden")_cursorCanvas.style.visibility="visible"}_isBorderButton=false;if(!overrideCursor){var elem=_args.extra.getElementFromPoint(e);if(elem)if(agentInfo.isMSIE){if(elem.switchMouseCursor!==
false){var evt=e.srcElement||e.target;if(evt)evt.style.cursor="default";if(_cursorCanvas&&_cursorCanvas.style.visibility==="visible")_cursorCanvas.style.visibility="hidden";_args.container.style.cursor="default";_cursorCanvas.canvas.style.cursor="default";return}}else if(elem.className.indexOf("borderButton")!=-1){_isBorderButton=true;if(_properties.cursorVisible){if(_args.container.style.cursor!="default")_args.container.style.cursor="default";if(_cursorCanvas.style.display!=="none")_cursorCanvas.style.display=
"none"}}else{if(elem.style.cursor!="none"){if(_cursorCanvas&&_cursorCanvas.style.visibility==="visible")_cursorCanvas.style.visibility="hidden";return}}else if(agentInfo.isMSIE){if(!overrideCursor){if(_cursorCanvas){if(_mouseLeave){_cursorCanvas.style.display="block";_mouseLeave=false}if(_cursorCanvas.style.visibility==="hidden")_cursorCanvas.style.visibility="visible"}if(productId!="ZSC"&&_args.container.style.cursor!=="none")_args.container.style.cursor="none"}if(agentInfo.msieVersion<=10){var evt=
e.srcElement||e.target;if(evt)if(productId!="ZSC"&&(productId!="thinrdp"||evt.style.cursor!=""&&evt.style.cursor!="default"))evt.style.cursor="none"}}else{if(_properties.cursorVisible&&_cursorCanvas&&_cursorCanvas.style.display==="none")_cursorCanvas.style.display="block";if(_cursorCanvas&&_cursorCanvas.style.visibility==="hidden")_cursorCanvas.style.visibility="visible"}}if(!_methods.inputAllowed())return;_pageX=typeof e.pageX!="undefined"?agentInfo.isMobile?getMobileMouseLocationX(e):e.pageX:(e.changedTouches||
e.touches)[0].pageX;_pageY=typeof e.pageY!="undefined"?agentInfo.isMobile?getMobileMouseLocationY(e):e.pageY:(e.changedTouches||e.touches)[0].pageY;var waitForPress=false;if(_properties.mousePressAsRightButton&&_mousePress.down===_enumMousePressStatus.PRESSED){waitForPress=true;if(!isInsideOfArea(_pageX-_mousePress.event.x,_pageY-_mousePress.event.y,_mousePress.threshold)){mouseDown(_mousePress.event.x,_mousePress.event.y,_mousePress.event.button);_mousePress.down=_enumMousePressStatus.SENT;waitForPress=
false}}var currentX=serverMouseX(e,false);var currentY=serverMouseY(e,false);var pageX=agentInfo.isMobile?getMobileMouseLocationX(e):e.pageX;var pageY=agentInfo.isMobile?getMobileMouseLocationY(e):e.pageY;if(_mouseX!=currentX||_mouseY!=currentY){_mouseX=currentX;_mouseY=currentY;if(!waitForPress){let _pos=null;if(agentInfo.isMobile&&isTouchEvent(e))_pos={x:(e.changedTouches||e.touches)[0].pageX,y:(e.changedTouches||e.touches)[0].pageY};else _pos={x:pageX,y:pageY};mouseMove(_pos.x,_pos.y)}}}function onTouchEnd(e){if(!_properties.allowMouseCapture||
_properties.isServerControlMouse||isTouchSource(e)||_args.extra.preventDefault(e)||!_properties.hookMouse&&agentInfo.isMobile)return;if(!_properties.overrideCursor)if(domElementOnTop()){if(_cursorCanvas&&_cursorCanvas.style.visibility==="visible")_cursorCanvas.style.visibility="hidden";return}else if(_cursorCanvas&&_cursorCanvas.style.visibility==="hidden")_cursorCanvas.style.visibility="visible";_pageX=typeof e.pageX!="undefined"?agentInfo.isMobile?getMobileMouseLocationX(e):e.pageX:(e.changedTouches||
e.touches)[0].pageX;_pageY=typeof e.pageY!="undefined"?agentInfo.isMobile?getMobileMouseLocationY(e):e.pageY:(e.changedTouches||e.touches)[0].pageY;var button=agentInfo.isMobile&&isTouchEvent(e)?0:e.button||0;var sendDeferredTime=0;if(_properties.mousePressAsRightButton&&_mousePress.down===_enumMousePressStatus.PRESSED){sendDeferredTime=25;if((new Date).getTime()-_mousePress.currentTime>_mousePress.pressTime)button=2;mouseDown(_mousePress.event.x,_mousePress.event.y,button);_mousePress.down=_enumMousePressStatus.SENT}setTimeout(function(x,
y,btn){mouseUp(x,y,btn)},sendDeferredTime,_pageX,_pageY,button);if(e.preventDefault)e.preventDefault()}function onTouchLeave(e){_mouseLeave=true;if(!_properties.allowMouseCapture||_properties.isServerControlMouse||isTouchSource(e)||_args.extra.preventDefault(e)||!_properties.hookMouse&&agentInfo.isMobile)return;var x=typeof e.pageX!="undefined"?agentInfo.isMobile?getMobileMouseLocationX(e):e.pageX:(e.changedTouches||e.touches)[0].pageX;var y=typeof e.pageY!="undefined"?agentInfo.isMobile?getMobileMouseLocationY(e):
e.pageY:(e.changedTouches||e.touches)[0].pageY;if(agentInfo.isMobile&&(productId=="virtualui"||productId=="thinrdp"||productId=="thinvnc"));else if(productId!="thinvnc"&&_cursorCanvas)_cursorCanvas.style.display="none";if(!_properties.overrideCursor){var efp=_args.extra.getElementFromPoint(e);if(efp&&efp.switchMouseCursor!==false){if(_cursorCanvas)_cursorCanvas.style.display="none";_args.container.style.cursor="default";efp=null}}if(_buttonDown!=null&&(x<5||y<5||x>$(_args.container).width()-5||y>
$(_args.container).height()-5)){_pageX=x;_pageY=y;mouseUp(_pageX,_pageY,_buttonDown);if(e.preventDefault)e.preventDefault()}else{let scale=_properties.scale;let fp=findPos(_args.container);if(x<0)x=0;else{let maxX=(_args.container.offsetWidth+fp[0])*scale;if(x>maxX)x=maxX}if(y<0)y=0;else{let maxY=(_args.container.offsetHeight+fp[1])*scale;if(y>maxY)y=maxY}mouseMove(x,y)}}function getMobileMouseLocationX(e){return e.pageX+_args.container.scrollLeft*_properties.zoomFactor}function getMobileMouseLocationY(e){return e.pageY+
_args.container.scrollTop*_properties.zoomFactor}function wheel(event){if(event.ctrlKey&&helper.object.getValue(self,"clientSettings.MouseWheelZoom",false))return true;var obj=_args.extra.getElementFromPoint(event);if(!obj){var offset=$(_args.container).offset();var s=_properties.scale;if(event.pageX>=offset.left&&event.pageX<=offset.left+$(_args.container).width()*s&&event.pageY>=offset.top&&event.pageY<=offset.top+$(_args.container).height()*s){var delta=0;var axis="y";if(!event)event=window.event;
if(typeof event.wheelDelta!="undefined"){delta=event.wheelDelta;if(typeof event.wheelDeltaY!="undefined")axis=Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaY)&&Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaZ)?"x":Math.abs(event.wheelDeltaY)>Math.abs(event.wheelDeltaZ||0)?"y":"z";if(agentInfo.isOpera)delta=-delta}else if(typeof event.delta!="undefined"){delta=event.delta;axis=Math.abs(event.deltaX)>Math.abs(event.deltaY)&&Math.abs(event.deltaX)>Math.abs(event.deltaZ)?"x":Math.abs(event.deltaY)>
Math.abs(event.deltaZ||0)?"y":"z"}else if(agentInfo.isMSIE&&typeof event.deltaX!="undefined"&&typeof event.deltaY!="undefined")if(event.deltaX!=0){delta=event.deltaX;axis="x"}else{delta=-event.deltaY;axis="y"}else if(typeof event.detail!="undefined"){delta=event.detail*-120;axis=event.axis==1?"x":event.axis==2?"y":"z"}if(!agentInfo.isMac){delta=Math[delta>0?"ceil":"floor"](delta/120)*120;if(delta>120)delta=120;else if(delta<-120)delta=-120}if(delta)if(axis=="y")_methods.sendWheel(delta,0);else{if(!agentInfo.isMSIE)delta=
-delta;_methods.sendWheel(0,delta)}event.stopPropagation();event.preventDefault()}}}function serverMouseX(e){var position=findPos(_args.container);var left=position[0];var scale=_properties.scale;if((agentInfo.isMobile||agentInfo.isTabletMode&&_allowedTouchEvents.indexOf(e.type)!=-1)&&isTouchEvent(e))return Math.floor(((e.changedTouches||e.touches)[0].pageX-left)/scale);else return Math.floor((e.pageX-left)/scale)}function serverMouseY(e){var position=findPos(_args.container);var top=position[1];
var scale=_properties.scale;if((agentInfo.isMobile||agentInfo.isTabletMode&&_allowedTouchEvents.indexOf(e.type)!=-1)&&isTouchEvent(e))return Math.floor(((e.changedTouches||e.touches)[0].pageY-top)/scale);else return Math.floor((e.pageY-top)/scale)}function isTouchEvent(e){e=e.originalEvent||e;if(e&&(e.changedTouches||e.touches)&&(e.changedTouches||e.touches).length>0)return true;return false}function onTouchStartMobile(e){e.preventDefault()}function moveCursorCanvas_sync(x,y,effect){if(!!_cursorCanvas){var position=
findPos(_args.container);var scale=_properties.scale;var cX=Math.round((x-position[0])/scale);var cY=Math.round((y-position[1])/scale);mouseCanvasX=cX;mouseCanvasY=cY;if(_cursorCanvas.style.left!=cX+"px"||_cursorCanvas.style.top!=cY+"px"){_cursorCanvas.style.left=cX+"px";_cursorCanvas.style.top=cY+"px";if(_properties.remotePointer&&!_properties.isServerControlMouse)checkRemotePointer(x,y)}if(_mouseMask&&effect){clearTimeout(_mouseMaskEffect);_mouseMask.style.left=mouseCanvasX+"px";_mouseMask.style.top=
mouseCanvasY+"px";helper.style.replace(_mouseMask,"hidden","runAnimation");_mouseMaskEffect=setTimeout(()=>{helper.style.replace(_mouseMask,"runAnimation","hidden")},200)}}}function mouseMoveCanvas_AnimationFrame(){if(!!_cursorCanvas&&(_mouseMoveAsync.position.x!=_cursorCanvas.rawLeft||_mouseMoveAsync.position.y!=_cursorCanvas.rawTop)){var position=findPos(_args.container);var scale=_properties.scale;var cX=Math.round((_mouseMoveAsync.position.x-position[0])/scale);var cY=Math.round((_mouseMoveAsync.position.y-
position[1])/scale);mouseCanvasX=cX;mouseCanvasY=cY;_cursorCanvas.rawLeft=_mouseMoveAsync.position.x;_cursorCanvas.rawTop=_mouseMoveAsync.position.y;_cursorCanvas.style.left=mouseCanvasX+"px";_cursorCanvas.style.top=mouseCanvasY+"px";if(_mouseMask&&_effect){clearTimeout(_mouseMaskEffect);_mouseMask.style.left=mouseCanvasX+"px";_mouseMask.style.top=mouseCanvasY+"px";helper.style.replace(_mouseMask,"hidden","runAnimation");_mouseMaskEffect=setTimeout(()=>{helper.style.replace(_mouseMask,"runAnimation",
"hidden")},150)}if(_properties.remotePointer)checkRemotePointer(_mouseMoveAsync.position.x,_mouseMoveAsync.position.y);_oInterface.__prototype__.fireEvent("onMouseAnimationFrameEnd")}if(!isRequesting){isRequesting=true;requestAnimation(()=>{isRequesting=false;mouseMoveCanvas_AnimationFrame()})}}function moveCursorCanvas_async(x,y){if(!!_cursorCanvas)_mouseMoveAsync.position={"x":x,"y":y}}function moveCursorCanvasExternal(x,y,effect){if(!!_cursorCanvas){if(_cursorCanvas.style.display!=="block"){_cursorCanvas.style.display=
"block";_cursorCanvas.style.visibility="visible"}let position=findPos(_args.container);let scale=_properties.scale;if(!_effect)_effect=effect;x=Math.round(x*scale+position[0]);y=Math.round(y*scale+position[1]);if(_mouseMoveAsync.enable)_mouseMoveAsync.position={x,y,effect};else moveCursorCanvas(x,y,effect)}}function setOverrideCursor(value){if(_args.allowOverrideCursor&&_overrideCursor!=value){_overrideCursor=value;if(_overrideCursor){moveCursorCanvas=function(){};if(helper.object.existsPath(_args.container,
"originalImage.cursor"))helper.style.add(_args.container,{"cursor":_args.container.originalImage.cursor});if(_cursorCanvas&&_cursorCanvas.canvas)_cursorCanvas.canvas.context.clearRect(0,0,_cursorCanvas.canvas.offsetWidth,_cursorCanvas.canvas.offsetWidth);helper.style.add(_cursorCanvas,{"display":"none"});removeProps()}else{_args.container.style.cursor="none";if(_properties.isServerControlMouse){moveCursorCanvas=moveCursorCanvas_sync;_mouseMoveAsync.enable=false}else{_mouseMoveAsync.enable=true;moveCursorCanvas=
moveCursorCanvas_async;requestAnimation(mouseMoveCanvas_AnimationFrame)}defineProps();if(!_cursorCanvas&&_args.container.originalImage)setCursor(_args.container.originalImage);helper.style.add(_cursorCanvas,{"display":"block"})}}}function defineProps(){if(!_properties.overrideCursor&&!_ref.moveCursorCanvas)Object.defineProperty(_ref,"moveCursorCanvas",{enumerable:true,configurable:false,writable:true,value:moveCursorCanvasExternal})}function removeProps(){if(_properties.overrideCursor&&_ref.moveCursorCanvas)delete _ref.moveCursorCanvas}
function dispose(){helper.dom.removeEvent(_args.container,"touchstart",onTouchStartMobile);helper.dom.removeEvent(_args.container,wheelsEventNames,wheel,{"passive":false});helper.dom.removeEvent(_args.container,"mousedown",onTouchStart,{"passive":false});helper.dom.removeEvent(_args.container,"mouseup",onTouchEnd,{"passive":false});helper.dom.removeEvent(_args.container,"mousemove",onTouchMove,{"passive":false});helper.dom.removeEvent(_args.container,"mouseleave",onTouchLeave,{"passive":false});helper.dom.removeEvent(_args.container,
"touchstart",onTouchDeviceStart,{"passive":true});helper.dom.removeEvent(_args.container,"touchmove",onTouchDeviceMove,{"passive":true});helper.dom.removeEvent(_args.container,"touchend",onTouchDeviceEnd,{"passive":true})}initialize();Object.defineProperty(_ref,"overrideCursor",{enumerable:true,configurable:false,get:function(){return _overrideCursor},set:setOverrideCursor});Object.defineProperty(_ref,"cursorCanvas",{enumerable:true,configurable:false,get:function(){return _cursorCanvas}});Object.defineProperty(_ref,
"dispose",{enumerable:true,configurable:false,writable:false,value:dispose});defineProps();return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(Thinfinity.Driver===undefined)Thinfinity.Driver={};Thinfinity.Driver.Mouse=DMouse})();
(function(){let p=agentInfo.isMobile?1:3;var _defaultTouchGestures=[{type:"tap",pointers:1,taps:1,action:["mouseMove","click"]},{type:"pan",pointers:1,threshold:Math.round(15*p),direction:"DIRECTION_ALL",action:"mouseMove"},{type:"pressAndRelease",pointers:1,threshold:Math.round(5*p),time:350,action:["pressRelease"]},{type:"press",pointers:1,threshold:Math.round(5*p),time:350,action:["mouseMove","holdLeft"]},{type:"pan",pointers:3,threshold:0,action:"zoomPan"},{type:"pinch",pointers:2,threshold:0,
action:"zoomOrWheel"},{type:"release",action:"releaseAll"},{type:"swipe","pointers":1,"threshold":Math.round(10*p),velocity:.3,direction:"DIRECTION_RIGHT",action:"swipe"},{type:"swipeFromEdge","pointers":1,"threshold":Math.round(10*p),velocity:.3,swipeDirection:"left",action:"swipeFromEdge"}];const gesturesOnStates=Thinfinity.GesturesConfigurator.onStates;var TouchManager=function(args){const isTouchable=!agentInfo.isMobile;var p={initialized:false,localGesturesInitialized:false,redirectionInitialized:false,
redirectionServerSideSupported:false,listenElement:null,localGesturesSettings:null,redirectSettings:null,gesturesConfigurator:null,fallbackCount:0,currentMode:"",currentLocalGesturesMethod:"",currentRedirectionMethod:"",currentRedirectionEventHandlers:{"Start":null,"Move":null,"End":null},currentRedirectionEvents:{"Start":null,"Move":null,"End":null},eventNamesByRedirectionMethod:{"Touch Events":{"Start":["touchstart"],"Move":["touchmove"],"End":["touchend"]},"Pointer Events":{"Start":[],"Move":[],
"End":[]}},touchEventsCapable:function(){return isTouchable},pointerEventsCapable:function(){var pointerEvents=this.eventNamesByRedirectionMethod["Pointer Events"];if(pointerEvents["Start"].length)return true;if(navigator.pointerEnabled&&navigator.maxTouchPoints>0){pointerEvents["Start"]=["pointerdown"];pointerEvents["Move"]=["pointermove"];pointerEvents["End"]=["pointerup","pointercancel"];return true}if(navigator.msPointerEnabled&&navigator.msMaxTouchPoints>0){pointerEvents["Start"]=["MSPointerDown"];
pointerEvents["Move"]=["MSPointerMove"];pointerEvents["End"]=["MSPointerUp","MSPointerCancel"];return true}return false},msTouchEventsCapable:function(){return agentInfo.isTabletMode&&document&&document.documentElement&&"onmsgesturestart"in document.documentElement},maxTouchPoints:function(){return navigator.maxTouchPoints||navigator.msMaxTouchPoints||0},addRedirectionEvents:function(owner,eventId){var eventHandlerName="touch"+eventId+"Redirection";var eventNames=this.eventNamesByRedirectionMethod[this.currentRedirectionMethod][eventId];
var eventHandler=owner[eventHandlerName];if(!this.listenElement||typeof eventNames=="undefined"||typeof eventHandler=="undefined")return;var wrappedEventHandler;if(this.currentRedirectionMethod=="Touch Events")wrappedEventHandler=eventId=="Start"||eventId=="End"?function(e){eventHandler.apply(owner,[e,e.changedTouches])}:function(e){eventHandler.apply(owner,[e,e.touches])};else wrappedEventHandler=function(e){if(e.pointerType!="touch")return;eventHandler.apply(owner,[e,[{pageX:e.clientX,pageY:e.clientY,
identifier:e.pointerId}]])};for(var i=0;i<eventNames.length;++i)this.listenElement.addEventListener(eventNames[i],wrappedEventHandler,false);this.currentRedirectionEventHandlers[eventId]=wrappedEventHandler},removeRedirectionEvents:function(eventId){if(this.currentRedirectionMethod&&this.currentRedirectionMethod!=""){var eventNames=this.eventNamesByRedirectionMethod[this.currentRedirectionMethod][eventId];if(!this.listenElement||typeof eventNames=="undefined")return;var wrappedEventHandler=this.currentRedirectionEventHandlers[eventId];
for(var i=0;i<eventNames.length;++i)this.listenElement.removeEventListener(eventNames[i],wrappedEventHandler,false)}},initLocalGestures:function(localGestureSettings){if(this.gesturesConfigurator!=null&&this.gesturesConfigurator.initialized)return;this.localGesturesInitialized=false;this.localGestureSettings=null;this.currentLocalGesturesMethod="";if(!this.gesturesConfigurator)this.gesturesConfigurator=new Thinfinity.GesturesConfigurator({listenElement:this.listenElement});if(this.gesturesConfigurator==
null){helper.console.error("TouchManager: Cannot initialize GesturesConfigurator, no local gesture processing.");return}this.localGestureSettings=localGestureSettings;this.currentLocalGesturesMethod="Hammer.js";this.localGesturesInitialized=true},initRedirection:function(redirectionSettings){this.redirectionSettings=redirectionSettings;this.currentRedirectionMethod=this.touchEventsCapable()?"Touch Events":"Pointer Events";this.redirectionInitialized=true;this.redirectionServerSideSupported=!agentInfo.isMobile&&
cookiePrefix==="VNC"||false},startLocalGestures:function(owner){if(this.gesturesConfigurator.initialized)this.gesturesConfigurator.stopRecognition();if(owner.defaultGestures)this.gesturesConfigurator.set({gestures:owner.defaultGestures});this.gesturesConfigurator.set({"gestures":this.localGestureSettings});this.gesturesConfigurator.set({middleware:owner.gesturesMiddleware,middlewares:[],actions:owner.actions});this.gesturesConfigurator.startRecognition();this.currentMode="Local Gestures";owner.localGesturesStarted()},
stopLocalGestures:function(owner){if(this.gesturesConfigurator)this.gesturesConfigurator.stopRecognition();this.currentMode="";owner.localGesturesStopped()},startRedirection:function(owner){this.listenElement.style.touchAction="none";this.listenElement.style.msTouchAction="none";this.listenElement.onselectstart=function(){return false};this.addRedirectionEvents(owner,"Start");this.addRedirectionEvents(owner,"Move");this.addRedirectionEvents(owner,"End");this.currentMode="Redirection";owner.redirectionStarted()},
stopRedirection:function(owner){this.removeRedirectionEvents("Start");this.removeRedirectionEvents("Move");this.removeRedirectionEvents("End");if(this.listenElement){delete this.listenElement.style.touchAction;delete this.listenElement.style.msTouchAction}this.currentMode="";owner.redirectionStopped()}};var _useLocalGesture=false;var touch={touchCapable:function(){return true},maxTouchPoints:function(){return p.maxTouchPoints()},localGesturesInitialized:function(){return p.localGesturesInitialized},
redirectionInitialized:function(){return p.redirectionInitialized},redirectionServerSideSupported:function(){return p.redirectionServerSideSupported},getCurrentMode:function(){return p.currentMode},getCurrentRedirectionMethod:function(){return p.currentRedirectionMethod},getCurrentLocalGesturesMethod:function(){return p.currentLocalGesturesMethod},wasInitialized:function(){return p.initialized},refine:function(){var F=function(){};F.prototype=touch;return new F},initialize:function(listenElement,
localGestureSettings,redirectionSettings){if(touch.wasInitialized()){helper.console.log("TouchManager: Already initialized, continue.");return}if(!listenElement){helper.console.error("TouchManager: Undefined listenElement, cannot initialize.");return}if(!touch.touchCapable()){helper.console.error("TouchManager: Touch capability not detected, cannot initialize.");return}if(listenElement.addEventListener=="undefined"){helper.console.error("TouchManager: listenElement.addEventListener() not supported, cannot initialize.");
return}p.listenElement=listenElement;if(typeof localGestureSettings=="object")p.initLocalGestures(localGestureSettings);if(typeof redirectionSettings=="object")p.initRedirection(redirectionSettings);if(!touch.redirectionInitialized()&&!touch.localGesturesInitialized()){helper.console.log("TouchManager: No touch handling method defined, cannot initialize.");return}touch.printStatus(true);p.initialized=true;helper.console.log("TouchManager: Initialized.");touch.reconfigureForLocalGestures()},serverSupportsRedirection:function(){if(!touch.wasInitialized()){helper.console.error("TouchManager: Not initialized.");
return}if(!touch.redirectionInitialized()){helper.console.error("TouchManager: Redirection not initialized.");return}if(agentInfo.isMobile){p.redirectionServerSideSupported=false;logDebug("TouchManager: Server supports touch redirection, but the device is mobile or surface reconfiguring to local gestures...");touch.reconfigureForLocalGestures();helper.console.log("ThinVNCTouchManager::redirectionStopped()");$("#kitouchredir").hide();$("#kitouchredir + hr").hide()}else{p.redirectionServerSideSupported=
true;helper.console.log("TouchManager: Server supports touch redirection, reconfiguring...");touch.reconfigureForRedirection()}},printStatus:function(ignoreInitialized){if(!touch.wasInitialized()&&!ignoreInitialized){helper.console.log("TouchManager: Not initialized.");return}var yesNo=function(b,y,n){var s=b?"Yes":"No";if(b&&y)s+=y;else if(!b&&n)s+=n;return s};helper.console.log("TouchManager: Touch events capable? "+yesNo(p.touchEventsCapable())+".");helper.console.log("TouchManager: Pointer events capable? "+
yesNo(p.pointerEventsCapable())+".");helper.console.log("TouchManager: Max. touch points: "+(touch.maxTouchPoints()?touch.maxTouchPoints():"not available")+".");helper.console.log("TouchManager: Local gestures initialized? "+yesNo(touch.localGesturesInitialized(),", using "+touch.getCurrentLocalGesturesMethod())+".");helper.console.log("TouchManager: Redirection initialized? "+yesNo(touch.redirectionInitialized(),", using "+touch.getCurrentRedirectionMethod())+".")},toggleCurrentMode:function(){if(touch.getCurrentMode()==
"Redirection")touch.reconfigureForLocalGestures();else if(touch.getCurrentMode()=="Local Gestures")touch.reconfigureForRedirection();else helper.console.error("TouchManager: Cannot toggle invalid current mode: "+touch.getCurrentMode())},reconfigureForLocalGestures:function(){_useLocalGesture=true;if(!touch.wasInitialized()){helper.console.error("TouchManager: Not initialized. Cannot reconfigure for local gestures.");return}if(!touch.localGesturesInitialized()){helper.console.log("TouchManager: Cannot switch to local gestures, mode not initialized. Reverting to redirect if available.");
if(touch.redirectionInitialized()&&touch.redirectionServerSideSupported())touch.reconfigureForRedirection();return}try{p.stopRedirection(touch);p.startLocalGestures(touch)}catch(err){helper.console.error("TouchManager: Failed to initialize local gesture processing: "+err);if(p.fallbackCount++)return;helper.console.error("TouchManager: Reverting to touch redirection if available.");if(touch.redirectionInitialized()&&touch.redirectionServerSideSupported())touch.reconfigureForRedirection();p.fallbackCount=
0;return}p.fallbackCount=0;helper.console.log("TouchManager: Switched to local gestures.")},enableGestures:function(){if(_useLocalGesture==true&&(p.gesturesConfigurator==null||!p.gesturesConfigurator.initialized)){p.initLocalGestures(p.localGestureSettings);p.startLocalGestures(touch)}},disableGestures:function(){if(_useLocalGesture==true&&p.gesturesConfigurator!=null)p.stopLocalGestures(touch)},reconfigureForRedirection:function(){_useLocalGesture=false;if(!touch.wasInitialized()){helper.console.error("TouchManager: Not initialized. Cannot reconfigure for redirection.");
return}if(!touch.redirectionInitialized()||!touch.redirectionServerSideSupported()){helper.console.log("TouchManager: Cannot switch to redirection, mode not initialized or no sever-side support. Reverting to local gestures if available.");if(touch.localGesturesInitialized())touch.reconfigureForLocalGestures();return}try{p.stopLocalGestures(touch);p.startRedirection(touch)}catch(err){helper.console.error("TouchManager: Failed to initialize redirection of touch events: "+err);if(p.fallbackCount++)return;
helper.console.error("TouchManager: Reverting to local gestures if available.");if(touch.localGesturesInitialized())touch.reconfigureForLocalGestures();p.fallbackCount=0;return}p.fallbackCount=0;helper.console.log("TouchManager: Switched to touch redirection.")},dispose:function(){p.stopRedirection(touch);p.stopLocalGestures(touch);p.initialized=false},touchGesture:function(e){},panStartGesture:function(e){},panGesture:function(e){},panEndGesture:function(e){},swipeGesture:function(e){},tapGesture:function(e){},
doubleTapGesture:function(e){},pressGesture:function(e){},releaseGesture:function(e){},transformStartGesture:function(e){},transformGesture:function(e){},transformEndGesture:function(e){},touchStartRedirection:function(e,touches){},touchMoveRedirection:function(e,touches){},touchEndRedirection:function(e,touches){},localGesturesStarted:function(e){},localGesturesStopped:function(e){},redirectionStarted:function(e){},redirectionStopped:function(e){},gesturesConfiguratorCustomActions:[]};Object.defineProperty(touch,
"gesturesConfigurator",{"enumerable":true,"configurable":false,"get":function(){return p.gesturesConfigurator}});return touch};function DTouch(args,oInterface){var _ref=this;var _props=null;var _methods=null;var _noop=()=>{return null};var _args={container:null,waitForTouchDevice:null,extra:{getElementFromPoint:_noop,waitForTouchDevice:null,preventDefault:_noop},gestures:null};var _defaultEventFire={async:0};var _touchManager=null;var getScrollLeft=document.documentElement?function(){return document.documentElement.scrollLeft}:
function(){return window.pageXOffset};var getScrollTop=document.documentElement?function(){return document.documentElement.scrollTop}:function(){return window.pageYOffset};var held=[];var zoomStarted=false;var startMouseX=0;var startMouseY=0;var deltaCursorX=0;var deltaCursorY=0;var divScrolling=true;var keyboardCaretWait=200;var fireEvent=null;var _defaultEventsProps={"async":false};var _readyCallback=null;var _ready=false;function initialize(){if(!agentInfo.isMobile){helper.object.parseAttributes(_args,
args);fireEvent=(new Thinfinity.Events({"owner":_ref,"events":_args.events,fireEventArgs:_defaultEventFire})).fireEvent;if(agentInfo.isTouch)postInitialize();else agentInfo.detectTouch(postInitialize)}}function postInitialize(){_props=oInterface.properties;_methods=oInterface.methods;oInterface.on("allowMouseCapture",()=>{checkControl()});checkControl()}function checkControl(){if(!_props.allowMouseCapture){if(_touchManager)_touchManager.stopLocalGestures()}else if(!_touchManager){initializeTouch();
if(_args.extra.waitForTouchDevice instanceof Function)_args.extra.waitForTouchDevice()}else _touchManager.startLocalGestures()}function initializeTouch(){_touchManager=new TouchManager({});_touchManager["defaultGestures"]=helper.object.clone(_defaultTouchGestures);_touchManager["defaultGestures"].filter(function(t){return t.type==="swipe"})[0].middleware=function(e,details){var tapElement=e&&e.target?e.target:null;var menuClass="thin-menu-container";if($(tapElement).hasClass(menuClass)||$(tapElement).parents().hasClass(menuClass))return true;
return false};oInterface.on("serverSupportsRedirection",_touchManager.serverSupportsRedirection);oInterface.on("startTouchRedirection",_touchManager.reconfigureForRedirection);oInterface.on("stopTouchRedirection",_touchManager.reconfigureForLocalGestures);if(!agentInfo.isMobile&&window.cookiePrefix==="RDP")oInterface.properties.overrideCursor=false;if(productId=="virtualui"){var errMsg="ClientSettings.Mobile.KeyboardCaretWait is not a valid value [{0}]";try{var _caretTimeout=helper.object.getValue(THIN,
"clientSettings.Mobile.KeyboardCaretWait",null);_caretTimeout=_caretTimeout!==null&&!isNaN(_caretTimeout)?parseInt(_caretTimeout):keyboardCaretWait;if(_caretTimeout>0)keyboardCaretWait=_caretTimeout;else helper.console.warning(helper.string.format(errMsg,_caretTimeout))}catch(err){helper.console.warning(helper.string.format(errMsg,_caretTimeout))}}function btnLeftClick(x,y){var x1=getTouchXFixed();var y1=getTouchYFixed();mouseScrollX=x1;mouseScrollY=y1;x1=x;y1=y;let abs=coord2Abs(x1,y1);_methods.sendMouse(abs.x,
abs.y,0,"down");_methods.sendMouse(abs.x,abs.y,0,"up")}function sendButtonRight(x,y){var x1=getTouchXFixed();var y1=getTouchYFixed();mouseScrollX=x1;mouseScrollY=y1;x1=x;y1=y;let abs=coord2Abs(x1,y1);_methods.sendMouse(abs.x,abs.y,2,"down");_methods.sendMouse(abs.x,abs.y,2,"up")}function checkPointerType(ev){if(ev)switch(ev.pointerType){case "touch":return true;case "pen":return true;case "mouse":return false;default:if(ev.changedTouches&&ev.changedTouches.length>0||ev.touches&&ev.touches.length>
0)return true}return false}function checkUIAndPointerType(e){if(!checkPointerType(e))return false;return!helper.style.hasAnyParentsClass(e&&e.target?e.target:null,"uitaptarget ignoremouse")}function getRelativeTouchByPointerType(ev){return!_props.relativeTouch||ev&&ev.pointerType==="pen"?false:_props.relativeTouch}function getTouches(ev){if(ev){switch(ev.pointerType){case "touch":case "pen":if(ev.pointers.length>0)ev=ev.pointers[0];else if(ev.changedPointers.length>0)ev=ev.changedPointers[0];break;
case "mouse":break;default:if(ev.changedTouches&&ev.changedTouches.length>0)ev=ev.changedTouches[0];else if(ev.touches&&ev.touches.length>0)ev=ev.touches[0];break}return ev}else{logDebug("No event to get Touches!");return[{"x":-1,"y":-1}]}}function getTouchX(isRelative){return getTouchXFixed()+(isRelative?0:_args.container.scrollLeft*_props.zoomFactor)}function getTouchXFixed(){var t=getTouches(lastEvent);return parseInt(t.x||t.clientX||t.pageX,10)+(window.scrollX||window.pageXOffset)}function getTouchY(isRelative){return getTouchYFixed()+
(isRelative?0:_args.container.scrollTop*_props.zoomFactor)}function getTouchYFixed(){var t=getTouches(lastEvent);return parseInt(t.y||t.clientY||t.pageY,10)+getScrollTop()}var previousTapTime=0;var touchstate=0;var lastScale=null;var pinchGestureMinDistance=20;var wheelGestureMinDistance=20;var swipeFingerCount=3;var gesture=null;var captureStartEvent=null;var captureDistanceX=0;var captureDistanceY=0;const ucKeys=Object.keys(_props.mobileKeyboardEnumKeys??{}).reduce((acc,t)=>({...acc,[t.toUpperCase()]:_props.mobileKeyboardEnumKeys[t]}),
{});var wheelSettings={"axis":null,"direction":null,"previousValue":null,"thresholdStartDetection":15,"thresholdDistance":2,"stepValue":120,"inverted":typeof _props.mouseWheelDirection!="undefined"?_props.mouseWheelDirection==-1:false,"elapsedTime":0,"lasttimeSent":0,"sentTime":150};const _actionsCtx={init:{"wheel":{beforeTriggered:false}}};if(agentInfo.isChromium&&agentInfo.agentStr.indexOf("android 4.2.2")!=-1)$(document).click(function(e){var elem=(_props.relativeTouch?document.elementFromPoint(cursorCanvasX(),
cursorCanvasY()):null)||e.target;var tapElement=e&&e.target?e.target:null;if($(elem).hasClass("taptarget")||$(elem.parentElement).hasClass("taptarget")||$(elem).hasClass("disabled")){$(elem).trigger("tap");return}if($(elem).hasClass("ignoremouse")||$(elem.parentElement).hasClass("ignoremouse"))return;if($(tapElement).hasClass("uitaptarget")||$(tapElement).parents().hasClass("uitaptarget"))return;var currentTime=(new Date).getTime();if(currentTime-previousTapTime>50){previousTapTime=currentTime;lastEvent=
e;var x=getTouchXFixed();var y=getTouchYFixed();if(!zoomStarted){button="left";touchstate=1;try{mouseScrollX=x;mouseScrollY=y;if(_props.relativeTouch){startMouseX=cursorCanvasX();startMouseY=cursorCanvasY()}else{startMouseX=getTouchX(_props.relativeTouch);startMouseY=getTouchY(_props.relativeTouch)}var x=startMouseX;var y=startMouseY;if(typeof _methods.onTap!="undefined"){let abs=coord2Abs(x,y);_methods.onTap(abs.x,abs.y);e.preventDefault()}}finally{touchstate=0}if(touchstate==3)mouseMoveIntoView()}}else return});
function getGesture(e){var ret=null;if(e&&e.pointers.length>1){var fc=e.pointers.length;if(fc>=swipeFingerCount)ret="swipe";else{var wheelDistance=Math.max(Math.abs(captureStartEvent.center.x-e.center.x),Math.abs(captureStartEvent.center.y-e.center.y));var pinchDistance=Math.max(Math.abs(Math.abs(e.pointers[0].clientX-e.pointers[1].clientX)-captureDistanceX),Math.abs(Math.abs(e.pointers[0].clientY-e.pointers[1].clientY)-captureDistanceY));if(pinchDistance>pinchGestureMinDistance&&wheelDistance<wheelGestureMinDistance)ret=
"pinch";else if(wheelDistance>wheelGestureMinDistance&&pinchDistance<pinchGestureMinDistance)ret="wheel"}}return ret}function multiGestureEnds(){if(zoomStarted)window.setTimeout(function(){zoomStarted=false},300);gesture=null;if(touchstate==3)mouseMoveIntoView();wheelSettings.axis=null;captureStartEvent=null;captureDistanceX=0;captureDistanceY=0;clearTimeout(gestureTimeout);scrollLeftCapture=null;scrollTopCapture=null}function getMouseScreenPosition(){let position=findPos(_args.container);var mouseScreenPosition=
{x:(cursorCanvasX()-position[0])/_props.scale,y:(cursorCanvasY()-position[1])/_props.scale};return mouseScreenPosition}function divScroll(X,Y){X=Math.round(X);Y=Math.round(Y);if(divScrolling){if(_props.maxWidth+X>_props.viewWidth)X=_props.viewWidth-_props.maxWidth;else if(X<0)X=0;if(_props.maxHeight+Y>_props.viewHeight)Y=_props.viewHeight-_props.maxHeight;else if(Y<0)Y=0;_args.container.scrollLeft=X;_args.container.scrollTop=Y}else{X=getScrollLeft()+(mouseScrollX-X);Y=getScrollTop()+(mouseScrollY-
Y);if(_props.maxWidth+X>_props.viewWidth)X=_props.viewWidth-_props.maxWidth;else if(X<0)X=0;if(_props.maxHeight+Y>_props.viewHeight)Y=_props.viewHeight-_props.maxHeight;else if(Y<0)Y=0;window.scroll(X,Y)}mouseScrollX=X;mouseScrollY=Y;return}var scrollLeftCapture=null;var scrollTopCapture=null;var gestureTimeout=null;var _actionsProcessors={"pinchStart":function(e){oldGesture=gesture=null;if(e&&e.pointers.length>1){e.srcEvent.stopPropagation();e.srcEvent.preventDefault()}clearTimeout(gestureTimeout);
captureStartEvent=e;captureDistanceX=Math.abs(captureStartEvent.pointers[0].clientX-captureStartEvent.pointers[1].clientX);captureDistanceY=Math.abs(captureStartEvent.pointers[0].clientY-captureStartEvent.pointers[1].clientY);lastEvent=e;startMouseX=getTouchX(_props.relativeTouch);startMouseY=getTouchY(_props.relativeTouch);if(!zoomStarted){button="left";touchstate=1}lastScale=_props.zoomFactor},"pinchMove":function(e){if(gesture==null){oldGesture=gesture;gesture=getGesture(e);clearTimeout(gestureTimeout);
gestureTimeout=setTimeout(function(){var newGesture=getGesture(e);if(newGesture!=gesture&&gesture!=null){captureStartEvent=e;captureDistanceX=Math.abs(captureStartEvent.pointers[0].clientX-captureStartEvent.pointers[1].clientX);captureDistanceY=Math.abs(captureStartEvent.pointers[0].clientY-captureStartEvent.pointers[1].clientY)}if(gesture!==newGesture)oldGesture=gesture;gesture=newGesture},3E3)}},"zoomPanStart":function(e){oldGesture=gesture=null;clearTimeout(gestureTimeout);captureStartEvent=e;
captureDistanceY=Math.abs(captureStartEvent.pointers[0].clientY-captureStartEvent.pointers[1].clientY);captureDistanceX=Math.abs(captureStartEvent.pointers[0].clientX-captureStartEvent.pointers[1].clientX);lastEvent=e;startMouseX=getTouchX(_props.relativeTouch);startMouseY=getTouchY(_props.relativeTouch)},"zoomPanMove":function(e){if(gesture==null){oldGesture=gesture;gesture=getGesture(e);clearTimeout(gestureTimeout);gestureTimeout=setTimeout(function(){var newGesture=getGesture(e);if(newGesture!=
gesture&&gesture!=null){captureStartEvent=e;captureDistanceX=Math.abs(captureStartEvent.pointers[0].clientX-captureStartEvent.pointers[1].clientX);captureDistanceY=Math.abs(captureStartEvent.pointers[0].clientY-captureStartEvent.pointers[1].clientY)}if(gesture!==newGesture)oldGesture=gesture;gesture=newGesture},3E3)}},"screenPan":function(e){if(!_props.scaled)if(divScrolling){let th=5;var mX=_props.mouseX;let sl=_args.container.scrollLeft;let mw=_props.maxWidth;let vw=_props.viewWidth;var mY=_props.mouseY;
let st=_args.container.scrollTop;let mh=_props.maxHeight;let vh=_props.viewHeight;if(sl<mX+th-mw||mX<sl&&sl>mX-sl){mX=mX<sl?mX:mX+th-mw;if(mw+mX>vw)mX=vw-mw;else if(mX<0)mX=0;_args.container.scrollLeft=mX}if(st<mY+th-mh||mY<st&&st>mY-st){mY=mY<st?mY:mY+th-mh;if(mh+mY>vh)mY=vh-mh;else if(mY<0)mY=0;_args.container.scrollTop=mY}}else{var sl=getScrollLeft();var st=getScrollTop();var sw=screenWidth;var sh=screenHeight;if(sl<_props.mouseX-sw||_props.mouseX<sl&&sl>_props.mouseX-sl)sl=_props.mouseX<sl?_props.mouseX:
_props.mouseX-sw;if(st<_props.mouseY-sh||_props.mouseY<st&&st>_props.mouseY-st)st=_props.mouseY<st?_props.mouseY:_props.mouseY-sh;window.scroll(sl,st)}},"hold":function(e,btn){var relativeTouchFromPointer=getRelativeTouchByPointerType(e);if(held.indexOf(btn)===-1){held.push(btn);mouseDown(startMouseX,startMouseY,relativeTouchFromPointer,btn)}},"release":function(e,btn){var relativeTouchFromPointer=getRelativeTouchByPointerType(e);if(held.indexOf(btn)!==-1){held=held.filter(function(t){return t!==
btn});mouseUp(startMouseX,startMouseY,relativeTouchFromPointer,btn)}}};let _doubleClick={enable:true,previousEvtTime:0,count:0,maxTime:300,pos:{x:null,y:null},threshold:20};let singleClick=(x,y,relativeTouchFromPointer,button,fe)=>{mouseDown(x,y,relativeTouchFromPointer,button);mouseUp(x,y,relativeTouchFromPointer,button);if(fe)fireEvent("tap",{x,y,relative:relativeTouchFromPointer,button},_defaultEventsProps)};var actions=_touchManager["actions"]={"zoomPan":function(e){var eType=e&&e.type?e.type.toUpperCase():
null;if(eType.indexOf("START")!=-1)_actionsProcessors.zoomPanStart.call(this,e);else if(eType.indexOf("MOVE")!=-1)_actionsProcessors.zoomPanMove.call(this,e);else if(eType.indexOf("END")!=-1||eType.indexOf("CANCEL")!=-1)multiGestureEnds();else{lastEvent=e;var deltaX=(captureStartEvent.center.x-e.center.x)/_props.zoomFactor;var deltaY=(captureStartEvent.center.y-e.center.y)/_props.zoomFactor;if(scrollTopCapture==null)scrollTopCapture=_args.container.scrollTop;if(scrollLeftCapture==null)scrollLeftCapture=
_args.container.scrollLeft;var sl=scrollLeftCapture+deltaX;var st=scrollTopCapture+deltaY;divScroll(sl,st);touchstate=3}},"zoomOrWheel":function(e,actionArgs){var eType=e&&e.type?e.type.toUpperCase():null;if(eType.indexOf("START")!=-1)_actionsProcessors.pinchStart.call(this,e);else if(eType.indexOf("MOVE")!=-1)_actionsProcessors.pinchMove.call(this,e);else if(eType.indexOf("END")!=-1||eType.indexOf("CANCEL")!=-1)multiGestureEnds();else if(gesture=="pinch")actions.zoom.call(this,e,actionArgs);else if(gesture==
"wheel")actions.wheel.handler.call(this,e,actionArgs)},"key":function(e,{code,ch=0,direction,loc=0}={}){code=typeof code=="string"?ucKeys[code.toUpperCase()]??null:code;_methods.sendKey(code,ch,direction,loc)},"wheel":{on:"ALL",handler:function(e,{direction="VERTICAL",gesture:acgesture="PAN",stepValue=wheelSettings.stepValue,speedRelative,stepValue:stepValueOg,triggerAction=()=>{},sensitivity}={}){const {type,additionalEvent,scale}={...e,type:e.type.toUpperCase(),additionalEvent:e.additionalEvent?.toUpperCase()};
if(!_actionsCtx["wheel"])_actionsCtx["wheel"]={..._actionsCtx.init.wheel};acgesture=acgesture?.toUpperCase?.()??"PAN";const matchingACGestures={"ZOOM":"pinch","PAN":"wheel"};if(type.includes("START")){_actionsProcessors.pinchStart.call(this,e);if(acgesture=="ZOOM")wheelSettings.lastScale=null;_actionsCtx["wheel"].beforeTriggered=false;sensitivity.reset()}else if(type.includes("MOVE")){if(gesture!==null)if(matchingACGestures[acgesture]==gesture)if(oldGesture==null&&!_actionsCtx["wheel"].beforeTriggered){triggerAction(gesturesOnStates.BEFORE);
_actionsCtx["wheel"].beforeTriggered=true}else triggerAction(gesturesOnStates.WHILE);_actionsProcessors.pinchMove.call(this,e);if(acgesture=="ZOOM"&&matchingACGestures[acgesture]==gesture){let pinchDirection=wheelSettings.lastScale!=null?wheelSettings.lastScale>=scale?-1:1:null;pinchDirection=!pinchDirection&&additionalEvent?additionalEvent.split("_")[1]?.includes("IN")?-1:1:pinchDirection;if(pinchDirection){let wheelX,wheelY=0;wheelSettings.lastScale=scale;const step=stepValue*pinchDirection;wheelX=
direction=="HORIZONTAL"?step:0;wheelY=direction=="VERTICAL"?step:0;if(sensitivity.isValid())_methods.sendWheel(wheelY,wheelX);sensitivity.call()}}}else if(type.includes("END")){if(gesture!==null&&matchingACGestures[acgesture]==gesture)triggerAction(gesturesOnStates.AFTER);multiGestureEnds();if(acgesture=="ZOOM")wheelSettings.lastScale=null}else{if(["PAN"].includes(acgesture))if(gesture!==null&&matchingACGestures[acgesture]==gesture)triggerAction(gesturesOnStates.WHILE);if(acgesture=="PAN"&&matchingACGestures[acgesture]==
gesture){if(wheelSettings.axis==null){if(Math.abs(e.deltaY)>wheelSettings.thresholdStartDetection)wheelSettings.axis="vertical";else if(Math.abs(e.deltaX)>wheelSettings.thresholdStartDetection)wheelSettings.axis="horizontal";wheelSettings.previousValue=0}var step=0;if(wheelSettings.axis!=null){if(typeof _props.mouseWheelStepValue!="undefined"&&wheelSettings.stepValue!=_props.mouseWheelStepValue&&_props.mouseWheelStepValue>0)wheelSettings.stepValue=_props.mouseWheelStepValue;if(typeof _props.mouseWheelDirection!=
"undefined")wheelSettings.inverted=_props.mouseWheelDirection==-1;function getStep(deltaAxis,speedAxis,{stepValue=null,speedRelative=true}={}){var delta=Math.abs(deltaAxis-wheelSettings.previousValue);speedAxis=Math.abs(speedAxis);if(delta>wheelSettings.thresholdDistance){if(wheelSettings.axis=="vertical")if(deltaAxis<wheelSettings.previousValue)wheelSettings.direction=!wheelSettings.inverted?-1:1;else wheelSettings.direction=!wheelSettings.inverted?1:-1;else if(deltaAxis<wheelSettings.previousValue)wheelSettings.direction=
!wheelSettings.inverted?1:-1;else wheelSettings.direction=!wheelSettings.inverted?-1:1;var v=Math.abs(speedAxis);step=speedRelative?v<.05?1:v<.08?2:3:1;step*=wheelSettings.stepValue*wheelSettings.direction;wheelSettings.previousValue=deltaAxis;return step}else return 0}var xStep=0,yStep=0;if(wheelSettings.axis=="horizontal")xStep=getStep(e.deltaX,e.velocityX,{stepValue:stepValueOg,speedRelative:speedRelative??(stepValueOg??true)===true});else if(wheelSettings.axis=="vertical")yStep=getStep(e.deltaY,
e.velocityY,{stepValue:stepValueOg,speedRelative:speedRelative??(stepValueOg??true)===true});if(xStep!=0||yStep!=0){var t=(new Date).getTime();if(t-wheelSettings.lasttimeSent>wheelSettings.sentTime){if(sensitivity.isValid()){_methods.sendWheel(yStep,xStep);wheelSettings.lasttimeSent=t}sensitivity.call()}}}}}}},"zoom":function(e){var eType=e&&e.type?e.type.toUpperCase():null;if(eType.indexOf("START")!=-1)_actionsProcessors.pinchStart.call(this,e);else if(eType.indexOf("MOVE")!=-1)_actionsProcessors.pinchMove.call(this,
e);else if(eType.indexOf("END")!=-1||eType.indexOf("CANCEL")!=-1)multiGestureEnds();else{if(_props.scaled)return;var scale=e.scale||e.gesture.scale;if(scale<1)scale=scale*1.075;else scale=scale*.955;var dif=Math.abs(1-scale);if(dif>.1){zoomStarted=true;var mouseScreenPosition=getMouseScreenPosition();var absX=mouseScreenPosition.x;var absY=mouseScreenPosition.y;var screenX=absX-_args.container.scrollLeft;var screenY=absY-_args.container.scrollTop;var pX=screenX*100/_props.maxWidth;var pY=screenY*
100/_props.maxHeight;_methods.zoom(lastScale*scale);var sL=absX-_props.maxWidth*pX/100;var sT=absY-_props.maxHeight*pY/100;_args.container.scrollLeft=sL;_args.container.scrollTop=sT}lastEvent=e}},"mouseMove":function(e){if(_args.extra.preventDefault(e))return;lastEvent=e;var relativeTouchFromPointer=getRelativeTouchByPointerType(e);if(relativeTouchFromPointer){if(e&&e.type&&e.type.toUpperCase().indexOf("PAN")!=-1)if(e.type.toUpperCase().indexOf("START")!=-1||e.deltaX===0&&e.deltaY===0){startMouseX=
getTouchX(relativeTouchFromPointer)-e.deltaX;startMouseY=getTouchY(relativeTouchFromPointer)-e.deltaY}else{if(e.type.toUpperCase().indexOf("MOVE")!=-1)mouseMove(getTouchX(relativeTouchFromPointer),getTouchY(relativeTouchFromPointer),relativeTouchFromPointer)}else{startMouseX=getTouchX(relativeTouchFromPointer)-e.deltaX;startMouseY=getTouchY(relativeTouchFromPointer)-e.deltaY}_actionsProcessors.screenPan(e)}else{if(e&&e.type&&e.type.toUpperCase().indexOf("PAN")!=-1&&e.type.toUpperCase().indexOf("MOVE")===
-1)return;startMouseX=getTouchX(relativeTouchFromPointer);startMouseY=getTouchY(relativeTouchFromPointer);mouseMove(startMouseX,startMouseY,relativeTouchFromPointer);_methods.forceMouseMove()}},"click":function(e){if(_args.extra.preventDefault(e))return;if(!zoomStarted){var x=getTouchXFixed();var y=getTouchYFixed();button="left";touchstate=1;var relativeTouchFromPointer=getRelativeTouchByPointerType(e);try{mouseScrollX=x;mouseScrollY=y;var x=startMouseX;var y=startMouseY;if(productId=="virtualui"){var headerBtnElem=
_args.extra.getElementFromPoint({"touches":[{"pageX":x,"pageY":y}]});if(headerBtnElem&&headerBtnElem.parentElement!=null&&headerBtnElem.parentElement.className=="buttons"){$(headerBtnElem).click();e.preventDefault();return}}let dNow=Date.now();var mPosition=coord2Abs(x,y);if(relativeTouchFromPointer)fireEvent("showMouseMask",mPosition.x+32,mPosition.y+32,"clickEffect",true,_defaultEventFire);else fireEvent("showMouseMask",x/_props.zoomFactor,y/_props.zoomFactor,"clickEffect",true,_defaultEventFire);
if(_doubleClick.enable){if(dNow-_doubleClick.previousEvtTime<_doubleClick.maxTime){let d=Math.abs(x-_doubleClick.pos.x)+Math.abs(y-_doubleClick.pos.y);if(d<_doubleClick.threshold){x=_doubleClick.pos.x;y=_doubleClick.pos.y}}_doubleClick.pos.x=x;_doubleClick.pos.y=y}_doubleClick.previousEvtTime=dNow;singleClick(x,y,relativeTouchFromPointer,button,true);if(productId!="webfmx"&&productId!="virtualui")lastMouseClickPosition=mPosition}finally{touchstate=0}if(touchstate==3)mouseMoveIntoView()}},"pressRelease":function(e){if(_args.extra.preventDefault(e))return;
var relativeTouchFromPointer=getRelativeTouchByPointerType(e);var p=findPos(_args.container);var x=relativeTouchFromPointer?cursorCanvasX():startMouseX;var y=relativeTouchFromPointer?cursorCanvasY():startMouseY;let abs=coord2Abs(x,y);_methods.pressAndRelease(abs.x,abs.y)},"holdLeft":function(e){_actionsProcessors.hold(e,"left")},"holdRight":function(e){_actionsProcessors.hold(e,"right")},"releaseLeft":function(e){_actionsProcessors.release(e,"left")},"releaseRight":function(e){_actionsProcessors.release(e,
"right")},"releaseAll":function(e){actions.releaseLeft(e);actions.releaseRight(e);fireEvent("release",e,_defaultEventFire)},"doubleClick":function(e){var relativeTouchFromPointer=getRelativeTouchByPointerType(e);var x=relativeTouchFromPointer?cursorCanvasX():startMouseX;var y=relativeTouchFromPointer?cursorCanvasY():startMouseY;btnLeftClick(x,y);btnLeftClick(x,y)},"rightClick":function(e){var relativeTouchFromPointer=getRelativeTouchByPointerType(e);var x=relativeTouchFromPointer?cursorCanvasX():
startMouseX;var y=relativeTouchFromPointer?cursorCanvasY():startMouseY;sendButtonRight(x,y)},"swipeFromEdge":function(){if(_methods.swipeFromEdge)_methods.swipeFromEdge()},"swipe":function(e){if(_methods.swipe)_methods.swipe()},"focus":function(e){}};var actionsCompatibility=[{name:"focus",products:["virtualui"]}];actionsCompatibility.forEach(function(t){if(_touchManager["actions"][t.name]&&!t.products.includes(productId))delete _touchManager["actions"][t.name]});_touchManager["gesturesMiddleware"]=
function(e){return checkUIAndPointerType(e)};_touchManager["touchStartRedirection"]=function(e,touches){_args.extra.preventDefault(e);redirectTouches("begin",touches)};_touchManager["touchMoveRedirection"]=function(e,touches){_args.extra.preventDefault(e);redirectTouches("update",touches)};_touchManager["touchEndRedirection"]=function(e,touches){_args.extra.preventDefault(e);redirectTouches("end",touches)};_touchManager.initialize(document.body,_args.gestures,{});if(_readyCallback)_readyCallback();
_ready=true}function findPos(obj){var curleft=0;var curtop=0;do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop}while(obj=obj.offsetParent);return[curleft,curtop]}function redirectTouches(action,touchList){var vncd=_args.container;for(var i=0;i<touchList.length;i++){var touch=touchList[i];let s=_props.scale;var x=(touch.pageX-vncd.offsetLeft+vncd.scrollLeft)/s|0;var y=(touch.pageY-vncd.offsetTop+vncd.scrollTop)/s|0;var id=touch.identifier;_methods.sendEvent(`cmd=touch&action=${action}&id=${id}&x=${x}&y=${y}`)}}
function coord2Abs(x,y){let position=findPos(_args.container);return{x:(x-position[0])/_props.scale,y:(y-position[1])/_props.scale}}function mouseDown(x,y,isRelative,button){lastY=y;let abs=coord2Abs(getRelativeX(x,isRelative)+deltaCursorX,getRelativeY(y,isRelative)+deltaCursorY);_methods.sendMouse(abs.x,abs.y,button=="right"?2:0,"down")}function mouseUp(x,y,isRelative,button){let abs=coord2Abs(getRelativeX(x,isRelative)+deltaCursorX,getRelativeY(y,isRelative)+deltaCursorY);_methods.sendMouse(abs.x,
abs.y,button=="right"?2:0,"up")}function mouseMove(x,y,isRelative){var relX=getRelativeX(x,isRelative)+deltaCursorX;var relY=getRelativeY(y,isRelative)+deltaCursorY;let abs=coord2Abs(relX,relY);_methods.sendMouse(abs.x,abs.y,0,"move");if(lastEvent&&getRelativeTouchByPointerType(lastEvent)){startMouseX=savedX;startMouseY=savedY}}function mouseMoveIntoView(){if(_props.relativeTouch){var x=cursorCanvasX();var y=cursorCanvasY();var z=_props.zoomFactor;if(x<=_args.container.scrollLeft*z)x=_args.container.scrollLeft*
z;else if(x>=(_props.maxWidth+_args.container.scrollLeft)*z)x=(_props.maxWidth+_args.container.scrollLeft)*z;if(y<=_args.container.scrollTop*z)y=_args.container.scrollTop*z;else if(y>=(_props.maxHeight+_args.container.scrollTop)*z)y=(_props.maxHeight+_args.container.scrollTop)*z;if(x!=cursorCanvasX()||y!=cursorCanvasY()){let abs=coord2Abs(x,y);_methods.mouseMove(abs.x,abs.y)}}}function getRelativeX(X,isRelative){if(isRelative){savedX=X;X=X-startMouseX+cursorCanvasX();X=X<0?0:X}return Math.round(X)}
function getRelativeY(Y,isRelative){if(isRelative){savedY=Y;Y=Y-startMouseY+cursorCanvasY();Y=Y<0?0:Y}return Math.round(Y)}function getRelativeTouchByPointerType(ev){return!_props.relativeTouch||ev&&ev.pointerType==="pen"?false:_props.relativeTouch}function cursorCanvasX(){return _props.cursorCanvasX}function cursorCanvasY(){return _props.cursorCanvasY}function dispose(){if(_touchManager){oInterface.off("serverSupportsRedirection",_touchManager.serverSupportsRedirection);oInterface.off("startTouchRedirection",
_touchManager.reconfigureForRedirection);oInterface.off("stopTouchRedirection",_touchManager.reconfigureForLocalGestures)}_readyCallback=null;_touchManager=null;fireEvent=_noop;_ready=false}function ready(callback){if(_ready)callback();_readyCallback=callback}initialize();Object.defineProperty(_ref,"dispose",{enumerable:true,configurable:false,writable:false,value:dispose});Object.defineProperty(_ref,"ready",{enumerable:true,configurable:false,writable:false,value:ready});return _ref}try{Thinfinity!=
undefined}catch(e){Thinfinity={}}if(Thinfinity.Driver===undefined)Thinfinity.Driver={};Thinfinity.Driver.Touch=DTouch;Object.defineProperty(DTouch,"defaultTouchGestures",{"enumerable":true,"configurable":false,"get":function(){return _defaultTouchGestures}})})();
(function(){function ThinClipboard(args){var self=this;var ftPath="ft/";this.fileUpload={arrayJsonData:null,maxUploadCount:3,uploaded:0,nextUploadIdx:0,uploading:0,uploadErrors:null,filesUploading:null,uploadErrors:null,onClear:null,onFileAdd:null,onUploadFinish:null,progressBar:null,progressContainerID:"FUProgressContainer",init:function(startDrag){this.clear();if(typeof startDrag=="undefined")startDrag=true;if(startDrag&&window.File&&window.FileReader&&window.FileList&&window.Blob);},clear:function(){this.filesUploading=
new Array;if(this.progressBar!=null){for(var pb=0;pb<this.progressBar.length;pb++)if(this.progressBar[pb]){this.progressBar[pb].remove();delete this.progressBar[pb]}var fupc=document.getElementById(this.progressContainerID);if(fupc)fupc.parentElement.removeChild(fupc);document.getElementById("fileToUpload").form.reset()}this.progressBar=null;if(this.onClear)this.onClear()},add:function(file,path){this.filesUploading.push({"file":file,"path":path});if(this.onFileAdd)this.onFileAdd(file)},startNextUploads:function(){var startFrom=
this.nextUploadIdx;for(var i=startFrom;i<this.toUpload;i++){if(this.uploading>=this.maxUploadCount)break;this.uploadFile(this.filesUploading[i],i);this.nextUploadIdx++;this.uploading++}},startUploading:function(){if(this.uploading==0){this.uploaded=0;this.nextUploadIdx=0;this.uploadErrors=new Array;this.arrayJsonData=new Array}this.toUpload=this.filesUploading.length;for(var i=0;i<this.toUpload;i++)this.addProgress(this.filesUploading[i],i);this.startNextUploads()},uploadFile:function(fileItem,idx){if(typeof FormData!=
"undefined"){var fd=new FormData;fd.append("fileToUpload",fileItem.file);helper.ajax.post({"timeout":0,"url":"clip/"+encodeURIComponent(fileItem.path+(fileItem.path.length==0?"":"/")+fileItem.file.name),"beforeSend":function(xhr){if(typeof window.addEventListener!="undefined"){xhr.upload.addEventListener("progress",function(evt){if(!self.fileUpload.uploadProgress(evt,idx))xhr.abort()},false);xhr.addEventListener("load",function(evt){self.fileUpload.uploadComplete(evt,fileItem.file.name,idx)},false);
xhr.addEventListener("error",function(evt){self.fileUpload.uploadFailed(evt,fileItem.file.name,idx)},false);xhr.addEventListener("abort",function(evt){self.fileUpload.uploadCanceled(evt,idx)},false)}else if(typeof window.attachEvent!="undefined"){xhr.upload.attachEvent("progress",function(evt){if(!self.fileUpload.uploadProgress(evt,idx))xhr.abort()},false);xhr.attachEvent("load",function(evt){self.fileUpload.uploadComplete(evt,fileItem.file.name,idx)});xhr.attachEvent("error",function(evt){self.fileUpload.uploadFailed(evt,
fileItem.file.name,idx)});xhr.attachEvent("abort",function(evt){self.fileUpload.uploadCanceled(evt,idx)})}xhr.setRequestHeader("X-Request-Condition","no-webdav");xhr.setRequestHeader("X-Request-Sanitize","false");xhr.setRequestHeader("X-Request-UploadType","clip")},"data":fd})}},uploadProgress:function(evt,idx){if(!this.progressBar||!this.progressBar[idx]){logError("uploadProgress: progressBar not assigned.");return false}if(evt.lengthComputable){var pc=parseInt(evt.loaded/evt.total*100);this.progressBar[idx].maxValue=
100;this.progressBar[idx].setPos(pc)}else{this.progressBar[idx].maxValue=0;this.progressBar[idx].setMessage(thinRDPconsts.uploading)}return true},uploadComplete:function(evt,filename,idx){var fu=self.fileUpload;var src=evt.sourceElement||evt.target;if(src&&src.status!=200)if(!src.responseXML)if(typeof src.readyState=="undefined"||src.readyState!="complete"){fu.uploadFailed(evt,filename,idx);return}else this.progressBar[idx].setPos(100);else if(!src.responseText.match(/200 OK/)){fu.uploadFailed(evt,
filename,idx);return}$(window).trigger("uploadComplete");logDebug("uploadComplete "+idx);fu.uploading--;fu.uploaded++;if(fu.uploaded==fu.toUpload)fu.uploadFinish();else fu.startNextUploads()},uploadFailed:function(evt,filename,idx){var fu=self.fileUpload;$(window).trigger("uploadFailed",evt);var src=evt.sourceElement||evt.target;var sError=helper.string.sprintf("Error %s (%s) uploading '%s'",src.status,src.statusText,filename);fu.uploadErrors.push(sError);logDebug("upload failed "+idx+": "+sError);
this.progressBar[idx].setClass("failed");fu.uploading--;fu.uploaded++;if(fu.uploaded==fu.toUpload)fu.uploadFinish();else fu.startNextUploads()},uploadCanceled:function(evt,idx){var fu=self.fileUpload;$(window).trigger("uploadCanceled");logDebug("upload canceled "+idx);if(!this.progressBar||!this.progressBar[idx]){logError("uploadCanceled: progressBar not assigned.");return}this.progressBar[idx].setClass("failed");fu.uploading--;fu.uploaded++;if(fu.uploaded==fu.toUpload)fu.uploadFinish();else fu.startNextUploads()},
uploadFinish:function(){if(this.onUploadFinish)this.onUploadFinish(this);else{function clearFileUpload(){self.fileUpload.clear();Thinfinity.Popups.unblock()}clearFileUpload()}},progressContainer:function(){var fuc=document.getElementById(this.progressContainerID);if(!fuc)fuc=helper.dom.appendJsonElement({"parentElement":document.body,"type":"div","attributes":{"id":this.progressContainerID}});return fuc},addProgress:function(fileItem,idx){if(!this.progressBar)this.progressBar=new Array;if(idx<this.progressBar.length)return;
var fuc=this.progressContainer();var pb=new ProgressBar({"id":this.progressContainerID,"idx":idx,"fileName":fileItem.path+"/"+fileItem.file.name,"background-color":"#FF0","barHeight":"20px","mask":"<span class='upfilename'>"+fileItem.file.name+" ("+this.formatedSize(fileItem.file.size)+")</span><span class='upfilepercent'>$d%</span>"});pb.init();pb.setMessage(fileItem.file.name+" ("+this.formatedSize(fileItem.file.size)+")");this.progressBar[idx]=pb},formatedSize:function(val){var unit=" KB";if(val>
1048576){val=val/1048576;unit=" MB"}else val=val/1024;return Math.ceil(val*100)/100+unit}};var _ref=this;var _initialized=false;var _binded=false;var _type="clipboard";var _copyingTemplate=null;var _asyncCopy=false;var _args={inputElem:null,parentElement:null,canPasteFiles:true,properties:null,methods:{setSelectionRange:null,sendEvent:null,sendCmd:null,sendData:null,convertImgURLToBase64:null,getBasicHTMLImg:null,output:null,clearText:null,request:null},events:{copy:null,paste:null,cut:null,localPaste:null,
copyFiles:null}};var _clipboardSettings=null;var fireEvent=null;var _te={};var _untreatData=[];var _lastCopy={hash:null,types:[]};function initialize(){helper.object.parseAttributes(_args,args);if(args?.properties?.clipboard){helper.object.parseAttributes(_args,args.properties.clipboard);_clipboardSettings=args.properties.clipboard;synchronizeClipboard()}fireEvent=(new Thinfinity.Events({"owner":_te,"events":_args.events})).fireEvent;if(!agentInfo.isMac&&!_initialized)initText();bindEvents();var ct=
document.getElementById("copyingTemplate");if(ct)_copyingTemplate=ct;else if(!_copyingTemplate)_copyingTemplate=helper.dom.appendJsonElement({type:"div",parentElement:_args.parentElement,attributes:{id:"copyingTemplate",class:"copyingTemplate hidden"},content:consts.copyingMsg})}function synchronizeClipboard(){if(_clipboardSettings?.properties?.synchronizeClipboard){function isValidFormat(mimetype){return!mimetype.startsWith("image/")}navigator.permissions.query({name:"clipboard-read"}).then(permission=>
{if(permission.state==="denied")throw new Error("Not allowed to access to the clipboard.");else if(args.on){let textHash=null;var syncRemoteClipboard=e=>{let clipboardContentHandler=clipboardContents=>{_args.methods.sendEvent("cmd=cli&type=precli&action=paste&id="+_args.properties.sid);let promisesTypes=[];for(const item of clipboardContents)if(item.types)item.types.forEach(type=>{promisesTypes.push(item.getType(type))});Promise.all(promisesTypes).then(values=>{let promisesValues=[];let mimetypes=
[];if(values)values.forEach(res=>{if(res&&isValidFormat(res.type)){mimetypes.push(res.type);promisesValues.push(res.text())}else;});let arrayJsonData=[];Promise.all(promisesValues).then(values=>{let idx=0;values.forEach(text=>{arrayJsonData.push({mimetype:mimetypes[idx++],textdata:text})});let th=convertToHash(arrayJsonData.map(item=>{return item.textdata}).join(""));if(textHash!=th){textHash=th;_args.methods.sendData("cmd?id="+_args.properties.sid+"&cmd=cli&type=clipboard&action=clisync",encodeURIComponent(JSON.stringify(arrayJsonData)));
_args.methods.output({"cmd":"focus"})}})})};navigator.clipboard.read({unsanitized:["text/html"]}).then(clipboardContentHandler).catch(err=>{mustBeSynchronized=true;helper.console.log(`Cannot synchronize clipboard, ${err.message||err}`);args.__prototype__.fireEvent("requireUserInteractionAction")})};var syncLocalClipboard=obj=>{let textData=null;if(obj?.val)try{textData=JSON.parse(obj.val)}catch(err){helper.console.log(`Cannot synchronize local clipboard, invalid data.`)}if(textData){let clipItems=
{};let formatsCount=0;textData.forEach(item=>{if(ClipboardItem.supports(item.mimetype))if(item.mimetype.startsWith("image/"));else{clipItems[item.mimetype]=new Blob([item.textdata],{type:item.mimetype});formatsCount++}});if(formatsCount>0)navigator.clipboard.write([new ClipboardItem(clipItems)]).then(r=>{helper.console.log("Local clipboard was synchronized successfully!")}).catch(err=>{helper.console.log("Local clipboard cannot be synchronized.",err)})}};args.on("userInteractionAction",syncRemoteClipboard);
args.on("synchronizeRemoteClipboard",syncRemoteClipboard);args.on("synchronizeLocalClipboard",syncLocalClipboard);syncRemoteClipboard()}})}}function convertToHash(str){let maxLen=65;let arr=(new Array(maxLen)).fill(65);let pos=0;for(let i=0,t=Math.min(str.length-1,maxLen);i<t;i++){if(pos>maxLen)pos=0;arr[pos]+=str.charCodeAt(i);if(arr[pos]>127)arr[pos]=arr[pos]-128;pos++}return arr.join("")}function getHash(clipboardData,types){let hash="";let _types=[];if(clipboardData){let maxLen=65;let arr=(new Array(maxLen)).fill(65);
let pos=0;var convertToValue=function(str,arr){for(let i=0,t=str.length;i<t;i++){if(pos>maxLen)pos=0;arr[pos]+=str.charCodeAt(i);if(arr[pos]>127)arr[pos]=arr[pos]-128;pos++}};if(clipboardData instanceof DataTransfer)types.forEach(type=>{convertToValue(type+clipboardData.getData(type),arr)});else if(clipboardData instanceof Array)clipboardData.forEach(function(item){convertToValue(item.mimetype+item.textdata,arr);_types.push(item.mimetype)});else{convertToValue(types[0]+clipboardData,arr);_types=types}arr.forEach(function(v){hash+=
String.fromCharCode(v)})}return{hash,types:_types}}function isClipboardEmpty(clipboard){let isEmpty=true;if(clipboard)isEmpty=clipboard.files.length===0&&clipboard.items.length===0&&clipboard.types.length===0;return isEmpty}function bindEvents(){if(!_binded){if(!_args.inputElem)return;if(agentInfo.isMSIE)if(_args.methods.setSelectionRange)_args.methods.setSelectionRange();else{_args.inputElem.value="XXXX";_args.inputElem.setSelectionRange(0,3)}helper.dom.addEvent(_args.inputElem,"copy",copyHandler,
false);helper.dom.addEvent(_args.inputElem,"cut",cutHandler,false);helper.dom.addEvent(_args.inputElem,"paste",pasteHandler,false);helper.dom.addEvent(window,"focus",windowFocusHandler,false);if(!agentInfo.isMac)helper.dom.addEvent(_args.inputElem,"keydown",keydownHandler,false);_binded=true;_initialized=true}}function copyHandler(e){e.preventDefault();unbindEvents();var clipboardData=window.clipboardData!=undefined?window.clipboardData:e.clipboardData!=undefined?e.clipboardData:null;if(clipboardData){e.stopPropagation();
e.preventDefault();synccopy(clipboardData,false)}else bindEvents();setTimeout(function(){clear();setText("XXXX")},100)}function getFilesAndDirs(dt,finish){var dirScans=0;var dirScansDone=0;var queuedFiles=0;var addedFiles=0;var dataItems=new Array;var processFileEntry=function(item,dirPath){if(item.isDirectory){var directoryReader=item.createReader();readDirectory(directoryReader,dirPath+(dirPath.length==0?"":"/")+item.name)}else{queuedFiles++;item.file(function(file){dataItems.push({"path":dirPath,
"file":file});addedFiles++},function(){addedFiles++})}};var readDirectory=function(dirReader,dirPath){dirScans++;dirReader.readEntries(function(entries){entries.forEach(function(entry){processFileEntry(entry,dirPath)});if(entries.length>0)readDirectory(dirReader,dirPath);dirScansDone++})};if(dt&&dt.items)for(var i=0;i<dt.items.length;i++){var item=null;if(typeof dt.items[i].webkitGetAsEntry!="undefined")item=dt.items[i].webkitGetAsEntry();else if(typeof dt.items[i].getAsEntry!="undefined")item=dt.items[i].getAsEntry();
if(item)processFileEntry(item,"")}var finishInterval=setInterval(function(){if(dirScansDone>=dirScans&&addedFiles>=queuedFiles){clearInterval(finishInterval);finish(dataItems)}},20)}function pasteHandler(e){e.preventDefault();var arrayJsonData=[];e.stopPropagation();e.preventDefault();var clipboardData=window.clipboardData!=undefined?window.clipboardData:e.clipboardData!=undefined?e.clipboardData:null;if(isClipboardEmpty(clipboardData)||_lastCopy&&_lastCopy.hash===getHash(e.clipboardData,_lastCopy.types).hash)if(fireEvent("localPaste",
{},{"async":false}).preventExecution===true)return;_lastCopy=null;fireEvent("paste",{"cmd":"start"},{"async":false});var cmd="cmd=cli&type=precli&action=paste&id="+_args.properties.sid;_args.methods.sendEvent(cmd);if(clipboardData){var mimetype="text/plain";var filesToUpload=false;if(agentInfo.isMSIE&&agentInfo.msieVersion<=11){setText(clipboardData.getData("text"));arrayJsonData.push({"mimetype":mimetype,"textdata":clipboardData.getData("text")})}else{if(agentInfo.isSafari)if(clipboardData.types){clipboardData.types.length;
for(var i=0;i<clipboardData.types.length;i++){arrayJsonData.push({"mimetype":clipboardData.types[i],"textdata":clipboardData.getData(clipboardData.types[i])});if(arrayJsonData[arrayJsonData.length-1].textdata==undefined)arrayJsonData[arrayJsonData.length-1].textdata=""}var idx={"url":null,"image":null,"newItem":null};for(var i=0;i<arrayJsonData.length;i++){if(arrayJsonData[i].mimetype.substring(0,6)=="image/")idx.image=i;if(arrayJsonData[i].mimetype=="public.url")idx.url=i}if(idx.url!=null&&idx.image!=
null){arrayJsonData.push({"mimetype":"","textdata":undefined});idx.newItem=arrayJsonData.length-1;_args.methods.convertImgURLToBase64(arrayJsonData[idx.url].textdata,"image/png",function(mimetype,blob){if(blob!=null){var extension=arrayJsonData[idx.image].mimetype.substring(arrayJsonData[idx.image].mimetype.indexOf("/")+1,arrayJsonData[idx.image].mimetype.length);for(var i=arrayJsonData.length-1;i>=0;i--)if(arrayJsonData[i].mimetype.indexOf(extension)!=-1){arrayJsonData.splice(i,1);idx.newItem--}arrayJsonData[idx.newItem].mimetype=
mimetype;arrayJsonData[idx.newItem].textdata=blob}else{var response=_args.methods.getBasicHTMLImg(arrayJsonData[idx.url].textdata);if(response)arrayJsonData[idx.newItem]={"mimetype":"text/html","textdata":response};else arrayJsonData.splice(idx.newItem,1)}})}}else;else{for(var index=clipboardData.items.length-1;index>=0;index--){var item=clipboardData.items[index];if(item.kind==="file"){let hasEntry=null;try{if(typeof item.webkitGetAsEntry!="undefined")hasEntry=item.webkitGetAsEntry();else if(typeof item.getAsEntry!=
"undefined")hasEntry=item.getAsEntry()}catch(err){helper.console.debug(helper.string.format("Could not process item with getAsEntry '{0}' - type: '{1}'",item.kind,item.type),arguments)}if(hasEntry){if(!_args.canPasteFiles)continue;if(!filesToUpload){filesToUpload=true;if(self.fileUpload.uploading==0)self.fileUpload.init(false)}}else if(item.type.substring(0,6)=="image/"||item.type=="application/x-moz-file"){arrayJsonData.push({"mimetype":item.type,"item":item,"getTextData":async function(index){var blob=
arrayJsonData[index].item.getAsFile();if(agentInfo.isFirefox)arrayJsonData[index].mimetype=blob.type;var reader=new FileReader;reader.onload=function(event){arrayJsonData[index].textdata=event.target.result!=undefined?event.target.result:"";delete arrayJsonData[index].item;delete arrayJsonData[index].getTextData};reader.readAsDataURL(blob)}});arrayJsonData[arrayJsonData.length-1].getTextData(arrayJsonData.length-1)}}else if(item.kind==="string")try{mimetype=item.type;arrayJsonData.push({"mimetype":item.type,
"item":item,"getTextData":function(index){arrayJsonData[index].item.getAsString(function(elem){arrayJsonData[index].textdata=elem!=undefined?encodeURIComponent(elem):"";delete arrayJsonData[index].item;delete arrayJsonData[index].getTextData})}});arrayJsonData[arrayJsonData.length-1].getTextData(arrayJsonData.length-1)}catch(error){helper.console.warning(helper.string.format("Unknown kind: '{0}' - type: '{1}'",item.kind,item.type),arguments)}else helper.console.warning(helper.string.format("Unknown kind: '{0}' - type: '{1}'",
item.kind,item.type),arguments)}if(filesToUpload)getFilesAndDirs(clipboardData,function(fileList){function sendFiles(){var fileIndex=0;for(var fileItem of fileList){arrayJsonData.push({"mimetype":"application/octet-stream","textdata":{"index":fileIndex++,"filename":fileItem.file.name,"path":fileItem.path,"size":fileItem.file.size}});self.fileUpload.add(fileItem.file,fileItem.path)}self.fileUpload.startUploading();self.postPaste(arrayJsonData)}var url="cmd?id="+_args.properties.sid+"&cmd=cli&type="+
_type+"&action=canPasteFiles";var params={url,async:_asyncCopy,cache:false,dataType:"json",error:function(jqXHR,err){},success:function(obj){if(typeof obj=="string")obj=JSON.parse(obj);if(typeof obj.res!="undefined"&&obj.res===true)sendFiles();else{var msg=consts.pasteOperationInProgress;if(typeof obj.canRetry!="undefined"&&obj.canRetry===true)Thinfinity.Popups.choice({"parentElement":document.body,"id":"pasteRetryDlg","iconType":"alertIco","title":"Clipboard","message":msg,"buttons":[{"value":consts.ok,
"class":"","action":function(){_args.inputElem.focus()}},{"value":consts.retry,"class":"","action":sendFiles}]});else{if(typeof obj.disabled!="undefined"&&obj.disabled===true)msg=consts.clipboardFileTransferDisabled;Thinfinity.Popups.alert(msg,"Clipboard","","","",function(){Thinfinity.Popups.unblock();_args.inputElem.focus()},false)}}}};_args.methods.request(params)})}if(arrayJsonData.length==0&&!filesToUpload)setText(clipboardData.getData(mimetype))}if(!filesToUpload)var intrv=setInterval(function(){if(arrayJsonData.length>
0){for(var i=0;i<arrayJsonData.length;i++)if(typeof arrayJsonData[i].textdata=="undefined")return;clearInterval(intrv);postPaste(arrayJsonData)}},100)}if(arrayJsonData.length==0)if(agentInfo.isMac)postPaste({});else setTimeout(function(){postPaste({})},100)}function postPaste(arrayJsonData){_args.methods.sendData("cmd?id="+_args.properties.sid+"&cmd=cli&type=clipboard&action=paste",encodeURIComponent(JSON.stringify(arrayJsonData)));initText();if(agentInfo.isMac&&agentInfo.isChrome)_args.methods.output({"cmd":"focus"});
fireEvent("paste",{"cmd":"done"},{"async":false})}function cutHandler(e){e.preventDefault();unbindEvents();var clipboardData=window.clipboardData!=undefined?window.clipboardData:e.clipboardData!=undefined?e.clipboardData:null;if(clipboardData){e.stopPropagation();e.preventDefault();synccopy(clipboardData,true)}else bindEvents();setTimeout(function(){initText()},100)}function windowFocusHandler(e){if(_untreatData.length>0){if(_asyncCopy)_untreatData.forEach(function(item){writeClipboardData(null,item.clipContent,
item.eventName)});_untreatData=[]}}function keydownHandler(e){if(e.ctrlKey&&!e.altKey&&e.keyCode!=17&&agentInfo.isFirefox)if(e.keyCode==88||e.keyCode==86||e.keyCode==67){e.stopPropagation();return}}function setResponseToClipboard(clipboardData,clipContent,eventName){var hf=document.hasFocus();if(hf||!_asyncCopy)writeClipboardData(clipboardData,clipContent,eventName);else _untreatData.push({eventName,clipContent})}function writePNG(data){const img=new Image;const c=document.createElement("canvas");
const ctx=c.getContext("2d",{willReadFrequently:true});function setCanvasImage(path,callback){img.onload=function(){c.width=this.naturalWidth;c.height=this.naturalHeight;ctx.drawImage(this,0,0);c.toBlob(blob=>{callback(blob)},"image/png")};img.src=path}setCanvasImage("data:image/png;base64,"+data,imgBlob=>{_lastCopy=null;navigator.clipboard.write([new ClipboardItem({"image/png":imgBlob})]).then(res=>{delete img;delete c}).catch(e=>{helper.console.warning(e);delete img;delete c})})}function writeClipboardData(clipboardData,
clipContent,eventName){_lastCopy=null;try{if(typeof clipContent=="object"){var binData=[];for(var i=0;i<clipContent.length;i++){var content=clipContent[i];if(_asyncCopy){var blob=new Blob([content.textdata],{type:content.mimetype});binData.push(new ClipboardItem({[content.mimetype]:blob}))}else if(content.mimetype=="image/png")writePNG(content.textdata);else{var handled=false;if(content.mimetype=="application/json"){var clipData=JSON.parse(content.textdata);if(clipData.type)if(clipData.type=="fileList"&&
_clipboardSettings.properties.permissions.fileTransfer){var list=[];clipData.files.forEach(function(item){list.push({date:item.date,filename:item.filename,download:`clip/${item.filename}`,url:`clip/${item.filename}`,size:item.size})});fireEvent("copyFiles",list,{"async":false});handled=true;clipboardData.setData("text/plain","");_lastCopy=getHash("",["text/plain"])}}if(!handled){clipboardData.setData(content.mimetype,content.textdata);_lastCopy=getHash(content.textdata,[content.mimetype])}}}if(_asyncCopy)if(!document.hasFocus())fireEvent(eventName,
{"cmd":"err","msg":"DOMException: Document is not focused"},{"async":false});else navigator.clipboard.write(binData)}else{if(!_asyncCopy)clipboardData.setData("text/plain",clipContent);else navigator.clipboard.writeText(clipContent);_lastCopy=getHash(clipContent,["text/plain".mimetype])}fireEvent(eventName,{"cmd":"done"},{"async":false})}catch(err){helper.console.error("[Clipboard] Something went wrong while trying to set clipboard data.",err)}}function unbindEvents(){if(_binded==true){helper.dom.removeEvent(_args.inputElem,
"copy",copyHandler);helper.dom.removeEvent(_args.inputElem,"cut",cutHandler);helper.dom.removeEvent(_args.inputElem,"paste",pasteHandler);helper.dom.removeEvent(_args.inputElem,"keydown",keydownHandler);helper.dom.removeEvent(document,"focus",windowFocusHandler,false)}_binded=false}function initText(){clear();setText("XXXX")}function setText(text){_args.methods.output({"cmd":"settext","value":text});_args.methods.setSelectionRange()}function clear(){_args.methods.clearText()}function synccopy(clipboardData,
cut){var cmd="cmd=cli&type=precli&action="+(cut?"cut":"copy")+"&id="+_args.properties.sid;_args.methods.sendEvent(cmd);var result="";var url="cmd?id="+_args.properties.sid+"&cmd=cli&type="+_type;if(cut!=undefined&&cut)url+="&action=cut&dokey=true";else url+="&action=copy&dokey=true";var eventName=cut===true?"cut":"copy";if(fireEvent(eventName,{"cmd":"start"},{"async":false}).preventExecution!==true)helper.style.replace(_copyingTemplate,"hidden","visible");try{var params={url,async:_asyncCopy,cache:false,
dataType:"json",error:function(jqXHR,err){helper.style.replace(_copyingTemplate,"visible","hidden");bindEvents();if(fireEvent(eventName,{"cmd":"error","err":err},{"async":false}).preventExecution!==true)alert(helper.string.sprintf(consts.connectError,JSON.stringify(err)))},success:function(obj){try{bindEvents();if(obj&&typeof obj.types=="undefined")try{obj=JSON.parse(obj)}catch(error){}if(obj&&typeof obj.types!=="undefined"){var textVal="";for(var i=0;i<obj.types.length;i++)if(obj.types[i].mimetype==
"text/plain"){textVal=obj.types[i].textdata;break}if(textVal!="")setText(textVal);result=obj.types}else if(obj&&typeof obj.text!=="undefined"){setText(obj.text);result=obj.text}if(agentInfo.isMac)setText("XXXX")}catch(err){if(fireEvent(eventName,{"cmd":"error","err":err},{"async":false}).preventExecution!==true)alert(helper.string.sprintf(consts.connectError,err))}finally{helper.style.replace(_copyingTemplate,"visible","hidden")}setResponseToClipboard(clipboardData,result,eventName)}};_args.methods.request(params)}catch(e){bindEvents();
alert(e)}if(agentInfo.isMac)_args.methods.output({"cmd":"maccmd","value":"RELEASED"})}function dispose(){unbindEvents();_initialized=false}initialize();Object.defineProperty(_ref,"postPaste",{"enumerable":true,"configurable":false,"writable":false,"value":postPaste});Object.defineProperty(_ref,"setText",{"enumerable":true,"configurable":false,"writable":false,"value":setText});Object.defineProperty(_ref,"dispose",{"enumerable":true,"configurable":false,"writable":false,"value":dispose});Object.defineProperty(_ref,
"onCopy",{"enumerable":true,"configurable":false,"set":function(handler){_te.on("copy",handler)}});Object.defineProperty(_ref,"onPaste",{"enumerable":true,"configurable":false,"set":function(handler){_te.on("paste",handler)}});Object.defineProperty(_ref,"onCut",{"enumerable":true,"configurable":false,"set":function(handler){_te.on("cut",handler)}});Object.defineProperty(_ref,"onCopyFiles",{"enumerable":true,"configurable":false,"set":function(handler){_te.on("copyFiles",handler)}});Object.defineProperty(_ref,
"async",{"enumerable":true,"configurable":false,"get":function(){return _asyncCopy},"set":function(value){if(value&&!(navigator.clipboard&&window["ClipboardItem"])){value=false;var msg="";if(location.protocol==="http:")msg=`[Clipboard] Async clipboard is not supported for 'http (not secure)' protocol.`;else msg=`[Clipboard] Async clipboard not supported by current browser. Setting async to false.`;helper.console.warning(msg)}_asyncCopy=value;return _asyncCopy}});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity=
{}}Thinfinity.Clipboard=ThinClipboard})();
(function(){const STATUS_CODE=Object.freeze({ERROR:-1,PENDING:0,SUCCESS:1});function IndexedDB(args){var _ref=this;var _db={name:null,store:null,request:null,base:null,available:true,version:1};var _memData={};var _memDataKeys=null;var _noop=function(){};var _events={ready:null};var _callbacks=[];var _status={code:STATUS_CODE.PENDING,message:"PENDING"};var _ready=false;function initialize(){Object.assign(_db,args);if(args?.events)Object.assign(_events,args.events);for(let kvp in _events)if(!_events[kvp])_events[kvp]=
_noop;if(_db.available)initializeIndexedDB()}function initializeIndexedDB(){if(!_db.base&&indexedDB){_db.request=indexedDB.open(_db.name,_db.version);_db.request.onsuccess=function(event){_db.base=event.target.result;syncData(function(data){if(data)data.forEach(kvp=>{assignMemData(kvp.key,kvp.data)});console.warn(`The base is ready to use`);_status.code=STATUS_CODE.SUCCESS;_status.message="SUCCESS";_ready=true;_callbacks.push(_events.ready);fireCallbacks()})};_db.request.onupgradeneeded=function(event){var store=
event.currentTarget.result.createObjectStore(_db.store,{keyPath:"key",autoIncrement:false});store.createIndex("key","key",{unique:true})};_db.request.onerror=function(error){console.warn(`Cannot access to IndexedDB, something went wrong ${error.message||error}`);_status.code=STATUS_CODE.ERROR;_status.message=`Cannot initialize IndexedDB. ${error.message||error}`;_ready=true;_callbacks.push(_events.ready);fireCallbacks()}}}function syncData(callback){let store=getObjectStore("readonly");if(store)store.getAll().onsuccess=
function(event){if(event)callback(event.target.result)}}function getObjectStore(mode){return _db.base?_db.base.transaction(_db.store,mode).objectStore(_db.store):null}function assignMemData(key,data){if(key){key=key.toLowerCase();_memData[key]=data;_memDataKeys=Object.keys(_memData)}}function addData(key,data){assignMemData(key,data);if(key&&_db.available&&_db.base){key=key.toLowerCase();getStoreData(key,function(record){var store=getObjectStore("readwrite");var transaction=null;if(record)openCursorForUpdate(key,
data);else{transaction=store.add({key,data});transaction.onsuccess=function(){console.log("Insertion in DB successful")};transaction.onerror=function(){console.error("add error",this.error)}}})}}function getData(key){var kvp=null;let b=null;if(key){key=key.toLowerCase();for(kvp in _memData)if(key.indexOf(kvp)!==-1)if(!b)b=kvp;else if(kvp.length>b.length)b=kvp}return b&&_memData[b]?_memData[b]:null}function getKeys(){return _memDataKeys}function openCursorForUpdate(key,data){var store=getObjectStore("readwrite");
store.openCursor().onsuccess=function(event){let cursor=event.target.result;if(cursor)if(cursor.key===key){cursor.value.data=data;cursor.update(cursor.value)}else cursor.continue()}}function getStoreData(key,callback){var store=getObjectStore("readonly");var transaction=null;transaction=store.get(key);transaction.onsuccess=function(event){callback(event.target.result)};transaction.onerror=function(error){console.warn(`IndexedDB. Cannot get record.  ${error.message||error}`);callback(null)}}function deleteData(key,
callback){if(!callback)callback=_noop;if(key){key=key.toLowerCase();getStoreData(key,function(record){if(record){var store=getObjectStore("readwrite");var transaction=null;transaction=store.delete(key);transaction.onsuccess=function(){callback(true)};transaction.onerror=function(error){console.warn(`IndexedDB. Cannot delete record.  ${error.message||error}`);callback(false)}}else{console.warn(`IndexedDB. Cannot delete record. KEY is not in the Database`);callback(false)}})}}function resetDatabase(callback){getObjectStore("readwrite").clear().onsuccess=
function(event){callback(event)}}function ready(callback){if(callback){_callbacks.push(callback);fireCallbacks()}}function readyProm(){return new Promise(resolve=>{ready(resolve)})}function fireCallbacks(){if(_ready&&_callbacks.length>0){var cb=_callbacks.shift();try{cb(_status)}catch(error){console.warn(`Cannot execute ready callback for Thinfinity.IndexedDB Object`)}fireCallbacks()}}function sync(){return new Promise(function(resolve){if(_ready)resolve();else ready(resolve)})}initialize();Object.defineProperty(_ref,
"add",{enumerable:true,configurable:false,writable:false,value:addData});Object.defineProperty(_ref,"delete",{enumerable:true,configurable:false,writable:false,value:deleteData});Object.defineProperty(_ref,"get",{enumerable:true,configurable:false,writable:false,value:getData});Object.defineProperty(_ref,"keys",{enumerable:true,configurable:false,get:function(){return getKeys()}});Object.defineProperty(_ref,"ready",{enumerable:true,configurable:false,writable:false,value:ready});Object.defineProperty(_ref,
"readyProm",{enumerable:true,configurable:false,writable:false,value:readyProm});Object.defineProperty(_ref,"sync",{enumerable:true,configurable:false,writable:false,value:sync});Object.defineProperty(_ref,"resetDB",{enumerable:true,configurable:false,writable:false,value:resetDatabase});Object.defineProperty(_ref,"status",{enumerable:true,configurable:false,get:()=>{return _status}});return _ref}Object.defineProperty(IndexedDB,"STATUS_CODE",{"enumerable":true,"configurable":false,"get":function(){return STATUS_CODE}});
try{Thinfinity!==undefined}catch(e){Thinfinity={}}Thinfinity.IndexedDB=IndexedDB})();
(function(){function PacketReceiver(args){var _ref=this;var _noop=function(){};var _args={properties:{async:false,asyncTimeout:10,checkPacketIndex:false,defaultFireEventArgs:{async:false}},methods:{getRawBinaryHandler:null,arraybufferToString:null},handlers:{0:null,1:null,2:null,3:null,5:null,6:null,7:null,8:null}};var _buffer="";var _soundBuffer="";var _te=null;var _process=null;var _handlers=null;function initialize(){helper.object.parseAttributes(_args,args);_te=new Thinfinity.Events({fireEventArgs:_args.defaultFireEventArgs,
owner:_ref});_process=_args.async===true?asyncProcess:syncProcess;_handlers=_args.handlers}function asyncProcess(data){window.setTimeout(function(){syncProcess(data)},_args.asyncTimeout)}function checkPacketIndex(pckIdx,groupIdx,eod){if(_lastPkt.idx==99&&pckIdx==0&&eod)_lastPkt.idx=-1;if(_lastPkt.idx==-1&&_lastPkt.reset){_lastPkt.reset=false;_lastPkt.idx=pckIdx-1}if(_lastPkt.idx+1!=pckIdx){let msg=null;if(_lastPkt.idx+1<pckIdx)msg=`Missing pkt: ${_lastPkt.idx+1} - last: ${_lastPkt.idx}, current: ${pckIdx}, groupIdx: ${groupIdx}`;
else msg=`Pkt treated - last: ${_lastPkt.idx}, current: ${pckIdx}, groupIdx: ${groupIdx}`;_te.fireEvent("warning",msg);if(eod)_lastPkt.idx=pckIdx;_te.fireEvent("restartConnection")}else if(eod)_lastPkt.idx=pckIdx;else if(_lastPkt.idx==-1)_lastPkt.idx=0}function syncProcess(data){if(typeof data=="object"){var arr=new Uint8Array(data);if(_args.checkPacketIndex)checkPacketIndex(((arr[2]-48)*10|0)+(arr[3]-48|0),((arr[4]-48)*100|0)+((arr[5]-48)*10|0)+(arr[6]-48|0),arr[1]-48);let processed=false;if(arr[0]==
0){var handlerImage=_args.methods.getRawBinaryHandler(arr[1],arr[2],arr[3]);if(handlerImage){handlerImage(data);processed=true}else{logDebug("No raw binary handler found for hid "+arr[1]+", opt1 "+arr[2]+", opt2 "+arr[3]);processed=false}}if(!processed)queueBinary(arr);arr=null}else if(data[0]=="{")_handlers[0](groupindex,arrayView,data);else{if(_args.checkPacketIndex)checkPacketIndex(parseInt(data.substr(2,2),10),parseInt(data.substr(4,3),10),parseInt(data[1],10));var datatype=data[0];var endofdata=
data[1];if(datatype=="2")_soundBuffer+=data.substring(7);else _buffer+=data.substring(7);if(endofdata=="0")return;if(datatype=="0")try{_handlers[0](null,null,_buffer);_buffer=""}catch(err){logError("ERROR: _buffer = "+_buffer);_buffer="";alert("websocket onmessage err: "+err)}else if(datatype=="1"){_handlers[3](_buffer);_buffer="";return}else if(datatype=="2"){_handlers[2](null,window.atob(_soundBuffer));_soundBuffer="";return}}data=null}function queueBinary(arr){var typeofdata=arr[0]-48|0;var handler=
_handlers[typeofdata];var groupindex=((arr[4]-48)*100|0)+((arr[5]-48)*10|0)+(arr[6]-48|0);var dataIndex=7;var arrayView=arr.subarray(dataIndex);if(typeofdata===2)groupindex=((arr[2]-48)*10|0)+(arr[3]-48|0);handler(groupindex,arrayView);arr=null;arrayView=null}function registerHandler(dataType,handler){if(typeof dataType!=="undefined"&&!_handlers[dataType])_handlers[dataType]=handler}initialize();Object.defineProperty(_ref,"process",{enumerable:true,configurable:false,writable:false,value:_process});
Object.defineProperty(_ref,"registerHandler",{enumerable:true,configurable:false,writable:false,value:registerHandler});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.PacketReceiver=PacketReceiver})();
(function(){const _options={"DO_NOT_FULL_EXTEND_OBJECT":2};Object.freeze(_options);function OInterface(args){var _ref=this;var _args={_defaultDescriptor:null,_defaultEventFire:null};var _disposeEvent=null;var _defaultDescriptor={configurable:false,writable:false,enumerable:true,readOnly:false};var _defaultEventFire={async:0};var _internalIndex=0;function initialize(){_disposeEvent=_ref.dispose;helper.object.parseAttributes(_args,args);if(_args.defaultDescriptor)helper.object.parseAttributes(_defaultDescriptor,
_args.defaultDescriptor);if(_args.defaultEventFire)helper.object.parseAttributes(_defaultEventFire,_args.defaultEventFire)}function proxyObject(own,o,p){if(!(o instanceof HTMLElement)){if(!o.__prototype__)o.__prototype__={};if(!o.__prototype__.isProxy){var _sharedOwners=[];Object.defineProperty(o.__prototype__,"isProxy",{enumerable:false,configurable:false,get:function(){return true}});Object.defineProperty(o.__prototype__,"sharedOwners",{enumerable:false,configurable:false,get:function(){return _sharedOwners},
set:function(owner){if(_sharedOwners.indexOf(owner)==-1)_sharedOwners.push(owner)}});Object.defineProperty(o.__prototype__,"path",{enumerable:false,configurable:false,get:function(){return p}});return new Proxy(o,{construct:function(target,args){return Reflect.construct(target,args)},apply:function(target,that,args){return Reflect.apply(target,that,args)},get:function(oTarget,sKey){return Reflect.get(oTarget,sKey)},set:function(oTarget,sKey,vValue){let ov=Reflect.get(oTarget,sKey);let r=Reflect.set(oTarget,
sKey,vValue);let n=(p?p+".":"")+sKey;if(ov!==n&&own){let nv=r?vValue:ov;own.__prototype__.fireEvent(n,ov,nv,_defaultEventFire);if(o.__prototype__.sharedOwners)o.__prototype__.sharedOwners.forEach(owner=>{owner.fireEvent(n,ov,nv,_defaultEventFire)})}return r},deleteProperty:function(oTarget,sKey){return Reflect.deleteProperty(oTarget,sKey)},enumerate:function(oTarget,sKey){return Reflect.enumerate(oTarget,sKey)},ownKeys:function(oTarget,sKey){return Reflect.ownKeys(oTarget,sKey)},has:function(oTarget,
sKey){return Reflect.has(oTarget,sKey)},defineProperty:function(oTarget,sKey,oDesc){return Reflect.defineProperty(oTarget,sKey,oDesc)},getOwnPropertyDescriptor:function(oTarget,sKey){return Reflect.getOwnPropertyDescriptor(oTarget,sKey)}})}else{if(typeof o?.__prototype__?.sharedOwners!=="undefined")o.__prototype__.sharedOwners=own.__prototype__;return o}}else return o}function copyEvents(o,t){if(o)for(let e in o)t[e]=o[e]}function getPointerObject(o,p){if(o){if(!(p instanceof Array))p=p.split(".");
let k=p.shift();if(k&&o.hasOwnProperty(k)){if(p.length===0)return{object:o,prop:k};return getPointerObject(o[k],p)}else return{object:o,prop:k}}else return null}function createObject(params){var proxyObject=function(own,o,p){if(!(o instanceof HTMLElement)){if(!o.__prototype__)o.__prototype__={};if(!o.__prototype__.isProxy){Object.defineProperty(o.__prototype__,"isProxy",{enumerable:false,configurable:false,get:function(){return true}});Object.defineProperty(o.__prototype__,"path",{enumerable:false,
configurable:false,get:function(){return p}});return new Proxy(o,{construct:function(target,args){Reflect.construct(target,args)},apply:function(target,that,args){return Reflect.apply(target,that,args)},get:function(oTarget,sKey){return Reflect.get(oTarget,sKey)},set:function(oTarget,sKey,vValue){let ov=Reflect.get(oTarget,sKey);let r=Reflect.set(oTarget,sKey,vValue);let n=(p?p+".":"")+sKey;if(ov!==n&&own)own.__prototype__.fireEvent(n,ov,r?vValue:ov,_defaultEventFire);return r},deleteProperty:function(oTarget,
sKey){return Reflect.deleteProperty(oTarget,sKey)},enumerate:function(oTarget,sKey){return Reflect.enumerate(oTarget,sKey)},ownKeys:function(oTarget,sKey){return Reflect.ownKeys(oTarget,sKey)},has:function(oTarget,sKey){return Reflect.has(oTarget,sKey)},defineProperty:function(oTarget,sKey,oDesc){return Reflect.defineProperty(oTarget,sKey,oDesc)},getOwnPropertyDescriptor:function(oTarget,sKey){return Reflect.getOwnPropertyDescriptor(oTarget,sKey)}})}else return o}else return o};var copyEvents=function(o,
t){if(o)for(let e in o)t[e]=o[e]};var getPropName=function(o,name){if(name.indexOf(".")!==-1){let s=name.split(".");return{n:s[s.length-1],p:name,ap:s.slice(0,s.length-1).join(".")}}else return{n:name}};var getFunctionName=function(fn){if(fn)return fn.name||helper.object.getFunctionName(fn);else{_internalIndex++;return"fn_"+_internalIndex.toString()}};var createProperty=function(mo,o,desc,obj,options){let type=helper.object.getTypeOf(desc).toUpperCase();let _p={};let t=null;switch(type){case "OBJECT":let k=
null;if(desc.source)k=typeof desc.source;else if(desc.value){k=typeof desc.value;desc.source=desc.value}if(k==="function"){_p={n:getFunctionName(desc.source),v:desc.source,w:!desc.ro,c:_defaultDescriptor.configurable,e:_defaultDescriptor.enumerable};if(desc.alias)_p.n=desc.alias}else if(k==="object"){_p.n=desc.alias;_p.g=function(){return desc.source};_p.s=desc.ro?null:function(value){return desc.source=value}}else{t=getPropName(o,desc.source);if(desc.alias){_p.n=desc.alias;mo.__prototype__.alias[desc.alias]=
desc.source}else{if(t.p&&t.n&&t.p!=t.n)mo.__prototype__.alias[t.n]=t.p;_p.n=t.n}_p.c=desc.configurable||_defaultDescriptor.configurable;_p.e=desc.enumerable||_defaultDescriptor.enumerable;if(desc.value){_p.v=desc.value;_p.w=desc.writable||_defaultDescriptor.writable}else{if(desc.get)_p.g=desc.get;else if(t.p)_p.g=function(){return helper.object.getValue(obj,t.p,undefined)};else _p.g=function(){return obj[t.n]};if(desc.set)_p.s=function(value){desc.set.call(this,arguments);mo.__prototype__.fireEvent(t.n,
undefined,value,_defaultEventFire)};else if(!(desc.ro===true)||typeof desc.ro==="undefined"&&!_defaultDescriptor.readOnly)if(t.p)_p.s=function(value){let ov=helper.object.getValue(obj,t.p,undefined);helper.object.setValue(obj,t.p,value);mo.__prototype__.fireEvent(mo.__prototype__.alias[_p.n]||_p.n,ov,value,_defaultEventFire);return helper.object.getValue(obj,t.p,undefined)};else _p.s=function(value){mo.__prototype__.fireEvent(_p.n,obj[_p.n],value,_defaultEventFire);obj[t.n]=value;return obj[t.n]};
_p.u=desc.onUpdate||desc.onChanged;if(obj){let ak=t.ap||t.n;if(typeof obj[ak]==="object")obj[ak]=proxyObject(mo,obj[ak],ak)}}}break;case "STRING":if(obj){t=getPropName(o,desc);if(t.p){_p.n=t.n;_p.g=function(){return helper.object.getValue(obj,t.p,undefined)}}else{_p.n=desc;_p.g=function(){return obj[_p.n]}}if(!_defaultDescriptor.readOnly)if(t.p)_p.s=function(value){let ov=helper.object.getValue(obj,t.n,undefined);helper.object.setValue(obj,t.n,value);mo.__prototype__.fireEvent(mo.__prototype__.alias[_p.n]||
_p.n,ov,value,_defaultEventFire);return helper.object.getValue(obj,t.n,undefined)};else _p.s=function(value){let ov=obj[_p.n];obj[_p.n]=value;mo.__prototype__.fireEvent(_p.n,ov,value,_defaultEventFire);return obj[_p.n]};_p.e=_defaultDescriptor.enumerable;_p.c=_defaultDescriptor.configurable}else return"Invalid";break;case "FUNCTION":_p={n:getFunctionName(desc),v:desc,c:_defaultDescriptor.configurable,e:_defaultDescriptor.enumerable};break}registerProperty(mo,t&&t.o?t.o:o,_p)};var registerProperty=
function(mo,o,prop){var descriptor={enumerable:prop.e,configurable:prop.c};if(prop.v){if(typeof prop.w!=="undefined")descriptor.writable=prop.w;descriptor.value=prop.v}else{if(prop.g)descriptor.get=prop.g;if(prop.s)descriptor.set=prop.s}Object.defineProperty(o,prop.n,descriptor);if(prop.u)mo.on(prop.n,prop.u)};var _masterObj=new Object;let te=new Thinfinity.Events({fireEventArgs:_defaultEventFire});_masterObj.__prototype__={};_masterObj.__prototype__.alias={};_masterObj.__prototype__.fireEvent=te.fireEvent;
_masterObj.__prototype__.disposeEventObj=te.dispose;_masterObj.__prototype__.backup={};_masterObj.__prototype__.clone=()=>{let avoidNames=["methods","properties","events"];let _cloneInterface={methods:{},properties:{},events:{}};for(let kvp in _masterObj)if(avoidNames.indexOf(kvp)===-1)_cloneInterface[kvp]=_masterObj[kvp];for(let kvp in _masterObj.methods)_cloneInterface.methods[kvp]=_masterObj.methods[kvp];_cloneInterface.properties=_masterObj.properties;_cloneInterface.events=_masterObj.events;
return _cloneInterface};Object.defineProperty(_masterObj,"on",{enumerable:true,configurable:false,writable:false,value:function(event,handler){te.on(_masterObj.__prototype__.alias[event]||event,handler)}});Object.defineProperty(_masterObj,"off",{enumerable:true,configurable:false,writable:false,value:function(event,handler){te.off(_masterObj.__prototype__.alias[event]||event,handler)}});let type=helper.object.getTypeOf(params).toUpperCase();switch(type){case "ARRAY":break;case "OBJECT":var props=
{};if(params.events)if(params.namespace===true){_masterObj.events=new Object;copyEvents(params.events,_masterObj.events)}else copyEvents(params.events,_masterObj);if(params.object&&params.properties&&params.properties.length>0){if(params.options.indexOf(_options.DO_NOT_FULL_EXTEND_OBJECT)===-1)params.object=proxyObject(_masterObj,params.object,null);let mp=_masterObj;if(params.namespace===true)mp=_masterObj.properties=new Object;params.properties.forEach(function(prop){createProperty(_masterObj,mp,
prop,params.object,params.options)})}let mm=_masterObj;if(params.namespace===true)mm=_masterObj.methods=new Object;if(params.methods&&params.methods.length>0)params.methods.forEach(function(method){createProperty(_masterObj,mm,method,null,params.options)});if(params.defaultValues)_masterObj.defaultValues=params.defaultValues;Object.defineProperty(props,"newProperty",{enumerable:true,configurable:false,writable:false,value:function(oProperty){if(oProperty instanceof Thinfinity.Object.Property){let mp=
params.namespace===true?_masterObj.properties:_masterObj;createProperty(_masterObj,mp,oProperty.property,params.object,params.options);_masterObj.__prototype__.fireEvent(oProperty.property.source,undefined,undefined,_defaultEventFire)}}});Object.defineProperty(props,"newMethod",{enumerable:true,configurable:false,writable:false,value:function(oMethod){if(oMethod instanceof Thinfinity.Object.Method){let mt=params.namespace===true?_masterObj.methods:_masterObj;createProperty(_masterObj,mt,oMethod.method,
null,params.options);_masterObj.__prototype__.fireEvent(oMethod.method.alias,undefined,undefined,_defaultEventFire)}}});break}Object.freeze(_masterObj.__prototype__);return{new:_masterObj,props}}function getPropName(o,name){if(name.indexOf(".")!==-1){let s=name.split(".");return{n:s[s.length-1],p:name,ap:s.slice(0,s.length-1).join(".")}}else return{n:name}}function getFunctionName(fn){if(fn)return fn.name||helper.object.getFunctionName(fn);else{_internalIndex++;return"fn_"+_internalIndex.toString()}}
function createProperty(mo,o,desc,obj,options){let type=helper.object.getTypeOf(desc).toUpperCase();let _p={};let t=null;switch(type){case "OBJECT":case "OMETHOD":case "OPROPERTY":let k=null;if(desc.source)k=typeof desc.source;else if(desc.value){k=typeof desc.value;desc.source=desc.value}if(k==="function"){_p={n:getFunctionName(desc.source),v:desc.source,w:!desc.ro,c:_defaultDescriptor.configurable,e:_defaultDescriptor.enumerable};if(desc.alias)_p.n=desc.alias}else if(k==="object"){_p.n=desc.alias;
_p.g=function(){return desc.source};_p.s=desc.ro?null:function(value){return desc.source=value}}else{t=getPropName(o,desc.source);if(desc.alias){_p.n=desc.alias;mo.__prototype__.alias[desc.alias]=desc.source}else{if(t.p&&t.n&&t.p!=t.n)mo.__prototype__.alias[t.n]=t.p;_p.n=t.n}_p.c=desc.configurable||_defaultDescriptor.configurable;_p.e=desc.enumerable||_defaultDescriptor.enumerable;if(desc.value){_p.v=desc.value;_p.w=desc.writable||_defaultDescriptor.writable}else{if(desc.get)_p.g=desc.get;else if(t.p)_p.g=
function(){return helper.object.getValue(obj,t.p,undefined)};else _p.g=function(){return obj[t.n]};if(desc.set)_p.s=function(value){desc.set.call(this,arguments);mo.__prototype__.fireEvent(t.n,undefined,value,_defaultEventFire)};else if(!(desc.ro===true)||typeof desc.ro==="undefined"&&!_defaultDescriptor.readOnly)if(t.p)_p.s=function(value){let ov=helper.object.getValue(obj,t.p,undefined);helper.object.setValue(obj,t.p,value);mo.__prototype__.fireEvent(mo.__prototype__.alias[_p.n]||_p.n,ov,value,
_defaultEventFire);return helper.object.getValue(obj,t.p,undefined)};else _p.s=function(value){mo.__prototype__.fireEvent(_p.n,obj[_p.n],value,_defaultEventFire);obj[t.n]=value;return obj[t.n]};_p.u=desc.onUpdate||desc.onChanged;if(obj){let ak=t.ap||t.n;if(typeof obj[ak]==="object")obj[ak]=proxyObject(mo,obj[ak],ak)}}}break;case "STRING":if(obj){t=getPropName(o,desc);if(t.p){_p.n=t.n;_p.g=function(){return helper.object.getValue(obj,t.p,undefined)}}else{_p.n=desc;_p.g=function(){return obj[_p.n]}}if(!_defaultDescriptor.readOnly)if(t.p)_p.s=
function(value){let ov=helper.object.getValue(obj,t.n,undefined);helper.object.setValue(obj,t.n,value);mo.__prototype__.fireEvent(mo.__prototype__.alias[_p.n]||_p.n,ov,value,_defaultEventFire);return helper.object.getValue(obj,t.n,undefined)};else _p.s=function(value){let ov=obj[_p.n];obj[_p.n]=value;mo.__prototype__.fireEvent(_p.n,ov,value,_defaultEventFire);return obj[_p.n]};_p.e=_defaultDescriptor.enumerable;_p.c=_defaultDescriptor.configurable}else return"Invalid";break;case "FUNCTION":_p={n:getFunctionName(desc),
v:desc,c:_defaultDescriptor.configurable,e:_defaultDescriptor.enumerable};break}registerProperty(mo,t&&t.o?t.o:o,_p)}function registerProperty(mo,o,prop){var descriptor={enumerable:prop.e,configurable:prop.c};if(prop.v){if(typeof prop.w!=="undefined")descriptor.writable=prop.w;descriptor.value=prop.v}else{if(prop.g)descriptor.get=prop.g;if(prop.s)descriptor.set=prop.s}Object.defineProperty(o,prop.n,descriptor);if(prop.u)mo.on(prop.n,prop.u)}function newObject(o){if(o)if(o instanceof OInterfaceConfig){let no=
createObject(o.config);return{new:no.new,original:o.config.object,props:no.props}}else;}function dispose(){_disposeEvent()}initialize();Object.defineProperty(_ref,"new",{enumerable:true,configurable:false,writable:false,value:newObject});Object.defineProperty(_ref,"dispose",{enumerable:true,configurable:false,writable:false,value:dispose});return _ref}function OProperty(oProp){var _ref=this;var _prop=null;var _minData=["source"];if(oProp)_prop={...oProp};else _prop={};_minData.forEach(v=>{if(!_prop[v])_prop[v]=
null});Object.defineProperty(_ref,"property",{enumerable:true,configurable:false,get:function(){return _prop}});return _ref}function OMethod(oMethod){var _ref=this;var _method=null;var _minData=["alias","value"];if(oMethod)_method={...oMethod};else _method={};_minData.forEach(v=>{if(!_method[v])_method[v]=null});Object.defineProperty(_ref,"method",{enumerable:true,configurable:false,get:function(){return _method}});return _ref}function OInterfaceConfig(config){var _ref=this;var _config=null;function initialize(){_config=
config}initialize();Object.defineProperty(_ref,"config",{enumerable:true,configurable:false,get:function(){return _config}});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(!Thinfinity.Object)Thinfinity.Object={};Thinfinity.Object.Interface=OInterface;Thinfinity.Object.IConfig=OInterfaceConfig;Thinfinity.Object.Property=OProperty;Thinfinity.Object.Method=OMethod;Object.defineProperty(Thinfinity.Object.IConfig,"OPTIONS",{enumerable:true,configurable:false,get:function(){return _options}})})();
(function(){var _resolution=helper.object.createEnum("CUSTOM","FIT_TO_BROWSER","FIT_TO_SCREEN");function Device(args){var _ref=this;var _args={id:null,name:null,resolution:null,width:0,height:0,physicalWidth:0,physicalHeight:0,orientation:"landscape",desktopScaleFactor:1,deviceScaleFactor:1,external:false,mainDisplay:false,parentElement:null,url:"/display.controller.html",surface:{top:0,left:0},display:{width:0,height:0},window:{top:0,left:0},screen:{width:window.screen.width,height:window.screen.height},
sizeLimit:null,key:null,assigned:false};var _wpAssigned=false;var _oInterface=null;var _methods=null;var _outputInterface=null;var _ready=null;var _resolveObj=null;var _readyCallback=null;var _displayInfo=["id","width","height","physicalWidth","physicalHeight","orientation","desktopScaleFactor","deviceScaleFactor","external","mainDisplay","name","resolution","surface","window","display","screen","assigned"];var _offset={left:0,top:0};var _wndSkin={width:0,height:0};var _messages={reject:{interface:{set:"Interface not supported - TMD",
get:"Interface not supported - TMD - LGI",initializing:"Initializing interface",gettingContent:"    Getting content element",setting:"    Setting interface.",starting:"Starting interface."},load:"Element is null or undefined"},monitor:{openingTab:"Opening tab in: "}};var _remoteWnd=null;var _isEmbedded=false;var _scale=1;var _minZoomFactor=0;var _zoomFactor=1;var _hasFocus=false;var oInterface=null;var fireEvent=null;var _disposed=false;var _repaint=false;function initialize(){helper.object.parseAttributes(_args,
args);fireEvent=(new Thinfinity.Events({"owner":_ref,"events":args.events})).fireEvent;if(args.window&&helper.object.isNumber(args.window.top)&&helper.object.isNumber(args.window.left))_wpAssigned=true;postInitialize()}function postInitialize(){let msg=`Initializing "Thinfinity.Display.Device - name: ${_args.name}, `;_args.width-=_args.width%2;let w=_args.width;let h=_args.height;if(_args.resolution==2){w=window.screen.width;h=window.screen.height}assignDisplaySize(w,h);helper.console.log(msg,arguments);
if(_args.mainDisplay===true||_args.external===false){if(!_args.parentElement)_args.parentElement=document.body;_args.external=false}}function setInterface(){return new Promise((resolve,reject)=>{if(arguments&&arguments[0]instanceof Thinfinity.Display.Manager&&arguments[1]instanceof Object){_oInterface=arguments[1];if(arguments[2])helper.object.parseAttributes(_args.window,arguments[2]);createMonitorContainer().then(resolve).catch(reject)}else reject(_messages.reject.interface.set)})}function createOwnInterfaceInstance(oInterface){if(oInterface?.extra)helper.object.parseAttributes(_args,
oInterface.extra);let external=_args.external===true&&_args.mainDisplay!==true;var _avoidNames=["methods"];if(external)_avoidNames.push("properties");let _ownInterface={methods:{},properties:{}};for(let kvp in oInterface)if(_avoidNames.indexOf(kvp)===-1)_ownInterface[kvp]=oInterface[kvp];for(let kvp in oInterface.methods)_ownInterface.methods[kvp]=oInterface.methods[kvp];_ownInterface.methods.sendMouse=function(x,y,button,action){x+=_args.surface.left;y+=_args.surface.top;oInterface.methods.sendMouse(x,
y,button,action)};_ownInterface.methods.resize=function(id,size){_args.width=_args.physicalWidth=size.width-size.width%2;_args.height=_args.physicalHeight=size.height;assignDisplaySize(size.display.width,size.display.height);if(oInterface.methods.resize)oInterface.methods.resize()};if(external){_avoidNames=["scale","clipboard","zoomFactor","minZoomFactor","hasFocus","repaint"];try{for(let kvp in oInterface.properties)if(_avoidNames.indexOf(kvp)===-1)Object.defineProperty(_ownInterface.properties,
kvp,Object.getOwnPropertyDescriptor(oInterface.properties,kvp));if(oInterface.properties?.clipboard)_ownInterface.properties.clipboard=oInterface.properties.clipboard}catch(error){}}Object.defineProperty(_ownInterface.properties,"scale",{enumerable:true,configurable:false,get:function(){return _scale},set:function(value){_scale=value}});Object.defineProperty(_ownInterface.properties,"minZoomFactor",{enumerable:true,configurable:false,get:function(){return _minZoomFactor},set:function(value){_minZoomFactor=
value}});Object.defineProperty(_ownInterface.properties,"zoomFactor",{enumerable:true,configurable:false,get:function(){return _zoomFactor},set:function(value){_zoomFactor=value}});Object.defineProperty(_ownInterface.properties,"hasFocus",{enumerable:true,configurable:false,get:function(){return _hasFocus},set:function(value){_hasFocus=value}});Object.defineProperty(_ownInterface.properties,"repaint",{enumerable:true,configurable:false,get:function(){return _repaint},set:function(value){if(value!=
_repaint){_repaint=value;_oInterface.__prototype__.fireEvent("repaint",_repaint)}}});if(_ownInterface?.defaultValues)for(let kvp in _ownInterface.defaultValues)if(_ownInterface.properties[kvp])_ownInterface.properties[kvp]=_ownInterface.defaultValues[kvp];_properties=_ownInterface.properties;_methods=_ownInterface.methods;return _ownInterface}function assignDisplaySize(w,h){_args.display.width=w?w:_args.width;_args.display.height=h?h:_args.height}function getInterface(){return new Promise((resolve,
reject)=>{if(arguments&&arguments[0]instanceof Thinfinity.Display.Manager)var check=function(){if(_ready===true)resolve(_outputInterface);else if(_ready===false)reject(``);else if(!_readyCallback)_readyCallback=check()}();else reject(_messages.reject.interface.get)})}async function initializeInterface(elem){helper.console.log(_messages.reject.interface.initializing,arguments);return new Promise((resolve,reject)=>{helper.console.log(_messages.reject.interface.gettingContent,arguments);var cntWnd=elem instanceof
HTMLIFrameElement?elem.contentWindow:elem;helper.console.log(_messages.reject.interface.setting,arguments);oInterface=createOwnInterfaceInstance(_oInterface);cntWnd.Thinfinity.Display.Controller.setInterface(_ref,oInterface).then(()=>{_isEmbedded=_args.mainDisplay||_args.external!==true;helper.console.log(_messages.reject.interface.starting,arguments);if(oInterface.sizeLimit)if(!_args.sizeLimit)_args.sizeLimit=oInterface.sizeLimit;else helper.object.parseAttributes(_args.sizeLimit,oInterface.sizeLimit);
cntWnd.Thinfinity.Display.Controller.start({device:_ref,isEmbedded:_isEmbedded,sizeLimit:_args.sizeLimit,key:_args.key});cntWnd.Thinfinity.Display.Controller.getInterface(_ref).then(oInterface=>{_outputInterface=oInterface;Object.defineProperty(_ref,"processData",{enumerable:true,configurable:false,writable:false,value:_outputInterface.processData});Object.defineProperty(_ref,"processCmds",{enumerable:true,configurable:false,writable:false,value:processCmds});if(_outputInterface.processFrame)Object.defineProperty(_ref,
"processFrame",{enumerable:true,configurable:false,writable:false,value:_outputInterface.processFrame});var _continue=function(){_ready=true;resolve(true);if(_readyCallback)_readyCallback()};var _onMessageHandler=function(e){if(e&&e.data&&e.data.cmd==="CALLBACK-RESPONSE"){helper.dom.removeEvent(window,"message",_onMessageHandler);_continue()}};if(!_isEmbedded){helper.dom.addEvent(window,"message",_onMessageHandler,{passive:false});cntWnd.postMessage({cmd:"CALLBACK"},"*")}else _continue()}).catch(reject)}).catch(reject)})}
function processCmds(obj){if(obj?.cmd==="DS"){_args.display.width=obj.width;_args.display.height=obj.height;_args.surface.top=obj.top;_args.surface.left=obj.left;if(_args.mainDisplay){_properties.viewWidth=obj.width;_properties.viewHeight=obj.height}_args.assigned=true}_outputInterface.processCmds(obj)}async function onLoadHandler(elem){return new Promise((resolve,reject)=>{var _reject=err=>{_ready=false;let msg=err.message||err;helper.console.warning(msg,arguments);if(_readyCallback)_readyCallback();
reject(msg)};if(elem){elem.onload=function(){initializeInterface(elem).then(resolve).catch(_reject)};elem.onerror=e=>{_reject(e)};elem.onabort=e=>{_reject(e)}}else reject(_messages.reject.load)})}function onUnload(){if(!_disposed)_methods.removeDevice(_args.id)}async function createMonitorContainer(){return new Promise((resolve,reject)=>{let url=_args.url;let external=_args.external===true&&_args.mainDisplay!==true;if(external){let _features=`width=${_args.width+_wndSkin.width},height=${_args.height+
_wndSkin.height},left=${_args.window.left+_offset.left},top=${_args.window.top+_offset.top},menubar=yes,resizable=yes,scrollbars=yes,status=no,titlebar=yes,toolbar=yes`;helper.console.log(`${_messages.monitor.openingTab} ${_features}`,arguments);let wnd=window.open(url,"_blank",_features);if(wnd){_remoteWnd=wnd;onLoadHandler(wnd).then(response=>{_resolveObj={container:wnd,contentWindow:wnd,contentDocument:wnd.document};helper.dom.addEvent(wnd,"unload",onUnload,{passive:false});updateWindowPosition(true);
resolve(_resolveObj)}).catch(reject)}else reject({message:consts.displayPopupBlocked,code:2})}else if(Thinfinity.Display.Controller)initializeInterface(window).then(response=>{_remoteWnd=window;updateWindowPosition();_resolveObj={container:window,contentWindow:window,contentDocument:document};resolve(_resolveObj)}).catch(reject);else{let iframe=document.createElement("iframe");iframe.style.width="100%";iframe.style.height="100%";onLoadHandler(iframe).then(response=>{_remoteWnd=iframe.contentWindow;
_resolveObj={container:iframe,contentWindow:iframe.contentWindow,contentDocument:iframe.contentDocument};resolve(_resolveObj)}).catch(reject);iframe.src=url;iframe.style.position="absolute";iframe.style.backgroundColor="transparent";iframe.style.margin="0px";iframe.style.top="0px";iframe.style.left=`${_args.left}px`;iframe.style.zIndex=9999999999999;_args.parentElement.appendChild(iframe)}})}function getInfo(){let info={};updateWindowPosition();_displayInfo.forEach(function(prop){info[prop]=_args[prop]});
return info}function getSize(){return{width:_args.display.width||_args.width,height:_args.display.height||_args.height}}function setSize({width,height}=o){_args.physicalWidth=_args.width=width-width%2;_args.physicalHeight=_args.height=height}function updateWindowPosition(updateSize){if(_remoteWnd){if(updateSize)setSize({width:_remoteWnd.innerWidth,height:_remoteWnd.innerHeight});_args.window.top=_remoteWnd.screenY||_remoteWnd.screenTop;_args.window.left=_remoteWnd.screenX||_remoteWnd.screenLeft}}
function moveWndTo(left,top){if(_remoteWnd){_args.window.left=left;_args.window.top=top;if(!_isEmbedded&&_remoteWnd.moveTo)_remoteWnd.moveTo(left,top)}}function updateWindowPositionByName(name,value){let screenAxis=null;if(name==="left")screenAxis="screenX";else if(name==="top")screenAxis="screenY";if(screenAxis)if(_remoteWnd){_args.window[name]=value;_remoteWnd.moveTo(_args.window.left,_args.window.top)}else _args.window[name]=value}function dispose(){if(_resolveObj&&!_disposed){_disposed=true;_resolveObj.contentDocument.innerHTML=
"";if(_resolveObj.container instanceof HTMLIFrameElement)_resolveObj.container.parentElement.removeChild(_resolveObj.container);else if(!_isEmbedded)_resolveObj.container.close()}_resolveObj=null}initialize();Object.defineProperty(_ref,"id",{enumerable:true,configurable:false,get:function(){return _args.id},set:function(value){_args.id=value}});Object.defineProperty(_ref,"getInfo",{enumerable:true,configurable:false,writable:false,value:getInfo});Object.defineProperty(_ref,"size",{enumerable:true,
configurable:false,get:getSize,set:setSize});Object.defineProperty(_ref,"setInterface",{enumerable:true,configurable:false,writable:false,value:setInterface});Object.defineProperty(_ref,"getInterface",{enumerable:true,configurable:false,writable:false,value:getInterface});Object.defineProperty(_ref,"isWindowPositionAssigned",{enumerable:true,configurable:false,get:function(){return _wpAssigned}});Object.defineProperty(_ref,"mainDisplay",{enumerable:true,configurable:false,get:function(){return _args.mainDisplay}});
Object.defineProperty(_ref,"properties",{enumerable:true,configurable:false,get:function(){return oInterface.properties}});Object.defineProperty(_ref,"cursorCanvas",{enumerable:true,configurable:false,get:function(){return _outputInterface.cursorCanvas}});Object.defineProperty(_ref,"getMinZoomFactor",{enumerable:true,configurable:false,get:function(){return _outputInterface.getMinZoomFactor()}});var _surface={};Object.defineProperty(_ref,"surface",{enumerable:true,configurable:false,get:function(){return _surface}});
Object.defineProperty(_surface,"top",{enumerable:true,configurable:false,get:function(){return _args.surface.top},set:function(value){if(typeof value!=="undefined")_args.surface.top=value}});Object.defineProperty(_surface,"left",{enumerable:true,configurable:false,get:function(){return _args.surface.left},set:function(value){if(typeof value!=="undefined")_args.surface.left=value}});var _window={};Object.defineProperty(_ref,"window",{enumerable:true,configurable:false,get:function(){return _window}});
Object.defineProperty(_window,"top",{enumerable:true,configurable:false,get:function(){return _args.window.top},set:function(value){return updateWindowPositionByName("top",value)}});Object.defineProperty(_window,"left",{enumerable:true,configurable:false,get:function(){return _args.window.left},set:function(value){return updateWindowPositionByName("left",value)}});Object.defineProperty(_window,"moveTo",{enumerable:true,configurable:false,writable:false,value:moveWndTo});var _display={};Object.defineProperty(_ref,
"display",{enumerable:true,configurable:false,get:function(){return _display}});Object.defineProperty(_display,"width",{enumerable:true,configurable:false,get:function(){return _args.display.width}});Object.defineProperty(_display,"height",{enumerable:true,configurable:false,get:function(){return _args.display.height}});var _screen={};Object.defineProperty(_ref,"screen",{enumerable:true,configurable:false,get:function(){return _screen}});Object.defineProperty(_screen,"width",{enumerable:true,configurable:false,
get:function(){return _args.screen.width},set:function(value){return _args.screen.width=value}});Object.defineProperty(_screen,"height",{enumerable:true,configurable:false,get:function(){return _args.screen.height},set:function(value){return _args.screen.height=value}});Object.defineProperty(_ref,"width",{enumerable:true,configurable:false,get:function(){return _args.width}});Object.defineProperty(_ref,"height",{enumerable:true,configurable:false,get:function(){return _args.height}});Object.defineProperty(_ref,
"resolution",{enumerable:true,configurable:false,get:function(){return _args.resolution}});Object.defineProperty(_ref,"assigned",{enumerable:true,configurable:false,get:function(){return _args.assigned}});Object.defineProperty(_ref,"dispose",{enumerable:true,configurable:false,writable:false,value:dispose});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(!Thinfinity.Display)Thinfinity.Display={};Thinfinity.Display.Device=Device;Object.defineProperty(Device,"RESOLUTION",{enumerable:true,
configurable:false,get:function(){return _resolution}})})();
(function(){var _eTypes={H264_RDP_SURFACE_CREATE:1,H264_RDP_SURFACE_DESTROY:2,H264_RDP_SURFACE_FRAME:3,RDP_CTX_CREATE:4,RDP_CTX_DESTROY:5,RDP_CTX_FRAME:6,RDP_CTX_CMDS:7,RDP_COMMANDS:8,GFX_RDP_SURFACE_CREATE:9,GFX_RDP_SURFACE_DESTROY:10,GFX_RDP_SURFACE_FRAME:11,GFX_RDP_INITIALIZE:12};var _eResponseCodes={SUCCESS:0,FAIL:1,POPUP_BLOCKED:2,UNSUPPORTED_INTERFACE:3,MONITOR_POSITION_IS_IN_USE:4,CANNOT_REGISTER_DEVICE:5,INVALID_SURFACE:6,IS_NOT_ADJACENT:7,UNKNOWN:8};var _eStates={NOT_INITIALIZE:0,READY:1,
DISPOSING:2,DISPOSED:3};Object.freeze(_eTypes);Object.freeze(_eResponseCodes);Object.freeze(_eStates);function Manager(config,args){var _ref=this;var _registeredDevices=[];var _last={focusId:null,focusValue:null};var _handlers={};var _db=null;var _dbSettings={name:"thinfinity.display.manager.store",store:"settings",ready:false,key:null,enabled:true};var _bufferControl={};var _blockedDevices=[];var _checkPacket=false;var _timeoutPromptId=null;var _timeoutPromptTextId=null;var _sizeLimit={max:{width:8096,
height:8096},min:{width:640,height:480}};var _prevInfo=null;var fireEvent=null;var feSettings={async:0};var _middlewares={sendFocus:null};var _origCallback=null;var _preserveConfiguration=false;var _maxRestoreTime=15E3;var _currentPromptTime=null;var _lastMergedInfo=null;var _graphicsReady=false;var _eState=_eStates.NOT_INITIALIZE;var _showCountdownTime=true;var _registeredDisplaysCmds={};var _mainDisplay=null;var _restoreSavedWindows=false;var _gfx=null;var _lastCursorCanvasId=null;var _eFitMode=
{"FIT_TO_BROWSER":"fittobrowser","FIT_TO_SCREEN":"fittoscreen","CUSTOM":"custom"};var _storageSessionData={};function initialize(){args.sizeLimit=_sizeLimit;if(_checkPacket){args.methods.processDataEcho=function(id,data){if(_bufferControl[id].q[data.p]===false)delete _bufferControl[id].q[data.p];else helper.console.log(`The packet was processed, but does not match with the original MonitorId: ${id}, Pkt: ${data.p}`,arguments);if(_bufferControl[id].q[data.p-1]===false)helper.console.warning(`Unprocessed pkt - MonitorId: ${id}, Pkt: ${data.p-
1}`,arguments)};_handlers[_eTypes.H264_RDP_SURFACE_FRAME]=function(id,data){if(_registeredDevices[id]){_bufferControl[id].q[_bufferControl[id].pkt]=false;_registeredDevices[id].processData(data);_bufferControl[id].pkt++}else helper.console.debug(`Cannot find device id: ${id}`,arguments)}}else _handlers[_eTypes.H264_RDP_SURFACE_FRAME]=function(id,data){if(_registeredDevices[id]?.processData)_registeredDevices[id].processData(data);else helper.console.warning(`Cannot find device id: ${id}`,arguments)};
_handlers[_eTypes.H264_RDP_SURFACE_CREATE]=_handlers[_eTypes.H264_RDP_SURFACE_DESTROY]=processEvent;_handlers[_eTypes.RDP_COMMANDS]=function(id,data){if(_registeredDevices[id]?.processCmds)return _registeredDevices[id].processCmds(data)};_handlers[_eTypes.GFX_RDP_INITIALIZE]=function(){if(Thinfinity?.Driver?.GFX){_gfx=new Thinfinity.Driver.GFX({methods:{frameEnd:frameId=>{args.methods.sendCmd("cmd=frameEnd&frame="+frameId)},processData:(id,data)=>{if(_registeredDevices[id]?.processData)_registeredDevices[id].processData(data)}}});
let gfxRepaintHandler=function(){helper.console.log("Repaint GFX surfaces");_gfx.repaint()};args.on("gfxRepaint",gfxRepaintHandler);_ref.on("addDevice",gfxRepaintHandler)}else{let msg=`Cannot initialize GFX Class, ${consts.technicalSupport}`;helper.console.warning(msg);throw new Error(msg);}};_handlers[_eTypes.GFX_RDP_SURFACE_FRAME]=function(id,data){_gfx.processCmd(data)};_handlers[_eTypes.GFX_RDP_SURFACE_CREATE]=function(id,data){_gfx.addSurface(data)};_handlers[_eTypes.GFX_RDP_SURFACE_DESTROY]=
function(id,data){_gfx.deleteSurface(data)};_middlewares.sendFocus=args.methods.sendFocus;args.methods.sendFocus=executeFocus;args.methods.resize=executeResize;args.methods.repaint=function(){if(_gfx)_gfx.repaint()};addHandlers();registerDisplayCommands();fireEvent=(new Thinfinity.Events({"owner":_ref,"events":args.events})).fireEvent;initializeDB();_showCountdownTime=!config?.shadowingSession;attachLocalEvents();_eState=_eStates.READY}function addHandlers(){helper.dom.addEvent(window,["beforeUnload",
"unload"],function(e){saveSettings();_registeredDevices.forEach(function(m){m.dispose()})},{passive:true})}function attachLocalEvents(){if(args?.on)args.on("localEvent",processLocalEvents)}function remoteLocalEvents(){if(args?.off)args.off("localEvent",processLocalEvents)}function processLocalEvents(data){let cmd=null;if(data.cmd)cmd=data.cmd.toLowerCase();switch(cmd){case "sessionstatus":_storageSessionData.sessionstatus=data.data;break}}function fireStorageData(name){if(args?.__prototype__?.fireEvent&&
_storageSessionData[name])args.__prototype__.fireEvent("localEvent",{cmd:"sessionstatus",data:_storageSessionData[name]})}function registerDisplayCommands(){registerDisplayCmd("DS",function(id,width,height,hwnd,left,top){let device=_registeredDevices.find(d=>{return d.id==id});if(device){helper.console.log(`DS id:${id},width:${width}, height:${height}`);_handlers[_eTypes.RDP_COMMANDS](id,{cmd:"DS",width,height,hwnd,left,top});fireEvent("desktopSize",id,width,height,hwnd,left,top,feSettings)}});registerDisplayCmd("GET_ZOOM_FACTOR",
function(value){return _registeredDevices[_mainDisplay.id].properties.zoomFactor});registerDisplayCmd("SET_ZOOM_FACTOR",function(value){return _registeredDevices[_mainDisplay.id].properties.zoomFactor=value});registerDisplayCmd("ZOOM_DESKTOP",function(value){return _handlers[_eTypes.RDP_COMMANDS](_mainDisplay.id,{cmd:"ZOOM_DESKTOP",value})});registerDisplayCmd("GET_SCALE",function(){return _registeredDevices[_mainDisplay.id].properties.scale});registerDisplayCmd("CURSOR_CANVAS",function(){return _registeredDevices[_mainDisplay.id].cursorCanvas});
registerDisplayCmd("GET_MIN_ZOOM_FACTOR",function(){return _registeredDevices[_mainDisplay.id].getMinZoomFactor});registerDisplayCmd("CENTER",function(){return _handlers[_eTypes.RDP_COMMANDS](_mainDisplay.id,{cmd:"CENTER"})});registerDisplayCmd("ZOOM_FACTOR_RESET",function(){return _handlers[_eTypes.RDP_COMMANDS](_mainDisplay.id,{cmd:"ZOOM_FACTOR_RESET"})});registerDisplayCmd("PLAYBACK_MOUSE_MOVE",function(id,data){if(id!==_lastCursorCanvasId){args.__prototype__.fireEvent("hideCursor");_lastCursorCanvasId=
id}return _handlers[_eTypes.RDP_COMMANDS](id,{cmd:"PLAYBACK_MOUSE_MOVE",data})})}async function sync(){return new Promise(resolve=>{if(_dbSettings.enabled&&_db)_db.ready(function(){resolve(true);return true});else{resolve(true);return true}})}function getKey(){return btoa(`${config.username}${config.model}`)}function initializeDB(){if(_dbSettings.enabled&&Thinfinity.IndexedDB&&config?.db!==false){_db=new Thinfinity.IndexedDB({name:_dbSettings.name,store:_dbSettings.store});_dbSettings.key=getKey();
_db.ready(function(){_dbSettings.ready=true})}}function getStoredConfiguration(){if(_dbSettings.enabled&&_dbSettings.ready&&_restoreSavedWindows)if(config?.canBeOverridden===true){let displaysInfo=_db.get(_dbSettings.key);if(displaysInfo)try{displaysInfo=JSON.parse(displaysInfo);if(displaysInfo.length===0)displaysInfo=null;else{let d0=displaysInfo[0];if(!d0.surface||!d0.display||!d0.window){helper.console.warning(`${consts.displayInvalidStoredData}`.arguments);clearCustomSettings();displaysInfo=null}if(displaysInfo){let md=
displaysInfo.find(d=>{return d.mainDisplay});if(!(md&&md.external!==true)){helper.console.warning(`${consts.displayInvalidStoredData}`.arguments);clearCustomSettings();displaysInfo=null}else{let i=displaysInfo.findIndex(d=>{return d.mainDisplay});displaysInfo.splice(i,1);displaysInfo.unshift(md);fireEvent("updateDisplaySize",md,feSettings);fireEvent("checkDistribution",displaysInfo,feSettings)}}}}catch(err){displaysInfo=null}return displaysInfo}else{clearCustomSettings();return null}else return null}
function saveSettings(){if(_dbSettings.enabled&&config?.canBeOverridden===true&&_eState===_eStates.READY)_db.add(_dbSettings.key,JSON.stringify(getDisplaysInOrder()))}function isAdjacentToTheRight(baseDisplay,newDisplay){return baseDisplay.surface.left+baseDisplay.display.width===newDisplay.surface.left&&(baseDisplay.surface.top<=newDisplay.surface.top&&newDisplay.surface.top<baseDisplay.display.height)}function isAdjacentToTheLeft(baseDisplay,newDisplay){return newDisplay.surface.left+newDisplay.display.width===
baseDisplay.surface.left&&(baseDisplay.surface.top<=newDisplay.surface.top&&newDisplay.surface.top<baseDisplay.display.height)}function isAdjacentToTheTop(baseDisplay,newDisplay){return newDisplay.surface.top+newDisplay.display.height===baseDisplay.surface.top&&(baseDisplay.surface.left<=newDisplay.surface.left&&newDisplay.surface.left<baseDisplay.display.width)}function isAdjacentToTheBottom(baseDisplay,newDisplay){return baseDisplay.surface.top+baseDisplay.display.height===newDisplay.surface.top&&
(baseDisplay.surface.left<=newDisplay.surface.left&&newDisplay.surface.left<baseDisplay.display.width)}function checkDisplaySurface(device,stopPosition){let res={code:_eResponseCodes.SUCCESS,id:null};if(device){let w=null,h=null;if(device.width<_sizeLimit.min.width)w=_sizeLimit.min.width;else if(device.width>_sizeLimit.max.width)w=_sizeLimit.max.width;if(device.height<_sizeLimit.min.height)h=_sizeLimit.min.height;else if(device.height>_sizeLimit.max.height)h=_sizeLimit.max.height;w=w||device.width;
h=h||device.height;if(device.size)device.size={width:w,height:h};else{device.physicalWidth=device.width=w;device.physicalHeight=device.height=h}w=device.width;h=device.height;let displays=getPurgeInfo();if(displays.length===0&&device.surface.top===0&&device.surface.left===0){res.id=0;return res}let attached=false;let valid=true;if(displays.length>0){let maxIdx=displays.length-1;if(typeof stopPosition!=="undefined")maxIdx=Math.min(maxIdx,stopPosition);let m=displays[0];let l=displays.length>0?displays[Math.min(displays.length-
1,maxIdx)]:null;if(isAdjacentToTheLeft(m,device)||isAdjacentToTheTop(m,device)){attached=true;res.id=0;valid=device.surface.left>=m.surface.left+m.width||device.surface.left+w<=m.surface.left||device.surface.top>=m.surface.top+m.height||device.surface.top+h<=m.surface.top}else if(isAdjacentToTheRight(l||m,device)||l&&isAdjacentToTheBottom(l,device)){attached=true;res.id=displays.length;valid=true}}if(!(attached&&valid)){let msg="";if(!attached){msg=consts.displayIsNotAdjacent;res.code=_eResponseCodes.IS_NOT_ADJACENT}if(!valid){msg+=
(msg.length>0?" ":"")+consts.displayInvalidSurface;if(res.code===_eResponseCodes.SUCCESS)res.code=_eResponseCodes.INVALID_SURFACE}res.message=msg;helper.console.warning(msg,arguments)}return res}}function getDisplaysInOrder(){var res=[];_registeredDevices.forEach(function(display){let m=display.getInfo();res.push(m)});return res.sort(function(a,b){return a.surface.top==b.surface.top?a.surface.left-b.surface.left:a.surface.top-b.surface.top})}function getMainDisplayId(){let md=_registeredDevices.find(d=>
{return d.mainDisplay});return md?.id||null}function clearCustomSettings(){return new Promise(function(resolve){if(_db)_db.resetDB(resolve);else resolve(true)})}function executeResize(){let mp=getPurgeInfo(true);if(mp.length>0){args.events.resize(mp);fireEvent("resize",mp);if(mp!==_prevInfo){_prevInfo=mp;if(_preserveConfiguration)saveSettings(mp)}}}function getPurgeInfo(isResize){let mp=getDisplaysInOrder();if(mp&&mp.length>0)mp.forEach(item=>{switch(args.properties.resolution){case _eFitMode.FIT_TO_BROWSER:if(args.properties.resizeDesktop&&
isResize){item.display.width=item.width;item.display.height=item.height}break;case _eFitMode.FIT_TO_SCREEN:if(!item.assigned){item.display.width=item.screen.width;item.display.height=item.screen.height}break;case _eFitMode.CUSTOM:break}});fireEvent("checkDistribution",mp,feSettings);return mp}function executeFocus(displayId,cmd,value){if(value!==false)_last.focusId=displayId;_middlewares.sendFocus.apply(null,arguments)}function getDisplay(id){return _registeredDevices.find(function(m){return m.id===
id})}function updateInternalIds(){_registeredDevices.forEach(function(d,i){d.id=i})}async function addDevice(displayDevice){let restoreDisplay=typeof arguments[1]!=="undefined"?arguments[1]:true;return new Promise(resolve=>{if(!(displayDevice&&displayDevice instanceof Thinfinity.Display.Device))displayDevice=new Thinfinity.Display.Device(displayDevice);if(displayDevice&&displayDevice instanceof Thinfinity.Display.Device){let res=null;if(config?.shadowingSession)res={code:_eResponseCodes.SUCCESS,id:displayDevice.id};
else res=checkDisplaySurface(displayDevice);if(res.code===_eResponseCodes.SUCCESS){displayDevice.id=res.id;_registeredDevices.splice(displayDevice.id,0,displayDevice);displayDevice.focus=false;if(displayDevice.mainDisplay)args.methods.disconnect=function(){fireEvent("disconnect")};displayDevice.setInterface(_ref,{...args,...{extra:{key:getKey()}}},displayDevice.window).then(function(response){displayDevice.elements=response;displayDevice.getInterface(_ref).then(function(rOutput){if(rOutput){displayDevice.output=
rOutput;if(_checkPacket)_bufferControl[displayDevice.id]={pkt:1,q:{}};updateInternalIds();if(!_mainDisplay&&displayDevice.mainDisplay)_mainDisplay=displayDevice;fireEvent("addDevice");if(!displayDevice.mainDisplay)fireStorageData("sessionstatus");resolve({res:true,id:displayDevice.id,message:"",code:_eResponseCodes.SUCCESS})}else{let message=consts.displayInterfaceNotSupported;helper.console.warning(message,arguments);shiftDevice(displayDevice.id);resolve({res:false,id:displayDevice.id,message,code:_eResponseCodes.UNSUPPORTED_INTERFACE})}}).catch(function(err){let res=
{...{res:false,id:displayDevice.id,code:_eResponseCodes.UNKNOWN},...err};res.message=res.message||arguments?.[0]?.message||arguments?.[0];helper.console.warning(`${res.message} ${arguments?.[0]?.stack||""}`,arguments);shiftDevice(displayDevice.id);resolve(res)})}).catch(function(err){res={...res,...{id:displayDevice.id},...err};res.code=err.code===_eResponseCodes.POPUP_BLOCKED?_eResponseCodes.POPUP_BLOCKED:_eResponseCodes.UNKNOWN;res.message=res.message||arguments?.[0]?.message||arguments?.[0];helper.console.warning(`${res.message} ${arguments?.[0]?.stack||
""}`,arguments);if(restoreDisplay){let d=shiftDevice(displayDevice.id);if(!_blockedDevices.find(function(item){return item.id===displayDevice.id}))_blockedDevices.push(d)}resolve(res)})}else{if(restoreDisplay){let d=shiftDevice(displayDevice.id);if(!_blockedDevices.find(function(item){return item.id===displayDevice.id}))_blockedDevices.push(d)}resolve(res)}}else{let message=consts.displayCannotRegisterDevice;helper.console.warning(message,arguments);shiftDevice(id);resolve({res:false,id,message,code:_eResponseCodes.CANNOT_REGISTER_DEVICE})}})}
async function restoreDevices(){return new Promise(function(resolve){_origCallback=function(){_origCallback=null;resolve(true)};shiftBlockedDevices()})}async function restoreConfigurationPrompt(){_timeoutPromptId=setTimeout(function(){Thinfinity.Popups.unblock();clearInterval(_timeoutPromptTextId);_origCallback()},_maxRestoreTime);_timeoutPromptTextId=setInterval(function(){let dlg=document.getElementById("dlgMessage");if(dlg){let s=parseInt((_maxRestoreTime-(Date.now()-_currentPromptTime))/1E3,10);
if(s>1)s=s.toString()+" "+consts.seconds;else s=s.toString()+" "+consts.second;dlg.innerHTML=helper.string.sprintf(consts.displayRestoreDevices,s)}},parseInt(_maxRestoreTime/1E3,10));await restoreDevices()}function shiftBlockedDevices(next){if(next!==false&&_blockedDevices.length>0){let bDev=_blockedDevices.shift()[0];showPromptPopup(bDev,shiftBlockedDevices)}else _origCallback()}function restoreDevice(device){return new Promise(function(resolve){addDevice(device,false).then(function(res){if(res&&
res.code!==_eResponseCodes.SUCCESS)r=false;resolve(r)}).catch(function(err){resolve(false)})})}function showPromptPopup(device,callback){let buttons=[{value:consts.open,class:"",action:function(e){helper.console.log(`Restoring devices`,arguments);clearTimeout(_timeoutPromptId);clearInterval(_timeoutPromptTextId);restoreDevice(device).then(function(res){if(callback)return callback(true)}).catch(function(err){if(callback)return callback(true)})}}];if(_showCountdownTime)buttons.push({value:consts.cancel,
class:"",action:function(e){helper.console.log(`Updating settings `,arguments);clearTimeout(_timeoutPromptId);clearInterval(_timeoutPromptTextId);if(callback)callback(false)}});let promptConfig={id:"dlgRestoreDevicePrompt",parentElement:"",class:"",iconType:"disconnectedIco",title:productName,message:`<span id="dlgMessage">${consts.displayRestoreDevices} ${_showCountdownTime?helper.string.sprintf(consts.displayPopupAutoClose,parseInt(_maxRestoreTime/1E3,10).toString()+" "+consts.seconds):""}</span>`,
buttons,noPropagateEvents:true};Thinfinity.Popups.choice(promptConfig);_currentPromptTime=Date.now()}function shiftDevice(id){helper.console.log(`Removing device ${id}`);let m=getDisplay(id);if(m){m.dispose();return _registeredDevices.splice(_registeredDevices.findIndex(function(m){return m.id===id}),1)}else return false}function removeDevice(id,silent){if(_eState===_eStates.READY)if(shiftDevice(id)){if(!silent){_registeredDevices.forEach(m=>{if(m.id>=id)m.id--});executeResize()}if(_lastMergedInfo)syncDisplayInfo(_lastMergedInfo,
true);fireEvent("removeDevice")}}function getOutputDevice(){let rd=!!_last.focusId&&_registeredDevices[_last.focusId]?_registeredDevices[_last.focusId]:getDisplay(0);return rd?rd.output:null}function focus(){let oDev=getOutputDevice();if(oDev?.setFocus)oDev.setFocus()}function setSelectionRange(){let oDev=getOutputDevice();if(oDev?.setSelectionRange)return oDev.setSelectionRange()}function textValue(){let oDev=getOutputDevice();if(oDev?.textValue)return oDev.textValue()}function updateMacCmd(){let oDev=
getOutputDevice();if(oDev?.updateMacCmd)return oDev.updateMacCmd()}function processData(id,eType,data){_handlers[eType](id,data)}function processEvent(id,data){helper.console.log(`Processing video event ${id} : ${data}`)}function registerDisplayCmd(cmd,handler){if(!_registeredDisplaysCmds[cmd])_registeredDisplaysCmds[cmd]=handler;else return false}function processDisplayCmd(cmd){if(_registeredDisplaysCmds[cmd])return _registeredDisplaysCmds[cmd].apply(null,[...arguments].splice(1));else return undefined}
function removeAllExternalDisplays(){_registeredDevices.forEach(d=>{if(!d.mainDisplay)d.dispose()})}function verifyInfo(src,tgt){var props=["width","left","id","surface"];if(src&&tgt)if(src.length!=tgt.length)return true;else src.forEach((srcItem,idx)=>{let tgtItem=tgt[idx];let d=false;props.forEach(p=>{if(srcItem[p]!==tgtItem[p])d=true});if(d)return true});else return true}async function syncDisplayInfo(displayInfo){if(_eState===_eStates.READY){let forced=arguments[1];if(displayInfo)if(forced||verifyInfo(_lastMergedInfo,
displayInfo)){helper.console.debug(`Sync display info ${JSON.stringify(displayInfo)}`);removeAllExternalDisplays();var proms=[];displayInfo.forEach(d=>{if(!d.mainDisplay){delete d.physicalHeight;delete d.physicalWidth;d.external=true;d.surface={left:d.left,top:d.top};proms.push(addDevice(new Thinfinity.Display.Device(d),true))}});let values=await Promise.all(proms);var blockedMsg=null;values.forEach(function(res){if(res&&res.code!==Thinfinity.Display.Manager.RESPONSE_CODES.SUCCESS)if(res.code===Thinfinity.Display.Manager.RESPONSE_CODES.POPUP_BLOCKED)blockedMsg=
res.message});_showCountdownTime=false;if(blockedMsg)values=await restoreDevices();restoreDevices().then(()=>{_lastMergedInfo=displayInfo;fireEvent("syncCompleted")})}}}function dispose(){_eState=_eStates.DISPOSING;_registeredDevices.forEach(m=>{removeDevice(m.id,true);m.dispose()});_eState=_eStates.DISPOSED;remoteLocalEvents();fireEvent("dispose")}initialize();Object.defineProperty(_ref,"addDevice",{enumerable:true,configurable:false,writable:false,value:addDevice});Object.defineProperty(_ref,"removeDevice",
{enumerable:true,configurable:false,writable:false,value:removeDevice});Object.defineProperty(_ref,"clearCustomSettings",{enumerable:true,configurable:false,writable:false,value:clearCustomSettings});Object.defineProperty(_ref,"getDisplaysInfo",{enumerable:true,configurable:false,writable:false,value:getPurgeInfo});Object.defineProperty(_ref,"getDisplaysInOrder",{enumerable:true,configurable:false,writable:false,value:getDisplaysInOrder});Object.defineProperty(_ref,"fireEvent",{enumerable:true,configurable:false,
writable:false,value:args.__prototype__.fireEvent});Object.defineProperty(_ref,"dispose",{enumerable:true,configurable:false,writable:false,value:dispose});Object.defineProperty(_ref,"preserveConfiguration",{enumerable:true,configurable:false,get:function(){return _preserveConfiguration},set:function(value){_preserveConfiguration=value}});Object.defineProperty(_ref,"sync",{enumerable:true,configurable:false,writable:false,value:sync});Object.defineProperty(_ref,"limits",{enumerable:true,configurable:false,
get:function(){return args.sizeLimit},set:function(value){return helper.object.parseAttributes(args.sizeLimit,value)}});Object.defineProperty(_ref,"getStoredConfiguration",{enumerable:true,configurable:false,writable:false,value:getStoredConfiguration});Object.defineProperty(_ref,"graphicsReady",{enumerable:true,configurable:false,writable:false,writable:false,value:function(){if(!_graphicsReady)executeResize();_graphicsReady=true}});Object.defineProperty(_ref,"restoreDevices",{enumerable:true,configurable:false,
writable:false,value:restoreConfigurationPrompt});Object.defineProperty(_ref,"state",{enumerable:true,configurable:false,get:function(){return _eState}});Object.defineProperty(_ref,"mainDisplayId",{enumerable:true,configurable:false,get:getMainDisplayId});Object.defineProperty(_ref,"processData",{enumerable:true,configurable:false,writable:false,value:processData});Object.defineProperty(_ref,"focus",{enumerable:true,configurable:false,writable:false,value:focus});Object.defineProperty(_ref,"setSelectionRange",
{enumerable:true,configurable:false,writable:false,value:setSelectionRange});Object.defineProperty(_ref,"textValue",{enumerable:true,configurable:false,writable:false,value:textValue});Object.defineProperty(_ref,"updateMacCmd",{enumerable:true,configurable:false,writable:false,value:updateMacCmd});Object.defineProperty(_ref,"processDisplayCmd",{enumerable:true,configurable:false,writable:false,value:processDisplayCmd});if(config?.shadowingSession)Object.defineProperty(_ref,"syncDisplayInfo",{enumerable:true,
configurable:false,writable:false,value:syncDisplayInfo});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(!Thinfinity.Display)Thinfinity.Display={};Thinfinity.Display.Manager=Manager;Object.defineProperty(Thinfinity.Display.Manager,"EVENT_TYPES",{enumerable:true,configurable:false,get:function(){return _eTypes}});Object.defineProperty(Thinfinity.Display.Manager,"RESPONSE_CODES",{enumerable:true,configurable:false,get:function(){return _eResponseCodes}});Object.defineProperty(Thinfinity.Display.Manager,
"STATES",{enumerable:true,configurable:false,get:function(){return _eStates}})})();
(function(){var _eDistributionModes={SINGLE:0,LANDSCAPE:1,PORTRAIT:2,MATRIX:3};Object.freeze(_eDistributionModes);var _addingPosition={TOP:0,RIGHT:1,BOTTOM:2,LEFT:3,UNDEFINED:4};Object.freeze(_addingPosition);function Map(){var _ref=this;var _settings={manager:null,maxAvailable:16,icon:""};var _elements={container:null,dialog:null,body:null,mapView:null,buttonsContainers:[]};var _monitorsConfig={canBeOverridden:false,count:1};var resizeTimer=null;var RESIZE_TIMEOUT=250;var _currentMap=null;var fireEvent=
null;var _screenDetails=null;var _profile=null;var _disposed=false;var _displayAttachedCount=0;var _mainDisplayProcessed=false;var _screenDetailsSync=false;var _isNumber=null;var _getDisplayInfo=null;function initialize(args){_isNumber=helper.object.isNumber;helper.object.parseAttributes(_settings,args);helper.object.parseAttributes(_monitorsConfig,args?.monitors||null);if(args?.profile)_profile=args.profile;if(!_settings.manager){let msg=`Cannot initialize Thinfinity.Display.Map, Thinfinity.Display.Manager is null or undefined.`;
helper.console.warning(msg,arguments);throw new Error(msg);}_getDisplayInfo=_settings.manager.getDisplaysInOrder;attachHandlers();createContainer();fireEvent=(new Thinfinity.Events({"owner":_ref,"events":args.events})).fireEvent}function attachHandlers(){_settings.manager.on(["addDevice","resize"],refresh);_settings.manager.on(["removeDevice"],removeDevice);_settings.manager.on(["updateDisplaySize"],updateDisplaySize);_settings.manager.on("checkDistribution",checkDistribution);_settings.manager.on("dispose",
dispose)}function detachHandlers(){_settings.manager.off(["addDevice","resize"],refresh);_settings.manager.off(["removeDevice"],removeDevice);_settings.manager.off(["updateDisplaySize"],updateDisplaySize);_settings.manager.off("checkDistribution",checkDistribution);_settings.manager.off("dispose",dispose)}function createContainer(){var cont=document.createElement("DIV");cont.className="displaymap hidden";var background=document.createElement("DIV");background.className="background";var dialog=document.createElement("DIV");
dialog.className="dialog popup";createDialogContent(dialog);background.appendChild(dialog);cont.appendChild(background);document.body.appendChild(cont);_elements.container=cont}function createDialogContent(dialog){addHeader(dialog);addContent(dialog);addFooter(dialog)}function addHeader(dialog){var header=document.createElement("DIV");header.className="header";var htext=document.createElement("H3");htext.innerHTML=consts.displayAddNewDisplay;htext.className=_settings.icon;if(_monitorsConfig.canBeOverridden){var closeicon=
document.createElement("SPAN");closeicon.className="close thin-cancel";closeicon.onclick=hide;htext.appendChild(closeicon)}header.appendChild(htext);dialog.appendChild(header)}function addContent(dialog){_elements.body=document.createElement("DIV");_elements.body.className="body";_elements.mapText=document.createElement("H3");_elements.mapText.className="legend";_elements.mapText.innerHTML=consts.displayAddNewDisplayLegend;_elements.body.appendChild(_elements.mapText);let btnContainer=newButtonBar("portrait-add",
_addingPosition.TOP);_elements.buttonsContainers.push(btnContainer);_elements.body.appendChild(btnContainer);var mapViewContainer=document.createElement("DIV");mapViewContainer.className="mv-container";btnContainer=newButtonBar("landscape-add",_addingPosition.LEFT);_elements.buttonsContainers.push(btnContainer);mapViewContainer.appendChild(btnContainer);_elements.mapView=document.createElement("DIV");_elements.mapView.className="mapview";mapViewContainer.appendChild(_elements.mapView);btnContainer=
newButtonBar("landscape-add",_addingPosition.RIGHT);_elements.buttonsContainers.push(btnContainer);mapViewContainer.appendChild(btnContainer);_elements.body.appendChild(mapViewContainer);btnContainer=newButtonBar("portrait-add",_addingPosition.BOTTOM);_elements.buttonsContainers.push(btnContainer);_elements.body.appendChild(btnContainer);dialog.appendChild(_elements.body);_elements.dialog=dialog}function addFooter(dialog){var footer=document.createElement("DIV");footer.className="divbuttons";var btn=
document.createElement("A");btn.className="popuplink selected";btn.innerHTML=consts.Close;btn.addEventListener("click",hide);footer.appendChild(btn);var btn=document.createElement("A");btn.className="popuplink";btn.innerHTML=consts.displayIdentify;btn.addEventListener("click",function(e){_settings.manager.fireEvent("localEvent",{cmd:"identify",timeout:2500});hide()});footer.appendChild(btn);if(_monitorsConfig.canBeOverridden){var btn=document.createElement("A");btn.className="popuplink";btn.innerHTML=
consts.displayResetSettings;btn.addEventListener("click",function(){_settings.manager.clearCustomSettings();resetCustomSettings();hide()});footer.appendChild(btn)}dialog.appendChild(footer)}function newButtonBar(className,position){var btnContainer=document.createElement("DIV");btnContainer.className=className;var btn=document.createElement("span");btn.className="thin-plus-circled";btn.setAttribute("position",position);btn.addEventListener("click",processAdding);btnContainer.appendChild(btn);return btnContainer}
function hide(){if(!_disposed){_elements.container.className=_elements.container.className.replace("visible","hidden");onhide()}}function onhide(){_elements.mapView.innerHTML=""}function show(){if(!_disposed){_elements.container.className=_elements.container.className.replace("hidden","visible");onshow()}}function onshow(){render(getDisplaysMap())}async function removeDevice(id){if(_settings.manager.state===Thinfinity.Display.Manager.STATES.READY){_displayAttachedCount--;if(!_monitorsConfig.canBeOverridden)await processProfileInfo()}refresh()}
function refresh(){if(!_disposed)if(_elements.container.className.indexOf("visible")!=-1){_elements.mapView.style.visibility="hidden";if(resizeTimer)window.clearTimeout(resizeTimer);resizeTimer=window.setTimeout(function(){onhide();_elements.mapView.style.visibility="visible";onshow()},RESIZE_TIMEOUT)}}function render(map){let itemClass=_monitorsConfig.canBeOverridden?{r:"hidden",a:""}:{r:"",n:"hidden"};helper.style.replace(_elements.buttonsContainers,itemClass.r,itemClass.n);_elements.body.className=
"body distr-"+map.distribution.desc.toLowerCase();var coef=_elements.mapView.offsetWidth/map.width;var viewHeight=Math.round(map.height*coef);var offsetH=0;_elements.mapView.style.height=viewHeight+"px";if(_elements.mapView.offsetHeight<viewHeight){coef=_elements.mapView.offsetHeight/map.height;offsetH=Math.round((_elements.mapView.offsetWidth-map.width*coef)/2)}let l=0,t=0;map.surfaces.forEach(item=>{if(item.left<0)l=Math.min(item.left,l);if(item.top<0)t=Math.min(item.top,t)});l=Math.abs(l);t=Math.abs(t);
map.surfaces.forEach(item=>{var screen=document.createElement("DIV");screen.className="screen"+(item.mainDisplay?" main":"");screen.innerHTML=item.id+1;screen.style.top=Math.round((item.top+t)*coef)+"px";screen.style.width=Math.round(item.width*coef)+"px";screen.style.left=offsetH+Math.round((item.left+l)*coef)+"px";screen.style.height=screen.style.lineHeight=Math.round(item.height*coef)+"px";if(!item.mainDisplay&&_monitorsConfig.canBeOverridden){var closeBtn=document.createElement("div");closeBtn.className=
"closeBtn thin-cancel";closeBtn.addEventListener("click",function(){fireEvent("requestRemotion",item.id)});screen.appendChild(closeBtn)}_elements.mapView.appendChild(screen)})}function getSurfaces(){_getDisplayInfo()}function getDisplaysMap(surfaces){var values={height:0,width:0,stepsH:[],stepsV:[],surfaces:[]};var size={max:{width:0,height:0},min:{width:0,height:0}};surfaces=surfaces||_getDisplayInfo();if(surfaces){surfaces.forEach(element=>{var surfaceTop,surfaceLeft;surfaceTop=element.surface.top;
surfaceLeft=element.surface.left;let w=element.display.width;let h=element.display.height;var s={top:surfaceTop,left:surfaceLeft,right:surfaceLeft+w,bottom:surfaceTop+h,width:w,height:h,id:element.id,mainDisplay:element.mainDisplay};size.min.width=Math.min(size.min.width,surfaceLeft);size.max.width=Math.max(size.max.width,s.right);size.min.height=Math.min(size.min.height,surfaceTop);size.max.height=Math.max(size.max.height,s.bottom);if(values.stepsH.indexOf(surfaceLeft)==-1)values.stepsH.push(surfaceLeft);
if(values.stepsV.indexOf(surfaceTop)==-1)values.stepsV.push(surfaceTop);values.surfaces.push(s)});values.width=Math.abs(size.min.width)+size.max.width;values.height=Math.abs(size.min.height)+size.max.height;var getDistribution=function(mode){return getDistributionObj(mode)};let mode=null;if(surfaces.length===1)mode=mode=_eDistributionModes.SINGLE;else if(values.stepsV.length==1&&values.stepsH.length==1)mode=_eDistributionModes.SINGLE;else if(values.stepsH.length==1)mode=_eDistributionModes.PORTRAIT;
else if(values.stepsV.length==1)mode=_eDistributionModes.LANDSCAPE;else mode=_eDistributionModes.MATRIX;values.distribution=getDistribution(mode);if(_eDistributionModes.LANDSCAPE)values=adjustWidths(values)}_currentMap=values;return values}function checkDistribution(displays){if(!_currentMap)getDisplaysMap(displays);if(displays?.length>0)if(_currentMap.distribution.value!=_eDistributionModes.SINGLE){let mainDisplayIdx=displays.findIndex(d=>{return d.mainDisplay});let l=displays.length;let accum=0;
let aname=null;let sname=null;switch(_currentMap.distribution.value){case _eDistributionModes.LANDSCAPE:aname="left";sname="width";break;case _eDistributionModes.PORTRAIT:aname="top";sname="height";break;default:throw new Error(`Distribution mode not supported, please contact us.`);}for(let i=mainDisplayIdx-1;i>=0;i--){let m=displays[i];let s=m.display[sname];if(s+m.surface[aname]!=accum){let origVal=m.surface[aname];let newVal=(s+Math.abs(accum))*-1;m.surface[aname]=newVal;helper.console.log(`Fixing surface position,surface: (${aname} from :${origVal},to ${newVal})`)}accum=
m.surface[aname]}let mDisplay=displays[mainDisplayIdx];accum=mDisplay.display[sname];for(let i=mainDisplayIdx+1;i<l;i++){let m=displays[i];if(m.surface[aname]!=accum){let origVal=m.surface[aname];m.surface[aname]=accum;helper.console.log(`Fixing surface position,surface: (${aname} from :${origVal},to ${accum})`)}accum=m.surface[aname]+m.display[sname]}}return displays}function adjustWidths(values){var i,j,len=values.stepsH.length;for(i=1;i<len;i++)if((values.stepsH[i]-values.stepsH[i-1])%2){values.surfaces[i-
1].width--;values.surfaces[i-1].right--;for(j=i;j<len;j++){values.stepsH[j]--;values.surfaces[j].left--;values.surfaces[j].right--}values.width=values.surfaces[len-1].right}return values}function getDistributionObj(value){return{"value":value,"desc":Object.keys(_eDistributionModes)[value]}}function processAdding(e){e.stopPropagation();var elem=e.target||e.srcElement;processDisplay(null,parseInt(elem.getAttribute("position"),10),true)}function processDisplay(device,position,trigger){var data={};switch(_currentMap.distribution.value){case _eDistributionModes.SINGLE:data.width=
_currentMap.width;data.height=_currentMap.height;break;case _eDistributionModes.PORTRAIT:_currentMap.surfaces.sort((a,b)=>a.top-b.top);data.width=_currentMap.width;break;case _eDistributionModes.LANDSCAPE:_currentMap.surfaces.sort((a,b)=>a.left-b.left);data.height=_currentMap.height;break}if(!device)device={display:data};let fp=getFeaturePosition(device,position);if(trigger)addNewDevice(fp);return fp}function resetCustomSettings(){let dInfo=_getDisplayInfo();if(_monitorsConfig.count===dInfo.length);
else if(_monitorsConfig.count>dInfo.length){_displayAttachedCount=dInfo.length;processProfileInfo()}else{let getExternalDisplayId=function(){let ds=_getDisplayInfo();let id=null,i=0;while(i<ds.length&&id==null){if(!ds[i].mainDisplay&&ds[i].external)id=ds[i].id;i++}return id};let r=dInfo.length-_monitorsConfig.count;for(let i=0;i<r;i++){let id=getExternalDisplayId();if(id!=null)fireEvent("requestRemotion",id,true,{async:false})}}}async function addNewDevice(device){if(_monitorsConfig.canBeOverridden)fireEvent("addDevice",
device)}async function updateScreenDetails(){return new Promise(function(resolve){var errMsg=consts.displayScreenDetailsDenied;navigator.permissions.query({name:"window-placement"}).then(permission=>{if(permission.state!=="denied")_screenDetails=window.getScreenDetails().then(r=>{_screenDetails=r;helper.console.log(`Screen details: ${JSON.stringify(_screenDetails)}`);resolve(r)}).catch(e=>{_screenDetails=null;helper.console.log(`${consts.displayManagerError} - ${errMsg}`,arguments);resolve(e)});else{helper.console.log(errMsg,
arguments);resolve(permission)}}).catch(err=>{helper.console.log(errMsg,arguments);resolve(err)})})}function getResolutionValue(resolution){let res=null;switch(resolution){case "fittobrowser":res=ThinRDP.resolution.FIT_TO_BROWSER;break;case "fittoscreen":res=ThinRDP.resolution.FIT_TO_SCREEN;break;case "custom":default:res=ThinRDP.resolution.CUSTOM;break}return res}function updateDisplaySize(device){if(device){device.resolution=_profile?.resolution?getResolutionValue(_profile.resolution):_profile.fitmode||
ThinRDP.resolution.FIT_TO_BROWSER;let tSize=device.resolution==null?null:resolveDisplayResolution(device);let size=tSize?tSize:{width:device.display?.width||environment.availWidth,height:device.display?.height||environment.availHeight};if(!device.surface)device.surface={};if(!device.display)device.display={};device.display.height=device.physicalHeight=device.height=size.height;device.display.width=device.physicalWidth=device.width=size.width}return device}function getFeaturePosition(defaultDevice,
position){let device={surface:{top:0,left:0},window:{top:0,left:0},display:{width:0,height:0},desktopScaleFactor:1,deviceScaleFactor:1,external:true,mainDisplay:false,resolution:"landscape"};if(defaultDevice)helper.object.parseAttributes(device,defaultDevice);updateDisplaySize(device);let displays=_getDisplayInfo();let firstDisplay=displays.length>0?displays[0]:null;let lastDisplay=firstDisplay?displays[displays.length-1]:null;let top=0,left=0;switch(position){case _addingPosition.TOP:if(firstDisplay){top=
firstDisplay.surface.top-device.display.height;left=firstDisplay.surface.left}break;case _addingPosition.LEFT:if(firstDisplay){top=firstDisplay.surface.top;left=firstDisplay.surface.left-device.display.width}break;case _addingPosition.BOTTOM:if(lastDisplay){top=lastDisplay.surface.top+lastDisplay.display.height;left=lastDisplay.surface.left}break;case _addingPosition.RIGHT:if(lastDisplay){top=lastDisplay.surface.top;left=lastDisplay.surface.left+lastDisplay.display.width}break}device.surface={top,
left};let windowPosition={top:0,left:0};let customWP=device.window&&device.isWindowPositionAssigned&&_isNumber(device.window.top)&&_isNumber(device.window.left);if(device.mainDisplay){device.surface.left=0;device.surface.top=0;device.external=false;device.mainDisplay=true;if(!customWP){windowPosition.top=0;windowPosition.left=0}}else{device.external=true;device.mainDisplay=false;if(!customWP){let ml=0;let mt=0;displays.forEach(function(m){if(m.resolution==2){ml+=m.screen.width;mt+=m.screen.height}else{ml+=
m.display.width;mt+=m.display.height}});var getCurrentScreenIndex=function(display){let w=Math.min(display.display.width,display.width);let h=Math.min(display.display.height,display.height);let l=display.window.left;let t=display.window.top;let idx=_screenDetails.screens.findIndex(function(screen){return screen.left<=l&&l+w<=screen.left+screen.width&&screen.top<=t&&t+h<=screen.top+screen.height});if(idx===null)idx=_screenDetails.screens.findIndex(function(screen){return screen.left<=display.window.left&&
display.window.left<screen.left+screen.width&&screen.top<=display.surface.top&&display.surface.top<screen.top+screen.height});return idx};let mainScreenIdx=null;if(displays.length>0&&_screenDetails&&_screenDetails.screens.length>0){let np=null;let screens=[];displays.forEach(function(d){let screen={};let idx=getCurrentScreenIndex(d);if(_isNumber(idx)){if(d.mainDisplay){screen.details=_screenDetails.screens[idx];screen.available=false;screen.index=idx;screen.canBeMoved=false;mainScreenIdx=idx}else{screen.details=
_screenDetails.screens[idx];screen.available=false;screen.index=idx;screen.canBeMoved=true}screens.push(screen)}});_screenDetails.screens.forEach(function(s,i){let screen=screens.find(function(screen){return screen.index===i});if(!screen||screen.available!==false)screens.push({details:_screenDetails.screens[i],available:true,index:i,canBeMoved:false})});screens=screens.sort(function(s1,s2){return s1.index-s2.index});let availableScreenIdx=null;switch(position){case _addingPosition.TOP:case _addingPosition.LEFT:if(mainScreenIdx>
0)for(let i=0;i<mainScreenIdx;i++)if(screens[i].available)availableScreenIdx=i;break;case _addingPosition.BOTTOM:case _addingPosition.RIGHT:for(let i=screens.length-1;i>mainScreenIdx;i--)if(screens[i].available)availableScreenIdx=i;break;case _addingPosition.UNDEFINED:for(let i=screens.length-1;i>mainScreenIdx;i--){if(screens[i].available)availableScreenIdx=i;np="major"}if(availableScreenIdx==null)for(let i=0;i<screens.length-1;i++){if(screens[i].available)availableScreenIdx=i;np="minor"}break}if(availableScreenIdx==
null){let availScreen=screens.find(function(s){return s.available});if(availScreen)availableScreenIdx=availScreen.index;else{np="major";availableScreenIdx=0}}let t=0,l=0;try{t=screens[availableScreenIdx].details.top;l=screens[availableScreenIdx].details.left}catch(error){helper.console.warning(`Cannot get screen detail at: ${availableScreenIdx}, length: ${_screenDetails.screens.length}`)}finally{windowPosition.top=t;windowPosition.left=l}if(position==_addingPosition.UNDEFINED){let as=screens[availableScreenIdx].details;
let sl=l-(l+device.display.width);st=t;if(np=="major"){if(lastDisplay)if(Math.abs(as.top-lastDisplay.surface.top)>Math.abs(as.left-lastDisplay.surface.left)){st=lastDisplay.surface.top+lastDisplay.display.height;sl=lastDisplay.surface.left}else{st=lastDisplay.surface.top;sl=lastDisplay.surface.left+lastDisplay.display.width}}else if(np="minor")if(firstDisplay)if(Math.abs(as.top-firstDisplay.surface.top)>Math.abs(as.left-firstDisplay.surface.left)){st=firstDisplay.surface.top-device.display.height;
sl=firstDisplay.surface.left}else{st=firstDisplay.surface.top;sl=firstDisplay.surface.left-device.display.width}device.surface.top=st;device.surface.left=sl}}else{if(position==_addingPosition.UNDEFINED){device.surface.top=0;device.surface.left=ml}windowPosition.top=0;windowPosition.left=ml}}if(!customWP){device.window.top=windowPosition.top;device.window.left=windowPosition.left}}let msg=null;if(device.mainDisplay)msg=`Feature Position - Opening in the current tab, width: ${device.width}, height: ${device.height}`;
else msg=`Feature Position - x: ${device.window.left}, y ${device.window.top}, width: ${device.width}, height: ${device.height}`;helper.console.log(msg);return device}function resolveDisplayResolution(display){let res=null;if(display&&display.resolution!==null){let availScreens=null;let displays=_getDisplayInfo();if(_screenDetails){availScreens=_screenDetails.currentScreen;if(!display.mainDisplay&&_screenDetails.screens.length)if(_screenDetails.screens.length>displays.length)availScreens=_screenDetails.screens[displays.length];
else if(_screenDetails.screens.length<=displays.length)availScreens=_screenDetails.screens[displays.length-1]}let width=environment.availWidth;let height=environment.availHeight;if(!display.mainDisplay)switch(display.resolution){case ThinRDP.resolution.FIT_TO_SCREEN:if(availScreens){width=availScreens.width;height=availScreens.height}else{width=window.screen?.width||window.screenWidth;height=window.screen?.height||window.screenHeight}break;case ThinRDP.resolution.FIT_TO_BROWSER:if(availScreens){width=
availScreens.availWidth;height=availScreens.availHeight}else if(displays.length>0){let lastDisplay=displays[displays.length-1];width=lastDisplay.width;height=lastDisplay.height}break;case ThinRDP.resolution.CUSTOM:default:width=_profile.screenWidth;height=_profile.screenHeight;break}width=Math.max(width,_settings.manager.limits.min.width);height=Math.max(height,_settings.manager.limits.min.height);res={width,height}}return res}function setDistribution(value){getDisplaysMap();if(_currentMap?.distribution?.value)_currentMap.distribution.value=
value}function getDistribution(){let dMode=null;switch(_profile.multiMonitor.orientation){case 0:dMode=Thinfinity.Display.Map.DISTRIBUTION_MODES.LANDSCAPE;break;case 1:dMode=Thinfinity.Display.Map.DISTRIBUTION_MODES.PORTRAIT;break;case 2:case 3:default:dMode=Thinfinity.Display.Map.DISTRIBUTION_MODES.LANDSCAPE;break}return dMode}function getDeviceAndPosition(){let position=null;let device={resolution:environment.currentOrientation,desktopScaleFactor:1,deviceScaleFactor:1,mainDisplay:false,external:true};
if(!_currentMap)setDistribution(getDistribution());if(!_mainDisplayProcessed){position=Thinfinity.Display.Map.POSITION.LEFT;device.mainDisplay=true;device.external=false;_mainDisplayProcessed=true;_displayAttachedCount++}else if(_profile.multiMonitor&&_profile.multiMonitor.count>_displayAttachedCount)switch(_profile.multiMonitor.orientation){case 0:position=Thinfinity.Display.Map.POSITION.RIGHT;_displayAttachedCount++;break;case 1:position=Thinfinity.Display.Map.POSITION.BOTTOM;_displayAttachedCount++;
break;default:position=Thinfinity.Display.Map.POSITION.UNDEFINED;_displayAttachedCount++;break}if(position)return{device,position};else return null}async function processProfileInfo(){helper.console.log(`processProfileInfo multiMonitor count: ${_monitorsConfig.count}, overriden: ${_monitorsConfig.canBeOverridden}`);if(!_screenDetailsSync)await updateScreenDetails();_screenDetailsSync=true;let dp=getDeviceAndPosition();if(dp){let addingInfo=processDisplay(dp.device,dp.position);if(addingInfo){let devBlocked=
null;await _settings.manager.addDevice(new Thinfinity.Display.Device(addingInfo)).then(res=>{if(res&&res.code!==Thinfinity.Display.Manager.RESPONSE_CODES.SUCCESS)if(res.code===Thinfinity.Display.Manager.RESPONSE_CODES.POPUP_BLOCKED)devBlocked=true});if(devBlocked)await _settings.manager.restoreDevices();return await processProfileInfo()}}else return _mainDisplayProcessed}function dispose(){detachHandlers();_settings.manager=null;_elements=null;_ref=null;_disposed=true}initialize(arguments[0]);Object.defineProperty(_ref,
"show",{enumerable:false,configurable:false,writable:false,value:function(){show()}});Object.defineProperty(_ref,"hide",{enumerable:false,configurable:false,writable:false,value:function(){hide()}});Object.defineProperty(_ref,"refresh",{enumerable:false,configurable:false,writable:false,value:function(){refresh()}});Object.defineProperty(_ref,"getSurfaces",{enumerable:false,configurable:false,writable:false,value:function(){return getSurfaces()}});Object.defineProperty(_ref,"getDisplaysMap",{enumerable:false,
configurable:false,writable:false,value:function(){return getDisplaysMap()}});Object.defineProperty(_ref,"updateScreenDetails",{enumerable:true,configurable:false,writable:false,value:updateScreenDetails});Object.defineProperty(_ref,"processProfileInfo",{enumerable:false,configurable:false,writable:false,value:processProfileInfo});Object.defineProperty(_ref,"dispose",{enumerable:false,configurable:false,writable:false,value:function(){dispose()}});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity=
{}}if(!Thinfinity.Display)Thinfinity.Display={};Thinfinity.Display.Map=Map;Object.defineProperty(Map,"DISTRIBUTION_MODES",{enumerable:true,configurable:false,get:function(){return _eDistributionModes}});Object.defineProperty(Map,"POSITION",{enumerable:true,configurable:false,get:function(){return _addingPosition}})})();
function Theme(){var _themeKey="workspace_account_settings";var _eThemes=Object.freeze({LIGHT:"light-mode",DARK:"dark-mode",BLUE:"blue-mode"});var _eThemesClasses=Object.freeze({AUTOMATIC:"AUTOMATIC"});var _newVersionClass="V7";var _dataRead=false;var _eDefaultTheme=_eThemes.LIGHT;function getData(){let data=helper.storage.get(_themeKey);if((!data||!data.themeOverriden)&&!_dataRead)helper.ajax.get({"url":`${Thinfinity.global.variables.basePath}__base__/config/themes`,"dataType":helper.ajax.responseType.JSON,
"data":JSON.stringify({}),"async":false,"success":function(e){let themesData=JSON.parse(e).data;data={themeOverriden:false,themeVersion:themesData.themeVersion||_newVersionClass,themeName:themesData.defaultTheme||_eThemesClasses.AUTOMATIC,lightMode:themesData.lightMode||_eThemes.LIGHT,darkMode:themesData.darkMode||_eThemes.DARK};helper.storage.set(_themeKey,data);_dataRead=true},"error":function(e,status,xhr){if(!data){data={themeOverriden:false,themeVersion:_newVersionClass,themeName:_eThemesClasses.AUTOMATIC,
lightMode:_eThemes.LIGHT,darkMode:_eThemes.DARK};helper.storage.set(_themeKey,data)}}});return data}function setData(theme,themeName,themeVersion,overriden=true){let t={themeVersion};if(theme)t.theme=theme;if(themeName)t.themeName=themeName;t.themeOverriden=overriden;let d=getData();if(d)t={...t,...d};if(themeVersion===null)delete t.themeVersion;helper.storage.set(_themeKey,t);return t}function on(handler){if(handler instanceof Function)return helper.storage.on(_themeKey,handler);else return false}
function off(handler){if(handler instanceof Function)return helper.storage.off(_themeKey,handler);else return false}function applyBodyStyle(data){let applyThemeClass=({themeClass,oldClass})=>{if(themeClass==_eThemesClasses.AUTOMATIC&&window.matchMedia)themeClass=window.matchMedia("(prefers-color-scheme: dark)").matches?data.darkMode:data.lightMode;if(!!oldClass&&helper.style.hasClass(document.body,oldClass))helper.style.replace(document.body,oldClass,themeClass);else helper.style.addClass(document.body,
themeClass)};if(Object.getOwnPropertyNames(data).length>0){if(window.cookiePrefix)helper.style.add(document.body,window.cookiePrefix);var td=getData();if(td?.themeVersion)helper.style.add(document.body,td.themeVersion);else helper.style.remove(document.body,_newVersionClass);let themeClass=data.themeName;let oldClass=null;if(data instanceof StorageEvent){let nv=JSON.parse(data.newValue);if(nv){oldClass=JSON.parse(data.oldValue).themeName;themeClass=nv.themeName}}if(!oldClass&&themeClass==_eThemesClasses.AUTOMATIC)oldClass=
window.matchMedia("(prefers-color-scheme: dark)").matches?data.lightMode:data.darkMode;applyThemeClass({...{themeClass},...(oldClass?{oldClass}:{})});helper.style.remove(document.body,"non-visible")}}function applyTheme(options){let setStyle=data=>{if(!document.body)helper.dom.interactive(function(){applyBodyStyle(data)});else applyBodyStyle(data)};let ver=null;let d=getData();let tv=null;if(options){if(options.auto===true)on(setStyle);if(!(d?.themeName?.length>0))if(options.default?.length>0)d={themeName:options.default};
else d={themeName:_eDefaultTheme};if(options.hasOwnProperty("themeVersion")){ver=true;tv=options.themeVersion}else if(options.hasOwnProperty("version")){ver=true;tv=options.version}if(ver)d=setData(d.theme,d.themeName,tv)}if(d){setStyle(d);if(options?.callback)options.callback()}else return false}function getVersion(){let d=getData();if(d)return d?.themeVersion?d.themeVersion.toUpperCase():null;else null}function init(){if(window.matchMedia)window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",
function(e){applyBodyStyle(getData())})}Object.defineProperty(this,"get",{enumerable:true,configurable:false,writable:false,value:getData});Object.defineProperty(this,"version",{enumerable:true,configurable:false,get:function(){return getVersion()}});Object.defineProperty(this,"set",{enumerable:true,configurable:false,writable:false,value:setData});Object.defineProperty(this,"on",{enumerable:true,configurable:false,writable:false,value:on});Object.defineProperty(this,"off",{enumerable:true,configurable:false,
writable:false,value:off});Object.defineProperty(this,"apply",{enumerable:true,configurable:false,writable:false,value:applyTheme});Object.defineProperty(this,"themes",{enumerable:true,configurable:false,get:function(){return _eThemes}});Object.defineProperty(this,"default",{enumerable:true,configurable:false,get:function(){return _eDefaultTheme}});init();return this}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.Theme=new Theme;
(function(){function MController(args){var _ref=this;var productId=null;var _args={id:null,name:null,device:null,sizeLimit:{min:{width:640,height:480},max:{width:8192,height:8192}},viewWidth:0,viewHeight:0};var _oInterface=null;var _methods=null;var _properties=null;var _output={textValue:null,setSelectionRange:null,updateMacCmd:null,processData:null,processCmds:null,processFrame:null,cursorCanvas:null,getMinZoomFactor:null};var _keyboardHandler=null;var _container=null;var _initialized=false;var _resizeTimeout=
false;var _waitToResize=500;var _registerdCmds=[];var _orphan={timeoutId:null,timeout:5E3,enabled:false,maxTimeoutBeforeClose:15E3};var _enumPictureType=helper.object.createEnum({CANVAS:0,H264:1,GFX:2});var _isEmbedded=true;var _currentCursor={"intervalId":null,"intervalTime":25,"count":0,"maxCount":20,"checkUpdate":function(){if(_container.style.cursor!=_container.originalImage.cursor)if(_currentCursor.count<=_currentCursor.maxCount){_container.style.cursor="none";_container.style.cursor=_container.originalImage.cursor}else{clearInterval(_currentCursor.intervalId);
helper.console.log(helper.string.format("Cannot assign current cursor image: {0}",_container.originalImage.cursor),arguments)}else if(_currentCursor.count>=_currentCursor.maxCount)clearInterval(_currentCursor.intervalId);_currentCursor.count++},"check":function(){_currentCursor.count=0;clearInterval(_currentCursor.intervalId);_currentCursor.intervalId=setInterval(_currentCursor.checkUpdate,_currentCursor.intervalTime)}};var _noop=function(){};var _messages={reject:{interface:{set:"Invalid interface data - TMC-SI",
get:"Invalid interface data - TMC-GI"}},error:{missingContainer:"Cannot find a valid container"},initializing:{start:"    Starting monitor controller.",ready:"    -- > Monitor controlled initialized"}};var _clipObj=null;var _mouseDriver=null;var _touchDriver=null;var wndTop=null;var _identify={timeout:5E3,timeoutId:null,containerElem:null,blockElem:null,idContainerElem:null,idElem:null};var _vncContainer=null;var _blockDisplayElem=null;var _deviceRef=null;var _bodyHeight=0;var _bodyWidth=0;var _sizeElem=
null;var _isLegacy=typeof legacyVersion!="undefined"?legacyVersion:true;var _setFocusHandler=_noop;let _webV7FrameElement=null;function initialize(){helper.dom.ready(function(){Thinfinity.Theme?.apply({auto:true});waiting();wndTop=helper.url.getTopWindow(window);if(!window.ThinVNC&&window.opener===null&&wndTop===window&&!Thinfinity?.Monitor?.Manager){clearTimeout(_orphan.timeoutId);_orphan.timeoutId=setTimeout(runOrphan,_orphan.timeout)}_output.getMinZoomFactor=getMinZoomFactor})}function getWebV7Frame(){if(_webV7FrameElement)return _webV7FrameElement;
else try{_webV7FrameElement=window.__webV7__&&window.frameElement?window.frameElement.parentElement:false}catch(err){_webV7FrameElement=false}return _webV7FrameElement}function canRunResize(){let res=true;let fe=getWebV7Frame();if(fe)try{let display=fe.style.getPropertyValue("display");if(display==="none")res=false}catch(error){}return res}function execScaled(){let r=setScaled(_properties.scaled);zoomDesktop();return r}function waiting(){if(Thinfinity?.Popups?.establishing&&!_isLegacy)Thinfinity.Popups.establishing.show(consts.loading,
consts.connecting,true,false)}function runOrphan(){let msg=consts.displayCancelled;helper.console.warning(msg,arguments);msg+=`</br><button id="btnClose" onclick="window.close();let btn = document.getElementById('btnClose'); btn.parentElement.removeChild(btn);">${consts.displayCloseTab}</button>`;document.body.innerText="";helper.dom.appendJsonElement({"parentElement":document.body,"type":"div","attributes":{"class":"bye"},"content":msg});setTimeout(function(){window.close()},_orphan.maxTimeoutBeforeClose)}
function setInterface(){return new Promise((resolve,reject)=>{if(arguments&&typeof arguments[0]==="object"&&typeof arguments[1]==="object"){_deviceRef=arguments[0];_deviceRef.screen.width=window.screen.width;_deviceRef.screen.height=window.screen.height;_oInterface=arguments[1];_methods=_oInterface.methods;_properties=_oInterface.properties;productId=_properties.productId;_oInterface.on("scaled",execScaled);resolve(true)}else reject(_messages.reject.interface.set)})}function getInterface(){return new Promise((resolve,
reject)=>{if(arguments&&arguments[0])resolve(_output);else reject(_messages.reject.interface.get)})}function initializeFocus(){Thinfinity.TabFocusHook.on("visible",function(e){_properties.hasFocus=true;_methods.sendFocus(_args.device.id,"tabvisible",true)}).on("hidden",function(e){_properties.hasFocus=false;_methods.sendFocus(_args.device.id,"tabvisible",false)}).on("focus",function(e){_properties.hasFocus=true;if(_keyboardHandler)_keyboardHandler.focus();_methods.sendFocus(_args.device.id,"focus",
true)}).on("blur",function(e){_properties.hasFocus=false;_methods.sendFocus(_args.device.id,"focus",false)}).on("visibility",function(e){_properties.hasFocus=["visible"].indexOf(e.visibilityState)!==-1;_methods.sendFocus(_args.device.id,"visibility",e.visibilityState)});if(_isEmbedded)setTimeout(function(){_properties.hasFocus=document.hasFocus();_methods.sendFocus(_args.device.id,"focus",document.hasFocus())},250)}function resize(){let wnd=window;let devInfo={width:wnd.environment.availWidth,height:wnd.environment.availHeight,
display:{width:_container.offsetWidth,height:_container.offsetHeight}};if(_args.sizeLimit?.min){let min=_args.sizeLimit.min;devInfo.width=Math.max(min.width,devInfo.width);devInfo.height=Math.max(min.height,devInfo.height)}helper.console.log(`Resize monitor - id ${_args.device.id}, info: ${JSON.stringify(devInfo)}`,arguments);_methods.resize(_args.device.id,devInfo)}function resizeHandler(){if(_resizeTimeout){clearTimeout(_resizeTimeout);_resizeTimeout=null}updateBodySize();zoomDesktop()}function resizeCompleteHandler(){if(_resizeTimeout)clearTimeout(_resizeTimeout);
_resizeTimeout=setTimeout(function(){resize();zoomDesktop()},_waitToResize)}function initializeResize(){setScaled(_properties.scaled);updateBodySize();zoomDesktop();window.environment.on("resize",resizeHandler);window.environment.on("resizeComplete",resizeCompleteHandler);if(!_isEmbedded)setTimeout(resize,1E3)}function registerCmds(cmd,handler){if(!_registerdCmds[cmd])_registerdCmds[cmd]=handler}function processCmds(obj){if(_registerdCmds[obj.cmd])return _registerdCmds[obj.cmd](obj)}function promptTextCountdown(constMsg,
time,callback){let getSprintfText=null;let _timeoutTextId=null;if(time){let _currentPromptTime=Date.now();getSprintfText=function(){let s=parseInt((time-(Date.now()-_currentPromptTime))/1E3,10);if(s>1)s=s.toString()+" "+consts.seconds;else s=s.toString()+" "+consts.second;return helper.string.sprintf(constMsg,s)};_timeoutTextId=setInterval(function(){let dlg=document.getElementById("dlgH264Message");if(dlg)dlg.innerHTML=getSprintfText();if(Date.now()-_currentPromptTime>=time){clearInterval(_timeoutTextId);
if(callback)callback()}},1E3)}else getSprintfText=function(){return helper.string.sprintf(constMsg)};Thinfinity.Popups.choice({id:"dlgDecoderError",parentElement:"",class:"",iconType:"disconnectedIco",title:productName,message:`<span id="dlgH264Message">${getSprintfText().toString()}</span>`,buttons:[{value:!time?consts.Close:consts.retry,class:"",action:function(e){clearInterval(_timeoutTextId);if(callback)callback()}}],noPropagateEvents:true});_currentPromptTime=Date.now()}function initializeVideoDriver(data){var videoDriverError=
null;if(_properties.enableH264)if(agentInfo.h264){if(helper.object.existsPath(window,"Thinfinity.Driver.Video")){let h264Key="#__Thinfinity.Video.Driver__"+(data.key||"");var h264Decoders=[Thinfinity.Driver.Video.DECODER_TYPES.TINYBSD,Thinfinity.Driver.Video.DECODER_TYPES.JMUXER,Thinfinity.Driver.Video.DECODER_TYPES.BSD,Thinfinity.Driver.Video.DECODER_TYPES.BSDWORKER];var _currentDecoderIdx=0;let getDecoder=function(){let d=helper.storage.get(h264Key);if(d){_currentDecoderIdx=d.cdi;return h264Decoders[_currentDecoderIdx]}else return h264Decoders[_currentDecoderIdx]};
let switchDecoder=function(){if(_currentDecoderIdx<h264Decoders.length-1){_currentDecoderIdx++;helper.storage.add(h264Key,{cdi:_currentDecoderIdx});promptTextCountdown(consts.h264DecodeError,3E3,function(){window.location.reload()})}else promptTextCountdown(consts.h264DecoderError,null,function(){helper.storage.clear(h264Key);if(_methods.disconnect)_methods.disconnect()})};_videoDriver=new Thinfinity.Driver.Video({"id":data.id,"container":_container,"player":"player","decoderType":getDecoder(),"methods":{"sendCmd":_methods.sendCmd,
"registerCanvas":_methods.registerCanvas},"events":{"pictureSize":function(width,height){},"processDataEcho":_methods.processDataEcho?function(data){_methods.processDataEcho(_args.device.id,data)}:_noop,"error":function(obj){videoDriverError=true;if(_isEmbedded){if(obj)switch(obj.code){case Thinfinity.Driver.Video.ERROR_CODE.NONE_PICTURE_PROCESSED:helper.console.warning(`Invalid decoder type, arrayBuffer data is not compatible with the current decoder.`);switchDecoder();break;default:break}setTimeout(function(){let oError=
{message:obj.msg||obj};_oInterface.__prototype__.fireEvent("onServerError",oError)},500)}}}});_output.processData=_videoDriver.processData}}else _videoDriver={"processData":function noop(){}};else if(_properties.enableGfx){_videoDriver=new Thinfinity.Driver.GFXProcessor({"id":data.id,"size":{width:data.device.width,height:data.device.height},"container":_container,"methods":{"sendCmd":_methods.sendCmd,"registerCanvas":_methods.registerCanvas,"repaint":()=>{_oInterface.__prototype__.fireEvent("gfxRepaint")}}});
_oInterface.on("repaint",()=>{if(_properties.repaint&&_properties.isShadowSession)_videoDriver.forceRepaint=true;_properties.repaint=false});_output.processData=_videoDriver.processData}else try{videoDriverError=false}catch(error){_oInterface.__prototype__.fireEvent("onServerError",{message:`Cannot start ctx driver. ${error.message}`});videoDriverError=true}return!videoDriverError}function preventDefault(e){if(e)if(helper.style.hasAnyClass(e.srcElement||e.target,"thin-allowcontrol preventTouchExecution")){e.preventDefault();
return true}}function showStdKdbHandler(){if(_properties.cursorCanvasY>=0)_keyboardHandler.inputElement.style.top=`${_properties.cursorCanvasY}px`;_keyboardHandler.focus(true)}function documentClickHandler(){if(!document.hasFocus()){document.body.focus();_keyboardHandler.focus()}}function initializeKeyboardDriver(data){if(!_keyboardHandler&&!agentInfo.isMobile){_keyboardHandler=new Thinfinity.Driver.Keyboard({parentElement:document.body,clipboard:_oInterface.properties.clipboard?.properties,methods:_methods,
properties:_properties,events:{keyboardEvent:function(){},hook:function(value){},focus:function(e){},blur:function(e){}}});_output.setSelectionRange=_keyboardHandler.setSelectionRange;_output.textValue=function(){return _keyboardHandler.inputElement.value};_output.updateMacCmd=agentInfo.isMac?_keyboardHandler.updateMacCmd:_noop;if(!agentInfo.isMobile)_oInterface.on("showStdKdb",showStdKdbHandler);_mouseDriver.on("documentClick",documentClickHandler);if(!agentInfo.isMobile){let isTouchEvt=false;_setFocusHandler=
()=>{if(!isTouchEvt)_keyboardHandler.focus()};if(_mouseDriver)_mouseDriver.on("mouseDown",_setFocusHandler);let isTap=false;if(_touchDriver)_touchDriver.ready(()=>{document.addEventListener("keydown",e=>{let iType=(e?.target?.type||e?.target?.nodeName||"").toUpperCase();if(["TEXT","PASSWORD","TEXTAREA"].indexOf(iType)!==-1)return true;if(_keyboardHandler.inputElement!==document.activeElement){isTouchEvt=false;_setFocusHandler()}});_touchDriver.on("tap",()=>{isTap=true});_touchDriver.on("release",
e=>{isTouchEvt=["touchstart","touchmove","touchend"].indexOf(e.type)!==-1;if(isTap)setTimeout(_setFocusHandler,250);isTap=false})})}}}function getElementFromPoint(e){let hasChildOfByClassName=(classname,child)=>{var elems=document.getElementsByClassName(classname);for(var i=0;i<elems.length;i++)if(elems[i].contains(child))return true;return false};var x,y;if((e.changedTouches||e.touches)&&(e.changedTouches||e.touches).length>0){x=(e.changedTouches||e.touches)[0].pageX-document.body.offsetLeft;y=(e.changedTouches||
e.touches)[0].pageY-document.body.offsetTop}else if(e.clientX!=undefined||e.pageX!=undefined){x=e.clientX||e.pageX-document.body.offsetLeft;y=e.clientY||e.pageY-document.body.offsetTop}else if(e.pointers!=undefined&&e.pointers.length>0){x=e.pointers[0].pageX-document.body.offsetLeft;y=e.pointers[0].pageY-document.body.offsetTop}var idMask=productId+"_canvas_";var selectedElement=document.elementFromPoint(x,y);if(selectedElement&&(!helper.style.hasClass(selectedElement,"__uselocalmouse__")&&!hasChildOfByClassName("__uselocalmouse__",
selectedElement)&&(selectedElement.tagName=="CANVAS"||selectedElement.name=="caret"||selectedElement.id=="caret"||selectedElement==_args.container||selectedElement.id.indexOf(idMask)!=-1||helper.style.hasClass(selectedElement,"ignoremouse"))))return null;else return selectedElement}function initializeMouseDriver(data){if(!_mouseDriver){_mouseDriver=new Thinfinity.Driver.Mouse({container:_container,device:data.device,extra:{getElementFromPoint,preventDefault}},_oInterface);Object.defineProperty(_output,
"cursorCanvas",{enumerable:true,configurable:false,get:()=>{return _mouseDriver?.cursorCanvas}})}}function initializeTouchDriver(data){if(!_touchDriver&&!agentInfo.isMobile&&Thinfinity?.Driver?.Touch){let moveCursorCanvas=_mouseDriver&&_mouseDriver.moveCursorCanvas?_mouseDriver.moveCursorCanvas:_noop;let _cOInterface=_oInterface.__prototype__.clone();_cOInterface.methods.sendMouse=function(x,y,button,action){moveCursorCanvas(x,y);_oInterface.methods.sendMouse(x,y,button,action)};var localGestures=
[...(helper.object.getValue(window,"customSettings.touch.gestures",[],{ignoreCase:true})??[]),...(helper.object.getValue(window.THIN,"clientSettings.mobile.gestures",null,{ignoreCase:true})??[]),...(helper.object.getValue(window.THIN?.rcParams,"mobile.gestures",null,{ignoreCase:true})??[]),...(helper.object.getValue(window,"customSettings.mobile.gestures",[],{ignoreCase:true})??[])];_touchDriver=new Thinfinity.Driver.Touch({container:_container,device:data.device,extra:{getElementFromPoint,waitForTouchDevice:()=>
{setTimeout(()=>{moveCursorCanvas=_mouseDriver&&_mouseDriver.moveCursorCanvas?_mouseDriver.moveCursorCanvas:_noop;_oInterface.methods.fireEvent("onTouchDeviceDetected")},200)},preventDefault},gestures:localGestures},_cOInterface)}}function initializeClipboard(){if(!_clipObj&&_oInterface.properties.clipboard?.properties?.enable&&Thinfinity.Clipboard&&_keyboardHandler)_clipObj=new Thinfinity.Clipboard({...{inputElem:_keyboardHandler.inputElement,parentElement:_container,canPasteFiles:_oInterface.properties.canPasteFiles},
..._oInterface})}function getEnvironmentValues(){let scale=agentInfo.isFirefox||agentInfo.isOpera||agentInfo.isChrome||agentInfo.isSafari||agentInfo.isIE9?getScale():1;let border=_properties.border;let crop={"widht":0,"height":0};if(productId==="thinrdp")crop=environment.crop||crop;let width=_container.offsetWidth*scale-(productId==="thinrdp"?crop.width/2:0)-(border.left+border.right);let height=_container.offsetHeight*scale-(productId==="thinrdp"?crop.height/2:0)-(border.top+border.bottom);return{scale,
border,width,height}}function center(){if(agentInfo.isMobile){_container.style.top="0px";_container.style.marginTop="0px";_container.style.left="0px";_container.style.marginLeft="0px"}else{let gev=getEnvironmentValues();if(_properties.centered&&_properties.scaled)if(gev.scale!=1)applyCenter(gev,_properties.centeredMode);else{_container.style.top="0px";_container.style.marginTop="0px";_container.style.left="0px";_container.style.marginLeft="0px"}else{let cm="";let lw=gev.width<=document.body.offsetWidth;
let lh=gev.height<=document.body.offsetHeight;if(lw&&lh)cm="both";else if(lw)cm="horizontal";else if(lh)cm="vertical";if(cm.length>0)applyCenter(gev,cm);else{_container.style.top="0px";_container.style.marginTop="0px";_container.style.left="0px";_container.style.marginLeft="0px";if(_properties.overflow)_container.parentElement.style.overflow=_properties.overflow}}}}function applyCenter({width,height,border}=obj,centeredMode){let ml=width/2;let mt=height/2;if(["horizontal","both"].indexOf(centeredMode)!==
-1){_container.style.left="50%";_container.style.marginLeft=-ml+"px"}else{_container.style.left=border.left;_container.style.marginLeft="0px"}if(["vertical","both"].indexOf(centeredMode)!==-1){_container.style.top="50%";_container.style.marginTop=-mt+"px"}else{_container.style.top=border.top;_container.style.marginTop="0px"}applyOverflow({width,height})}function applyOverflow({width,height}=obj){if(!width)width=1;if(!height)height=1;if(_properties.scaled)_container.parentElement.style.overflow="hidden";
else if(_properties.overflow&&(width-1>document.body.offsetWidth||height-1>document.body.offsetHeight))_container.parentElement.style.overflow=_properties.overflow;else _container.parentElement.style.overflow="hidden"}function updateDesktopSize(width,height){if(width&&!(agentInfo.isMobile&&_args.viewWidth>window.screen.width))_container.style.width=_vncContainer.style.width=width+"px";if(height&&!(agentInfo.isMobile&&_args.viewHeight>window.screen.height))_container.style.height=_vncContainer.style.height=
height+"px"}function updateBodySize(){let size=helper.size.get(_sizeElem);var border=_properties.border;_bodyHeight=size.height-(border.top+border.bottom+(productId==="thinrdp"?environment.crop.height:0));_bodyWidth=size.width-(border.left+border.right+(productId==="thinrdp"?environment.crop.width:0))}function setScaled(scaled,hwnd){var virtualui=productId=="webfmx"||productId=="virtualui";if(_properties.rdpMode&&!scaled)updateDesktopSize(_args.viewWidth,_args.viewHeight);applyOverflow(getEnvironmentValues());
if(_properties.fitmode==0||_properties.fitToBrowser==true)if(scaled){_container.parentElement.style.overflow="hidden";updateDesktopSize(_args.viewWidth,_args.viewHeight)}else{var tempWidth=0;var tempHeight=0;var mw=_args.viewWidth;var mh=_args.viewHeight;var border=_properties.border;if(window.environment.isFullscreen){tempWidth=border.left+Math.max(mw,_args.viewWidth)+border.right;tempHeight=border.top+Math.max(mh,_args.viewHeight)+border.bottom}else{tempWidth=border.left+Math.min(mw,_args.viewWidth)+
border.right;tempHeight=border.top+Math.min(mh,_args.viewHeight)+border.bottom}if(productId!="thinrdp")updateDesktopSize(tempWidth,tempHeight);if(_properties.overflow)_container.parentElement.style.overflow=_properties.overflow}else if(virtualui)if(_properties.fitmode==1){var tempWidth=0;var tempHeight=0;var maxSize=_properties.maxSize;var border=_properties.border;if(!agentInfo.isMobile){tempWidth=Math.max(maxSize.width,_args.viewWidth);tempHeight=Math.max(maxSize.height,_args.viewHeight);if(window.environment.isFullscreen==
true){tempWidth=Math.max(window.environment.rawWidth,tempWidth);tempHeight=Math.max(window.environment.rawHeight,tempHeight)}}else{tempWidth=border.left+Math.min(maxSize.width,_args.viewWidth)+border.right;tempHeight=border.top+Math.min(maxSize.height,_args.viewHeight)+border.bottom}updateDesktopSize(border.left+tempWidth+border.right,border.top+tempHeight+border.bottom);if(_args.viewHeight>window.environment.availHeight||_args.viewWidth>window.environment.availWidth)_container.parentElement.style.overflow=
"scroll";else if(_properties.overflow)_container.parentElement.style.overflow=_properties.overflow}else if(_properties.fitmode==2){_container.parentElement.style.overflow="hidden";updateDesktopSize(_args.viewWidth,_args.viewHeight)}if(!(virtualui||typeof hwnd=="undefined")&&(_properties.fitToBrowser||_properties.fitmode==0))if(_isEmbedded){var win={"left":0,"top":0,"width":_args.viewWidth,"height":_args.viewHeight,"hwnd":hwnd,"zidx":_properties.baseZIndex};_oInterface.__prototype__.fireEvent("createCanvas",
win)}_properties.scaled=scaled;_properties.scale=getScale()}function getScale(){if(!_properties.scaled)return _properties.zoomFactor;var c1=_bodyHeight/_args.viewHeight;var c2=_bodyWidth/_args.viewWidth;if(c1>1&&c2>1)return _properties.serverDPR.enabled?_properties.serverDPR.originalValue&&_properties.serverDPR.originalValue<1?Math.min(c1,c2):1:c2<c1?c2:c1;else{if(_properties.serverDPR.enabled&&_properties.zoomFactor>1)_properties.zoomFactor=1;return c2<c1?c2:c1}}function zoomFactorReset(){var c1=
_bodyHeight/((window.environment.height/window.environment.currentDevicePixelRatio-(window.environment.margin.top+window.environment.margin.bottom))*window.environment.currentDevicePixelRatio);var c2=_bodyWidth/((window.environment.width/window.environment.currentDevicePixelRatio-(window.environment.margin.left+window.environment.margin.right))*window.environment.currentDevicePixelRatio);_properties.minZoomFactor=c1>1&&c2>1?1:c2<c1?c2:c1;return _properties.minZoomFactor}function getMinZoomFactor(){_properties.minZoomFactor=
agentInfo.isMobile&&_properties.scaled?1:_properties.minZoomFactor;return _properties.minZoomFactor?_properties.minZoomFactor:zoomFactorReset()}function zoomDesktop(scale){if(canRunResize()){if(scale!=undefined){if(scale>=getMinZoomFactor())_properties.zoomFactor=scale;_properties.scale=scale}else _properties.scale=getScale();if(_properties.centered&&(!agentInfo.isMobile||_properties.scaled))center();var s=_container.style;var strTransformOrigin="top left";if(typeof s.msTransform!="undefined"){_container.style.msTransformOrigin=
strTransformOrigin;_container.style.msTransform="scale("+_properties.scale+")"}else if(typeof s.MozTransform!="undefined"){_container.style.MozTransformOrigin=strTransformOrigin;_container.style.MozTransform="scale("+_properties.scale+")"}else if(typeof s.OTransform!="undefined"){_container.style.OTransformOrigin=strTransformOrigin;_container.style.OTransform="scale("+_properties.scale+")"}else if(typeof s.WebkitTransform!="undefined"){_container.style.WebkitTransformOrigin=strTransformOrigin;_container.style.WebkitTransform=
"scale("+_properties.scale+")"}}}function initializeHandlers(){if(_isEmbedded)helper.dom.addEvent(window,["beforeUnload","unload"],function(e){_methods.removeDevice(_args.device.id);dispose()},{passive:false})}function getContainer(){let container=null;let containers=document.getElementsByClassName("render-container");if(containers&&containers.length)container=containers[0];else{container=document.getElementById("deskdiv");if(!container)container=document.getElementById("virtualui");if(!container)container=
document.getElementById("zsdiv");if(!container)throw new Error(_messages.error.missingContainer);}_vncContainer=container;return container}function initializeCommands(){let _clickEffectDown=false;registerCmds("DS",function(win){helper.console.log(`Device: ${_args.device.id+1}, processing DS, width: ${win.width}, height:${win.height}, current scale: ${_properties.scale}`);_properties.repaint=Thinfinity.TabFocusHook.isHidden;_args.viewWidth=win.width;_args.viewHeight=win.height;updateDesktopSize(win.width,
win.height);updateBodySize();setScaled(_properties.scaled,win.hwnd);zoomDesktop()});registerCmds("ZOOM_DESKTOP",function(win){zoomDesktop(win?.value||undefined)});registerCmds("CENTER",center);registerCmds("ZOOM_FACTOR_RESET",zoomFactorReset);registerCmds("PLAYBACK_MOUSE_MOVE",function(cmd){if(cmd.data.mouseEffectVisible&&!_clickEffectDown)_clickEffectDown=true;else if(!cmd.data.mouseEffectVisible)_clickEffectDown=false;_mouseDriver.moveCursorCanvas(cmd.data.x,cmd.data.y,_clickEffectDown)})}function sessionStatus(data){initializeClipboard()}
function asyncCopyHandler(h){if(h&&_clipObj)_clipObj.async=h}function contextMenuHandler(e){if(e)e.preventDefault();return false}function attachHandlers(){_oInterface.on("asyncCopy",asyncCopyHandler);_oInterface.on("localEvent",processLocalEvents);helper.dom.addEvent(_container,"contextmenu",contextMenuHandler,{passive:false})}function removeHandlers(){_oInterface.off("asyncCopy",asyncCopyHandler);_oInterface.off("localEvent",processLocalEvents);_oInterface.off("showStdKdb",showStdKdbHandler);helper.dom.removeEvent(_container,
"contextmenu",contextMenuHandler);helper.dom.removeEvent(window,"message",onMessageHandler);window.environment.off("resize",resizeHandler);window.environment.off("resizeComplete",resizeCompleteHandler);if(_touchDriver){_touchDriver.off("tap");_touchDriver.off("release")}if(_mouseDriver){_mouseDriver.off("mouseDown",_setFocusHandler);_mouseDriver.on("documentClick",documentClickHandler)}}function processLocalEvents(data){let cmd=null;if(data.cmd)cmd=data.cmd.toLowerCase();switch(cmd){case "identify":drawId(data.timeout||
_identify.timeout);break;case "connected":unblockDisplay();break;case "connectionrestored":case "connectionunstable":case "connectionLost":blockDisplay();break;case "disconnect":stop();break;case "servercmdresult":if(data.obj)if(_properties.pictureType===_enumPictureType.CANVAS){if(data.obj?.viewWidth){_args.viewWidth=data.obj.viewWidth;updateDesktopSize(_args.viewWidth)}if(data.obj?.viewHeight){_args.viewHeight=data.obj.viewHeight;updateDesktopSize(null,_args.viewHeight)}}break;case "sessionstatus":sessionStatus(data.data);
break}}function blockDisplay(){if(!_isEmbedded){if(!_blockDisplayElem)_blockDisplayElem=helper.dom.createJsonElement({type:"div",attributes:{class:"displayControllerBlocker"}});document.body.appendChild(_blockDisplayElem)}}function unblockDisplay(){if(!_isEmbedded)if(_blockDisplayElem)_blockDisplayElem.parentElement.removeChild(_blockDisplayElem)}function drawId(timeout){if(!_identify.containerElem){_identify.containerElem=helper.dom.appendJsonElement({type:"div",parentElement:document.body,attributes:{class:"displayController"}});
_identify.blockElem=helper.dom.appendJsonElement({type:"div",parentElement:_identify.containerElem,attributes:{class:"background"}});_identify.idContainerElem=helper.dom.appendJsonElement({type:"div",parentElement:_identify.containerElem,attributes:{class:"identifyContainer"+(_isEmbedded?" embedded":"")}});_identify.idElem=helper.dom.appendJsonElement({type:"div",parentElement:_identify.idContainerElem,attributes:{class:"identify"}})}else document.body.appendChild(_identify.containerElem);_identify.idElem.innerText=
_args.device.id+1;clearTimeout(_identify.timeoutId);_identify.timeoutId=setTimeout(function(){document.body.removeChild(_identify.containerElem)},timeout)}function start(data){helper.console.log(_messages.initializing.start,arguments);clearTimeout(_orphan.timeoutId);if(!_initialized){_initialized=true;_container=getContainer();_sizeElem=_container.parentElement.tagName=="BODY"?window:_container.parentElement;_args.viewWidth=data.device.width;_args.viewHeight=data.device.height;helper.object.parseAttributes(_args,
data);initializeCommands();attachHandlers();_isEmbedded=data.isEmbedded;initializeFocus();updateDesktopSize(data.device.width,data.device.height);initializeVideoDriver(data);initializeMouseDriver(data);initializeTouchDriver(data);initializeKeyboardDriver(data);initializeHandlers();initializeResize();if(!_isEmbedded){helper.dom.addEvent(window,"message",onMessageHandler,{passive:false});setTimeout(function(){Thinfinity.Popups.unblock();Thinfinity.Popups.establishing.hide()},1E3);execScaled()}_output.processCmds=
processCmds;helper.console.log(_messages.initializing.ready)}}function onMessageHandler(e){if(e&&e.data&&e.data.cmd==="CALLBACK"){e.source.postMessage({cmd:"CALLBACK-RESPONSE"},"*");helper.dom.removeEvent(window,"message",onMessageHandler)}}function stop(){Thinfinity.TabFocusHook.stop();removeHandlers();if(_touchDriver)_touchDriver.dispose();_touchDriver=null;_mouseDriver=null;_initialized=false}function dispose(){stop()}initialize();Object.defineProperty(_ref,"start",{enumerable:true,configurable:false,
writable:false,value:start});Object.defineProperty(_ref,"stop",{enumerable:true,configurable:false,writable:false,value:stop});Object.defineProperty(_ref,"dispose",{enumerable:true,configurable:false,writable:false,value:dispose});Object.defineProperty(_ref,"getInterface",{enumerable:true,configurable:false,writable:false,value:getInterface});Object.defineProperty(_ref,"setInterface",{enumerable:true,configurable:false,writable:false,value:setInterface});Object.defineProperty(_ref,"keyboardHandler",
{enumerable:true,configurable:false,get:function(){return _keyboardHandler}});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(typeof Thinfinity.Display==="undefined")Thinfinity.Display={};Thinfinity.Display.Controller=new MController})();jQuery.support.cors=true;if(!window.hasOwnProperty("productId"))window.productId="thinvnc";
ThinVNC=function(){var TVNC=this;var cmdCache=null;this.cookiesLoaded=false;this.browserCapabilitiesAvailable=helper.object.getValue(window,"customSettings.browserCapabilities",false);this.mouseX=-1;this.mouseY=-1;this.lastMouseAction="";this.caretX=0;this.caretY=0;this.mouseMoved=false;this.vncdiv;this.baseZIndex=8E5;this.majorVersion;this.firefoxVersion;this.iphone;this.ios;this.mac;this.mobile;this.supportsCanvas;this.startPending=true;this.jsonTimeoutValue=7E4;this.disposeTimeoutValue=25;this.disposeTimeout;
this.endingsession=false;this.pageX=0;this.pageY=0;this.button="";this.imagesLoading=0;this.fs=null;this.cacheLoaded=false;this.startCmdToSend=false;this.dbFiles=[];this.centered=true;this.vncdivId="mainPanel";this.vncContainer=null;this.reconnectDivId="recnx";this.canvasER=null;this.processNextScreenEnabled=true;this.deferCallBySetTimeout=false;this.queueRequestName="requestQueue";this.queueRecycleImg=new Array;this.recycleImgTimeoutValue=5E3;this.reconnectDelay=0;this.runInPublicServer=false;this.ws=
null;this.wsEnabled=false;this.wsAsyncRecv=false;this.wsAsyncRecvTimeout=10;this.wsSendReady=false;this.imgLoaderThreadPool=null;this.connecting=false;this.xmlHttpJson=null;this.lastKeyCode=0;var _onlyKeyCode=false;this.reconnecting=false;this.touching=false;this.crossdomain=false;this.imageCache2=[new Array(600),new Array(600),new Array(2048),new Array(4096),new Array(2048)];this.imageCacheV=[new Array(200),new Array(200),new Array(200),new Array(200),new Array(200)];this.brushCache=new Array(100);
this.offscreenCache=new Array(100);this.rdpGlyphArray=new Array(12);this.textCache=new Array(256);this.offscreenCanvas=null;this.MouseHooked=false;this.KeyboardHooked=false;this.containerWidth=0;this.containerHeight=0;this.msgQueue=[];this.imgQueue=null;this.imgQueueTimeout=1E4;this.imgIndex=0;this.imageListType=0;this.registeredDrawCmds={};this.registeredOOBCmds={};this.registeredCustomDataTypes={};this.registeredCustomCmds={};this.screenHeight=window.environment.rawHeight||window.screen.height;
this.screenWidth=window.environment.rawWidth||window.screen.width;this.canvasPrinter=null;this.xoff=false;this.useBufferedCanvas=false;this.gatewayAccessKey="";var _preferredBrokerKey="__#thinfinity.preferredBrokerId__";var _oturlDataPassKey="oturlDataPass";var _sessionStoragePreservedKeys=[_oturlDataPassKey,_preferredBrokerKey];this.savedMaxWidth=0;this.savedMaxHeight=0;this.inputEnabled=false;this.cmdCacheProps={};this.controlFactory=null;this.enableCmdCache=false;this.canvasInitiallyHidden=false;
this.logger=new JSLogAPI(this);this.printerManager=null;this.rdpMode=false;this.usedDPR=1;this.apiUrl="__base__/";var _CUEnabled=false;var _navigationTypes=helper.object.createEnum({"navigate":0,"reload":1,"back_forward":2,"prerender":3,"reserved":255});var isNewNavigation=function(){var result=false;var nt=_navigationTypes.navigate;if(window.performance){nt=_navigationTypes.getKey(helper.object.getValue(window.performance,"navigation.type",0));if(window.performance.getEntriesByType){var entries=
window.performance.getEntriesByType("navigation");nt=entries.length>0?_navigationTypes[entries[0].type]:nt}}result=!(nt===_navigationTypes.reload||nt===_navigationTypes.back_forward);return result};var currentWindowName=function(){try{var sname=window.name!=""?window.name:window.id!=undefined&&window.id!=""?window.id:window.frameElement?window.frameElement.id||window.frameElement.name:null;if(sname)return"CWN["+sname+"]"}catch(error){return null}};var wndId=currentWindowName()||"_sid";var ID={"key":function(){return(location.pathname.replace(/\//g,
"")+"_"+wndId).toLowerCase()},"get":function(){var k=sessionStorage.getItem(this.key());return k},"set":function(id){sessionStorage.setItem(this.key(),id)},"remove":function(){sessionStorage.removeItem(this.key())}};var WNDOpener={"key":function(){return(location.pathname.replace(/\//g,"")+"_hasOpener").toLowerCase()},"get":function(){var k=sessionStorage.getItem(this.key());return k},"set":function(hasOpener){sessionStorage.setItem(this.key(),hasOpener)},"remove":function(){sessionStorage.removeItem(this.key())}};
if(window.sessionStorage&&!isNewNavigation()){var sid=ID.get();var opener=WNDOpener.get();let len=sessionStorage.length;let i=0;for(i=0;i<len;i++){let k=sessionStorage.key(i);if(_sessionStoragePreservedKeys.indexOf(k)===-1)sessionStorage.removeItem(k)}if(sid)ID.set(sid);if(!window.opener&&opener){WNDOpener.set(true);window.opener=true}}else{WNDOpener.set(window.opener?true:false);ID.remove()}this.rcParams={pcId:"",publickey:"",id:null,clipboard:true,clipboardFileTransfer:false,active:false,showOnStart:true,
hookKeyboard:true,hookMouse:true,centered:true,centeredMode:"both",exitURL:"about:blank",monitor:0,monitorCount:0,viewLeft:0,viewTop:0,viewWidth:0,viewHeight:0,maxWidth:0,maxHeight:0,borderLeft:0,borderRight:0,borderTop:0,borderBottom:0,screenResX:0,screenResY:0,mouseControl:true,touchControl:true,kbdControl:true,kbdUnicode:true,kbdLogKeys:false,clientAck:-1,scraper:null,scraperArgs:null,quality:90,pixelFormat:0,grayscale:false,imageMethod:2,wallpaper:false,wscompression:true,cursorVisible:true,remotePointer:true,
relativeTouch:agentInfo.isMobile,mousePressAsRightButton:false,dragDist:32,scaled:true,divId:null,server:null,protocol:null,url:null,reconnectDelay:3E3,address:"",ticket:"",pin:"",sessionKey:"",externalId:"",userid:null,password:null,playsession:false,serverControlMouse:false,forceAjax:false,delayTouch:250,tbSize:"",xoffEnabled:true,xoffThreshold:20,xonThreshold:5,persistentCache:false,rleThreshold:70,useSendThread:false,lfn:null,useDblClick:false,fitToBrowser:true,fitmode:0,overflow:"auto",useFocus:false,
isCrossDomain:false,savesession:false,forceDesktop:false,rfxEnabled:false,sound:{enabled:false},isAutoFocusEnabled:true,isJsROEnabled:true,UBRWID:null,extraData:null,mouseMoveProcessInterval:10,overrideCursor:false,enableH264:false,enableGfx:false,events:{onServerError:null,onExecRemoteApp:null,onExecResult:null,onFileDownload:null,onOpenLink:null,onServerMessage:null,onFileReady:null,onFileStream:null,onRemoteCommand:null,onServerAuthenticationRequired:null,onServerNeedCredentials:null,onScreenReceived:null,
onServerConnect:null,onDisplayInteractionRequired:null,onBrokerError:null,onServerConnectionError:null,onServerCommandEvent:null,onServerCommandResult:null,onServerDisconnect:null,onServerRedirect:null,onServerConnecting:null,onSessionStart:null,onSessionEnd:null,onSessionStop:null,onProcessWindow:null,onDeleteWindow:null,onWindowStateChanged:null,onReceiveMessage:null,onPropertyChange:null,onSendKey:null,onKeyCode:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onPlaybackEnds:null,onCanvasResize:null,
onZoomDesktop:null,onConnectionLost:null,onConnectionRestored:null,onMouseAnimationFrameEnd:null,onLicenseMsg:null,onPrintHandler:null,onWakeOnLan:null,onWaitForVM:null,onSessionTimeout:null,onCopy:null,onPaste:null,onCut:null,onCopyFiles:null,onReconnectionAttempt:null,onShadowingStatus:null,onCreateCanvas:null,onReleaseCanvas:null,onTouchDeviceDetected:null},cursorCanvas:{x:0,y:0},synchronizeClipboard:true,isShadowSession:false};var WebPImageFormat=new function(){var supportsLossyWebp=null;var supportsLosslessWebp=
null;this.getSupportsWebP=function(){var res=0;if(supportsLosslessWebp!=null&&supportsLossyWebp!=null){if(supportsLosslessWebp)res|=2;if(supportsLossyWebp)res|=1}return res};this.supportsWebP=function(){if(supportsLosslessWebp==null||supportsLossyWebp==null){var img=new Image;img.onload=function(){supportsLossyWebp=img.width==4&&img.height==4};img.onerror=function(){supportsLossyWebp=false};img.src="data:image/webp;base64,UklGRkYAAABXRUJQVlA4IDoAAABwAgCdASoEAAQAAYcIhYWIhYSIiQIADAzdrBLeABAAAAEAAAEAAPKn5Nn/0v8//Zxn/6H3QAAAAAA=";
var img2=new Image;img2.onload=function(){supportsLosslessWebp=img.width==4&&img.height==4};img2.onerror=function(){supportsLosslessWebp=false};img2.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4TBoAAAAvA8AAAA8w//M///MfeFDTtgEL3+5G9D+AHA=="}return this.getSupportsWebP()};this.supportsWebP()};var RdpGlyph=function(font,character,offset,baseLine,width,height,fontData){this.font=font;this.character=character;this.offset=offset;this.baseLine=baseLine;this.width=width;this.height=height;this.fontData=
fontData};function TextEntry(size,data){this.size=size;this.data=data}var codec={binaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(data){var btable=
codec.binaryTable,len,bindex,dindex,e,j,n=0,u=0;len=data.indexOf("=");if(len<0)len=data.length;var output=Array((len>>2)*3+Math.floor(len%4/1.5));e=0;for(j=0;j<data.length;j++){bindex=btable[data.charCodeAt(j)&127];dindex=data.charAt(j)==="=";if(bindex===-1)logError("Illegal character '"+data.charCodeAt(j)+"'");else{u=u<<6|bindex;n+=6;if(n>=8){n-=8;output[e++]=u>>n&255;u&=(1<<n)-1}}}if(n)throw"Invalid base64 encoding";return output}};this.emptyRecycleImgTimeout=null;this.allowMouse=false;if(helper.object.existsPath(arguments,
"0.clientSettings"))self.clientSettings=arguments[0].clientSettings;this.observable={"useAjax":true,"connected":null,"viewHeight":0,"viewWidth":0,"isOTURLSession":false};var _restartConnectTimeout=2E3;var allowOverrideCursor=!agentInfo.isMobile&&cookiePrefix!=="VNC"&&(!agentInfo.isFirefox||window.devicePixelRatio==1)&&!agentInfo.isMSIE&&productId!="ZSC"?true:false;if(allowOverrideCursor&&helper.object.existsPath(self,"clientSettings.OverrideCursor"))TVNC.rcParams.overrideCursor=self.clientSettings.OverrideCursor;
TVNC.rcParams.overrideCursor=!(agentInfo.isMobile||agentInfo.isTouch);var _visualEffect=null;var _customEventsHandler={};var _allowMouseCapture=true;var _checkSizeAndResolutionTimeoutId=null;var _deltaYMultiplier=agentInfo.isOpera?-1:1;var _enumCloseStatusReason=helper.object.createEnum({"ERROR":-1,"DISCONNECT":0,"CLOSE":1});var _isPktIdxEnabled=false;var _lastPkt={"idx":0,"group":0,"reset":false};Object.defineProperty(this,"pktIdxEnabled",{"enumerable":false,"configurable":false,"get":function(){return _isPktIdxEnabled},
"set":function(value){_isPktIdxEnabled=helper.object.convertTo(value,"boolean");if(_isPktIdxEnabled){_lastPkt.reset=true;_lastPkt.idx=-1}}});var _avoidConnectionLostPopup=false;var _mouseQueueTimeout=null;var _blob={"threshold":4E3,"on":typeof ThinVNCApp=="undefined","processedScreenUrl":[],"processedMouseUrl":[],"revoked":false};var _usedImgQueueItems=[];var _location="";var _virtualPathProfile="";var _fromBroker=typeof window.fromBroker!="undefined"?window.fromBroker:false;var rePP=RegExp(/\?|&/);
var STATE_INITIAL=0,STATE_PENDING=1,STATE_ACTIVE=2,STATE_EXPIRED=3,STATE_ERROR=4,STATE_BUSY=5,RDP_NO_INFO=0,RDP_LOGIN_START=1,RDP_LOGIN_INFO=2,RDP_LOGIN_END=3,RDP_LOGIN_ERROR=4;var PROVISSIONING_CREATING=4096,PROVISSIONING_UPDATING=8192,PROVISSIONING_FAILED=16384,PROVISSIONING_SUCCEEDED=32768,PROVISSIONING_DELETING=65536,PROVISSIONING_MIGRATING=131072,POWERSTATE_CREATING=1,POWERSTATE_STARTING=2,POWERSTATE_RUNNING=4,POWERSTATE_STOPPING=8,POWERSTATE_STOPPED=16,POWERSTATE_DEALLOCATING=32,POWERSTATE_DEALLOCATED=
64;var _urlCreator=window.URL||window.webkitURL;var _SIDName=(typeof window.cookiePrefix!="undefined"?window.cookiePrefix+"_":"")+"SID";var _splashCssName=".establishingConnection";var _isSessionEnded=false;var _noop=function(){};var _pendingGrowlsPopups=[];var _licenseTypes=helper.object.createEnum("ERR_TYPE_INFO","ERR_TYPE_WARNING","ERR_TYPE_ERROR");const generateId=()=>`${performance.now()}${Math.random().toString().slice(5)}`.replace(".","");var _getServerUrl={"timeout":1E3,"normal_timeout":1E3,
"vm_timeout":5E3,"id":generateId(),"forceNewRedirection":false,"forceNewRedirectionUsed":false,oturlMaxRetries:4,retriesCount:0};var _xhrStatusExitCodes=[Thinfinity.Communication.errorCode.PAYMENT_REQUIRED,Thinfinity.Communication.errorCode.UNAUTHORIZED];if(helper.url.gup("serviceScreen")!="")if(Thinfinity.ServiceScreen){window.serviceScreen=new Thinfinity.ServiceScreen({"parentElement":document.body});window.serviceScreen.addValue("Use-Ajax",function(){return TVNC.useAjax});window.serviceScreen.addValue("Force-Ajax",
function(){return TVNC.rcParams.forceAjax.toString()})}var _isTemporalConnection=helper.object.convertTo(helper.url.gup("sdk")!="","bool");var _defaultResponseType=helper.ajax.responseType.JSON;var _comm=null;var _avoidSendMouseMove=false;Object.defineProperty(this,"avoidSendMouseMove",{"enumerable":true,"configurable":false,"get":function(){return _avoidSendMouseMove},"set":function(value){_avoidSendMouseMove=value;if(!_avoidSendMouseMove)TVNC.sendMouseMove()}});var _syncCookies={syncCookiesTime:2500,
syncCookiesTOUT:null,syncCookiesEnabled:true,data:{}};var _componentsInitialized=false;var _componentRegistrationServices=null;var _registeredEventsServicesList={};var _enumEventsServices=helper.object.createEnum({"SENDEVENT":1});var _url={"baseUrl":"","gatewayAccess":null,"httpConnection":"","wsConnection":"","brokerUrl":""};Object.defineProperty(this,"baseUrl",{"configurable":false,"enumerable":true,"get":function(){return _url.baseUrl},"set":function(baseUrl){_url.baseUrl=baseUrl}});Object.defineProperty(this,
"httpConnection",{"configurable":false,"enumerable":true,"get":function(){return _url.httpConnection}});Object.defineProperty(this,"hasSecondaryGateway",{"configurable":false,"enumerable":true,"get":function(){return _url.gatewayAccess&&_url.gatewayAccess!==""}});Object.defineProperty(this,"brokerUrl",{"configurable":false,"enumerable":true,"get":function(){return _url.brokerUrl}});var _clipSynchronized=false;function padZero(num,size){return("00000000"+num).substr(-size)}function setPlugin(plugin){if(plugin==
undefined||plugin==null){var arPluginName=null;for(var plugin in _plugins)if(helper.object.getValue(_plugins,plugin+".enabled",false)){if(arPluginName==null)arPluginName=[];arPluginName.push(plugin)}return arPluginName}else if(helper.object.validate(plugin)&&helper.object.validate(plugin["name"])&&helper.object.validate(plugin["obj"])){if(_plugins[plugin["name"]]==undefined)_plugins[plugin["name"]]={"obj":null};_plugins[plugin["name"]]["enabled"]=plugin["enabled"]||true;_plugins[plugin["name"]]["obj"]=
plugin["obj"]}else return helper.string.sprintf(consts.errorExternalPlugin)}function on(name,handler){if(!_customEventsHandler[name])_customEventsHandler[name]=[];var wasAdded=false;for(var i=0;i<_customEventsHandler[name].length;i++)if(_customEventsHandler[name]===handler){wasAdded=true;break}if(!wasAdded)_customEventsHandler[name].push(handler)}function off(name,handler){if(_customEventsHandler[name])for(var i=_customEventsHandler[name].length-1;i>=0;i--)if(_customEventsHandler[name]===handler)_customEventsHandler[name].splice(i,
1)}function triggerCustomEvent(name,data){if(_customEventsHandler&&_customEventsHandler[name])for(var i=0;i<_customEventsHandler[name].length;i++)try{return _customEventsHandler[name][i](data)}catch(error){}}function addValidCanvas(canvas){if(_validCanvas.indexOf(canvas)===-1)_validCanvas.push(canvas)}Object.defineProperty(this,"useAjax",{"enumerable":true,"configurable":true,"get":function(){return TVNC.observable.useAjax},"set":function(value){TVNC.observable.useAjax=value}});Object.defineProperty(this,
"connected",{"enumerable":true,"configurable":true,"get":function(){return _comm.connected},"set":function(value){_comm.connected=value}});Object.defineProperty(this.rcParams,"viewWidth",{"enumerable":true,"configurable":true,"get":function(){return TVNC.observable.viewWidth},"set":function(value){TVNC.observable.viewWidth=value}});Object.defineProperty(this.rcParams,"viewHeight",{"enumerable":true,"configurable":true,"get":function(){return TVNC.observable.viewHeight},"set":function(value){TVNC.observable.viewHeight=
value}});Object.defineProperty(this,"containerId",{"enumerable":true,"configurable":true,"get":function(){return TVNC.rcParams.divId}});Object.defineProperty(this,"setKeyboardFocus",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return _displayManager.focus()}});var _displayObj={};Object.defineProperty(this,"display",{"enumerable":true,"configurable":false,"get":function(){return _displayObj}});Object.defineProperty(_displayObj,"manager",{"enumerable":true,"configurable":false,
"get":function(){return _displayManager}});Object.defineProperty(_displayObj,"managerInterface",{"enumerable":true,"configurable":false,"get":function(){return _oInterface.new}});Object.defineProperty(this,"allowMouseCapture",{"enumerable":true,"configurable":true,"get":function(){return _allowMouseCapture},"set":function(value){if(!TVNC.rcParams.serverControlMouse||!value)_allowMouseCapture=value}});Object.defineProperty(this,"overrideCursor",{"enumerable":true,"configurable":true,"get":function(){return allowOverrideCursor&&
TVNC.rcParams.overrideCursor},"set":function(value){if(allowOverrideCursor)TVNC.rcParams.overrideCursor=value}});Object.defineProperty(this,"on",{"enumerable":true,"configurable":true,"writable":false,"value":on});Object.defineProperty(this,"off",{"enumerable":true,"configurable":true,"writable":false,"value":off});Object.defineProperty(this,"__recvPingResponse",{"enumerable":false,"configurable":false,"value":function(){return _comm.recvPingResponse()}});Object.defineProperty(this,"plugins",{"enumerable":false,
"configurable":true,"value":function(plugin){return setPlugin(plugin)}});Object.defineProperty(this,"location",{"enumerable":true,"configurable":true,"get":function(){return _location}});Object.defineProperty(this,"virtualPath",{"enumerable":true,"configurable":true,"get":function(){return _virtualPathProfile}});Object.defineProperty(this,"fromBroker",{"enumerable":false,"configurable":true,"get":function(){return _fromBroker},"set":function(value){return _fromBroker=helper.object.convertTo(value,
"boolean")}});Object.defineProperty(this,"splashCssName",{"enumerable":false,"configurable":true,"get":function(){return _splashCssName},"set":function(value){return _splashCssName=value}});Object.defineProperty(this,"isTemporal",{"enumerable":false,"configurable":true,"get":function(){_isTemporalConnection}});Object.defineProperty(this,"H264",{"enumerable":false,"configurable":false,"get":function(){return _ePictureType===_enumPictureType.H264}});Object.defineProperty(this,"GFX",{"enumerable":false,
"configurable":false,"get":function(){return _ePictureType===_enumPictureType.GFX}});Object.defineProperty(this,"availableAudio",{"enumerable":true,"configurable":false,"get":()=>{return window.AudioContext?true:false}});Object.defineProperty(this,"enumCloseStatusReason",{"enumerable":true,"configurable":false,"get":function(){return _enumCloseStatusReason}});Object.defineProperty(this,"onSendEvent",{"enumerable":false,"configurable":false,"set":function(handler){if(handler&&handler instanceof Function)_registeredEventsServicesList[_enumEventsServices.SENDEVENT]=
handler}});this.allowFullscreenShortcut=productId=="thinrdp"?true:false;this.multiRowMinSize=40;if(agentInfo.isMSIE&&agentInfo.msieVersion<10)this.partialAnimationFrameUpdate=function(callback){setTimeout(callback,0)};else this.partialAnimationFrameUpdate=function(callback){callback()};var mouseCanvasX=0;var mouseCanvasY=0;var previousOrientation=null;var waitOrientationChangeTime=1E3;var elapsedOrientationTime=null;var allowSendingCommands=false;function createPrintDialog(){return typeof PrintDialog!=
"undefined"&&PrintDialog!=null?new PrintDialog({"onHide":function(){TVNC.pingIgnore=false},"onAssignDocument":function(){TVNC.pingIgnore=true},"owner":TVNC}):null}var printDialog=createPrintDialog();var timeBeforeReconnect=250;var timeoutIdBeforeReconnect=null;var resetTimeId=null;var isReset=false;var currentActiveWindow=null;var oLastError={"message":null,"code":null,"date":null,"timeoutId":null,"elapsedTime":1E4};var errorOccurs=0;var connection={"fromReconnection":false,"firstConnection":true,
"first404IncomingTime":null,"maxTimeBeforeRemoveGatewayAccessKey":3E4,reconnectingCount:0,reconnectingMax:8};var serverDPR={"enabled":false,"originalValue":null};var serverCmdResultOrientation=null;var restartOnOrientationChange=false;var mouseBuffer={"queue":[],"isAvailable":false};var ENUM_CODES={authenticationCodeErrors:["10009","10010"]};var UintArrayConfig={"size":5E4,"sliceMethod":typeof Uint8Array!="undefined"?(new Uint8Array).splice!=undefined?"slice":"subarray":"slice","method":"apply"};
var emulcont=null;var _getComputedStyle=helper.style.getComputedStyle;var _enumPictureType=helper.object.createEnum({CANVAS:0,H264:1,GFX:2});var _ePictureType=_enumPictureType.CANVAS;var _gfx=null;var _validCanvas=[];var _displayManager=null;var _packetReceiver=null;var _audioDriver=null;var _preventKeys={available:true,keys:{67:{"ctrlKey":true},99:{"ctrlKey":true},86:{"ctrlKey":true},118:{"ctrlKey":true},88:{"ctrlKey":true},120:{"ctrlKey":true}}};var _oInterface=null;var _oClipboard=null;var _iClipboard=
null;var _pendingsCommandsCallback=[];var _pendingDisplayResize=null;var _eMode=helper.object.createEnum({"HOST":0,"API":1,"SKEY":2,"OTURL":10,"SDK":11});var _isDisconnecting=false;var _connectResult={max:10,count:0};function getOrientation(){if(window.matchMedia)if(window.matchMedia("(orientation: portrait)").matches)return"portrait";else{if(window.matchMedia("(orientation: landscape)").matches)return"landscape"}else return"landscape"}this.getOrientation=getOrientation;function initialize(){previousOrientation=
window.environment.currentOrientation||getOrientation();var commArgs={"protocol":Thinfinity.Communication.protocol.WEBSOCKET,"withCredentials":TVNC.crossDomain(),"webSocket":{"maxTimeToOpen":1E4,"events":{"open":function(e){BTP_WS_OPEN=null;TVNC.wsEnabled=true;resetLastError();logDebug("TVNC.ws.onopen. TVNC.wsEnabled = true");TVNC.useAjax=false;TVNC.start();try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onConnectionKindChange==null)$(document).trigger("connectionKindChange");
else TVNC.rcParams.events.onConnectionKindChange()}catch(error){helper.console.warning("'onConnectionKindChange' calling attached method fail. message: "+error.message,error,arguments)}callPendingCommands()},"message":function(msg){errorOccurs=0;_packetReceiver.process(msg.data)},"close":function(e){BTP_WS_CLOSE1=null},"error":function(e){BTP_WS_ERR=null;var msg=consts.unknownError;var code="";if(e&&e.detail){code=e.detail.code;if(e.detail.message!="")msg=e.detail.message;if(e.detail.code===Thinfinity.Communication.errorCode.TIMEOUT){BTP_WS_TOUT=
null;helper.console.log("WebSocket: is not responding...",arguments);BTP_PWS_CLS2=null}}helper.console.warning(helper.string.format("TVNC.ws.error - {0}, ({1})",msg,code),arguments)}}},"methods":{arraybufferToString:TVNC.arbufToStringU8},"properties":{},"events":{"stateChange":function(state){connectionStateChanged(state)},"error":function(e){var msgDetail=helper.object.getValue(e,"detail.message","");helper.console.warning(helper.string.format("Something went wrong: {0}, protocol: {1}, state: {2}",
msgDetail,_comm.protocol,_comm.state),arguments);if(e.detail&&e.detail.code===Thinfinity.Communication.errorCode.RESTART)restart(true)}}};Object.defineProperty(commArgs.properties,"sessionEnd",{"enumerable":true,"configurable":false,"get":function(){return _isSessionEnded}});_comm=new Thinfinity.Communication(commArgs)}var _commLastState=0;let _commStateLost=false;function connectionStateChanged(state){if(state===Thinfinity.Communication.state.CONNECTED){if(_commLastState!=state){_displayManager.fireEvent("localEvent",
{cmd:"connected"});TVNC.closeReconnectDiv();if(_commLastState>Thinfinity.Communication.state.RECONNECTING&&_commLastState<Thinfinity.Communication.state.LOST||_commStateLost)try{BTP_PC_RST=null;var cs={"code":3,"message":consts.connRestored};_displayManager.fireEvent("localEvent",{...{cmd:"connectionRestored"},cs});if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onConnectionRestored==null)window.dispatchEvent(new CustomEvent(consts.connRestored,cs));else TVNC.rcParams.events.onConnectionRestored(cs)}catch(error){helper.console.error(consts.connRestored+
" - code: 3",error,arguments)}}_commStateLost=false}else if(state===Thinfinity.Communication.state.UNSTABLE){if(_commLastState!=state)try{BTP_PC_UNS=null;var cs={"code":1,"message":consts.connUnstable};_displayManager.fireEvent("localEvent",{...{cmd:"connectionUnstable"},cs});if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onConnectionLost==null)window.dispatchEvent(new CustomEvent(consts.connUnstable,cs));else _avoidConnectionLostPopup=TVNC.rcParams.events.onConnectionLost(cs);
if(!_avoidConnectionLostPopup)TVNC.showReconnectDiv(false)}catch(error){helper.console.error(consts.connUnstable+" - code: 1",error,arguments)}_commStateLost=true}else if(state===Thinfinity.Communication.state.LOST){try{BTP_PC_LST=null;var cs={"code":2,"message":consts.connLostReconnecting};_displayManager.fireEvent("localEvent",{...{cmd:"connectionLost"},cs});if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onConnectionLost==null)window.dispatchEvent(new CustomEvent(consts.connLost,
cs));else _avoidConnectionLostPopup=TVNC.rcParams.events.onConnectionLost(cs);if(!_avoidConnectionLostPopup)TVNC.showReconnectDiv(true)}catch(error){helper.console.error(consts.connLostReconnecting+" - code: 2",error,arguments)}_commStateLost=true}_commLastState=state}function callPendingCommands(){_pendingsCommandsCallback.forEach(function(handler){try{handler()}catch(error){}});_pendingsCommandsCallback=[]}this.showReconnectDiv=function(connLost){if(!checkSplashPopup())if(_visualEffect)_visualEffect.toGrayScale(connLost);
else{var elem=document.getElementById(TVNC.reconnectDivId);var d=helper.dom.appendJsonElement({"parentElement":elem&&elem.parentElement?elem.parentElement:document.body,"type":"div","attributes":{"style":helper.string.format("-webkit-box-shadow: 1px 1px 15px #000;-moz-box-shadow: 1px 1px 15px #000; position:absolute; top:50%; left:50%; transform:translate3d(-50%, -50%, 0); background:#111111;z-index:{0}; padding:20px;color:#FFF;-moz-border-radius: 7px;border-radius: 7px; font-size:14px; font-weight:normal; width:250px;height:68px; text-align:center",
TVNC.getNextHighestZindex(document.body))},"content":consts.connLostReconnecting+"</br>"});var button=helper.dom.appendJsonElement({"parentElement":d,"type":"input","attributes":{"id":"cancelRecnx","type":"button","style":"margin-top:20px;padding:6px;"},"events":{"click":function(e){TVNC.closeReconnectDiv();TVNC.disconnect();TVNC.dispose(true);$(document).unbind();$("#"+TVNC.vncdivId).unbind()}},"content":consts.abort})}};previousOrientation=window.environment.currentOrientation||getOrientation();
this.pingIgnore=false;this.closeReconnectDiv=function(abort){if(_avoidConnectionLostPopup!==true)if(_visualEffect)_visualEffect.toColor();else{$("#cancelRecnx").parent().remove();$("#"+TVNC.reconnectDivId).remove()}};this.connectWebSocket=function(fastConnect,callback){BTP_WS_INIT=null;if(_comm.state<=Thinfinity.Communication.state.CLOSING)_comm.wsOpen(TVNC.getWsUrl())};function restartConnection(){TVNC.reset();_comm.releaseQueue(TVNC.queueRequestName);var buildResolutionArgs=function(){var args=
"";var w=TVNC.rcParams.width;var h=TVNC.rcParams.height;var fitmode="";if(typeof this.agentName=="undefined")TVNC.resolveAgent();var screenWidth=window.environment.rawWidth||window.screen.width;var screenHeight=window.environment.rawHeight||window.screen.height;w=window.environment.detectedWidth;h=window.environment.detectedHeight;if(helper.object.existsPath(self,"clientSettings.UseViewportSize")&&self.clientSettings.UseViewportSize){w=window.environment.viewportWidth;h=window.environment.viewportHeight}if(typeof TVNC.rcParams.fitmode!=
"undefined"){fitmode=TVNC.rcParams.fitmode;if(fitmode!=undefined&&typeof fitmode=="string"&&fitmode.toLowerCase()!="fixed"&&fitmode.indexOf("x")>0){fitmode="&fitmode=1";var res=fitmode.split("x");w=res[0];h=res[1]}}else if(TVNC.rcParams.resolution=="fittobrowser")fitmode="&fitmode=0";else if(TVNC.rcParams.resolution=="fittoscreen")fitmode="&fitmode=2";else if(TVNC.rcParams.resolution=="fixed"){fitmode="&fitmode=1";w=TVNC.rcParams.width;h=TVNC.rcParams.height}else if(TVNC.rcParams.resolution.indexOf("x")>
0){fitmode="&fitmode=1";var res=TVNC.rcParams.resolution.split("x");w=res[0];h=res[1]}var pos=TVNC.vncdiv!=null?TVNC.findPos(TVNC.vncdiv):[0,0];var offset={"left":pos[0],"top":pos[1]};args+="&browserWidth="+(w-offset.left)+"&browserHeight="+(h-offset.top);args+="&screenWidth="+screenWidth+"&screenHeight="+screenHeight;args+=fitmode;return args};var isLandscape=window.environment.currentOrientation=="landscape"?true:false;var args="cmd=start&subcmd=restart"+buildResolutionArgs()+"&devicePixelRatio="+
(environment.initialDevicePixelRatio||1)+"&isMobile="+agentInfo.isMobile+"&isLandscape="+isLandscape+"&supportsFullScreen="+window.environment.supportsFullScreen+"&webapp="+window.environment.webapp;TVNC.start(args)}function restart(hasBeenLost){if(hasBeenLost)helper.console.error("The Connection has been lost.",null,arguments);if(_isSessionEnded){helper.console.error("The Session has ended. Cannot restart the connection.",null,arguments);return}helper.console.warning("Restarting connection...",null,
arguments);if(_comm.state>=Thinfinity.Communication.state.CLOSING)return;TVNC.rcParams.clientAck=-1;TVNC.rcParams.clientAck=TVNC.rcParams.clientAck<=0&&!TVNC.useAjax?0:Math.max(TVNC.rcParams.clientAck,1);if(_fromBroker)_url.baseUrl=_virtualPathProfile;TVNC.reconnect()}this.rop3CanvasNoType=function(context,cmd,imageData,auxImageData){var data=imageData.data;var auxData=auxImageData.data;for(var offset=0;offset<cmd.cx*cmd.cy*4;offset+=4){var auxDataPixel=auxData[offset]|auxData[offset+1]<<8|auxData[offset+
2]<<16;var dataPixel=data[offset]|data[offset+1]<<8|data[offset+2]<<16;dataPixel=this.doROP3(cmd.o,auxDataPixel,dataPixel,cmd.bc,cmd.fc);data[offset]=dataPixel&255;data[offset+1]=dataPixel>>>8&255;data[offset+2]=dataPixel>>>16&255;data[offset+3]=255}context.putImageData(imageData,cmd.x,cmd.y)};this.rop3CanvasU32=function(context,cmd,imageData,auxImageData){var data=new Uint32Array(imageData.data.buffer);var auxData=new Uint32Array(auxImageData.data.buffer);for(var offset=0;offset<cmd.cx*cmd.cy;offset++)data[offset]=
this.doROP3(cmd.o,auxData[offset]&16777215,data[offset]&16777215,cmd.bc,cmd.fc)|4278190080;context.putImageData(imageData,cmd.x,cmd.y);auxData=data=null};this.rop3Canvas=agentInfo.hasTypedArrays?this.rop3CanvasU32:this.rop3CanvasNoType;this.u8ArrayToDataUri=function(mime,raw){if(_blob.on&&raw.length>_blob.threshold)return _urlCreator.createObjectURL(new Blob([raw],{type:mime}));else return"data:"+mime+";base64,"+window.btoa(TVNC.arbufToStringU8(raw))};this.arbufToStringU8ConcatMethod=function(data){var str=
"";var len=data.byteLength;for(var i=0;i<len;i++)str+=String.fromCharCode(data[i]);return str};this.arbufToStringU8ApplyMethod=function(data){if(data.length<UintArrayConfig["size"])return String.fromCharCode.apply(null,data);else{var str="";var i=0;var n=data.length;while(i<n)str+=String.fromCharCode.apply(null,data[UintArrayConfig["sliceMethod"]](i,i+=UintArrayConfig["size"]));return str}};this.arbufToStringU8=UintArrayConfig["method"]=="apply"?this.arbufToStringU8ApplyMethod:this.arbufToStringU8ConcatMethod;
function clone(oldObject){return $.extend(true,{},oldObject)}this.crossDomain=function(){return TVNC.crossdomain||TVNC.rcParams.isCrossDomain};this.completeAjaxParams=function(params){if(TVNC.crossDomain()){params.beforeSend=function(xhr){xhr.withCredentials=true};params.crossDomain=true}return params};function initializeImageQueue(sessionId){if(TVNC.imgQueue==null||TVNC.imgQueue.sessionId!=sessionId){helper.console.log("Initializing Image Queue");this.imageCache2=[new Array(600),new Array(600),new Array(2048),
new Array(4096),new Array(2048)];this.imageCacheV=[new Array(200),new Array(200),new Array(200),new Array(200),new Array(200)];TVNC.purgeImageQueue(TVNC.imgQueue);TVNC.imgQueue=null;TVNC.imgQueue=TVNC.createImageQueue(sessionId);_usedImgQueueItems=[]}}this.createImageQueue=function(sessionId){var newItem={"sessionId":sessionId,"items":{},"loaded":0,"startTime":0,"count":0,"group":0,"aborted":function(){return false},"timeout":450,"watchdogTimer":null,"watchdogStart":function(){var self=this;this.startTime=
(new Date).getTime();if(this.watchdogTimer!==null){logError("imageQueue watchdog already running!");this.watchdogStop()}this.watchdogTimer=setTimeout(function(){if(self.timeout>0)logError("imageQueue idx: "+TVNC.resumeItem.qidx+" timeout at "+((new Date).getTime()-self.startTime)+" ms!");if(TVNC.resumeItem){TVNC.resumeItem.processed=true;if(TVNC.executeDeferred)TVNC.executeDeferred();else logDebug("Missing function executeDeferred. --\x3e TVNC.executeDeferred()")}},this.timeout)},"watchdogStop":function(){if(this.watchdogTimer!==
null){clearTimeout(this.watchdogTimer);self.timeout=1E3;this.watchdogTimer=null}}};return newItem};this.purgeImageQueue=function(imgQueue){if(!imgQueue)return;imgQueue.watchdogStop();for(var i=0;i<imgQueue.items.length;i++){var item=imgQueue.items[i];if(item)if(!item.purgeAll)logDebug("Not an item object in imgQueue, idx: "+i);else{item.purgeAll();TVNC.returnImageItem(item)}delete imgQueue.items[i]}};function ab2str(buf){return String.fromCharCode.apply(null,new Uint16Array(buf))}function str2ab(str){var buf=
new ArrayBuffer(str.length*2);var bufView=new Uint16Array(buf);for(var i=0,strLen=str.length;i<strLen;i++)bufView[i]=str.charCodeAt(i);return buf}function getImageCacheList(usecompression){if(TVNC.dbFiles.length>0){var dbSrc=TVNC.dbFiles.join("-");if(usecompression){var dbZip=new Zlib.RawDeflate(dbSrc);var dbB64=$.base64.encode(dbZip);return dbB64}else return dbSrc}else return""}this.toDataUrl=function(url,callback){helper.ajax.get({"url":url,"responseType":"blob","success":function(response){var reader=
new FileReader;reader.onloadend=function(){callback(reader.result)};reader.readAsDataURL(response)}})};this.convertImgURLToBase64=function(source,type,callback){var loadImage=function(internalCallback){var img=new Image;img.crossOrigin="Anonymous";img.onload=function(e){if(typeof e.target.complete=="undefined"||e.target.complete==true)internalCallback(img,e);else{var maxTimes=10;var countTimes=0;function retryLoadImage(){setTimeout(function(){if(countTimes>maxTimes){helper.console.warning("Cannot get image source.",
arguments);internalCallback(null)}else if(typeof e.target.complete=="undefined"||e.target.complete==true)internalCallback(img,e);else retryLoadImage();countTimes++},50)}}};img.onerror=function(e){internalCallback(null,e)};img.onabort=function(e){internalCallback(null,e)};img.srcImage=souce;img.src=source};loadImage(function(img,e){if(img){var canvas=document.createElement("canvas");canvas.appendChild(img);var base64=canvas.toDataURL(type);callback(type,base64)}else callback(type,null)})};this.getBasicHTMLImg=
function(url){if(url)return'<html><body>\x3c!--StartFragment--\x3e<img src="'+url+'"/>\x3c!--EndFragment--\x3e</body></html>';else return null};function getClipboardInterface(){if(!_oClipboard){let _clipboard={};let permissions={};Object.defineProperty(permissions,"fileTransfer",{configurable:false,enumerable:true,get:function(){return TVNC.rcParams.clipboardFileTransfer}});_oClipboard=(new Thinfinity.Object.Interface({defaultEventFire:{async:0}})).new(new Thinfinity.Object.IConfig({namespace:true,
options:[Thinfinity.Object.IConfig.OPTIONS.DO_NOT_FULL_EXTEND_OBJECT],object:TVNC,properties:[{source:"KeyboardHandler.kbdInput",ro:true,alias:"inputElement"},{source:"vncdiv",ro:true,alias:"parentElement"},{source:permissions,ro:true,alias:"permissions"},{source:"enable",ro:true,get:function(){return TVNC.rcParams.clipboard}},{source:"synchronizeClipboard",ro:true,get:function(){return TVNC.rcParams.synchronizeClipboard}}],methods:[{alias:"output",value:function(jData){if(jData.cmd)switch(jData.cmd.toLowerCase()){case "focus":_displayManager.focus();
break;case "settext":_displayManager.textValue=jData.value;break;case "maccmd":if(jData.value==="RELEASED")_displayManager.updateMacCmd(Thinfinity.Driver.Keyboard.MAC_CMD.RELEASED);break}}},{alias:"sendData",value:function(url,data){if(TVNC.useAjax){var url=_url.httpConnection+"cmd?id="+url;_comm.post({"url":url,"data":data})}else{var cmd=url+"&linemode=LF&data="+data;TVNC.sendCmd(cmd)}}},{alias:"request",value:function(params){params.url=TVNC.addExtraParams(_url.httpConnection+params.url);var cors=
TVNC.crossdomain||TVNC.rcParams.isCrossDomain;if(cors&&_comm.protocol!==_args.comm.protocol.AJAX)params.xhrFields={"withCredentials":true};_comm.send(params)}},{alias:"convertImgURLToBase64",value:TVNC.convertImgURLToBase64},{alias:"getBasicHTMLImg",value:TVNC.getBasicHTMLImg},{alias:"sendEvent",value:TVNC.sendEvent},{alias:"setSelectionRange",value:function(){_displayManager.setSelectionRange(0,_displayManager.textValue.length)}},{alias:"getTextValue",value:function(){return _displayManager.textValue}},
{alias:"clearText",value:function(){_displayManager.textValue=""}}],events:{copy:TVNC.rcParams.events.onCopy,paste:TVNC.rcParams.events.onPaste,cut:TVNC.rcParams.events.onCut,localPaste:function(){if(_preventKeys.available){TVNC.sendKey(86,0,"down",0);TVNC.sendKey(86,0,"up",0);return true}else return false},copyFiles:TVNC.rcParams.events.onCopyFiles}}));_iClipboard=_oClipboard.new}return{oObject:_oClipboard,iObject:_iClipboard}}this.findPos=function(obj){var curleft=0;var curtop=0;do{curleft+=obj.offsetLeft;
curtop+=obj.offsetTop}while(obj=obj.offsetParent);return[curleft,curtop]};this.emptyRecycleImg=function(onetime){while(TVNC.queueRecycleImg.length>0){img=TVNC.queueRecycleImg.pop();img=null}if(onetime==true)return;clearTimeout(TVNC.emptyRecycleImgTimeout);TVNC.emptyRecycleImgTimeout=setTimeout(TVNC.emptyRecycleImg,TVNC.recycleImgTimeoutValue)};this.setMaxSize=function(width,height){TVNC.rcParams.maxWidth=width;TVNC.rcParams.maxHeight=height};this.splitKey=function(key){var sk;if(!key.length)sk={"isVolatile":false,
"arr":0,"pos":key};else{sk={"isVolatile":key.length>6,"arr":parseInt(key.substring(0,2),10)};sk.pos=parseInt(sk.isVolatile?key.substring(6):key.substring(2,6),10)}return sk};this.getFromImageCache=function(key){var sk=this.splitKey(key);if(sk.isVolatile)return this.imageCacheV[sk.arr][sk.pos];else return this.imageCache2[sk.arr][sk.pos]};this.setToImageCache=function(item,key){if(!item)logError("Error on setToImageCache: null item.");var sk=this.splitKey(key);if(sk.isVolatile){BTP_IMG_CHV=null;if(this.imageCacheV[sk.arr][sk.pos])TVNC.returnImageItem(this.imageCacheV[sk.arr][sk.pos]);
this.imageCacheV[sk.arr][sk.pos]=item}else{BTP_IMG_CH2=null;if(this.imageCache2[sk.arr][sk.pos])TVNC.returnImageItem(this.imageCache2[sk.arr][sk.pos]);this.imageCache2[sk.arr][sk.pos]=item}};this.createCanvas=function(win){let div=document.createElement("div");div.style.position="absolute";div.style.left=win.left-TVNC.rcParams.viewLeft+"px";div.style.top=win.top-TVNC.rcParams.viewTop+"px";let r=0;let b=0;if(productId==="virtualui"){r=typeof win.right!=="undefined"?win.right:win.left;b=typeof win.bottom!==
"undefined"?win.bottom:win.top;if(win&&win.hwnd!=0&&TVNC.rcParams?.events?.onCreateCanvas)TVNC.rcParams.events.onCreateCanvas(win)}div.style.zIndex=this.baseZIndex+win.zidx*10;let w=win.width+r;let h=win.height+b;div.width=w;div.height=h;div.style.width=w+"px";div.style.height=h+"px";div.style.display="inline-block";if(win.hwnd>0)div.style.overflow="hidden";if(win.wndClass)div.setAttribute("wndClass",win.wndClass);if(TVNC.rdpMode&&win.hwnd==1){TVNC.vncContainer.style.width=w+"px";TVNC.vncContainer.style.height=
h+"px"}if(typeof win.className!="undefined")div.className=win.className;if(!win.parent){div.mask=new Object;div.mask.color="#000";div.mask.visible=false;var canvas=document.createElement("canvas");canvas.style.left="0px";canvas.style.top="0px";canvas.width=win.width;canvas.height=win.height;canvas.style.position="absolute";canvas.style.zIndex=1;canvas.style.width=win.width;canvas.style.height=win.height;canvas.hwnd=win.hwnd;helper.dom.addEvent(canvas,"contextmenu",function(e){if(e)e.preventDefault();
return false});div.canvas=canvas;div.appendChild(canvas)}if(agentInfo.isMobile)helper.dom.addEvent(div,"click",function(){});if(this.canvasInitiallyHidden&&win.hwnd!=0&&!win.parent){div.style.display="none";TVNC.fireCustomEvents("canvasInitiallyHidden",win)}div.id=productId+"_canvas_"+win.hwnd;var parentDiv=this.vncContainer;if(helper.object.validate(win.parent)&&win.parent!=0){div.parent=win.parent;parentDiv=document.getElementById(productId+"_canvas_"+win.parent);if(parentDiv)parentDiv.appendChild(div);
else{div.style.display="none";div.style.visibility="hidden";if(!this.canvasInitiallyHidden&&win.hwnd!=0)TVNC.fireCustomEvents("canvasHidden",win);this.vncContainer.appendChild(div)}}else parentDiv.appendChild(div);for(var i=this.vncContainer.childNodes.length-1;i>=0;i--){var elem=this.vncContainer.childNodes[i];if(elem.parent){var parentCanvas=document.getElementById(productId+"_canvas_"+elem.parent);if(parentCanvas){parentCanvas.appendChild(elem);elem.style.display="inline";if(elem.parent!=0)TVNC.fireCustomEvents("canvasShow",
elem.parent)}}}if(TVNC.controlFactory)TVNC.controlFactory.insertPending();return div};this.decode=function(data){return codec.decode(data)};this.cacheFont=function(cmd){var glyph=new RdpGlyph(cmd.fnt,cmd.chr,cmd.ofs,cmd.bl,cmd.w,cmd.h,this.decode(cmd.data));if(glyph.font<12&&glyph.character<256)this.rdpGlyphArray[glyph.font][glyph.character]=glyph;else throw logError("put font: font="+glyph.font+" c="+glyph.character),"Could not put font in cache";};this.getGlyph=function(font,character){if(font<
12&&character<256){var glyph=this.rdpGlyphArray[font][character];if(glyph!=null)return glyph}throw logError("Could not get Font:"+font+", "+character);};this.clearFontCache=function(){for(var i=0;i<12;i++)for(var j=0;j<256;j++){delete this.rdpGlyphArray[i][j];this.rdpGlyphArray[i][j]=null}};this.clearImageCache=function(){var i,j;try{for(i=0;i<this.imageCache2.length;i++){for(j=0;j<this.imageCache2[i].length;j++)if(this.imageCache2[i][j]){delete this.imageCache2[i][j].data;this.imageCache2[i][j]=
null}for(j=0;j<this.imageCacheV[i].length;j++)if(this.imageCacheV[i][j]){delete this.imageCacheV[i][j].data;this.imageCacheV[i][j]=null}}}catch(e){logError(e.Message)}};this.clearTextCache=function(){for(var i=0;i<this.textCache.length;i++){delete this.textCache[i];this.textCache[i]=null}};this.cachePutText=function(cache_id,data,idx,len){var carray=Array(len);for(n=0;n<len;n++)carray[n]=data[idx+n];textEntry=new TextEntry(len,carray);if(cache_id<this.textCache.length)this.textCache[cache_id]=textEntry;
else throw"Could not put Text in cache";};this.cacheGetText=function(cache_id){var entry=null;if(cache_id<this.textCache.length){entry=this.textCache[cache_id];if(entry!=null&&entry.data!=null)return entry}};this.toRGB=function(color){var rgb="rgba("+(color>>16&255)+",";rgb+=(color>>8&255)+",";rgb+=(color&255)+",1)";return rgb};this.putRdpText=function(cmd,context){var text=this.decode(cmd.text),idx=0,ch=0;if(cmd.bcx!=-1){context.fillStyle=this.toRGB(cmd.bc);context.fillRect(cmd.bx,cmd.by,cmd.bcx,
cmd.bcy);cmd.lx=cmd.bx;cmd.ly=cmd.by;cmd.lcx=cmd.bcx;cmd.lcy=cmd.bcy}else if(cmd.mm==1){context.fillStyle=this.toRGB(cmd.bc);context.fillRect(cmd.lx,cmd.ly,cmd.lcx,cmd.lcy)}cmd.maxX=cmd.lx+cmd.lcx-1;cmd.maxY=cmd.ly+cmd.lcy-1;if(cmd.lcx*cmd.lcy==0)return;var imgdata=null;var length=cmd.len;var j=0;var vert=(cmd.fl&4)==4;var horiz_implicit=(cmd.fl&32)!=0;while(j<length)switch(text[j]&255){case 255:if(j+2<cmd.len)this.cachePutText(text[j+1],text,0,text[j+2]&255);else throw"Index out of range!";length-=
j+3;text=text.slice(j+3);j=0;break;case 254:var entry=this.cacheGetText(text[j+1]&255);if(entry){if(entry.data[1]==0&&!horiz_implicit)if(!vert)cmd.x+=text[j+2]&255;else cmd.y+=text[j+2]&255;for(k=0;k<entry.size;k++){if(!imgdata)imgdata=context.getImageData(cmd.lx,cmd.ly,cmd.lcx,cmd.lcy);k+=this.doGlyph(context,imgdata,cmd,entry.data,k)}}j+2<length?j+=3:j+=2;length-=j;text=text.slice(j);j=0;break;default:if(!imgdata)imgdata=context.getImageData(cmd.lx,cmd.ly,cmd.lcx,cmd.lcy);j+=this.doGlyph(context,
imgdata,cmd,text,j);j++}if(imgdata)context.putImageData(imgdata,cmd.lx,cmd.ly)};this.doGlyph=function(context,imgdata,cmd,text,idx){var xyoffset=0,j=0,advanceCount=0,Bpp=Math.floor((cmd.bpp+7)/8);glyph=this.getGlyph(cmd.fnt,text[idx+j]&255);if(glyph){if(!(cmd.fl&32))if(cmd.oc)if(cmd.fl&4)cmd.y+=cmd.oc;else cmd.x+=cmd.oc;else{xyoffset=text[idx+ ++j]&255;advanceCount+=1;if(xyoffset==128){xyoffset=text[idx+j+1]&255|(text[idx+j+2]&255)<<8;advanceCount+=2}if(cmd.fl&4)cmd.y+=xyoffset;else cmd.x+=xyoffset}this.drawGlyph(context,
imgdata,cmd,glyph,Bpp);if(cmd.fl&32)cmd.x+=cmd.oc?cmd.oc:glyph.width}return advanceCount};this.drawGlyph=function(context,imgdata,cmd,glyph,Bpp){var x=cmd.x+glyph.offset&65535,y=cmd.y+glyph.baseLine&65535,dataWidth=Math.ceil(glyph.width/8)*8,glyphWidth=glyph.width,glyphHeight=glyph.height,fontData=glyph.fontData,desktopWidth=TVNC.rcParams.viewWidth,desktopHeight=TVNC.rcParams.viewHeight,foreColor=cmd.fc,backColor=cmd.bc,bit=128,line,pixel;if(x+glyphWidth<cmd.lx||x>cmd.maxX||y+glyphHeight<cmd.ly||
y>cmd.maxY)return;var data=imgdata.data;if(!(x>desktopWidth||y>desktopHeight))for(line=0;line<glyphHeight;line++)if(line+y>=cmd.ly&&line+y<=cmd.maxY)for(var pixel=0;pixel<glyphWidth;pixel++)if(pixel+x>=cmd.lx&&pixel+x<=cmd.maxX){var pixelOffset=((line+(y-cmd.ly))*cmd.lcx+pixel+(x-cmd.lx))*4;var byteIndex=Math.floor((line*dataWidth+pixel)/8);bit=fontData[byteIndex]>>7-pixel%8&1;try{if(bit)this.setPixel(data,pixelOffset,foreColor);else if(cmd.mm==1)this.setPixel(data,pixelOffset,backColor)}catch(err){logError(err)}}};
this.setPixel32=function(data,pixelOffset,color){data[pixelOffset]=color};this.setPixel=function(data,pixelOffset,color){data[pixelOffset]=color>>16&255;data[pixelOffset+1]=color>>8&255;data[pixelOffset+2]=color&255;data[pixelOffset+3]=255};this.doROP=function(rop,src,dst){switch(rop){case 0:return 0;case 1:return~(src|dst);case 2:return~src&dst;case 3:return~src;case 4:return src&~dst;case 5:return~dst;case 6:return src^dst;case 7:return~(src&dst);case 8:return src&dst;case 9:return~src^dst;case 10:return dst;
case 11:return~src|dst;case 12:return src;case 13:return src|~dst;case 14:return src|dst;case 15:return~0;case 16:return~src&~dst}return dst};this.doROP3=function(rop,src,dst,bc,fc){switch(rop){case 0:return 0;case 1:return~(src|dst);case 2:return~src&dst;case 3:return~src;case 4:return src&~dst;case 5:return~dst;case 6:return src^dst;case 7:return~(src&dst);case 8:return src&dst;case 9:return~src^dst;case 10:return dst;case 11:return~src|dst;case 12:return src;case 13:return src|~dst;case 14:return src|
dst;case 15:return~0;case 16:return~src&~dst;case 17:return~src&fc;case 18:return src==0?bc:fc;case 19:return dst|(fc|~src);case 20:return src==0?bc^dst:fc^dst;case 21:return src&fc|~src&dst;case 22:return src&~fc;case 23:return dst^~fc}return dst};this.registerDrawCmd=function(cmd,callback){TVNC.registeredDrawCmds[cmd]=callback};this.registerOOBCmd=function(cmd,callback){TVNC.registeredOOBCmds[cmd]=callback};this.unregisterOOBCmd=function(cmd){if(cmd&&TVNC.registeredOOBCmds[cmd])delete TVNC.registeredOOBCmds[cmd]};
this.fireOOBCmd=function(cmd,data){var res=false;if(typeof TVNC.registeredOOBCmds[cmd]!="undefined"){res=true;try{TVNC.registeredOOBCmds[cmd](data,cmd==="vchannel"?_url:null)}catch(error){helper.console.log(`Cannot process this package with OOB handler: [cmd:${cmd}, data:${JSON.stringify(data)}]`,arguments)}}return res};this.registerCustomCmd=function(cmds,callback){var fnRegistered=function(cmd){if(TVNC.registeredCustomCmds[cmd]==undefined)TVNC.registeredCustomCmds[cmd]=[];TVNC.registeredCustomCmds[cmd].push(callback)};
if(cmds&&callback&&typeof callback=="function")if(cmds instanceof Array)for(var i=0;i<cmds.length;i++)fnRegistered(cmds[i]);else fnRegistered(cmds)};this.unregisterCustomCmd=function(cmds,callback){var fnUnregistered=function(cmd){if(TVNC.registeredCustomCmds[cmd])for(var i=TVNC.registeredCustomCmds[cmd].length-1;i>=0;i--)if(TVNC.registeredCustomCmds[cmd][i]==callback)TVNC.registeredCustomCmds[cmd].splice(i,1)};if(cmds&&callback&&typeof callback=="function")if(cmds instanceof Array)for(var j=0;j<
cmds.length;j++)fnUnregistered(cmds[j]);else fnUnregistered(cmds)};this.registerCustomDataType=function(dataType,handler){if(handler instanceof Function)TVNC.registeredCustomDataTypes[dataType]=handler};this.unregisterCustomDataType=function(dataType){if(TVNC.registeredCustomDataTypes[dataType])delete TVNC.registeredCustomDataTypes[dataType]};TVNC.registeredCustomDataTypes[7]=function(){};this.fireCustomEvents=function(cmd,obj){if(cmd&&TVNC.registeredCustomCmds[cmd])for(var i=0;i<TVNC.registeredCustomCmds[cmd].length;i++)try{TVNC.registeredCustomCmds[cmd][i](obj)}catch(error){}};
this.fireCustomEvents=function(cmd,obj){if(cmd&&TVNC.registeredCustomCmds[cmd])for(var i=0;i<TVNC.registeredCustomCmds[cmd].length;i++)try{TVNC.registeredCustomCmds[cmd][i](obj)}catch(error){}};this.drawCmdFillRect=function(cmd,context){var isXOR=cmd.pm&&cmd.pm==14;var isBSHollow=cmd.bs&&cmd.bs==1;if(isXOR){context.save();try{var imgdata=null;try{imgdata=context.getImageData(cmd.x,cmd.y,cmd.w,cmd.h)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
imgdata=context.getImageData(cmd.x,cmd.y,cmd.w,cmd.h)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(imgdata){var data=imgdata.data;var canPaint=true;var x,y=0,offset=0,r,g,b,pixel,color;for(y=0;y<cmd.h;y++)for(x=0;x<cmd.w;x++,offset+=4){canPaint=!isBSHollow||(y==0||y==cmd.h-1)||(x==0||x==cmd.w-1);if(canPaint){if(isXOR){r=4294967295&imgdata.data[offset];g=4294967295&imgdata.data[offset+1];b=4294967295&imgdata.data[offset+2];pixel=r<<16&16777215|g<<8&16777215|b;color=this.doROP(6,
pixel,4294967295&cmd.clr)}else color=4294967295&cmd.clr;this.setPixel(data,offset,color)}}context.putImageData(imgdata,cmd.x,cmd.y)}}finally{context.globalCompositeOperation="source-over";context.restore()}}else{context.fillStyle=this.toRGB(cmd.clr);if(cmd.pm&&cmd.pm==14)context.globalCompositeOperation="xor";context.fillRect(cmd.x,cmd.y,cmd.w,cmd.h);context.globalCompositeOperation="source-over"}};this.drawCmdLineTo=function(cmd,context){context.save();try{if(cmd.cw&&cmd.ch){context.beginPath();
context.rect(cmd.cl,cmd.ct,cmd.cw,cmd.ch);context.clip()}var isHorizOrVert=false;var lineW=1,lineH=1;if(cmd.ey-cmd.y==0){isHorizOrVert=true;lineW=cmd.w;if(lineW==0)lineW=1}if(cmd.ex-cmd.x==0){isHorizOrVert=true;lineH=cmd.w;if(lineH==0)lineH=1}var isXOR=cmd.o&&cmd.o==7;var isNOT=cmd.o&&cmd.o==6;if(isHorizOrVert&&isXOR){var ox=Math.min(cmd.ex,cmd.x);var oy=Math.min(cmd.ey,cmd.y);cmd.cx=Math.abs(cmd.ex-cmd.x)+lineW;cmd.cy=Math.abs(cmd.ey-cmd.y)+lineH;var imgdata=null;try{imgdata=context.getImageData(ox,
oy,cmd.cx,cmd.cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imgdata=context.getImageData(ox,oy,cmd.cx,cmd.cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(imgdata){var data=imgdata.data;var x,y=0,offset=0,r,g,b,pixel,color;for(y=0;y<cmd.cy;y++)for(x=0;x<cmd.cx;x++,offset+=4){if(isXOR||isNOT){r=4294967295&imgdata.data[offset];g=4294967295&imgdata.data[offset+
1];b=4294967295&imgdata.data[offset+2];pixel=r<<16&16777215|g<<8&16777215|b;if(isXOR)color=this.doROP(6,pixel,4294967295&cmd.fg);else color=this.doROP(3,pixel,4294967295)}else color=4294967295&cmd.fg;this.setPixel(data,offset,color)}context.putImageData(imgdata,ox,oy)}}else{if(cmd.ey-cmd.y==0){cmd.y+=.5;cmd.ey+=.5}if(cmd.ex-cmd.x==0){cmd.x+=.5;cmd.ex+=.5}context.beginPath();if(isXOR||isNOT)context.globalCompositeOperation="xor";context.moveTo(cmd.x,cmd.y);context.lineTo(cmd.ex,cmd.ey);context.lineWidth=
cmd.w;if(isNOT)context.strokeStyle=this.toRGB(4294967295);else context.strokeStyle=this.toRGB(cmd.fg);context.stroke()}}finally{context.globalCompositeOperation="source-over";context.restore()}};this.drawCmdScreenBlt=function(cmd,canvas,context){var imagedata=null;try{imagedata=context.getImageData(cmd.sx,cmd.sy,cmd.cx,cmd.cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
imagedata=context.getImageData(cmd.sx,cmd.sy,cmd.cx,cmd.cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(imagedata)context.putImageData(imagedata,cmd.x,cmd.y)};this.drawCmdScreenBltSlower=function(cmd,canvas,context){var buffer=document.createElement("canvas");buffer.width=cmd.cx;buffer.height=cmd.cy;buffer.getContext("2d",{willReadFrequently:true}).drawImage(canvas,-cmd.sx,-cmd.sy);context.drawImage(buffer,cmd.x,cmd.y)};this.getKeyFromCmd=function(group,qidx){return padZero(group,
3).concat(padZero(qidx,5))};this.drawCmdDrawEdge=function(cmd,context){cmd.ex=cmd.x+cmd.w;cmd.ey=cmd.y+cmd.h;var borderStyles={BDR_RAISEDOUTER:1,BDR_SUNKENOUTER:2,BDR_RAISEDINNER:4,BDR_SUNKENINNER:8,BDR_OUTER:3,BDR_INNER:12,BDR_RAISED:5,BDR_SUNKEN:10};var edge={EDGE_RAISED:borderStyles.BDR_RAISEDOUTER|borderStyles.BDR_RAISEDINNER,EDGE_SUNKEN:borderStyles.BDR_SUNKENOUTER|borderStyles.BDR_SUNKENINNER,EDGE_ETCHED:borderStyles.BDR_SUNKENOUTER|borderStyles.BDR_RAISEDINNER,EDGE_BUMP:borderStyles.BDR_RAISEDOUTER|
borderStyles.BDR_SUNKENINNER};var borderFlags={BF_LEFT:1,BF_TOP:2,BF_RIGHT:4,BF_BOTTOM:8,BF_DIAGONAL:16,BF_MIDDLE:2048,BF_SOFT:4096,BF_ADJUST:8192,BF_FLAT:16384,BF_MONO:32768};var borderFlag={BF_TOPLEFT:borderFlags.BF_TOP|borderFlags.BF_LEFT,BF_TOPRIGHT:borderFlags.BF_TOP|borderFlags.BF_RIGHT,BF_BOTTOMLEFT:borderFlags.BF_BOTTOM|borderFlags.BF_LEFT,BF_BOTTOMRIGHT:borderFlags.BF_BOTTOM|borderFlags.BF_RIGHT,BF_RECT:borderFlags.BF_TOP|borderFlags.BF_LEFT|borderFlags.BF_BOTTOM|borderFlags.BF_RIGHT,BF_DIAGONAL_ENDTOPRIGHT:borderFlags.BF_DIAGONAL|
borderFlags.BF_TOP|borderFlags.BF_RIGHT,BF_DIAGONAL_ENDTOPLEFT:borderFlags.BF_DIAGONAL|borderFlags.BF_TOP|borderFlags.BF_LEFT,BF_DIAGONAL_ENDBOTTOMLEFT:borderFlags.BF_DIAGONAL|borderFlags.BF_BOTTOM|borderFlags.BF_LEFT,BF_DIAGONAL_ENDBOTTOMRIGHT:borderFlags.BF_DIAGONAL|borderFlags.BF_BOTTOM|borderFlags.BF_RIGHT};context.save();if(cmd.pm&&cmd.pm==14)context.globalCompositeOperation="xor";context.lineWidth=cmd.pw;context.strokestyle=this.toRGB(cmd.clr);if(cmd.e==edge.EDGE_SUNKEN&&cmd.f&borderFlags.BF_SOFT==
borderFlags.BF_SOFT);if(cmd.e==edge.EDGE_RAISED&&cmd.f&borderFlags.BF_SOFT==borderFlags.BF_SOFT);if(cmd.f&borderFlags.BF_TOP==borderFlags.BF_TOP){context.beginPath();context.moveTo(cmd.x,cmd.y);context.lineTo(cmd.ex,cmd.y);context.stroke()}if(cmd.f&borderFlags.BF_LEFT==borderFlags.BF_LEFT){context.beginPath();context.moveTo(cmd.x,cmd.y);context.lineTo(cmd.x,cmd.ey);context.stroke()}if(cmd.f&borderFlags.BF_BOTTOM==borderFlags.BF_BOTTOM){context.beginPath();context.moveTo(cmd.x,cmd.ey);context.lineTo(cmd.ex,
cmd.ey);context.stroke()}if(cmd.f&borderFlags.BF_RIGHT==borderFlags.BF_RIGHT){context.beginPath();context.moveTo(cmd.ex,cmd.y);context.lineTo(cmd.ex,cmd.ey);context.stroke()}context.globalCompositeOperation="source-over";context.restore()};this.deferCall=function(item,f,params){if(!TVNC.resumeItem){TVNC.imgQueue.watchdogStop();TVNC.imgQueue.watchdogStart();TVNC.resumeItem=item;var df=function(){f.apply(null,params)};if(TVNC.deferCallBySetTimeout)setTimeout(df,1);else TVNC.resumeProcess=df}};this.executeDeferred=
function(){if(TVNC.imgQueue)TVNC.imgQueue.watchdogStop();if(!TVNC.deferCallBySetTimeout&&TVNC.resumeProcess){var rp=TVNC.resumeProcess;TVNC.resumeProcess=null;TVNC.resumeItem=null;rp()}};this.processDrawCmds=function(root,win,canvas,context){var oriContext=context;TVNC.processNextScreenEnabled=false;if(win.idx){if(!cmdCache)cmdCache=new Array(1E5);if(win.cmds){for(i=0;i<win.cmds.length;i++){var cmd=win.cmds[i];cmdCache[cmd.z]=clone(cmd)}win.cmds.splice(0,win.cmds.length)}for(i=0;i<win.idx.length;i++){var cmd=
cmdCache[win.idx[i]];win.cmds.push(clone(cmd))}}if(win.cmds){var cmd,i,img,item,sx,sy;for(i=0;i<win.cmds.length;i++){if(TVNC.offscreenCanvas)context=TVNC.offscreenCanvas.getContext("2d",{willReadFrequently:true});else context=oriContext;cmd=win.cmds[i];if(cmd.processed)continue;cmd.processed=true;if(typeof cmd.z!="undefined"){var idx=cmd.z;if(!cmdCache)cmdCache=new Array(1E5);if(typeof cmd.c=="undefined"){win.cmds[i]=clone(cmdCache[idx]);cmd=win.cmds[i]}else cmdCache[idx]=clone(cmd)}if(TVNC.enableCmdCache){for(var p in cmd)if(cmd[p]!==
""&&cmd[p]!=null)TVNC.cmdCacheProps[p]=cmd[p];else if(typeof TVNC.cmdCacheProps[p]!="undefined")delete TVNC.cmdCacheProps[p];win.cmds[i]=TVNC.cmdCacheProps;cmd=clone(TVNC.cmdCacheProps);if(typeof cmd.originalValues!="undefined"){for(var q in cmd.originalValues)TVNC.cmdCacheProps[q]=cmd.originalValues[q];delete TVNC.cmdCacheProps.originalValues;delete cmd.originalValues}}if(cmd.c=="IC"){if(typeof cmd.qidx!="undefined"&&cmd.qidx>=0&&typeof root.imgQueue!="undefined"){item=TVNC.peekImageItem(root,cmd.qidx);
if(!item)continue;if(!item.ready||!item.image||!item.image.data){win.cmds[i].processed=false;TVNC.deferCall(win.cmds[i],TVNC.processDrawCmds,[root,win,canvas,context]);return}TVNC.setToImageCache(TVNC.extractImageItem(root,cmd.qidx),cmd.k)}else{item=TVNC.getFromImageCache(cmd.k);if(!item)continue}if(!item||!item.ready){logError("Cache: image "+cmd.k+" is not loaded, qidx: "+cmd.qidx);continue}if(typeof cmd.x=="undefined")continue;sx=0,sy=0;if(typeof cmd.sx!="undefined"){sx=cmd.sx;sy=cmd.sy}if(typeof cmd.o==
"undefined"||cmd.o==12)try{item.draw(context,cmd.x,cmd.y,cmd.cx,cmd.cy,sx,sy,cmd.cx,cmd.cy)}catch(err){logError("error in item.draw():"+cmd.k+",sx:"+sx+",sy:"+sy+",cmd.x:"+cmd.x+",cmd.y:"+cmd.y+",cmd.cx:"+cmd.cx+",cmd.cy:"+cmd.cy+",img.width:"+item.getWidth()+",img.height:"+item.getHeight())}else{var auxCanvas=document.createElement("canvas");auxCanvas.width=item.getWidth();auxCanvas.height=item.getHeight();var auxContext=auxCanvas.getContext("2d",{willReadFrequently:true});try{item.draw(auxContext,
0,0)}catch(err){logError("error on auxContext.drawImage")}var auxImageData=null;try{auxImageData=auxContext.getImageData(sx,sy,cmd.cx,cmd.cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");auxImageData=auxContext.getImageData(sx,sy,cmd.cx,cmd.cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}var imagedata=null;try{imagedata=context.getImageData(cmd.x,
cmd.y,cmd.cx,cmd.cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imagedata=context.getImageData(cmd.x,cmd.y,cmd.cx,cmd.cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(auxImageData&&imagedata)TVNC.rop3Canvas(context,cmd,imagedata,auxImageData)}}else if(cmd.c=="IP"){var sx=0,sy=0;if(typeof cmd.sx!="undefined"){sx=cmd.sx;sy=cmd.sy}item=TVNC.peekImageItem(root,
cmd.qidx);if(!item)continue;if(!item.ready){win.cmds[i].processed=false;TVNC.deferCall(win.cmds[i],TVNC.processDrawCmds,[root,win,canvas,context]);return}try{item.draw(context,cmd.x,cmd.y,cmd.cx,cmd.cy,sx,sy,cmd.cx,cmd.cy)}catch(ex){logError("IP: item.draw() failed. cmd.qidx="+cmd.qidx);if(item)logError("size: "+item.getWidth()+"x"+item.getHeight())}TVNC.returnImageItem(TVNC.extractImageItem(root,cmd.qidx))}else if(cmd.c=="CB"){if(TVNC.brushCache[cmd.idx])TVNC.returnImageItem(TVNC.brushCache[cmd.idx]);
item=TVNC.extractImageItem(root,cmd.qidx);if(!item){logError("pattern cache update error; item missing");continue}TVNC.brushCache[cmd.idx]=item}else if(cmd.c=="FR")TVNC.drawCmdFillRect(cmd,context);else if(cmd.c=="PB"){var auxCanvas=document.createElement("canvas");auxCanvas.width=cmd.cx;auxCanvas.height=cmd.cy;var auxContext=auxCanvas.getContext("2d",{willReadFrequently:true});cmd.fc&=16777215;cmd.bc&=16777215;var normalProcess=true;if(cmd.bs==0){auxContext.fillStyle=TVNC.toRGB(cmd.fc);auxContext.fillRect(0,
0,cmd.cx,cmd.cy)}else{if(cmd.cidx>=0)item=TVNC.brushCache[cmd.cidx];else item=TVNC.extractImageItem(root,cmd.qidx);if(typeof item!="undefined")if(typeof item.image.data.complete=="undefined"||item.image.data.complete==true){var ptrn=auxContext.createPattern(item.image.data,"repeat");auxContext.fillStyle=ptrn;auxContext.fillRect(0,0,cmd.cx,cmd.cy)}else{normalProcess=false;TVNC.delayProcessImagePattern(auxContext,item,cmd)}else helper.console.log("pattern missing, or empty image",arguments)}if(normalProcess){var auxImageData=
auxContext.getImageData(0,0,cmd.cx,cmd.cy);var imagedata=context.getImageData(cmd.x,cmd.y,cmd.cx,cmd.cy);if(auxImageData&&imagedata)TVNC.rop3Canvas(context,cmd,imagedata,auxImageData)}}else if(cmd.c=="SB")TVNC.drawCmdScreenBlt(cmd,canvas,context);else if(cmd.c=="LI")TVNC.drawCmdLineTo(cmd,context);else if(cmd.c=="PL"){if(cmd.p.length>0){var n;var px=cmd.p[0].x;var py=cmd.p[0].y;var cx;var cy;var vertical=false;var horizontal=false;for(n=1;n<cmd.p.length;n++){cx=cmd.p[n].x;cy=cmd.p[n].y;if(cx-px==
0){if(!vertical)cmd.p[n-1].x+=.5;vertical=true;cmd.p[n].x+=.5}else vertical=false;if(cy-py==0){if(!horizontal)cmd.p[n-1].y+=.5;horizontal=true;cmd.p[n].y+=.5}else horizontal=false;px=cx;py=cy}context.save();if(cmd.cw&&cmd.ch){context.beginPath();context.rect(cmd.cl,cmd.ct,cmd.cw,cmd.ch);context.clip()}if(cmd.pm&&cmd.pm==14)context.globalCompositeOperation="xor";context.beginPath();context.moveTo(cmd.p[0].x,cmd.p[0].y);for(n=1;n<cmd.p.length;n++)context.lineTo(cmd.p[n].x,cmd.p[n].y);context.lineWidth=
cmd.w;context.strokeStyle=TVNC.toRGB(cmd.fg);context.stroke();context.globalCompositeOperation="source-over";context.restore()}}else if(cmd.c=="DE")TVNC.drawCmdDrawEdge(cmd,context);else if(cmd.c=="CR"){context.save();if(cmd.r.length==0){context.beginPath();context.rect(0,0,0,0);context.clip()}else{context.beginPath();for(n=0;n<cmd.r.length;n++){var r=cmd.r[n];context.rect(r.x,r.y,r.cx,r.cy)}context.clip()}}else if(cmd.c=="ER"){var canvasid="canvasER";TVNC.canvasER=document.getElementById(canvasid);
if(!TVNC.canvasER){TVNC.canvasER=document.createElement("canvas");TVNC.canvasER.style.zIndex=TVNC.baseZIndex+499;TVNC.canvasER.style.position="absolute";TVNC.canvasER.style.left="0px";TVNC.canvasER.style.top="0px";TVNC.canvasER.id=canvasid;TVNC.vncContainer.appendChild(TVNC.canvasER)}addValidCanvas(TVNC.canvasER);TVNC.canvasER.width=TVNC.rcParams.viewWidth;TVNC.canvasER.height=TVNC.rcParams.viewHeight;var auxContext=TVNC.canvasER.getContext("2d",{willReadFrequently:true});auxContext.restore();auxContext.clearRect(0,
0,TVNC.canvasER.offsetWidth,TVNC.canvasER.offsetHeight);auxContext.fillStyle=canvas.parentElement.mask.color;for(n=0;n<cmd.r.length;n++){var r=cmd.r[n];auxContext.fillRect(r.x,r.y,r.cx,r.cy)}}else if(cmd.c=="EA"){BTP_PRA_SRT=null;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onExecRemoteApp==null)$(window).trigger("execRemoteApp",[cmd]);else TVNC.rcParams.events.onExecRemoteApp([cmd])}else if(cmd.c=="EX"){BTP_PRA_STS=null;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onExecResult==
null)$(window).trigger("execResult",[cmd]);else TVNC.rcParams.events.onExecResult([cmd])}else if(cmd.c=="TX")try{TVNC.putRdpText(cmd,context)}catch(err){logError(err)}else if(cmd.c=="FC")TVNC.cacheFont(cmd);else if(cmd.c=="DB")TVNC.dstblt(context,cmd.o,0,cmd.x,cmd.y,cmd.cx,cmd.cy);else if(cmd.c=="OB")TVNC.CreateOffscreenBitmap(cmd.id,cmd.cx,cmd.cy,cmd.dlist);else if(cmd.c=="SS")TVNC.SwitchSurface(cmd.id);else if(cmd.c=="MO"){if(!cmd.sx)cmd.sx=0;if(!cmd.sy)cmd.sy=0;TVNC.MembltOffscreen(oriContext,
cmd.o,cmd.id,cmd.x,cmd.y,cmd.cx,cmd.cy,cmd.sx,cmd.sy)}else if(cmd.c=="RC")if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onRemoteCommand==null)$(window).trigger("remoteCommand",[cmd.r]);else TVNC.rcParams.events.onRemoteCommand(cmd.r);else if(cmd.c=="FD"){var mime="";if(typeof cmd.mime!="undefined")mime=cmd.mime;var fileName=cmd.fn;if(typeof cmd.url!="undefined")fileName=cmd.url;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onFileDownload==null)$(window).trigger("fileDownload",
[fileName,mime]);else TVNC.rcParams.events.onFileDownload([fileName],mime)}else if(cmd.c=="DS"){let m=cmd.m;helper.console.log(`incoming "DS" command: ${JSON.stringify(cmd)}`,arguments);if(!m)m=[{id:_displayManager.mainDisplayId,w:cmd.w,h:cmd.h,hwnd:win.hwnd}];for(let i=0,t=m.length;i<t;i++){let wnd=m[i];_displayManager.processDisplayCmd(cmd.c,wnd.id,wnd.w,wnd.h,win.hwnd,wnd.x,wnd.y)}if(window!=window.top&&typeof TVNC.rcParams.events!="undefined"&&helper.object.validate(TVNC.rcParams.events.onDesktopResize))TVNC.rcParams.events.onDesktopResize(cmd.m)}else if(cmd.c==
"PR")TVNC.processPrint(cmd);else if(cmd.c=="LE"){BTP_PCL_ERR=null;try{helper.console.log(helper.string.format("Logon Error - code: {0}, data: {1}, description: {2}",cmd.ec,cmd.d,cmd.s),arguments)}catch(error){helper.console.warning("Cannot log 'LogonError'",error,arguments)}}else if(cmd.c=="CU"){_CUEnabled=true;item=TVNC.peekImageItem(root,cmd.qidx);if(!item)continue;if(!item.ready){win.cmds[0].processed=false;TVNC.deferCall(win.cmds[0],TVNC.processDrawCmds,[root,win,canvas,context]);return}if(item.image.data){let dx=
item.image.data.width-cmd.hx;let dy=item.image.data.height-cmd.hy;_displayManager.fireEvent("setCursor",{"src":item.image.data,"x":dx,"y":dy,"url":`url(${item.image.data.srcImage||item.image.data.src}) ${dx} ${dy}, auto`})}}else if(typeof TVNC.registeredDrawCmds[cmd.c]!="undefined")TVNC.registeredDrawCmds[cmd.c](cmd,win,context)}}TVNC.processImages(root,win,oriContext)};this.delayProcessImagePattern=function(ctx,item,cmd){helper.console.log("delayProcessImagePattern on image idx: "+item.idx,arguments);
var iCount=0;var createPattern=function(ctx,item,cmd){var ptrn=ctx.createPattern(item.image.data,"repeat");ctx.fillStyle=ptrn;ctx.fillRect(0,0,cmd.cx,cmd.cy);var auxImageData=ctx.getImageData(0,0,cmd.cx,cmd.cy);var imagedata=ctx.getImageData(cmd.x,cmd.y,cmd.cx,cmd.cy);if(auxImageData&&imagedata)TVNC.rop3Canvas(ctx,cmd,imagedata,auxImageData)};var processImagePattern=function(){if(iCount<5){if(typeof item.image.data.complete=="undefined"||item.image.data.complete==true)createPattern(ctx,item,cmd);
else setTimeout(function(){processImagePattern()},25);iCount++}else helper.console.log("cannot load this image: "+item.idx+" ,is not completed",arguments)};processImagePattern()};this.CreateOffscreenBitmap=function(id,cx,cy,dlist){if(this.offscreenCache[id])delete this.offscreenCache[id];var canvas=document.createElement("canvas");canvas.visibility="visible";canvas.display="block";canvas.style.position="absolute";canvas.style.left=-cx;canvas.style.top=-cy;canvas.style.zIndex=-1;canvas.width=cx;canvas.height=
cy;this.offscreenCache[id]=canvas;for(var i=0;i<dlist.length;i++)if(this.offscreenCache[dlist[i]]){delete this.offscreenCache[dlist[i]];this.offscreenCache[dlist[i]]=null}};this.SwitchSurface=function(id){if(id==65535)this.offscreenCanvas=null;else this.offscreenCanvas=this.offscreenCache[id]};this.MembltOffscreen=function(context,o,id,x,y,cx,cy,sx,sy){var srcContext=this.offscreenCache[id].getContext("2d",{willReadFrequently:true});var srcImageData=srcContext.getImageData(sx,sy,cx,cy);context.putImageData(srcImageData,
x,y)};this.clearOffscreenCache=function(){for(var i=0;i<this.offscreenCache.length;i++){if(this.offscreenCache[i])delete this.offscreenCache[i];this.offscreenCache[i]=null}};this.dstblt=function(context,rop,srccolor,x,y,cx,cy){var imagedata=null;try{imagedata=context.getImageData(x,y,cx,cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imagedata=context.getImageData(x,
y,cx,cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(imagedata){var data=imagedata.data;var offset=0;for(var line=0;line<cy;line++)for(var col=0;col<cx;col++,offset+=4){var color=srccolor;if(rop!=12){var r=4294967295&data[offset];var g=4294967295&data[offset+1];var b=4294967295&data[offset+2];var pixel=r<<16&16777215|g<<8&16777215|b;color=this.doROP(rop,color,pixel)}data[offset]=color>>16&255;data[offset+1]=color>>8&255;data[offset+2]=color&255}imagedata.data=data;context.putImageData(imagedata,
x,y)}};this.revokeImageUrl=function(){var d=((new Date).getTime()-4*1E3).toString();for(var k in _blob.processedScreenUrl)if(k<=d){for(var i=0;i<_blob.processedScreenUrl[k].length;i++)_urlCreator.revokeObjectURL(_blob.processedScreenUrl[k][i]);delete _blob.processedScreenUrl[k]}else break};this.addRevokeObjectURL=function(items){if(!_blob.revoked){var bUrls=[];var d=(new Date).getTime();for(var k in items)if(items[k]&&items[k].image&&items[k].image.data&&items[k].image.data.blobImage&&!items[k].image.data.mouseImage)bUrls.push(items[k].image.data.srcImage||
items[k].image.data.src);if(bUrls.length>0){if(!_blob.processedScreenUrl[d])_blob.processedScreenUrl[d]=[];_blob.processedScreenUrl[d].push.apply(_blob.processedScreenUrl[d],bUrls)}}};this.addRevokeStringURL=function(src){if(!_blob.revoked)if(src!=""){var bUrls=[src];var d=(new Date).getTime();if(!_blob.processedScreenUrl[d])_blob.processedScreenUrl[d]=[];_blob.processedScreenUrl[d].push.apply(_blob.processedScreenUrl[d],bUrls)}};this.removeUsedItems=function(imgQueue){if(_usedImgQueueItems&&_usedImgQueueItems.length>
0&&imgQueue){for(var i=0;i<_usedImgQueueItems.length;i++)delete imgQueue[_usedImgQueueItems[i]];_usedImgQueueItems=[]}};this.processNextScreen=function(){if(!TVNC.imagesLoading&&TVNC.processNextScreenEnabled&&TVNC.msgQueue.length>0){var m=TVNC.msgQueue.shift();TVNC.receiveScreen(m);TVNC.revokeImageUrl();if(m.imgQueue){TVNC.addRevokeObjectURL(m.imgQueue.items);TVNC.removeUsedItems(m.imgQueue.items)}}};this.incImagesLoading=function(){TVNC.imagesLoading++};this.decImagesLoading=function(){TVNC.imagesLoading--};
this.noImagesLoading=function(){return TVNC.imagesLoading==0};this.preserveOriginalValue=function(obj,prop,localCache){if(typeof localCache!="undefined"&&typeof localCache[prop]!="undefined"&&typeof obj[prop]=="undefined")obj[prop]=localCache[prop];if(typeof obj.originalValues=="undefined")obj.originalValues={};if(typeof obj[prop]=="undefined")obj[prop]=TVNC.cmdCacheProps[prop];else if(typeof localCache!="undefined")localCache[prop]=obj[prop];obj.originalValues[prop]=obj[prop]};function imgQueueItemFromImageDecoderData(u8Array,
type,hash,key){var e=this.encoded;e.width=u8Array[0]|u8Array[1]<<8;e.height=u8Array[2]|u8Array[3]<<8;e.bpp=u8Array[4];e.decoder=u8Array[5];e.option1=u8Array[6];e.option2=u8Array[7];e.offset=u8Array.buffer.byteLength-u8Array.length+8;e.size=u8Array.buffer.byteLength-e.offset;e.data=u8Array.buffer;TVNC.InsertIntoImgQueueAndExecute(key,this)}function imgQueueItemFromImageArray(u8Array,type,hash,key){var cacheEnabled=hash.length&&TVNC.fs;var insertAndExecute=true;if(u8Array.length){this.encoded.data=
TVNC.u8ArrayToDataUri("image/"+type,u8Array);if(cacheEnabled)TVNC.fs.write(hash,this.encoded.data)}else if(cacheEnabled){insertAndExecute=false;var imgItem=this;TVNC.fs.read(hash,function(stream){imgItem.encoded.data=stream;TVNC.InsertIntoImgQueueAndExecute(key,imgItem)})}if(insertAndExecute)TVNC.InsertIntoImgQueueAndExecute(key,this)}function imgQueueItemFromLegacyStringData(stringBinaryData,type,hash,key){var cacheEnabled=hash.length&&TVNC.fs;var insertAndExecute=true;if(stringBinaryData.length){this.encoded.data=
TVNC.getImageStreamFromTB64(type,window.btoa(stringBinaryData));if(cacheEnabled)TVNC.fs.write(hash,this.encoded.data)}else if(cacheEnabled){insertAndExecute=false;var imgItem=this;TVNC.fs.read(hash,function(stream){imgItem.encoded.data=stream;TVNC.InsertIntoImgQueueAndExecute(key,imgItem)})}if(insertAndExecute)TVNC.InsertIntoImgQueueAndExecute(key,this)}function drawImgQueueItem(context,x,y,w,h,sx,sy,sw,sh){if(!this.image.data){if(!sw||!sh){logError("drawImgQueueItem(): image of type "+this.image.type+
", sw and sh are null for idx # "+this.idx+", error: "+this.error);return}this.drawError(context,"#800080","#FFFFFF",x,y,sw,sh);return}if(this.image.type=="img"){if(!w)w=this.getWidth();if(!h)h=this.getHeight();if(sx!=null&&sy!=null){if(!sw)sw=w;if(!sh)sh=h;context.drawImage(this.image.data,sx,sy,sw,sh,x,y,w,h)}else context.drawImage(this.image.data,x,y,w,h)}else if(this.image.type=="canvas")if(sx!=null&&sy!=null){if(!sw)sw=this.getWidth();if(!sh)sh=this.getHeight();context.putImageData(this.image.data,
x-sx,y-sy,sx,sy,sw,sh)}else context.putImageData(this.image.data,x,y);else{logError("drawImgQueueItem(): unknown image->type for idx # "+this.idx+", error: "+this.error);return}}function drawDummyImgQueueItem(context,fillStyle,strokeStyle,x,y,w,h){context.fillStyle=fillStyle;context.strokeStyle=strokeStyle;w-=1;h-=1;context.beginPath();context.rect(x,y,w,h);context.moveTo(x,y);context.lineTo(x+w,y+h);context.moveTo(x,y+h);context.lineTo(x+w,y);context.closePath();context.fill();context.stroke()}function getImgQueueItemWidth(){if(!this.image.data)return this.encoded.width;
return this.image.data.width}function getImgQueueItemHeight(){if(!this.image.data)return this.encoded.height;return this.image.data.height}function purgeImgQueueItemEncoded(){var e=this.encoded;e.width=0;e.height=0;e.decoder=0;e.option1=0;e.option2=0;e.bpp=0;e.offset=0;e.size=0;e.data=null}function purgeImgQueueItemImage(){delete this.image.data;this.image.data=null;this.image.type=null;this.ready=false;this.error=0}function purgeImgQueueItemAll(){this.purgeEncoded();this.purgeImage()}function imgQueueItemLoadFailed(error){this.purgeAll();
this.ready=true;this.error=error?error:255;TVNC.executeDeferred()}function imgQueueItemLoadSucceeded(){this.purgeEncoded();this.ready=true;this.error=0;TVNC.executeDeferred()}function imgQueueItemSetImg(loadedCallback,errorCallback,src){this.purgeImage();this.image.type="img";this.image.data=document.createElement("img");this.image.data.detachEvents=function(){this.onload=null;this.onerror=null;this.onabort=null};this.image.data.onload=function(e){if(typeof e.target.complete=="undefined"||e.target.complete==
true){this.detachEvents();loadedCallback(e)}else{helper.console.log("Image data is not completed but it is loaded.",arguments);var maxTimes=10;var countTimes=0;function retryLoadImage(){setTimeout(function(){if(countTimes>maxTimes){helper.console.log("Cannot process this image.",arguments);return}else if(typeof e.target.complete=="undefined"||e.target.complete==true){this.detachEvents();loadedCallback(e)}else retryLoadImage();countTimes++},50)}}};this.image.data.onerror=function(e){this.detachEvents();
errorCallback(e)};this.image.data.onabort=function(e){this.detachEvents();errorCallback(e)};this.image.data.blobImage=src.substr(0,4)=="blob";this.image.data.srcImage=src;this.image.data.src=src}function imgQueueItemSetCanvas(context,arData){if(this.image.type!="canvas"||!this.image.data||this.image.width!=this.encoded.width||this.image.height!=this.encoded.height){this.purgeImage();this.image.type="canvas";this.image.data=context.createImageData(this.encoded.width,this.encoded.height)}this.image.data.data.set(new Uint8ClampedArray(arData))}
this.getImageItem=function(){return TVNC.createImgQueueItem()};this.returnImageItem=function(item){item.purgeEncoded();if(_blob.on)TVNC.addRevokeObjectURL({0:item});item=null};this.createImgQueueItem=function(){return{ready:false,error:0,image:{type:null,data:null},encoded:{width:0,height:0,decoder:0,option1:0,option2:0,bpp:0,offset:0,size:0,data:null},fromImageDecoderData:imgQueueItemFromImageDecoderData,fromImageArray:imgQueueItemFromImageArray,fromLegacyStringData:imgQueueItemFromLegacyStringData,
draw:drawImgQueueItem,drawError:drawDummyImgQueueItem,getWidth:getImgQueueItemWidth,getHeight:getImgQueueItemHeight,purgeEncoded:purgeImgQueueItemEncoded,purgeImage:purgeImgQueueItemImage,purgeAll:purgeImgQueueItemAll,loadFailed:imgQueueItemLoadFailed,loadSucceeded:imgQueueItemLoadSucceeded,setImg:imgQueueItemSetImg,setCanvas:imgQueueItemSetCanvas}};this.getImageStreamFromTB64=function(imageType,imageBase64){return"data:image/"+imageType+";base64,"+imageBase64};this.buildImgQueue=function(msg){try{var w,
win,c,cmds,cmd,i,currCmd,localCache={};msg.group=0;if(msg.windows)for(w=0;w<msg.windows.length;w++){win=msg.windows[w];if(win.cmds){cmds=win.cmds;if(typeof TVNC.cmdCacheProps["c"]!="undefined")currCmd=TVNC.cmdCacheProps["c"];for(i=0;i<cmds.length;i++){cmd=cmds[i];if(typeof cmd.c!="undefined")currCmd=cmd.c;if(currCmd=="IC"||currCmd=="IP"||currCmd=="CB"||currCmd=="PB")if(TVNC.fs||typeof cmd.d!="undefined"&&cmd.d!=="")this.addToImgQueue(msg.imgQueue,cmd,"c",localCache);else cmd.qidx=-1}}if(win.imgs){imgs=
win.imgs;for(i=0;i<imgs.length;i++){img=imgs[i];this.addToImgQueue(msg.imgQueue,img,"i")}}}}catch(e){logError("buildImgQueue error: "+e.message)}};this.addToImgQueue=function(imgQueue,oJS,srcType,localCache){oJS.qidx=++TVNC.imgIndex%99999;var idx=TVNC.getKeyFromCmd(0,oJS.qidx);if(imgQueue.items[idx])delete imgQueue.items[idx];var item=TVNC.getImageItem();var processImgItem=true;if(srcType=="c"){this.preserveOriginalValue(oJS,"t",localCache);var cacheEnabled=oJS.hash&&oJS.hash.length&&TVNC.fs;if(oJS.d.length){if(cacheEnabled)TVNC.fs.write(oJS.hash,
"data:image/"+oJS.t+";base64,"+oJS.d)}else if(cacheEnabled){processImgItem=false;TVNC.fs.read(oJS.hash,function(stream){item.encoded.data=stream;item.idx=idx;delete oJS.d;delete oJS.t;imgQueue.items[idx]=item;TVNC.processImgQueueItem(item)})}if(processImgItem)item.encoded.data="data:image/"+oJS.t+";base64,"+oJS.d}else{item.encoded.data=oJS.img;delete oJS.img}if(processImgItem){delete oJS.d;delete oJS.t;item.idx=idx;imgQueue.items[idx]=item;TVNC.processImgQueueItem(item)}};this.InsertIntoImgQueueAndExecute=
function(idx,item){if(TVNC.imgQueue.items&&TVNC.imgQueue.items[idx])delete TVNC.imgQueue.items[idx];item["idx"]=idx;TVNC.imgQueue.items[idx]=item;TVNC.imgQueue.count++;this.processImgQueueItem(item)};this.addToImgQueueAndExecute=function(imgQueue,item){var i=imgQueue.items.length;item["idx"]=i;imgQueue.items.push(item);this.processImgQueueItem(item);return i};this.processImgQueueItem=function(item){var decoderFunc=TVNC.getImageDecoder(item.encoded.decoder);if(!decoderFunc){logError("raw decoder "+
item.encoded.decoder+" not found for image key "+item.idx);item.loadFailed()}else decoderFunc(item)};this.processImgQueue=function(imgQueue){if(!imgQueue.items)return;for(var i=0;i<imgQueue.items.length;i++)this.processImgQueueItem(imgQueue,imgQueue.items[i])};this.registerImageDecoder=function(id,fnc){if(!TVNC.imageDecoders)TVNC.imageDecoders=[];TVNC.imageDecoders[id]=fnc};this.getImageDecoder=function(id){if(!TVNC.imageDecoders)return null;return TVNC.imageDecoders[id]};this.registerImageDecoder(0,
function(item){item.setImg(function(){item.loadSucceeded();TVNC.processNextScreen()},function(){item.loadFailed();logError("image # "+item.idx+" with errors")},item.encoded.data)});this.registerRawBinaryHandler=function(idList,fnc){if(!TVNC.rawBinaryHandlers)TVNC.rawBinaryHandlers=[];for(var i=0;i<idList.length;++i)TVNC.rawBinaryHandlers[idList[i]]=fnc};function getRawBinaryHandler(hid,opt1,opt2){if(!TVNC.rawBinaryHandlers)return null;if(!hid)hid=0;if(!opt1)opt1=0;if(!opt2)opt2=0;var id=(hid&255)<<
16|(opt1&255)<<8|opt2&255;return TVNC.rawBinaryHandlers[id]}this.extractImageItem=function(root,qidx){var id=TVNC.getKeyFromCmd(root.group,qidx);var item=root.imgQueue.items[id];_usedImgQueueItems.push(id);return item};this.peekImageItem=function(root,qidx){return root.imgQueue?root.imgQueue.items[TVNC.getKeyFromCmd(root.group,qidx)]:null};this.processImages=function(root,win,context){if(typeof win.imgs!=="undefined"){var imgpart,item;for(var i=0;i<win.imgs.length;i++){imgpart=win.imgs[i];if(imgpart.processed)continue;
imgpart.processed=true;if(!root.imgQueue){logError("Error on processImages: root.imgQueue not found.");return}item=TVNC.peekImageItem(root,imgpart.qidx);if(!item)continue;if(!item.ready){imgpart.processed=false;TVNC.deferCall(imgpart,TVNC.processImages,[root,win,context]);return}else try{if(win.hwnd==0)if(TVNC.rcParams.overrideCursor){if(typeof item.image.data!="undefined"&&item.image.data!=null){var mx=agentInfo.isMobile?window.devicePixelRatio:environment.xZoom/100/environment.currentDevicePixelRatio;
_displayManager.fireEvent("setCursor",{"src":item.image.data,"x":imgpart.x,"y":imgpart.y,"url":`url(${item.image.data.srcImage||item.image.data.src}) ${win.dx*mx-imgpart.x} ${win.dy*mx-imgpart.y}, auto`})}if(_blob.on&&item.image.data.blobImage){if(_blob.processedMouseUrl.length>16)_urlCreator.revokeObjectURL(_blob.processedMouseUrl.shift());_blob.processedMouseUrl.push(item.image.data.srcImage||item.image.data.src);delete root.imgQueue.items[item.idx]}else TVNC.returnImageItem(TVNC.extractImageItem(root,
imgpart.qidx))}else{_displayManager.fireEvent("drawCursor",item,imgpart,{async:0});TVNC.returnImageItem(TVNC.extractImageItem(root,imgpart.qidx))}else{item.draw(context,imgpart.x,imgpart.y);TVNC.returnImageItem(TVNC.extractImageItem(root,imgpart.qidx))}}catch(ex){logError("Error on processImages: "+ex.message)}}}if(TVNC.useBufferedCanvas)helper.animationFrame.request(function(){win.realcanvas.getContext("2d",{willReadFrequently:true}).drawImage(context.canvas,0,0)});TVNC.processWindows(root)};this.processLayerInfo=
function(root,win,div,context){if(win.layerinfo){div.layerinfo=null;if(win.layerinfo.flags)div.layerinfo=clone(win.layerinfo)}if(div.layerinfo){if((div.layerinfo.flags&2)==2){div.style.opacity=div.layerinfo.alpha/255;div.style.MozOpacity=div.layerinfo.alpha/255;div.style.filter="alpha(opacity="+div.layerinfo.alpha/2.55+")"}if((div.layerinfo.flags&1)==1&&context.canvas.width>0&&context.canvas.height>0){var color=div.layerinfo.crkey;var key={r:color>>16&255,g:color>>8&255,b:color&255};var d=10;var frame=
context.getImageData(0,0,context.canvas.width,context.canvas.height);for(var j=0;j<frame.data.length;j+=4){var r=frame.data[j];var g=frame.data[j+1];var b=frame.data[j+2];if(key.r-d<=r&&r<key.r+d&&key.g-d<=g&&g<key.g+d&&key.b-d<=b&&b<key.b+d)frame.data[j+3]=0}context.putImageData(frame,0,0)}}};this.processWindows=function(obj,success){if(success)obj.success=success;if(obj.nextWindow>=obj.windows.length)obj.success();else{var win=obj.windows[obj.nextWindow];obj.nextWindow++;TVNC.processWindow(obj,
win)}};this.processWindow=function(root,win){if(typeof win.hwnd=="undefined"){setTimeout(TVNC.reload,1);return}var canvasid=productId+"_canvas_"+win.hwnd;var canvas=document.getElementById(canvasid);if(_blob.on&&win.hwnd=="0"&&win.imgs&&win.imgs.length)for(var i=0;i<win.imgs.length;i++){var k=TVNC.getKeyFromCmd(root.group,win.imgs[i].qidx);if(helper.object.existsPath(root.imgQueue.items[k],"image.data"))root.imgQueue.items[k].image.data.mouseImage=true}if(!canvas&&win.hwnd!==0)canvas=this.createCanvas(win);
if(typeof win.className!="undefined")canvas.className=win.className;var realcanvas=canvas.canvas;if(!realcanvas)return;var context=realcanvas.getContext("2d",{willReadFrequently:true});var vw=helper.object.validate(win.width);if(win.hwnd==0){if(_blob.on&&win.imgs&&win.imgs.length)for(var i=0;i<win.imgs.length;i++){var k=TVNC.getKeyFromCmd(root.group,win.imgs[i].qidx);if(helper.object.existsPath(root.imgQueue.items[k],"image.data"))root.imgQueue.items[k].image.data.mouseImage=true}_displayManager.fireEvent("setCursor",
win)}else{var canvasid=productId+"_canvas_"+win.hwnd;var canvas=document.getElementById(canvasid);var realcanvas=null;var context=null;if(!canvas)canvas=this.createCanvas(win);if(typeof win.className!="undefined")canvas.className=win.className;realcanvas=canvas.canvas;if(!realcanvas)return;context=realcanvas.getContext("2d",{willReadFrequently:true});var vw=helper.object.validate(win.width);if(win.width==0||win.height==0){canvas.style.visibility="hidden";canvas.style.display="none";TVNC.fireCustomEvents("canvasHidden",
win);if(productId==="virtualui")if(win.hwnd!=0&&TVNC.rcParams?.events?.onReleaseCanvas)TVNC.rcParams.events.onReleaseCanvas(win)}else{if(helper.object.validate(win.left)&&(win.width==canvas.width&&win.height==canvas.height||canvas.width*canvas.height==0)){canvas.style.left=win.left-TVNC.rcParams.viewLeft+"px";canvas.style.top=win.top-TVNC.rcParams.viewTop+"px"}if(vw&&(win.width!=canvas.width||win.height!=canvas.height)||canvas.resizing)if(canvas.width*canvas.height==0){canvas.width=win.width;canvas.height=
win.height;canvas.style.width=win.width+"px";canvas.style.height=win.height+"px";realcanvas.width=win.width;realcanvas.height=win.height;realcanvas.style.width=win.width+"px";realcanvas.style.height=win.height+"px"}else if(helper.object.validate(TVNC.rcParams.events.onCanvasResize))if(TVNC.rcParams.events.onCanvasResize(win,canvas))TVNC.updateCanvasSize(canvas,win.left-TVNC.rcParams.viewLeft,win.top-TVNC.rcParams.viewTop,win.width,win.height);else canvas.resizing=true;else TVNC.updateCanvasSize(canvas,
win.left-TVNC.rcParams.viewLeft,win.top-TVNC.rcParams.viewTop,win.width,win.height);if(vw){if(productId!="virtualui")canvas.style.display="block";TVNC.fireCustomEvents("canvasShow",win);canvas.style.visibility="visible"}canvas.style.zIndex=this.baseZIndex+win.zidx*10}}if(typeof TVNC.rcParams.events!="undefined"&&helper.object.validate(TVNC.rcParams.events.onProcessWindow))TVNC.rcParams.events.onProcessWindow(root,win,canvas);if(TVNC.useBufferedCanvas){if(!realcanvas.bufferedCanvas){realcanvas.bufferedCanvas=
document.createElement("canvas");realcanvas.bufferedCanvas.width=realcanvas.width;realcanvas.bufferedCanvas.height=realcanvas.height}var bufferedContext=realcanvas.bufferedCanvas.getContext("2d",{willReadFrequently:true});win.realcanvas=realcanvas;TVNC.partialAnimationFrameUpdate(function(){TVNC.processDrawCmds(root,win,realcanvas,bufferedContext);TVNC.processLayerInfo(root,win,canvas,context);context=null})}else TVNC.partialAnimationFrameUpdate(function(){TVNC.processDrawCmds(root,win,realcanvas,
context);if(canvas)TVNC.processLayerInfo(root,win,canvas,context);context=null});if(!this.rcParams.cursorVisible)_displayManager.fireEvent("hideCursor");else if(TVNC.rcParams.overrideCursor)_displayManager.fireEvent("resetCursor");if(agentInfo.isIOS&&agentInfo.iosVersion<=7&&win.hwnd==0)_displayManager.fireEvent("setCursor","visible")};this.updateCanvasSize=function(canvas,newLeft,newTop,newWidth,newHeight){var imagedata=null;var realcanvas=canvas.canvas;canvas.resizing=false;var context=realcanvas.getContext("2d",
{willReadFrequently:true});if(realcanvas.width<newWidth||realcanvas.height<newHeight){try{imagedata=context.getImageData(0,0,realcanvas.width,realcanvas.height)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imagedata=context.getImageData(0,0,newWidth,newHeight)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}realcanvas.width=newWidth;realcanvas.height=
newHeight;realcanvas.style.width=newWidth+"px";realcanvas.style.height=newHeight+"px";if(imagedata)context.putImageData(imagedata,0,0);else if(canvas.hwnd!==0){context.fillStyle="#CCC";context.fillRect(0,0,newWidth,newHeight)}}canvas.width=newWidth;canvas.height=newHeight;if(!isNaN(newLeft))canvas.style.left=newLeft+"px";if(!isNaN(newTop))canvas.style.top=newTop+"px";canvas.style.width=newWidth+"px";canvas.style.height=newHeight+"px";var hwnd=canvas.hwnd!=undefined&&canvas.hwnd==0?canvas.hwnd:canvas.id.indexOf("_0")!=
-1?0:1;if(productId=="thinrdp"&&hwnd==1){TVNC.vncdiv.style.width=TVNC.vncContainer.style.width=newWidth+"px";TVNC.vncdiv.style.height=TVNC.vncContainer.style.height=newHeight+"px"}imagedata=null};this.processControls=function(div,canvas){return};this.newPrintDialog=function(obj){try{if(printDialog==null)printDialog=createPrintDialog();if(!printDialog){if(typeof obj.progress=="undefined"||!obj.progress)TVNC.openPrnWindow({"url":obj.url,"title":obj.title,"obj":obj},true);return}if(helper.object.existsPath(self,
"clientSettings.PrintDialog")){if(helper.object.existsPath(self.clientSettings.PrintDialog,"DefaultMethod"))printDialog.defaultPrintMethod=self.clientSettings.PrintDialog.DefaultMethod;if(helper.object.existsPath(self.clientSettings.PrintDialog,"BypassDialog"))printDialog.bypassPrintDialog=self.clientSettings.PrintDialog.BypassDialog}var fUrl=obj.url;if(_url.httpConnection!==""){var surl=_url.httpConnection.split("/");var i=surl.length-1;var vp="";while(i>=0&&vp===""){if(surl[i]!==""){vp=surl[i];
i=0}i--}fUrl=helper.url.parseUrl(_url.httpConnection+obj.url.replace(vp,"")).toUrl()}printDialog.setDocument(fUrl,obj.title,obj.preview,obj.progress,TVNC.rcParams.events.onPrintHandler)}catch(error){if(typeof obj.progress=="undefined"||!obj.progress)TVNC.openPrnWindow({"url":obj.url,"title":obj.title,"obj":obj},true)}};this.processPrint=function(obj){var base=cookiePrefix==="VNC"?helper.url.parseUrl(location.href).toUrl("-vp-o"):_url.baseUrl;var url=base+obj.file.substring(1)+"?SID="+TVNC.rcParams.id;
if(TVNC.runInPublicServer&&window.top!=window)url="https://www.thinvnc.net"+url;obj.url=url;if(typeof TVNC.rcParams.events==="undefined"||!TVNC.rcParams.events.onFileReady)TVNC.newPrintDialog(obj);else TVNC.rcParams.events.onFileReady({"url":url,"title":obj.title,"obj":obj})};this.getProtocol=function(){var proto=TVNC.rcParams.protocol?TVNC.rcParams.protocol:window.location.protocol;return proto.toLowerCase()};this.getAjaxUrl=function(){var url="";var baseUrl="";url=TVNC.rcParams.server?TVNC.getProtocol()+
"//"+TVNC.rcParams.server:"";baseUrl=_url.baseUrl;var paths=baseUrl.substr(0,baseUrl.length-2).split("/");if(paths.length>2){url+="/"+paths[1];baseUrl=baseUrl.substr(baseUrl.indexOf("/",1))}if(TVNC.gatewayAccessKey!="")if(url.indexOf("/"+TVNC.gatewayAccessKey)<0)url+="/"+TVNC.gatewayAccessKey;url+=(baseUrl[0]!=="/"?"/":"")+baseUrl;return url};this.getCrossDomainDataType=function(){return _defaultResponseType};this.getCrossDomainUrl=function(url){return url};this.sendAck=function(){if(TVNC.rcParams.clientAck>
0)_comm.wsSend("cmd=ready")};this.sendXoff=function(){if(!TVNC.xoff&&TVNC.rcParams.xoffEnabled){helper.console.warning("***********************",arguments);helper.console.warning("SENDING XOFF CMD !!!!!!",arguments);helper.console.warning("***********************",arguments);_comm.wsSend("cmd=xoff");TVNC.xoff=true}};this.sendXon=function(){if(TVNC.xoff&&TVNC.rcParams.xoffEnabled){helper.console.warning("***********************",arguments);helper.console.warning("SENDING XON CMD !!!!!!!",arguments);
helper.console.warning("***********************",arguments);_comm.wsSend("cmd=xon");TVNC.xoff=false}};this.sendPostAjaxCmd=function(query,data){_comm.post({"url":_url.httpConnection+"cmd?"+query,"data":data})};this.sendServerCmd=function(cmd,query){if(allowSendingCommands)if(_comm.protocol===Thinfinity.Communication.protocol.AJAX){if(TVNC.rcParams.id)_comm.send(TVNC.completeAjaxParams({"queueName":this.queueRequestName,"url":_url.httpConnection+cmd+"?"+query+"&id="+this.rcParams.id,"dataType":_defaultResponseType,
"success":TVNC.serverCmdResult,"error":function(msg,xhr){TVNC.throwErrorConnection(msg,xhr)}}))}else _comm.wsSend(query+"&id="+this.rcParams.id)};this.receiveScreen=function(obj){if(!helper.object.validate(obj)||obj.status==2){setTimeout(TVNC.reload,1);return}if(obj.status==4){if(typeof obj.cmd!="undefined"&&obj.cmd=="openLinkDlg")if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onOpenLink==null)$(window).trigger("OpenLink",obj);else TVNC.rcParams.events.onOpenLink(obj);else{TVNC.processPrint(obj);
setTimeout(TVNC.reload,1)}return}if(obj.status==9){BTP_PRA_END=null;TVNC.disconnect();BTP_PS_END1=null;TVNC.dispose();return}if(helper.object.validate(obj.caret)){var fEvent=TVNC.caretX!=obj.caret.x||TVNC.caretY!=obj.caret.y;TVNC.caretX=obj.caret.x;TVNC.caretY=obj.caret.y;if(fEvent)TVNC.fireCustomEvents("updateCaretPosition",{"x":TVNC.caretX,"y":TVNC.caretY})}if(typeof obj.windows!="undefined"){obj.nextWindow=0;TVNC.processWindows(obj,function(){for(var i=TVNC.vncContainer.childNodes.length-1;i>=
0;i--){var elem=TVNC.vncContainer.childNodes[i];if(!elem)break;else if(_validCanvas.indexOf(elem)!==-1)continue;else if(elem.tagName=="CANVAS"||elem.tagName=="DIV"&&elem.id.match(/.*_canvas.*/)){var found=false;if(_CUEnabled&&elem.id==productId+"_canvas_0")found=true;for(j=0;j<obj.windows.length&&!found;j++){var canvasid=productId+"_canvas_"+obj.windows[j].hwnd;if(elem.id==canvasid||(elem.id==productId+"_canvasborder"+obj.windows[j].hwnd||cookiePrefix==="RDP"&&elem.id!==productId+"_canvas_0"))found=
true}if(elem==TVNC.canvasER)found=true;if(!found){elem.style.display="none";var hwnd=elem.id.replace(productId+"_canvas_","");if(hwnd!=0)TVNC.fireCustomEvents("canvasHidden",{"hwnd":hwnd});if(elem.mask){delete elem.mask;elem.mask=null}if(typeof TVNC.rcParams.events!="undefined"&&helper.object.validate(TVNC.rcParams.events.onDeleteWindow))TVNC.rcParams.events.onDeleteWindow(elem);elem.innerHTML="";try{TVNC.vncContainer.removeChild(elem)}catch(err){elem.innerHTML="";elem.style.display="none";logError("receiveScreen: "+
err)}elem=null}}}TVNC.processNextScreenEnabled=true;setTimeout(function(){TVNC.processNextScreen()},0)})}if(helper.object.validate(obj.sound))for(i=0;i<obj.sound.length;i++){var chunk=obj.sound[i].chunk;TVNC.sound.play(null,window.atob(unescape(chunk)))}if(!TVNC.rcParams.remotePointer&&!TVNC.rcParams.mouseControl&&!TVNC.rcParams.overrideCursor)_displayManager.fireEvent("setCursor","default");if(TVNC.rcParams.mouseControl&&!TVNC.rcParams.remotePointer&&helper.object.validate(obj.cursor))if(obj.cursor.shape!=
undefined)_displayManager.fireEvent("setCursor",obj.cursor.shape);TVNC.zoomDesktop();if(obj.status==3)if(productId=="thinrdp"&&TVNC.useAjax==true)TVNC.disconnect();else setTimeout(TVNC.reconnect,1);else if(TVNC.rcParams.active)setTimeout(TVNC.reload,1);if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onScreenReceived==null)$(window).trigger("screenReceived",obj);else TVNC.rcParams.events.onScreenReceived(obj)};function resetLastError(){oLastError.message=null;oLastError.code=null;
oLastError.date=null}this.throwErrorConnection=function(oError,xhr){errorOccurs++;clearTimeout(oLastError.timeoutId);var msg=helper.object.validate(oError)?typeof oError.message!="undefined"?oError.message:oError:"";if(errorOccurs>5){oLastError.timeoutId=setTimeout(function(){resetLastError()},oLastError.elapsedTime);if(oError!=""){oLastError.date=new Date;oLastError.message=msg;oLastError.code=typeof oError.code!="undefined"?oError.code:""}try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerError==
null)$(window).trigger("serverError",oError);else TVNC.rcParams.events.onServerError(oError);helper.console.log("'serverError' disconnecting. "+msg,arguments)}catch(error){helper.console.warning("'serverError' disconnecting. message: "+error.message,error,arguments)}TVNC.disconnect();return}else{helper.console.log("'serverError' reconnecting... "+msg,arguments);if(xhr&&xhr.status===Thinfinity.Communication.errorCode.NOT_FOUND)_comm.forceReconnect();else{_comm.restart(Thinfinity.Communication.protocol.AJAX);
TVNC.reset();TVNC.reconnect()}return}};this.stopCheckingConnectionLost=function(obj){return false};this.serverCmdResult=function(data){if(Object.startObserve)Object.startObserve();if(agentInfo.isMobile)_displayManager.fireEvent("setCursor","block");var obj=null;if(TVNC.useAjax&&!TVNC.crossDomain())obj=typeof data!="object"?JSON.parse(data):data;else obj=data;if(typeof obj=="undefined"){helper.console.error(consts.appProfileMissing+", "+consts.technicalSupport,{},arguments);obj={}}if(typeof obj.id==
"undefined")return;if(typeof obj.clipboardEnabled!="undefined"){TVNC.rcParams.clipboard=obj.clipboardEnabled;if(["ZSC"].indexOf(window.cookiePrefix)!=-1)TVNC.rcParams.synchronizeClipboard=false;else TVNC.rcParams.synchronizeClipboard=window?.customSettings?.synchronizeClipboard??window?.clientSettings?.SynchronizeClipboard??true;TVNC.rcParams.clipboardFileTransfer=obj.clipboardFileTransferEnabled||false;_displayManager.fireEvent("localEvent",{cmd:"sessionstatus",data});_preventKeys.available=["thinrdp"].indexOf(productId)!==
-1&&TVNC.rcParams.clipboard}TVNC.rcParams.sound=obj.soundEnabled;if(TVNC.rcParams.sound&&!_audioDriver){_audioDriver=new Thinfinity.Driver.Audio({methods:{sendCmd:this.sendCmd}});_packetReceiver.registerHandler(2,_audioDriver.play)}if(productId==="thinvnc"&&obj.cmd=="sessionStatus")_displayManager.processDisplayCmd("DS",0,obj.viewWidth,obj.viewHeight,null,0,0);let oData=null;let oError={message:"",code:0};if(typeof data.errormsg==="object"){oData=data.errormsg;oError={...oError,...oData}}oError.message=
(oData?.msg??obj.errormsg)||(typeof obj.errmsg!="undefined"?obj.errmsg:typeof obj.errstr!="undefined"?obj.errstr:"");oError.code=oData?.code||obj.rc||obj.code||obj.errno||0;if(obj.id==0){let resetLastError=function(){clearTimeout(oLastError.timeoutId);oLastError.timeoutId=setTimeout(function(){resetLastError()},oLastError.elapsedTime);if(oError!=""&&typeof oError.code!="undefined"){oLastError.date=new Date;oLastError.message=oError.message;oLastError.code=oError.code}};BTP_PS_ERR=null;if(!(oData&&
(oData.code!="undefined"||oError.code==-1))){helper.console.warning(`The connection has ended with errors: id: ${obj.id}, code: ${oError.code}, message: ${oError.message}, Session has ended: true`,arguments);_isSessionEnded=true;_comm.wsClose();resetLastError()}else _comm.reset();try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerError==null)$(window).trigger("serverError",oError);else TVNC.rcParams.events.onServerError(oError)}catch(error){helper.console.warning("'serverError' calling attached method fail. Message: "+
error.message,error,arguments)}if(helper.object.existsPath(oError,"code")&&ENUM_CODES.authenticationCodeErrors.indexOf(oError.code.toString())!=-1){if(oError.message!="")helper.console.warning(oError.message);if(window.environment.supportsFullScreen&&window.environment.isFullscreen)window.environment.exitFullscreen(false);if(Object.stopObserve)Object.stopObserve()}else;if(_isSessionEnded)_comm.dispose();return}else if(obj.cmd=="sessionStatus"&&oError.message=="Not authenticated"){TVNC.throwErrorConnection(oError,
{"status":0});return}else if(obj.cmd=="reconnectionAttempt"){if(typeof TVNC.rcParams.events==="undefined"||TVNC.rcParams.events.onReconnectionAttempt===null)$(window).trigger("onReconnectionAttempt",[obj]);else TVNC.rcParams.events.onReconnectionAttempt(obj);return}if(obj.id=="##"){TVNC.disconnect();return}if(obj.id=="!!"){if(obj.cmd==="wakeonlan"){if(_comm.protocol===Thinfinity.Communication.protocol.WEBSOCKET)_comm.wsWOL(true);if(_fromBroker)keepHTTPAlive(true);if(typeof TVNC.rcParams.events===
"undefined"||TVNC.rcParams.events.onWakeOnLan===null)$(window).trigger("wakeOnLan",[obj]);else TVNC.rcParams.events.onWakeOnLan(obj)}else if(obj.cmd==="waitforvm"){if(_comm.protocol===Thinfinity.Communication.protocol.WEBSOCKET)_comm.wsWOL(true);if(_fromBroker)keepHTTPAlive(true);if(typeof TVNC.rcParams.events==="undefined"||TVNC.rcParams.events.onWakeForVM===null)$(window).trigger("waitForVM",[obj]);else TVNC.rcParams.events.onWaitForVM(obj)}else if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerCommandEvent==
null)$(window).trigger("serverCmdResult",[obj]);else TVNC.rcParams.events.onServerCommandEvent(obj);return}else if(_comm.protocol===Thinfinity.Communication.protocol.WEBSOCKET)_comm.wsWOL(false);serverDPR.enabled=helper.object.existsPath(obj,"smartZoom")?helper.object.convertTo(obj.smartZoom,"boolean"):false;var rcActive=TVNC.rcParams.active;TVNC.rcParams.active=typeof obj.active!="undefined"?obj.active:TVNC.rcParams.active;TVNC.rcParams.monitor=typeof obj.monitor!="undefined"?obj.monitor:TVNC.rcParams.monitor;
TVNC.rcParams.monitorCount=typeof obj.monitorCount!="undefined"?obj.monitorCount:TVNC.rcParams.monitorCount;TVNC.rcParams.viewLeft=typeof obj.viewLeft!="undefined"?obj.viewLeft:TVNC.rcParams.viewLeft;TVNC.rcParams.viewTop=typeof obj.viewTop!="undefined"?obj.viewTop:TVNC.rcParams.viewTop;TVNC.rcParams.viewWidth=typeof obj.viewWidth!="undefined"?obj.viewWidth:TVNC.rcParams.viewWidth;TVNC.rcParams.viewHeight=typeof obj.viewHeight!="undefined"?obj.viewHeight:TVNC.rcParams.viewHeight;TVNC.rcParams.rfxEnabled=
typeof obj.rfxEnabled!="undefined"?obj.rfxEnabled:false;if(productId=="virtualui"){if(TVNC.vncContainer.parentElement)if(agentInfo.isMobile&&(agentInfo.isIOS&&agentInfo.ipadModel>=3||agentInfo.isMSIE)){TVNC.vncContainer.parentElement.style.width=Math.min(environment.rawWidth,TVNC.rcParams.viewWidth)+"px";TVNC.vncContainer.parentElement.style.height=Math.min(environment.rawHeight,TVNC.rcParams.viewHeight)+"px"}else{TVNC.vncContainer.parentElement.style.width=TVNC.rcParams.viewWidth+"px";TVNC.vncContainer.parentElement.style.height=
TVNC.rcParams.viewHeight+"px"}}else if((typeof obj.viewHeight!="undefined"||typeof obj.viewWidth!="undefined")&&typeof TVNC.rcParams.events!="undefined"&&helper.object.validate(TVNC.rcParams.events.onDesktopResize))TVNC.rcParams.events.onDesktopResize(TVNC.rcParams.viewWidth,TVNC.rcParams.viewHeight);TVNC.rcParams.mouseControl=typeof obj.mouseControl!="undefined"?obj.mouseControl:TVNC.rcParams.mouseControl;TVNC.rcParams.touchControl=typeof obj.touchControl!="undefined"?obj.touchControl:TVNC.rcParams.touchControl;
if(productId==="thinvnc")TVNC.rcParams.serverControlMouse=!TVNC.rcParams.mouseControl;TVNC.rcParams.kbdControl=typeof obj.kbdControl!="undefined"?obj.kbdControl:TVNC.rcParams.kbdControl;TVNC.rcParams.kbdUnicode=typeof obj.kbdUnicode!="undefined"?obj.kbdUnicode:TVNC.rcParams.kbdUnicode;TVNC.rcParams.showOnStart=typeof obj.showOnStart!="undefined"?obj.showOnStart:TVNC.rcParams.showOnStart;TVNC.rcParams.UBRWID=typeof obj.UBRWID!="undefined"?obj.UBRWID:TVNC.rcParams.UBRWID;if(obj.scraper!=null){TVNC.rcParams.scraper=
typeof obj.scraper!="undefined"?obj.scraper:TVNC.rcParams.scraper;if(obj.scraperArgs!=null)TVNC.rcParams.scraperArgs=typeof obj.scraperArgs!="undefined"?obj.scraperArgs:TVNC.rcParams.scraperArgs}TVNC.rcParams.quality=typeof obj.quality!="undefined"?obj.quality:TVNC.rcParams.quality;TVNC.rcParams.imageQuality=typeof obj.imageQuality!="undefined"?obj.imageQuality:TVNC.rcParams.imageQuality;TVNC.rcParams.wallpaper=typeof obj.wallpaper!="undefined"?obj.wallpaper:TVNC.rcParams.wallpaper;TVNC.rcParams.pixelFormat=
typeof obj.pixelFormat!="undefined"?obj.pixelFormat:TVNC.rcParams.pixelFormat;TVNC.rcParams.grayscale=typeof obj.grayscale!="undefined"?obj.grayscale:TVNC.rcParams.grayscale;if(typeof obj.remotePointer!="undefined"&&!obj.remotePointer)TVNC.rcParams.remotePointer=obj.remotePointer;TVNC.rcParams.imageMethod=typeof obj.imageMethod!="undefined"?obj.imageMethod:TVNC.rcParams.imageMethod;if(typeof obj.imageList!="undefined")if(obj.imageList=="json")TVNC.imageListType=0;else if(obj.imageList=="text")TVNC.imageListType=
1;else if(obj.imageList=="binary")TVNC.imageListType=2;TVNC.rcParams.fitmode=typeof obj.quality!="undefined"?obj.fitmode:TVNC.rcParams.fitmode;var fitResolutionMode="";switch(TVNC.rcParams.fitmode){case 1:fitToBrowser=false;fitResolutionMode="fixed";break;case 2:fitResolutionMode="fittoscreen";break;case 0:default:fitResolutionMode="fittobrowser";TVNC.rcParams.fitToBrowser=true;break}TVNC.rcParams.fitToBrowser=fitResolutionMode!="fittobrowser"?false:true;TVNC.rcParams.resolution=fitResolutionMode;
if(TVNC.savedMaxWidth==0||TVNC.rcParams.maxWidth==0)if(!agentInfo.isMobile)TVNC.rcParams.maxWidth=window.environment.rawWidth||screen.width;else if(productId=="virtualui")TVNC.rcParams.maxWidth=window.environment.currentWidth||screen.height;else TVNC.rcParams.maxWidth=window.environment.rawWidth||screen.width;if(TVNC.savedMaxHeight==0||TVNC.rcParams.maxHeight==0)if(!agentInfo.isMobile)TVNC.rcParams.maxHeight=window.environment.rawHeight||screen.height;else if(productId=="virtualui")TVNC.rcParams.maxHeight=
window.environment.currentHeight||screen.height;else TVNC.rcParams.maxHeight=window.environment.rawHeight||screen.height;if(obj.accessKey)TVNC.gatewayAccessKey=obj.accessKey;TVNC.savedMaxWidth=TVNC.rcParams.maxWidth;TVNC.savedMaxHeight=TVNC.rcParams.maxHeight;var version=parseInt(obj.version||0,10);if(version>=2)mouseBuffer.isAvailable=true;else mouseBuffer.isAvailable=false;if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl)if(mouseBuffer.isAvailable==true)TVNC.sendMouseQueue();else TVNC.sendMouseMove();
if(TVNC.rcParams.fitmode==0||TVNC.rcParams.fitToBrowser==true)if(typeof obj.dpr!="undefined"){var zoomBottomLimit=1;if(obj.dpr!=window.environment.currentDevicePixelRatio||TVNC.usedDPR!=window.environment.currentDevicePixelRatio||window.environment.currentOrientation!=serverCmdResultOrientation){serverCmdResultOrientation=window.environment.currentOrientation;window.environment.currentDevicePixelRatio=obj.dpr>0?obj.dpr:1;TVNC.usedDPR=window.environment.currentDevicePixelRatio;if(typeof obj.marginLeft!=
"undefined")window.environment.margin.left=obj.marginLeft;if(typeof obj.marginTop!="undefined")window.environment.margin.top=obj.marginTop;if(typeof obj.marginRight!="undefined")window.environment.margin.right=obj.marginRight;if(typeof obj.marginBottom!="undefined")window.environment.margin.bottom=obj.marginBottom;if(typeof obj.fullscreen!="undefined")window.environment.fullScreenAvailable=true;TVNC.savedMaxWidth=TVNC.rcParams.maxWidth;TVNC.savedMaxHeight=TVNC.rcParams.maxHeight;zoomBottomLimit=1/
window.environment.currentDevicePixelRatio;if(agentInfo.isMobile==true){if(productId!="ZSC"){adjustMainSize();TVNC.zoomFactor=zoomBottomLimit;zoom(zoomBottomLimit)}window.scrollTo(0,0)}else{screenHeight=environment.detectedHeight;screenWidth=environment.detectedWidth;if(serverDPR.enabled)serverDPR.originalValue=obj.dpr;if(productId==="virtualui")zoomBottomLimit=1;if(TVNC.zoomFactor!=zoomBottomLimit)TVNC.zoomDesktop(zoomBottomLimit);TVNC.rcParams.maxWidth=Math.round(screenWidth/zoomBottomLimit);TVNC.rcParams.maxHeight=
Math.round(screenHeight/zoomBottomLimit)}}}else if(serverDPR.enabled==false)window.environment.fixDevicePixelRatio();if(agentInfo.isMobile==true&&productId=="thinrdp"&&helper.object.validate(obj.reconnectOnResize))restartOnOrientationChange=obj.reconnectOnResize;if(TVNC.startPending)setTimeout(TVNC.start,1);if(helper.object.existsPath(self,"clientSettings.OverrideCursor"))TVNC.overrideCursor=self.clientSettings.OverrideCursor;if(helper.object.existsPath(self,"clientSettings.MousePressAsRightButton"))TVNC.rcParams.mousePressAsRightButton=
self.clientSettings.MousePressAsRightButton;if(rcActive!=obj.active){if(obj.active){TVNC.hookKM();TVNC.reload();syncCookies(startCookiesSync);if(cookiePrefix!="FMX")stopSyncCookies();BTP_PS_STR=null;if(typeof TVNC.rcParams.asyncCopy!=="undefined")_displayManager.fireEvent("asyncCopy",TVNC.rcParams.asyncCopy);_getServerUrl.retriesCount=_connectResult.count=0;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onSessionStart==null)$(window).trigger("sessionStart",obj);else TVNC.rcParams.events.onSessionStart(obj);
initializeComponents(data);if(cookiePrefix!=="VNC"&&agentInfo.isMobile)TVNC.rcParams.scaled=false}else{BTP_PS_STP=null;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onSessionStop==null)$(window).trigger("sessionStop",obj);else TVNC.rcParams.events.onSessionStop(obj)}if(obj.isShadowSession!==true)_displayManager.preserveConfiguration=true}TVNC.observable.isOTURLSession=obj.isOTURLSession;_displayManager.fireEvent("localEvent",{cmd:"serverCmdResult",obj});if(typeof TVNC.rcParams.events==
"undefined"||TVNC.rcParams.events.onServerCommandResult==null)$(window).trigger("onServerCommandResult",obj);else TVNC.rcParams.events.onServerCommandResult(obj);if(productId.toLowerCase()=="virtualui"){let scrollPoint=document.getElementById(TVNC.vncdivId+"_ScrollPoint");if(scrollPoint)helper.style.addClass(scrollPoint,`top:${TVNC.rcParams.viewHeight}px;left:${TVNC.rcParams.viewWidth}px`);else if(TVNC.vncdiv)helper.dom.appendJsonElement({parentElement:TVNC.vncdiv,type:"DIV",attributes:{id:TVNC.vncdivId+
"_ScrollPoint",style:`height:1px;width:1px;backgroundColor:transparent;position:absolute;top:${TVNC.rcParams.viewHeight}px;left:${TVNC.rcParams.viewWidth}px;zIndex:-1;`}})}TVNC.sendCmd("cmd=started")};this.sendCmd=function(query){return TVNC.sendServerCmd("cmd",query)};this.setMouseControl=function(value){TVNC.sendCmd("cmd=params&mouseControl="+value+"&kbdControl="+!TVNC.rcParams.kbdControl+"&touchControl="+!TVNC.rcParams.touchControl)};this.setQuality=function(value){TVNC.sendCmd("cmd=params&quality="+
value)};this.setimageMethod=function(value){TVNC.sendCmd("cmd=params&imageMethod="+value)};this.setGrayscale=function(value){TVNC.sendCmd("cmd=params&grayscale="+value)};this.setKbdControl=function(value){TVNC.sendCmd("cmd=params&kbdControl="+value)};this.setRemotePointer=function(value){TVNC.sendCmd("cmd=params&remotePointer="+value)};this.setPixelFormat=function(value){TVNC.sendCmd("cmd=params&pixelFormat="+value)};this.setMonitor=function(m){if(m>=this.rcParams.monitorCount)m=0;TVNC.sendCmd("cmd=params&monitor="+
m)};this.revokeObjectURLs=function(){if(_blob.on&&!_blob.revoked){if(_blob.processedMouseUrl)for(var i=0;i<_blob.processedMouseUrl.length;i++)_urlCreator.revokeObjectURL(_blob.processedMouseUrl[i]);_blob.processedMouseUrl=null;if(_blob.processedScreenUrl)for(var d in _blob.processedScreenUrl)for(var i=0;i<_blob.processedScreenUrl[d].length;i++)_urlCreator.revokeObjectURL(_blob.processedScreenUrl[d][i]);_blob.processedScreenUrl=null;_blob.revoked=true}};this.disconnect=function(){_isDisconnecting=
true;if(!_comm.state<=Thinfinity.Communication.state.CLOSING){sessionStorage.removeItem(_preferredBrokerKey);let connected=_comm.state>=Thinfinity.Communication.state.CONNECTING;if(connected&&_displayManager)_displayManager.fireEvent("localEvent",{cmd:"disconnect"});keepHTTPAlive(false);if(!_isSessionEnded)try{let msg=productId!=="virtualui"?consts.thisSessionHasEnded:consts.applicationClosed;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onSessionEnd==null)$(window).trigger("sessionEnd",
msg);else TVNC.rcParams.events.onSessionEnd(msg)}catch(error){helper.console.warning("'sessionEnd' calling attached method fail. message: "+error.message,error,arguments)}if(_displayManager){_displayManager.dispose();_displayManager.preserveConfiguration=false}BTP_PS_END2=null;connection.fromReconnection=false;TVNC.closeReconnectDiv();TVNC.disposeTimeout=setTimeout(function(){if(TVNC&&TVNC.dispose)TVNC.dispose()},TVNC.disposeTimeoutValue);TVNC.removeCanvases();if(window.environment.supportsFullScreen&&
window.environment.isFullscreen)exitFullscreen();TVNC.sendCmd("cmd=disconnect");stopSyncCookies();_isSessionEnded=true;TVNC.rcParams.id=0;TVNC.sendMouseMove=function(){};clearTimeout(TVNC.emptyRecycleImgTimeout);TVNC.purgeImageQueue(TVNC.imgQueue);ID.remove();sessionStorage.removeItem("oturlDataPass");_comm.wsClose();if(_audioDriver?.dispose)_audioDriver.dispose()}};this.removeCanvases=function(){$('[id^="'+productId+'_"]').remove()};this.removeListeners=function(){$(document).unbind();$(window).unbind();
$("#"+TVNC.vncdivId).unbind()};this.dispose=function(releaseAll,status){if(productId=="virtualui"&&TVNC.vncContainer.parentElement){TVNC.vncContainer.parentElement.style.width="100%";TVNC.vncContainer.parentElement.style.height="100%"}if(Thinfinity.Popups&&Thinfinity.Popups.growl)Thinfinity.Popups.growl.unblockAll();releaseAll=releaseAll!=false?true:false;clearTimeout(TVNC.disposeTimeout);if(!TVNC.useAjax){BTP_PWS_CLS3=null;_comm.wsClose()}_comm.releaseQueue(TVNC.queueRequestName);_comm.dispose();
if(helper.object.existsPath(oLastError,"code")&&ENUM_CODES.authenticationCodeErrors.indexOf(oLastError.code.toString())!=-1)connection.state=Thinfinity.Communication.state.CLOSING;if(releaseAll)TVNC.removeListeners();try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerDisconnect==null)$(window).trigger("serverDisconnect");else{TVNC.rcParams.events.onServerDisconnect(status);if(TVNC.events){if(TVNC.rcParams.events.splice&&TVNC.rcParams.events.length)TVNC.rcParams.events.splice(0,
TVNC.rcParams.events.length);TVNC.events=null}}}catch(error){helper.console.warning("'onServerDisconnect' calling attached method fail. message: "+error.message,error,arguments)}window.dispatchEvent(new CustomEvent("onServerDisconnect"));if(releaseAll){if(_displayManager)_displayManager.dispose();if(TVNC.clipboard)TVNC.clipboard.dispose();TVNC.removeCanvases()}if(TVNC.xmlHttpJson){TVNC.xmlHttpJson.abort();TVNC.xmlHttpJson=null}TVNC.emptyRecycleImg(true);if(releaseAll)if(!!TVNC.canvasER)TVNC.canvasER=
null;TVNC.clearImageCache();TVNC.clearTextCache();TVNC.clearFontCache();TVNC.clearOffscreenCache();if(window.environment.supportsFullScreen&&window.environment.isFullscreen)exitFullscreen();TVNC.rcParams.id=0;TVNC.sendMouseMove=function(){};if(TVNC.sound){TVNC.sound.dispose();TVNC.sound=null}TVNC.clipboard=null;clearTimeout(TVNC.emptyRecycleImgTimeout);TVNC.purgeImageQueue(TVNC.imgQueue);if(TVNC.imgQueue)TVNC.imgQueue.watchdogStop();TVNC.deferCall=function(){};TVNC.imgQueue=null;setTimeout(function(){if(Object.stopObserve)Object.stopObserve()},
5E3);TVNC.revokeObjectURLs();TVNC.imageListHelper=null;if(_componentRegistrationServices)_componentRegistrationServices.dispose()};this.usingDisplayManager=function(){return(agentInfo.gfx&&TVNC.rcParams.enableGfx||agentInfo.h264&&TVNC.rcParams.enableH264)&&_displayManager};this.reset=function(){this.rcParams.maxHeight=0;this.rcParams.maxWidth=0;if(!this.usingDisplayManager())for(var i=TVNC.vncContainer.childNodes.length-1;i>=0;i--){var canvas=TVNC.vncContainer.childNodes[i];if(canvas.tagName=="CANVAS"){canvas.style.display=
"none";var hwnd=canvas.hwnd||canvas.id.replace(productId+"_canvas_","");if(hwnd!=0)TVNC.fireCustomEvents("canvasHidden",{"hwnd":hwnd});if(canvas.mask)canvas.mask={};canvas.innerHTML="";try{TVNC.vncContainer.removeChild(canvas)}catch(err){logError("receiveScreen: "+err)}canvas=null}}TVNC.emptyRecycleImg(true);_displayManager.fireEvent("resetCursor");TVNC.clearImageCache();TVNC.clearTextCache();TVNC.clearFontCache();TVNC.clearOffscreenCache()};function exitFullscreen(){var el=document;if(window.frameElement)el=
helper.url.getTopWindow(window).document;window.environment.exitFullscreen(el)}this.setFullScreen=function(active){var el=document.documentElement;if(active)window.environment.requestFullscreen(el);else window.environment.exitFullscreen(el)};this.stop=function(){TVNC.sendCmd("cmd=stop")};this.start=function(cmdv){if(TVNC.useAjax)_isPktIdxEnabled=false;this.startCmdToSend=true;BTP_PR_STR=null;TVNC.sendStart(cmdv)};this.removeBrowserSize=function(scraperArgs){return this.removeArguments(scraperArgs,
["browserheight","browserwidth","screenheight","screenwidth"])};this.removeArguments=function(queryStr,args,ignoreCase){if(queryStr&&args&&args instanceof Array){ignoreCase=typeof ignoreCase==="undefined"?true:ignoreCase;if(ignoreCase)args=args.map(function(elem){return elem.toString().toLowerCase()});var lStr="";var rStr=queryStr;var nParams="";var idx=queryStr.indexOf("?");if(idx!=-1){lStr=queryStr.substr(0,idx);rStr=queryStr.substr(idx+1)}var fElem=true;var params=rStr.split("&");params.forEach(function(elem){var kvp=
elem.split("=");if(kvp.length>0){kvp[0]=kvp[0].toString();if(ignoreCase)kvp[0]=kvp[0].toLowerCase();if(args.indexOf(kvp[0])==-1){nParams+=(fElem?"":"&")+elem;fElem=false}}else{nParams+=(fElem?"":"&")+elem;fElem=false}});var u="";if(idx!=-1)u="?";return lStr+u+nParams}};this.sendStart=function(cmdv){if(!this.cacheLoaded)return;if(!this.startCmdToSend)return;this.startPending=false;this.rcParams.active=false;var cmd="cmd=start";if(typeof cmdv!="undefined")cmd=cmdv;if(connection.fromReconnection&&productId==
"thinrdp")cmd+="&subcmd=restart";connection.fromReconnection=false;if(this.rcParams.scraper!=null){cmd=cmd+"&scraper="+this.rcParams.scraper;if(this.rcParams.scraperArgs!=null){var scraperArgs=helper.object.getDataTypeOf(this.rcParams.scraperArgs)=="json"?helper.object.jsonToString(this.rcParams.scraperArgs,"&",false):this.rcParams.scraperArgs;if(cmdv!=undefined&&cmdv.indexOf("screenWidth")!=-1)cmd=cmd+this.removeBrowserSize(scraperArgs);else{var cmdLastChar=cmd.substr(cmd.length-1);var scrFirstChar=
scraperArgs.substr(0,1);var amp="";if(cmdLastChar!="&"&&scrFirstChar!="&")amp="&";cmd=cmd+amp+scraperArgs}}}if(!TVNC.useAjax)if(_comm.binaryType&&(!agentInfo.isFirefox||agentInfo.firefoxVersion>15)){cmd+="&imageList=binary";TVNC.imageListType=2}cmd+="&mouseControl="+this.rcParams.mouseControl+"&kbdControl="+this.rcParams.kbdControl+"&touchControl="+this.rcParams.touchControl;cmd+="&pixelFormat="+this.rcParams.pixelFormat;cmd+="&wallpaper="+this.rcParams.wallpaper;cmd+="&rleThreshold="+this.rcParams.rleThreshold;
cmd+="&useSendThread="+this.rcParams.useSendThread;cmd+="&monitor="+this.rcParams.monitor;TVNC.rcParams.clientAck=TVNC.rcParams.clientAck<=0&&!TVNC.useAjax?0:Math.max(TVNC.rcParams.clientAck,1);cmd+="&supportsWebP="+WebPImageFormat.supportsWebP();cmd+="&clientAck="+TVNC.rcParams.clientAck;if(TVNC.rcParams.screenResX>0)cmd+="&screenResX="+TVNC.rcParams.screenResX+"&screenResY="+TVNC.rcParams.screenResY;if(this.rcParams.pin)cmd+="&pin="+this.rcParams.pin;if(this.rcParams.sessionKey)cmd+="&sessionKey="+
this.rcParams.sessionKey;if(TVNC.controlFactory)cmd+="&nativeClasses="+TVNC.controlFactory.getClassList();if(TVNC.rcParams.persistentCache)cmd+="&imgCache="+getImageCacheList();var isLandscape=window.environment.currentOrientation=="landscape"?true:false;cmd+="&devicePixelRatio="+(window.environment.initialDevicePixelRatio||1)+"&isMobile="+agentInfo.isMobile+"&isLandscape="+isLandscape+"&supportsFullScreen="+window.environment.supportsFullScreen+"&webapp="+window.environment.webapp;if(TVNC.rcParams.extraData!=
null)cmd+="&extraData="+encodeURIComponent(JSON.stringify(TVNC.rcParams.extraData));allowSendingCommands=true;TVNC.sendCmd(cmd);if(TVNC.rcParams.showOnStart)TVNC.show()};this.purgeQuery=function(q){try{var pairs=q.split("&");var collection=[];var pair;var qq="";for(var p=0;p<pairs.length;p++)if(pairs[p]!=""){pair=pairs[p].split("=");if(pair.length=2)collection[pair[0]]=pair[1]}qq="";for(var c in collection)qq+=c+"="+collection[c]+"&";qq=qq.substr(0,qq.length-1);return qq}finally{collection=pairs=
pair=qq=null}};var _gettingSeverUrl=false;function addBaseUrl(baseUrl){var elem=document.getElementById("baseUrlTag");if(!elem){elem=document.createElement("base");elem.id="baseUrlTag";var head=document.querySelector("head");if(head){var fn=head.querySelector("script");if(fn)head.insertBefore(elem,fn);else head.appendChild(elem)}else helper.console.warning("Cannot insert 'script' tag, base url",arguments)}elem.href=baseUrl}function removeBaseUrl(){var elem=document.getElementById("baseUrlTag");elem.parentElement.removeChild(elem)}
function encodeResponseUrl(urlResponse){if(urlResponse){var surl=urlResponse.split("/");if(surl.length>2){urlResponse="";for(var i=0;i<Math.min(surl.length-1,2);i++)if(surl[i]!="")urlResponse+="/"+surl[i];for(var i=2;i<surl.length;i++)if(surl[i]!="")urlResponse+="/"+encodeURIComponent(surl[i]);urlResponse+="/"}}return urlResponse}function setUrls(response){var _browseUrl="__browser__";var basePath=Thinfinity.global.variables.basePath;if(TVNC.rcParams.sessionKey&&TVNC.rcParams.sessionKey!==""){var bp=
Thinfinity.global.variables.basePath.split("/").filter(function(p){return p!==""});var ru=response.url.split("/").filter(function(p){return p!==""});var i=bp.length-1;while(i>=0){if(bp[i]!==""&&ru.find(function(r){return r===bp[i]})){var f=bp[i];basePath=Thinfinity.global.variables.basePath=("/"+bp.splice(0,i).join("/")+"/").replaceAll("//","/");response.url=("/"+ru.slice(ru.indexOf(f),ru.length).join("/")+"/").replaceAll("//","/");i=-1}i--}}else if(productId==="thinvnc"){if(Thinfinity.global.variables.basePath.length>
1&&Thinfinity.global.variables.basePath!=="/"&&response.url.length>1){let bp=Thinfinity.global.variables.basePath.replaceAll("/","");if(response.url.split("/").find(p=>{return p===bp}))response.url="/"+response.url.split("/").filter(p=>{return p!=""}).splice(1).join("/")+"/"}if(Thinfinity.global.variables.gatewayPin.length>1)basePath=basePath.replace(Thinfinity.global.variables.gatewayPin,"").replaceAll("//","/")}_url.baseUrl=helper.url.parseUrl(Thinfinity.global.variables.basePath+response.url).toUrl();
_url.brokerUrl=helper.url.parseUrl(location.href).toUrl("-o-a-r");if(basePath!=="/"){if(basePath.substr(0,1)!=="/")basePath="/"+basePath;if(basePath.substr(basePath.length-1)!=="/")basePath+="/"}if(response.gateway&&response.gateway!==""){_url.httpConnection=helper.url.parseUrl(response.gateway+response.url).toUrl();_url.gatewayAccess=response.gateway;_url.wsConnection=helper.url.parseUrl(response.gateway+_browseUrl+response.url).toUrl();_url.wsConnection=_url.wsConnection.replace("http","ws");_location=
helper.url.parseUrl(response.gateway+response.url).toUrl();_url.baseUrl=_virtualPathProfile}else{if(_url.baseUrl!=="/"){if(_url.baseUrl.substr(0,1)!=="/")_url.baseUrl="/"+_url.baseUrl;if(_url.baseUrl.substr(_url.baseUrl.length-1)!=="/")_url.baseUrl+="/"}_url.httpConnection="";var sp=TVNC.rcParams.server?TVNC.rcParams.server.split("/").filter(function(p){return p!==""}):"";var bp=basePath.split("/").filter(function(p){return p!==""});var i=bp.length-1;var fIdx=-1;while(i>=0){fIdx=sp.findIndex(function(r){return r===
bp[i]});if(fIdx!=-1){TVNC.rcParams.server=sp.splice(0,fIdx).join("/");i=-1}i--}_url.wsConnection=TVNC.rcParams.server?TVNC.getProtocol().replace("http","ws")+"//"+TVNC.rcParams.server:window.location.origin.replace("http","ws");_url.wsConnection+=basePath+_browseUrl+_url.baseUrl.substr(basePath.length-1);_url.wsConnection=helper.url.parseUrl(_url.wsConnection).toUrl();addBaseUrl(_url.baseUrl);_location=TVNC.getAjaxUrl()}if(connection.fromReconnection)TVNC.fireOOBCmd("vchannel",{"msg":{"cmd":"update.gateway"}})}
this.getWsUrl=function(){var wsUrl=_url.wsConnection;if(TVNC.gatewayAccessKey!="")if(wsUrl.indexOf("/"+TVNC.gatewayAccessKey)<0)wsUrl+="/"+TVNC.gatewayAccessKey;return wsUrl+TVNC.rcParams.id+"?_gwsid="+Thinfinity.global.variables.gwsid};this.connect=function(userid,password){if(_isDisconnecting)return;if(!_fromBroker){TVNC.rcParams.id=null;ID.remove()}else if(TVNC.rcParams.id===null)TVNC.rcParams.id=ID.get();helper.ajax.addHeaderValue("X-Thinfinity-GWSID",Thinfinity.global.variables.gwsid);BTP_REM_CO=
null;keepHTTPAlive(true);if(_fromBroker){BTP_PCG_STR=null;if(!_gettingSeverUrl){TVNC.gatewayAccessKey="";_gettingSeverUrl=true;if(_virtualPathProfile==""){_virtualPathProfile=TVNC.rcParams.url?TVNC.rcParams.url:helper.url.parseUrl(window.location.href).toUrl("-o-a");if(_virtualPathProfile[_virtualPathProfile.length-1]!="/")_virtualPathProfile+="/"}connection.reconnectingCount=0;if(connection.firstConnection)updateConnectionStatus({action:1,description:consts.establishingConn});TVNC.getServerUrl(function(response){if(response)if(response.url){helper.console.log(helper.string.format("getServerUrl response. Redirect --\x3e URL:{0} ",
response.url),arguments);TVNC.gatewayAccessKey="";sessionStorage.setItem(_preferredBrokerKey,response.brokerid||"");setUrls(response);BTP_PCG_END=null;postConnect(userid,password);_gettingSeverUrl=false}else{_gettingSeverUrl=false;var errStr="";if(response.state===STATE_ERROR)errStr=response.description!=""?response.description:response.errstr!=""?response.errstr:consts.unknownError;else if(response.errno>=400)errStr=response.errno==404?consts.sessionError404:helper.string.format(consts.clientErrorNum,
response.errno);if(errStr){if(connection.fromReconnection)TVNC.closeReconnectDiv();var responseStr=response.description+(errStr&&errStr!==response.description?" "+errStr:"");var res=false;var status={"state":response.state,"description":response.description,"errstr":errStr,"errno":response.errno};if(_fromBroker&&response.errno===404&&_isTemporalConnection===true){helper.console.warning(helper.string.format("getServerUrl - status: {0}",responseStr),arguments);status.description=consts.brokerDown;status.temp=
true;status.brokerDown=true;status.originalEvent=true;try{if(helper.object.existsPath(TVNC,"rcParams.events.onBrokerError"))res=TVNC.rcParams.events.onBrokerError(status);else $(window).trigger("onBrokerError",status)}catch(error){helper.console.warning("'onBrokerError' calling attached method fail. message: "+error.message,error,arguments)}}if(!res)if(response.license){if(TVNC.connected)TVNC.disconnect();let licenseError={title:consts.licenseError,errorType:_licenseTypes.ERR_TYPE_ERROR,errorCode:response.state,
errorMsg:response.description};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onLicenseMsg==null)$(window).trigger("licenseMsg",licenseError);else TVNC.rcParams.events.onLicenseMsg(licenseError)}else{try{let oError={message:responseStr};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerError==null)$(window).trigger("serverError",oError);else TVNC.rcParams.events.onServerError(oError);helper.console.log("'serverError' disconnecting. "+responseStr,arguments)}catch(error){helper.console.warning("'serverError' disconnecting. message: "+
error.message,error,arguments)}TVNC.disconnect()}else helper.console.log("The error was handled by the user",arguments)}}else{_gettingSeverUrl=false;setTimeout(function(){BTP_PCG_ERR=null;TVNC.connect(userid,password)},200)}})}}else{var response={"url":_url.baseUrl!=="/"?_url.baseUrl:""};setUrls(response);updateConnectionStatus({"action":1,"description":productId=="virtualui"?null:consts.establishingConn});_virtualPathProfile="";postConnect(userid,password)}};function supportCur(){return!(agentInfo.isSafari||
agentInfo.isMobile&&agentInfo.isIOS||agentInfo.isMSIE&&agentInfo.msieVersion<=11&&agentInfo.msieOSVersion<=7)}function keepHTTPAlive(status){_comm.disposePing("HTTP.ALIVE");if(status){let url=helper.url.parseUrl(location.href).toUrl("-a-r")+(productId==="thinrdp"?TVNC.apiUrl+"auth/":"")+"ping?id="+TVNC.rcParams.id;_comm.createPing("HTTP.ALIVE",TVNC.completeAjaxParams({"url":url,"cache":false,"timeout":3E3,"error":function(){helper.console.warning("Cannot keep http alive, failed. ",arguments)},"success":function(){helper.console.log("Http alive, response",
arguments)},"intervalTime":6E4}))}}this.checkSizeAndResolution=function(callback){clearTimeout(_checkSizeAndResolutionTimeoutId);if(TVNC.rcParams.resolution=="fittobrowser")if(window.environment.detectedWidth==0||window.environment.detectedHeight==0)_checkSizeAndResolutionTimeoutId=setTimeout(TVNC.checkSizeAndResolution,250,callback);else callback();else callback()};function fireCustomEvent(eventName,response,jqXHR,err){try{if(helper.object.existsPath(TVNC.rcParams,helper.string.format("events.{0}",
eventName)))TVNC.rcParams.events[eventName](response,err);else{eventName=eventName.replace("on");eventName=eventName[0].toLowerCase()+s.substring(1);$(window).trigger(eventName,jqXHR,err)}}catch(error){helper.console.warning(helper.string.format("'{0}' calling attached method fail. message: {1}",eventName,error.message),error,arguments)}}function getDisplaysInfo(){let w=environment.availWidth;let h=environment.availHeight;let t=0;let displays=[{id:0,width:w,height:h,surface:{top:t,left:0},physicalWidth:w,
physicalHeight:h,orientation:environment.currentOrientation,desktopScaleFactor:1,deviceScaleFactor:1,mainDisplay:true,name:""}];return displays}function sendDisplaysInfo(displays){if(TVNC.rcParams.mode!==_eMode.SKEY){displays=getPurgedDisplayManagerInfo(displays);helper.console.log(`Sending browser displays info: ${JSON.stringify(displays)}`,arguments);let checkPending=function(){if(!_pendingDisplayResize){_pendingDisplayResize=displays;_pendingsCommandsCallback.push(function(){sendDisplaysInfo(_pendingDisplayResize);
_pendingDisplayResize=null})}else _pendingDisplayResize=displays};if(_comm)if(_comm.state===Thinfinity.Communication.state.CONNECTED){helper.console.log(`cmd=brwrRsze: ${JSON.stringify(displays)}`,arguments);TVNC.sendEvent("cmd=brwrRsze&ms="+encodeURIComponent(JSON.stringify(displays))+"&id="+TVNC.rcParams.id)}else{if(_comm.state<Thinfinity.Communication.state.CLOSING)checkPending()}else checkPending()}}function checkServerControlMouse(){TVNC.rcParams.overrideCursor=false;if(TVNC.rcParams.serverControlMouse)_allowMouseCapture=
false;else _allowMouseCapture=true}async function initializeDisplayManager(){if(_displayManager){helper.console.log(`Re-use device displays`,arguments);return true}else{var _prevResize=null;if(!!TVNC.rcParams.playsession){TVNC.rcParams.overrideCursor=false;TVNC.rcParams.allowMouseCapture=false;TVNC.rcParams.serverControlMouse=true}_oInterface=(new Thinfinity.Object.Interface({defaultEventFire:{async:0}})).new(new Thinfinity.Object.IConfig({namespace:true,options:[Thinfinity.Object.IConfig.OPTIONS.DO_NOT_FULL_EXTEND_OBJECT],
object:TVNC,properties:[{source:"rcParams.active",ro:true},{source:"rcParams.mouseControl",ro:true},{source:"mouseBuffer.isAvailable",alias:"mouseBufferAvailable",ro:true},{source:"rcParams.hookMouse",ro:true},{source:"rcParams.mousePressAsRightButton",ro:true},{source:"rcParams.cursorVisible",ro:true},{source:"rcParams.remotePointer",ro:true},{source:"rcParams.viewLeft",ro:true},{source:"rcParams.viewTop",ro:true},{source:"rcParams.enableH264",ro:true},{source:"rcParams.enableGfx",ro:true},{source:"rcParams.hookKeyboard",
ro:true},{source:"rcParams.kbdUnicode",ro:true},{source:"rcParams.kbdLogKeys",ro:true},{source:"onlyKeyCode",ro:true,get:function(){return _onlyKeyCode}},{source:"rcParams.isCrossDomain",ro:true},{source:"allowOverrideCursor",ro:true,get:function(){return allowOverrideCursor}},{source:"allowMouseCapture",ro:true},{source:"rcParams.overrideCursor",ro:false},{source:"centered",ro:true},{source:"rcParams.centeredMode",ro:true},{source:"border",ro:true,get:function(){return{left:TVNC.rcParams.borderLeft,
top:TVNC.rcParams.borderTop,right:TVNC.rcParams.borderRight,bottom:TVNC.rcParams.borderBottom}}},{source:"rcParams.playsession",ro:true},{source:"isServerControlMouse",ro:true,get:function(){return!!TVNC.rcParams.playsession||TVNC.rcParams.serverControlMouse}},{source:"rcParams.id",ro:true,alias:"sid"},{source:getClipboardInterface().iObject,ro:true,alias:"clipboard"},{source:"canPasteFiles",ro:true,get:function(){return productId=="thinrdp"}},{source:"rdpMode",ro:true},{source:"productId",ro:true,
get:function(){return window.productId}},{source:"rcParams.fitmode",ro:true},{source:"rcParams.fitToBrowser",ro:true},{source:"rcParams.rfxEnabled",ro:true},{source:"rcParams.overflow",ro:true},{source:"maxSize",ro:true,get:function(){return{width:TVNC.rcParams.maxWidth,height:TVNC.rcParams.maxHeight}}},{source:"serverDPR",ro:true,get:function(){return serverDPR}},{source:"CUEnabled",ro:true,get:function(){return _CUEnabled}},{source:"rcParams.quality",ro:true},{source:"rcParams.pixelFormat"},"baseZIndex",
{source:"cursorCanvasX",get:function(){if(TVNC.cursorCanvas){var position=TVNC.findPos(TVNC.vncContainer);let l=0;try{l=parseInt(TVNC.cursorCanvas.style.left.replace("px",""),10)}catch(err){l=TVNC.cursorCanvas.offsetLeft}return l*_displayManager.processDisplayCmd("GET_SCALE")+position[0]}else return TVNC.mouseX},ro:true},{source:"cursorCanvasY",get:function(){if(TVNC.cursorCanvas){var position=TVNC.findPos(TVNC.vncContainer);let t=0;try{t=parseInt(TVNC.cursorCanvas.style.top.replace("px",""),10)}catch(err){t=
TVNC.cursorCanvas.offsetTop}return t*_displayManager.processDisplayCmd("GET_SCALE")+position[1]}else return TVNC.mouseY},ro:true},{source:"pictureType",get:function(){return _ePictureType}},{source:"rcParams.shadowed",ro:true},{source:"rcParams.mouseWheelDirection",ro:true},{source:"rcParams.maxWidth",ro:true},{source:"rcParams.maxHeight",ro:true},{source:"rcParams.mouseX",ro:false},{source:"rcParams.mouseY",ro:false},{source:"rcParams.viewWidth"},{source:"rcParams.viewHeight"},{source:"rcParams.mouseMoved",
ro:false},{source:"caret",ro:true},{source:"rcParams.multiRowMinSize",ro:true},{source:"rcParams.caretX",ro:false},{source:"rcParams.caretY",ro:false},{source:"rcParams.relativeTouch",ro:true},{source:"rcParams.scaled",ro:true},{source:"rcParams.resizeDesktop",ro:true},{source:"rcParams.resolution",ro:true},{source:"rcParams.isShadowSession",ro:true},{source:"availableAudio",get:function(){return _audioDriver?.available??false}},{source:"mobileKeyboardEnumKeys",ro:true,get:()=>Thinfinity?.Driver?.MobileKeyboard?.enumKeys}],
methods:[{alias:"sendKey",value:TVNC.sendKey},{alias:"sendText",value:TVNC.sendText},{alias:"sendCmd",value:TVNC.sendCmd},{alias:"sendFocus",value:sendTabFocusCmd},{alias:"sendWheel",value:TVNC.sendWheel},{alias:"inputAllowed",value:TVNC.inputAllowed},{alias:"sendEvent",value:TVNC.sendEvent},{alias:"sendMouse",value:function mouseEvent(x,y,button,action){if(TVNC.mouseX!=x||TVNC.mouseY!=y)TVNC.mouseMoved=true;TVNC.mouseX=x;TVNC.mouseY=y;if(action!=="move")TVNC.sendMouse(x,y,button,action)}},{alias:"registerCanvas",
value:addValidCanvas},{alias:"fireEvent",value:function(event,data){if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events[event]==null)$(window).trigger(event,[data]);else TVNC.rcParams.events[event]([data])}},{alias:"updateCanvasSize",value:TVNC.updateCanvasSize},{alias:"removeDevice",value:function(id){_displayManager.removeDevice(id)}},{alias:"zoom",value:value=>{_displayManager.fireEvent("zoom",value)}},{alias:"sendWheel",value:TVNC.sendWheel},{alias:"forceMouseMove",value:()=>{TVNC.mouseMoved=
true;TVNC.sendMouseMove();TVNC.mouseMoved=false}},{alias:"pressAndRelease",value:(x,y)=>{TVNC.sendMouse(x,y,2,"down");TVNC.sendMouse(x,y,2,"up");_displayManager.fireEvent("pressAndRelease",x,y)}}],events:{resize:function(displays){if(_prevResize!==displays)sendDisplaysInfo(displays);_prevResize=displays},disconnect:function(){Thinfinity.Popups.unblock();TVNC.disconnect()}}}));TVNC=_oInterface.original;if(productId==="thinvnc"){_oInterface.new.on("rcParams.serverControlMouse",checkServerControlMouse);
checkServerControlMouse()}let username="";let isSessionKey=TVNC.rcParams.mode===_eMode.SKEY;if(isSessionKey){TVNC.rcParams.enableH264=Thinfinity.global.variables.H264Enabled=="true";TVNC.rcParams.enableGfx=Thinfinity.global.variables.GfxEnabled=="true"&&!TVNC.rcParams.enableH264}let displayConfig=isSessionKey?{db:false,shadowingSession:true}:{username:username,model:TVNC.rcParams.profileKey};displayConfig.methods={sendCmd:TVNC.sendCmd};displayConfig.canBeOverridden=TVNC.rcParams?.multiMonitor?.canBeOverridden||
false;displayConfig.count=TVNC.rcParams?.multiMonitor?.count||1;_displayManager=new Thinfinity.Display.Manager(displayConfig,_oInterface.new);if(TVNC.rcParams.enableH264)_displayManager.limits={min:{width:800,height:600}};Object.defineProperty(TVNC,"zoomFactor",{enumerable:true,configurable:false,get:function(){return _displayManager.processDisplayCmd("GET_ZOOM_FACTOR")},set:function(value){return _displayManager.processDisplayCmd("SET_ZOOM_FACTOR",value)}});delete TVNC.getZoom;Object.defineProperty(TVNC,
"getZoom",{enumerable:true,configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("GET_ZOOM_FACTOR")}});Object.defineProperty(TVNC,"zoomDesktop",{enumerable:true,configurable:false,writable:false,value:function(value){return _displayManager.processDisplayCmd("ZOOM_DESKTOP",value)}});Object.defineProperty(TVNC,"cursorCanvas",{enumerable:true,configurable:false,get:function(value){return _displayManager.processDisplayCmd("CURSOR_CANVAS")}});Object.defineProperty(TVNC,
"getMinZoomFactor",{enumerable:true,configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("GET_MIN_ZOOM_FACTOR")}});Object.defineProperty(TVNC,"center",{enumerable:true,configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("CENTER")}});Object.defineProperty(TVNC,"scale",{enumerable:true,configurable:false,get:function(){return _displayManager.processDisplayCmd("GET_SCALE")}});Object.defineProperty(TVNC,"getScale",{enumerable:true,
configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("GET_SCALE")}});Object.defineProperty(TVNC,"zoomFactorReset",{enumerable:true,configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("ZOOM_FACTOR_RESET")}});await _displayManager.sync();var createDisplayDevice=function(config){let mon={resolution:Thinfinity.Display.Device.RESOLUTION.FIT_TO_BROWSER,orientation:environment.currentOrientation,desktopScaleFactor:1,deviceScaleFactor:1,
mainDisplay:false,external:true,height:environment.availHeight,width:environment.availWidth,surface:{left:0,top:0},window:null};helper.object.parseAttributes(mon,config);return new Thinfinity.Display.Device(mon)};triggerCustomEvent("display.manager.ready");let displays=null;let restoreData=null;if(!isSessionKey){if(agentInfo.h264&&TVNC.rcParams.enableH264&&_displayManager)displays=_displayManager.getStoredConfiguration();helper.console.log(`recovering stored data: ${displays?JSON.stringify(displays):
"is empty"}`);if(!displays)restoreData=triggerCustomEvent("display.manager.restore.display.info")}else{TVNC.registerOOBCmd("monitorDefs",function(data){if(data?.monitorDefs?.items)_displayManager.syncDisplayInfo(data.monitorDefs.items)});_displayManager.on("syncCompleted",function(){setTimeout(function(){TVNC.refresh()},5E3)})}_displayManager.on("createCanvas",TVNC.createCanvas);if(!displays)displays=getDisplaysInfo();if(restoreData){helper.console.log(`getting displays from profile`);return await restoreData()}else{helper.console.log(`creating monitors...`);
let m=displays.find(function(d){return d.mainDisplay});m.parentElement=document.getElementById("deskdiv");if(displays){var proms=[];displays.forEach(async function(d){proms.push(_displayManager.addDevice(createDisplayDevice(d)))});let values=await Promise.all(proms);let any=false;var blockedMsg=null;values.forEach(function(res){if(res&&res.code!==Thinfinity.Display.Manager.RESPONSE_CODES.SUCCESS){if(res.code===Thinfinity.Display.Manager.RESPONSE_CODES.POPUP_BLOCKED)blockedMsg=res.message;helper.console.warning(`Something went wrong. ${res.message}`,
arguments)}else any=true});if(blockedMsg)values=await _displayManager.restoreDevices();return any}else throw new Error(`Cannot access to screens details.`);}}}function getPurgedDisplayManagerInfo(displays){if(!displays)displays=_displayManager.getDisplaysInfo();if(displays)displays.forEach(function(m){delete m.window;delete m.resolution;delete m.name;m.width=m.display.width;m.height=m.display.height;delete m.display;delete m.screen;if(m.surface){m.left=m.surface.left;m.top=m.surface.top}delete m.surface});
return displays}function postConnect(userid,password){BTP_PCS_STR=null;if(_isDisconnecting)return;TVNC.checkSizeAndResolution(function(){BTP_PCS_END=null;if([Thinfinity.Communication.state.READY,Thinfinity.Communication.state.SERVERCONNECTED,Thinfinity.Communication.state.RECONNECTING,Thinfinity.Communication.state.UNSTABLE,Thinfinity.Communication.state.LOST].indexOf(_comm.state)!=-1){TVNC.cacheLoaded=false;TVNC.startCmdToSend=false;if(TVNC.rcParams.profileKey)TVNC.initfs(TVNC.rcParams.profileKey);
else{var dbname=TVNC.rcParams.address||"";if(dbname==""||productId.toLowerCase()=="webfmx"||productId.toLowerCase()=="virtualui")TVNC.initfs(productId+"_dev");else{dbname=dbname.replace(".","_").replace(":","_");TVNC.initfs(dbname)}}try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerAuthenticationRequired==null)$(window).trigger("serverAuthenticationRequired");else TVNC.rcParams.events.onServerAuthenticationRequired()}catch(error){helper.console.warning("'onServerAuthenticationRequired' calling attached method fail. message: "+
error.message,error,arguments)}if(typeof userid=="undefined"&&TVNC.rcParams.userid!=null)userid=TVNC.rcParams.userid;if(typeof password=="undefined"&&TVNC.rcParams.password!=null)password=TVNC.rcParams.password;var cmd="cmd";var jsonQuery={};jsonQuery.cmd="connect";if(typeof userid!="undefined"){jsonQuery.userid=escape(userid);TVNC.userid=userid;if(typeof password!="undefined"){jsonQuery.password=escape(password);TVNC.password=password}}jsonQuery.tabid=_getServerUrl.id;jsonQuery.wscompression=TVNC.rcParams.wscompression;
if(TVNC.rcParams.ticket!="")jsonQuery.ticket=TVNC.rcParams.ticket;if(TVNC.rcParams.pin!="")jsonQuery.pin=TVNC.rcParams.pin;if(TVNC.rcParams.sessionKey!="")jsonQuery.sessionKey=TVNC.rcParams.sessionKey;if(TVNC.rcParams.externalId!="")jsonQuery.externalId=TVNC.rcParams.externalId;jsonQuery.destAddr=TVNC.rcParams.address;if(TVNC.rcParams.scraper!=null){jsonQuery.scraper=TVNC.rcParams.scraper;if(TVNC.rcParams.scraperArgs!=null)if(helper.object.getDataTypeOf(TVNC.rcParams.scraperArgs)=="json")helper.object.merge(TVNC.rcParams.scraperArgs,
jsonQuery,true);else TVNC.rcParams.scraperArgs.split("&").forEach(function(kvp){kvp=kvp.split("=");jsonQuery[kvp[0]]=kvp[1]})}jsonQuery.screenWidth=window.screen?.width||window.environment.rawWidth;jsonQuery.screenHeight=window.screen?.height||window.environment.rawHeight;if(typeof window.orientation=="undefined")window.orientation=90;jsonQuery.orientation=window.orientation;if(typeof TVNC.rcParams.lfn!="undefined"&&TVNC.rcParams.lfn!=null&&TVNC.rcParams.lfn!="")jsonQuery.lfn=TVNC.rcParams.lfn;if(TVNC.rcParams.resolution!=
"fixed"){var bw=window.environment.detectedWidth;var bh=window.environment.detectedHeight;if(helper.object.existsPath(self,"clientSettings.UseViewportSize")&&self.clientSettings.UseViewportSize){bw=window.environment.viewportWidth;bh=window.environment.viewportHeight}jsonQuery.browserWidth=bw;jsonQuery.browserHeight=bh}jsonQuery.ogg=true;jsonQuery.supportCur=supportCur();jsonQuery.gfx=agentInfo.gfx;jsonQuery.h264=agentInfo.h264;var callConnect=function(){if(_displayManager){jsonQuery.decoderType=
0;jsonQuery.buffersize=agentInfo.isMobile?22:100;let di=JSON.stringify(getPurgedDisplayManagerInfo());helper.console.log(`Sending monitors info: ${di}`,arguments);jsonQuery.monitors=di}var oturlpass=sessionStorage.getItem("oturlDataPass");if(oturlpass)jsonQuery.oturlpass=oturlpass;var url=_url.httpConnection+cmd+"?cmd=connect";if(TVNC.rcParams.id!=null)url+="&id="+TVNC.rcParams.id;if(TVNC.rcParams.sessionKey)url+="&sessionkey="+TVNC.rcParams.sessionKey;jsonQuery.id=TVNC.rcParams.id;var isLandscape=
window.environment.currentOrientation=="landscape"?true:false;jsonQuery.devicePixelRatio=window.environment.initialDevicePixelRatio||1;jsonQuery.isMobile=agentInfo.isMobile;jsonQuery.isLandscape=isLandscape;jsonQuery.supportsFullScreen=window.environment.supportsFullScreen;jsonQuery.webapp=window.environment.webapp;if(Thinfinity.VirtualChannels&&Thinfinity.VirtualChannels.localServer){jsonQuery.localServer=true;jsonQuery.channelList=Thinfinity.VirtualChannels.getRegisteredNodes(Thinfinity.VirtualChannels.ChannelOrigin.CLIENT).join(",")}var params=
{url:TVNC.getCrossDomainUrl(TVNC.addExtraParams(url)),dataType:helper.ajax.responseType.JSON,data:JSON.stringify(jsonQuery),timeout:7E4,withCredentials:true,error:function(err,status,jqXHR){_comm.serverConnected=false;var XHRstatus=jqXHR.status;BTP_PCR_ERR3=null;var strMsg=helper.string.sprintf(consts.connAttemptFailed,"\nHTTP status code "+jqXHR.status+" "+jqXHR.statusText);if(XHRstatus>=400)helper.console.warning(`${strMsg} - ${jqXHR.responseType==="json"?jqXHR.statusText:jqXHR.responseText}`);
else if(XHRstatus===0){strMsg=consts.urlCantReached+" "+consts.tryingAgain;updateConnectionStatus({"description":strMsg,"errstr":strMsg});window.setTimeout(function(){if(_comm.state<=Thinfinity.Communication.state.CLOSING&&!_isDisconnecting)TVNC.connect()},_restartConnectTimeout);return}else connection.first404IncomingTime=null;TVNC.xmlHttpJson=null;if(_comm.state<=Thinfinity.Communication.state.LOST&&(_fromBroker||XHRstatus==404)){BTP_PCR_RTY=null;helper.console.log("Connect was fail, trying to connect again. ");
window.setTimeout(function(){TVNC.connect()},_restartConnectTimeout)}else{TVNC.closeReconnectDiv();fireCustomEvent("onServerConnectionError",strMsg,jqXHR,err)}},success:function(data,status,jqXHR){if((jqXHR.getResponseHeader("content-type")||"").indexOf("text/html")!=-1){BTP_PCR_ERR4=null;reloadWnd();return}connection.first404IncomingTime=null;TVNC.xmlHttpJson=null;TVNC.onConnectResult(data)}};BTP_PCR_STR=null;serverCmdResultOrientation=null;TVNC.xmlHttpJson=_comm.post(TVNC.completeAjaxParams(params));
if(_comm.state===Thinfinity.Communication.state.RECONNECTING)fireCustomEvent("onServerConnecting",{"reconnecting":Thinfinity.Communication.state.getKey(_comm.state).toString()})};initializeDisplayManager().then(function(res){if(res)callConnect();else{let msg=consts.displayCannotBeInitialized;helper.console.warning(msg,arguments);msg+=`</br><button id="btnClose" onclick="window.location.href= "/";let btn = document.getElementById('btnClose'); btn.parentElement.removeChild(btn);">Close this window</button>`;
document.body.innerText="";helper.dom.appendJsonElement({"parentElement":document.body,"type":"div","attributes":{"class":"bye"},"content":msg});setTimeout(function(){window.location.href="/"},15E3)}}).catch(function(err){helper.console.warning(`${consts.displayManagerError} - ${err.message||err} - ${err.stack||""}`,arguments)})}else{var msg=helper.string.sprintf(consts.connAttemptFailed,"");fireCustomEvent("onServerConnectionError",msg);helper.console.warning(helper.string.format(msg+" - state: {0}",
Thinfinity.Communication.state.getKey(_comm.state).toString()),arguments)}})}function updateConnectionStatus(status){helper.console.log(JSON.stringify(status),arguments);status.reconnecting=connection.fromReconnection;try{if(status.errno===undefined)if(helper.object.existsPath(TVNC,"rcParams.events.onServerConnecting"))TVNC.rcParams.events.onServerConnecting(status);else $(window).trigger("serverConnecting");else if(helper.object.existsPath(TVNC,"rcParams.events.onServerConnectionError"))TVNC.rcParams.events.onServerConnectionError(status.errstr);
else $(window).trigger("serverConnectionError")}catch(error){helper.console.warning("'onServerConnecting' calling attached method fail. message: "+error.message,error,arguments)}}this.addExtraParams=function(url){return url};function reloadWnd(){$(window).off("onbeforeunload");_comm.dispose();window.onbeforeunload=e=>{return};setTimeout(function(){window.location.reload()},1E3)}this.getServerUrl=function(callback){if(callback&&_comm.state<=Thinfinity.Communication.state.CLOSING){if(_getServerUrl.forceNewRedirection)_getServerUrl.forceNewRedirectionUsed=
true;var gsUrl=TVNC.addExtraParams(_virtualPathProfile+"getServerUrl?id=")+_getServerUrl.id+(_getServerUrl.forceNewRedirection?"&forceNewRedirection=true":"");gsUrl+="&preferredBrokerId="+(sessionStorage.getItem(_preferredBrokerKey)||"");helper.console.log(helper.string.format("get server url {0}",gsUrl),arguments);let callTimeout=true;_comm.send({url:gsUrl,async:true,dataType:"json",timeout:3E4,success:function(obj){if(_comm.state<=Thinfinity.Communication.state.CLOSING)try{if(!obj)obj={"state":STATE_PENDING};
var er=false;var status={"state":obj.state,"description":consts.resolving};_getServerUrl.timeout=_getServerUrl.normal_timeout;if(obj.state==STATE_PENDING&&obj.vmcode&&obj.vmtext){_getServerUrl.timeout=_getServerUrl.vm_timeout;status.description=obj.vmtext}else if(obj.state==STATE_BUSY)status.description=consts.waitingForResources;else{if(obj.rdpInfo)switch(obj.rdpInfo.action){case RDP_NO_INFO:break;case RDP_LOGIN_START:status.description=consts.initializingSession;break;case RDP_LOGIN_END:status.description=
consts.sessionInitialized;break;case RDP_LOGIN_INFO:status.description=obj.rdpInfo.errstr;break;case RDP_LOGIN_ERROR:{status.description=consts.sessionInitializationError;status.errno=obj.rdpInfo.errno;status.errstr=obj.rdpInfo.errstr;er=true}}if(obj.redirect){_getServerUrl.forceNewRedirection=false;status.description=consts.connecting;updateConnectionStatus(status);callback({"url":obj.url,"gateway":obj.gateway,"brokerid":obj.brokerid||""});return}}if(!er&&obj.errmsg!=""&&obj.state==STATE_ERROR){status.description=
status.errstr=obj.errmsg;status.errno=obj.state;helper.console.warning(helper.string.format("Cannot connect - error: {0} - state: {1} - reload: {2}",status.description,obj.state,obj.refresh==undefined?"''":obj.refresh),arguments);if(obj.refresh){reloadWnd();return}}if(_comm.state!==Thinfinity.Communication.state.RECONNECTING)updateConnectionStatus(status);callback(status);if(obj.state!=STATE_ERROR)setTimeout(function(){TVNC.getServerUrl(callback)},_getServerUrl.timeout)}catch(e){status={"action":4,
"description":e.message};if(_comm.state!==Thinfinity.Communication.state.RECONNECTING)updateConnectionStatus(status);callback(status)}else callback({"description":consts.connectionNotStablished,"errno":Thinfinity.Communication.errorCode.NO_CONTENT,"errstr":consts.connectionNotStablished})},error:function(response,status,xhr){var XHRStatus=status??xhr.status;var status={"state":STATE_ERROR,"errno":XHRStatus,"description":"","errstr":""};var errstr=xhr.statusText&&xhr.statusText!=""?" ("+xhr.statusText+
")":"EMPTY";helper.console.log(helper.string.format("Error --\x3e getServerUrl - status: {0}",errstr),arguments);_gettingSeverUrl=false;if(_xhrStatusExitCodes.indexOf(XHRStatus)!=-1){switch(XHRStatus){case Thinfinity.Communication.errorCode.UNAUTHORIZED:status.errstr=consts.unknownUser;reloadWnd();break;default:status.description=consts.sessionInitializationError;status.errstr=errstr!=""?errstr:status.description;break}if(_comm.state!=Thinfinity.Communication.state.RECONNECTING)updateConnectionStatus(status);
callback(status);return}else switch(XHRStatus){case Thinfinity.Communication.errorCode.NOT_FOUND:if(TVNC.observable.isOTURLSession)if(_getServerUrl.retriesCount<_getServerUrl.oturlMaxRetries)_getServerUrl.retriesCount++;else{_getServerUrl.forceNewRedirection=false;TVNC.rcParams.events.onServerConnectionError(consts.invalidTicket);return}else{if(connection.reconnectingCount>connection.reconnectingMax){callTimeout=false;let recallGetServerUrl=function(){connection.reconnectingCount=0;TVNC.getServerUrl(callback)};
fetch(_url.baseUrl).then(res=>{if(res.status===200&&res.url.indexOf("/?signin")!==-1)reloadWnd();else setTimeout(recallGetServerUrl,2E3)}).catch(err=>{setTimeout(recallGetServerUrl,2E3)})}connection.reconnectingCount+=1}break}if(callTimeout)setTimeout(function(){TVNC.getServerUrl(callback)},2E3)}});_getServerUrl.forceNewRedirection=false}};this.ping=function(url,error,success,fnconnect){if(url.lastIndexOf("/")!=url.length-1)url+="/";url+="ping?xxx";_comm.send(TVNC.completeAjaxParams({url:TVNC.addExtraParams(url),
dataType:_defaultResponseType,async:false,cache:false,timeout:1E3,error:function(){if(helper.object.validate(error))error()},success:function(){var pathArray=url.split("/");TVNC.rcParams.protocol=pathArray[0];TVNC.rcParams.server=pathArray[2];if(helper.object.validate(success))success();fnconnect()}}))};this.onConnectResult=function(data){TVNC.xmlHttpJson=null;TVNC.connecting=false;TVNC.allowMouse=true;TVNC.closeReconnectDiv();let tryToConnectAgain=()=>{_connectResult.count++;if(_connectResult.count<
_connectResult.max)TVNC.reconnect();else try{let msg=consts.sessionInitializationError;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerConnectionError==null)$(window).trigger("serverConnectionError",msg);else TVNC.rcParams.events.onServerConnectionError(msg);helper.console.warning(`connect result data is empty or null`);TVNC.disconnect();TVNC.dispose()}catch(error){helper.console.error("'onServerConnectionError' calling attached method fail.",error,arguments)}};if(data!=
""&&data)try{_comm.serverConnected=true;var doConnect=function(){if(!obj.id){let err=new Error(`Session ID is not valid: ${obj.id}`);helper.console.error(err.message,err,arguments)}if(obj.id&&TVNC.rcParams.id!=obj.id){ID.set(obj.id);TVNC.rcParams.id=obj.id;TVNC.removeCanvases();if(_fromBroker)keepHTTPAlive(true)}initializeImageQueue(obj.id);let objInstace=obj;let continueConnectResult=function(){obj=objInstace;if((connection.firstConnection||TVNC.wsEnabled)&&!TVNC.rcParams.forceAjax&&("WebSocket"in
window||"MozWebSocket"in window)){TVNC.connectWebSocket(false);if(obj.wolEnabled===true)_comm.wsWOL(true)}else{BTP_PA_STR=null;_comm.setChunkHandlers({"url":TVNC.addExtraParams("json?id="+TVNC.rcParams.id),"id":TVNC.rcParams.id,"success":ajaxSuccessHandler,"error":ajaxErrorHandler});_comm.start();TVNC.start()}connection.firstConnection=false;try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerConnect==null)$(window).trigger("serverConnect",obj);else TVNC.rcParams.events.onServerConnect(obj)}catch(error){helper.console.warning("'onServerConnect' calling attached method fail. message: "+
error.message,error,arguments)}};if(TVNC.rcParams.mode===_eMode.SKEY&&_displayManager&&obj?.monitorDefs?.items)if(TVNC.rcParams.events?.onDisplayInteractionRequired)TVNC.rcParams.events.onDisplayInteractionRequired(obj,continueConnectResult);else continueConnectResult();else continueConnectResult()};var redirecting=false;var obj=TVNC.crossDomain()?data:typeof data!="object"?JSON.parse(data):data;BTP_PCR_END1=null;if(obj.status&&typeof obj.status!="undefined"){if(obj.connectUrl){redirecting=true;TVNC.ping(obj.connectUrl,
function(e){if(obj.connectUrl2)TVNC.ping(obj.connectUrl2,function(e){if(obj.connectPin)_url.baseUrl="/"+obj.connectPin;else try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerRedirect==null)$(window).trigger("serverRedirect",[obj.connectUrl,obj]);else TVNC.rcParams.events.onServerRedirect(obj.connectUrl,obj)}catch(error){helper.console.warning("1 - 'onServerRedirect' calling attached method fail. message: "+error.message,error,arguments)}doConnect()},function(e){if(obj.connectPin)_url.baseUrl=
"/"+obj.connectPin;else try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerRedirect==null)$(window).trigger("serverRedirect",[obj.connectUrl2,obj]);else TVNC.rcParams.events.onServerRedirect(obj.connectUrl2,obj)}catch(error){helper.console.warning("2 - 'onServerRedirect' calling attached method fail. message: "+error.message,error,arguments)}},doConnect);else{if(obj.connectPin)_url.baseUrl="/"+obj.connectPin;else try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerRedirect==
null)$(window).trigger("serverRedirect",[obj.connectUrl,obj]);else TVNC.rcParams.events.onServerRedirect(obj.connectUrl,obj)}catch(error){helper.console.warning("3 - 'onServerRedirect' calling attached method fail. message: "+error.message,error,arguments)}doConnect()}},function(){try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerRedirect==null)$(window).trigger("serverRedirect",[obj.connectUrl,obj]);else TVNC.rcParams.events.onServerRedirect(obj.connectUrl,obj)}catch(error){helper.console.warning("4 - 'onServerRedirect' calling attached method fail. message: "+
error.message,error,arguments)}},doConnect)}else if(obj.connectPin)_url.baseUrl="/"+obj.connectPin;if(!redirecting)doConnect()}else if(obj.authStatus==3)try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerAuthenticationFailed==null)$(window).trigger("serverAuthenticationFailed",obj.errormsg);else TVNC.rcParams.events.onServerAuthenticationFailed(obj.errormsg)}catch(error){helper.console.warning("'onServerAuthenticationFailed' calling attached method fail. message: "+error.message,
error,arguments)}else if(obj.authStatus==4)try{BTP_PT_NC=null;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerNeedCredentials==null)$(window).trigger("serverNeedCredentials",{"credentials":obj.credentials});else TVNC.rcParams.events.onServerNeedCredentials({"credentials":obj.credentials})}catch(error){helper.console.warning("'onServerNeedCredentials' calling attached method fail. message: "+error.message,error,arguments)}else if(obj.errormsg)if(obj.license){if(TVNC.connected)TVNC.disconnect();
let licenseError={title:consts.licenseError,errorType:_licenseTypes.ERR_TYPE_ERROR,errorCode:obj.state||1,errorMsg:obj.errormsg};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onLicenseMsg==null)$(window).trigger("licenseMsg",licenseError);else TVNC.rcParams.events.onLicenseMsg(licenseError)}else{var idZero=typeof obj!="undefined"&&obj["id"]=="0";if(idZero&&!connection.fromReconnection){TVNC.disconnect();TVNC.dispose(undefined,{"code":-1,"message":obj.errormsg})}try{if(typeof TVNC.rcParams.events==
"undefined"||TVNC.rcParams.events.onServerConnectionError==null)$(window).trigger("serverConnectionError",helper.string.sprintf(consts.connAttemptFailed,obj.errormsg));else TVNC.rcParams.events.onServerConnectionError(helper.string.sprintf(consts.connAttemptFailed,obj.errormsg))}catch(error){helper.console.error("'onServerConnectionError' calling attached method fail.",error,arguments)}if(!idZero&&_comm.state!==Thinfinity.Communication.state.RECONNECTING){var status={"code":_enumCloseStatusReason.ERROR,
"message":obj.errormsg};if(productId=="ZSC")TVNC.dispose(false,status);else TVNC.dispose(undefined,status)}else if(idZero)return;else{clearTimeout(timeoutIdBeforeReconnect);timeoutIdBeforeReconnect=setTimeout(function(){TVNC.reconnect()},timeBeforeReconnect)}}else if(obj.id=="lnk"){TVNC.disconnect();TVNC.dispose();window.location.href=obj.url;return}else tryToConnectAgain();obj=null}catch(err){var msg=err;if(err.message)msg=err.message;logError("serverConnectionError: "+msg);try{if(typeof TVNC.rcParams.events==
"undefined"||TVNC.rcParams.events.onServerConnectionError==null)$(window).trigger("serverConnectionError",msg);else TVNC.rcParams.events.onServerConnectionError(msg)}catch(error){helper.console.error("'onServerConnectionError' calling attached method fail.",error,arguments)}}else tryToConnectAgain()};this.gup=function(name){var regex=new RegExp("[\\?&]"+name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)","ig");var results=regex.exec(window.location.href);regex=null;if(results==null)return"";
else return results[1]};this.refresh=function(){TVNC.removeCanvases();_displayManager.fireEvent("resetCursor");TVNC.sendCmd("cmd=refresh")};function ajaxSuccessHandler(data){errorOccurs=0;TVNC.xmlHttpJson=null;if(data!=""&&data)try{if(typeof data.oob!="undefined"){TVNC.fireOOBCmd(data.cmd,data);setTimeout(TVNC.reload,1)}else{data.imgQueue=TVNC.imgQueue;TVNC.msgQueue.push(data);TVNC.buildImgQueue(data);TVNC.processNextScreen();data=null}}catch(err){logError("ajax error: "+err+"\n"+data)}else helper.console.warning("No data on success")}
function ajaxErrorHandler(e,xhr){if(TVNC.xmlHttpJson){TVNC.xmlHttpJson.abort();TVNC.xmlHttpJson=null}if(xhr.status==0&&xhr.statusText=="timeout")restart(true);else if(xhr.status==404)TVNC.connect();else setTimeout(TVNC.reload,1)}this.reload=function(){if(_comm.state>=Thinfinity.Communication.state.CLOSING)return;if(TVNC.useAjax)_comm.getNextChunk();else TVNC.sendAck()};this.clearMouse=function(){this.mouseMoved=false};this.wsSend=function(query,type,data){_comm.wsSend(query,type,data)};this.sendEvent=
function(query,jData){if(_comm.protocol===Thinfinity.Communication.protocol.WEBSOCKET)_comm.wsSend(query);else if(_comm.state<Thinfinity.Communication.state.UNSTABLE)_comm.send(TVNC.completeAjaxParams({"queueName":this.queueRequestName,"url":TVNC.addExtraParams(_url.httpConnection+"cmd?"+query),"async":true,"dataType":_defaultResponseType}));if(_registeredEventsServicesList[_enumEventsServices.SENDEVENT]&&jData){jData.timeStamp=(new Date).getTime();_registeredEventsServicesList[_enumEventsServices.SENDEVENT](jData)}};
this.sendKey=function(key,ch,action,location){if(TVNC.rcParams.active&&TVNC.rcParams.kbdControl)if(typeof TVNC.rcParams.events!="undefined"&&TVNC.rcParams.events.onSendKeys!=null)try{TVNC.rcParams.events.onSendKeys(key,ch,action)}catch(error){helper.console.error("'onSendKeys' calling attached method fail.",error,arguments)}else{if(TVNC.rcParams.kbdLogKeys===true)logDebug("sendKey("+key+", "+ch+", "+action+")");var jData={"cmd":"keyb","key":key,"action":action,"id":TVNC.rcParams.id,"char":escape(ch)};
var cmd="cmd=keyb&key="+key+"&action="+action+"&id="+TVNC.rcParams.id+"&char="+escape(ch);if(typeof location!="undefined"){cmd+="&location="+location;jData.location=location}TVNC.sendEvent(cmd,jData)}};this.sendFunctionKey=function(key){if(TVNC.rcParams.active&&TVNC.rcParams.kbdControl){var jData={"cmd":"fkey","key":encodeURIComponent(key),"id":TVNC.rcParams.id};TVNC.sendEvent("cmd=fkey&key="+encodeURIComponent(key)+"&id="+TVNC.rcParams.id,jData)}};this.sendText=function(text){for(var c=0;c<text.length;c++){TVNC.sendKey(0,
text.charCodeAt(c),"down",0);TVNC.sendKey(0,text.charCodeAt(c),"up",0)}};this.sendKeyStroke=function(key){TVNC.sendKeyDown(key);TVNC.sendKeyUp(key)};this.sendKeyDown=function(key){TVNC.sendKey(key,0,"down",0)};this.sendKeyUp=function(key){TVNC.sendKey(key,0,"up",0)};this.sendCtrlAltDel=function(){TVNC.sendFunctionKey("CtrlAltDel")};this.sendShiftCtrlEsc=function(){TVNC.sendFunctionKey("ShiftCtrlEsc")};this.sendShellExplorer=function(){TVNC.sendFunctionKey("WindowsExplorer")};this.sendShellRun=function(){TVNC.sendFunctionKey("Run")};
this.sendCtrlEsc=function(){TVNC.sendFunctionKey("CtrlEsc")};this.sendCut=function(){TVNC.sendFunctionKey("Cut")};this.sendCopy=function(){TVNC.sendFunctionKey("Copy")};this.sendPaste=function(){TVNC.sendFunctionKey("Paste")};this.translateMouseCoordX=function(x){return x};this.translateMouseCoordY=function(y){return y};this.sendMouse=function(x,y,button,action){if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl&&TVNC.allowMouse){if(TVNC.useAjax&&action=="move"&&_comm.queueLength(TVNC.queueRequestName)>
0)return;TVNC.clearMouse();TVNC.lastMouseAction=action;x=parseInt(x,10)+TVNC.rcParams.viewLeft;y=parseInt(y,10)+TVNC.rcParams.viewTop;var tx=TVNC.translateMouseCoordX(x);var ty=TVNC.translateMouseCoordY(y);var jData={"cmd":"mouse","x":tx,"y":ty,"btn":button,"action":action,"id":TVNC.rcParams.id};TVNC.sendEvent("cmd=mouse&x="+tx+"&y="+ty+"&btn="+button+"&action="+action+"&id="+TVNC.rcParams.id,jData)}};this.sendMouseQueue=function(){clearTimeout(_mouseQueueTimeout);if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl&&
TVNC.allowMouse){if(mouseBuffer.queue.length>0){var buffer=mouseBuffer.queue;if([Thinfinity.Communication.state.RECONNECTING,Thinfinity.Communication.state.UNSTABLE,Thinfinity.Communication.state.LOST].indexOf(_comm.state)!=-1)for(var i=buffer-length-1;i>=0;i--)if(buffer[i].action=="move"){var temp=buffer[i];buffer=[];buffer.push(temp);break}TVNC.lastMouseAction=buffer[buffer.length-1].action;var sBuffer=JSON.stringify(buffer);TVNC.sendEvent("cmd=mouse&data="+sBuffer+"&id="+TVNC.rcParams.id,{"cmd":"mouse",
"data":sBuffer,"id":TVNC.rcParams.id});mouseBuffer.queue=[]}_mouseQueueTimeout=setTimeout(TVNC.sendMouseQueue,10)}};this.sendMouseMove=function(){clearTimeout(_mouseQueueTimeout);if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl&&!_avoidSendMouseMove){if(TVNC.mouseMoved)TVNC.sendMouse(TVNC.mouseX,TVNC.mouseY,0,"move");else if(TVNC.lastMouseAction=="move")TVNC.lastMouseAction="";_mouseQueueTimeout=setTimeout(TVNC.sendMouseMove,TVNC.rcParams.mouseMoveProcessInterval)}};this.sendWheel=function(deltaY,
deltaX){if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl){var action="";var delta=0;if(deltaY!=0){action="wheel";delta=deltaY*_deltaYMultiplier}else{action="hwheel";delta=deltaX}var jData={"id":TVNC.rcParams.id,"action":action,"delta":delta};if(mouseBuffer.isAvailable)mouseBuffer.queue.push(jData);else TVNC.sendEvent("cmd=mouse&id="+TVNC.rcParams.id+"&action="+action+"&delta="+delta,jData)}};this.IsNumKey=function(code){return code>=96&&code<=111&&code!=108||code==144};this.isIMEKey=function(e){return(e.which||
e.keyCode)==229};this.isMacAltKey=function(e){return this.mac&&e.altKey};this.IsFunctionKey=function(keyCode){return keyCode>=112&&keyCode<=123||keyCode>=33&&keyCode<=40||keyCode>=45&&keyCode<=46||keyCode>=16&&keyCode<=20||keyCode>=91&&keyCode<=93||keyCode==13||keyCode==9||keyCode==8||keyCode==27||keyCode==144||keyCode==12||keyCode==224};this.hookKM=function(){if(!TVNC.MouseHooked){TVNC.MouseHooked=true;if(TVNC.rcParams.hookMouse);TVNC.bindKeyboardEvents()}};this.clearKbdMacInputTimer=function(){window.clearInterval(this.kbdMacInputTimer);
this.kbdMacInputTimer=null};this.inputAllowed=function(e){if(e&&_preventKeys.available)if(_preventKeys.keys[e.keyCode]){var modifiers=_preventKeys.keys[e.keyCode];var prevent=true;for(var mk in modifiers){prevent&=e[mk]===modifiers[mk];if(!prevent)break}if(prevent)return false}var isUIBlocked=$(".blockUI.blockOverlay:visible").length>0;var isIndex=false;if(productId=="ZSC"){if(emulcont==null)emulcont=document.getElementById("emulcont");if(emulcont&&parseInt(emulcont.style.left.replace("px",""),10)>
0)isIndex=true}return _comm.state<Thinfinity.Communication.state.UNSTABLE&&!isUIBlocked&&!isIndex&&(!TVNC.rcParams.useFocus||TVNC.inputEnabled)};this.bindKeyboardEvents=function(){TVNC.inputEnabled=true;if(TVNC.rcParams.hookKeyboard)if(TVNC.KeyboardHooked)_displayManager.focus();else{if(agentInfo.isMobile&&productId=="ZSC")return;TVNC.KeyboardHooked=true}};this.unbindKeyboardEvents=function(){TVNC.inputEnabled=false};this.mouseDown=function(x,y,button){_displayManager.fireEvent("mouseDown",x,y,button,
{async:false})};this.mouseUp=function(x,y,button){_displayManager.fireEvent("mouseUp",x,y,button,{async:false})};this.mouseMove=function(x,y){_displayManager.fireEvent("mouseMove",x,y,{async:false})};this.setFocus=function(X,Y){var position=TVNC.findPos(TVNC.vncContainer);let gs=_displayManager.processDisplayCmd("GET_SCALE");X=Math.round((X-position[0])/gs);Y=Math.round((Y-position[1])/gs);$('[id^="'+productId+'_"]').each(function(index){var win=$(this)[0];if(win.offsetLeft<=X&&win.offsetTop<=Y&&
win.offsetLeft+win.offsetWidth>=X&&win.offsetTop+win.offsetHeight>=Y)return win});return null};this.hasChildOfByClassName=function(classname,child){var elems=document.getElementsByClassName(classname);for(var i=0;i<elems.length;i++)if(elems[i].contains(child))return true;return false};this.getElementFromPoint=function(e){var x,y;if((e.changedTouches||e.touches)&&(e.changedTouches||e.touches).length>0){x=(e.changedTouches||e.touches)[0].pageX-document.body.offsetLeft;y=(e.changedTouches||e.touches)[0].pageY-
document.body.offsetTop}else if(e.clientX!=undefined||e.pageX!=undefined){x=e.clientX||e.pageX-document.body.offsetLeft;y=e.clientY||e.pageY-document.body.offsetTop}else if(e.pointers!=undefined&&e.pointers.length>0){x=e.pointers[0].pageX-document.body.offsetLeft;y=e.pointers[0].pageY-document.body.offsetTop}var idMask=productId+"_canvas_";var selectedElement=document.elementFromPoint(x,y);if(selectedElement&&(!helper.style.hasClass(selectedElement,"__uselocalmouse__")&&!TVNC.hasChildOfByClassName("__uselocalmouse__",
selectedElement)&&(selectedElement.tagName=="CANVAS"||selectedElement.name=="caret"||selectedElement.id=="caret"||selectedElement==TVNC.vncdiv||selectedElement.id.indexOf(idMask)!=-1||helper.style.hasClass(selectedElement,"ignoremouse"))))return null;else return selectedElement};this.setClipboardPosition=function(){};function isInsideOfArea(x,y,rad){return Math.pow(x,2)+Math.pow(y,2)<=rad}this.checkPacketIndex=function(pckIdx,groupIdx,eod){if(_lastPkt.idx==99&&pckIdx==0&&eod)_lastPkt.idx=-1;if(_lastPkt.idx==
-1&&_lastPkt.reset){_lastPkt.reset=false;_lastPkt.idx=pckIdx-1}if(_lastPkt.idx+1!=pckIdx){if(_lastPkt.idx+1<pckIdx){TVNC.logger.logWarning(helper.string.format("Missing pkt: {2} - last: {0}, current: {1}, groupIdx: {3}, UBRWID: {4}",_lastPkt.idx,pckIdx,_lastPkt.idx+1,groupIdx,TVNC.rcParams.UBRWID),"*");helper.console.warning(helper.string.format("Missing pkt: {2} - last: {0}, current: {1}, groupIdx: {3}, UBRWID: {4}",_lastPkt.idx,pckIdx,_lastPkt.idx+1,groupIdx,TVNC.rcParams.UBRWID),arguments)}else{TVNC.logger.logWarning(helper.string.format("Pkt treated - last: {0}, current: {1}, groupIdx: {2}, UBRWID: {3}",
_lastPkt.idx,pckIdx,groupIdx,TVNC.rcParams.UBRWID),"*");helper.console.warning(helper.string.format("Pkt treated - last: {0}, current: {1}, groupIdx: {2}, UBRWID: {3}",_lastPkt.idx,pckIdx,groupIdx,TVNC.rcParams.UBRWID),arguments)}if(eod)_lastPkt.idx=pckIdx;restartConnection()}else if(eod)_lastPkt.idx=pckIdx;else if(_lastPkt.idx==-1)_lastPkt.idx=0};this.getNextHighestZindex=function(obj){var highestIndex=0;var currentIndex=0;var elArray=Array();if(obj)elArray=obj.getElementsByTagName("*");else elArray=
document.getElementsByTagName("*");for(var i=0;i<elArray.length;i++){if(elArray[i].currentStyle)currentIndex=parseFloat(elArray[i].currentStyle["zIndex"]);else if(window.getComputedStyle)currentIndex=parseFloat(document.defaultView.getComputedStyle(elArray[i],null).getPropertyValue("z-index"));if(!isNaN(currentIndex)&&currentIndex>highestIndex)highestIndex=currentIndex}return highestIndex+1};function checkSplashPopup(){var elem=document.querySelector(_splashCssName);if(elem)if(elem.style.getPropertyValue("display")!=
"none"&&elem.style.getPropertyValue("visibility")!="hidden"){var b=elem.getBoundingClientRect();return b.x>0&&b.x<TVNC.rcParams.width&&b.y>0&&b.y<TVNC.rcParams.height&&b.height>0&&b.width>0}else return false;else return false}this.reconnect=function(){if(_comm.state>=Thinfinity.Communication.state.CLOSING)return;connection.fromReconnection=true;if(Thinfinity.Popups&&Thinfinity.Popups.growl)Thinfinity.Popups.growl.unblockAll();TVNC.processNextScreenEnabled=true;if(document.getElementById(TVNC.reconnectDivId)==
null){if(!TVNC.rcParams.overrideCursor)_displayManager.fireEvent("resetCursor");if(!_avoidConnectionLostPopup)TVNC.showReconnectDiv(true);try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerReconnect==null)$(window).trigger("serverReconnect");else TVNC.rcParams.events.onServerReconnect()}catch(error){helper.console.error("'onServerReconnect' calling attached method fail.",error,arguments)}if(TVNC.useAjax){if(TVNC.xmlHttpJson){TVNC.xmlHttpJson.abort();TVNC.xmlHttpJson=null}_comm.releaseQueue(TVNC.queueRequestName)}}if(helper.object.existsPath(TVNC,
"rcParams.scraperArgs")&&typeof TVNC.rcParams!="undefined"&&(TVNC.rcParams.resolution=="fittobrowser"||TVNC.rcParams.resolution=="fittoscreen")){var w=window.environment.detectedWidth;var h=window.environment.detectedHeight;if(helper.object.existsPath(self,"clientSettings.UseViewportSize")&&self.clientSettings.UseViewportSize){w=window.environment.viewportWidth;h=window.environment.viewportHeight}if(helper.object.getDataTypeOf(TVNC.rcParams.scraperArgs)=="json"){TVNC.rcParams.scraperArgs.browserWidth=
w;TVNC.rcParams.scraperArgs.browserHeight=h}else{TVNC.rcParams.scraperArgs=TVNC.removeBrowserSize(TVNC.rcParams.scraperArgs);TVNC.rcParams.scraperArgs+="&browserWidth="+w+"&browserHeight="+h}}TVNC.connect()};this.supportsHTML5Storage=function(){try{return"localStorage"in window&&window["localStorage"]!=null}catch(err){return false}};this.getStorageName=function(){var middle=this.rcParams.address?"_"+this.rcParams.address:"";return"thinvnc"+middle+"_prefs"};this.loadPreferences=function(){if(!this.supportsHTML5Storage())return;
try{var objJson=localStorage.getItem(this.getStorageName());var objData=JSON.parse(objJson);if(objData!=null&&typeof objData!="undefined")_onlyKeyCode=objData.onlykeycode!=null?objData.onlykeycode:_onlyKeyCode}catch(err){}};this.savePreferences=function(){if(!this.supportsHTML5Storage())return;try{var objData=new Object;objData.onlykeycode=_onlyKeyCode;var objJson=JSON.stringify(objData);localStorage.setItem(this.getStorageName(),objJson)}catch(err){}};this.applyParam=function(params,name,value){if(typeof value==
"object"&&value!=null){var obj=params[name];if(!obj)obj={};for(var v in value)obj[v]=value[v];params[name]=obj}else params[name]=value};this.setParams=function(dd,ee){for(var o in dd)this.applyParam(TVNC.rcParams,o,dd[o]);this.rcParams.events=ee;TVNC.rdpMode=this.rcParams.scraper=="RDP"};this.resolveAgent=function(){TVNC.majorVersion=agentInfo.majorVersion;TVNC.firefoxVersion=agentInfo.firefoxVersion;TVNC.mac=agentInfo.isMac;TVNC.ios=agentInfo.isIOS;TVNC.iosVersion=agentInfo.iosVersion;TVNC.iphone=
agentInfo.isIphone;TVNC.android=agentInfo.isAndroid;TVNC.hptablet=agentInfo.isHPTablet;TVNC.playbook=agentInfo.isPlaybook;TVNC.chromeOS=agentInfo.isChromeOS;TVNC.symbian=agentInfo.isSymbian;TVNC.firefox=agentInfo.isFirefox;TVNC.firefoxVersion=agentInfo.firefoxVersion;TVNC.opera=agentInfo.isOpera;TVNC.chrome=agentInfo.isChrome;TVNC.safari=agentInfo.isSafari;TVNC.msie=agentInfo.isMSIE;TVNC.msieVersion=agentInfo.msieVersion;TVNC.nokia=agentInfo.isNokiaBrowser;TVNC.mobile=agentInfo.isMobile&&!TVNC.rcParams.forceDesktop;
TVNC.touch=agentInfo.isTouch;TVNC.agentName=agentInfo.getAgentKey()};this.appendElement=function(parentElem,type,name,attrColl,content){var elem=document.createElement(type);if(name!=null&&name!=""){elem.setAttribute("name",name);elem.setAttribute("id",name)}for(var a in attrColl)if(a=="style"){var s=attrColl[a].split(";");s.forEach(function(item){var kvp=item.split(":");elem.style[helper.string.trim(kvp[0])]=helper.string.trim(kvp[1])})}else elem.setAttribute(a,attrColl[a]);if(content)elem.innerHTML=
content;parentElem.appendChild(elem);return elem};this.initfs=function(dbname){if(!this.rcParams.persistentCache){TVNC.cacheLoaded=true;TVNC.sendStart();return}if(typeof FS!="undefined"&&!TVNC.fs){TVNC.fs=new FS(dbname);TVNC.fs.init(function(){TVNC.fs.enumFiles(function(filename){TVNC.dbFiles.push(filename)},function(){TVNC.cacheLoaded=true;TVNC.sendStart()})},function(){delete TVNC.fs;TVNC.fs=null;TVNC.cacheLoaded=true;TVNC.sendStart()})}else{TVNC.cacheLoaded=true;TVNC.sendStart()}};this.applyParams=
function(dd){for(var o in dd)this.rcParams[o]=dd[o];TVNC.vncdivId=TVNC.rcParams.divId?TVNC.rcParams.divId:TVNC.vncdivId;TVNC.centered=TVNC.rcParams.centered;if(this.rcParams.showOnStart==false)if(Thinfinity.Popups&&Thinfinity.Popups.establishing.backgroundStyle===Thinfinity.Popups.establishing.backgroundStyles.NONE)TVNC.hide();TVNC.vncdiv=document.getElementById(TVNC.vncdivId);if(typeof TVNC.vncdiv=="undefined"||TVNC.vncdiv==null){var errorMsg="Container element is null or undefined, "+consts.technicalSupport;
logError(errorMsg);try{let oError={message:errorMsg};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerError==null)$(window).trigger("serverError",oError);else TVNC.rcParams.events.onServerError(oError)}catch(error){helper.console.error("'onServerError' calling attached method fail.",error,arguments)}TVNC.disconnect();throw new Error(errorMsg);}if(!TVNC.vncdiv)throw new Error("the "+TVNC.vncdivId+" is not available");TVNC.savedMaxWidth=TVNC.rcParams.maxWidth;TVNC.savedMaxHeight=
TVNC.rcParams.maxHeight;if(TVNC.rcParams.fitmode==0||TVNC.rcParams.fitToBrowser==true){TVNC.vncdiv.style.position="relative";TVNC.vncdiv.style.overflow="hidden";TVNC.vncdiv.style.top="0px";TVNC.vncdiv.style.marginTop="0px";TVNC.vncdiv.style.left="0px";TVNC.vncdiv.style.marginLeft="0px"}};this.init=function(dd){TVNC.applyParams(dd);var tempForceAjax=TVNC.gup("forceAjax");if(tempForceAjax!=""){TVNC.rcParams.forceAjax=helper.object.convertTo(tempForceAjax,"boolean");_comm.protocol=Thinfinity.Communication.protocol.AJAX}TVNC.resolveAgent();
if(TVNC.rdpMode&&TVNC.centered&&agentInfo.isMobile&&window.environment.supportsFullScreen){TVNC.vncContainer=document.getElementById("vncContainer");if(TVNC.vncContainer==null){TVNC.vncContainer=document.createElement("div");TVNC.vncContainer.id="vncContainer";TVNC.vncContainer.style.margin="auto auto";TVNC.vncContainer.style.height="auto";TVNC.vncContainer.style.width="auto";TVNC.vncContainer.style.minWidth="100px";TVNC.vncContainer.style.minHeight="100px";TVNC.vncContainer.style.backgroundColor=
"transparent";TVNC.vncContainer.style.position="relative";TVNC.vncdiv.appendChild(TVNC.vncContainer)}}else TVNC.vncContainer=TVNC.vncdiv;function isEmbeddedPrinter(){try{return window&&window.parent&&window.parent.document.getElementsByClassName("embedded-printer-device-container").length>0}catch(error){return false}}if(helper.object.existsPath(window,"Thinfinity.VisualEffect")){function isSlideMode(){try{if(window!=window.parent&&typeof window.parent!="undefined")if(window.parent.document&&window.parent.document.getElementsByTagName){var iframes=
window.parent.document.getElementsByTagName("iframe");for(var ifrIdx=0;ifrIdx<iframes.length;ifrIdx++)if(iframes[ifrIdx].contentWindow.name==window.name)return true;iframes=null}}catch(error){}return false}if(!isEmbeddedPrinter())_visualEffect=new Thinfinity.VisualEffect({"id":"visualEffectContainer","container":productId=="ZSC"?isSlideMode()?document.body:document.getElementById("prnBefore")||TVNC.vncContainer:TVNC.vncContainer,"allowReconnectionDialog":true,"events":{"onCancel":function(){TVNC.closeReconnectDiv();
TVNC.disconnect();$(document).unbind();$("#"+TVNC.vncdivId).unbind()}}})}TVNC.supportsCanvas=!!document.createElement("canvas").getContext;if(!_url.baseUrl){var path=TVNC.rcParams.url?TVNC.rcParams.url:window.location.href;var pathArray=path.split("/");if(TVNC.rcParams.protocol==""||!TVNC.rcParams.protocol)TVNC.rcParams.protocol=pathArray[0];if(TVNC.rcParams.server==""||!TVNC.rcParams.server)TVNC.rcParams.server=pathArray[2];_url.baseUrl="/";for(i=3;i<pathArray.length-1;i++){_url.baseUrl+=pathArray[i];
_url.baseUrl+="/"}}TVNC.loadPreferences();clearTimeout(TVNC.emptyRecycleImgTimeout);TVNC.emptyRecycleImgTimeout=setTimeout(TVNC.emptyRecycleImg,TVNC.recycleImgTimeoutValue);for(i=0;i<12;i++)this.rdpGlyphArray[i]=Array(256);TVNC.registerOOBCmd("cookie",function(obj){var cookieString=obj&&obj.cookie?obj.cookie:null;if(cookieString&&typeof cookieString==="string"&&cookieString.trim().length>0){writeCookies(extractCookie(cookieString,true),true);syncCookies()}});TVNC.registerOOBCmd("aslwarning",function(obj){var secondsToClose=
obj&&obj.secondsToClose?obj.secondsToClose:null;if(secondsToClose&&secondsToClose>0){var unit=consts.minutes;var min=obj.secondsToClose/60;var val=null;var color="";if(min===1){unit=consts.minute;val=min}else if(min>1){min=Math.ceil(min);unit=consts.minutes;val=min}else{min=Math.trunc(min);unit=consts.seconds;color="color:red;";val=secondsToClose}var msg=helper.string.sprintf(consts.sessionTimeout,`<b style="${color}">${val}</b>`,unit);var data={"secondsToClose":secondsToClose,"minutesToClose":min,
"message":msg};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onSessionTimeout==null)$(window).trigger("SessionTimeout",data);else TVNC.rcParams.events.onSessionTimeout(data)}});TVNC.registerOOBCmd("licenseMsg",function(obj){obj.title=consts.licenseError;if(obj&&obj.errorType===_licenseTypes.ERR_TYPE_ERROR){if(typeof obj.errorCode!="undefined"){helper.console.warning(helper.string.format("Error Code: {0}, Message: {1}",obj.errorCode,obj.errorMsg),arguments);if(TVNC.connected)TVNC.disconnect()}}else helper.console.warning(obj.title+
" "+obj.errorMsg,arguments);let res=false;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onLicenseMsg==null)$(window).trigger("licenseMsg",obj);else res=TVNC.rcParams.events.onLicenseMsg(obj);if(!res)TVNC.dispose(undefined,{"title":obj.title,"message":obj.errorMsg})})};function getComponentSettings(callback){helper.ajax.get({"url":`${helper.url.parseUrl(location.href).toUrl("-a-r")}/component.settings.json`,"type":helper.ajax.responseType.JSON,"success":callback,"error":function(e,
status,xhr){callback(null)}})}function initializeComponents(permissions){var _isLegacy=typeof cookiePrefix==="undefined"||cookiePrefix!=="fmx"?false:typeof legacyVersion!="undefined"?legacyVersion:true;if(!_componentsInitialized&&Thinfinity.Component&&Thinfinity.Component.RegistrationServices&&!_isLegacy){var panelContructor=function(params){if(Thinfinity.Component.Panel)return new Thinfinity.Component.Panel({"parentElement":document.body,"params":params})};getComponentSettings(function(components){_componentRegistrationServices=
new Thinfinity.Component.RegistrationServices({"owner":TVNC,"permissions":permissions,"components":components,"constructors":{"PANEL":panelContructor},"getAuthorization":function(name,callback){callback(true)}});_componentsInitialized=true});helper.dom.addEvent(window,"thinfinity.components.registration.services.ready",function(){if(_oInterface)TVNC.registerComponentObject("OINTERFACE",_oInterface)})}}function sendCookiesCmd(success,error){var d=new Date;var n=d.getTime();var url=_url.httpConnection+
"cmd?id="+TVNC.rcParams.id+"&cmd=cookie&dt="+n;writeCookies(_syncCookies.data,false);_comm.post({"url":url,"data":'{"cookie":'+n+"}","type":"json","success":success,"error":error})}function getCurrentCookiePath(){return _url.brokerUrl.replace(/\/$/,"")}function getFullCookiePath(){return _url.baseUrl.replace(/\/$/,"")}function startCookiesSync(){clearTimeout(_syncCookies.syncCookiesTOUT);if(_syncCookies.syncCookiesEnabled)_syncCookies.syncCookiesTOUT=setTimeout(()=>{syncCookies(startCookiesSync)},
_syncCookies.syncCookiesTime)}function extractCookie(strCookies,singleCookie){let cookieData=null;let name=null;if(strCookies!=""){cookieData={};strCookies.split(";").forEach(c=>{let [k,v]=c.split("=");k=k.trim();if(singleCookie)if(!name){name=k;cookieData[name]={name,value:v,expires:null,path:getCurrentCookiePath(),domain:null,svalue:null,targetPath:getFullCookiePath()}}else{if(cookieData[name].hasOwnProperty(k))cookieData[name][k]=v}else cookieData[k]={name:k.trim(),value:v,expires:null,path:getCurrentCookiePath(),
domain:null,svalue:null,targetPath:getFullCookiePath()}})}return cookieData}function writeCookies(data,toLocal){if(data){let expDate=(new Date(Date.now()+750)).toUTCString();Object.keys(data).forEach(k=>{let c=data[k];document.cookie=`${c.name}=${c.value};name=${c.name};${toLocal?"":"expires='"+expDate+"';"}path=${toLocal?c.path:c.targetPath}`})}}function syncCookies(callback){if(_syncCookies.syncCookiesEnabled&&_comm.state===Thinfinity.Communication.state.CONNECTED){let hasChanged=false;let _data=
extractCookie(document.cookie,false);if(_data)Object.keys(_data).forEach(k=>{if(!hasChanged)if(!_syncCookies.data[k])hasChanged=true;else{let l=_syncCookies.data[k];let r=_data[k];if(l.value!=r.value||l.path!=r.path||l.domain!=r.domain||l.expires!=r.expires)hasChanged=true}});if(hasChanged){_syncCookies.data=_data;sendCookiesCmd(callback,callback)}else callback()}else callback()}function stopSyncCookies(){_syncCookies.syncCookiesEnabled=false;clearTimeout(_syncCookies.syncCookiesTOUT);_syncCookies.syncCookiesTOUT=
null}this.openPrnManager=function(url,showCancel){function onShow(msg){Thinfinity.Popups.unblock();if(typeof msg=="undefined")msg=["<div class='popup' id='printDlg'><div id='printIco'>&nbsp;</div><div id='printDlgMsg'>",consts.printedDocReady,"</div><br/><div class='divbuttons'><a id='prnWOpenDocBtn' class='popuplink'>open</a>","<span id='prnWShowAllGroup'>&nbsp; &nbsp; <a id='prnWShowAllBtn' class='popuplink'>",consts.showAll,"</a>",showCancel?"&nbsp; &nbsp; <a class='popuplink' id='prnWCloseBtn' >"+
consts.discard+"</a>":"","</div></div>"].join("");var popup=new Thinfinity.Popups.popup;popup.block("printDlg",msg,null,function(e){$("#prnWOpenDocBtn").on("click",function(){TVNC.printerManager.openDocuments(true)});$("#prnWShowAllBtn").on("click",function(){TVNC.printerManager.showAllPrintings(true)});$("#prnWCloseBtn").on("click",function(){TVNC.printerManager.discard(true)});setTimeout(TVNC.reload,1)})}function onShowAll(obj){TVNC.printingWindow=window.open("printings.html","printingWindow")}
function onClose(){$.unblockUI();if(!!TVNC.printingWindow&&!TVNC.printingWindow.location)TVNC.printingWindow=null}function onEnqueueDocument(obj){if(obj.count==1){$("#printDlgMsg").html(consts.printedDocReady);$("#prnWShowAllGroup").hide()}else{$("#printDlgMsg").html(helper.string.sprintf(consts.printedDocsReady,obj.count));$("#prnWShowAllGroup").show()}}function onDiscard(){if(!!TVNC.printingWindow)if(!TVNC.printingWindow.location)TVNC.printingWindow=null;else TVNC.printingWindow.location.href=TVNC.printingWindow.location.href}
function onCheckVisibility(){var v=$("#printDlg").width();return v>0}if(!TVNC.printerManager)TVNC.printerManager=new PrinterManager({"onShow":onShow,"onShowAll":onShowAll,"onClose":onClose,"onEnqueueDocument":onEnqueueDocument,"onDiscard":onDiscard,"onCheckVisibility":onCheckVisibility});TVNC.printerManager.enqueueDocument(url)};this.openPrnWindow=function(url,showCancel){if(typeof PrinterManager!="undefined")this.openPrnManager(url,showCancel);else{var msg="<div class='popup' id='printDlg'><div id='printIco'>&nbsp;</div><div>"+
consts.printedDocReady+"</div><br/><div class='divbuttons'><a class='popuplink' href='"+(url.url.indexOf("?"+_SIDName+"=")==-1?url.url:url.url.substring(0,url.url.indexOf("?"+_SIDName+"=")))+"' target='_blank' onclick='$.unblockUI()'>open</a>";if(showCancel)msg+="&nbsp; &nbsp; <a class='popuplink' onclick='$.unblockUI()'>discard</a>";msg+="</div></div>";Thinfinity.Popups.unblock();var popup=new Thinfinity.Popups.popup;popup.block("printDlg",msg,null,function(){setTimeout(TVNC.reload,1)})}};this.openLinkDlg=
function(url,caption){helper.console.warning("openLinkDlg is deprecated, use 'Thinfinity.OpenLinkPopup'");if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onOpenLink==null)$(window).trigger("OpenLink",obj);else TVNC.rcParams.events.onOpenLink(obj)};function changeAppFocus(value){var cmd="cmd=focus"+"&value="+value;logDebug('switch app - "CTRL + TAB", cmd:'+cmd);TVNC.sendCmd(cmd)}this.show=function(){helper.style.add(TVNC.vncdiv,{"display":"inherit"})};this.hide=function(){helper.style.add(TVNC.vncdiv,
{"display":"none"})};function removeFunctions(){TVNC.zoomDesktop(1)}function sendTabFocusCmd(monitorId,cmd,value){if(_comm.state==Thinfinity.Communication.state.CONNECTED){TVNC.sendCmd(`cmd=${cmd}&value=${value.toString()}${typeof monitorId!=="undefined"?"&monitorId="+monitorId:""}`);if(_registeredEventsServicesList[_enumEventsServices.SENDEVENT]&&cmd!=="visibilityState")_registeredEventsServicesList[_enumEventsServices.SENDEVENT]({"timeStamp ":(new Date).getTime(),"cmd":"focus","value":value.toString(),
"monitorId":monitorId})}if(cmd==="focus"||cmd==="tabvisible")triggerCustomEvent(value?"focus":"blur");if(TVNC.rcParams.clipboard&&TVNC.rcParams.synchronizeClipboard){let b=value===true||value==="visible";if(!b)_clipSynchronized=false;else if(document.hasFocus()){_clipSynchronized=true;_displayManager.fireEvent("synchronizeRemoteClipboard",{async:false})}}}if(productId=="ZSC"&&TVNC.rcParams.hookKeyboard&&!TVNC.KeyboardHooked&&TVNC.triggerCustomEvent==undefined)Object.defineProperty(TVNC,"triggerCustomEvent",
{"enumerable":false,"configurable":false,"writable":false,"value":triggerCustomEvent});_packetReceiver=new Thinfinity.PacketReceiver({properties:{async:this.wsAsyncRecv,asyncTimeout:this.wsAsyncRecvTimeout,checkPacketIndex:this.isPktIdxEnabled},methods:{getRawBinaryHandler},handlers:{0:processJson,1:screenImage,3:queueText,5:function(group,arrayView){if(_ePictureType!==_enumPictureType.H264){triggerCustomEvent("H264");_ePictureType=_enumPictureType.H264;removeFunctions()}var id=arrayView[1];TVNC.sendCmd(`cmd=fc-pre&idx=${arrayView[2]}&id=${id}`);
_displayManager.processData(id,arrayView[0],arrayView.subarray(3))},6:function(group,arrayView){if(TVNC.rcParams.events.onFileStream)TVNC.rcParams.events.onFileStream(arrayView)},8:function(group,arrayView){if(_ePictureType===_enumPictureType.H264)return;if(_ePictureType!==_enumPictureType.GFX){triggerCustomEvent("GFX");_ePictureType=_enumPictureType.GFX;_displayManager.processData(null,Thinfinity.Display.Manager.EVENT_TYPES.GFX_RDP_INITIALIZE);removeFunctions()}_displayManager.processData(null,arrayView[0],
arrayView.subarray(1))}}});_packetReceiver.on("warning",function(msg){helper.console.warning(msg+", UBRWID: "+TVNC.rcParams.UBRWID,arguments);TVNC.logger.logWarning(msg+", UBRWID: "+TVNC.rcParams.UBRWID)});_packetReceiver.on("restartConnection",restartConnection);Object.defineProperty(this,"registerCustomHandler",{"enumerable":false,"configurable":false,"writable":false,"value":_packetReceiver.registerHandler});function processJson(group,arrayView,json){json=json||TVNC.arbufToStringU8((new Zlib.RawInflate(arrayView)).decompress());
if(json==="{}")return;try{var obj=JSON.parse(json)}catch(err){logError("err: "+err);logError("json: "+json);return}json=null;obj.group=group;if(typeof obj.oob!="undefined"){if(TVNC.fireOOBCmd(obj.cmd,obj))return;if(obj.cmd=="getImgCache"){var cmd="cmd=imgCache";cmd+="&items="+getImageCacheList(cmd.compression);TVNC.sendCmd(cmd)}else if(obj.cmd=="getNativeClasses"){var cmd="cmd=nativeClasses";cmd+="&items="+TVNC.controlFactory.getClassList();TVNC.sendCmd(cmd)}else if(obj.cmd=="openUrl")if(typeof TVNC.rcParams.events==
"undefined"||TVNC.rcParams.events.onOpenLink==null)$(window).trigger("OpenLink",obj);else TVNC.rcParams.events.onOpenLink(obj);else if(obj.cmd=="showMsg")if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerMessage==null)$(window).trigger("ServerMessage",obj);else TVNC.rcParams.events.onServerMessage(obj);else if(obj.cmd=="shadowingStatus")if(typeof TVNC.rcParams.events?.onShadowingStatus)TVNC.rcParams.events.onShadowingStatus(obj.shadowed);else $(window).trigger("ShadowingStatus",
obj.shadowed);else if(obj.cmd=="clisync"){if(TVNC.rcParams.clipboard&&TVNC.rcParams.synchronizeClipboard){_clipSynchronized=true;_displayManager.fireEvent("synchronizeLocalClipboard",obj,{async:false})}}else if(TVNC.controlFactory)TVNC.controlFactory.dispatchEvent(obj.oob,obj.cmd,obj)}else if(typeof obj.id!="undefined")TVNC.serverCmdResult(obj);else if(obj.preidx)TVNC.sendCmd("cmd=fc-pre&idx="+obj.preidx);else if(obj.status){obj.imgQueue=TVNC.imgQueue;TVNC.msgQueue.push(obj);TVNC.processNextScreen()}}
function screenImage(group,arrayView){var key=((arrayView[0]-48)*1E4|0)+((arrayView[1]-48)*1E3|0)+((arrayView[2]-48)*100|0)+((arrayView[3]-48)*10|0)+(arrayView[4]-48)|0;key=TVNC.getKeyFromCmd(group,key);var type=TVNC.arbufToStringU8(arrayView.subarray(5,9)).replace(/ /g,"");var hashLength=0;var hash="";dataIndex=9;var item=TVNC.getImageItem();if(type=="idec")item.fromImageDecoderData(arrayView.subarray(dataIndex),type,hash,key);else{if(arrayView[dataIndex]==58){++dataIndex;do++hashLength;while(arrayView[dataIndex+
hashLength]!=58);hash=TVNC.arbufToStringU8(arrayView.subarray(dataIndex,dataIndex+hashLength));dataIndex+=hashLength+1}item.fromImageArray(arrayView.subarray(dataIndex),type,hash,key)}}function queueText(buffer){var item=TVNC.getImageItem();item.encoded.data=buffer;TVNC.addToImgQueueAndExecute(TVNC.imgQueue,item)}if(window.eScript&&window.embedScriptLog&&window.embedScriptLog["thinvnc.sdk"]){this.eval=function(str){eval(str)};eScript.add(window.embedScriptLog["thinvnc.sdk"],this);if(window.browserTracking)browserTracking.on("disconnect",
function(){TVNC.disconnect();TVNC.dispose()})}Object.defineProperty(TVNC,"fromReconnection",{"enumerable":true,"configurable":false,"get":function(){return connection?connection.fromReconnection:false}});try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(!Thinfinity.thinVncSdk)Object.defineProperty(Thinfinity,"thinVncSdk",{"enumerable":false,"configurable":false,"get":function(){return TVNC}});initialize();var _statusVariables=[{"name":"status","title":"Status","get":function(){return Thinfinity.Communication.state.getKey(_comm.state)},
"index":10},{"name":"protocol","title":"Protocol","get":function(){return Thinfinity.Communication.protocol.getKey(_comm.protocol)},"index":15},{"name":"forceAjax","title":"ForceAjax","get":function(){return TVNC&&TVNC.rcParams?TVNC.rcParams.forceAjax:"undefined"},"index":20},{"name":"h264","title":"Running H264","get":function(){return TVNC.H264},"index":30},{"name":"GFX","title":"Running GFX","get":function(){return TVNC.GFX},"index":30},{"name":"localServer","title":"LocalServer","get":function(){return Thinfinity&&
Thinfinity.VirtualChannels?Thinfinity.VirtualChannels.localServer:"undefined"},"index":45},{"name":"useAjax","title":"UseAjax","get":function(){return TVNC&&TVNC.observable?TVNC.observable.useAjax:"undefined"},"index":25},{"name":"resolution","title":"Resolution","get":function(){return TVNC&&TVNC.rcParams?TVNC.rcParams.resolution:"undefined"},"index":37},{"name":"soundStatus","title":"Sound Status","get":function(){if(TVNC&&TVNC.sound){var ctxAudio=TVNC.sound.audioContext||TVNC.sound.audioMozAudio;
if(ctxAudio&&ctxAudio.state)return ctxAudio.state}else return"undefined"},"index":41},{"name":"soundLastUpdate","title":"Sound Last Update","get":function(){return TVNC&&TVNC.sound?TVNC.sound.audioLastTicksUpdate:"undefined"},"index":42}];if(_ePictureType===_enumPictureType.H264)_statusVariables.push({"name":"decoder","title":"Decoder","get":function(){return _displayManager?_displayManager.decoderType:"undefined"},"index":31});try{window.dispatchEvent(new CustomEvent("addStatusAPIVariables",{"detail":_statusVariables}))}catch(error){}};
window.hasFocus=function(){if(productId=="ZSC"){var isIE11=agentInfo.isMSIE&&agentInfo.msieVersion<=11;if(isIE11)return document.hasFocus()&&document.body.contains(document.activeElement)&&document.activeElement.nodeName!="IFRAME";return document.hasFocus()&&document.contains(document.activeElement)&&document.activeElement.nodeName!="IFRAME"}else return document.hasFocus()}(function(){var method;var noop=function(){};var methods=["assert","clear","count","debug","dir","dirxml","error","exception",
"group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];var length=methods.length;var console=window.console=window.console||{};while(length--){method=methods[length];if(typeof console[method]=="undefined")console[method]=noop}}());
(function(){var defaultTouchGestures=[{type:"pressAndTap",threshold:5,time:100,action:["mouseMove","doubleClick"]},{type:"panAndTap",threshold:15,direction:"DIRECTION_ALL",action:["mouseMove","doubleClick"]},{type:"tap",pointers:1,taps:1,action:["mouseMove","click",productId==="virtualui"?"focus":""]},{type:"pan",pointers:1,threshold:15,direction:"DIRECTION_ALL",action:"mouseMove"},{type:"pressAndRelease",pointers:1,threshold:5,time:450,action:["contextMenu"]},{type:"press",pointers:1,threshold:5,
time:450,action:["mouseMove","holdLeft"]},{type:"pan",pointers:3,threshold:0,action:"zoomPan"},{type:"pinch",pointers:2,threshold:0,action:"zoomOrWheel"},{type:"release",action:"releaseAll"},{type:"swipe","pointers":1,"threshold":10,velocity:.3,direction:"DIRECTION_RIGHT",action:"closeMenu"},{type:"swipeFromEdge","pointers":1,"threshold":10,velocity:.3,swipeDirection:"left",action:"menu"}];const gesturesOnStates=Thinfinity.GesturesConfigurator.onStates;function Mobile(){if(typeof window["__mobile__"]!=
"undefined")return window["__mobile__"];var self=this;var mobileReady=false;var button="left";var touchstate=0;var lastEvent=null;var stdKeyboardVisible=false;var extKeyboardVisible=false;var dialogVisible=false;var THIN=null;var ctrlDown=false;var altDown=false;var shiftDown=false;var backSpacePressed=false;var kbdTimer=null;var deltaCursorX=0;var deltaCursorY=0;var mouseScrollX=-1;var startMouseX=0;var startMouseY=0;var mouseScrollY=-1;var zoomStarted=false;var zoomEnabled=true;var zoomBottomLimit=
1;var zoomTopLimit=4;var relativeTouch=true;var divScrolling=true;var screenHeight=window.environment.availHeight||$(window).height();var screenWidth=window.environment.availWidth||$(window).width();var showToolbar=true;var insertNavigator=true;var kbScreenHeight=-1;var kbScreenWidth=-1;var scrollStarted=false;var touchkbdElem=null;var lastMouseClickPosition=null;var lastKey=-1;var imgMPath="images/m/";var replyTime=0;var mouseCenterIntervalId=null;var isNewConnection=true;var savedX;var savedY;var scrollingTOUT;
var resizeTOUT;var toolbarAvailable=false;var held=[];var _tba;var supportsFullScreenMode=typeof environment!="undefined"?environment.supportsFullScreen:agentInfo.supportsFullScreen(document.documentElement);var hasOrientationChanged=false;var interfaceProperties=null;var keyboardSettings={"intervalTime":1E3,"intervalId":null,"timeoutTime":1500,"timeoutId":null,"available":true};var getScrollLeft=document.documentElement?function(){return document.documentElement.scrollLeft}:function(){return window.pageXOffset};
var getScrollTop=document.documentElement?function(){return document.documentElement.scrollTop}:function(){return window.pageYOffset};var physicalKeyboard=null;var mouseMask=null;var contextMenu=null;var preventMobileKeyboardDisplay=false;var keyboardCaretWait=200;var _domHeight=window.screenHeight;var _winScrollY=0;var _showingStdKdb=false;var TouchManager=function(){var p={initialized:false,localGesturesInitialized:false,redirectionInitialized:false,redirectionServerSideSupported:false,listenElement:null,
localGesturesSettings:null,redirectSettings:null,gesturesConfigurator:null,fallbackCount:0,currentMode:"",currentLocalGesturesMethod:"",currentRedirectionMethod:"",currentRedirectionEventHandlers:{"Start":null,"Move":null,"End":null},currentRedirectionEvents:{"Start":null,"Move":null,"End":null},eventNamesByRedirectionMethod:{"Touch Events":{"Start":["touchstart"],"Move":["touchmove"],"End":["touchend"]},"Pointer Events":{"Start":[],"Move":[],"End":[]}},touchEventsCapable:function(){return!!("ontouchstart"in
window)},pointerEventsCapable:function(){var pointerEvents=this.eventNamesByRedirectionMethod["Pointer Events"];if(pointerEvents["Start"].length)return true;if(navigator.pointerEnabled&&navigator.maxTouchPoints>0){pointerEvents["Start"]=["pointerdown"];pointerEvents["Move"]=["pointermove"];pointerEvents["End"]=["pointerup","pointercancel"];return true}if(navigator.msPointerEnabled&&navigator.msMaxTouchPoints>0){pointerEvents["Start"]=["MSPointerDown"];pointerEvents["Move"]=["MSPointerMove"];pointerEvents["End"]=
["MSPointerUp","MSPointerCancel"];return true}return false},msTouchEventsCapable:function(){return agentInfo.isTabletMode&&document&&document.documentElement&&"onmsgesturestart"in document.documentElement},maxTouchPoints:function(){return navigator.maxTouchPoints||navigator.msMaxTouchPoints||0},addRedirectionEvents:function(owner,eventId){var eventHandlerName="touch"+eventId+"Redirection";var eventNames=this.eventNamesByRedirectionMethod[this.currentRedirectionMethod][eventId];var eventHandler=owner[eventHandlerName];
if(!this.listenElement||typeof eventNames=="undefined"||typeof eventHandler=="undefined")return;var wrappedEventHandler;if(this.currentRedirectionMethod=="Touch Events")wrappedEventHandler=eventId=="Start"||eventId=="End"?function(e){eventHandler.apply(owner,[e,e.changedTouches])}:function(e){eventHandler.apply(owner,[e,e.touches])};else wrappedEventHandler=function(e){if(e.pointerType!="touch")return;eventHandler.apply(owner,[e,[{pageX:e.clientX,pageY:e.clientY,identifier:e.pointerId}]])};for(var i=
0;i<eventNames.length;++i)this.listenElement.addEventListener(eventNames[i],wrappedEventHandler,false);this.currentRedirectionEventHandlers[eventId]=wrappedEventHandler},removeRedirectionEvents:function(eventId){if(this.currentRedirectionMethod&&this.currentRedirectionMethod!=""){var eventNames=this.eventNamesByRedirectionMethod[this.currentRedirectionMethod][eventId];if(!this.listenElement||typeof eventNames=="undefined")return;var wrappedEventHandler=this.currentRedirectionEventHandlers[eventId];
for(var i=0;i<eventNames.length;++i)this.listenElement.removeEventListener(eventNames[i],wrappedEventHandler,false)}},initLocalGestures:function(localGestureSettings){if(this.gesturesConfigurator!=null&&this.gesturesConfigurator.initialized)return;this.localGesturesInitialized=false;this.localGestureSettings=null;this.currentLocalGesturesMethod="";if(!this.gesturesConfigurator)this.gesturesConfigurator=new Thinfinity.GesturesConfigurator({listenElement:this.listenElement});if(this.gesturesConfigurator==
null){helper.console.error("TouchManager: Cannot initialize GesturesConfigurator, no local gesture processing.");return}this.localGestureSettings=localGestureSettings;this.currentLocalGesturesMethod="Hammer.js";this.localGesturesInitialized=true},initRedirection:function(redirectionSettings){this.redirectionSettings=redirectionSettings;this.currentRedirectionMethod=this.touchEventsCapable()?"Touch Events":"Pointer Events";this.redirectionInitialized=true;this.redirectionServerSideSupported=false},
startLocalGestures:function(owner){if(this.gesturesConfigurator.initialized)this.gesturesConfigurator.stopRecognition();if(owner.defaultGestures)this.gesturesConfigurator.set({gestures:owner.defaultGestures});this.gesturesConfigurator.set({"gestures":this.localGestureSettings});this.gesturesConfigurator.set({middleware:owner.gesturesMiddleware,middlewares:[],actions:owner.actions});this.gesturesConfigurator.startRecognition();this.currentMode="Local Gestures";owner.localGesturesStarted()},stopLocalGestures:function(owner){if(this.gesturesConfigurator)this.gesturesConfigurator.stopRecognition();
this.currentMode="";owner.localGesturesStopped()},startRedirection:function(owner){this.listenElement.style.touchAction="none";this.listenElement.style.msTouchAction="none";this.listenElement.onselectstart=function(){return false};this.addRedirectionEvents(owner,"Start");this.addRedirectionEvents(owner,"Move");this.addRedirectionEvents(owner,"End");this.currentMode="Redirection";owner.redirectionStarted()},stopRedirection:function(owner){this.removeRedirectionEvents("Start");this.removeRedirectionEvents("Move");
this.removeRedirectionEvents("End");if(this.listenElement){delete this.listenElement.style.touchAction;delete this.listenElement.style.msTouchAction}this.currentMode="";owner.redirectionStopped()}};var _useLocalGesture=false;var touch={touchCapable:function(){return true},maxTouchPoints:function(){return p.maxTouchPoints()},localGesturesInitialized:function(){return p.localGesturesInitialized},redirectionInitialized:function(){return p.redirectionInitialized},redirectionServerSideSupported:function(){return p.redirectionServerSideSupported},
getCurrentMode:function(){return p.currentMode},getCurrentRedirectionMethod:function(){return p.currentRedirectionMethod},getCurrentLocalGesturesMethod:function(){return p.currentLocalGesturesMethod},wasInitialized:function(){return p.initialized},refine:function(){var F=function(){};F.prototype=this;return new F},initialize:function(listenElement,localGestureSettings,redirectionSettings){if(this.wasInitialized()){helper.console.log("TouchManager: Already initialized, continue.");return}if(!listenElement){helper.console.error("TouchManager: Undefined listenElement, cannot initialize.");
return}if(!this.touchCapable()){helper.console.error("TouchManager: Touch capability not detected, cannot initialize.");return}if(listenElement.addEventListener=="undefined"){helper.console.error("TouchManager: listenElement.addEventListener() not supported, cannot initialize.");return}p.listenElement=listenElement;if(typeof localGestureSettings=="object")p.initLocalGestures(localGestureSettings);if(typeof redirectionSettings=="object")p.initRedirection(redirectionSettings);if(!this.redirectionInitialized()&&
!this.localGesturesInitialized()){helper.console.log("TouchManager: No touch handling method defined, cannot initialize.");return}this.printStatus(true);p.initialized=true;helper.console.log("TouchManager: Initialized.");this.reconfigureForLocalGestures()},serverSupportsRedirection:function(){if(!this.wasInitialized()){helper.console.error("TouchManager: Not initialized.");return}if(!this.redirectionInitialized()){helper.console.error("TouchManager: Redirection not initialized.");return}if(agentInfo.isMobile){p.redirectionServerSideSupported=
false;logDebug("TouchManager: Server supports touch redirection, but the device is mobile or surface reconfiguring to local gestures...");this.reconfigureForLocalGestures();helper.console.log("ThinVNCTouchManager::redirectionStopped()");$("#kitouchredir").hide();$("#kitouchredir + hr").hide()}else{p.redirectionServerSideSupported=true;helper.console.log("TouchManager: Server supports touch redirection, reconfiguring...");this.reconfigureForRedirection()}},printStatus:function(ignoreInitialized){if(!this.wasInitialized()&&
!ignoreInitialized){helper.console.log("TouchManager: Not initialized.");return}var yesNo=function(b,y,n){var s=b?"Yes":"No";if(b&&y)s+=y;else if(!b&&n)s+=n;return s};helper.console.log("TouchManager: Touch events capable? "+yesNo(p.touchEventsCapable())+".");helper.console.log("TouchManager: Pointer events capable? "+yesNo(p.pointerEventsCapable())+".");helper.console.log("TouchManager: Max. touch points: "+(this.maxTouchPoints()?this.maxTouchPoints():"not available")+".");helper.console.log("TouchManager: Local gestures initialized? "+
yesNo(this.localGesturesInitialized(),", using "+this.getCurrentLocalGesturesMethod())+".");helper.console.log("TouchManager: Redirection initialized? "+yesNo(this.redirectionInitialized(),", using "+this.getCurrentRedirectionMethod())+".")},toggleCurrentMode:function(){if(this.getCurrentMode()=="Redirection")this.reconfigureForLocalGestures();else if(this.getCurrentMode()=="Local Gestures")this.reconfigureForRedirection();else helper.console.error("TouchManager: Cannot toggle invalid current mode: "+
this.getCurrentMode())},reconfigureForLocalGestures:function(){_useLocalGesture=true;if(!this.wasInitialized()){helper.console.error("TouchManager: Not initialized. Cannot reconfigure for local gestures.");return}if(!this.localGesturesInitialized()){helper.console.log("TouchManager: Cannot switch to local gestures, mode not initialized. Reverting to redirect if available.");if(this.redirectionInitialized()&&this.redirectionServerSideSupported())this.reconfigureForRedirection();return}try{p.stopRedirection(this);
p.startLocalGestures(this)}catch(err){helper.console.error("TouchManager: Failed to initialize local gesture processing: "+err);if(p.fallbackCount++)return;helper.console.error("TouchManager: Reverting to touch redirection if available.");if(this.redirectionInitialized()&&this.redirectionServerSideSupported())this.reconfigureForRedirection();p.fallbackCount=0;return}p.fallbackCount=0;helper.console.log("TouchManager: Switched to local gestures.")},enableGestures:function(){if(_useLocalGesture==true&&
(p.gesturesConfigurator==null||!p.gesturesConfigurator.initialized)){p.initLocalGestures(p.localGestureSettings);p.startLocalGestures(this)}},disableGestures:function(){if(_useLocalGesture==true&&p.gesturesConfigurator!=null)p.stopLocalGestures(this)},reconfigureForRedirection:function(){_useLocalGesture=false;if(!this.wasInitialized()){helper.console.error("TouchManager: Not initialized. Cannot reconfigure for redirection.");return}if(!this.redirectionInitialized()||!this.redirectionServerSideSupported()){helper.console.log("TouchManager: Cannot switch to redirection, mode not initialized or no sever-side support. Reverting to local gestures if available.");
if(this.localGesturesInitialized())this.reconfigureForLocalGestures();return}try{p.stopLocalGestures(this);p.startRedirection(this)}catch(err){helper.console.error("TouchManager: Failed to initialize redirection of touch events: "+err);if(p.fallbackCount++)return;helper.console.error("TouchManager: Reverting to local gestures if available.");if(this.localGesturesInitialized())this.reconfigureForLocalGestures();p.fallbackCount=0;return}p.fallbackCount=0;helper.console.log("TouchManager: Switched to touch redirection.")},
dispose:function(){p.stopRedirection(this);p.stopLocalGestures(this);p.initialized=false},touchGesture:function(e){},panStartGesture:function(e){},panGesture:function(e){},panEndGesture:function(e){},swipeGesture:function(e){},tapGesture:function(e){},doubleTapGesture:function(e){},pressGesture:function(e){},releaseGesture:function(e){},transformStartGesture:function(e){},transformGesture:function(e){},transformEndGesture:function(e){},touchStartRedirection:function(e,touches){},touchMoveRedirection:function(e,
touches){},touchEndRedirection:function(e,touches){},localGesturesStarted:function(e){},localGesturesStopped:function(e){},redirectionStarted:function(e){},redirectionStopped:function(e){},gesturesConfiguratorCustomActions:[]};Object.defineProperty(touch,"gesturesConfigurator",{"enumerable":true,"configurable":false,"get":function(){return p.gesturesConfigurator}});return touch};function initialize(){if(agentInfo.isTouch)ThinVNCTouchManager=new TouchManager;if(agentInfo.isMobile){function addStylesheet(url,
media){var attrs={"rel":"stylesheet","type":"text/css","href":url};if(media)attrs["media"]=media;helper.dom.appendJsonElement({"parentElement":head,"type":"link","attributes":attrs})}var head=document.head;var bPath=Thinfinity.global.variables.basePath;addStylesheet(bPath+"css.m/keyb.css");addStylesheet(bPath+"css.m/keyb_port_320.css","only screen and (max-width: 479px)");addStylesheet(bPath+"css.m/keyb_land_480.css","only screen and (min-width: 480px) and (max-width:599px)");addStylesheet(bPath+
"css.m/keyb_port_600.css","only screen and (min-width: 600px) and (max-width:768px)");addStylesheet(bPath+"css.m/keyb_port_768.css","only screen and (min-width: 768px) and (max-width:799px)");addStylesheet(bPath+"css.m/keyb_land_800.css","only screen and (min-width: 800px) and (max-width:1023px)");addStylesheet(bPath+"css.m/keyb_land_1024.css","only screen and (min-width: 1024px)");if(insertNavigator)addStylesheet(bPath+"css.m/navigatorControl.css","only screen");if(window.productId=="thinvnc")addStylesheet(bPath+
"css.m/menu.css");helper.dom.interactive(function(){helper.style.add(document.body,"mobile");_domHeight=document.body.clientHeight})}}function isBlocked(){return $(".blockUI.blockMsg").length>0}function CtrlKeyToggle(){if($("#keyctrl").hasClass("disabledKey"))return;ctrlDown=!ctrlDown;if(ctrlDown)$("#keyctrl").addClass("selected");else $("#keyctrl").removeClass("selected")}function CtrlKeyOff(){ctrlDown=false;$("#keyctrl").removeClass("selected")}function AltKeyToggle(){if($("#keyalt").hasClass("disabledKey"))return;
altDown=!altDown;if(altDown)$("#keyalt").addClass("selected");else $("#keyalt").removeClass("selected")}function AltKeyOff(){altDown=false;$("#keyalt").removeClass("selected")}function ShiftKeyToggle(){if($("#keyshift").hasClass("disabledKey"))return;shiftDown=!shiftDown;if(shiftDown)$("#keyshift").addClass("selected");else $("#keyshift").removeClass("selected")}function ShiftKeyOff(){shiftDown=false;$("#keyshift").removeClass("selected")}function sendSpecialKeysBegin(){if(ctrlDown)THIN.sendKeyDown(17);
if(altDown)THIN.sendKeyDown(18);if(shiftDown)THIN.sendKeyDown(16)}function sendSpecialKeysEnd(){if(ctrlDown)THIN.sendKeyUp(17);if(altDown)THIN.sendKeyUp(18);if(shiftDown)THIN.sendKeyUp(16);CtrlKeyOff();AltKeyOff();ShiftKeyOff()}function sendExtKey(elem,key){if(key==46&&helper.object.existsPath(THIN,"rcParams.mobile.shortcuts.CtrlAltDel")&&THIN.rcParams.mobile.shortcuts.CtrlAltDel=="false"){CtrlKeyOff();AltKeyOff();ShiftKeyOff()}else{sendSpecialKeysBegin();THIN.sendKeyStroke(key);sendSpecialKeysEnd()}}
function sendCtrlAltDel(){THIN.sendCtrlAltDel()}function sendShiftCtrlEsc(){THIN.sendShiftCtrlEsc()}function sendShellExplorer(){THIN.sendShellExplorer()}function sendShellRun(){THIN.sendShellRun()}function sendCtrlEsc(){THIN.sendCtrlEsc()}function sendCut(){THIN.sendCut()}function sendCopy(){THIN.sendCopy()}function sendPaste(){THIN.sendPaste()}function cursorCanvasX(){return interfaceProperties.cursorCanvasX}function cursorCanvasY(){return interfaceProperties.cursorCanvasY}function getMouseScreenPosition(){let position=
THIN.findPos(THIN.vncContainer);var mouseScreenPosition={x:(cursorCanvasX()-position[0])/THIN.scale,y:(cursorCanvasY()-position[1])/THIN.scale};return mouseScreenPosition}function btnDblClickFromCtxMenu(){var p=THIN.findPos(THIN.vncContainer);var x=contextMenu.elem.x*THIN.scale+p[0];var y=contextMenu.elem.y*THIN.scale+p[1];btnLeftClick(x,y);btnLeftClick(x,y)}function btnLeftClick(x,y){var x1=getTouchXFixed();var y1=getTouchYFixed();mouseScrollX=x1;mouseScrollY=y1;x1=x;y1=y;THIN.mouseDown(x1,y1,0);
THIN.mouseUp(x1,y1,0)}function btnRightClick(){var x=cursorCanvasX();var y=cursorCanvasY();sendButtonRight(x,y)}function btnRightClickFromCtxMenu(){var p=THIN.findPos(THIN.vncContainer);sendButtonRight(contextMenu.elem.x*THIN.scale+p[0],contextMenu.elem.y*THIN.scale+p[1])}function sendButtonRight(x,y){var x1=getTouchXFixed();var y1=getTouchYFixed();mouseScrollX=x1;mouseScrollY=y1;x1=x;y1=y;THIN.mouseDown(x1,y1,2);THIN.mouseUp(x1,y1,2)}function hideExtKeyboard(){var extkeyboard=document.getElementById("extkeyboard");
extkeyboard.style.top="100%";extkeyboard.style.marginTop="2000px"}function openExtKeyboard(noslide){if(typeof noslide=="undefined")$("#extkeyboard").addClass("slide");else $("#extkeyboard").removeClass("slide");var extkeyboard=document.getElementById("extkeyboard");extkeyboard.style.top=$("body").height()+"px";extkeyboard.style.marginTop=-extkeyboard.offsetHeight+"px";extKeyboardVisible=true}function closeExtKeyboard(){hideExtKeyboard();hideExtKeys();extKeyboardVisible=false}function moveExtKeyboard(){if(!extKeyboardVisible)return}
function hideExtKeys(){if(showToolbar){var extkeys=document.getElementById("extkeys");extkeys.style.top=-extkeys.offsetHeight+"px"}}function ShowExtKeys(){if(productId=="webfmx"||productId=="virtualui")return;var extkeys=document.getElementById("extkeys");extkeys.style.top=(agentInfo.isIOS&&window.scrollY>55?window.scrollY:0)+"px";extkeys.style.left="50%";extkeys.style.marginLeft="-"+$("#extkeys").width()/2+"px"}function ShowStdKbd(force){_domHeight=document.body.clientHeight;_winScrollY=window.scrollY;
_showingStdKdb=true;if(preventMobileKeyboardDisplay&&!force)return;if(!physicalKeyboard)physicalKeyboard=THIN.mobileKeyboard.locationType==THIN.mobileKeyboard.enumLocationType.PHYSICALKEYBOARD;if(force)physicalKeyboard=false;var x=0;var y=0;if(keyboardSettings.available){stdKeyboardVisible=true;var fixH=0;x=THIN.caretX;y=THIN.caretY;if(productId=="virtualui"&&helper.object.existsPath(THIN,"caret.data.rw")==true&&THIN.caret.data.rw.b-THIN.caret.data.rw.t>THIN.multiRowMinSize){x=THIN.caret.data.r.l;
y=THIN.caret.data.r.t+(THIN.caret.data.r.b-THIN.caret.data.r.t);if(agentInfo.isIOS&&agentInfo.isSafari){THIN.caretX=x;THIN.caretY=y}}if(y<=0)if(productId!="webfmx"&&productId!="virtualui"&&lastMouseClickPosition!=null){y=lastMouseClickPosition.y+32||THIN.mouseY;x=lastMouseClickPosition.x+32||THIN.mouseX;y-=25}else{if(agentInfo.isIOS&&agentInfo.isSafari)fixH=-18;x=THIN.mouseX-5;y=THIN.mouseY+fixH}if(y<0)y=0;if(x<0)x=0;if(productId==="thinvnc"||productId=="thinrdp"){touchkbdElem.style.top=y+"px";document.body.height=
_domHeight*3+"px";let s=THIN.getScale()*y/1.5;window.scrollTo(0,s)}var prevOverflow=null;if(agentInfo.isAndroid&&agentInfo.isChrome&&document.body.style.overflow=="hidden"){prevOverflow=document.body.style.overflow;document.body.style.overflow="auto"}if(agentInfo.isFirefox)document.activeElement.blur();if(productId!="webfmx")touchkbdElem.style.left=x+"px";touchkbdElem.style.display="block";touchkbdElem.style.visibility="visible";touchkbdElem.focus();let hasMobileClass=helper.style.hasClass("mobile");
if(hasMobileClass)helper.style.removeClass(document.body,"mobile");setTimeout(function(){if(agentInfo.isIOS&&agentInfo.isSafari&&relativeTouch){fixH=25/THIN.getScale();var posY=THIN.caretY>0?THIN.caretY:THIN.mouseY;var physicalScreenY=(posY-(THIN.vncdiv.scrollTop+fixH))*THIN.getScale();physicalScreenY-=Math.round((window.environment.detectedHeight-48)/4)-fixH;try{var limit=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,
document.documentElement.offsetHeight)-window.innerHeight;limit=limit<0?0:limit;physicalScreenY=Math.abs(physicalScreenY)>limit?limit:physicalScreenY;if(Math.abs(window.scrollY-physicalScreenY)>50)window.scroll(0,physicalScreenY)}catch(e){}}if(hasMobileClass)helper.style.addClass(document.body,"mobile")},350);if(prevOverflow!=null)setTimeout(function(){document.body.style.overflow=prevOverflow},500);if(!physicalKeyboard&&(agentInfo.isWindows||agentInfo.isAndroid&&(!agentInfo.isChrome||agentInfo.isChrome&&
agentInfo.chromeVersion<"5.0.0"))){clearInterval(keyboardSettings.intervalId);keyboardSettings.timeoutId=null;clearTimeout(keyboardSettings.timeoutId);setTimeout(function(){keyboardSettings.intervalId=setInterval(function(){if(document.activeElement!=touchkbdElem){clearInterval(keyboardSettings.intervalId);$(touchkbdElem).blur();window.scrollY=0}},keyboardSettings.intervalTime)},keyboardSettings.timeoutTime)}if(agentInfo.isChrome)touchkbdElem.style.left="-1000px"}else;}function addKeyImg(row,img,
key,cells,callback,behavior,disabled){if(typeof cells=="undefined")cells=2;var attributes={};attributes["class"]=("key t"+cells).toString();var events={};if(disabled!=false)if(typeof callback!="undefined"&&callback!="")events["ontouchend"]=function(){if(typeof callback=="string")helper.object.eval(callback);else callback()};else events["ontouchend"]=function(){sendExtKey(this,key)};var elem=document.getElementById("extkeyboard_row"+row);if(elem){var td=helper.dom.createJsonElement({"type":"td","attributes":{"colSpan":cells}});
var div=helper.dom.createJsonElement({"type":"div","attributes":attributes,"events":events});var p=helper.dom.createJsonElement({"type":"p"});var img=helper.dom.createJsonElement({"type":"img","attributes":{"src":Thinfinity.global.variables.basePath+img}});p.appendChild(img);div.appendChild(p);td.appendChild(div);elem.appendChild(td);if(disabled==false)helper.style.add(div,"disabledKey")}}function addKey(row,text,key,cells,callback,behavior,disabled){if(typeof cells=="undefined")cells=2;var attributes=
{};attributes["class"]=("key t"+cells).toString();var events={};if(disabled!=false)if(typeof callback!="undefined"&&callback!="")events["ontouchend"]=function(){if(typeof callback=="string")helper.object.eval(callback);else callback()};else if(text!=""&&key!=0)events["ontouchend"]=function(){sendExtKey(this,key)};var elem=document.getElementById("extkeyboard_row"+row);if(elem){var td=helper.dom.createJsonElement({"type":"td","attributes":{"colSpan":cells}});var div=helper.dom.createJsonElement({"type":"div",
"attributes":attributes,"events":events});var p=helper.dom.createJsonElement({"type":"p","content":text});div.appendChild(p);td.appendChild(div);elem.appendChild(td);if(disabled==false)helper.style.add(div,"disabledKey")}}function addExtKey(row,text,key,cells,id,behavior,disabled){if(typeof cells=="undefined")cells=2;var attributes={};var events={};if(text!=""){attributes["class"]=("key t"+cells).toString();if(id!=parseInt(id))attributes["id"]=id;else if(disabled!=false)events["ontouchend"]=function(){sendExtKey(this,
id)}}var elem=document.getElementById("extkeys_row"+row);if(elem){var td=helper.dom.createJsonElement({"type":"td","attributes":{"colSpan":cells}});var div=helper.dom.createJsonElement({"type":"div","attributes":attributes,"events":events});var p=helper.dom.createJsonElement({"type":"p","content":text});div.appendChild(p);td.appendChild(div);elem.appendChild(td);if(disabled==false)helper.style.add(div,"disabledKey")}}function getRelativeX(X,isRelative){if(isRelative){savedX=X;X=X-startMouseX+cursorCanvasX();
X=X<0?0:X}return Math.round(X)}function getRelativeY(Y,isRelative){if(isRelative){savedY=Y;Y=Y-startMouseY+cursorCanvasY();Y=Y<0?0:Y}return Math.round(Y)}function mouseDown(button,X,Y,isRelative){var btn=0;lastY=Y;if(button=="right")btn=2;THIN.mouseDown(getRelativeX(X,isRelative)+deltaCursorX,getRelativeY(Y,isRelative)+deltaCursorY,btn)}function mouseUp(button,X,Y,isRelative){var btn=0;if(button=="right")btn=2;THIN.mouseUp(getRelativeX(X,isRelative)+deltaCursorX,getRelativeY(Y,isRelative)+deltaCursorY,
btn)}function mouseMove(X,Y,isRelative){var relX=getRelativeX(X,isRelative)+deltaCursorX;var relY=getRelativeY(Y,isRelative)+deltaCursorY;THIN.mouseMove(relX,relY)}function mouseMoveIntoView(){if(relativeTouch){var x=cursorCanvasX();var y=cursorCanvasY();var z=THIN.getZoom();if(x<=THIN.vncdiv.scrollLeft*z)x=THIN.vncdiv.scrollLeft*z;else if(x>=(THIN.rcParams.maxWidth+THIN.vncdiv.scrollLeft)*z)x=(THIN.rcParams.maxWidth+THIN.vncdiv.scrollLeft)*z;if(y<=THIN.vncdiv.scrollTop*z)y=THIN.vncdiv.scrollTop*
z;else if(y>=(THIN.rcParams.maxHeight+THIN.vncdiv.scrollTop)*z)y=(THIN.rcParams.maxHeight+THIN.vncdiv.scrollTop)*z;if(x!=cursorCanvasX()||y!=cursorCanvasY())THIN.mouseMove(x,y)}}function moveMouseToStart(){var maxTries=50;var count=0;clearInterval(mouseCenterIntervalId);mouseCenterIntervalId=setInterval(function(){count++;var mouseElem=document.getElementById(productId+"_canvas_0");if(mouseElem!=null){clearInterval(mouseCenterIntervalId);setTimeout(function(){var x=parseInt(window.environment.currentWidth/
2,10);var y=parseInt(window.environment.currentHeight/2,10);THIN.mouseMove(x,y)},250)}if(count>maxTries)clearInterval(mouseCenterIntervalId)},50)}function divScroll(X,Y){X=Math.round(X);Y=Math.round(Y);if(divScrolling){if(THIN.rcParams.maxWidth+X>THIN.rcParams.viewWidth)X=THIN.rcParams.viewWidth-THIN.rcParams.maxWidth;else if(X<0)X=0;if(THIN.rcParams.maxHeight+Y>THIN.rcParams.viewHeight)Y=THIN.rcParams.viewHeight-THIN.rcParams.maxHeight;else if(Y<0)Y=0;THIN.vncdiv.scrollLeft=X;THIN.vncdiv.scrollTop=
Y}else{X=getScrollLeft()+(mouseScrollX-X);Y=getScrollTop()+(mouseScrollY-Y);if(THIN.rcParams.maxWidth+X>THIN.rcParams.viewWidth)X=THIN.rcParams.viewWidth-THIN.rcParams.maxWidth;else if(X<0)X=0;if(THIN.rcParams.maxHeight+Y>THIN.rcParams.viewHeight)Y=THIN.rcParams.viewHeight-THIN.rcParams.maxHeight;else if(Y<0)Y=0;window.scroll(X,Y)}mouseScrollX=X;mouseScrollY=Y;return}function checkPointerType(ev){if(ev)switch(ev.pointerType){case "touch":return true;case "pen":return true;case "mouse":return false;
default:if(ev.changedTouches&&ev.changedTouches.length>0||ev.touches&&ev.touches.length>0)return true}return false}function checkUIAndPointerType(e){if(!checkPointerType(e))return false;return!helper.style.hasAnyParentsClass(e&&e.target?e.target:null,"uitaptarget ignoremouse")}function getRelativeTouchByPointerType(ev){return!relativeTouch||ev&&ev.pointerType==="pen"?false:relativeTouch}function getTouches(ev){if(ev){switch(ev.pointerType){case "touch":case "pen":if(ev.pointers.length>0)ev=ev.pointers[0];
else if(ev.changedPointers.length>0)ev=ev.changedPointers[0];break;case "mouse":break;default:if(ev.changedTouches&&ev.changedTouches.length>0)ev=ev.changedTouches[0];else if(ev.touches&&ev.touches.length>0)ev=ev.touches[0];break}return ev}else{logDebug("No event to get Touches!");return[{"x":-1,"y":-1}]}}function getTouchX(isRelative){return getTouchXFixed()+(isRelative?0:THIN.vncdiv.scrollLeft*THIN.getZoom())}function getTouchXFixed(){var t=getTouches(lastEvent);return parseInt(t.x||t.clientX||
t.pageX,10)+$(window).scrollLeft()}function getTouchY(isRelative){return getTouchYFixed()+(isRelative?0:THIN.vncdiv.scrollTop*THIN.getZoom())}function getTouchYFixed(){var t=getTouches(lastEvent);return parseInt(t.y||t.clientY||t.pageY,10)+getScrollTop()}function showMouseMask(x,y,cn,hide){if(mouseMask){mmmouseMaskclassName=cn;mouseMask.style.left=x+"px";mouseMask.style.top=y+"px";$(mouseMask).show();if(hide)window.setTimeout(hideMouseMask,25)}}function moveMouseMask(x,y){if(mouseMask){mouseMask.style.left=
x+"px";mouseMask.style.top=y+"px"}}function hideMouseMask(){$(mouseMask).hide()}function isTouchDevice(){try{document.createEvent("TouchEvent");return true}catch(e){return false}}function alignPanels(){if(stdKeyboardVisible&&isKeyboardVisible()||extKeyboardVisible){ShowExtKeys();if(extKeyboardVisible)openExtKeyboard(true)}else{hideExtKeys();if(!_showingStdKdb)$(touchkbdElem).blur()}}function adjustMainSize(){screenWidth=window.environment.detectedWidth;screenHeight=window.environment.detectedHeight}
function checkScreenSize(){if(!$("#touchkbd:focus")[0])window.scroll(0,1);adjustMainSize();moveExtKeyboard();alignPanels()}function zoom(value,forceZoom){var isKeyboardVsb=stdKeyboardVisible&&isKeyboardVisible();if(forceZoom||!isKeyboardVsb){if(!zoomEnabled)value=1;if(THIN.getZoom()!=value)THIN.zoomDesktop(value);THIN.rcParams.maxWidth=Math.round(screenWidth/value);THIN.rcParams.maxHeight=Math.round(screenHeight/value);if(THIN.rcParams.scaled){THIN.vncdiv.style.width=THIN.rcParams.viewWidth+"px";
THIN.vncdiv.style.height=THIN.rcParams.viewHeight+"px"}else{THIN.vncdiv.style.width=THIN.rcParams.maxWidth+"px";THIN.vncdiv.style.height=THIN.rcParams.maxHeight+"px"}}}function isKeyboardVisible(){var strmsg="";var tempKeyboardVisible=false;if(agentInfo.isTouch){if(agentInfo.isIOS&&agentInfo.ipadModel==="pro"&&THIN.mobileKeyboard)if(THIN.mobileKeyboard.locationType==THIN.mobileKeyboard.enumLocationType.PHYSICALKEYBOARD)return false;else return stdKeyboardVisible;if(agentInfo.isIOS||agentInfo.isWindows||
agentInfo.isAndroid&&(!agentInfo.isChrome||agentInfo.isChrome&&agentInfo.chromeVersion<"5.0.0"&&agentInfo.agentStr.indexOf("android 4.2.2")==-1))tempKeyboardVisible=document.activeElement!=undefined&&document.activeElement.id=="touchkbd"?true:false;else{var h=Math.max(environment.height,environment.currentHeight,window.screen.height);var dh=environment.detectedHeight;var kdbSize=200;if(agentInfo.isAndroid&&!agentInfo.isChrome&&agentInfo.agentStr.indexOf("android 4.2.2")!=-1)h=window.environment.rawHeight;
tempKeyboardVisible=Math.abs(h-dh)>=kdbSize}}else tempKeyboardVisible=false;return tempKeyboardVisible}function keyboardShortCut_click(){ShowExtKeys();ShowStdKbd(true)}function openMenuShortCut_click(){if(showToolbar&&toolbarAvailable)THIN.toolbar.show()}function initMobile(thin,ze,callbacks){var initialZoomFactor=null;var isToggling=false;showToolbar=typeof thin.rcParams.showToolbarMobile!="undefined"?thin.rcParams.showToolbarMobile:true;function toggleFullScreenMode(){if(isToggling==false){isToggling=
true;if(!window.environment.isFullscreen){if(initialZoomFactor==null)initialZoomFactor=THIN.getZoom();logDebug("Fullscreen Mode");window.environment.requestFullscreen(document.documentElement)}else{logDebug("Exit Fullscreen Mode");window.environment.exitFullscreen(document)}}setTimeout(function(){isToggling=false},1E3)}if(mobileReady)return;hideUrlBar();THIN=thin;preventMobileKeyboardDisplay=!!THIN.clientSettings&&THIN.clientSettings.PreventMobileKeyboardDisplay===true;if(productId=="virtualui"){var errMsg=
"ClientSettings.Mobile.KeyboardCaretWait is not a valid value [{0}]";try{var _caretTimeout=helper.object.getValue(THIN,"clientSettings.Mobile.KeyboardCaretWait",null);_caretTimeout=_caretTimeout!==null&&!isNaN(_caretTimeout)?parseInt(_caretTimeout):keyboardCaretWait;if(_caretTimeout>0)keyboardCaretWait=_caretTimeout;else helper.console.warning(helper.string.format(errMsg,_caretTimeout))}catch(err){helper.console.warning(helper.string.format(errMsg,_caretTimeout))}}var mobiletools=[];var measure="";
switch(THIN.rcParams.tbSize){case "medium":measure=" tbMedium";break;case "large":measure=" tbLarge"}if(ze!=undefined)zoomEnabled=ze;if(showToolbar){mobiletools.push('<div class="popup uitaptarget" id="closequestion" style="display:none;"><div class="header center"><h3>',consts.closeConnection,'</h3></div><div class="alertBody"><div id="disconnectedIco">&nbsp;</div>',consts.areYouSureCloseConn,'</div><br/><div class="divbuttons"><a class="popuplink selected" id="closeyes">',consts.yes,'</a>&nbsp;<a class="popuplink" id="closeno">',
consts.no,"</a></div></div>",'<table id="extkeys" cellspacing="0" cellpadding="0" class="slide uitaptarget" ><tr id="extkeys_row1"></tr></table>','<table id="extkeyboard" cellspacing="0" cellpadding="0" class="slide uitaptarget" style="position:fixed"><tr id="extkeyboard_row1"></tr><tr id="extkeyboard_row2"></tr>','<tr id="extkeyboard_row3"></tr><tr id="extkeyboard_row4"></tr></table>');$(document.body).append(mobiletools.join(""));function closeyes(e){e.preventDefault();e.stopPropagation();Thinfinity.Popups.unblockDialogs();
THIN.disconnect();return false}function closeno(e){e.preventDefault();e.stopPropagation();Thinfinity.Popups.unblockDialogs();return false}document.getElementById("closeyes").addEventListener("click",closeyes);document.getElementById("closeno").addEventListener("click",closeno);document.getElementById("closeyes").addEventListener("touchend",closeyes);document.getElementById("closeno").addEventListener("touchend",closeno)}touchkbdElem=$("<input>").attr({"type":"text","id":"touchkbd","title":consts.touchKeyboard,
"value":"","autocapitalize":"off","autocorrect":"off","autocomplete":"off","spellcheck":"false"}).css({"top":"-100px","left":"-1000px","font-size":"0.1px","width":"1px","height":"1px","z-index":-1,"position":"absolute"})[0];if(agentInfo.isAndroid&&agentInfo.isChrome)touchkbdElem.style.fontSize="1px";function attachVisualEffects(){if(THIN.vncContainer==null)setTimeout(attachVisualEffects,25);else{mouseMask=helper.dom.appendJsonElement({"parentElement":THIN.vncContainer,"type":"div","attributes":{"style":"display:none;position:absolute;z-index:900009;",
"id":"mouseMask"}});$(THIN.vncContainer).append(touchkbdElem)}}attachVisualEffects();if(showToolbar)if(insertNavigator){navControl=new csNavigatorControl({offset:100,onMove:function(X,Y){if(divScrolling){THIN.vncdiv.scrollLeft=Math.min(THIN.rcParams.viewWidth-THIN.rcParams.maxWidth,THIN.vncdiv.scrollLeft+X);THIN.vncdiv.scrollTop=Math.min(THIN.rcParams.viewHeight-THIN.rcParams.maxHeight,THIN.vncdiv.scrollTop+Y);mouseMoveIntoView()}else window.scroll(getScrollLeft()+X,getScrollTop()+Y);return},onZoomIn:function(){var scale=
THIN.getZoom()*1.1;zoomStarted=true;zoom(Math.max(Math.max(zoomBottomLimit,THIN.getMinZoomFactor()),Math.min(scale,zoomTopLimit)));zoomStarted=false},onZoomOut:function(){var scale=THIN.getZoom()/1.1;zoomStarted=true;zoom(Math.max(Math.max(zoomBottomLimit,THIN.getMinZoomFactor()),Math.min(scale,zoomTopLimit)));zoomStarted=false},onActualPixels:function(){var scale=1;zoomStarted=true;zoom(scale);zoomStarted=false},onShrinkToBrowser:function(){zoomEnabled=true;var scale=THIN.getMinZoomFactor();zoomStarted=
true;zoom(scale);zoomStarted=false},getZIndex:function(){return THIN.getNextHighestZindex(document.body)}});navControl.setMode(navControl.NCM_WINDROSE);navControl.insertPane()}window["setRelativeTouch"]=function(value){relativeTouch=value};setRelativeTouch(typeof THIN.rcParams.relativeTouch!="undefined"?THIN.rcParams.relativeTouch:true);var resizeMobileTimeoutId=null;var resizeMobile=function(){if(hasOrientationChanged)lastMouseClickPosition={x:0,y:0};clearTimeout(resizeMobileTimeoutId);resizeMobileTimeoutId=
setTimeout(function(){checkScreenSize();if(THIN.getZoom&&THIN.getMinZoomFactor){if(window.environment.isFullscreen){var zoomValue=THIN.getZoom();var zoomReset=THIN.zoomFactorReset();if(zoomValue<zoomReset)zoomValue=zoomReset;window.setTimeout(function(){zoom(zoomValue);if(THIN.rcParams.scaled){THIN.center();THIN.zoomDesktop();setTimeout(function(){zoom(THIN.scale)},1)}},100)}else{if(THIN.getZoom()==THIN.getMinZoomFactor())if(THIN.rcParams.scaled)zoom(THIN.zoomFactorReset());else zoom(THIN.getScale());
else zoom(THIN.getZoom());if(THIN.rcParams.scaled){THIN.center();THIN.zoomDesktop();setTimeout(function(){zoom(THIN.scale)},1)}}if(hasOrientationChanged)if(THIN.rcParams.resolution=="fittobrowser"&&THIN.resizeDesktop)THIN.resizeDesktop();else if(THIN.rcParams.resolution=="fittoscreen"&&THIN.refreshFitToScreen)THIN.refreshFitToScreen();hasOrientationChanged=false}},100)};window.addEventListener("orientationchange",function(){hasOrientationChanged=true;$(touchkbdElem).blur()});environment.on("orientationChange",
function(){resizeMobile()});environment.on("resizeComplete",function(){if(!(stdKeyboardVisible&&isKeyboardVisible()))resizeMobile()});function sendParams(mouseControl,remotePointer,pixelFormat){THIN.sendCmd("cmd=params&mouseControl="+mouseControl+"&kbdControl="+mouseControl+"&remotePointer="+remotePointer+"&pixelFormat="+pixelFormat)}function refreshButtonStates(){if(THIN.rcParams.active&&THIN.rcParams.mouseControl)$("#kimouse").fadeTo(0,1);else $("#kimouse").fadeTo(0,.4);if(THIN.rcParams.scaled)$("#scale").parent().removeClass("ui-btn-up-b").addClass("ui-btn-down-a");
else $("#scale").parent().removeClass("ui-btn-down-a").addClass("ui-btn-up-b");if(THIN.rcParams.pixelFormat==1)$("#colors").parent().removeClass("ui-btn-up-b").addClass("ui-btn-down-a");else $("#colors").parent().removeClass("ui-btn-down-a").addClass("ui-btn-up-b")}if(showToolbar){function setClick(id,callback){var elem=document.getElementById(id);if(elem)elem.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();callback(e)},false)}_tba={sendCtrlAntDel:function(e){THIN.sendFunctionKey("CtrlAltDel")},
sendCtrlEsc:function(e){THIN.sendFunctionKey("ctrlEsc")},refreshScreen:function(e){if(THIN.rcParams.active)THIN.refresh()},toggleMonitor:function(e){THIN.setMonitor(THIN.rcParams.monitor+1)},toggleMouse:function(e){sendParams(!THIN.rcParams.mouseControl,THIN.rcParams.remotePointer,THIN.rcParams.pixelFormat)},toggleScaled:function(e){THIN.rcParams.scaled=!THIN.rcParams.scaled;THIN.zoomDesktop();refreshButtonStates()},showSettings:function(e){editAction=2;openPreferences()},showStdKbd:function(e){keyboardShortCut_click(true)},
toggleFullScreen:function(e){toggleFullScreenMode()},showExtKbd:function(e){openExtKeyboard();ShowExtKeys()},toggleTouchRedir:function(e){ThinVNCTouchManager.toggleCurrentMode()},sendRightClick:function(e){btnRightClick()},queryDisconnect:function(e){if(navControl.isVisible())navControl.hide();$.blockUI({message:$("#closequestion"),css:{"padding":0,"margin":0,"width":"100%","height":"100%","top":"0px","left":"0px","textAlign":"center","backgroundColor":"transparent","border":"none","cursor":"auto"},
centerX:true,centerY:true})}};if(agentInfo.isIOS&&agentInfo.isSafari){setClick("ctrlAltDel",_tba.sendCtrlAntDel);setClick("ctrlEsc",_tba.sendCtrlEsc);setClick("refresh",_tba.refreshScreen);setClick("monitor",_tba.toggleMonitor);setClick("kimouse",_tba.toggleMouse);setClick("kiscale",_tba.toggleScaled);setClick("kisettings",_tba.showSettings)}else{$("#ctrlAltDel").click(_tba.sendCtrlAntDel);$("#ctrlEsc").click(_tba.sendCtrlEsc);$("#refresh").click(_tba.refreshScreen);$("#monitor").click(_tba.toggleMonitor);
$("#kimouse").click(_tba.toggleMouse);$("#kiscale").click(_tba.toggleScaled);$("#kisettings").click(_tba.showSettings)}}if(productId=="virtualui"){Object.defineProperty(THIN,"showKeyboard",{"enumerable":true,"configurable":false,"writable":false,"value":keyboardShortCut_click});if(supportsFullScreenMode==true)Object.defineProperty(THIN,"toggleFullscreen",{"enumerable":true,"configurable":false,"writable":false,"value":toggleFullScreenMode})}if(!THIN.events)THIN.events={};THIN.events.onServerConnecting=
function(e){if(typeof callbacks!="undefined"&&callbacks.onServerConnecting)callbacks.onServerConnecting(e)};THIN.events.onSessionEnd=function(e){if(typeof callbacks!="undefined"&&callbacks.onSessionEnd)callbacks.onSessionEnd(e)};THIN.events.onServerConnectionError=function(e){$.unblockUI();if(typeof callbacks!="undefined"&&callbacks.onServerConnectionError)callbacks.onServerConnectionError(e)};THIN.events.onServerError=function(e){$.unblockUI();if(typeof callbacks!="undefined"&&callbacks.onServerError)callbacks.onServerError(e)};
THIN.events.onServerConnect=function(e){var previousText="x";var prevoustTextTimer=null;var isChrome229=agentInfo.isAndroid&&agentInfo.isChrome&&agentInfo.chromeVersion>="50.";zoom(1);hideUrlBar();adjustMainSize();$("#connectpanel").hide();$("#mainheader").hide();helper.dom.addEvent(window,"touchmove",function(e){if(!dialogVisible)e.preventDefault()},{"passive":false});touchkbdElem.value="";$(touchkbdElem).unbind("keyup");$(touchkbdElem).unbind("keydown");if(helper.object.existsPath(window,"Thinfinity.Driver.MobileKeyboard")){if(!THIN.mobileKeyboard)THIN.mobileKeyboard=
new Thinfinity.Driver.MobileKeyboard({"input":touchkbdElem,"output":THIN.sendKey,"methods":{"isPrintableKey":function(keyCode){return keyCode>=33&&keyCode<=126||keyCode>=193&&keyCode<=248},"isControlCharacter":function(keyCode){return keyCode>=0&&keyCode<=31}}})}else{touchkbdElem.value=agentInfo.isChromium&&agentInfo.majorVersion>=5?"":"x";$(touchkbdElem).keydown(function(e){key=e.which;if(key==9){THIN.sendKey(key,0,"down");THIN.sendKey(key,0,"up");e.preventDefault();THIN.lastKeyCode=key}else THIN.lastKeyCode=
0});$(touchkbdElem).keyup(function(e){var rt=(new Date).getTime();var key=e.which;var kcode=0;if(rt-replyTime>50||key!=lastKey){replyTime=rt;var str=touchkbdElem.value;var len=str.length;if(agentInfo.isChromium&&agentInfo.majorVersion<5){elem.value="";if(len<1){if(key==8||key==13){if(key==8&&backSpacePressed)return;sendSpecialKeysBegin();THIN.sendKey(key,0,"down");THIN.sendKey(key,0,"up");sendSpecialKeysEnd();if(key==8){backSpacePressed=true;window.setTimeout(function(){backSpacePressed=false},100)}}}else{sendSpecialKeysBegin();
for(var i=0;i<len;++i){key=str.charCodeAt(i);kcode=getFlatKeyCode(key);THIN.sendKey(kcode,key,"down");THIN.sendKey(kcode,key,"up")}sendSpecialKeysEnd()}}else if(len<2){if(THIN.lastKeyCode==9)return;if(key==0)key=len==0?8:13;if(isChrome229&&key==229)key=8;sendSpecialKeysBegin();if(agentInfo.isIOS==true&&agentInfo.isSafari==true&&str=="x"&&key!=8&&key!=13)sendSpecialKeysEnd();else{THIN.sendKey(key,0,"down");THIN.sendKey(key,0,"up");sendSpecialKeysEnd()}}else{sendSpecialKeysBegin();for(var i=1;i<len;++i){key=
str.charCodeAt(i);kcode=getFlatKeyCode(key);THIN.sendKey(kcode,key,"down");THIN.sendKey(kcode,key,"up")}sendSpecialKeysEnd()}lastKey=key;if(isChrome229)lastKey=e.which;touchkbdElem.value="x";touchkbdElem.selectionStart=touchkbdElem.selectionEnd=touchkbdElem.value.length}if(key==13&&(agentInfo.isWindows||agentInfo.isAndroid&&(!agentInfo.isChrome||agentInfo.isChrome&&agentInfo.chromeVersion<"5.0.0")))$(touchkbdElem).blur()});if(agentInfo.isAndroid&&agentInfo.isChrome&&agentInfo.chromeVersion=="5.1.1"&&
agentInfo.agentStr.indexOf("sm-g900t1")!=-1){$(touchkbdElem).unbind("keyup");touchkbdElem.onkeyup=function(e){var rt=(new Date).getTime();var key=e.which;var tempStr="";if(rt-replyTime>40||key!=lastKey){replyTime=rt;var str=touchkbdElem.value;tempStr=str.replace(previousText,"");var len=tempStr.length;if(len<1){if(THIN.lastKeyCode==9)return;if(key==0)key=len==0?8:13;sendSpecialKeysBegin();if(agentInfo.isIOS==true&&agentInfo.isSafari==true&&tempStr=="x"&&key!=8&&key!=13)sendSpecialKeysEnd();else{THIN.sendKey(key,
0,"down");THIN.sendKey(key,0,"up");sendSpecialKeysEnd()}}else{sendSpecialKeysBegin();for(var i=0;i<len;++i){key=tempStr.charCodeAt(i);THIN.sendKey(0,key,"down");THIN.sendKey(0,key,"up")}sendSpecialKeysEnd()}lastKey=key;previousText=str;clearTimeout(prevoustTextTimer);prevoustTextTimer=setTimeout(function(){previousText="x";touchkbdElem.value="x";touchkbdElem.selectionStart=touchkbdElem.selectionEnd=touchkbdElem.value.length},250)}if(key==13&&(agentInfo.isWindows||agentInfo.isAndroid&&(!agentInfo.isChrome||
agentInfo.isChrome&&agentInfo.chromeVersion<"5.0.0")))$(touchkbdElem).blur()}}}$(touchkbdElem).focus(function(){kbScreenHeight=window.environment.availHeight||$(window).height();kbScreenWidth=window.environment.availWidth||$(window).width();this.selectionStart=this.selectionEnd=this.value.length});$(touchkbdElem).blur(function(){if(!isKeyboardVisible())return;helper.style.addClass(document.body,"mobile");clearTimeout(keyboardSettings["timeoutId"]);clearInterval(keyboardSettings["intervalId"]);touchkbdElem.style.top=
"-100px";touchkbdElem.style.left="-1000px";_showingStdKdb=false;if(productId==="thinvnc"){document.body.height=_domHeight+"px";window.scrollTo(0,_winScrollY)}window.clearInterval(kbdTimer);if(stdKeyboardVisible){stdKeyboardVisible=false;hideExtKeys()}adjustMainSize();zoom(THIN.getZoom(),true)});if(typeof callbacks!="undefined"&&callbacks.onServerConnect)callbacks.onServerConnect(e)};THIN.events.onServerDisconnect=function(e){if(!isBlocked())if(e&&!e.isDefaultPrevented())if(window.name.substring(0,
8)=="RDPCONN_"){window.opener="x";window.close()}else window.location.href="/";else{if(kbdTimer)window.clearInterval(kbdTimer);$(touchkbdElem).blur()}if(THIN.mobileKeyboard)THIN.mobileKeyboard.dispose();if(typeof callbacks!="undefined"&&callbacks.onServerDisconnect)callbacks.onServerDisconnect(e);toolbarAvailable=helper.object.existsPath(THIN,"toolbar");if(window.environment.isFullscreen==true)toggleFullScreenMode()};THIN.events.onServerReconnect=function(e){if(typeof callbacks!="undefined"&&callbacks.onServerReconnect)callbacks.onServerReconnect(e);
toolbarAvailable=helper.object.existsPath(THIN,"toolbar")};THIN.events.onServerCommandResult=function(obj){if(THIN.connected){if(typeof THIN.rcParams.pin!="undefined"&&THIN.rcParams.pin!="")$("#mouse").button("disable");refreshButtonStates();if(typeof callbacks!="undefined"&&callbacks.onServerCommandResult)callbacks.onServerCommandResult(obj)}};THIN.events.onScreenReceived=function(obj){if(THIN.connected)if(typeof callbacks!="undefined"&&callbacks.onScreenReceived)callbacks.onScreenReceived(obj)};
THIN.events.onSessionStart=function(obj){if(THIN.connected){if(productId=="thinrdp"&&agentInfo.isMobile==true&&window.environment.fullScreenAvailable==true)if(window.environment.rawWidth==THIN.rcParams.viewWidth/window.environment.currentDevicePixelRatio+(window.environment.margin.left+window.environment.margin.right)&&window.environment.rawHeight==THIN.rcParams.viewHeight/window.environment.currentDevicePixelRatio+(window.environment.margin.top+window.environment.margin.bottom)){var zoomReset=THIN.zoomFactorReset();
zoomBottomLimit=zoomReset;zoom(zoomReset)}else;if(window.environment.isFullscreen==true){var zoomReset=THIN.zoomFactorReset();var zoomValue=THIN.getZoom();if(zoomValue<zoomReset)zoomValue=zoomReset}if(THIN.rcParams.viewWidth>window.environment.rawWidth||THIN.rcParams.viewHeight>window.environment.rawHeight)zoomBottomLimit=THIN.getScale();if(isNewConnection){interfaceMethods=THIN.display.managerInterface.methods;interfaceProperties=THIN.display.managerInterface.properties;THIN.display.managerInterface.on("onMouseAnimationFrameEnd",
function(){if(lastEvent&&getRelativeTouchByPointerType(lastEvent)){startMouseX=savedX;startMouseY=savedY}})}THIN.show();if(typeof callbacks!="undefined"&&callbacks.onSessionStart)callbacks.onSessionStart(obj);const buildToolbar=()=>{toolbarAvailable=helper.object.existsPath(THIN,"toolbar");addToolbarButtons()};THIN?.__thinMenuProps__?.ready(()=>{setTimeout(buildToolbar,2E3)});if(isNewConnection==true){isNewConnection=false;moveMouseToStart()}}};THIN.events.onConnectionLost=function(e){if(typeof callbacks!=
"undefined"&&callbacks.onConnectionLost)callbacks.onConnectionLost(e)};THIN.events.onConnectionRestored=function(e){if(typeof callbacks!="undefined"&&callbacks.onConnectionRestored)callbacks.onConnectionRestored(e)};var shortcut={};if(helper.object.existsPath(THIN,"rcParams.mobile.extendedKeyboard")&&THIN.rcParams.mobile.extendedKeyboard.enabled!=false&&THIN.rcParams.mobile.extendedKeyboard.keys)shortcut=THIN.rcParams.mobile.extendedKeyboard.keys;addKey(1,consts.F1,112,undefined,undefined,undefined,
shortcut.F1);addKey(1,consts.F2,113,undefined,undefined,undefined,shortcut.F2);addKey(1,consts.F3,114,undefined,undefined,undefined,shortcut.F3);addKey(1,consts.F4,115,undefined,undefined,undefined,shortcut.F4);addKey(1,consts.F5,116,undefined,undefined,undefined,shortcut.F5);addKey(1,consts.F6,117,undefined,undefined,undefined,shortcut.F6);addKey(1,consts.Esc,27,undefined,undefined,undefined,shortcut.Esc);addKey(1,consts.Print,42,undefined,undefined,undefined,shortcut.Print);addKey(1,consts.Scrlck,
44,undefined,undefined,undefined,shortcut.Scrlck);addKey(1,consts.Pause,19,undefined,undefined,undefined,shortcut.Pause);addKey(1,consts.NumL,144,undefined,undefined,undefined,shortcut.NumL);addKey(2,consts.F7,118,undefined,undefined,undefined,shortcut.F7);addKey(2,consts.F8,119,undefined,undefined,undefined,shortcut.F8);addKey(2,consts.F9,120,undefined,undefined,undefined,shortcut.F9);addKey(2,consts.F10,121,undefined,undefined,undefined,shortcut.F10);addKey(2,consts.F11,122,undefined,undefined,
undefined,shortcut.F11);addKey(2,consts.F12,123,undefined,undefined,undefined,shortcut.F12);addKey(2,consts.PgUp,33,undefined,undefined,undefined,shortcut.PgUp);addKey(2,consts.PgDn,34,undefined,undefined,undefined,shortcut.PgDn);addKeyImg(2,imgMPath+"arrow-up.png",38,undefined,undefined,undefined,shortcut.Up);addKey(2,consts.Return,13,4,undefined,undefined,undefined,shortcut.Return);addKey(3,consts.WinKey,0,4,sendCtrlEsc,undefined,shortcut.WinKey);addKey(3,consts.CtrlAltDel,0,4,sendCtrlAltDel,undefined,
shortcut.CtrlAltDel);addKey(3,consts.Computer,0,4,sendShellExplorer,undefined,shortcut.Computer);addKey(3,consts.Tab,9);addKeyImg(3,imgMPath+"arrow-left.png",undefined,undefined,undefined,37,shortcut.Left);addKeyImg(3,imgMPath+"arrow-down.png",undefined,undefined,undefined,40,shortcut.Down);addKeyImg(3,imgMPath+"arrow-right.png",undefined,undefined,undefined,39,shortcut.Right);addKeyImg(3,imgMPath+"querty.png",0,2,closeExtKeyboard);addExtKey(1,consts.Ctrl,0,2,"keyctrl",undefined,shortcut.Ctrl);addExtKey(1,
consts.Alt,0,2,"keyalt",undefined,shortcut.Alt);addExtKey(1,consts.Shift,0,2,"keyshift",undefined,shortcut.Shift);addExtKey(1,consts.Ins,0,2,45,undefined,shortcut.Ins);addExtKey(1,consts.Del,0,2,46,undefined,shortcut.Del);addExtKey(1,consts.BackSpace,8,2,8,undefined,shortcut.BackSpace);addExtKey(1,consts.Home,0,2,36,undefined,shortcut.Home);addExtKey(1,consts.End,0,2,35,undefined,shortcut.End);addExtKey(1,consts.Next,0,2,9,undefined,shortcut.Next);addExtKey(1,String.fromCharCode(9650),0,2,"keyCloseKeyboards",
undefined,undefined);$("#extkeys").css("margin-left","-"+$("#extkeys").width()/2+"px");$("div.key").bind("touchstart",function(e){if(!helper.style.hasClass(this,"disabledKey"))$(this).addClass("pressed")});$("div.key").bind("touchend",function(e){$(this).removeClass("pressed")});$("#keyctrl").bind("touchend",function(e){CtrlKeyToggle()});$("#keyalt").bind("touchend",function(e){AltKeyToggle()});$("#keyshift").bind("touchend",function(e){ShiftKeyToggle()});$("#keyCloseKeyboards").bind("touchend",function(e){if(extKeyboardVisible)closeExtKeyboard();
$(touchkbdElem).blur();hideExtKeys()});window.addEventListener("scroll",function(e){window.clearTimeout(scrollingTOUT);scrollingTOUT=setTimeout(function(){alignPanels()},66)},false);$(touchkbdElem).blur();if(showToolbar){hideExtKeys();hideExtKeyboard()}hideUrlBar();function configureVirtualKeyboard(bool){keyboardSettings["available"]=helper.object.convertTo(bool,"boolean")}Object.defineProperty(THIN,"virtualKeyboard",{"enumerable":true,"configurable":false,"set":function(bool){configureVirtualKeyboard(bool)},
"get":function(){return keyboardSettings["available"]}});if(THIN.rcParams!=undefined&&typeof THIN.rcParams.virtualKeyboard!="undefined")configureVirtualKeyboard(THIN.rcParams.virtualKeyboard);mobileReady=true}function addToolbarButtons(){if(showToolbar&&toolbarAvailable&&_tba){var mobileButtons=[];mobileButtons.push({"caption":"Right Click","attributes":{"id":"rightclickBtn","icon":"thin-rightclick","class":!THIN.rcParams.mouseControl?"lower-opacity":""},"handler":!THIN.rcParams.mouseControl?function(){}:
_tba.sendRightClick});if(!THIN.rcParams.disableExtKeys)mobileButtons.push({"caption":"Function Keyboard","attributes":{"id":"fnKeyboardBtn","icon":"thin-functionkeyboard","class":!THIN.rcParams.mouseControl?"lower-opacity":""},"handler":!THIN.rcParams.mouseControl?function(){}:_tba.showExtKbd});mobileButtons.push({"caption":"Keyboard","attributes":{"id":"keyboardBtn","icon":"thin-keyboard","class":!THIN.rcParams.mouseControl?"lower-opacity":""},"handler":!THIN.rcParams.mouseControl?function(){}:_tba.showStdKbd});
if(insertNavigator&&(!supportsFullScreenMode&&!agentInfo.isMobile))mobileButtons.push({"caption":"Navigator","attributes":{"id":"navigatorBtn","icon":"thin-inspector"},"handler":function(e){if(navControl.isVisible())navControl.hide();else navControl.show()}});if(helper.object.getValue(THIN.rcParams,"mobile.canChangeTouchMode",true,{ignoreCase:true})){if(THIN.toolbar.getToggledData().indexOf("touchModeBtn")!=-1)setRelativeTouch(false);mobileButtons.push({"caption":"Set Absolute Touch","attributes":{"icon":"thin-absolutetouch",
"id":"touchModeBtn"},"handler":()=>{if(relativeTouch)THIN.__thinMenuProps__.updateProperty({action:"touchModeBtn",caption:"Set Relative Touch",attributes:{"icon":"thin-relativetouch"}});else THIN.__thinMenuProps__.updateProperty({action:"touchModeBtn",caption:"Set Absolute Touch",attributes:{"icon":"thin-absolutetouch"}});setRelativeTouch(!relativeTouch)}})}if(supportsFullScreenMode&&productId!="webfmx"&&productId!="virtualui"&&(!agentInfo.isSafari||agentInfo.isSafari&&agentInfo.ipadModel==="pro"))if(!helper.object.getValue(THIN.rcParams,
"mobile.disableFullScreen",false,{ignoreCase:true}))mobileButtons.push({"caption":"Fullscreen","attributes":{"id":"fullscreenBtn","icon":"thin-enter-fullscreen"},"handler":_tba.toggleFullScreen});mobileButtons.push({"caption":"Touch Redirection","attributes":{"id":"touchRedirBtn","class":!THIN.rcParams.mouseControl?"lower-opacity":"","icon":"thin-touchredir"},"initialState":"hidden","handler":!THIN.rcParams.mouseControl?function(){}:_tba.toggleTouchRedir});mobileButtons.forEach(function(mb){THIN.__thinMenuProps__.addProperty({parent:null,
insertBefore:thinRDPconsts.options,action:mb.attributes.id,...mb})})}}function hideUrlBar(){window.setTimeout(function(){window.scroll(0,1);adjustMainSize()},1500)}function initTouchDevice(){self.initTouchManager(agentInfo.isTouch)}function getFlatKeyCode(charCode){var fv=0;switch(true){case charCode==170||charCode>=192&&charCode<=198||charCode>=224&&charCode<=230||charCode>=256&&charCode<=257||charCode>=260&&charCode<=261:fv=65;break;case charCode>=200&&charCode<=203||charCode>=232&&charCode<=235||
charCode>=274&&charCode<=275||charCode>=278&&charCode<=281:fv=69;break;case charCode>=204&&charCode<=207||charCode>=236&&charCode<=239||charCode>=298&&charCode<=299||charCode>=302&&charCode<=303:fv=73;break;case charCode==186||charCode>=210&&charCode<=214||charCode==216||charCode>=242&&charCode<=246||charCode==248||charCode>=332&&charCode<=333||charCode>=338&&charCode<=339:fv=79;break;case charCode>=217&&charCode<=220||charCode>=249&&charCode<=252||charCode>=362&&charCode<=363:fv=85;break;case charCode==
231||charCode==199||charCode>=262&&charCode<=263||charCode>=268&&charCode<=269:fv=67;break;case charCode>=323&&charCode<=324:fv=209;break}return fv}this.initTouchManager=function(useLocalGestures){var redirectionSettings={};ThinVNCTouchManager["redirectionStarted"]=function(){if(showToolbar&&toolbarAvailable){THIN.toolbar.updateElem({"attributes":{"id":"touchRedirBtn"},"visible":true,"toggleState":true});THIN.toolbar.updateElem({"attributes":{"id":"rightclickBtn"},"visible":false})}$(THIN.cursorCanvas).hide()};
ThinVNCTouchManager["redirectionStopped"]=function(){if(showToolbar&&toolbarAvailable){THIN.toolbar.updateElem({"attributes":{"id":"touchRedirBtn"},"toggleState":false});THIN.toolbar.updateElem({"attributes":{"id":"rightclickBtn"},"visible":true})}$(THIN.cursorCanvas).show()};if(useLocalGestures){var tapPosThreshold=25;var previousMouseX=-9999;var previousMouseY=-9999;var previousTapTime=0;var lastScale=null;var pinchGestureMinDistance=20;var wheelGestureMinDistance=20;var swipeFingerCount=3;var gesture=
null;var oldGesture=null;var captureStartEvent=null;var captureDistanceX=0;var captureDistanceY=0;var wheelSettings={"axis":null,"direction":null,"previousValue":null,"thresholdStartDetection":15,"thresholdDistance":2,"stepValue":120,"lastScale":null,"inverted":typeof THIN.rcParams.mouseWheelDirection!="undefined"?THIN.rcParams.mouseWheelDirection==-1:false,"elapsedTime":0,"lasttimeSent":0,"sentTime":150};contextMenu={"elem":null,"items":[{"id":"btnDoubleClick","handler":btnDblClickFromCtxMenu,"text":"Double click",
"icon":null},{"id":"btnRightClick","handler":btnRightClickFromCtxMenu,"text":"Right click","icon":null},{"id":"btnVKeyboard","handler":keyboardShortCut_click,"text":"Open keyboard","icon":null},{"id":"btnOpenMenu","handler":openMenuShortCut_click,"text":"Open menu","icon":null}],"timeoutId":null,"autoHideTime":2E3,"autoHideArea":150,"zIndex":889E3};const _actionsCtx={init:{"wheel":{beforeTriggered:false}}};if(agentInfo.isChromium&&agentInfo.agentStr.indexOf("android 4.2.2")!=-1)$(document).click(function(e){var elem=
(relativeTouch?document.elementFromPoint(cursorCanvasX(),cursorCanvasY()):null)||e.target;var tapElement=e&&e.target?e.target:null;if($(elem).hasClass("taptarget")||$(elem.parentElement).hasClass("taptarget")||$(elem).hasClass("disabled")){$(elem).trigger("tap");return}if($(elem).hasClass("ignoremouse")||$(elem.parentElement).hasClass("ignoremouse"))return;if($(tapElement).hasClass("uitaptarget")||$(tapElement).parents().hasClass("uitaptarget"))return;var currentTime=(new Date).getTime();if(currentTime-
previousTapTime>50){previousTapTime=currentTime;lastEvent=e;var x=getTouchXFixed();var y=getTouchYFixed();if(!zoomStarted){button="left";touchstate=1;try{mouseScrollX=x;mouseScrollY=y;if(relativeTouch){startMouseX=cursorCanvasX();startMouseY=cursorCanvasY()}else{startMouseX=getTouchX(relativeTouch);startMouseY=getTouchY(relativeTouch)}var x=startMouseX;var y=startMouseY;if(typeof THIN.onTap!="undefined"){THIN.onTap(x,y);e.preventDefault()}}finally{touchstate=0}if(touchstate==3)mouseMoveIntoView()}}else return});
function isRangePosition(e){var x=e.clientX||e.pageX;var y=e.clientY||e.pageY;var r=x>previousMouseX+tapPosThreshold?true:x<previousMouseX-tapPosThreshold?true:y>previousMouseY+tapPosThreshold?true:y<previousMouseY-tapPosThreshold?true:false;previousMouseX=x;previousMouseY=y;return!r}function getGesture(e){var ret=null;if(e&&e.pointers.length>1){var fc=e.pointers.length;if(fc>=swipeFingerCount)ret="swipe";else{var wheelDistance=Math.max(Math.abs(captureStartEvent.center.x-e.center.x),Math.abs(captureStartEvent.center.y-
e.center.y));var pinchDistance=Math.max(Math.abs(Math.abs(e.pointers[0].clientX-e.pointers[1].clientX)-captureDistanceX),Math.abs(Math.abs(e.pointers[0].clientY-e.pointers[1].clientY)-captureDistanceY));if(pinchDistance>pinchGestureMinDistance&&wheelDistance<wheelGestureMinDistance)ret="pinch";else if(wheelDistance>wheelGestureMinDistance&&pinchDistance<pinchGestureMinDistance)ret="wheel"}}return ret}function multiGestureEnds(){if(zoomStarted)window.setTimeout(function(){zoomStarted=false},300);oldGesture=
gesture=null;if(touchstate==3)mouseMoveIntoView();wheelSettings.axis=null;captureStartEvent=null;captureDistanceX=0;captureDistanceY=0;clearTimeout(gestureTimeout);scrollLeftCapture=null;scrollTopCapture=null}function createContextMenu(){contextMenu.elem=helper.dom.appendJsonElement({"parentElement":THIN.vncContainer,"type":"div","id":"contextMenu","attributes":{"class":"context-menu contextmenu"}});contextMenu.items.forEach(function(item){var itemElem=helper.dom.appendJsonElement({"parentElement":contextMenu.elem,
"type":"div","attributes":{"class":"item contextmenu","id":item.id},"events":{"click":function(){}}});itemElem.handler=item.handler;helper.dom.appendJsonElement({"parentElement":itemElem,"type":"div","attributes":{"class":"icon contextmenu"}});helper.dom.appendJsonElement({"parentElement":itemElem,"type":"div","attributes":{"class":"line contextmenu"}});helper.dom.appendJsonElement({"parentElement":itemElem,"type":"div","attributes":{"class":"text contextmenu"},"content":item.text})})}function showContextMenu(x,
y){if(!contextMenu.elem)createContextMenu();contextMenu.elem.x=x;contextMenu.elem.y=y;var zIndex=helper.style.getAttribute(THIN.cursorCanvas,"z-index");if(zIndex!="")zIndex=parseInt(zIndex,10)-10;else zIndex=contextMenu.zIndex;contextMenu.elem.style.zIndex=zIndex;contextMenu.elem.style.visibility="hidden";contextMenu.elem.style.display="block";var size=helper.size.get(contextMenu.elem);var margin=15;if(margin+size.width+x-THIN.vncdiv.scrollLeft>THIN.rcParams.maxWidth)x=THIN.vncdiv.scrollLeft+THIN.rcParams.maxWidth-
(size.width+margin);if(margin+size.height+y-THIN.vncdiv.scrollTop>THIN.rcParams.maxHeight)y=THIN.vncdiv.scrollTop+THIN.rcParams.maxHeight-(size.height+margin);contextMenu.elem.style.left=x+"px";contextMenu.elem.style.top=y+"px";contextMenu.elem.querySelectorAll(".item.contextmenu").forEach(function(itemElem){helper.style.removeClass(itemElem,"selected")});THIN.avoidSendMouseMove=true;contextMenu.elem.style.visibility="visible"}function isContextMenuVisible(){return contextMenu.elem&&contextMenu.elem.style.display!=
"none"}function getItem(elem){if(elem.className.indexOf("item contextmenu")!=-1)return elem;else if(elem.className.indexOf(".context-menu.contextmenu")!=-1)return;else if(elem.parentElement.className.indexOf("item contextmenu")!=-1)return elem.parentElement;else return null}function checkContextMenu(e,isTap){if(isContextMenuVisible()){var x,y=0;var elem=null;var relativeTouchFromPointer=getRelativeTouchByPointerType(e);let mPosition=getMouseScreenPosition();x=mPosition.x;y=mPosition.y;if(!relativeTouchFromPointer)elem=
e.target;if(Math.abs(x-contextMenu.elem.x)+Math.abs(y-contextMenu.elem.y)>contextMenu.autoHideArea){hideContextMenu(true);return false}if(relativeTouchFromPointer)elem=document.elementFromPoint(cursorCanvasX()-THIN.vncdiv.scrollLeft*THIN.scale,cursorCanvasY()-THIN.vncdiv.scrollTop*THIN.scale);if(elem&&elem.className.indexOf("contextmenu")!=-1){var item=getItem(elem);if(item)if(isTap){if(!relativeTouchFromPointer)setTimeout(function(){helper.style.add(item,"selected")},1);if(item.handler){document.body.focus();
hideContextMenu(true);item.handler()}}else if(item.className.indexOf("selected")==-1){contextMenu.elem.querySelectorAll(".item.contextmenu").forEach(function(itemElem){helper.style.removeClass(itemElem,"selected")});helper.style.add(item,"selected")}return true}else if(isTap)hideContextMenu(true);return false}else return false}function hideContextMenu(immediately){clearTimeout(contextMenu.timeoutId);if(contextMenu.elem&&contextMenu.elem.style.display!="none"){if(immediately===true){THIN.avoidSendMouseMove=
false;contextMenu.elem.style.display="none"}else contextMenu.timeoutId=setTimeout(function(){THIN.avoidSendMouseMove=false;contextMenu.elem.style.display="none"},contextMenu.autoHideTime);return false}}var scrollLeftCapture=null;var scrollTopCapture=null;var gestureTimeout=null;var _actionsProcessors={"pinchStart":function(e){hideContextMenu();oldGesture=gesture=null;if(e&&e.pointers.length>1){e.srcEvent.stopPropagation();e.srcEvent.preventDefault()}clearTimeout(gestureTimeout);captureStartEvent=
e;captureDistanceX=Math.abs(captureStartEvent.pointers[0].clientX-captureStartEvent.pointers[1].clientX);captureDistanceY=Math.abs(captureStartEvent.pointers[0].clientY-captureStartEvent.pointers[1].clientY);lastEvent=e;startMouseX=getTouchX(relativeTouch);startMouseY=getTouchY(relativeTouch);if(!zoomStarted){button="left";touchstate=1}lastScale=THIN.getZoom()},"pinchMove":function(e){if(gesture==null){oldGesture=gesture;gesture=getGesture(e);clearTimeout(gestureTimeout);gestureTimeout=setTimeout(function(){var newGesture=
getGesture(e);if(newGesture!=gesture&&gesture!=null){captureStartEvent=e;captureDistanceX=Math.abs(captureStartEvent.pointers[0].clientX-captureStartEvent.pointers[1].clientX);captureDistanceY=Math.abs(captureStartEvent.pointers[0].clientY-captureStartEvent.pointers[1].clientY)}if(gesture!==newGesture)oldGesture=gesture;gesture=newGesture},3E3)}},"zoomPanStart":function(e){hideContextMenu();oldGesture=gesture=null;clearTimeout(gestureTimeout);captureStartEvent=e;captureDistanceY=Math.abs(captureStartEvent.pointers[0].clientY-
captureStartEvent.pointers[1].clientY);captureDistanceX=Math.abs(captureStartEvent.pointers[0].clientX-captureStartEvent.pointers[1].clientX);lastEvent=e;startMouseX=getTouchX(relativeTouch);startMouseY=getTouchY(relativeTouch)},"zoomPanMove":function(e){if(gesture==null){oldGesture=gesture;gesture=getGesture(e);clearTimeout(gestureTimeout);gestureTimeout=setTimeout(function(){var newGesture=getGesture(e);if(newGesture!=gesture&&gesture!=null){captureStartEvent=e;captureDistanceX=Math.abs(captureStartEvent.pointers[0].clientX-
captureStartEvent.pointers[1].clientX);captureDistanceY=Math.abs(captureStartEvent.pointers[0].clientY-captureStartEvent.pointers[1].clientY)}if(gesture!==newGesture)oldGesture=gesture;gesture=newGesture},3E3)}},"screenPan":function(e){if(!THIN.rcParams.scaled&&!isContextMenuVisible())if(divScrolling){let th=5;var mX=THIN.mouseX;let sl=THIN.vncdiv.scrollLeft;let mw=THIN.rcParams.maxWidth;let vw=THIN.rcParams.viewWidth;var mY=THIN.mouseY;let st=THIN.vncdiv.scrollTop;let mh=THIN.rcParams.maxHeight;
let vh=THIN.rcParams.viewHeight;if(sl<mX+th-mw||mX<sl&&sl>mX-sl){mX=mX<sl?mX:mX+th-mw;if(mw+mX>vw)mX=vw-mw;else if(mX<0)mX=0;THIN.vncdiv.scrollLeft=mX}if(st<mY+th-mh||mY<st&&st>mY-st){mY=mY<st?mY:mY+th-mh;if(mh+mY>vh)mY=vh-mh;else if(mY<0)mY=0;THIN.vncdiv.scrollTop=mY}}else{var sl=getScrollLeft();var st=getScrollTop();var sw=screenWidth;var sh=screenHeight;if(sl<THIN.mouseX-sw||THIN.mouseX<sl&&sl>THIN.mouseX-sl)sl=THIN.mouseX<sl?THIN.mouseX:THIN.mouseX-sw;if(st<THIN.mouseY-sh||THIN.mouseY<st&&st>
THIN.mouseY-st)st=THIN.mouseY<st?THIN.mouseY:THIN.mouseY-sh;window.scroll(sl,st)}},"hold":function(e,btn){var relativeTouchFromPointer=getRelativeTouchByPointerType(e);if(!isContextMenuVisible()&&held.indexOf(btn)===-1){held.push(btn);mouseDown(btn,startMouseX,startMouseY,relativeTouchFromPointer)}},"release":function(e,btn){var relativeTouchFromPointer=getRelativeTouchByPointerType(e);if(held.indexOf(btn)!==-1){held=held.filter(function(t){return t!==btn});mouseUp(btn,startMouseX,startMouseY,relativeTouchFromPointer)}}};
var actions=ThinVNCTouchManager["actions"]={"zoomPan":function(e){var eType=e&&e.type?e.type.toUpperCase():null;if(eType.indexOf("START")!=-1)_actionsProcessors.zoomPanStart.call(this,e);else if(eType.indexOf("MOVE")!=-1)_actionsProcessors.zoomPanMove.call(this,e);else if(eType.indexOf("END")!=-1||eType.indexOf("CANCEL")!=-1)multiGestureEnds();else{lastEvent=e;var deltaX=(captureStartEvent.center.x-e.center.x)/THIN.zoomFactor;var deltaY=(captureStartEvent.center.y-e.center.y)/THIN.zoomFactor;if(scrollTopCapture==
null)scrollTopCapture=THIN.vncdiv.scrollTop;if(scrollLeftCapture==null)scrollLeftCapture=THIN.vncdiv.scrollLeft;var sl=scrollLeftCapture+deltaX;var st=scrollTopCapture+deltaY;divScroll(sl,st);touchstate=3}},"zoomOrWheel":function(e,actionArgs){var eType=e&&e.type?e.type.toUpperCase():null;if(eType.indexOf("START")!=-1)_actionsProcessors.pinchStart.call(this,e);else if(eType.indexOf("MOVE")!=-1)_actionsProcessors.pinchMove.call(this,e);else if(eType.indexOf("END")!=-1||eType.indexOf("CANCEL")!=-1)multiGestureEnds();
else if(gesture=="pinch")actions.zoom.call(this,e,actionArgs);else if(gesture=="wheel")actions.wheel.handler.call(this,e,actionArgs)},"key":function(e,{code,ch=0,direction,loc=0}={}){const ucKeys=Object.keys(THIN.mobileKeyboard.enumKeys).reduce((acc,t)=>({...acc,[t.toUpperCase()]:THIN.mobileKeyboard.enumKeys[t]}),{});code=typeof code=="string"?ucKeys[code.toUpperCase()]??null:code;THIN.sendKey(code,ch,direction,loc)},"wheel":{on:"ALL",handler:function(e,{direction="VERTICAL",gesture:acgesture="PAN",
stepValue=wheelSettings.stepValue,speedRelative,stepValue:stepValueOg,triggerAction=()=>{},sensitivity}={}){const {type,additionalEvent,scale}={...e,type:e.type.toUpperCase(),additionalEvent:e.additionalEvent?.toUpperCase()};if(!_actionsCtx["wheel"])_actionsCtx["wheel"]={..._actionsCtx.init.wheel};acgesture=acgesture?.toUpperCase?.()??"PAN";const matchingACGestures={"ZOOM":"pinch","PAN":"wheel"};if(type.includes("START")){_actionsProcessors.pinchStart.call(this,e);if(acgesture=="ZOOM")wheelSettings.lastScale=
null;_actionsCtx["wheel"].beforeTriggered=false;sensitivity.reset()}else if(type.includes("MOVE")){if(gesture!==null)if(matchingACGestures[acgesture]==gesture)if(oldGesture==null&&!_actionsCtx["wheel"].beforeTriggered){triggerAction(gesturesOnStates.BEFORE);_actionsCtx["wheel"].beforeTriggered=true}else triggerAction(gesturesOnStates.WHILE);_actionsProcessors.pinchMove.call(this,e);if(acgesture=="ZOOM"&&matchingACGestures[acgesture]==gesture){let pinchDirection=wheelSettings.lastScale!=null?wheelSettings.lastScale>=
scale?-1:1:null;pinchDirection=!pinchDirection&&additionalEvent?additionalEvent.split("_")[1]?.includes("IN")?-1:1:pinchDirection;if(pinchDirection){let wheelX,wheelY=0;wheelSettings.lastScale=scale;const step=stepValue*pinchDirection;wheelX=direction=="HORIZONTAL"?step:0;wheelY=direction=="VERTICAL"?step:0;if(sensitivity.isValid())THIN.sendWheel(wheelY,wheelX);sensitivity.call()}}}else if(type.includes("END")){if(gesture!==null&&matchingACGestures[acgesture]==gesture)triggerAction(gesturesOnStates.AFTER);
multiGestureEnds();if(acgesture=="ZOOM")wheelSettings.lastScale=null}else{if(["PAN"].includes(acgesture))if(gesture!==null&&matchingACGestures[acgesture]==gesture)triggerAction(gesturesOnStates.WHILE);if(acgesture=="PAN"&&matchingACGestures[acgesture]==gesture){if(wheelSettings.axis==null){if(Math.abs(e.deltaY)>wheelSettings.thresholdStartDetection)wheelSettings.axis="vertical";else if(Math.abs(e.deltaX)>wheelSettings.thresholdStartDetection)wheelSettings.axis="horizontal";wheelSettings.previousValue=
0}var step=0;if(wheelSettings.axis!=null){if(typeof THIN.rcParams.mouseWheelStepValue!="undefined"&&wheelSettings.stepValue!=THIN.rcParams.mouseWheelStepValue&&THIN.rcParams.mouseWheelStepValue>0)wheelSettings.stepValue=THIN.rcParams.mouseWheelStepValue;if(typeof THIN.rcParams.mouseWheelDirection!="undefined")wheelSettings.inverted=THIN.rcParams.mouseWheelDirection==-1;function getStep(deltaAxis,speedAxis,{stepValue=null,speedRelative=true}={}){var delta=Math.abs(deltaAxis-wheelSettings.previousValue);
speedAxis=Math.abs(speedAxis);if(delta>wheelSettings.thresholdDistance){if(wheelSettings.axis=="vertical")if(deltaAxis<wheelSettings.previousValue)wheelSettings.direction=!wheelSettings.inverted?-1:1;else wheelSettings.direction=!wheelSettings.inverted?1:-1;else if(deltaAxis<wheelSettings.previousValue)wheelSettings.direction=!wheelSettings.inverted?1:-1;else wheelSettings.direction=!wheelSettings.inverted?-1:1;var v=Math.abs(speedAxis);step=speedRelative?v<.05?1:v<.08?2:3:1;step*=wheelSettings.stepValue*
wheelSettings.direction;wheelSettings.previousValue=deltaAxis;return step}else return 0}var xStep=0,yStep=0;if(wheelSettings.axis=="horizontal")xStep=getStep(e.deltaX,e.velocityX,{stepValue:stepValueOg,speedRelative:speedRelative??(stepValueOg??true)===true});else if(wheelSettings.axis=="vertical")yStep=getStep(e.deltaY,e.velocityY,{stepValue:stepValueOg,speedRelative:speedRelative??(stepValueOg??true)===true});if(xStep!=0||yStep!=0){var t=(new Date).getTime();if(t-wheelSettings.lasttimeSent>wheelSettings.sentTime){if(sensitivity.isValid()){THIN.sendWheel(yStep,
xStep);wheelSettings.lasttimeSent=t}sensitivity.call()}}}}}}},"zoom":function(e){var eType=e&&e.type?e.type.toUpperCase():null;if(eType.indexOf("START")!=-1)_actionsProcessors.pinchStart.call(this,e);else if(eType.indexOf("MOVE")!=-1)_actionsProcessors.pinchMove.call(this,e);else if(eType.indexOf("END")!=-1||eType.indexOf("CANCEL")!=-1)multiGestureEnds();else{if(THIN.rcParams.scaled)return;if(scrollStarted)return;var scale=e.scale||e.gesture.scale;if(scale<1)scale=scale*1.075;else scale=scale*.955;
var dif=Math.abs(1-scale);if(!scrollStarted&&dif>.1||dif>.2){zoomStarted=true;var mouseScreenPosition=getMouseScreenPosition();var absX=mouseScreenPosition.x;var absY=mouseScreenPosition.y;var screenX=absX-THIN.vncdiv.scrollLeft;var screenY=absY-THIN.vncdiv.scrollTop;var pX=screenX*100/THIN.rcParams.maxWidth;var pY=screenY*100/THIN.rcParams.maxHeight;zoom(Math.max(Math.max(zoomBottomLimit,THIN.getMinZoomFactor()),Math.min(lastScale*scale,zoomTopLimit)));var sL=absX-THIN.rcParams.maxWidth*pX/100;var sT=
absY-THIN.rcParams.maxHeight*pY/100;THIN.vncdiv.scrollLeft=sL;THIN.vncdiv.scrollTop=sT}lastEvent=e}},"mouseMove":function(e){lastEvent=e;var relativeTouchFromPointer=getRelativeTouchByPointerType(e);if(relativeTouchFromPointer){if(e&&e.type&&e.type.toUpperCase().indexOf("PAN")!=-1)if(e.type.toUpperCase().indexOf("START")!=-1){startMouseX=getTouchX(relativeTouchFromPointer)-e.deltaX;startMouseY=getTouchY(relativeTouchFromPointer)-e.deltaY}else{if(e.type.toUpperCase().indexOf("MOVE")!=-1)mouseMove(getTouchX(relativeTouchFromPointer),
getTouchY(relativeTouchFromPointer),relativeTouchFromPointer)}else{startMouseX=getTouchX(relativeTouchFromPointer)-e.deltaX;startMouseY=getTouchY(relativeTouchFromPointer)-e.deltaY}_actionsProcessors.screenPan(e)}else{if(e&&e.type&&e.type.toUpperCase().indexOf("PAN")!=-1&&e.type.toUpperCase().indexOf("MOVE")===-1)return;startMouseX=getTouchX(relativeTouchFromPointer);startMouseY=getTouchY(relativeTouchFromPointer);mouseMove(startMouseX,startMouseY,relativeTouchFromPointer);THIN.mouseMoved=true;THIN.sendMouseMove();
THIN.mouseMoved=false}},"click":function(e){if(checkContextMenu(e,true))return;if(!zoomStarted){var x=getTouchXFixed();var y=getTouchYFixed();button="left";touchstate=1;var relativeTouchFromPointer=getRelativeTouchByPointerType(e);try{mouseScrollX=x;mouseScrollY=y;var x=startMouseX;var y=startMouseY;if(productId=="virtualui"){var headerBtnElem=THIN.getElementFromPoint({"touches":[{"pageX":x,"pageY":y}]});if(headerBtnElem&&headerBtnElem.parentElement!=null&&headerBtnElem.parentElement.className=="buttons"){$(headerBtnElem).click();
e.preventDefault();return}}var mPosition=getMouseScreenPosition();if(relativeTouchFromPointer)showMouseMask(mPosition.x+32,mPosition.y+32,"clickEffect",true);else showMouseMask(x/THIN.getZoom(),y/THIN.getZoom(),"clickEffect",true);mouseDown(button,x,y,relativeTouchFromPointer);mouseUp(button,x,y,relativeTouchFromPointer);if(productId!="webfmx"&&productId!="virtualui")lastMouseClickPosition=mPosition}finally{touchstate=0}if(touchstate==3)mouseMoveIntoView()}},"holdLeft":function(e){_actionsProcessors.hold(e,
"left")},"holdRight":function(e){_actionsProcessors.hold(e,"right")},"releaseLeft":function(e){_actionsProcessors.release(e,"left")},"releaseRight":function(e){_actionsProcessors.release(e,"right")},"releaseAll":function(e){actions.releaseLeft(e);actions.releaseRight(e)},"contextMenu":function(e){var mx,my;var relativeTouchFromPointer=getRelativeTouchByPointerType(e);var p=THIN.findPos(THIN.vncContainer);var x=relativeTouchFromPointer?cursorCanvasX():startMouseX;var y=relativeTouchFromPointer?cursorCanvasY():
startMouseY;mx=(x-p[0])/THIN.scale;my=(y-p[1])/THIN.scale;showContextMenu(mx,my)},"doubleClick":function(e){var relativeTouchFromPointer=getRelativeTouchByPointerType(e);var x=relativeTouchFromPointer?cursorCanvasX():startMouseX;var y=relativeTouchFromPointer?cursorCanvasY():startMouseY;btnLeftClick(x,y);btnLeftClick(x,y)},"rightClick":function(e){var relativeTouchFromPointer=getRelativeTouchByPointerType(e);var x=relativeTouchFromPointer?cursorCanvasX():startMouseX;var y=relativeTouchFromPointer?
cursorCanvasY():startMouseY;sendButtonRight(x,y)},"keyboard":keyboardShortCut_click,"menu":openMenuShortCut_click,"closeMenu":function(e){THIN.toolbar.hide()},"focus":function(e){var coords=THIN.caret.rw;var relativeTouchFromPointer=getRelativeTouchByPointerType(e);var tempX=relativeTouchFromPointer?cursorCanvasX():startMouseX;var tempY=relativeTouchFromPointer?cursorCanvasY():startMouseY;if(productId=="virtualui"){tempY/=THIN.getZoom();tempX/=THIN.getZoom()}if(typeof coords!="undefined"&&coords.b-
coords.t<THIN.multiRowMinSize&&coords.t<=tempY&&tempY<=coords.b&&coords.l<=tempX&&tempX<=coords.r){THIN.caretY=coords.t+(coords.b-coords.t)/2;THIN.caretX=coords.l;ShowStdKbd()}else{var url="webfmx/getcaret?sessionid="+THIN.rcParams.id+"&x="+tempX+"&y="+tempY+"&timeout="+keyboardCaretWait;$.ajax({url:url,async:false,cache:false,dataType:"html",error:function(jqXHR,err){logDebug("error:"+JSON.stringify(jqXHR))},success:function(data){if(data){data=JSON.parse(data);if(data.cmd==28){ShowStdKbd();return}if(data.cmd==
24)$("#touchkbd").blur();else{coords=data.rw;if(coords.t<=tempY&&tempY<=coords.b&&coords.l<=tempX&&tempX<=coords.r){THIN.caretY=coords.t+(coords.b-coords.t)/2;THIN.caretX=coords.l;THIN.caret.data=data;ShowStdKbd()}else $("#touchkbd").blur()}}else if(agentInfo.isMobile&&THIN.mobileKeyboard&&THIN.mobileKeyboard.locationType!==THIN.mobileKeyboard.enumLocationType.VIRTUALKEYBOARD)$("#touchkbd").blur()}})}}};var actionsCompatibility=[{name:"focus",products:["virtualui"]}];actionsCompatibility.forEach(function(t){if(ThinVNCTouchManager["actions"][t.name]&&
!t.products.includes(productId))delete ThinVNCTouchManager["actions"][t.name]});ThinVNCTouchManager["gesturesMiddleware"]=function(e){return checkUIAndPointerType(e)};ThinVNCTouchManager["defaultGestures"]=helper.object.clone(defaultTouchGestures);ThinVNCTouchManager["defaultGestures"].filter(function(t){return t.type==="swipe"})[0].middleware=function(e,details){var tapElement=e&&e.target?e.target:null;var menuClass="thin-menu-container";if($(tapElement).hasClass(menuClass)||$(tapElement).parents().hasClass(menuClass))return true;
return false};ThinVNCTouchManager["touchStartRedirection"]=function(e,touches){e.preventDefault();THIN.redirectTouches("begin",touches)};ThinVNCTouchManager["touchMoveRedirection"]=function(e,touches){e.preventDefault();THIN.redirectTouches("update",touches)};ThinVNCTouchManager["touchEndRedirection"]=function(e,touches){e.preventDefault();THIN.redirectTouches("end",touches)}}var localGestures=[...(helper.object.getValue(window,"customSettings.touch.gestures",[],{ignoreCase:true})??[]),...(helper.object.getValue(window.THIN,
"clientSettings.mobile.gestures",null,{ignoreCase:true})??[]),...(helper.object.getValue(window.THIN?.rcParams,"mobile.gestures",null,{ignoreCase:true})??[]),...(helper.object.getValue(window,"customSettings.mobile.gestures",[],{ignoreCase:true})??[])];ThinVNCTouchManager.initialize(document.body,localGestures,{})};function sendRightClick(){_tba.sendRightClick()}initialize();var mobile={};Object.defineProperty(mobile,"initMobile",{"enumerable":true,"configurable":false,"writable":false,"value":initMobile});
Object.defineProperty(mobile,"initTouchDevice",{"enumerable":true,"configurable":false,"writable":false,"value":initTouchDevice});Object.defineProperty(mobile,"adjustMainSize",{"enumerable":true,"configurable":false,"writable":false,"value":adjustMainSize});Object.defineProperty(mobile,"sendRightClick",{"enumerable":true,"configurable":false,"writable":false,"value":sendRightClick});Object.defineProperty(mobile,"zoom",{"enumerable":true,"configurable":false,"writable":false,"value":zoom});Object.defineProperty(mobile,
"screenWidth",{"enumerable":true,"configurable":false,"get":function(){return screenWidth}});Object.defineProperty(mobile,"screenHeight",{"enumerable":true,"configurable":false,"get":function(){return screenHeight}});Object.defineProperty(mobile,"divScrolling",{"enumerable":true,"configurable":false,"get":function(){return divScrolling}});Object.defineProperty(mobile,"ShowStdKbd",{"enumerable":true,"configurable":false,"value":ShowStdKbd});Object.defineProperty(mobile,"showExtKbd",{"enumerable":true,
"configurable":false,"value":function(){_tba.showExtKbd()}});Object.defineProperty(mobile,"isKeyboardVisible",{"enumerable":true,"configurable":false,"value":isKeyboardVisible});window["__mobile__"]=mobile;return mobile}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Object.defineProperty(Mobile,"defaultTouchGestures",{"enumerable":true,"configurable":false,"get":function(){return defaultTouchGestures}});Thinfinity.Mobile=Mobile})();var initMobile;var initTouchDevice;var adjustMainSize;var zoom;
var screenHeight;var screenWidth;var divScrolling;var ShowStdKbd;var showExtKbd;var isKeyboardVisible;var mobileInstance;var ThinVNCTouchManager=null;
(function(){mobileInstance=new Thinfinity.Mobile;initMobile=mobileInstance.initMobile;initTouchDevice=mobileInstance.initTouchDevice;adjustMainSize=mobileInstance.adjustMainSize;zoom=mobileInstance.zoom;screenHeight=mobileInstance.screenHeight;screenWidth=mobileInstance.screenWidth;divScrolling=mobileInstance.divScrolling;ShowStdKbd=mobileInstance.ShowStdKbd;showExtKbd=mobileInstance.ShowStdKbd;isKeyboardVisible=mobileInstance.isKeyboardVisible})();
(function(){var Root=protobuf.Root,Type=protobuf.Type,Field=protobuf.Field;var VirtualChannelData=new Type("VirtualChannelData");VirtualChannelData.add(new Field("sessionId",1,"string"));VirtualChannelData.add(new Field("sourceId",2,"string"));VirtualChannelData.add(new Field("name",3,"string"));VirtualChannelData.add(new Field("mgrHandle",4,"uint64"));VirtualChannelData.add(new Field("packetNumber",5,"uint32"));VirtualChannelData.add(new Field("origin",6,"uint32"));VirtualChannelData.add(new Field("cmd",
7,"uint32"));VirtualChannelData.add(new Field("data",8,"bytes"));var root=(new Root).define("VirtualChannel");root.add(VirtualChannelData);var ChannelCmd={"CMD_INTERNAL":0,"CMD_OPEN":1,"CMD_CLOSE":2,"CMD_LINK":3,"CMD_UNLINK":4,"CMD_NEW":5,"CMD_DATA":6,"CMD_EVENT":7,"CMD_STATUS":8};var ChannelStatus={"INITIALIZED":0,"CONNECTED":1,"V1_CONNECTED":2,"DISCONNECTED":3,"TERMINATED":4,"OPEN":5,"LINKED":6,"UNLINKED":7,"CLOSED":8,"PEER_NEEDED":10};var ChannelError={"SUCCESS":0,"NOT_INITIALIZED":-1,"CHANNEL_EXISTS":-2,
"INVALID_CHANNEL":-3,"READ_HEADER":-4,"TIMEOUT":-5,"CHANNEL_INACTIVE":-6,"INVALID_DATA":-7,"APPLICATION_ERROR":-255};var ChannelOrigin={"CLIENT":0,"SERVER":1};var ChannelRunMode={"NODE":0,"HOOK":1};var closing=false;var globalPacketNumber=1;function supportsHTML5Storage(){try{return"sessionStorage"in window&&window["sessionStorage"]!=null}catch(err){return false}}function opositeOrigin(channelOrigin){if(channelOrigin==ChannelOrigin.CLIENT)return ChannelOrigin.SERVER;else return ChannelOrigin.CLIENT}
function PeerChannel(name,mgrHandle,sessionId,sourceId,origin,persistent){var _ref=this;var _name=name;var _mgrHandle=mgrHandle;var _sessionId=sessionId;var _sourceId=sourceId;var _origin=origin;var _status=0;var _link=null;var _active=true;var _storageKey=null;var _persistent=persistent;function initialize(){_storageKey="CHANNEL_"+_sessionId+"_"+_sourceId+"_"+_name+"_"+_mgrHandle;save()}function getLinked(){return _link!=null||_status==ChannelStatus.LINKED}function getPeerNeeded(){return!getLinked()}
function getStatus(){return _status}function setStatus(value){_status=value;save()}function getActive(){return _active}function setActive(value){_active=value}function getLink(){return _link}function setLink(value){_link=value;save()}function save(){if(_persistent&&supportsHTML5Storage()){var obj={"name":_name,"mgrHandle":_mgrHandle,"sessionId":_sessionId,"sourceId":_sourceId,"origin":_origin,"status":_status,"linked":_link!=null};helper.console.log("Save: "+JSON.stringify(obj),arguments);sessionStorage.setItem(_storageKey,
JSON.stringify(obj))}}function remove(){if(_persistent&&supportsHTML5Storage())sessionStorage.removeItem(_storageKey)}initialize();Object.defineProperty(_ref,"name",{"enumerable":true,"configurable":false,"value":_name});Object.defineProperty(_ref,"mgrHandle",{"enumerable":true,"configurable":false,"value":_mgrHandle});Object.defineProperty(_ref,"sessionId",{"enumerable":true,"configurable":false,"value":_sessionId});Object.defineProperty(_ref,"sourceId",{"enumerable":true,"configurable":false,"value":_sourceId});
Object.defineProperty(_ref,"origin",{"enumerable":true,"configurable":false,"value":_origin});Object.defineProperty(_ref,"status",{"enumerable":true,"configurable":false,"get":getStatus,"set":setStatus});Object.defineProperty(_ref,"active",{"enumerable":true,"configurable":false,"get":getActive,"set":setActive});Object.defineProperty(_ref,"peerNeeded",{"enumerable":true,"configurable":false,"get":getPeerNeeded});Object.defineProperty(_ref,"link",{"enumerable":true,"configurable":false,"get":getLink,
"set":setLink});Object.defineProperty(_ref,"linked",{"enumerable":true,"configurable":false,"get":getLinked});Object.defineProperty(_ref,"save",{"enumerable":true,"configurable":false,"value":save});Object.defineProperty(_ref,"remove",{"enumerable":true,"configurable":false,"value":remove})}function SourceConnection(args){var _ref=this;var _ws=null;var _keepChannels=false;var _storageKey=null;var _checkWsInterval=null;var _reconnectTimeout=null;var _initTime=null;var _closeFired=false;var _maxTimeoutId=
null;var _closeHandler=null;var _disconnected=false;function initialize(){_storageKey="SERVERCHANNELSID_"+args.sessionId;_initTime=(new Date).getTime();args.maxTime=typeof args.maxTime=="undefined"||args.maxTime==null?-1:args.maxTime;if(args.retryConnect){_closeHandler=args.close;args.close=function(){try{_closeHandler()}catch(error){}clearTimeout(_reconnectTimeout);if(args.maxTime>0&&((new Date).getTime()-_initTime)/1E3>args.maxTime)return;else if(!_disconnected&&!closing&&_ws!=null&&_ws.readyState===
_ws.CLOSED)_reconnectTimeout=setTimeout(function(){connectWs()},args.retryTime*1E3||1E3)}}connectWs()}function connectWs(){disconnectWs();_closeFired=false;helper.console.log("Connecting to "+args.address,arguments);try{if(helper.webSocket)helper.webSocket(args.address,"arraybuffer").then(function(ws){_ws=ws;if(_ws===null){helper.console.warning("Cannot initialize new WebSocket connection to "+args.address,arguments);return}if(args.maxTime>0){clearTimeout(_maxTimeoutId);_maxTimeoutId=setTimeout(function(){_ws.close()},
args.maxTime)}_ws.onopen=function(){helper.console.log("wsOpen: connected to "+args.sessionId,arguments);clearTimeout(_maxTimeoutId);save();args.success(args.sessionId);args.maxTime=-1;args.retryTime=1};_ws.onclose=function(){clearTimeout(_maxTimeoutId);helper.console.log("wsClose",arguments);if(!_closeFired){args.close(args.sessionId,arguments);_closeFired=true}};_ws.onmessage=function(msg){args.message(args.sessionId,msg.data)};_ws.onerror=function(e){clearTimeout(_maxTimeoutId);helper.console.log("wsError: "+
JSON.stringify(e),arguments);if(!_closeFired){args.close(args.sessionId,arguments);_closeFired=true}}}).catch(function(error){clearTimeout(_maxTimeoutId);helper.console.warning("Uncaught error, WS --\x3e "+error.message,error);if(!_closeFired){args.close(args.sessionId,arguments);_closeFired=true}if(_ws)_ws.close()});else{if(!_closeFired){args.close(args.sessionId,arguments);_closeFired=true}helper.console.warning("Cannot initialize new WebSocket connection to "+args.address,arguments);return}}catch(error){if(!_closeFired){args.close(args.sessionId,
arguments);_closeFired=true}}}function disconnectWs(){if(_ws!=null)try{_ws.close()}catch(error){}}function disconnect(){_disconnected=true;disableReconnect();disconnectWs()}function save(){if(!args.startupConnection&&supportsHTML5Storage()&&args.origin===ChannelOrigin.SERVER){var obj={"session":args.sessionId,"address":args.address,"origin":args.origin};sessionStorage.setItem(_storageKey,JSON.stringify(obj));enableWsCheck()}}function remove(){if(!args.startupConnection&&supportsHTML5Storage()&&args.origin==
"server"){sessionStorage.removeItem(_storageKey);disableWsCheck()}}function enableWsCheck(){if(_checkWsInterval==null)_checkWsInterval=setInterval(function(){if(!closing&&!getActive())remove()},1E3)}function disableWsCheck(){if(_checkWsInterval!=null)clearInterval(_checkWsInterval);_checkWsInterval=null}function disableReconnect(){clearTimeout(_reconnectTimeout);_reconnectTimeout=null}function getActive(){return _ws!=null&&_ws.readyState===_ws.OPEN}function getSessionId(){return args.sessionId}function getAddress(){return args.address}
function setSessionId(value){args.sessionId=value}function getKeepChannels(){return _keepChannels}function setKeepChannels(value){_keepChannels=value}function send(obj){helper.console.log("Send to "+args.sessionId+":",arguments);helper.console.log(obj,arguments);_ws.send(obj)}initialize();Object.defineProperty(_ref,"sessionId",{"enumerable":true,"configurable":false,"get":getSessionId,"set":setSessionId});Object.defineProperty(_ref,"address",{"enumerable":true,"configurable":false,"get":getAddress});
Object.defineProperty(_ref,"keepChannels",{"enumerable":true,"configurable":false,"get":getKeepChannels,"set":setKeepChannels});Object.defineProperty(_ref,"origin",{"enumerable":true,"configurable":false,"value":args.origin});Object.defineProperty(_ref,"active",{"enumerable":true,"configurable":false,"get":getActive});Object.defineProperty(_ref,"send",{"enumerable":true,"configurable":false,"value":send});Object.defineProperty(_ref,"disconnect",{"enumerable":true,"configurable":false,"value":disconnect})}
function ExternalConnection(sessionId){var _ref=this;var _sessionId=sessionId;var _keepChannels=false;var _storageKey=null;function initialize(){_storageKey="EXTERNALCHANNELSID_"+_sessionId;save()}function save(){if(supportsHTML5Storage()){var obj={"session":_sessionId,"keepChannels":_keepChannels};sessionStorage.setItem(_storageKey,JSON.stringify(obj))}}function remove(){if(supportsHTML5Storage())sessionStorage.removeItem(_storageKey)}function getSessionId(){return _sessionId}function setSessionId(value){_sessionId=
value}function getKeepChannels(){return _keepChannels}function setKeepChannels(value){_keepChannels=value;save()}initialize();Object.defineProperty(_ref,"sessionId",{"enumerable":true,"configurable":false,"get":getSessionId,"set":setSessionId});Object.defineProperty(_ref,"keepChannels",{"enumerable":true,"configurable":false,"get":getKeepChannels,"set":setKeepChannels});Object.defineProperty(_ref,"remove",{"enumerable":true,"configurable":false,"value":remove})}function ConnectionManager(connectCallback,
dataCallback,externalDataCallback,disconnectCallback){var _ref=this;var _startupConnections={};var _sourceConnections={};var _externalConnections={};var _regWS=new RegExp(/(^ws:\/\/)|(^wss:\/\/)/gi);function initialize(){}function removeOldConnection(sessionId,connList){if(typeof connList[sessionId]!="undefined"){connList[sessionId].disconnect();delete connList[sessionId];connList[sessionId]=null}}function isVirtuaNode(node){return typeof window.VirtualChannelNode!="undefined"&&node instanceof VirtualChannelNode}
function addConnection(jData){if(jData.sessionId==null||jData.sessionId=="")jData.sessionId=jData.address.replace(_regWS,"");removeOldConnection(jData.sessionId,_sourceConnections);var jd={};for(var kvp in jData)jd[kvp]=jData[kvp];jd.success=function(e){connectCallback(e);if(jData.success)jData.success(e)};jd.message=dataCallback;jd.close=function(e,evt){disconnectCallback(e);if(jData.close)jData.close(e,evt[0])};_sourceConnections[jData.sessionId]=new SourceConnection(jd);return true}function addNodeConnection(sessionId,
node,list){if(typeof list=="undefined")list=_sourceConnections;list[sessionId]=node}function addNodeStartupConnection(sessionId,node){if(!sessionId||sessionId=="")sessionId=node.sessionId;addNodeConnection(sessionId,node,_startupConnections)}function addExternalConnection(sessionId){if(typeof _externalConnections[sessionId]=="undefined"){_externalConnections[sessionId]=new ExternalConnection(sessionId);return true}else return false}function updateSessionId(oldSessionId,newSessionId){helper.console.log("Session "+
oldSessionId+" => "+newSessionId,arguments);var srcList;var invalidateChannels=false;if(typeof _startupConnections[oldSessionId]!="undefined"){helper.console.log("Remove from startupConnections",arguments);srcList=_startupConnections}else if(typeof _sourceConnections[oldSessionId]!="undefined"){srcList=_sourceConnections;invalidateChannels=true}else return false;srcList[oldSessionId].sessionId=newSessionId;_sourceConnections[newSessionId]=srcList[oldSessionId];srcList[oldSessionId]=null;delete srcList[oldSessionId];
return invalidateChannels}function updateKeepChannels(sessionId,keepChannels){var srcList=null;if(typeof _sourceConnections[sessionId]!="undefined")srcList=_sourceConnections;else if(typeof _externalConnections[sessionId]!="undefined")srcList=_externalConnections;if(srcList!=null)srcList[sessionId].keepChannels=keepChannels}function keepChannels(sessionId){var keep=false;if(typeof _sourceConnections[sessionId]!="undefined")keep=_sourceConnections[sessionId].keepChannels;else if(typeof _externalConnections[sessionId]!=
"undefined")keep=_externalConnections[sessionId].keepChannels;return keep}function connectionActive(sessionId){if(typeof _externalConnections[sessionId]!="undefined")return true;else if(typeof _sourceConnections[sessionId]=="undefined")return false;else return _sourceConnections[sessionId].active}function connectionExists(sessionId){return typeof _externalConnections[sessionId]!="undefined"||typeof _sourceConnections[sessionId]!="undefined"}function send(sessionId,data){if(_sourceConnections[sessionId])_sourceConnections[sessionId].send(data);
else if(externalDataCallback)externalDataCallback(data)}function dumpStatus(format){if(format=="html"){var res="<h3>Connections:</h3>";for(var sessionId in _sourceConnections){res+='<div class="sourceConnection">Session '+sessionId+": ";if(_sourceConnections[sessionId].active)res+='<span class="connected">Connected</span>';else res+="<span>Disconnected</span>";res+="</div>"}for(var sessionId in _externalConnections)res+='<div class="sourceConnection">Session '+sessionId+": <span><i>(external)</i></span></div>";
return res}else return""}function sourceList(){var list={};for(var sessionId in _sourceConnections)list[sessionId]=true;for(var sessionId in _externalConnections)list[sessionId]=true;return list}initialize();Object.defineProperty(_ref,"addConnection",{"enumerable":true,"configurable":false,"value":addConnection});Object.defineProperty(_ref,"addNodeConnection",{"enumerable":true,"configurable":false,"value":addNodeConnection});Object.defineProperty(_ref,"addNodeStartupConnection",{"enumerable":true,
"configurable":false,"value":addNodeStartupConnection});Object.defineProperty(_ref,"addExternalConnection",{"enumerable":true,"configurable":false,"value":addExternalConnection});Object.defineProperty(_ref,"updateSessionId",{"enumerable":true,"configurable":false,"value":updateSessionId});Object.defineProperty(_ref,"updateKeepChannels",{"enumerable":true,"configurable":false,"value":updateKeepChannels});Object.defineProperty(_ref,"keepChannels",{"enumerable":true,"configurable":false,"value":keepChannels});
Object.defineProperty(_ref,"connectionActive",{"enumerable":true,"configurable":false,"value":connectionActive});Object.defineProperty(_ref,"send",{"enumerable":true,"configurable":false,"value":send});Object.defineProperty(_ref,"dumpStatus",{"enumerable":true,"configurable":false,"value":dumpStatus});Object.defineProperty(_ref,"sourceConnections",{"enumerable":true,"configurable":false,"value":_sourceConnections})}function VirtualChannelNode(args){var _ref=this;var _args={"pluginName":null,"channelOrigin":-1,
"sessionId":null,"mgrHandle":null,"runMode":1,"keepChannels":false,"events":{"connect":null,"message":null,"close":null,"error":null,"ready":null}};var _channel={"sessionId":"TMP-VC::","sourceId":null,"name":null,"mgrHandle":0,"origin":null};var _registeredMethods={"open":null,"message":null,"close":null,"error":null,"encode":null,"decode":null};var _active=false;var _priv=_ref.__private__={};var _initialized=false;function initialize(){var errmsg=null;helper.object.parseAttributes(_args,args);if(!_args.pluginName||
_args.pluginName=="")errmsg="Cannot initialize Virtual Channel Node, pluginName is required";if(errmsg)throw new Error(errmsg);_channel.name=_args.pluginName;_channel.origin=_args.channelOrigin;_channel.sessionId+=_args.pluginName;_channel.sourceId=helper.utils.maskToGUID("xxxx-xxxx");_channel.mgrHandle=_args.mgrHandle?_args.mgrHandle:Math.floor(Math.random()*1E5+1)}function registerMethod(name,handler){if(_registeredMethods[name]==null)_registeredMethods[name]=handler}function unregisterMethod(name){if(_registeredMethods[name]!=
null)_registeredMethods[name]=null}function getSourceConnectionWrapper(){var wrapper=new Object;Object.defineProperty(wrapper,"sessionId",{"enumerable":true,"configurable":false,"get":function(){return _channel.sessionId},"set":function(sessionId){return}});Object.defineProperty(wrapper,"keepChannels",{"enumerable":true,"configurable":false,"get":function(){return _args.keepChannels},"set":function(keepChannels){return}});Object.defineProperty(wrapper,"origin",{"enumerable":true,"configurable":false,
"get":function(){return _channel.origin}});Object.defineProperty(wrapper,"active",{"enumerable":true,"configurable":false,"get":function(){return _active}});Object.defineProperty(wrapper,"send",{"enumerable":true,"configurable":false,"value":receiveMessage});Object.defineProperty(wrapper,"disconnect",{"enumerable":true,"configurable":false,"value":close});return wrapper}function receiveMessage(data){var dd=_registeredMethods.decode(data);if(dd.data&&dd.data.length>0&&_args.events.message)_args.events.message(dd.data)}
function processMessage(data){if(data&&data.length>0&&_args.events.message)return _args.events.message(data)}function init(){_initialized=true}function open(){if(!_initialized)init();_registeredMethods.open(_channel.sessionId);var tmpSessionId=_channel.sessionId.replace("TMP-","SID-");write(ChannelCmd.CMD_INTERNAL,(new TextEncoder("utf-8")).encode(JSON.stringify({"sessionId":tmpSessionId,"keepChannels":_args.keepChannels})));_channel.sessionId=tmpSessionId;write(ChannelCmd.CMD_OPEN);_active=true}
function write(cmd,bytes){var dataPackage=helper.object.clone(_channel);if(bytes&&bytes.length>0)dataPackage.data=bytes;_registeredMethods.message(_channel.sessionId,_registeredMethods.encode(dataPackage,cmd))}function close(){_registeredMethods.close(_channel.sessionId);_active=false}initialize();Object.defineProperty(_ref,"init",{"enumerable":true,"configurable":false,"writable":false,"value":init});Object.defineProperty(_ref,"open",{"enumerable":true,"configurable":false,"writable":false,"value":open});
Object.defineProperty(_ref,"write",{"enumerable":true,"configurable":false,"writable":false,"value":function(bytes){return write(ChannelCmd.CMD_DATA,bytes)}});Object.defineProperty(_ref,"close",{"enumerable":true,"configurable":false,"writable":false,"value":close});Object.defineProperty(_priv,"sessionId",{"enumerable":true,"configurable":false,"get":function(){return _channel.sessionId}});Object.defineProperty(_priv,"pluginName",{"enumerable":true,"configurable":false,"get":function(){return _channel.name}});
Object.defineProperty(_priv,"channelOrigin",{"enumerable":true,"configurable":false,"get":function(){return _channel.origin}});Object.defineProperty(_priv,"runMode",{"enumerable":true,"configurable":false,"get":function(){return _args.runMode}});Object.defineProperty(_priv,"active",{"enumerable":true,"configurable":false,"get":function(){return _active}});Object.defineProperty(_priv,"ws_open",{"enumerable":true,"configurable":false,"set":function(handler){registerMethod("open",handler)}});Object.defineProperty(_priv,
"ws_message",{"enumerable":true,"configurable":false,"set":function(handler){registerMethod("message",handler)}});Object.defineProperty(_priv,"ws_close",{"enumerable":true,"configurable":false,"set":function(handler){registerMethod("close",handler)}});Object.defineProperty(_priv,"ready",{"enumerable":true,"configurable":false,"writable":false,"value":function(){if(_args.events.ready)_args.events.ready()}});Object.defineProperty(_priv,"encode",{"enumerable":true,"configurable":false,"set":function(handler){registerMethod("encode",
handler)}});Object.defineProperty(_priv,"decode",{"enumerable":true,"configurable":false,"set":function(handler){registerMethod("decode",handler)}});if(_args.runMode===ChannelRunMode.HOOK)Object.defineProperty(_priv,"processMessage",{"enumerable":true,"configurable":false,"writable":false,"value":processMessage});Object.defineProperty(_priv,"getSourceConnectionWrapper",{"enumerable":true,"configurable":false,"writable":false,"value":getSourceConnectionWrapper});return _ref}function VirtualChannels(){var _ref=
this;var _connectionManager=null;var _serverChannels={};var _clientChannels={};var _inactiveChannels=[];var _checkInactiveChannelsTimeout=null;var _registerNodes={};var _disposed=false;function initialize(){_connectionManager=new ConnectionManager(sourceConnectCallback,receiveFromChannel,null,sourceDisconnectCallback);setTimeout(checkPreviuosConnections,500)}function encodeProtoBuffMsg(channel,cmd){var cd=VirtualChannelData.create({"sessionId":channel.sessionId,"sourceId":channel.sourceId,"name":channel.name,
"mgrHandle":channel.mgrHandle,"packetNumber":globalPacketNumber++,"origin":channel.origin,"cmd":cmd,"data":channel.data});var buffer=VirtualChannelData.encode(cd).finish();return buffer}function decodeProtoBuffMsg(data){var cd=VirtualChannelData.decode(new Uint8Array(data));helper.console.log(cd,arguments);return cd}function receiveFromChannel(sessionId,data){var res=ChannelError.SUCCESS;var cd=decodeProtoBuffMsg(data);if(sessionId==null){sessionId=cd.sessionId;_connectionManager.addExternalConnection(sessionId)}helper.console.log(helper.string.format("onMessage - sessionId: {0}, source:{1}, name:{2}, mgr:{3}, pk:{4}, origin:{5}, cmd:{6} ",
sessionId,cd.sourceId,cd.name,cd.mgrHandle,cd.packetNumber,cd.origin,cd.cmd),arguments);switch(cd.cmd){case ChannelCmd.CMD_INTERNAL:res=processInternalCmd(sessionId,cd.origin,cd.data);break;case ChannelCmd.CMD_OPEN:res=addChannel(sessionId,cd.sourceId,cd.origin,cd.name,cd.mgrHandle);fireReadyFor(cd.name);break;case ChannelCmd.CMD_CLOSE:res=closeLinkedChannels(cd.sourceId,cd.origin,cd.name,cd.mgrHandle);break;case ChannelCmd.CMD_DATA:res=sendToLinkedChannel(cd.sourceId,cd.origin,cd.name,cd.mgrHandle,
cd.cmd,cd.data);break;case ChannelCmd.CMD_EVENT:case ChannelCmd.CMD_STATUS:res=setChannelEvent(cd.sourceId,cd.origin,cd.name,cd.mgrHandle,cd.data);break}return res}function fireReadyFor(name){if(_serverChannels[name]&&_clientChannels[name]&&_registerNodes[name])_registerNodes[name].forEach(function(node){if(node&&node.__private__&&node.__private__.ready&&node.__private__.channelOrigin===ChannelOrigin.CLIENT)try{node.__private__.ready()}catch(error){helper.console.log("Node client ready error: "+error.message,
arguments)}})}function processInternalCmd(sessionId,origin,data){var str=(new TextDecoder("utf-8")).decode(data);var obj=JSON.parse(str);helper.console.log("    --\x3e InternalCmd:"+JSON.stringify(obj),arguments);if(obj.sessionId){var invalidateChannels=false;if(obj.sessionId!=sessionId){invalidateChannels=_connectionManager.updateSessionId(sessionId,obj.sessionId);if(invalidateChannels)markInactiveChannels(origin,sessionId);sessionId=obj.sessionId}if(obj.keepChannels)_connectionManager.updateKeepChannels(sessionId,
obj.keepChannels)}}function assignToVirtualNode(name,origin,action,data){var stopPropagation=false;res=ChannelError.SUCCESS;if(data&&_registerNodes[name]&&_registerNodes[name].length>0)_registerNodes[name].forEach(function(node){var props=node.__private__;if(!stopPropagation&&props.channelOrigin===origin&&props.runMode===ChannelRunMode.HOOK&&props.processMessage)try{stopPropagation=props.processMessage(data)}catch(error){res=ChannelError.INVALID_DATA}});return{"stopPropagation":stopPropagation,"result":res}}
function sendToLinkedChannel(sourceId,origin,name,mgrHandle,cmd,data){var res=ChannelError.INVALID_CHANNEL;var channels=origin==ChannelOrigin.CLIENT?_clientChannels:_serverChannels;if(typeof channels[name]!="undefined"){var peerList=channels[name];for(i=0;i<peerList.length;i++)if(peerList[i].mgrHandle==mgrHandle&&peerList[i].sourceId==sourceId){if(peerList[i].link!=null&&dstChannelActive(peerList[i].link)){var cd=VirtualChannelData.create({"sessionId":peerList[i].link.sessionId,"sourceId":peerList[i].link.sourceId,
"name":name,"mgrHandle":peerList[i].link.mgrHandle,"packetNumber":globalPacketNumber++,"cmd":cmd,"data":data});var rAssign=assignToVirtualNode(name,origin,"message",cd.data);if(rAssign.stopPropagation)res=rAssign.result;else res=callReadCallback(peerList[i].link,VirtualChannelData.encode(cd).finish())}break}}return res}function setChannelEvent(sourceId,origin,name,mgrHandle,data){if(data.length==0)return ChannelError.INVALID_DATA;var res=ChannelError.INVALID_CHANNEL;var channels=origin==ChannelOrigin.CLIENT?
_clientChannels:_serverChannels;if(typeof channels[name]=="undefined")return res;var peerList=channels[name];for(var p=0;p<peerList.length;p++)if(peerList[p].sourceId==sourceId&&peerList[p].mgrHandle==mgrHandle){peerList[p].status=data[0];peerList[p].active=true;helper.console.log("SetChannelEvent "+sourceId+" "+origin+" "+name+" "+mgrHandle.toString(16).toUpperCase()+": "+peerList[p].status,arguments);res=ChannelError.SUCCESS;break}return res}function closeLinkedChannels(sourceId,origin,name,mgrHandle){var res=
ChannelError.INVALID_CHANNEL;var oriChannels=_serverChannels;var dstChannels=_clientChannels;if(origin==ChannelOrigin.CLIENT){oriChannels=_clientChannels;dstChannels=_serverChannels}if(typeof oriChannels[name]=="undefined")return res;var peerList=oriChannels[name];for(i=0;i<peerList.length;i++){var buff;var peer=peerList[i];if(peer.mgrHandle==mgrHandle&&peer.sourceId==sourceId){if(dstChannelActive(peer)){buff=getCloseBuffer(peer);res=callReadCallback(peer,buff)}if(peer.link!=null){var closing=false;
if(dstChannelActive(peer.link)){if(closing)buff=getCloseBuffer(peer.link);else buff=getUnlinkBuffer(peer.link);res=callReadCallback(peer.link,buff)}peer.link.link=null;if(closing&&typeof dstChannels[name]!="undefined"){var dstPeerList=dstChannels[name];for(d=0;d<dstPeerList.length;d++)if(dstPeerList[d].mgrHandle==peer.link.mgrHandle&&dstPeerList[d].sourceId==peer.link.sourceId){dstPeerList[d].remove();dstPeerList.splice(d,1);break}}peer.link=null}peerList.splice(i,1);peer.remove();break}}return res}
function getCloseBuffer(channel){return encodeProtoBuffMsg(channel,ChannelCmd.CMD_CLOSE)}function getUnlinkBuffer(channel){return encodeProtoBuffMsg(channel,ChannelCmd.CMD_UNLINK)}function getStatusBuffer(channel){return encodeProtoBuffMsg(channel,ChannelCmd.CMD_STATUS)}function addChannel(sessionId,sourceId,origin,name,mgrHandle,tryLink){if(typeof tryLink=="undefined")tryLink=true;helper.console.log("AddChannel("+sourceId+","+origin+","+name+","+mgrHandle.toString(16).toUpperCase()+","+tryLink+")",
arguments);var oriChannels=_serverChannels;var dstChannels=_clientChannels;if(origin==ChannelOrigin.CLIENT){oriChannels=_clientChannels;dstChannels=_serverChannels}if(typeof oriChannels[name]=="undefined")oriChannels[name]=[];var peerList=oriChannels[name];var oriChannel=null;for(i=0;i<peerList.length;i++)if(peerList[i].mgrHandle==mgrHandle&&peerList[i].sourceId==sourceId){oriChannel=peerList[i];break}if(oriChannel==null){var persistent=_connectionManager.keepChannels(sessionId);oriChannel=new PeerChannel(name,
mgrHandle,sessionId,sourceId,origin,persistent);peerList.push(oriChannel)}if(oriChannel.link!=null)return oriChannel;if(tryLink&&typeof dstChannels[name]!="undefined")linkChannel(oriChannel,dstChannels);return oriChannel}function linkChannel(channel,dstChannels){helper.console.log(helper.string.format("LinkChannel sourceId:{0}, origin:{1}, name:{2}, mgrHandle:{3}",channel.sourceId,channel.origin,channel.name,channel.mgrHandle.toString(16).toUpperCase()),arguments);if(typeof dstChannels[channel.name]==
"undefined"){helper.console.log("No peers for "+channel.name,arguments);return}var peerList=dstChannels[channel.name];var found=false;for(i=0;i<peerList.length;i++){var dstChannel=peerList[i];if(!dstChannel.linked&&dstChannelActive(dstChannel)){helper.console.log(helper.string.format("Link to - sourceId:{0}, mgrHandle:{1}",dstChannel.sourceId,dstChannel.mgrHandle.toString(16).toUpperCase()),arguments);found=true;dstChannel.link=channel;channel.link=dstChannel;notifyLink(channel.origin,dstChannel,
channel);break}}if(channel.origin==ChannelOrigin.CLIENT&&!found)for(i=0;i<peerList.length;i++)if(dstChannelActive(peerList[i])){requireNewChannel(peerList[i]);break}var peerNeeded=false;if(channel.origin==ChannelOrigin.SERVER&&found)for(i=0;i<peerList.length;i++)if(peerList[i].peerNeeded){helper.console.log("Client channel "+peerList[i].sourceId+" "+peerList[i].mgrHandle.toString(16).toUpperCase()+": peerNeeded",arguments);peerNeeded=true;break}if(peerNeeded)requireNewChannel(channel)}function requireNewChannel(channel){helper.console.log(helper.string.format("Require new to: sessionId:{0}, sourceId:{1}, mgr:{2}, ch_cmd:{3}",
channel.sessionId,channel.sourceId,channel.mgrHandle.toString(16).toUpperCase(),ChannelCmd.CMD_NEW),arguments);var buff=encodeProtoBuffMsg(channel,ChannelCmd.CMD_NEW);callReadCallback(channel,buff)}function notifyLink(origin,srcChannel,dstChannel){helper.console.log(helper.string.format("notifyLink: sessionId:{0}, sourceId:{1}, mgr:{2}, ch_cmd:{3}, origin:{4}",srcChannel.sessionId,srcChannel.sourceId,srcChannel.mgrHandle.toString(16).toUpperCase(),ChannelCmd.CMD_LINK,srcChannel.origin),arguments);
var buff=encodeProtoBuffMsg(srcChannel,ChannelCmd.CMD_LINK);callReadCallback(srcChannel,buff);helper.console.log(helper.string.format("notifyLink: sessionId:{0}, sourceId:{1}, mgr:{2}, ch_cmd:{3}, origin:{4}",dstChannel.sessionId,dstChannel.sourceId,dstChannel.mgrHandle.toString(16).toUpperCase(),ChannelCmd.CMD_LINK,dstChannel.origin),arguments);buff=encodeProtoBuffMsg(dstChannel,ChannelCmd.CMD_LINK);callReadCallback(dstChannel,buff)}function callReadCallback(dstChannel,data){_connectionManager.send(dstChannel.sessionId,
data);return ChannelError.SUCCESS}function dstChannelActive(dstChannel){return _connectionManager.connectionActive(dstChannel.sessionId)}function unlinkPeers(origin,dstChannel){var channels=origin==ChannelOrigin.CLIENT?_clientChannels:_serverChannels;if(typeof channels[dstChannel.name]!="undefined"){var peerList=channels[dstChannel.name];for(i=0;i<peerList.length;i++)if(peerList[i].link!=null&&peerList[i].link.sourceId==dstChannel.sourceId){var buff=getUnlinkBuffer(peerList[i]);callReadCallback(peerList[i],
buff);peerList[i].link.link=null;peerList[i].link=null}}}function checkInactiveChannels(){while(_inactiveChannels.length>0){unlinkPeers(opositeOrigin(_inactiveChannels[0].origin),_inactiveChannels[0].channel);_inactiveChannels.splice(0,1)}}function markInactiveChannels(origin,sessionId){if(_disposed)return;var channels=origin==ChannelOrigin.CLIENT?_clientChannels:_serverChannels;for(var channelName in channels){var peerList=channels[channelName];for(var p=0;p<peerList.length;p++)if(peerList[p].sessionId==
sessionId)_inactiveChannels.push({"channel":peerList[p],"origin":origin})}clearTimeout(_checkInactiveChannelsTimeout);_checkInactiveChannelsTimeout=setTimeout(checkInactiveChannels,100)}function removeInactiveChannels(channels,sessionId){for(var channelName in channels){var peerList=channels[channelName];var p=0;while(p<peerList.length)if(peerList[p].sessionId==sessionId&&!peerList[p].active){helper.console.log("RemoveInactiveChannel "+peerList[p].sessionId+" "+peerList[p].sourceId+" "+peerList[p].origin+
" "+peerList[p].name+" "+peerList[p].mgrHandle.toString(16).toUpperCase(),arguments);peerList[p].remove();peerList.splice(p,1)}else p++}}function verifyLoadedChannels(sessionId){removeInactiveChannels(_serverChannels,sessionId);removeInactiveChannels(_clientChannels,sessionId);for(var channelName in _clientChannels){var peerList=_clientChannels[channelName];for(var p=0;p<peerList.length;p++)if(peerList[p].sessionId==sessionId&&!peerList[p].linked)linkChannel(peerList[p],_serverChannels)}}function loadPreviousChannels(sessionId,
forceGetStatus){if(!supportsHTML5Storage())return;for(var i=0,len=sessionStorage.length;i<len;i++){var key=sessionStorage.key(i);if(key.startsWith("CHANNEL_"+sessionId+"_")){var obj=JSON.parse(sessionStorage.getItem(key));helper.console.log("on open Load: "+JSON.stringify(obj),arguments);var channel=addChannel(obj.sessionId,obj.sourceId,obj.origin,obj.name,obj.mgrHandle,false);var buff=null;if(channel.origin==ChannelOrigin.CLIENT){if(obj.linked){helper.console.log("Unlink client "+channel.sourceId+
" "+channel.mgrHandle.toString(16).toUpperCase(),arguments);buff=getUnlinkBuffer(channel);callReadCallback(channel,buff);unlinkPeers(ChannelOrigin.SERVER,channel)}if(forceGetStatus){helper.console.log("GetStatus client "+channel.sourceId+" "+channel.mgrHandle.toString(16).toUpperCase(),arguments);channel.active=false;buff=getStatusBuffer(channel);callReadCallback(channel,buff)}}else{if(obj.linked){helper.console.log("Unlink server "+channel.sourceId+" "+channel.mgrHandle.toString(16).toUpperCase(),
arguments);buff=getUnlinkBuffer(channel);callReadCallback(channel,buff)}if(!obj.linked||forceGetStatus){helper.console.log("GetStatus server "+channel.sourceId+" "+channel.mgrHandle.toString(16).toUpperCase(),arguments);channel.active=false;buff=getStatusBuffer(channel);callReadCallback(channel,buff)}}}}setTimeout(function(){verifyLoadedChannels(sessionId)},1E3)}function sourceConnectCallback(sessionId){loadPreviousChannels(sessionId,false)}function sourceDataCallback(sessionId,data){receiveFromChannel(sessionId,
data)}function sourceDisconnectCallback(sessionId){markInactiveChannels(ChannelOrigin.SERVER,sessionId);markInactiveChannels(ChannelOrigin.CLIENT,sessionId)}function dumpChannelsList(channels){var res="";for(var channelName in channels){res+='<p class="level1">Peers for <b>'+channelName+"</b>:</p>";var peerList=channels[channelName];var connList=_connectionManager.sourceConnections;for(var sessionId in connList){var sourceAdded=false;for(var p=0;p<peerList.length;p++){if(peerList[p].sessionId!=sessionId)continue;
if(!sourceAdded){res+='<p class="level2">Session '+peerList[p].sessionId+"</p>";sourceAdded=true}res+='<p class="level3">Mgr '+peerList[p].mgrHandle.toString(16).toUpperCase()+" - Source "+peerList[p].sourceId;if(peerList[p].linked)if(peerList[p].link==null)res+=': <span class="disabledText">Linked in another session</span>';else res+=": Linked to "+peerList[p].link.mgrHandle.toString(16).toUpperCase()+" in "+peerList[p].link.sourceId;res+="</p>"}}}return res}function checkPreviuosConnections(){if(!supportsHTML5Storage())return;
for(var i=0,len=sessionStorage.length;i<len;i++){var obj=null;var key=sessionStorage.key(i);if(key.startsWith("SERVERCHANNELSOURCE_")){obj=JSON.parse(sessionStorage.getItem(key));if(!_connectionManager.connectionExists(obj.source))connect(obj.source,obj.address,obj.origin)}else if(key.startsWith("EXTERNALCHANNELSOURCE_")){obj=JSON.parse(sessionStorage.getItem(key));if(_connectionManager.addExternalConnection(obj.source)){_connectionManager.updateKeepChannels(obj.source,obj.keepChannels);loadPreviousChannels(obj.source,
true)}}}}function connect(jData){if(helper.object.getDataTypeOf(jData)!=="json"){var _temp=jData;jData={"sessionId":arguments[0],"address":arguments[1],"origin":arguments[2],"retryConnect":arguments[3],"reconnect":arguments[4],"retryTime":arguments[5],"maxTime":arguments[6],"success":arguments[7],"close":arguments[8]}}if(typeof jData.retryConnect==="undefined"||jData.retryConnect===null)jData.retryConnect=false;if(typeof jData.reconnect==="undefined"||jData.reconnect===null)jData.reconnect=false;
_connectionManager.addConnection(jData)}function disconnect(sessionIdOrAddress){if(_connectionManager.sourceConnections[sessionIdOrAddress])_connectionManager.sourceConnections[sessionIdOrAddress].disconnect();else for(var sessionId in _connectionManager.sourceConnections)if(_connectionManager.sourceConnections[sessionId].address==sessionIdOrAddress){_connectionManager.sourceConnections[sessionId].disconnect();return}}function disconnectAll(){for(var sessionId in _connectionManager.sourceConnections)disconnect(sessionId)}
function receiveExternal(data){receiveFromChannel(null,data)}function registerNode(node){if(node){var name=node.__private__.pluginName||node.__private__.name;if(name&&!_registerNodes[name])_registerNodes[name]=[];_registerNodes[name].push(node);if(node.__private__.runMode===ChannelRunMode.NODE){node.__private__.ws_open=sourceConnectCallback;node.__private__.ws_message=sourceDataCallback;node.__private__.ws_close=sourceDisconnectCallback;node.__private__.encode=encodeProtoBuffMsg;node.__private__.decode=
decodeProtoBuffMsg;Object.defineProperty(node.__private__,"isLinked",{"enumerable":true,"configurable":false,"get":function(){var list=this.channelOrigin===ChannelOrigin.CLIENT?_clientChannels:_serverChannels;if(list[this.pluginName])for(var i=0,t=list[this.pluginName].length;i<t;i++)if(this.sessionId===list[this.pluginName][i].sessionId)return list[this.pluginName][i].linked;return false}});_connectionManager.addNodeStartupConnection("",node.__private__.getSourceConnectionWrapper())}else;return node}}
function unregisterNode(node){if(node&&_registerNodes[name])for(var pluginName in _registerNodes)for(var i=0;i<_registerNodes[pluginName].length;i++)if(node===_registerNodes[pluginName][i]){_registerNodes[pluginName].splice(i,1);if(node.__private__.runMode==ChannelRunMode.NODE){node.__private__.ws_open=null;node.__private__.ws_message=null;node.__private__.ws_close=null;node.__private__.encode=null;node.__private__.decode=null}}}function getRegisteredNodes(channelOrigin){var list=[],kvp=null;if(channelOrigin===
ChannelOrigin.CLIENT)for(kvp in _clientChannels)list.push(kvp);else if(channelOrigin===ChannelOrigin.SERVER)for(kvp in _serverChannels)list.push(kvp);return list}function dispose(){_disposed=true;clearTimeout(_checkInactiveChannelsTimeout);disconnectAll()}function dump(){return"<h3>Server Channels:</h3>"+dumpChannelsList(_serverChannels)+"<h3>Client Channels:</h3>"+dumpChannelsList(_clientChannels)}function dumpConnectionStatus(){return _connectionManager.dumpStatus("html")}initialize();Object.defineProperty(_ref,
"checkPreviuosConnections",{"enumerable":true,"configurable":false,"value":checkPreviuosConnections});Object.defineProperty(_ref,"connect",{"enumerable":true,"configurable":false,"value":connect});Object.defineProperty(_ref,"disconnect",{"enumerable":false,"configurable":false,"writable":false,"value":disconnect});Object.defineProperty(_ref,"disconnectAll",{"enumerable":false,"configurable":false,"writable":false,"value":disconnectAll});Object.defineProperty(_ref,"dispose",{"enumerable":false,"configurable":false,
"writable":false,"value":dispose});Object.defineProperty(_ref,"dump",{"enumerable":true,"configurable":false,"value":dump});Object.defineProperty(_ref,"dumpConnectionStatus",{"enumerable":true,"configurable":false,"value":dumpConnectionStatus});Object.defineProperty(_ref,"receiveExternal",{"enumerable":true,"configurable":false,"value":receiveExternal});Object.defineProperty(_ref,"registerNode",{"enumerable":false,"configurable":false,"writable":false,"value":registerNode});Object.defineProperty(_ref,
"unregisterNode",{"enumerable":false,"configurable":false,"writable":false,"value":unregisterNode});Object.defineProperty(_ref,"getRegisteredNodes",{"enumerable":false,"configurable":false,"writable":false,"value":getRegisteredNodes})}var virtualChannels=null;var _vchannelRegistered=false;var _customEvents=[];var _localServer=undefined;var _localServerUrl="d3M6Ly8xMjcuMC4wLjE6NjU4OA==";function getInstance(callback){helper.console.warning("Please do not use '__getInstance__' is deprecated, instead use '.on('ready',function(){ /*TODO*/ });'",
arguments);if(_vchannelRegistered)callback();else on("READY",callback)}function on(event,handler){if(event&&event!=="")event=event.toUpperCase();if(!handler||!(handler instanceof Function))throw Error("This handler is not valid, please pass a valid handler");if(_vchannelRegistered&&event==="READY")try{handler()}catch(error){helper.console.log("Something went wrong",arguments)}else{if(!_customEvents[event])_customEvents[event]=[];_customEvents[event].push(handler)}}function off(event,handler){if(event&&
event!=="")event=event.toUpperCase();if(!handler||!(handler instanceof Function))throw Error("This handler is not valid, please pass a valid handler");if(_customEvents[event]){var array=_customEvents[event];for(var i=0,t=array.length;i<t;i++)if(array[i]===handler){array.splice(i,1);return true}}}function fireCustomEvent(event,data){if(event&&event!=="")event=event.toUpperCase();if(_customEvents[event]){var array=_customEvents[event];for(var i=0,t=array.length;i<t;i++)try{array[i](data)}catch(error){helper.console.log(error.message,
arguments)}}}function getRegisteredNodes(type){if(virtualChannels)return virtualChannels.getRegisteredNodes(type);else return[]}var lsReadyCallbacks=[];function localServerReady(callback){if(!window.TextDecoder)callback(false);if(_localServer===true)callback(true);else if(_localServer===false)callback(false);else lsReadyCallbacks.push({"callback":callback})}Object.defineProperty(VirtualChannels,"ChannelOrigin",{"enumerable":true,"configurable":false,"get":function(){return ChannelOrigin}});Object.defineProperty(VirtualChannelNode,
"ChannelRunMode",{"enumerable":true,"configurable":false,"get":function(){return ChannelRunMode}});Object.defineProperty(VirtualChannels,"localServer",{"enumerable":true,"configurable":false,"get":function(){return _localServer}});Object.defineProperty(VirtualChannels,"getRegisteredNodes",{"enumerable":true,"configurable":false,"writable":false,"value":getRegisteredNodes});Object.defineProperty(VirtualChannels,"ready",{"enumerable":true,"configurable":false,"writable":false,"value":localServerReady});
Object.defineProperty(VirtualChannels,"__getInstance__",{"enumerable":true,"configurable":false,"writable":false,"value":getInstance});helper.dom.addEvent(window,"beforeunload",function(e){closing=true});try{Thinfinity!=undefined}catch(e){Thinfinity={}}let vc=window.common&&typeof window.common.virtualChannels==="undefined"?window.common.virtualChannels:true;if(vc){Thinfinity.VirtualChannelNode=VirtualChannelNode;Thinfinity.VirtualChannels=VirtualChannels}else helper.console.log(`Thinfinity Virtual Channels is disabled.`);
function runLocalServerCallbacks(result){if(lsReadyCallbacks&&lsReadyCallbacks.length>0)lsReadyCallbacks.forEach(function(item){try{item.callback(result)}catch(e){helper.console.log("Local server callback error",arguments)}})}helper.dom.interactive(function(){if(Thinfinity.VirtualChannels){function registerVChannel(){virtualChannels=new Thinfinity.VirtualChannels;Object.defineProperty(Thinfinity.VirtualChannels,"registerNode",{"enumerable":true,"configurable":false,"writable":false,"value":virtualChannels.registerNode});
Object.defineProperty(Thinfinity.VirtualChannels,"unregisterNode",{"enumerable":true,"configurable":false,"writable":false,"value":virtualChannels.unregisterNode});Object.defineProperty(Thinfinity.VirtualChannels,"on",{"enumerable":true,"configurable":false,"writable":false,"value":on});Object.defineProperty(Thinfinity.VirtualChannels,"off",{"enumerable":true,"configurable":false,"writable":false,"value":off});function initializeLocalServer(){virtualChannels.connect({"address":atob(_localServerUrl),
"origin":Thinfinity.VirtualChannels.ChannelOrigin.SERVER,"retryConnect":false,"reconnect":true,"retryTime":5,"maxTime":500,"success":function(){_localServer=true;runLocalServerCallbacks(_localServer)},"close":function(){_localServer=false;runLocalServerCallbacks(_localServer)}});helper.console.log("local server was successfully initialized.",arguments)}function initializeGatewayServer(){if(typeof Thinfinity.thinVncSdk==="undefined"){setTimeout(initializeGatewayServer,100);return}else{var gatewayAccess=
null;Thinfinity.thinVncSdk.registerOOBCmd("vchannel",function(obj,urlsConfig){var vchannelTimeout=750;var fastResponseTime=2500;var now=Date.now()+vchannelTimeout;var initializeVChannel=function(){var data=obj.msg;if(_vchannelRegistered&&data.cmd==="update.gateway"){var newGatewayAccess=helper.object.getValue(urlsConfig,"gatewayAccess",null);if(gatewayAccess!==newGatewayAccess||true){helper.console.warning("Communication Gateway has been updated, waiting for new channel command.");virtualChannels.dispose();
gatewayAccess=null;_vchannelRegistered=false}}else if(!_vchannelRegistered&&data.cmd!=="update.gateway")setTimeout(function(){gatewayAccess=helper.object.getValue(urlsConfig,"gatewayAccess",null);var url=null;if(gatewayAccess)url=gatewayAccess.replace("http","ws");else url=(Thinfinity.thinVncSdk.getProtocol()==="https:"?"wss":"ws")+"://"+window.location.hostname+":"+window.location.port;url+=Thinfinity.global.variables.basePath==="/"?Thinfinity.global.variables.basePath:window.location.pathname.split(Thinfinity.global.variables.basePath)[0]+
Thinfinity.global.variables.basePath;url+="__channel__/"+data.id+"/";virtualChannels.connect({"address":url,"origin":Thinfinity.VirtualChannels.ChannelOrigin.CLIENT,"retryConnect":false,"reconnect":true,"close":function(e,evt){if(evt&&evt.type==="error"&&Date.now()-now<fastResponseTime){_vchannelRegistered=false;initializeVChannel()}}});_vchannelRegistered=true;fireCustomEvent("READY",null);delete _customEvents["READY"];helper.console.log("vchannel command was successfully registered.",arguments)},
vchannelTimeout)};initializeVChannel()})}}initializeLocalServer();initializeGatewayServer();window.addEventListener("onServerDisconnect",function(){virtualChannels.dispose()});helper.console.log("vchannel was successfully initialized.",arguments)}if(window.TextDecoder)registerVChannel()}})})();
(function(){var k=void 0,aa=this;function r(c,d){var a=c.split("."),b=aa;!(a[0]in b)&&b.execScript&&b.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)!a.length&&d!==k?b[e]=d:b=b[e]?b[e]:b[e]={}}var t="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==typeof DataView;function u(c){var d=c.length,a=0,b=Number.POSITIVE_INFINITY,e,f,g,h,l,n,m,p,s,x;for(p=0;p<d;++p)c[p]>a&&(a=c[p]),c[p]<b&&(b=c[p]);e=1<<a;f=new (t?Uint32Array:Array)(e);
g=1;h=0;for(l=2;g<=a;){for(p=0;p<d;++p)if(c[p]===g){n=0;m=h;for(s=0;s<g;++s)n=n<<1|m&1,m>>=1;x=g<<16|p;for(s=n;s<e;s+=l)f[s]=x;++h}++g;h<<=1;l<<=1}return[f,a,b]}function w(c,d){this.g=[];this.h=32768;this.c=this.f=this.d=this.k=0;this.input=t?new Uint8Array(c):c;this.l=!1;this.i=y;this.p=!1;if(d||!(d={}))d.index&&(this.d=d.index),d.bufferSize&&(this.h=d.bufferSize),d.bufferType&&(this.i=d.bufferType),d.resize&&(this.p=d.resize);switch(this.i){case A:this.a=32768;this.b=new (t?Uint8Array:Array)(32768+
this.h+258);break;case y:this.a=0;this.b=new (t?Uint8Array:Array)(this.h);this.e=this.u;this.m=this.r;this.j=this.s;break;default:throw Error("invalid inflate mode");}}var A=0,y=1;w.prototype.t=function(){for(;!this.l;){var c=B(this,3);c&1&&(this.l=!0);c>>>=1;switch(c){case 0:var d=this.input,a=this.d,b=this.b,e=this.a,f=d.length,g=k,h=k,l=b.length,n=k;this.c=this.f=0;if(a+1>=f)throw Error("invalid uncompressed block header: LEN");g=d[a++]|d[a++]<<8;if(a+1>=f)throw Error("invalid uncompressed block header: NLEN");
h=d[a++]|d[a++]<<8;if(g===~h)throw Error("invalid uncompressed block header: length verify");if(a+g>d.length)throw Error("input buffer is broken");switch(this.i){case A:for(;e+g>b.length;){n=l-e;g-=n;if(t)b.set(d.subarray(a,a+n),e),e+=n,a+=n;else for(;n--;)b[e++]=d[a++];this.a=e;b=this.e();e=this.a}break;case y:for(;e+g>b.length;)b=this.e({o:2});break;default:throw Error("invalid inflate mode");}if(t)b.set(d.subarray(a,a+g),e),e+=g,a+=g;else for(;g--;)b[e++]=d[a++];this.d=a;this.a=e;this.b=b;break;
case 1:this.j(ba,ca);break;case 2:for(var m=B(this,5)+257,p=B(this,5)+1,s=B(this,4)+4,x=new (t?Uint8Array:Array)(C.length),Q=k,R=k,S=k,v=k,M=k,F=k,z=k,q=k,T=k,q=0;q<s;++q)x[C[q]]=B(this,3);if(!t){q=s;for(s=x.length;q<s;++q)x[C[q]]=0}Q=u(x);v=new (t?Uint8Array:Array)(m+p);q=0;for(T=m+p;q<T;)switch(M=D(this,Q),M){case 16:for(z=3+B(this,2);z--;)v[q++]=F;break;case 17:for(z=3+B(this,3);z--;)v[q++]=0;F=0;break;case 18:for(z=11+B(this,7);z--;)v[q++]=0;F=0;break;default:F=v[q++]=M}R=t?u(v.subarray(0,m)):
u(v.slice(0,m));S=t?u(v.subarray(m)):u(v.slice(m));this.j(R,S);break;default:throw Error("unknown BTYPE: "+c);}}return this.m()};var E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=t?new Uint16Array(E):E,G=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],H=t?new Uint16Array(G):G,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],J=t?new Uint8Array(I):I,K=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,
4097,6145,8193,12289,16385,24577],L=t?new Uint16Array(K):K,N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=t?new Uint8Array(N):N,P=new (t?Uint8Array:Array)(288),U,da;U=0;for(da=P.length;U<da;++U)P[U]=143>=U?8:255>=U?9:279>=U?7:8;var ba=u(P),V=new (t?Uint8Array:Array)(30),W,ea;W=0;for(ea=V.length;W<ea;++W)V[W]=5;var ca=u(V);function B(c,d){for(var a=c.f,b=c.c,e=c.input,f=c.d,g=e.length,h;b<d;){if(f>=g)throw Error("input buffer is broken");a|=e[f++]<<b;b+=8}h=a&(1<<d)-1;c.f=
a>>>d;c.c=b-d;c.d=f;return h}function D(c,d){for(var a=c.f,b=c.c,e=c.input,f=c.d,g=e.length,h=d[0],l=d[1],n,m;b<l&&!(f>=g);)a|=e[f++]<<b,b+=8;n=h[a&(1<<l)-1];m=n>>>16;if(m>b)throw Error("invalid code length: "+m);c.f=a>>m;c.c=b-m;c.d=f;return n&65535}w.prototype.j=function(c,d){var a=this.b,b=this.a;this.n=c;for(var e=a.length-258,f,g,h,l;256!==(f=D(this,c));)if(256>f)b>=e&&(this.a=b,a=this.e(),b=this.a),a[b++]=f;else{g=f-257;l=H[g];0<J[g]&&(l+=B(this,J[g]));f=D(this,d);h=L[f];0<O[f]&&(h+=B(this,
O[f]));b>=e&&(this.a=b,a=this.e(),b=this.a);for(;l--;)a[b]=a[b++-h]}for(;8<=this.c;)this.c-=8,this.d--;this.a=b};w.prototype.s=function(c,d){var a=this.b,b=this.a;this.n=c;for(var e=a.length,f,g,h,l;256!==(f=D(this,c));)if(256>f)b>=e&&(a=this.e(),e=a.length),a[b++]=f;else{g=f-257;l=H[g];0<J[g]&&(l+=B(this,J[g]));f=D(this,d);h=L[f];0<O[f]&&(h+=B(this,O[f]));b+l>e&&(a=this.e(),e=a.length);for(;l--;)a[b]=a[b++-h]}for(;8<=this.c;)this.c-=8,this.d--;this.a=b};w.prototype.e=function(){var c=new (t?Uint8Array:
Array)(this.a-32768),d=this.a-32768,a,b,e=this.b;if(t)c.set(e.subarray(32768,c.length));else{a=0;for(b=c.length;a<b;++a)c[a]=e[a+32768]}this.g.push(c);this.k+=c.length;if(t)e.set(e.subarray(d,d+32768));else for(a=0;32768>a;++a)e[a]=e[d+a];this.a=32768;return e};w.prototype.u=function(c){var d,a=this.input.length/this.d+1|0,b,e,f,g=this.input,h=this.b;c&&("number"===typeof c.o&&(a=c.o),"number"===typeof c.q&&(a+=c.q));2>a?(b=(g.length-this.d)/this.n[2],f=258*(b/2)|0,e=f<h.length?h.length+f:h.length<<
1):e=h.length*a;t?(d=new Uint8Array(e),d.set(h)):d=h;return this.b=d};w.prototype.m=function(){var c=0,d=this.b,a=this.g,b,e=new (t?Uint8Array:Array)(this.k+(this.a-32768)),f,g,h,l;if(0===a.length)return t?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);f=0;for(g=a.length;f<g;++f){b=a[f];h=0;for(l=b.length;h<l;++h)e[c++]=b[h]}f=32768;for(g=this.a;f<g;++f)e[c++]=d[f];this.g=[];return this.buffer=e};w.prototype.r=function(){var c,d=this.a;t?this.p?(c=new Uint8Array(d),c.set(this.b.subarray(0,
d))):c=this.b.subarray(0,d):(this.b.length>d&&(this.b.length=d),c=this.b);return this.buffer=c};r("Zlib.RawInflate",w);r("Zlib.RawInflate.prototype.decompress",w.prototype.t);var X={ADAPTIVE:y,BLOCK:A},Y,Z,$,fa;if(Object.keys)Y=Object.keys(X);else for(Z in Y=[],$=0,X)Y[$++]=Z;$=0;for(fa=Y.length;$<fa;++$)Z=Y[$],r("Zlib.RawInflate.BufferType."+Z,X[Z])}).call(this);
(function(){var n=void 0,u=!0,aa=this;function ba(e,d){var c=e.split("."),f=aa;!(c[0]in f)&&f.execScript&&f.execScript("var "+c[0]);for(var a;c.length&&(a=c.shift());)!c.length&&d!==n?f[a]=d:f=f[a]?f[a]:f[a]={}}var C="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==typeof DataView;function K(e,d){this.index="number"===typeof d?d:0;this.d=0;this.buffer=e instanceof(C?Uint8Array:Array)?e:new (C?Uint8Array:Array)(32768);if(2*this.buffer.length<=
this.index)throw Error("invalid index");this.buffer.length<=this.index&&ca(this)}function ca(e){var d=e.buffer,c,f=d.length,a=new (C?Uint8Array:Array)(f<<1);if(C)a.set(d);else for(c=0;c<f;++c)a[c]=d[c];return e.buffer=a}K.prototype.a=function(e,d,c){var f=this.buffer,a=this.index,b=this.d,k=f[a],m;c&&1<d&&(e=8<d?(L[e&255]<<24|L[e>>>8&255]<<16|L[e>>>16&255]<<8|L[e>>>24&255])>>32-d:L[e]>>8-d);if(8>d+b)k=k<<d|e,b+=d;else for(m=0;m<d;++m)k=k<<1|e>>d-m-1&1,8===++b&&(b=0,f[a++]=L[k],k=0,a===f.length&&(f=
ca(this)));f[a]=k;this.buffer=f;this.d=b;this.index=a};K.prototype.finish=function(){var e=this.buffer,d=this.index,c;0<this.d&&(e[d]<<=8-this.d,e[d]=L[e[d]],d++);C?c=e.subarray(0,d):(e.length=d,c=e);return c};var ga=new (C?Uint8Array:Array)(256),M;for(M=0;256>M;++M){for(var R=M,S=R,ha=7,R=R>>>1;R;R>>>=1)S<<=1,S|=R&1,--ha;ga[M]=(S<<ha&255)>>>0}var L=ga;function ja(e){this.buffer=new (C?Uint16Array:Array)(2*e);this.length=0}ja.prototype.getParent=function(e){return 2*((e-2)/4|0)};ja.prototype.push=
function(e,d){var c,f,a=this.buffer,b;c=this.length;a[this.length++]=d;for(a[this.length++]=e;0<c;)if(f=this.getParent(c),a[c]>a[f])b=a[c],a[c]=a[f],a[f]=b,b=a[c+1],a[c+1]=a[f+1],a[f+1]=b,c=f;else break;return this.length};ja.prototype.pop=function(){var e,d,c=this.buffer,f,a,b;d=c[0];e=c[1];this.length-=2;c[0]=c[this.length];c[1]=c[this.length+1];for(b=0;;){a=2*b+2;if(a>=this.length)break;a+2<this.length&&c[a+2]>c[a]&&(a+=2);if(c[a]>c[b])f=c[b],c[b]=c[a],c[a]=f,f=c[b+1],c[b+1]=c[a+1],c[a+1]=f;else break;
b=a}return{index:e,value:d,length:this.length}};function ka(e,d){this.e=ma;this.f=0;this.input=C&&e instanceof Array?new Uint8Array(e):e;this.c=0;d&&(d.lazy&&(this.f=d.lazy),"number"===typeof d.compressionType&&(this.e=d.compressionType),d.outputBuffer&&(this.b=C&&d.outputBuffer instanceof Array?new Uint8Array(d.outputBuffer):d.outputBuffer),"number"===typeof d.outputIndex&&(this.c=d.outputIndex));this.b||(this.b=new (C?Uint8Array:Array)(32768))}var ma=2,T=[],U;for(U=0;288>U;U++)switch(u){case 143>=
U:T.push([U+48,8]);break;case 255>=U:T.push([U-144+400,9]);break;case 279>=U:T.push([U-256+0,7]);break;case 287>=U:T.push([U-280+192,8]);break;default:throw"invalid literal: "+U;}ka.prototype.h=function(){var e,d,c,f,a=this.input;switch(this.e){case 0:c=0;for(f=a.length;c<f;){d=C?a.subarray(c,c+65535):a.slice(c,c+65535);c+=d.length;var b=d,k=c===f,m=n,g=n,p=n,v=n,x=n,l=this.b,h=this.c;if(C){for(l=new Uint8Array(this.b.buffer);l.length<=h+b.length+5;)l=new Uint8Array(l.length<<1);l.set(this.b)}m=k?
1:0;l[h++]=m|0;g=b.length;p=~g+65536&65535;l[h++]=g&255;l[h++]=g>>>8&255;l[h++]=p&255;l[h++]=p>>>8&255;if(C)l.set(b,h),h+=b.length,l=l.subarray(0,h);else{v=0;for(x=b.length;v<x;++v)l[h++]=b[v];l.length=h}this.c=h;this.b=l}break;case 1:var q=new K(C?new Uint8Array(this.b.buffer):this.b,this.c);q.a(1,1,u);q.a(1,2,u);var t=na(this,a),w,da,z;w=0;for(da=t.length;w<da;w++)if(z=t[w],K.prototype.a.apply(q,T[z]),256<z)q.a(t[++w],t[++w],u),q.a(t[++w],5),q.a(t[++w],t[++w],u);else if(256===z)break;this.b=q.finish();
this.c=this.b.length;break;case ma:var B=new K(C?new Uint8Array(this.b.buffer):this.b,this.c),ra,J,N,O,P,Ia=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W,sa,X,ta,ea,ia=Array(19),ua,Q,fa,y,va;ra=ma;B.a(1,1,u);B.a(ra,2,u);J=na(this,a);W=oa(this.j,15);sa=pa(W);X=oa(this.i,7);ta=pa(X);for(N=286;257<N&&0===W[N-1];N--);for(O=30;1<O&&0===X[O-1];O--);var wa=N,xa=O,F=new (C?Uint32Array:Array)(wa+xa),r,G,s,Y,E=new (C?Uint32Array:Array)(316),D,A,H=new (C?Uint8Array:Array)(19);for(r=G=0;r<wa;r++)F[G++]=
W[r];for(r=0;r<xa;r++)F[G++]=X[r];if(!C){r=0;for(Y=H.length;r<Y;++r)H[r]=0}r=D=0;for(Y=F.length;r<Y;r+=G){for(G=1;r+G<Y&&F[r+G]===F[r];++G);s=G;if(0===F[r])if(3>s)for(;0<s--;)E[D++]=0,H[0]++;else for(;0<s;)A=138>s?s:138,A>s-3&&A<s&&(A=s-3),10>=A?(E[D++]=17,E[D++]=A-3,H[17]++):(E[D++]=18,E[D++]=A-11,H[18]++),s-=A;else if(E[D++]=F[r],H[F[r]]++,s--,3>s)for(;0<s--;)E[D++]=F[r],H[F[r]]++;else for(;0<s;)A=6>s?s:6,A>s-3&&A<s&&(A=s-3),E[D++]=16,E[D++]=A-3,H[16]++,s-=A}e=C?E.subarray(0,D):E.slice(0,D);ea=
oa(H,7);for(y=0;19>y;y++)ia[y]=ea[Ia[y]];for(P=19;4<P&&0===ia[P-1];P--);ua=pa(ea);B.a(N-257,5,u);B.a(O-1,5,u);B.a(P-4,4,u);for(y=0;y<P;y++)B.a(ia[y],3,u);y=0;for(va=e.length;y<va;y++)if(Q=e[y],B.a(ua[Q],ea[Q],u),16<=Q){y++;switch(Q){case 16:fa=2;break;case 17:fa=3;break;case 18:fa=7;break;default:throw"invalid code: "+Q;}B.a(e[y],fa,u)}var ya=[sa,W],za=[ta,X],I,Aa,Z,la,Ba,Ca,Da,Ea;Ba=ya[0];Ca=ya[1];Da=za[0];Ea=za[1];I=0;for(Aa=J.length;I<Aa;++I)if(Z=J[I],B.a(Ba[Z],Ca[Z],u),256<Z)B.a(J[++I],J[++I],
u),la=J[++I],B.a(Da[la],Ea[la],u),B.a(J[++I],J[++I],u);else if(256===Z)break;this.b=B.finish();this.c=this.b.length;break;default:throw"invalid compression type";}return this.b};function qa(e,d){this.length=e;this.g=d}var Fa=function(){function e(a){switch(u){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=
a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,a-31,2];case 42>=a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,
5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:throw"invalid length: "+a;}}var d=[],c,f;for(c=3;258>=c;c++)f=e(c),d[c]=f[2]<<24|f[1]<<16|f[0];return d}(),Ga=C?new Uint32Array(Fa):Fa;function na(e,d){function c(a,c){var b=a.g,d=[],f=0,e;e=Ga[a.length];d[f++]=e&65535;d[f++]=e>>16&255;d[f++]=e>>24;var g;switch(u){case 1===b:g=[0,b-1,0];break;case 2===b:g=[1,b-2,0];break;case 3===b:g=[2,b-3,0];break;case 4===
b:g=[3,b-4,0];break;case 6>=b:g=[4,b-5,1];break;case 8>=b:g=[5,b-7,1];break;case 12>=b:g=[6,b-9,2];break;case 16>=b:g=[7,b-13,2];break;case 24>=b:g=[8,b-17,3];break;case 32>=b:g=[9,b-25,3];break;case 48>=b:g=[10,b-33,4];break;case 64>=b:g=[11,b-49,4];break;case 96>=b:g=[12,b-65,5];break;case 128>=b:g=[13,b-97,5];break;case 192>=b:g=[14,b-129,6];break;case 256>=b:g=[15,b-193,6];break;case 384>=b:g=[16,b-257,7];break;case 512>=b:g=[17,b-385,7];break;case 768>=b:g=[18,b-513,8];break;case 1024>=b:g=[19,
b-769,8];break;case 1536>=b:g=[20,b-1025,9];break;case 2048>=b:g=[21,b-1537,9];break;case 3072>=b:g=[22,b-2049,10];break;case 4096>=b:g=[23,b-3073,10];break;case 6144>=b:g=[24,b-4097,11];break;case 8192>=b:g=[25,b-6145,11];break;case 12288>=b:g=[26,b-8193,12];break;case 16384>=b:g=[27,b-12289,12];break;case 24576>=b:g=[28,b-16385,13];break;case 32768>=b:g=[29,b-24577,13];break;default:throw"invalid distance";}e=g;d[f++]=e[0];d[f++]=e[1];d[f++]=e[2];var k,m;k=0;for(m=d.length;k<m;++k)l[h++]=d[k];t[d[0]]++;
w[d[3]]++;q=a.length+c-1;x=null}var f,a,b,k,m,g={},p,v,x,l=C?new Uint16Array(2*d.length):[],h=0,q=0,t=new (C?Uint32Array:Array)(286),w=new (C?Uint32Array:Array)(30),da=e.f,z;if(!C){for(b=0;285>=b;)t[b++]=0;for(b=0;29>=b;)w[b++]=0}t[256]=1;f=0;for(a=d.length;f<a;++f){b=m=0;for(k=3;b<k&&f+b!==a;++b)m=m<<8|d[f+b];g[m]===n&&(g[m]=[]);p=g[m];if(!(0<q--)){for(;0<p.length&&32768<f-p[0];)p.shift();if(f+3>=a){x&&c(x,-1);b=0;for(k=a-f;b<k;++b)z=d[f+b],l[h++]=z,++t[z];break}0<p.length?(v=Ha(d,f,p),x?x.length<
v.length?(z=d[f-1],l[h++]=z,++t[z],c(v,0)):c(x,-1):v.length<da?x=v:c(v,0)):x?c(x,-1):(z=d[f],l[h++]=z,++t[z])}p.push(f)}l[h++]=256;t[256]++;e.j=t;e.i=w;return C?l.subarray(0,h):l}function Ha(e,d,c){var f,a,b=0,k,m,g,p,v=e.length;m=0;p=c.length;a:for(;m<p;m++){f=c[p-m-1];k=3;if(3<b){for(g=b;3<g;g--)if(e[f+g-1]!==e[d+g-1])continue a;k=b}for(;258>k&&d+k<v&&e[f+k]===e[d+k];)++k;k>b&&(a=f,b=k);if(258===k)break}return new qa(b,d-a)}function oa(e,d){var c=e.length,f=new ja(572),a=new (C?Uint8Array:Array)(c),
b,k,m,g,p;if(!C)for(g=0;g<c;g++)a[g]=0;for(g=0;g<c;++g)0<e[g]&&f.push(g,e[g]);b=Array(f.length/2);k=new (C?Uint32Array:Array)(f.length/2);if(1===b.length)return a[f.pop().index]=1,a;g=0;for(p=f.length/2;g<p;++g)b[g]=f.pop(),k[g]=b[g].value;m=Ja(k,k.length,d);g=0;for(p=b.length;g<p;++g)a[b[g].index]=m[g];return a}function Ja(e,d,c){function f(a){var b=g[a][p[a]];b===d?(f(a+1),f(a+1)):--k[b];++p[a]}var a=new (C?Uint16Array:Array)(c),b=new (C?Uint8Array:Array)(c),k=new (C?Uint8Array:Array)(d),m=Array(c),
g=Array(c),p=Array(c),v=(1<<c)-d,x=1<<c-1,l,h,q,t,w;a[c-1]=d;for(h=0;h<c;++h)v<x?b[h]=0:(b[h]=1,v-=x),v<<=1,a[c-2-h]=(a[c-1-h]/2|0)+d;a[0]=b[0];m[0]=Array(a[0]);g[0]=Array(a[0]);for(h=1;h<c;++h)a[h]>2*a[h-1]+b[h]&&(a[h]=2*a[h-1]+b[h]),m[h]=Array(a[h]),g[h]=Array(a[h]);for(l=0;l<d;++l)k[l]=c;for(q=0;q<a[c-1];++q)m[c-1][q]=e[q],g[c-1][q]=q;for(l=0;l<c;++l)p[l]=0;1===b[c-1]&&(--k[0],++p[c-1]);for(h=c-2;0<=h;--h){t=l=0;w=p[h+1];for(q=0;q<a[h];q++)t=m[h+1][w]+m[h+1][w+1],t>e[l]?(m[h][q]=t,g[h][q]=d,w+=
2):(m[h][q]=e[l],g[h][q]=l,++l);p[h]=0;1===b[h]&&f(h)}return k}function pa(e){var d=new (C?Uint16Array:Array)(e.length),c=[],f=[],a=0,b,k,m,g;b=0;for(k=e.length;b<k;b++)c[e[b]]=(c[e[b]]|0)+1;b=1;for(k=16;b<=k;b++)f[b]=a,a+=c[b]|0,a<<=1;b=0;for(k=e.length;b<k;b++){a=f[e[b]];f[e[b]]+=1;m=d[b]=0;for(g=e[b];m<g;m++)d[b]=d[b]<<1|a&1,a>>>=1}return d}ba("Zlib.RawDeflate",ka);ba("Zlib.RawDeflate.prototype.compress",ka.prototype.h);var Ka={NONE:0,FIXED:1,DYNAMIC:ma},V,La,$,Ma;if(Object.keys)V=Object.keys(Ka);
else for(La in V=[],$=0,Ka)V[$++]=La;$=0;for(Ma=V.length;$<Ma;++$)La=V[$],ba("Zlib.RawDeflate.CompressionType."+La,Ka[La])}).call(this);
