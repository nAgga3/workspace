/* Thinfinity(c) Remote Desktop Server v7.0.3.114 */
const _GWSID="<%=@GWSID%>";
const showDocumentMessage=(title,msg)=>{document.body.innerHTML="";document.body.style="background-color:#b5b5b5;";let d=document.createElement("div");d.style="min-width:300px;min-height:100px;position:absolute;background-color:#f7f8ff;left:50%;top:50%;transform:translate(-50%,-50%);max-width:600px;border-radius:2px;";let header=document.createElement("div");header.style="width:calc(100% - 10px);height:30px;font-size:14pt;color:#fff;text-align:left;line-height:30px;padding-left:10px;background-color:#3297d6;border-top-left-radius:2px;border-top-right-radius:2px;";header.innerHTML=
title;d.appendChild(header);let bodyElem=document.createElement("div");bodyElem.style="width:calc(100% - 40px);height:auto;font-size:13pt;color:#909090;padding:20px;";bodyElem.innerHTML=msg;d.appendChild(bodyElem);document.body.append(d)};
window.onload=function(){const tryServerURL=(virtualPath,success,fail)=>{doGetServerURL(virtualPath).then(res=>{try{if(res&&res.redirect&&res.poolid)success.call(this,res);else tryServerURL(virtualPath,success,fail)}catch(err){tryServerURL(virtualPath,success,fail)}}).catch(err=>{fail.call(this)})};const resolveServerUrl=virtualPath=>{return new Promise((resolve,reject)=>{tryServerURL(virtualPath,res=>{if(res.gateway)res.gateway=res.gateway.endsWith("/")?res.gateway.substr(0,res.gateway.length-1):
res.gateway;res={...res,redirectUrl:`${res.gateway?res.gateway:""}/${res.poolid}/${virtualPath}/`,gateway:res.gateway??null};resolve(res)},reject)})};const doGetServerURL=vp=>{const url=`${typeof vp==="string"&&vp.length>0?`/${vp}/`:"/"}getServerUrl`;return fetch(url,{"referrerPolicy":"same-origin","body":null,"method":"GET","mode":"cors","credentials":"include"}).then(res=>res.json())};const vpath=location.pathname.replaceAll("/","");resolveServerUrl(vpath).then(res=>{gsuRules={accessKey:res.poolid,
gateway:res.gateway};if(res.gateway){let gatewayUrl=new URL(res.gateway);gatewayUrl.pathname+=(!gatewayUrl.pathname.endsWith("/")?"/":"")+`${vpath}/`;gatewayUrl.search=`?__ogateway__=${location.href.replace(/http:|https:/igm,"")}&_gwsid=${_GWSID}&__akey__=${res.poolid}`;window.location.href=gatewayUrl.href;return}else window.location.reload()}).catch(err=>console.log("error: ",err))};
