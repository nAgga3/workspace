var H=Object.defineProperty,R=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var C=(t,e,a)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,d=(t,e)=>{for(var a in e||(e={}))j.call(e,a)&&C(t,a,e[a]);if(S)for(var a of S(e))z.call(e,a)&&C(t,a,e[a]);return t},c=(t,e)=>R(t,P(e));import{ak as q,al as E,_ as G,u as J,x as A,s as K,q as b,ag as M,r as h,o as y,c as w,a as l,f as m,w as f,n as Q,p as X,m as Z,t as x,A as O,B as k,F as Y,d as ee,e as N,b as te,h as V}from"../main.js";import{D as p,d as g}from"./DateTimeHelper.43d380e0.js";const ae=E,se="",le=q.create({baseURL:`${ae}${se}`}),oe=async({startTime:t=null,endTime:e=null}={})=>{let{data:a}=await le.get("usage",{params:d(d({},t&&{startTime:t}),e&&{endTime:e})});return a==null?void 0:a.data},re={getUsage:oe};const ne="analytics",ie={name:"Analytics",data(){const t=p.local();return{items:[],filters:null,range:{start:t.minus({week:1}).toFormat(g.YYMMDD),end:t.toFormat(g.YYMMDD)}}},components:{},setup(){const t=J();let e=A();return{pageBase:ne,layout:t,configurationStore:e}},computed:c(d({},K(A,{instances:"instances"})),{list(){let t=this.items.map(e=>{var a,i,r;return c(d({},e),{instanceName:(a=e.clientTab)==null?void 0:a.instanceName,username:(i=e.clientTab)==null?void 0:i.username,instance:(r=this.instances.find(s=>{var u;return s.id==((u=e.clientTab)==null?void 0:u.instanceId)}))!=null?r:{name:"-",iPAddress:"-"},startF:e.startO.toFormat(g.YYMMDDHHMMSS),stopF:e.inUse?{tag:!0,tagValue:this.$t(`${this.pageBase}.inUse`),field:!1}:e.stopO.toFormat(g.YYMMDDHHMMSS),totalTime:e.inUse&&!this.layout.expanded?{field:!1,tooltipValue:this.getTotalTime(e.startO,e.stopO),tag:!0,tagValue:this.$t(`${this.pageBase}.inUse`)}:this.getTotalTime(e.startO,e.stopO)})});return t=t.map(e=>{var a;return c(d({},e),{ipAddress:(a=e.instance)==null?void 0:a.iPAddress})}),t},selectedColumns(){return[{field:"instanceName",header:this.$t(`${this.pageBase}.name`),style:{minWidth:"7rem"},props:{filterMatchMode:"startsWith",showFilterOperator:!0,showFilterMatchModes:!0,maxConstraints:3,showApplyButton:!0,showClearButton:!0}},{field:"username",header:this.$t(`${this.pageBase}.username`),style:{minWidth:"7rem"},props:{filterMatchMode:"startsWith",showFilterOperator:!0,showFilterMatchModes:!0,maxConstraints:3,showApplyButton:!0,showClearButton:!0}},...this.layout.expanded?[{field:"ipAddress",header:this.$t(`${this.pageBase}.ipAddress`),style:{maxWidth:"10%",minWidth:"8rem"},props:{filterMatchMode:"startsWith",showFilterOperator:!0,showFilterMatchModes:!0,maxConstraints:3,showApplyButton:!0,showClearButton:!0}}]:[],...this.layout.expanded?[{field:"startF",header:this.$t(`${this.pageBase}.start`),style:{maxWidth:this.layout.expanded?"15%":"20%",minWidth:"7rem"},props:{showFilterMenu:!1}}]:[],...this.layout.expanded?[{field:"stopF",header:this.$t(`${this.pageBase}.stop`),style:{maxWidth:this.layout.expanded?"15%":"20%",minWidth:"7rem"},props:{showFilterMenu:!1}}]:[],{field:"totalTime",header:this.$t(`${this.pageBase}.totalTime`),style:{maxWidth:this.layout.expanded?"10%":"15%",minWidth:"8rem"},props:{showFilterMenu:!1}}]}}),mounted(){},activated(){this.refresh()},created(){this.initFilters()},watch:{range(t){this.refresh()}},methods:{initFilters(){this.filters={global:{value:null,matchMode:b.CONTAINS},instanceName:{operator:M.AND,constraints:[{value:null,matchMode:b.STARTS_WITH}]},username:{operator:M.AND,constraints:[{value:null,matchMode:b.CONTAINS}]},ipAddress:{operator:M.AND,constraints:[{value:null,matchMode:b.CONTAINS}]}}},clearFilters(){this.initFilters()},async load({startTime:t=null,endTime:e=null}={}){let a=[],i=p.local();try{let{items:r=[]}=await re.getUsage({startTime:t,endTime:e});a=(r!=null?r:[]).map(s=>c(d({},s),{startO:p.fromISO(s.start),stopO:p.fromISO(s.stop).invalid?null:p.fromISO(s.stop)})),a=a.map(s=>c(d({},s),{stopO:s.stopO&&s.stopO<s.startO?null:s.stopO})),a=a.map(s=>c(d({},s),{stopO:s.stopO?s.stopO:i,inUse:!s.stopO}))}catch{}this.items=a},refresh(){let t=p.fromFormat(this.range.start,g.YYMMDD).startOf("day").toUTC().toISO(),e=p.fromFormat(this.range.end,g.YYMMDD).endOf("day").toUTC().toISO();this.load({startTime:t,endTime:e})},getTotalTime(t,e){try{return e.diff(t).toFormat("hh:mm:ss")}catch{return"-"}}}},de=t=>(X("data-v-fce46fb0"),t=t(),Z(),t),ue={class:"justify-content-between flex pb-0 min-w-max instance-header"},ce=de(()=>l("div",null,[l("span",{class:"text-2xl text-primary"},"Instance Usage")],-1)),me={class:"formgroup-inline"},pe={class:"field mb-0"},he={for:"createAt"},fe={class:"field mr-0 mb-0"},ge={for:"destroyAt"},ye={class:"flex-1 min-h-0 mb-3 mt-3"},ve={class:"flex justify-content-between align-items-center"},_e={class:"flex flex-1 justify-content-center py-3"},be={class:"text-center line-height-3"},xe={class:"col-12"};function Me(t,e,a,i,r,s){const u=h("InputText"),I=h("v-date-picker"),$=h("Button"),U=h("Tag"),W=h("Column"),L=h("DataTable");return y(),w("div",{class:Q(["bg-primary grid grid-nogutter max-h-full h-full flex-nowrap flex-column p-4 primary-background",{"p-6":i.layout.expanded}])},[l("div",ue,[ce,m(I,{popover:{visibility:"focus",placement:"top"},columns:t.$screens({default:1,lg:2}),"input-debounce":500,masks:{input:"YYYY-MM-DD"},"model-config":{type:"string",mask:"YYYY-MM-DD"},mode:"date",class:"m-0 p-0",modelValue:r.range,"onUpdate:modelValue":e[0]||(e[0]=o=>r.range=o),"is-range":""},{default:f(({inputValue:o,inputEvents:v})=>[l("div",me,[l("div",pe,[l("label",he,x(t.$t(`${i.pageBase}.filters.from`)),1),m(u,O({class:"max-w-10rem m-0",value:o.start},k(v.start)),null,16,["value"])]),l("div",fe,[l("label",ge,x(t.$t(`${i.pageBase}.filters.to`)),1),m(u,O({class:"max-w-10rem",value:o.end},k(v.end)),null,16,["value"])])])]),_:1},8,["columns","modelValue"])]),l("div",ye,[m(L,{class:"custom-scrollbars p-datatable-sm nohead mb-2 mt-0 flex-1",scrollable:!0,scrollHeight:"flex",rowHover:!0,columnResizeMode:"fit",value:s.list,responsiveLayout:"scroll",filterDisplay:"menu",filters:r.filters,"onUpdate:filters":e[2]||(e[2]=o=>r.filters=o),globalFilterFields:["instanceName","username","ipAddress"],rowClass:()=>"cursor-pointer",paginator:!0,rows:20,stripedRows:"",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords}"},{header:f(()=>[l("div",ve,[m($,{class:"p-button-text",icon:"thin-refresh",label:t.$t(`${i.pageBase}.refresh`),onClick:s.refresh},null,8,["label","onClick"]),l("div",null,[m(u,{class:"p-inputtext-sm",modelValue:r.filters.global.value,"onUpdate:modelValue":e[1]||(e[1]=o=>r.filters.global.value=o),placeholder:"Search",type:"text"},null,8,["modelValue"])])])]),empty:f(()=>[l("div",_e,[l("div",be,[l("div",xe,[l("span",null,x(t.$t(`${i.pageBase}.usageTable.empty`)),1)])])])]),default:f(()=>[(y(!0),w(Y,null,ee(s.selectedColumns,(o,v)=>(y(),N(W,O({sortable:!0,field:o.field,header:o.header,style:o.style,key:o.field+"_"+v},o.props),{body:f(n=>{var _,F,T,B,D;return[(F=(_=n.data[n.field])==null?void 0:_.field)==null||F?(y(),w(Y,{key:0},[te(x((B=(T=n.data[n.field])==null?void 0:T.fieldValue)!=null?B:n.data[n.field]),1)],64)):V("",!0),(D=n.data[n.field])!=null&&D.tag?(y(),N(U,{key:1,severity:"success",value:n.data[n.field].tagValue},null,8,["value"])):V("",!0)]}),filter:f(({filterModel:n})=>[m(u,{type:"text",modelValue:n.value,"onUpdate:modelValue":_=>n.value=_,class:"p-column-filter",placeholder:"Search by name"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1040,["field","header","style"]))),128))]),_:1},8,["value","filters","rowClass"])])],2)}var Te=G(ie,[["render",Me],["__scopeId","data-v-fce46fb0"]]);export{Te as default};
