/* Thinfinity(c) Remote Desktop Server v7.0.3.114 */
Object.defineProperty(window,"productId",{"enumerable":true,"configurable":false,"get":function(){return"thinrdp"}});Object.defineProperty(window,"cookiePrefix",{"enumerable":true,"configurable":false,"get":function(){return"RDP"}});Object.defineProperty(window,"fromBroker",{"enumerable":true,"configurable":false,"get":function(){return true}});Object.defineProperty(window,"productName",{"enumerable":true,"configurable":false,"get":function(){return"<%=$LICPROD%>"}});
function AgentInfo(){var p={};var asyncCallbacks={};var apaSupported=false;var _self=this;var _surface={isTouchable:undefined,key:"__#thinfinity.touch.data__",callbacks:[]};function initialize(){p=getBrowserInfo();if(this.__proto__==null)if(Object.getPrototypeOf)this.__proto__=Object.getPrototypeOf(this);else this.__proto__=this.constructor.prototype;this.__proto__.getAgentKey=function(){var result;if(p["isIOS"])result="IOS_";else if(p["isAndroid"])result="ANDROID_";else if(p["isPlaybook"])result=
"PLAYBOOK_";else if(p["isHPTablet"])result="WEBOS_";else if(p["isChromeOS"])result="CHROMEOS_";else if(p["isMac"])result="MAC_";else if(p["isSymbian"])result="SYMBIAN_";else result="PC_";if(p["isFirefox"])result+="FIREFOX";else if(p["isOpera"])result+="OPERA";else if(p["isSafari"])result+="SAFARI";else if(p["isChrome"])result+="CHROME";else if(p["isMSIE"])result+="MSIE";else if(p["isTrident"])result+="TRIDENT";else if(p["isNokiaBrowser"])result+="NOKIA";else if(p["isChromium"])result+="CHROMIUM";
return result};this.__proto__.browserFromAgent=function(agentStr){var result;var params=getBrowserInfo(agentStr);if(params["isFirefox"])result="Mozilla Firefox";else if(params["isOpera"])result="Opera";else if(params["isSafari"])result="Safari";else if(params["isChrome"])result="Google Chrome";else if(params["isMSIE"])result="MS Internet Explorer";else if(params["isNokiaBrowser"])result="Nokia Browser";else if(params["isTrident"])result="Trident (MSIE >= 11, like Gecko)";else if(params["isChromium"])result=
"CHROMIUM";result+=" on ";if(params["isIOS"])result+="iOS"+(iosVersion==7)?" 7":"";else if(params["isAndroid"])result+="Android";else if(params["isPlaybook"])result+="BlackBerry Playbook";else if(params["isChromeOS"])result+="Chrome OS";else if(params["isHPTablet"])result+="Web OS";else if(params["isMac"])result+="Mac";else if(params["isSymbian"])result+="Symbian";else result+="PC";return result};getInitizationData();touchableDetection();try{window.dispatchEvent(new CustomEvent("addStatusAPIVariables",
{"detail":[{"name":"supportH264","title":"Support H264","get":function(){return p.h264},"index":100},{"name":"isMobile","title":"Mobile","get":function(){return p.isMobile},"index":110},{"name":"isTouch","title":"Touch","get":function(){return p.isTouch},"index":120},{"name":"browserInfo","title":"Browser","get":function(){var binfo=[];if(p.isWindows)binfo.push("Windows");else if(p.isMac)binfo.push("Mac");if(p.isChrome)binfo.push("Chrome: "+p.chromeVersion);else if(p.isOpera)binfo.push("Opera");else if(p.isSafari)binfo.push("Safari");
else if(p.isSafari)binfo.push("Safari");else if(p.isMSIE)binfo.push("IE "+p.msieVersion);else if(p.isFirefox)binfo.push("Firefox");binfo=binfo.join(", ");return binfo},"index":130}]}))}catch(error){}}(function autoplayAudioSupported(callback){if(isFirefox())callback(false);else{var audioFile="data:audio/mpeg;base64,/+MYxAAAAANIAAAAAExBTUUzLjk4LjIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";var audioElem=document.createElement("audio");audioElem.muted=true;audioElem.preload="auto";
audioElem.src=audioFile;var startPlayPromise=audioElem.play();if(!!startPlayPromise)startPlayPromise.then(function(){audioElem=null;callback(true)}).catch(function(error){audioElem=null;callback(false)});else callback(false)}})(response=>{apaSupported=response});function touchableDetection(){if(window.sessionStorage){let tempData=sessionStorage.getItem(_surface.key);if(tempData)try{tempData=JSON.parse(tempData);if(tempData.hasOwnProperty("isTouchable"))_surface.isTouchable=tempData.isTouchable}catch(error){}if(_surface.isTouchable||
p.isTouch)p.isTouch=true;else if(!p.isMobile){var waitForTouchDevice=function(){return new Promise(resolve=>{var _touchDetection=function(e){if(e?.sourceCapabilities?.firesTouchEvents===true){p.isTouch=true;window.sessionStorage.setItem(_surface.key,JSON.stringify({isTouchable:true}));window.removeEventListener("touchstart",_touchDetection,{passive:false});resolve()}};window.addEventListener("touchstart",_touchDetection,{passive:false})})};waitForTouchDevice().then(r=>{_surface.callbacks.forEach(fn=>
{try{fn()}catch(error){console.log(`Cannot execute callback: ${error.message||error}`)}});_surface.callbacks=null})}}}function detectTouch(callback){if(_surface.isTouchable===true)callback();else _surface.callbacks.push(callback)}function isFirefox(){var m=window.navigator.userAgent.match(/firefox/gi);return m&&m.length!=-1}function detectFirefox(userAgent,params){params["isFirefox"]=userAgent.indexOf("firefox")!=-1;params["firefoxVersion"]=0;if(/firefox[\/\s](\d+\.\d+)/.test(userAgent))params["firefoxVersion"]=
new Number(RegExp.$1)}function getOSVersion(userAgent){var osReg=new RegExp(/Windows NT [0-9]+.[0-9]+;/gi);var numReg=new RegExp(/[0-9]+/gi);var fgroup=userAgent.match(osReg);if(fgroup)try{var osnum=fgroup[0].match(numReg);if(osnum){osnum=parseInt(osnum[0],10);if(osnum<10)return 7;else return 10}}catch(error){}return"unknown"}function getMSIEBrowserVersion(userAgent){try{var tempVersion=/edge\/(([0-9]+).)*/.exec(userAgent)||0;return parseFloat(tempVersion[0].replace("edge/","").replace(/ /g,"").replace(/;/g,
""))}catch(error){return 0}}function detectIE(userAgent,params){var reg=/(msie) ([\w.]+)/.exec(userAgent);params["msieVersion"]=0;params["msieOSVersion"]="";params["msieHTMLVersion"]=0;params["isWindowsPhone"]=false;var ieTest=/(msie) ([0-9\.]+)/i.exec(userAgent);params["isMSIE"]=!!(ieTest&&ieTest[1]=="msie");if(params["isMSIE"])params["msieVersion"]=parseFloat(ieTest[2]);else if(userAgent.indexOf("trident")!=-1){ieTest=/rv:([0-9\.]+)/i.exec(userAgent);if(ieTest){params["isMSIE"]=true;params["msieVersion"]=
parseFloat(ieTest[1])}}else if(/(windows nt 10.0)/i.exec(userAgent)&&/(edge)/i.exec(userAgent)){params["isMSIE"]=true;params["msieVersion"]=12}else if(/(windows phone 10.0)/i.exec(userAgent)&&/(edge)/i.exec(userAgent)){params["isMSIE"]=true;params["msieVersion"]=12;params["isWindowsPhone"]=true}if(params.isMSIE)params.msieHTMLVersion=getMSIEBrowserVersion(userAgent);params["msieOSVersion"]=getOSVersion(userAgent)}function checkPolyfillObjectURL(){window.URL=window.URL||window.webkitURL;return window.URL?
true:false}function checkTypedArrays(){var result=false;if(!window.Uint32Array&&!window.Uint16Array&&!window.Uint8Array)return result;var test=null;var testU8=null;var testU16=null;var testU32=null;var i;try{test=new ArrayBuffer(16);testU8=new Uint8ClampedArray(test,8,8);testU16=new Uint16Array(test,8,4);testU32=new Uint32Array(test,8,2);for(i=0;i<testU8.length;++i)testU8[i]=171;for(i=0;i<testU16.length;++i)testU16[i]=43947;for(i=0;i<testU32.length;++i)testU32[i]=2880154539;result=true}catch(err){result=
false}finally{testU8=null;testU16=null;testU32=null;test=null}return result}function checkTransferableObjects(){var result;var workerScript;var objectUrl;var trArr;var trWork;try{if(!window.URL)throw"";workerScript=new Blob(["onmessage = function (oEvent) {}"],{type:"text/javascript"});objectUrl=window.URL.createObjectURL(workerScript);trArr=new ArrayBuffer(1);trWork=new Worker(objectUrl);trWork.postMessage(trArr,[trArr]);result=trArr.byteLength?false:true}catch(err){result=false}finally{trWork=null;
trArr=null;window.URL.revokeObjectURL(objectUrl)}return result}function checkAsmJsWorkersSupportAsync(scriptUrl,params){var worker;try{if(!params["hasTypedArrays"]||!_self.hasTransferableObjects)throw"";worker=new Worker(scriptUrl);worker.onmessage=function(oEvent){params["supportsAsmJsWorkers"]=true;params["supportsRFXDecoder"]=true;worker=null;callAsyncDetectionCallback("OnAsmJsWorkersTested")};worker.onerror=function(oEvent){params["supportsAsmJsWorkers"]=false;params["supportsRFXDecoder"]=false;
worker=null;callAsyncDetectionCallback("OnAsmJsWorkersTested")};worker.postMessage("test")}catch(err){params["supportsAsmJsWorkers"]=false;params["supportsRFXDecoder"]=false;worker=null;callAsyncDetectionCallback("OnAsmJsWorkersTested")}}function getIphoneModel(){var retModel={"name":"","resolution":"","majorVersion":0};try{var dpr=window.devicePixelRatio||1;var h=window.screen.height*dpr;var w=window.screen.width*dpr;if(w==320&&h==480)retModel={"name":["1","2g","3","3g","3gs"],"resolution":"320x480",
"majorVersion":3};else if(w==640&&h==960)retModel={"name":["4","4s"],"resolution":"640x960","majorVersion":4};else if(w==640&&h==1136)retModel={"name":["5","5s","5c"],"resolution":"640x1136","majorVersion":5};else if(w==750&&h==1334)retModel={"name":["6"],"resolution":"750x1134","majorVersion":6};else if(w==1080&&h==1920)retModel={"name":["6plus"],"resolution":"1080x1920","majorVersion":6}}catch(error){}return retModel}function getBrowserInfo(userAgent){var params={};if(typeof userAgent!="string")userAgent=
navigator.userAgent;params["agentStr"]=userAgent=userAgent.toLowerCase();var isTrident=userAgent.indexOf("trident")!=-1;params["protocol"]=document.location.protocol=="https:"?"https":"http";params["majorVersion"]=parseInt(navigator.appVersion,10);params["isWindows"]=userAgent.indexOf("windows")!=-1;params["isMac"]=userAgent.indexOf("macintosh")!=-1;params["isLinux"]=userAgent.indexOf("linux")!=-1;params["isIOS"]=(userAgent.indexOf("iphone")!=-1||userAgent.indexOf("ipod")!=-1||userAgent.indexOf("ipad")!=
-1||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!isTrident;params["iosVersion"]=params["isIOS"]?/os (([0-9]+)_)*./.exec(userAgent)||0:0;if(params["iosVersion"]!=0)try{params["iosBuildVersion"]=params["iosVersion"][0].replace("os","").replace(/_/g,".").replace(/ /g,"");var tempIosVersion=params["iosVersion"][0].replace("os","").replace(/ /g,"");if(tempIosVersion.indexOf("_")!=-1)tempIosVersion=parseInt(tempIosVersion.substring(0,tempIosVersion.indexOf("_")),10);params["iosVersion"]=
tempIosVersion}catch(error){params["iosVersion"]=params["iosBuildVersion"]=params["iosVersion"][params["iosVersion"].length-1]}params["ipadModel"]=0;if(params["isIOS"])try{var ipadModel=1;if(window.ondevicemotion)window.ondevicemotion=function(e){if(event.acceleration)ipadModel+=window.devicePixelRatio;params["ipadModel"]=ipadModel;window.ondevicemotion=null};else params.ipadModel="pro"}catch(error){params["ipadModel"]=0}params["isIphone"]=(userAgent.indexOf("iphone")!=-1||userAgent.indexOf("ipod")!=
-1)&&!isTrident;if(params["isIphone"]==true)params["iphoneModel"]=getIphoneModel();params["isIpod"]=userAgent.indexOf("ipod")!=-1;params["isAndroid"]=userAgent.indexOf("android")!=-1&&!isTrident;params["isHPTablet"]=userAgent.indexOf("hp-tablet")!=-1;params["isPlaybook"]=userAgent.indexOf("playbook")!=-1;params["isChromeOS"]=userAgent.indexOf(" cros ")!=-1;if(params["isChromeOS"]==true)try{var tempChromeVersion=/android (([0-9]+).)*./.exec(userAgent)||0;params["chromeOSVersion"]=tempChromeVersion[0].replace("android",
"").replace(/ /g,"").replace(/;/g,"")}catch(error){params["chromeOSVersion"]="0"}else params["chromeOSVersion"]="0";params["isYandex"]=userAgent.indexOf("yabrowser")!=-1;detectIE(userAgent,params);params["isSymbian"]=userAgent.indexOf("symbian")!=-1;params["isWindowMobile"]=userAgent.indexOf("iemobile")!=-1||userAgent.indexOf("windows phone")!=-1;params["isOpera"]=userAgent.indexOf("opera")!=-1||userAgent.indexOf("opr/")!=-1;params["isChrome"]=!params["isOpera"]&&(userAgent.indexOf("chrome")!=-1||
userAgent.indexOf("crios")!=-1)&&params["isMSIE"]==false;params["isChromium"]=false;if(params["isChrome"])try{var getChromeVersion=function(){var tempChromeVersion=/chrome\/(([0-9]+).)*/.exec(userAgent)||0;return tempChromeVersion[0].replace("chrome/","").replace(/ /g,"").replace(/;/g,"")};var getCriosVersion=function(){var tempChromeVersion=/crios\/(([0-9]+).)*/.exec(userAgent)||0;return params["chromeVersion"]=tempChromeVersion[0].replace("crios/","").replace(/ /g,"").replace(/;/g,"")};var tempChromeVersion=
"";if(params["isIOS"]){tempChromeVersion=/crios\/(([0-9]+).)*/.exec(userAgent)||0;if(tempChromeVersion){params.isChrome=true;params.isSafari=false;params["chromeVersion"]=getCriosVersion()}else{params.isIOS=false;params.isSafari=false;params["chromeVersion"]=getChromeVersion()}}else{tempChromeVersion=/chrome\/(([0-9]+).)*/.exec(userAgent)||0;if(tempChromeVersion){params.isChrome=true;params.isSafari=false;params["chromeVersion"]=getChromeVersion()}else{params.isIOS=false;params.isSafari=false}}}catch(error){params["chromeVersion"]=
"0"}else params["chromeVersion"]="0";params["isDragon"]=userAgent.indexOf("dragon")!=-1&&params["isChrome"]==true;if(params["isDragon"])try{var tempDragonVersion=/dragon\/(([0-9]+).)*/.exec(userAgent)||0;params["dragonVersion"]=tempDragonVersion[0].replace("dragon/","").replace(/ /g,"").replace(/;/g,"")}catch(error){params["dragonVersion"]="0"}else params["dragonVersion"]="0";params["isNokiaBrowser"]=userAgent.indexOf("nokiabrowser")!=-1;detectFirefox(userAgent,params);params["isSafari"]=!(params["isNokiaBrowser"]||
params["isChrome"]||params["isOpera"]||params["isFirefox"]||params["isMSIE"])&&(userAgent.indexOf("safari")!=-1||params["isIOS"]);if(params["isSafari"]&&params["isAndroid"]){params["isSafari"]=false;params["isChromium"]=true}if(params.isMSIE&&params.msieVersion>=11&&params.isWindows){params.isIOS=false;params.isAndroid=false;params.isSafari=false;params.isChrome=false;params.isFirefox=false}params["isMobile"]=!params["isChromeOS"]&&(params["isIOS"]||params["isAndroid"]||params["isHPTablet"]||params["isPlaybook"]||
params["isSymbian"]||params["isWindowMobile"]);params["isTouch"]=!!("ontouchstart"in window)||navigator.pointerEnabled&&navigator.maxTouchPoints>0||navigator.msPointerEnabled&&navigator.msMaxTouchPoints>0||false;params["hasObjectURL"]=checkPolyfillObjectURL();params["hasArrayBuffers"]=!!window.ArrayBuffer;params["hasTypedArrays"]=params["hasArrayBuffers"]?checkTypedArrays():false;params["hasWorkers"]=!!window.Worker;params["hasTransferableObjects"]=null;window.requestAnimationFrame=window.requestAnimationFrame||
window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){setTimeout(callback,0)};params["supportsAsmJsWorkers"]=false;params["supportsRFXDecoder"]=false;if(params["isWindowsPhone"]==true){params["isAndroid"]=false;params["isChromium"]=false;params["isChromeOS"]=false;params["chromeVersion"]="0"}params["isTabletMode"]=false;params["timeZone"]=-(new Date).getTimezoneOffset()/60;params["h264"]=!(params.isMSIE&&params.msieVersion<15);params["gfx"]=
!(params.isMSIE&&params.msieVersion<15)&&!params["isSafari"];return params}function supportsFullScreen(element){var response=false;if(element==null||element==undefined)element=document.documentElement;if(element){if(element.requestFullscreen)response=true;else if(element.mozRequestFullScreen)response=true;else if(element.webkitRequestFullscreen)response=true;else if(element.msRequestFullscreen)response=true;if(response&&!(p.isMac&&(p.isOpera||p.isChrome)||p.isChrome))response=window.top===(typeof element.defaultView!=
"undefined"?element.defaultView:typeof element.ownerDocument!="undefined"&&typeof element.ownerDocument.defaultView!="undefined"?element.ownerDocument.defaultView:window)}return response}function callAsyncDetectionCallback(event){if(asyncCallbacks.hasOwnProperty(event)){var callbacks=asyncCallbacks[event];for(var i=0;i<callbacks.length;++i)callbacks[i].callback.apply(callbacks[i].self)}}function addAsyncDetectionCallback(event,self,callback){if(!asyncCallbacks.hasOwnProperty(event))asyncCallbacks[event]=
[];asyncCallbacks[event].push({self:self,callback:callback})}function runAsyncDetections(){checkAsmJsWorkersSupportAsync("common/workers/test.js",p)}function supportHTML5(){try{var canvas=document.createElement("canvas");return typeof canvas.getContext!="undefined"?true:false}catch(error){return false}}function updateProperty(){if(arguments&&arguments.length>0)for(var key in arguments[0])if(p[key]!=undefined){console.log(`Forcing property value - ${key}:${arguments[0][key]}`);p[key]=arguments[0][key]}}
function getInitizationData(){if(window.Thinfinity&&window.Thinfinity.InitializationData){var data=window.Thinfinity.InitializationData.get("AGENTINFO");if(data)updateProperty(data)}}function setInitializationData(data){if(window.Thinfinity&&window.Thinfinity.InitializationData){window.Thinfinity.InitializationData.update("AGENTINFO",data);updateProperty(data)}}function getTransferableObjects(){if(p["hasTransferableObjects"]!=null)return p["hasTransferableObjects"];else{p["hasTransferableObjects"]=
p["hasWorkers"]?checkTransferableObjects():false;return p["hasTransferableObjects"]}}function compareVersions(versionA,versionB){var result=0;if(versionA!=versionB){var aVA=versionA.split(".");var aVB=versionB.split(".");var m=Math.min(aVA.length,aVB.length);var i=0;while(result==0&&i<m){result=parseInt(aVA[i],10)-parseInt(aVB[i],10);i++}if(result==0)if(m<aVB.length)result=-1;else if(m<aVA.length)result=1}return result}function isNewerThan(versionA,versionB){return compareVersions(versionA,versionB)>
0}function isOlderThan(versionA,versionB){return compareVersions(versionA,versionB)<0}function isSameVersion(versionA,versionB){return compareVersions(versionA,versionB)==0}function getBrowserName(){return p["isChrome"]?"chrome":p["isMSIE"]?"edge":p["isFirefox"]?"firefox":p["isOpera"]?"opera":p["isSafari"]?"safari":p["isDragon"]?"dragon":p["isSymbian"]?"symbian":p["isChromium"]?"android":"unknown"}function supportOggFormat(callback){let checkOgg=()=>{return new Promise(resolve=>{try{let audioCtx=
new AudioContext;let chunk=[79,103,103,83,0,2,0,0,0,0,0,0,0,0,26,50,0,0,0,0,0,0,253,79,48,95,1,19,79,112,117,115,72,101,97,100,1,2,56,1,68,172,0,0,0,0,0,79,103,103,83,0,0,0,0,0,0,0,0,0,0,26,50,0,0,1,0,0,0,101,92,227,247,1,51,79,112,117,115,84,97,103,115,35,0,0,0,108,105,98,111,112,117,115,32,117,110,107,110,111,119,110,44,32,108,105,98,111,112,117,115,101,110,99,32,117,110,107,110,111,119,110,0,0,0,0,79,103,103,83,0,4,245,37,0,0,0,0,0,0,26,50,0,0,2,0,0,0,167,37,66,36,14,255,144,241,237,233,235,241,
233,230,255,111,230,255,158,252,127,12,20,204,98,190,27,223,60,146,131,102,2,15,67,177,166,86,254,172,19,81,160,245,25,129,89,47,50,163,219,19,109,120,142,210,182,207,246,96,150,241,199,58,105,62,202,178,179,170,86,30,188,185,17,125,250,117,60,173,73,126,157,36,135,211,204,180,173,211,208,122,17,193,32,51,107,80,2,34,51,119,59,119,122,228,213,149,184,223,154,232,140,57,182,203,52,207,211,36,98,208,10,24,250,149,166,251,147,123,156,163,173,143,250,145,224,120,23,125,163,194,207,224,192,202,60,103,
42,44,254,187,54,251,212,135,145,105,136,31,138,157,19,34,160,226,180,201,223,78,96,54,7,249,255,203,49,105,182,182,227,80,120,30,161,20,0,0,0,1,244,148,122,129,74,111,98,98,85,129,123,61,74,124,255,58,194,191,58,194,183,89,45,128,75,96,0,2,208,1,30,72,209,111,46,227,119,148,51,34,19,209,3,214,235,0,191,149,3,214,235,55,120,147,57,153,131,41,216,133,47,110,252,30,102,202,17,96,192,212,74,97,193,185,149,214,165,55,204,141,161,39,104,96,131,64,197,153,0,109,233,199,117,124,93,47,177,243,68,148,182,
182,43,232,172,62,79,64,103,124,59,16,176,139,36,116,143,10,233,116,192,152,166,143,138,30,14,114,190,123,33,196,102,217,98,212,101,134,196,141,110,118,204,91,173,171,117,146,22,179,162,139,248,0,164,124,99,112,66,94,122,216,1,59,239,84,22,187,179,205,107,221,59,195,94,43,229,106,122,130,205,203,197,229,216,150,12,0,54,121,110,118,234,14,145,117,155,220,93,226,115,230,100,69,147,31,164,71,109,96,182,38,45,17,124,179,250,89,128,21,231,11,68,164,87,1,82,7,252,101,151,201,103,98,50,196,172,95,172,137,
244,140,185,12,251,106,121,57,240,172,205,112,121,55,113,123,117,114,14,246,44,246,80,110,187,121,212,147,237,241,69,46,235,178,140,192,114,121,219,97,150,55,23,151,4,19,37,221,162,241,61,214,150,232,163,86,135,190,154,29,191,84,40,136,48,81,232,230,206,213,92,99,105,182,199,80,230,91,49,85,148,56,51,176,67,233,100,20,152,213,3,194,183,146,123,49,23,37,51,223,66,43,116,115,57,11,16,159,43,198,68,239,150,143,76,54,72,36,151,188,185,201,243,25,74,132,117,71,202,195,63,131,194,48,50,155,61,136,31,247,
56,18,115,168,185,134,226,172,72,246,95,76,122,39,70,231,227,240,139,51,142,65,27,172,31,127,26,249,69,186,117,31,134,51,185,45,156,37,81,149,93,90,145,164,18,197,255,189,61,219,209,159,198,123,70,168,110,107,55,49,69,2,145,2,54,105,13,77,53,59,233,160,247,10,184,137,144,157,27,184,33,242,229,145,106,155,166,123,149,252,38,119,8,151,118,97,60,197,181,145,118,161,103,159,136,110,183,175,184,61,238,153,244,76,74,102,163,131,108,1,86,11,0,34,130,169,169,103,192,103,90,100,153,238,171,117,44,143,177,
252,6,14,193,55,13,24,140,103,2,252,205,240,15,204,12,174,97,179,126,240,140,76,251,90,229,42,205,20,183,121,43,250,243,148,162,226,230,127,110,202,103,62,84,198,232,113,45,3,185,90,52,180,220,120,20,123,231,143,102,132,221,227,46,11,221,92,73,71,207,133,131,128,108,39,45,205,14,68,70,83,178,18,26,232,179,88,43,29,39,175,76,153,80,31,221,61,228,239,130,217,80,157,95,149,43,230,177,106,69,153,0,54,129,100,65,23,60,6,5,156,187,33,183,107,89,142,117,165,31,198,138,24,134,177,177,79,130,139,181,20,106,
195,13,6,48,183,205,179,81,124,3,217,236,124,255,20,87,9,235,73,59,248,226,54,59,126,110,190,126,88,4,64,155,85,254,70,122,234,122,185,239,144,58,75,144,234,252,40,103,44,173,139,243,37,30,197,11,208,244,201,78,57,181,34,58,66,91,165,70,64,196,34,184,32,243,173,104,63,51,109,186,218,178,226,79,176,10,183,19,52,247,113,211,140,239,52,244,33,154,168,83,172,166,222,82,223,108,166,207,68,109,11,193,128,141,218,147,36,180,69,173,15,193,112,36,86,48,198,241,67,246,134,17,195,246,35,125,42,247,80,142,127,
67,146,2,204,117,227,203,160,208,164,141,226,73,131,203,89,215,80,206,22,64,116,155,137,197,119,87,161,46,235,231,82,13,34,234,228,38,36,87,38,128,236,101,183,25,108,53,79,248,133,242,140,107,88,86,134,80,66,142,109,53,219,109,14,186,81,42,117,47,82,243,50,54,15,170,90,56,21,199,82,16,161,241,123,72,63,62,163,209,12,31,212,150,210,215,178,241,71,151,143,179,155,102,109,228,230,244,8,18,22,3,155,197,62,212,148,68,154,244,10,193,22,55,170,207,168,185,21,247,110,197,218,207,242,149,240,249,252,37,177,
219,167,13,34,187,105,57,130,73,87,49,150,29,217,251,190,247,255,45,237,202,156,26,231,13,114,170,231,116,139,117,34,252,122,95,146,78,177,167,231,24,42,55,50,9,201,224,173,201,153,204,5,219,147,104,132,124,52,219,74,43,212,159,1,133,74,12,85,195,232,231,16,59,190,98,1,38,222,164,52,113,31,42,114,164,222,154,74,242,83,188,163,162,135,59,127,5,217,90,27,91,124,33,248,239,98,58,218,127,220,136,110,10,42,73,102,64,136,249,116,68,153,103,4,165,210,111,143,119,75,182,97,70,93,171,221,238,231,202,111,160,
111,35,126,254,88,190,125,160,69,85,223,230,225,180,189,57,32,75,148,91,58,163,14,73,51,254,2,14,203,168,109,141,29,225,52,108,13,52,54,155,172,191,153,125,225,190,93,114,36,205,35,48,60,144,215,202,204,57,18,118,14,147,161,143,250,45,143,65,224,84,216,197,96,210,10,160,52,230,209,109,39,45,143,132,126,114,74,7,31,45,60,252,46,164,87,128,38,225,187,169,63,243,221,220,205,167,103,27,124,115,184,21,55,115,9,104,162,39,189,176,22,175,89,189,148,187,215,107,84,90,202,96,131,199,111,39,240,230,122,137,
238,212,15,81,108,118,198,133,91,18,173,171,194,116,15,160,216,183,167,172,194,114,23,77,12,35,252,66,192,98,21,37,29,73,204,83,118,198,102,166,91,251,66,117,97,61,99,143,7,122,149,189,148,253,25,208,151,150,243,6,100,162,152,176,5,48,164,119,86,58,245,188,191,183,200,22,172,239,95,114,138,173,251,199,248,157,90,192,93,89,206,229,84,82,30,98,19,18,42,202,29,25,67,54,159,146,188,236,148,60,203,55,58,66,217,113,253,79,13,35,253,91,16,44,172,36,2,68,183,244,69,53,110,61,228,149,12,101,61,86,211,122,
152,68,69,145,7,208,57,93,91,31,14,142,163,8,156,22,154,142,187,80,192,100,221,184,249,185,221,133,74,153,67,105,189,186,185,71,82,216,226,52,69,238,44,106,34,236,199,68,141,131,252,47,9,213,11,17,31,234,115,186,222,147,77,196,1,20,144,89,226,207,65,128,12,138,213,175,85,7,180,28,136,198,216,55,103,59,153,110,195,193,202,20,207,134,44,128,190,3,83,166,125,130,68,218,106,38,193,95,81,156,99,85,107,98,64,2,211,235,176,1,12,218,141,40,150,220,170,57,94,8,152,53,103,130,141,102,224,130,59,206,3,235,14,
113,74,193,197,94,27,181,221,167,150,81,193,14,212,232,101,104,157,4,81,119,11,93,45,61,71,223,11,119,162,156,228,63,156,110,148,177,85,23,17,42,67,142,58,118,112,199,215,24,54,251,43,175,137,161,32,161,38,78,231,249,136,68,235,249,180,77,33,156,93,173,217,26,1,118,224,21,60,169,159,66,169,87,192,50,254,4,228,152,169,23,180,10,164,178,30,164,3,243,173,244,55,40,116,202,182,116,100,72,55,138,241,235,49,128,145,104,26,254,141,101,16,125,54,239,45,0,103,215,218,31,158,215,97,104,87,45,146,18,164,252,
46,0,101,234,211,183,62,130,57,238,51,209,85,67,128,33,10,167,149,176,189,237,244,99,28,6,121,119,183,32,108,88,245,165,153,181,153,51,71,142,71,9,254,24,204,95,196,3,34,188,225,84,206,7,157,159,242,174,188,170,39,240,133,52,129,88,151,44,11,187,239,245,192,18,57,182,161,133,110,12,178,128,144,89,47,206,243,222,2,181,137,29,228,181,133,20,98,135,210,56,218,162,123,139,111,230,228,247,76,252,228,136,149,129,131,122,162,43,132,165,118,77,140,168,89,122,250,225,65,90,60,4,213,71,237,205,210,26,28,95,
200,94,132,72,92,199,126,37,136,87,152,226,172,36,201,191,110,86,50,81,47,120,59,16,239,108,46,205,194,93,52,186,95,147,174,128,220,217,105,108,121,193,48,136,206,71,204,66,41,138,178,222,215,79,118,140,0,211,58,124,81,11,172,174,187,101,221,124,8,153,242,136,5,118,42,243,208,188,71,30,65,251,218,131,101,220,112,41,115,252,123,16,18,142,20,151,239,200,161,5,196,168,112,249,82,169,130,132,202,135,92,139,251,183,70,215,34,226,65,223,212,213,179,64,131,213,250,216,43,171,150,142,239,108,66,194,246,48,
69,195,166,24,197,224,63,195,5,132,131,214,218,65,5,146,98,195,112,121,192,145,72,229,193,182,53,210,7,12,139,143,19,184,151,117,4,234,212,36,199,100,106,187,168,212,115,48,201,239,33,29,26,162,94,117,137,84,143,238,144,66,142,98,58,93,26,107,90,79,113,171,146,158,1,153,111,48,232,126,120,114,61,159,191,106,154,157,96,31,42,60,238,188,203,88,125,154,239,97,228,120,220,241,123,235,22,13,220,205,19,30,15,6,28,22,183,3,162,191,200,195,184,187,45,32,173,180,77,168,212,79,102,50,219,27,163,123,144,24,
159,103,219,188,46,143,193,254,38,63,214,137,122,213,196,137,150,245,153,179,28,192,211,251,96,189,109,178,132,117,42,171,74,154,52,219,86,12,55,5,2,104,233,229,132,1,86,57,143,55,83,23,178,187,254,245,145,51,179,59,197,118,49,14,253,189,219,135,37,5,212,84,240,53,195,147,88,233,45,252,237,3,66,200,165,255,189,214,71,44,75,18,92,222,194,51,169,62,216,113,47,205,166,12,163,100,48,104,75,19,83,64,204,83,149,194,229,93,223,65,104,147,59,158,254,203,9,62,15,107,42,92,117,149,128,51,205,11,64,206,187,
145,23,126,41,65,25,52,165,152,139,26,81,72,107,223,223,242,122,115,111,52,220,27,84,55,141,92,36,146,136,97,237,196,168,69,217,252,1,18,158,161,218,100,186,252,112,152,148,116,30,118,133,8,19,138,136,50,109,180,225,221,171,138,140,219,194,53,216,152,237,58,114,57,229,39,122,170,168,222,46,144,55,199,30,234,6,104,86,64,18,42,111,80,207,57,64,129,234,56,237,117,138,130,110,141,39,137,4,247,52,96,244,134,213,135,140,218,54,183,195,243,179,113,29,191,92,164,183,88,197,60,35,214,3,250,149,205,165,204,
225,46,78,40,73,140,172,237,47,100,173,190,91,223,153,191,51,195,26,216,89,96,130,128,185,188,248,244,201,200,104,240,102,108,127,66,99,252,236,110,251,25,95,24,56,98,14,214,59,187,86,208,197,42,209,229,146,232,66,41,110,113,70,4,253,7,12,91,77,148,216,255,143,24,185,34,65,159,146,201,102,177,177,142,179,41,10,206,251,72,186,196,24,168,77,134,146,242,141,78,238,183,67,137,11,223,163,196,28,202,50,87,39,1,169,80,58,139,27,84,17,89,200,179,56,36,116,252,114,165,6,179,6,71,137,123,67,7,148,163,133,82,
23,107,43,58,198,65,72,174,130,245,38,3,254,68,169,70,116,99,149,186,84,114,147,213,100,103,222,56,189,156,225,96,58,156,0,17,86,213,8,134,46,136,30,11,11,247,97,229,80,0,12,226,247,49,102,152,8,183,31,4,151,11,188,3,11,27,5,19,184,6,190,213,104,188,0,0,7,65,195,30,60,0,0,223,109,64,130,237,214,14,160,176,40,27,216,147,27,9,68,165,25,73,146,192,72,249,89,190,220,55,61,146,249,212,81,61,64,162,97,161,102,79,186,150,13,37,121,24,189,69,247,56,202,2,217,206,0,99,86,203,165,149,53,174,201,202,97,113,
32,107,121,77,196,192,220,62,146,75,38,210,88,35,210,226,150,186,27,238,84,82,247,52,113,63,254,158,156,69,244,95,139,53,75,133,21,198,31,199,92,44,187,3,32,2,140,106,179,80,119,149,201,194,55,184,167,183,20,50,194,81,62,181,146,157,140,71,120,8,43,173,184,74,116,148,116,108,246,12,70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,13,6,137,177,239,236,22,3,42,144,166,108,232,130,10,93,18,206,254,91,121,192,138,188,92,92,122,195,226,212,169,31,
80,106,16,4,149,101,83,203,7,200,64,216,252,84,87,224,52,63,5,67,56,252,142,223,73,194,52,119,31,134,214,12,196,135,1,136,3,131,169,176,171,247,16,0,0,0,0,0,0,0,5,42,130,161,75,5,183,162,118,19,150,78,89,249,239,152,208,143,151,199,114,90,242,137,175,148,247,102,96,66,224,163,67,83,165,204];let ab=new ArrayBuffer(chunk.length*Uint8Array.BYTES_PER_ELEMENT);let view=new Uint8Array(ab);chunk.forEach((elem,idx)=>{view[idx]=elem});view=null;audioCtx.decodeAudioData(ab,()=>{resolve(true)},()=>{resolve(false)})}catch(err){resolve(false)}})};
if(window.localStorage){let tempData=localStorage.getItem(_ogg.key);if(tempData)try{tempData=JSON.parse(tempData);if(tempData.hasOwnProperty("supportOgg"))_ogg.supportOgg=tempData.supportOgg;callback(_ogg.supportOgg)}catch(error){}else checkOgg().then(res=>{localStorage.setItem(_ogg.key,JSON.stringify({supportOgg:res}));callback(res)})}else checkOgg().then(res=>{callback(res)})}initialize();Object.defineProperty(this,"gfx",{enumerable:true,"configurable":false,"value":p["gfx"]});Object.defineProperty(this,
"h264",{enumerable:true,"configurable":false,"value":p["h264"]});Object.defineProperty(this,"agentStr",{enumerable:true,"configurable":false,"value":p["agentStr"]});Object.defineProperty(this,"protocol",{enumerable:true,"configurable":false,"get":function(){return p["protocol"]}});Object.defineProperty(this,"majorVersion",{enumerable:true,"configurable":false,"value":p["majorVersion"]});Object.defineProperty(this,"isWindows",{enumerable:true,"configurable":false,"value":p["isWindows"]});Object.defineProperty(this,
"isMac",{enumerable:true,"configurable":false,"value":p["isMac"]});Object.defineProperty(this,"isIOS",{enumerable:true,"configurable":false,"value":p["isIOS"]});Object.defineProperty(this,"iosVersion",{enumerable:true,"configurable":false,"value":p["iosVersion"]});Object.defineProperty(this,"ipadModel",{enumerable:true,"configurable":false,"get":function(){return p["ipadModel"]}});Object.defineProperty(this,"iosBuildVersion",{enumerable:true,"configurable":false,"value":p["iosBuildVersion"]});Object.defineProperty(this,
"isIphone",{enumerable:true,"configurable":false,"value":p["isIphone"]});if(p["isIphone"]==true)Object.defineProperty(this,"iphoneModel",{enumerable:true,"configurable":false,"value":p["iphoneModel"]});Object.defineProperty(this,"isIpod",{enumerable:true,"configurable":false,"value":p["isIpod"]});Object.defineProperty(this,"isAndroid",{enumerable:true,"configurable":false,"value":p["isAndroid"]});Object.defineProperty(this,"isHPTablet",{enumerable:true,"configurable":false,"value":p["isHPTablet"]});
Object.defineProperty(this,"isPlaybook",{enumerable:true,"configurable":false,"value":p["isPlaybook"]});Object.defineProperty(this,"isChromeOS",{enumerable:true,"configurable":false,"value":p["isChromeOS"]});Object.defineProperty(this,"chromeOSVersion",{enumerable:true,"configurable":false,"value":p["chromeOSVersion"]});Object.defineProperty(this,"isSymbian",{enumerable:true,"configurable":false,"value":p["isSymbian"]});Object.defineProperty(this,"isFirefox",{enumerable:true,"configurable":false,
"value":p["isFirefox"]});Object.defineProperty(this,"isOpera",{enumerable:true,"configurable":false,"value":p["isOpera"]});Object.defineProperty(this,"isChrome",{enumerable:true,"configurable":false,"value":p["isChrome"]});Object.defineProperty(this,"chromeVersion",{enumerable:true,"configurable":false,"value":p["chromeVersion"]});Object.defineProperty(this,"isNokiaBrowser",{enumerable:true,"configurable":false,"value":p["isNokiaBrowser"]});Object.defineProperty(this,"isSafari",{enumerable:true,"configurable":false,
"value":p["isSafari"]});Object.defineProperty(this,"isMSIE",{enumerable:true,"configurable":false,"value":p["isMSIE"]});Object.defineProperty(this,"isYandex",{enumerable:true,"configurable":false,"value":p["isYandex"]});Object.defineProperty(this,"isDragon",{enumerable:true,"configurable":false,"value":p["isDragon"]});Object.defineProperty(this,"dragonVersion",{enumerable:true,"configurable":false,"value":p["dragonVersion"]});Object.defineProperty(this,"isChromium",{enumerable:true,"configurable":false,
"value":p["isChromium"]});Object.defineProperty(this,"msieVersion",{enumerable:true,"configurable":false,"value":p["msieVersion"]});Object.defineProperty(this,"msieOSVersion",{enumerable:true,"configurable":false,"value":p["msieOSVersion"]});Object.defineProperty(this,"msieHTMLVersion",{enumerable:true,"configurable":false,"value":p["msieHTMLVersion"]});Object.defineProperty(this,"browserName",{enumerable:true,"configurable":false,"get":getBrowserName});Object.defineProperty(this,"firefoxVersion",
{enumerable:true,"configurable":false,"value":p["firefoxVersion"]});Object.defineProperty(this,"isWindowsPhone",{enumerable:true,"configurable":false,"value":p["isWindowsPhone"]});Object.defineProperty(this,"isMobile",{enumerable:true,"configurable":false,"get":function(){return p["isMobile"]}});Object.defineProperty(this,"isTouch",{enumerable:true,"configurable":false,"get":function(){return p["isTouch"]}});Object.defineProperty(this,"getAgentKey",{enumerable:true,"configurable":false,"value":getAgentKey});
Object.defineProperty(this,"browserFromAgent",{enumerable:true,"configurable":false,"value":browserFromAgent});Object.defineProperty(this,"hasObjectURL",{enumerable:true,"configurable":false,"value":p["hasObjectURL"]});Object.defineProperty(this,"hasArrayBuffers",{enumerable:true,"configurable":false,"value":p["hasArrayBuffers"]});Object.defineProperty(this,"hasTypedArrays",{enumerable:true,"configurable":false,"value":p["hasTypedArrays"]});Object.defineProperty(this,"hasWorkers",{enumerable:true,
"configurable":false,"value":p["hasWorkers"]});Object.defineProperty(this,"hasTransferableObjects",{enumerable:true,"configurable":false,"get":function(){return getTransferableObjects()}});Object.defineProperty(this,"supportsAsmJsWorkers",{enumerable:true,"configurable":false,"get":function(){return p["supportsAsmJsWorkers"]}});Object.defineProperty(this,"supportsRFXDecoder",{enumerable:true,"configurable":false,"get":function(){return p["supportsRFXDecoder"]}});Object.defineProperty(this,"supportsFullScreen",
{enumerable:true,"configurable":false,"value":supportsFullScreen});Object.defineProperty(this,"addAsyncDetectionCallback",{enumerable:true,"configurable":false,"value":addAsyncDetectionCallback});Object.defineProperty(this,"runAsyncDetections",{enumerable:true,"configurable":false,"value":runAsyncDetections});Object.defineProperty(this,"supportHTML5",{enumerable:true,"configurable":false,"get":function(){return supportHTML5()}});Object.defineProperty(this,"supportAudioAutoPlay",{enumerable:true,"configurable":false,
"get":function(){return apaSupported}});Object.defineProperty(this,"detectTouch",{enumerable:true,"configurable":false,writable:false,"value":detectTouch});Object.defineProperty(this,"isTabletMode",{enumerable:true,"configurable":false,"get":function(){return p["isTabletMode"]}});Object.defineProperty(this,"timeZone",{enumerable:true,"configurable":false,"get":function(){return p["timeZone"]}});Object.defineProperty(this,"compareVersions",{enumerable:true,"configurable":false,"value":compareVersions});
Object.defineProperty(this,"isOlderThan",{enumerable:true,"configurable":false,"value":isOlderThan});Object.defineProperty(this,"isNewerThan",{enumerable:true,"configurable":false,"value":isNewerThan});Object.defineProperty(this,"isSameVersion",{enumerable:true,"configurable":false,"value":isSameVersion});Object.defineProperty(this,"supportOggFormat",{enumerable:true,"configurable":false,"value":supportOggFormat});Object.defineProperty(this,"__setInitializationData__",{enumerable:true,"configurable":false,
"writable":false,"value":setInitializationData});return this}var agentInfo=null;try{agentInfo=new AgentInfo}catch(error){}if(typeof agentInfo=="undefined"||agentInfo==null){agentInfo=new Object;agentInfo["supportHTML5"]=false}
function Helper(){var GLOBAL_VAR={console:{logDebug:false,logWarning:true,logInfo:true,logError:true,logException:true,logFatal:true},"class":{"name":"help","privateREF#":null,"ref#":null}};var _plugins={};function initialize(assignElem){try{if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+GLOBAL_VAR["class"]["name"]+" class. - "+(new Date).toString());GLOBAL_VAR["class"]["privateREF#"]=assignElem;var ajax=new Ajax;var color=
new Color;var console=new Console;var dom=new Dom;var object=new ObjectExtend;var datetime=new Datetime;var dictionary=new Dictionary;var polyfills=new Polyfills;var printObject=new Printer;var size=new Size;var storage=new Storage;var string=new StringExtend;var style=new Style;var url=new URL;var utils=new Utils;new WebSocketObject(assignElem);Object.defineProperty(assignElem,"ajax",{"enumerable":true,"configurable":false,"get":function(){return ajax}});Object.defineProperty(assignElem,"color",
{"enumerable":true,"configurable":false,"get":function(){return color}});Object.defineProperty(assignElem,"console",{"enumerable":true,"configurable":false,"get":function(){return console}});Object.defineProperty(assignElem,"dom",{"enumerable":true,"configurable":false,"get":function(){return dom}});Object.defineProperty(assignElem,"object",{"enumerable":true,"configurable":false,"get":function(){return object}});Object.defineProperty(assignElem,"datetime",{"enumerable":true,"configurable":false,
"get":function(){return datetime}});Object.defineProperty(assignElem,"dictionary",{"enumerable":true,"configurable":false,"get":function(){return dictionary}});Object.defineProperty(assignElem,"printer",{"enumerable":true,"configurable":false,"get":function(){return printObject}});Object.defineProperty(assignElem,"url",{"enumerable":true,"configurable":false,"get":function(){return url}});Object.defineProperty(assignElem,"size",{"enumerable":true,"configurable":false,"get":function(){return size}});
Object.defineProperty(assignElem,"storage",{"enumerable":true,"configurable":false,"get":function(){return storage}});Object.defineProperty(assignElem,"string",{"enumerable":true,"configurable":false,"get":function(){return string}});Object.defineProperty(assignElem,"style",{"enumerable":true,"configurable":false,"get":function(){return style}});Object.defineProperty(assignElem,"utils",{"enumerable":true,"configurable":false,"get":function(){return utils}});Object.defineProperty(assignElem,"registerPlugin",
{"enumerable":true,"configurable":false,"writable":false,"value":registerPlugin});Object.defineProperty(assignElem,"unregisterPlugin",{"enumerable":true,"configurable":false,"writable":false,"value":unregisterPlugin});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log(GLOBAL_VAR["class"]["name"]+" class was Initialized. - "+(new Date).toString())}catch(error){genericLog(error,arguments)}}function getFunctionName(args){try{var fName="";if(args!=
null&&args!=undefined&&args.callee!=undefined){var calleeName=args.callee&&args.callee.name?args.callee.name:"[anonymous]";var callerName=args.callee&&args.callee.caller&&args.callee.caller.name?args.callee.caller.name:"[anonymous]";fName=calleeName+" from "+callerName}return fName}catch(error){return"[unknown]"}}function genericLog(error){if(typeof window["console"]!="undefined"){function convertMessageToString(message){try{var retMsg=GLOBAL_VAR["class"]["privateREF#"]["datetime"].getFormattedDatetime(new Date)+
" - ";if(message!=undefined&&message!=null){if(message.Message!=undefined)retMsg+=" Message: "+message.Message;else if(message.message!=undefined)retMsg+=" Message: "+message.message;if(message.Stack!=undefined)retMsg+=" Stack: "+message.Stack;else if(message.stack!=undefined)retMsg+=" Stack: "+message.stack;if(message.Description!=undefined)retMsg+=" Description: "+message.Description;else if(message.description!=undefined)retMsg+=" Description: "+message.description;else if(typeof message=="string")retMsg+=
" "+message}}catch(error){if(typeof window.agentInfo!="undefined"&&agentInfo.supportHTML5)return message&&typeof message.message!="undefined"?message.message:message.toString();else;}return retMsg}if(window["console"].hasOwnProperty("error"))window.console.error(convertMessageToString(error));else if(window["console"].hasOwnProperty("warn"))window.console.warn(convertMessageToString(error));else if(window["console"].hasOwnProperty("log"))window.console.log(convertMessageToString(error))}}function registerPlugin(name,
plugin){if(name&&name!=""&&_plugins[name]==undefined){for(var n in GLOBAL_VAR["class"]["privateREF#"])if(n.toLowerCase()==name.toLowerCase())return false;_plugins[name]=new plugin;Object.defineProperty(GLOBAL_VAR["class"]["privateREF#"],name,{"enumerable":true,"configurable":false,"get":function(){return _plugins[name]}});return true}else return false}function unregisterPlugin(name,plugin){if(name&&name!=""&&_plugins[name]!=undefined){delete _plugins[name];delete GLOBAL_VAR["class"]["privateREF#"][name];
return true}else return false}function Ajax(){var _className=getFunctionName(arguments);var _headers={};var _responseTypes=Object.freeze({"BLANK":"","TEXT":"text","ARRAYBUFFER":"arraybuffer","BLOB":"blob","DOCUMENT":"document","JSON":"json","MSSTREAM":"ms-stream"});var _HTTPStatusCodeDescription=Object.freeze({400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",
409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",419:"Page Expired",420:"Method Failure",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Reserved for WebDAV",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",430:"Request Header Fields Too Large",431:"Request Header Fields Too Large",
440:"Login Time-out",444:"No Response",449:"Retry With",450:"Blocked by Windows Parental Controls",451:"Unavailable For Legal Reasons",494:"Request header too large",495:"SSL Certificate Error",496:"SSL Certificate Required",497:"HTTP Request Sent to HTTPS Port",498:"Invalid Token",499:"Client Closed Request",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",
508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required",520:"Web Server Returned an Unknown Error",521:"Web Server Is Down",522:"Connection Timed Out",523:"Origin Is Unreachable",524:"A Timeout Occurred",525:"SSL Handshake Failed",526:"Invalid SSL Certificate",527:"Railgun Error",561:"Unauthorized"});var _default={"async":true,"type":_responseTypes.BLANK,"timeout":3E4,"credentials":false};var _queues={};var states={"READY":0,"SETUP":1,"SENT":2,"PROCESS":3,
"COMPLETED":4};var _rePP=RegExp(/\?|&/);var _normalizeResponse=agentInfo.isMSIE&&agentInfo.msieVersion<12;function addHeaderValue(header,value){_headers[header]=value}function removeHeaderValue(header){delete _headers[header]}function shiftQueue(qname){if(qname&&_queues[qname]){_queues[qname].shift();setTimeout(execXMLHttpRequest,1,qname)}}function normalizeResponse(callback){if(callback)return function(response,status,xmlhttp){try{if(typeof response!=="object")callback(JSON.parse(response),status,
xmlhttp);else callback(response,status,xmlhttp)}catch(error){if(xmlhttp.error)xmlhttp.error(error.message,xmlhttp)}};else return undefined}function xmlHttpRequest(method,jData){var xmlhttp=new XMLHttpRequest;var responseType="";var async=typeof jData.async!="undefined"?jData.async:_default.async;if(async!==false)responseType=(jData.dataType||jData.type||jData.responseType||_default.type).toLowerCase();var qname=typeof jData.queueName!="undefined"?jData.queueName:null;xmlhttp.withCredentials=typeof jData.withCredentials!=
"undefined"?jData.withCredentials:_default.credentials;var url=jData.url;xmlhttp.success=_normalizeResponse&&responseType===_responseTypes.JSON?normalizeResponse(jData.success):jData.success;xmlhttp.error=jData.error;xmlhttp.abort=jData.abort;xmlhttp.readystatechange=jData.readystatechange;xmlhttp.onreadystatechange=function(e){var evt=e.target;if(evt.readyState===states.COMPLETED)if(evt.status===200){shiftQueue(evt.queuename);clearTimeout(xmlhttp.timeoutId);delete xmlhttp.timeoutId;if(!evt.aborted)if(xmlhttp.success)xmlhttp.success(evt.response,
evt.status,xmlhttp)}else{shiftQueue(evt.queuename);clearTimeout(xmlhttp.timeoutId);delete xmlhttp.timeoutId;var err={};try{err.message=evt.response?evt.response.error.message:evt.responseText}catch(error){}err.message=err.message||_HTTPStatusCodeDescription[evt.status]||"Unknown error";if(!evt.aborted&&xmlhttp.error)xmlhttp.error(err,evt.status,xmlhttp);else if(evt.aborted)if(xmlhttp.abort)xmlhttp.abort(err,evt.status,xmlhttp);else if(xmlhttp.error)xmlhttp.error(err,evt.status,xmlhttp)}if(xmlhttp.readystatechange)xmlhttp.readystatechange(evt.readyState,
evt.status,xmlhttp)};xmlhttp.params={"async":async,"method":method,"url":url,"contentType":jData.contentType,"data":jData.data,"timeout":typeof jData.timeout!="undefined"?jData.timeout:_default.timeout,"responseType":responseType,"noHeaders":jData.noHeaders,"beforeSend":jData.beforeSend};try{if(qname){if(!_queues[qname])_queues[qname]=[];xmlhttp.queuename=qname;_queues[qname].push({"xmlhttp":xmlhttp});execXMLHttpRequest(qname)}else executeXMLHttpRequest(xmlhttp)}catch(error){if(jData.error)jData.error(error,
-1,xmlhttp);return xmlhttp}return xmlhttp}function execXMLHttpRequest(qname){if(_queues[qname]&&_queues[qname].length>0){var xmlhttp=_queues[qname][0].xmlhttp;if(xmlhttp.readyState===states.READY)executeXMLHttpRequest(xmlhttp)}}function executeXMLHttpRequest(xmlhttp){var params=xmlhttp.params;xmlhttp.open(params.method,params.url,params.async);if(params.async){xmlhttp.responseType=params.responseType;if(params.timeout>0){xmlhttp.timeout=params.timeout;xmlhttp.timeoutId=setTimeout(function(){if(!xmlhttp.aborted){xmlhttp.aborted=
true;if(xmlhttp.abort)xmlhttp.abort()}},params.timeout);params.timeout=null}}var data=typeof params.data!="undefined"?params.data:null;if(params.method==="POST"){var contentType=null;if(params.contentType)contentType=params.contentType;else if(data!==null&&!(data instanceof FormData))if(GLOBAL_VAR["class"]["privateREF#"].object.getDataTypeOf(data)=="json")contentType="application/json";else contentType="application/x-www-form-urlencoded; charset=UTF-8";if(contentType!=null){xmlhttp.setRequestHeader("Content-Type",
contentType);if(contentType=="application/json"&&data!=null&&typeof data=="object")data=JSON.stringify(data)}}if(params.noHeaders!==true)for(var header in _headers)xmlhttp.setRequestHeader(header,_headers[header]);if(params.beforeSend&&params.beforeSend instanceof Function)params.beforeSend(xmlhttp);if(data!=null)xmlhttp.send(data);else xmlhttp.send()}function jsonP(jData){var script=document.createElement("script");script.async=true;script.defer=true;script.type="text/javascript";if(jData.charset)script.charset=
jData.charset;script.onload=function(e){if(jData.success)jData.success(e)};script.error=jData.error}function get(jData){return xmlHttpRequest("GET",jData)}function post(jData){return xmlHttpRequest("POST",jData)}function releaseQueue(queueName){if(_queues[queueName]&&_queues[queueName].length>0)_queues[queueName].forEach(function(elem){elem.xmlhttp.aborted=true;if(elem.xmlhttp.abort)elem.xmlhttp.abort()})}Object.defineProperty(this,"addHeaderValue",{"enumerable":true,"configurable":false,"writable":false,
"value":addHeaderValue});Object.defineProperty(this,"removeHeaderValue",{"enumerable":true,"configurable":false,"writable":false,"value":removeHeaderValue});Object.defineProperty(this,"jsonP",{"enumerable":true,"configurable":false,"writable":false,"value":jsonP});Object.defineProperty(this,"get",{"enumerable":true,"configurable":false,"writable":false,"value":get});Object.defineProperty(this,"post",{"enumerable":true,"configurable":false,"writable":false,"value":post});Object.defineProperty(this,
"releaseQueue",{"enumerable":true,"configurable":false,"writable":false,"value":releaseQueue});Object.defineProperty(this,"queueLength",{"enumerable":true,"configurable":false,"writable":false,"value":function(queueName){return _queues[queueName]?_queues[queueName].length:0}});Object.defineProperty(this,"responseType",{"enumerable":true,"configurable":false,"get":function(){return _responseTypes}});Object.defineProperty(this,"httpStatusCodeDescription",{"enumerable":true,"configurable":false,"get":function(){return _HTTPStatusCodeDescription}});
if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Color(){var _className=getFunctionName(arguments);var COLOR_LIGHT_BOTTOMLIMIT=144;function getRGBStruct(r,g,b,a){var aux=GLOBAL_VAR["class"]["privateREF#"]["string"].sprintf('{ "r": %s, "g": %s, "b": %s, "a": %s }',Math.round(r||0),Math.round(g||0),Math.round(b||0),a||1);return JSON.parse(aux)}function toRGB(color){if(typeof color==
"object"&&typeof color.r!="undefined"&&typeof color.g!="undefined"&&color.b!="undefined"){if(typeof color.a=="undefined")color.a=1;return color}var rgba=getRGBStruct();if(/^#[A-Fa-f0-9]{3}$/.test(color)){rgba.r=parseInt(color.substr(1,1),16);rgba.g=parseInt(color.substr(2,1),16);rgba.b=parseInt(color.substr(3,1),16)}else if(/^#[A-Fa-f0-9]{6}$/.test(color)){rgba.r=parseInt(color.substr(1,2),16);rgba.g=parseInt(color.substr(3,2),16);rgba.b=parseInt(color.substr(5,2),16)}else{var res=/rgba?\((\d+), ?(\d+), ?(\d+)(, ?(\.?\d+))?\)/.exec(color);
if(res!=null){rgba.r=parseInt(res[1],10);rgba.g=parseInt(res[2],10);rgba.b=parseInt(res[3],10);if(res.length==6)rgba.a=parseFloat(res[5])}}if(isNaN(rgba.a))rgba.a=1;return rgba}function averageColor(col1,col2){var RGB1=toRGB(col1);var RGB2=toRGB(col2);var rgba=getRGBStruct((RGB1.r+RGB2.r)/2,(RGB1.g+RGB2.g)/2,(RGB1.b+RGB2.b)/2,(RGB1.a+RGB2.a)/2);return toHexColor(rgba)}function toHexColor(){var toHex=function(n){return("0"+n.toString(16)).substr(-2)};if(arguments[0]instanceof Object){var c=arguments[0];
return"#"+toHex(c.r)+toHex(c.g)+toHex(c.b)}else if(arguments.length>2)return"#"+toHex(arguments[0])+toHex(arguments[1])+toHex(arguments[2]);else if(arguments.length===1){var c=toRGB(arguments[0]);return"#"+toHex(c.r)+toHex(c.g)+toHex(c.b)}return"#000"}function shift(color,shiftValue){var rgb=toRGB(color);if(shiftValue==1)return{"r":rgb.g,"g":rgb.b,"b":rgb.r};else return{"r":rgb.b,"g":rgb.r,"b":rgb.g}}function combine(mode,col1,col2){var RGB1=toRGB(col1);var RGB2=toRGB(col2);var rgba=getRGBStruct((RGB1.r+
RGB2.r)%256,(RGB1.g+RGB2.g)%256,(RGB1.b+RGB2.b)%256,(RGB1.a+RGB2.a)/2);return toHexColor(rgba)}function getTextColor(color){var rgb=toRGB(color);var avg=(rgb.r+rgb.g+rgb.b)/3;return avg>COLOR_LIGHT_BOTTOMLIMIT||Math.max(rgb.r,Math.max(rgb.g*1.8,rgb.b))>COLOR_LIGHT_BOTTOMLIMIT&&avg>COLOR_LIGHT_BOTTOMLIMIT?"#000000":"#fcfcfc"}function isLightColor(color){var rgb=toRGB(color);helper.console.log(JSON.stringify(rgb));return(rgb.r+rgb.g|+rgb.b)/3>COLOR_LIGHT_BOTTOMLIMIT}Object.defineProperty(this,"toRGB",
{"enumerable":true,"configurable":false,"writable":false,"value":toRGB});Object.defineProperty(this,"toHexColor",{"enumerable":true,"configurable":false,"writable":false,"value":toHexColor});Object.defineProperty(this,"averageColor",{"enumerable":true,"configurable":false,"writable":false,"value":averageColor});Object.defineProperty(this,"shift",{"enumerable":true,"configurable":false,"writable":false,"value":shift});Object.defineProperty(this,"combine",{"enumerable":true,"configurable":false,"writable":false,
"value":combine});Object.defineProperty(this,"getTextColor",{"enumerable":true,"configurable":false,"writable":false,"value":getTextColor});Object.defineProperty(this,"isLightColor",{"enumerable":true,"configurable":false,"writable":false,"value":isLightColor});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Console(){var LOCAL_VAR={"class":{"name":"console"},
"console":{"log":null,"error":null,"info":null,"warn":null,"exception":null,"fatal":null},"msgLogAvailable":null,"msgLogger":null,"logConsole":null,"preserveLog":{"log":[],"available":false},"externalLog":false};try{function initialize(){try{if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+LOCAL_VAR["class"]["name"]+" class. - "+(new Date).toString());if(typeof Thinfinity!=="undefined"&&typeof Thinfinity.LogConsole!="undefined")LOCAL_VAR.logConsole=
Thinfinity.LogConsole;if(typeof MsgLogger!="undefined"){LOCAL_VAR.msgLogAvailable=true;LOCAL_VAR.msgLogger=new MsgLogger}else LOCAL_VAR.msgLogAvailable=false;for(var collection in LOCAL_VAR.console)LOCAL_VAR.console[collection]=window.console[collection]!==undefined?collection:LOCAL_VAR.console.log!=null?LOCAL_VAR.console.log:"alert";if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log(LOCAL_VAR["class"]["name"]+" class was Initialized. - "+
(new Date).toString())}catch(error){genericLog(error,arguments)}}function getISOTime(){var now=new Date;if(typeof now.toISOString!="undefined"){var ret=now.toISOString();ret=ret.substr(ret.indexOf("T")+1,12);return ret}else return("0"+now.getUTCHours()).substr(-2)+":"+("0"+now.getUTCMinutes()).substr(-2)+":"+("0"+now.getUTCSeconds()).substr(-2)+"."+now.getUTCMilliseconds()}function remoteLog(value){LOCAL_VAR.externalLog=value}function log(message,args,collection,exceptionStack){try{var isLocal=arguments.length>=
5;var fnName=getFunctionName(args);if(fnName!="")fnName="Caller: "+fnName+" - ";var msg=getISOTime()+": ";if(message!=undefined&&message!=null){if(message.message!=undefined)msg+=" Message: "+message.message;else if(message.Message!=undefined)msg+=" Message: "+message.Message;if(message.stack!=undefined)msg+=" Stack: "+message.stack;else if(message.Stack!=undefined)msg+=" Stack: "+message.Stack;if(message.description!=undefined)msg+=" Description: "+message.description;else if(message.Description!=
undefined)msg+=" Description: "+message.Description;else if(typeof message=="string")msg+=" "+message}if(exceptionStack!=undefined&&exceptionStack!=null){if(exceptionStack.message!=undefined)msg+=" Message: "+exceptionStack.message;else if(exceptionStack.Message!=undefined)msg+=" Message: "+exceptionStack.Message;if(exceptionStack.stack!=undefined)msg+=" Stack: "+exceptionStack.stack;else if(exceptionStack.Stack!=undefined)msg+=" Stack: "+exceptionStack.Stack;if(exceptionStack.description!=undefined)msg+=
" Description: "+exceptionStack.description;else if(exceptionStack.Description!=undefined)msg+=" Description: "+exceptionStack.Description}if(LOCAL_VAR.console[collection]!="alert"){if(LOCAL_VAR["preserveLog"]["available"]==true)LOCAL_VAR["preserveLog"]["log"].push({"fName":fnName,"msg":msg,"collection":collection});window.console[LOCAL_VAR.console[collection]](fnName+msg)}else if(collection=="error"||collection=="exception"||collection=="fatal")alert(fnName+msg);if(LOCAL_VAR.logConsole)LOCAL_VAR.logConsole.send(collection,
fnName,msg,exceptionStack);if(!isLocal&&LOCAL_VAR.externalLog==true&&LOCAL_VAR.msgLogAvailable)switch(collection){case "error":case "exception":case "fatal":msgLogError(fnName+msg,collection);break;default:msgLogDebug(fnName+msg,collection);break}}catch(error){genericLog(error,arguments)}}function msgLogDebug(value,extraClass){try{var addISOTime=arguments.length>1&&arguments[1];if(addISOTime)value=getISOTime()+": "+value;if(LOCAL_VAR.msgLogAvailable)LOCAL_VAR.msgLogger.log(value,extraClass);else log(value,
null,"log",null,null)}catch(error){genericLog(error,arguments)}}function msgLogError(value,extraClass){try{var addISOTime=arguments.length>1&&arguments[1];if(addISOTime)value=getISOTime()+": "+value;if(LOCAL_VAR.msgLogAvailable)LOCAL_VAR.msgLogger.log("ERROR: "+value,extraClass);else{log(value,null,"error",null,null);return value}}catch(error){genericLog(error,arguments)}}function switchLogStatus(logsName,enabled){var response=true;try{logsName=logsName.toString().toLowerCase();if(logsName.indexOf("debug")!=
-1)GLOBAL_VAR["console"]["logDebug"]=enabled;if(logsName.indexOf("log")!=-1)GLOBAL_VAR["console"]["logDebug"]=enabled;if(logsName.indexOf("info")!=-1)GLOBAL_VAR["console"]["logInfo"]=enabled;if(logsName.indexOf("warning")!=-1)GLOBAL_VAR["console"]["logWarning"]=enabled;if(logsName.indexOf("warn")!=-1)GLOBAL_VAR["console"]["logWarning"]=enabled;if(logsName.indexOf("error")!=-1)GLOBAL_VAR["console"]["logError"]=enabled;if(logsName.indexOf("fatal")!=-1)GLOBAL_VAR["console"]["logFatal"]=enabled;if(logsName.indexOf("exception")!=
-1)GLOBAL_VAR["console"]["logException"]=enabled;if(logsName.indexOf("ex")!=-1)GLOBAL_VAR["console"]["logException"]=enabled}catch(error){response=false}return response}initialize();Object.defineProperty(this,"debug",{"enumerable":false,"configurable":false,"value":function(message,args){if(GLOBAL_VAR.console.logDebug)log(message,args,"log")}});Object.defineProperty(this,"log",{"enumerable":false,"configurable":false,"value":function(message,args){if(GLOBAL_VAR.console.logDebug)log(message,args,"log")}});
Object.defineProperty(this,"warning",{"enumerable":false,"configurable":false,"value":function(warn,args){if(GLOBAL_VAR.console.logWarning)log(warn,args,"warn")}});Object.defineProperty(this,"warn",{"enumerable":false,"configurable":false,"value":function(warn,args){if(GLOBAL_VAR.console.logWarning)log(warn,args,"warn")}});Object.defineProperty(this,"error",{"enumerable":false,"configurable":false,"value":function(message,exception,args){if(GLOBAL_VAR.console.logError)log(message,args,"error",exception)}});
Object.defineProperty(this,"fatal",{"enumerable":false,"configurable":false,"value":function(message,exception,args){if(GLOBAL_VAR.console.logFatal)log(message,args,"fatal",exception)}});Object.defineProperty(this,"exception",{"enumerable":false,"configurable":false,"value":function(message,exception,args){if(GLOBAL_VAR.console.logException)log(exception,args,"exception",exception)}});Object.defineProperty(this,"info",{"enumerable":false,"configurable":false,"value":function(info,args){if(GLOBAL_VAR.console.logInfo)log(info,
args,"info")}});Object.defineProperty(this,"msgDebug",{"enumerable":false,"configurable":false,"value":function(value){if(GLOBAL_VAR.console.logDebug)msgLogDebug(value)}});Object.defineProperty(this,"msgError",{"enumerable":false,"configurable":false,"value":function(value){if(GLOBAL_VAR.console.logError)msgLogDebug(value)}});genericLog=this.error;Object.defineProperty(this,"on",{"enumerable":false,"configurable":false,"value":function(logsName){switchLogStatus(logsName,true)}});Object.defineProperty(this,
"off",{"enumerable":false,"configurable":false,"value":function(logsName){switchLogStatus(logsName,false)}});Object.defineProperty(this,"remoteLog",{"enumerable":false,"configurable":false,"get":function(){return LOCAL_VAR.externalLog},"set":function(value){LOCAL_VAR.externalLog=value}});Object.defineProperty(this,"getLog",{"enumerable":true,"configurable":false,"value":function(){return LOCAL_VAR["preserveLog"]["log"]}});Object.defineProperty(this,"preserveLog",{"enumerable":true,"configurable":false,
"get":function(){return LOCAL_VAR["preserveLog"]["available"]},"set":function(value){return LOCAL_VAR["preserveLog"]["available"]=value}});return this}catch(error){genericLog(error,arguments)}}function Datetime(){var _className=getFunctionName(arguments);function getFormattedDatetime(datetime){return datetimeToString(datetime,"yyyy/mm/dd HH:MM:ss.f")}function getFormattedDate(datetime){return datetimeToString(datetime,"yyyy/mm/dd")}function getFormattedTime(datetime){return datetimeToString(datetime,
"HH:MM:ss")}function getDatetime(datetime,format){return datetimeToString(datetime,format)}function datetimeToString(datetime,format,utc){try{var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[FfoSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val};
return function(date,mask,utc){var dF=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(date)=="[object String]"&&!/\d/.test(date)){mask=date;date=undefined}if(!date instanceof Date)date=new Date;if(isNaN(date))throw SyntaxError("invalid date");mask=String(dF.masks[mask]||mask||dF.masks["default"]);if(mask.slice(0,4)=="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+
"Minutes"](),s=date[_+"Seconds"](),F=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),f:pad(F,3),F:pad(F>99?Math.round(F/10):F),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,
""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",
isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return dateFormat(datetime,format,utc)}catch(Error){return Error}}function zeropad(n){return String("00"+n).slice(-2)}
function completeTimeToString(datetime){try{var d=new Date;d.setTime(datetime);s=zeropad(d.getMonth()+1)+"/"+zeropad(d.getDate())+" "+d.getHours()+":"+zeropad(d.getMinutes());return s}catch(error){return error}}Object.defineProperty(this,"getFormattedDatetime",{"enumerable":true,"configurable":false,"writable":false,"value":getFormattedDatetime});Object.defineProperty(this,"getFormattedDate",{"enumerable":true,"configurable":false,"writable":false,"value":getFormattedDate});Object.defineProperty(this,
"getFormattedTime",{"enumerable":true,"configurable":false,"writable":false,"value":getFormattedTime});Object.defineProperty(this,"getDatetime",{"enumerable":true,"configurable":false,"writable":false,"value":getDatetime});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Dictionary(){var _className=getFunctionName(arguments);var _defaultDictionaries=null;
var _defaultDictionariesIgnoreCase=null;var _ignoreCase=false;function defaultDictionaries(dictionaries){_defaultDictionaries=[];_defaultDictionariesIgnoreCase=[];if(dictionaries)for(var i=0;i<dictionaries.length;i++){var _dic={};for(var key in dictionaries[i])_dic[key.toLowerCase()]=dictionaries[i][key];_defaultDictionaries.push(dictionaries[i]);_defaultDictionariesIgnoreCase.push(_dic)}}function getValue(key,dictionaries){if(key){if(dictionaries)for(var i=0;i<dictionaries.length;i++)if(dictionaries[i])if(dictionaries[i].hasOwnProperty(key))return dictionaries[i][key];
else if(_ignoreCase)for(var _key in dictionaries[i])if(_key.toLowerCase()==key.toLowerCase())return dictionaries[i][_key];if(_defaultDictionaries)for(var i=0;i<_defaultDictionaries.length;i++)if(_defaultDictionaries[i].hasOwnProperty(key))return _defaultDictionaries[i][key];else if(_ignoreCase&&_defaultDictionariesIgnoreCase[i].hasOwnProperty(key.toLowerCase()))return _defaultDictionariesIgnoreCase[i][key.toLowerCase()];return""}else return""}Object.defineProperty(this,"items",{"enumerable":true,
"configurable":false,"set":function(dictionaries){defaultDictionaries(dictionaries)}});Object.defineProperty(this,"ignoreCase",{"enumerable":true,"configurable":false,"set":function(value){_ignoreCase=value}});Object.defineProperty(this,"getValue",{"enumerable":true,"configurable":false,"writable":false,"value":getValue});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}
function Dom(){var _className=getFunctionName(arguments);var _useOn=document.addEventListener==undefined;var _domStateEvents={"order":["loading","interactive","complete"],"lastState":-1,"handlers":{"loading":[],"interactive":[],"complete":[]}};var _shortcutTrim=null;function byId(id){return document.getElementById(id)}function setContent(elem,content){switch(elem.nodeName){case "DIV":case "SPAN":case "P":case "LABEL":case "LI":case "A":case "OPTION":case "BUTTON":elem.innerHTML=content;break;case "INPUT":case "CHECKBOX":case "RADIO":elem.value=
content;break;default:elem.nodeName=="OPTION"||typeof elem.value=="undefined"?elem.innerHTML=content:elem.value=content;break}}function createJsonElement(json){if(_shortcutTrim==null)_shortcutTrim=GLOBAL_VAR["class"]["privateREF#"].string.trim;var elem=document.createElement(json["type"]);if(json["attributes"])for(var attr in json["attributes"])if(["innerHTML","innerText"].indexOf(attr)==-1&&(attr=="class"||typeof elem[attr]!="undefined"||json.type==="label"&&attr==="for"))if(attr==="style"){var s=
json["attributes"][attr].replace(/ /g,"").split(";");s.forEach(function(item){var kvp=item.split(":");elem.style[kvp[0]]=kvp[1]})}else elem.setAttribute(attr,json["attributes"][attr]);else elem[attr]=json["attributes"][attr];var content=json["content"];if(typeof content!=="undefined"){var regExp=new RegExp("HTML{1}[a-zA-Z]*Element{1}");var type=GLOBAL_VAR["class"]["privateREF#"].object.getTypeOf(content);if(content instanceof HTMLElement||regExp.exec(type)!=null&&regExp.exec(type).length>0)elem.appendChild(content);
else setContent(elem,content)}var events=json["events"];for(var eventName in events){var _handler=typeof events[eventName]==="function"?events[eventName]:events[eventName]&&typeof events[eventName].handler==="function"?events[eventName].handler:null;var _evtAttr=typeof events[eventName]==="object"&&events[eventName]&&events[eventName].options?events[eventName].options:false;addEvent(elem,eventName,_handler,_evtAttr)}if(json["style"])GLOBAL_VAR["class"]["privateREF#"]["style"].add(elem,json["style"]);
return elem}function appendJsonElement(json){var elem=createJsonElement(json);if(json["parentElement"])json["parentElement"].appendChild(elem);return elem}function prependJsonElement(json){var elem=createJsonElement(json);if(json["parentElement"])json["parentElement"].insertBefore(elem,json["parentElement"].firstChild);return elem}function createElement(type,attributesCollection,content,events){if(GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(type)=="object")return createJsonElement(type);
else{var elem=document.createElement(type);if(attributesCollection)for(var a in attributesCollection)elem.setAttribute(a,attributesCollection[a]);if(content)if(GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(content)=="object")elem.appendChild(content);else elem.innerHTML=content;if(events)for(var eventName in events)addEvent(elem,eventName,events[eventName]);return elem}}function appendElement(parentElement,type,attributesCollection,content,events){if((typeof parentElement=="undefined"||typeof parentElement.nodeType==
"undefined")&&GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(parentElement)=="object")return appendJsonElement(parentElement);else{var elem=createElement(type,attributesCollection,content,events);parentElement.appendChild(elem);return elem}}function prependElement(parentElement,type,attributesCollection,content,events){if((typeof parentElement=="undefined"||typeof parentElement.nodeType=="undefined")&&GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(parentElement)=="object")return prependJsonElement(parentElement);
else{var elem=createElement(type,attributesCollection,content,events);parentElement.insertBefore(elem,parentElement.firstChild);return elem}}function addEvent(element,events,delegHandler,evtAttr){if(element){if(!(events instanceof Array))events=events.split(",");events=normalizeEventsName(events);var _addEvent=function(elem){if(typeof elem==="string")elem=document.getElementById(elem);if(elem)events.forEach(function(eventName){if(elem.addEventListener!=undefined)elem.addEventListener(eventName,delegHandler,
evtAttr||false);else elem.attachEvent(eventName,delegHandler,evtAttr||false)})};if(element instanceof Array||element instanceof NodeList)for(var i=0,t=element.length;i<t;i++)_addEvent(element[i]);else _addEvent(element)}}function removeEvent(element,events,delegHandler,evtAttr){if(element){if(!(events instanceof Array))events=[events];events=normalizeEventsName(events);var _removeEvent=function(elem){if(typeof elem==="string")elem=document.getElementById(elem);if(elem)events.forEach(function(eventName){if(elem.removeEventListener!=
undefined)elem.removeEventListener(eventName,delegHandler,evtAttr||false);else elem.detachEvent(eventName,delegHandler,evtAttr||false)})};if(element instanceof Array||element instanceof NodeList)for(var i=0,t=element.length;i<t;i++)_removeEvent(element[i]);else _removeEvent(element)}}function triggerEvent(element,event,args){var customEvent=null;event=normalizeEventName(event);if(window.CustomEvent)try{element.dispatchEvent(new window.CustomEvent(event,args))}catch(e){GLOBAL_VAR["class"]["privateREF#"]["console"].error(e.message,
e,arguments)}else{customEvent=document.createEventObject();customEvent.eventType=event;element.fireEvent(event,customEvent)}customEvent=null;return element}function normalizeEventsName(events){for(var i=0,t=events.length;i<t;i++)events[i]=normalizeEventName(events[i]);return events}function normalizeEventName(event){event=event.trim();var hasOn=event.substr(0,2)=="on";if(_useOn&&!hasOn)event="on"+event;else if(hasOn&&!_useOn)event=event.substring(2,event.length);hasOn=null;return event}window.document.onreadystatechange=
function(){var rn=document.readyState;var rs=convertStateToInt(rn);if(_domStateEvents.lastState<rs)for(var i=0;i<rs;i++)fireStateEvent(_domStateEvents.order[i]);_domStateEvents.lastState=rs;fireStateEvent(rn)};function convertStateToInt(rs){return _domStateEvents.order.indexOf(rs)}function documentLoading(callback){var en="loading";_domStateEvents.handlers[en].push(callback);checkDocumenEvent(en)}function documentInteractive(callback){var en="interactive";_domStateEvents.handlers[en].push(callback);
checkDocumenEvent(en)}function documentComplete(callback){var en="complete";_domStateEvents.handlers[en].push(callback);checkDocumenEvent(en)}function checkDocumenEvent(rs){if(convertStateToInt(rs)<=_domStateEvents.lastState)fireStateEvent(rs)}function fireStateEvent(name){if(_domStateEvents.handlers[name].length>0)while(_domStateEvents.handlers[name].length>0)try{_domStateEvents.handlers[name].shift()({"current":document.readyState,"eventName":name})}catch(error){if(GLOBAL_VAR.console.logError)console.log(error.message+
"\r\n"+error.stack)}}function loadScript(url,success,error){var script=document.createElement("script");script.type="text/javascript";script.onload=success;script.onerror=error;script.src=url;document.head.appendChild(script)}function loadFile(url){return new Promise(function(resolve,reject){var script=document.createElement("script");script.type="text/javascript";script.onload=resolve;script.onerror=reject;script.src=url;document.head.appendChild(script)})}function fillElements(elems){if(elems){var elem=
null,name=null;for(var kvp in elems){name=elems[kvp];if(!name||name==="")name=kvp;elem=document.getElementById(name);if(!elem){elem=document.getElementsByClassName(name);if(elem.length>0)elem=elem[0]}elems[kvp]=elem}}}function decodeText(value){var _auxTextArea=document.createElement("textarea");_auxTextArea.innerHTML=value;return _auxTextArea.value}Object.defineProperty(this,"byId",{"enumerable":false,"configurable":false,"writable":false,"value":byId});Object.defineProperty(this,"createElement",
{"enumerable":false,"configurable":false,"writable":false,"value":createElement});Object.defineProperty(this,"appendElement",{"enumerable":false,"configurable":false,"writable":false,"value":appendElement});Object.defineProperty(this,"prependElement",{"enumerable":false,"configurable":false,"writable":false,"value":prependElement});Object.defineProperty(this,"addEvent",{"enumerable":false,"configurable":false,"writable":false,"value":addEvent});Object.defineProperty(this,"removeEvent",{"enumerable":false,
"configurable":false,"writable":false,"value":removeEvent});Object.defineProperty(this,"triggerEvent",{"enumerable":false,"configurable":false,"writable":false,"value":triggerEvent});Object.defineProperty(this,"createJsonElement",{"enumerable":false,"configurable":false,"writable":false,"value":createJsonElement});Object.defineProperty(this,"appendJsonElement",{"enumerable":false,"configurable":false,"writable":false,"value":appendJsonElement});Object.defineProperty(this,"prependJsonElement",{"enumerable":false,
"configurable":false,"writable":false,"value":prependJsonElement});Object.defineProperty(this,"loading",{"enumerable":false,"configurable":false,"writable":false,"value":function(callback){return documentLoading(callback)}});Object.defineProperty(this,"interactive",{"enumerable":false,"configurable":false,"writable":false,"value":function(callback){return documentInteractive(callback)}});Object.defineProperty(this,"ready",{"enumerable":false,"configurable":false,"writable":false,"value":function(callback){return documentComplete(callback)}});
Object.defineProperty(this,"complete",{"enumerable":false,"configurable":false,"writable":false,"value":function(callback){return documentComplete(callback)}});Object.defineProperty(this,"loadScript",{"enumerable":false,"configurable":false,"writable":false,"value":function(url,success,error){return loadScript(url,success,error)}});Object.defineProperty(this,"loadFile",{"enumerable":false,"configurable":false,"writable":false,"value":function(url){return loadFile(url)}});Object.defineProperty(this,
"fillElements",{"enumerable":false,"configurable":false,"writable":false,"value":function(elems){return fillElements(elems)}});Object.defineProperty(this,"decodeText",{"enumerable":false,"configurable":false,"writable":false,"value":function(value){return decodeText(value)}});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function ObjectExtend(){var _className=
getFunctionName(arguments);var _REEvalFnRetrieve=/function/ig;function EnumeratorClass(){var _self=this;var _keys=[];var _ikeys={};var _values={};function initialize(values){if(typeof values[0]=="string")for(var v in values)addEnumValue(values[v],parseInt(v));else{var jsonDef=values[0];for(var key in jsonDef)addEnumValue(key,jsonDef[key]);jsonDef=null}}function addEnumValue(key,value){_keys.push(key);_ikeys[value]=key;if(_self[key]==undefined){_values[key]=value;Object.defineProperty(_self,key,{"enumerable":true,
"configurable":false,"get":function(){return _values[key]}})}}function hasValue(value){return Object.values(_self).indexOf(value)!=-1}function getKey(value){return _ikeys[value]}function toArray(){return _keys}if(arguments&&arguments.length>0)initialize(arguments[0]);else throw new Error("Cannot define new enum without arguments");Object.defineProperty(_self,"hasValue",{"enumerable":false,"configurable":false,"writable":false,"value":hasValue});Object.defineProperty(_self,"getKey",{"enumerable":false,
"configurable":false,"writable":false,"value":getKey});Object.defineProperty(_self,"toArray",{"enumerable":false,"configurable":false,"writable":false,"value":toArray});return Object.freeze?Object.freeze(_self):_self}function convertTo(value,type){try{type=type.toLowerCase();switch(type){case "number":case "float":value=parseFloat(value);break;case "integer":case "int":value=parseInt(value,10);break;case "datetime":case "date":case "time":value=new Date(value);break;case "json":value=JSON.parse(value);
break;case "string":value=value.toString();break;case "bool":case "boolean":if(typeof value=="string"&&["0","1"].indexOf(value)!=-1||typeof value=="number"&&value>=0&&value<=1)value=toBoolean(value);break;case "array":value=toArray(value);break;case "object":break;case "hexadecimal":value=toHexadecimal(value);break}}catch(error){helper.console.error(error.message,error,arguments)}return value}function isObject(elem){if(elem instanceof Object)if(elem instanceof Function||elem instanceof Array||elem instanceof
Date||elem instanceof String)return false;else return true;else return false}function isArray(array){try{if(array!=null&&array!=undefined&&array.hasOwnProperty("length")&&array instanceof Array)return true;else return Array.isArray(array)}catch(error){return false}}function isBoolean(value){if(value!=null)if(value==1||value==0)return true;else if(value.toString().toUpperCase()=="TRUE"||value.toString().toUpperCase()=="FALSE")return true;else if(typeof value=="boolean")return true;else return false;
else return false}function isNumber(n){if(n==undefined||n==null)return false;else return!isNaN(parseFloat(n))&&isFinite(n)&&n-parseFloat(n)+1>=0}var _HTMLElements=["HTMLDocument","HTMLBodyElement","HTMLAnchorElement","HTMLDivElement","HTMLIFrameElement","HTMLFrameElement","HTMLElement","HTMLImageElement","HTMLInputElement","HTMLFormElement","HTMLHeadElement","HTMLTableElement","HTMLCanvasElement","HTMLScriptElement","HTMLParagraphElement","HTMLSpanElement","HTMLStyleElement","HTMLHtmlElement","HTMLParamElement",
"HTMLPhraseElement","HTMLSelectElement","HTMLTableCaptionElement","HTMLTableCellElement","HTMLTableColElement","HTMLTableDataCellElement","HTMLTableHeaderCellElement","HTMLTableRowElement","HTMLTableSectionElement","HTMLTextAreaElement","HTMLAppletElement","HTMLAreaElement","HTMLAreasCollection","HTMLAudioElement","HTMLBaseElement","HTMLBaseFontElement","HTMLBGSoundElement","HTMLBlockElement","HTMLBRElement","HTMLButtonElement","HTMLCollection","HTMLDataListElement","HTMLDDElement","HTMLDirectoryElement",
"HTMLDListElement","HTMLDTElement","HTMLEmbedElement","HTMLFieldSetElement","HTMLFontElement","HTMLFrameSetElement","HTMLHeadingElement","HTMLHRElement","HTMLIsIndexElement","HTMLLabelElement","HTMLLegendElement","HTMLLIElement","HTMLLinkElement","HTMLMapElement","HTMLMarqueeElement","HTMLMediaElement","HTMLMenuElement","HTMLMetaElement","HTMLModElement","HTMLNextIdElement","HTMLObjectElement","HTMLOListElement","HTMLOptGroupElement","HTMLOptionElement","HTMLPreElement","HTMLProgressElement","HTMLQuoteElement",
"HTMLSourceElement","HTMLTitleElement","HTMLTrackElement","HTMLUListElement","HTMLUnknownElement","HTMLVideoElement"];var _nodeTypes={1:"ELEMENT_NODE",2:"ATTRIBUTE_NODE",3:"TEXT_NODE",4:"CDATA_SECTION_NODE",5:"ENTITY_REFERENCE_NODE",6:"ENTITY_NODE",7:"PROCESSING_INSTRUCTION_NODE",8:"COMMENT_NODE",9:"DOCUMENT_NODE",10:"DOCUMENT_TYPE_NODE",11:"DOCUMENT_FRAGMENT_NODE",12:"NOTATION_NODE"};function getTypeOfHTMLElement(elem){if(elem&&elem.nodeType&&elem.nodeName){var elemType=null;for(var i=0,t=_HTMLElements.length;i<
t;i++){elemType=_HTMLElements[i];if(window[elemType]&&elem instanceof window[elemType])return elemType}return getTypeOfNode(elem)||"HTMLElement"}else if(isWindowElem(elem))return"window";else return null}function getTypeOfNode(elem){if(elem&&elem.nodeType){for(var k in Node)if(elem.nodeType===Node[k])return _nodeTypes[elem.nodeType];return null}else return null}function isWindowElem(elem){if(elem){var cname=elem.constructor?elem.constructor.toString().toLowerCase():"";if(cname.indexOf("window")!=
-1)return true;else return elem.location&&elem.navigator&&elem.document&&getTypeOfHTMLElement(elem.document)==="HTMLDocument"}return false}function getTypeOf(elem){var t=null;try{if(elem!==null&&elem!==undefined)if(elem instanceof Function)return"function";else if(typeof elem=="object"){if(elem instanceof Date)return"date";else if(isArray(elem))return"array";else if(elem instanceof HTMLElement||elem.nodeType&&elem.nodeName)return"HTMLElement";else if(isWindowElem(elem))return"window";if(t!=null)return t;
else return elem.constructor&&elem.constructor.name?elem.constructor.name.toLowerCase():"object"}else if(typeof elem=="number"||isNumber(elem))return"number";else return(typeof elem).toString();else return elem===null?"null":"undefined"}catch(Error){return false}}function getDataTypeOf(value){var type=getTypeOf(value);function isJSON(value){try{if(value){if(typeof value=="string")JSON.parse(value);else if(typeof value=="object")JSON.stringify(value);return true}else return false}catch(error){return false}}
switch(type){case "function":case "array":case "datetime":break;case "number":type=value%1===0?"integer":"float";break;case "boolean":break;case "object":type=isJSON(value)==true?"json":type;break;case "string":function isHexadecimal(value){var pattern=/[A-Fa-f0-9]*/;var reg=new RegExp(pattern);var ret=reg.exec(value)[0].toString();if(ret.length==value.toString().length)return true;else return false}type=isHexadecimal(value)==true?"hexadecimal":type;if(type!="hexadecimal"){type=isBoolean(value)==
true?"boolean":type;if(type!="boolean")if(value.substr(0,1)=="{"&&value.substr(value.length-1,1)=="}")type=isJSON(value)==true?"json":type}break;case "HTMLCollection":case "HTMLElement":case "window":break;default:type=value==null?"null":typeof value;break}return type}function toBoolean(value){if(isNumber(value))if(value==1)return true;else return false;else if(typeof value=="boolean")return value;else if(typeof value=="string")if(value.toUpperCase().indexOf("TRUE")!=-1)return true;else return false;
else return false}function toArray(value){if(value==null||value=="")return[];else if(value instanceof Array)return value;else if(value instanceof String)if(value.indexOf(";")!=-1)return value.split(";");else return value.split(",");else return[value]}function toHexadecimal(value){if(value!=undefined&&value!=null){var hex="";for(var i=0;i<value.length;i++)hex+=""+value.charCodeAt(i).toString(16);return hex}else return null}function checkPath(obj,path){if(path.length==0&&obj!=null&&obj!=undefined)return true;
else if(obj!=null&&obj!=undefined&&obj[path[0]]!=null&&obj[path[0]]!=undefined){var remain=path.splice(0,1);return checkPath(obj[remain],path)}else return false}function existsPath(obj,path,separatorOpt){if(obj!=undefined&&path!=null&&path!=""){var finalPath=path.replace(/\[/g,".").replace(/\]/g,"");if(finalPath.substr(0,1)==".")finalPath=finalPath.substr(1,finalPath.length);if(finalPath.substr(finalPath.length-1,1)==".")finalPath=finalPath.substr(0,finalPath.length-1);var pathArray=finalPath.split(".");
return checkPath(obj,pathArray)}else return false}function getObjectValue(obj,path){try{if(path.length==0)return obj;else if(obj!=null&&obj!=undefined){var remain=path.splice(0,1);return getObjectValue(obj[remain],path)}else return null}catch(error){return null}}function generatePath(obj){var response=[];function _generatePath(obj,path){var fPath=path!=""?path+".":"";for(var attrib in obj)switch(getTypeOf(obj[attrib])){case "object":response.push(fPath+attrib);_generatePath(obj[attrib],fPath+attrib);
break;case "array":response.push(fPath+attrib);for(var i=0;i<obj[attrib].length;i++)switch(getTypeOf(obj[attrib][i])){case "object":case "array":_generatePath(obj[attrib][i],fPath+attrib+"["+i.toString()+"]");break;default:response.push(fPath+attrib+"["+i.toString()+"]");break}break;default:response.push(fPath+attrib);break}}_generatePath(obj,"");return response}function checkPathValue(obj,path,value,separatorOpt){if(obj!=undefined&&path!=null&&path!=""){var finalPath=path.replace(/\[/g,".").replace(/\]/g,
"");if(finalPath.substr(0,1)==".")finalPath=finalPath.substr(1,finalPath.length);if(finalPath.substr(finalPath.length-1,1)==".")finalPath=finalPath.substr(0,finalPath.length-1);var pathArray=finalPath.split(".");var validPaths=generatePath(obj);return validPaths.indexOf(path)!=-1&&getObjectValue(obj,pathArray)==value}else return false}function hasPath(obj,path){if(obj!=undefined&&path!=null&&path!=""){var validPaths=generatePath(obj);return validPaths.indexOf(path)!=-1}else return false}function validateTypeOf(value,
type,restricted){var isValid=false;restricted=restricted==undefined?false:restricted;type=type.toLowerCase();var foundType=getDataTypeOf(value);var rules={"float":{"types":["float","double","real"],"exceptions":[{"types":["integer"],"match":function(value){return!restricted?"float":""}}]},"hexadecimal":{"types":["hexadecimal","hexa","hex"]},"integer":{"types":["integer","int"]},"boolean":{"types":["boolean","bool"],"exceptions":[{"types":["integer","number"],"range":{"min":0,"max":1}},{"types":["string"],
"equalTo":["true","false"]}]},"function":{"types":["function","func","void","procedure"]},"string":{"types":["string","str"],"exceptions":[{"types":["*"],"match":function(value){return typeof value}}]},"datetime":{"types":["datetime","date","time"]},"array":{"types":["array"]},"object":{"types":["object","obj"]},"json":{"types":["json"]}};if(type=="string"&&foundType=="json"&&typeof value=="string")return true;var fnFindRule=function(r){if(r&&rules[r])return rules[r];else for(var n in rules)if(rules[n].types.indexOf(r)!=
-1)return rules[n];return null};var fnVerifyRule=function(r){r=fnFindRule(r);if(!r)return false;if(r.types.indexOf(foundType)!=-1)if(!restricted)return true;else return typeof value==type;else{if(r.exceptions)for(var i=0;i<r.exceptions.length;i++){var exc=r.exceptions[i];if(exc.types.length==1&&exc.types[0]=="*"||exc.types.indexOf(foundType)!=-1)if(exc.range&&exc.range.min<=value&&value<=exc.range.max&&(!restricted||typeof value==type))return true;else if(exc.equalTo&&exc.equalTo.indexOf(value)!=
-1&&(!restricted||typeof value==type))return true;else if(exc.match&&exc.match(value)==type&&(!restricted||typeof value==type))return true}return false}};return fnVerifyRule(type)}function isDOMNode(obj){if(obj==null)return false;return obj instanceof Object&&typeof obj.outerHTML!="undefined"||typeof obj==="object"&&obj.nodeType===1&&typeof obj.style==="object"&&typeof obj.ownerDocument==="object"}function parseByMatched(attributes,target){try{if(attributes!=null&&attributes!=undefined&&target!=null&&
target!=undefined){var ar=getArrayAttributesFromObject(attributes,[],"",1);for(var i=0;i<ar.length;i++)if(target.hasOwnProperty([ar[i]])){var origPath=ar[i];if(target[origPath]){if(target[origPath]!==attributes[origPath])if(target[origPath]instanceof Window||isDOMNode(target[origPath]))target[origPath]=attributes[origPath];else if(attributes[origPath]&&(attributes[origPath]instanceof Array||attributes[origPath].constructor&&attributes[origPath].constructor.name=="Array"))target[origPath]=attributes[origPath];
else if((!attributes[origPath].constructor||attributes[origPath].constructor.name==="Object")&&(target[origPath]instanceof Object||(target[origPath].constructor&&target[origPath].constructor.name=="Object"||GLOBAL_VAR["class"]["privateREF#"]["object"].getTypeOf(target[origPath])==="object")))parseByMatched(attributes[origPath],target[origPath]);else target[origPath]=attributes[origPath]}else target[origPath]=attributes[origPath]}}}catch(error){return error}return target}function getArrayAttributesFromObject(attributes,
array,base,deep){if(deep==undefined)deep=-1;return getArrayAttributesFromObjectInternal(attributes,array,base,deep,0)}function getArrayAttributesFromObjectInternal(attributes,array,base,deep,count){try{if(attributes)for(var attr in attributes){var type="string";if(attributes[attr]!=null){try{if(attributes[attr]&&attributes[attr].window&&attributes[attr].window===attributes[attr].frames)type="window";else if(attributes[attr].nodeType==undefined||attributes[attr].nodeType==null||typeof attributes[attr].nodeType!=
"number")type=typeof attributes[attr]}catch(error){type="unknown"}switch(type){case "object":if(attributes.length==undefined)array.push(base+attr);if(deep==-1||deep<=count)getArrayAttributesFromObjectInternal(attributes[attr],array,base+attr+".",deep,count);break;case "window":default:array.push(base+attr);break}}}}catch(error){return error}return array}function getAttribute(prop,source){try{var str="";if(prop&&source)for(var attr in source)if(attr.toUpperCase()==prop.toUpperCase())return str+="['"+
attr+"']";else{var type="string";if(source[attr]!=null&&(source[attr].nodeType==undefined||source[attr].nodeType==null||typeof source[attr].nodeType!="number"))type=typeof source[attr];switch(type){case "object":var name=getAttribute(prop,source[attr]);if(name!="")return str+="['"+attr+"']"+name;break;case "function":case "number":case "string":case "boolean":default:break}}}catch(error){return error}return str}function clone(obj){try{if(obj==null||typeof obj!="object")return obj;else if(typeof obj==
"object"&&obj.nodeType!=undefined&&obj.nodeType==1)return obj;else if(obj.scopeName&&obj.scopeName=="HTML"&&obj.document&&obj.document.mimeType&&obj.document.mimeType.indexOf("HTML")!=-1)return obj;else{var temp;if(obj instanceof Date)temp=obj;else{try{temp=new obj.constructor}catch(Error){temp={}}for(var key in obj)if(key.substring(0,1)=="#")temp[key]=obj[key];else temp[key]=clone(obj[key])}return temp}}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].log("Cannot clone this object. ["+
JSON.stringify(obj)+"]");return obj}}function evaluate(obj,path,separator){if(obj!=undefined&&path!=null&&path!=""){if(separator==undefined||separator==""||separator==null)separator=".";var spl=path.toString().split(separator);var cValue=obj;for(var prop in spl){spl[prop]=spl[prop].replace(/\[|\]/g,"");if(typeof cValue!="string"&&cValue[spl[prop]]!=undefined){cValue=cValue[spl[prop]];if(spl[prop]==spl[spl.length-1])return cValue!=undefined&&cValue!=null?true:false}else return false}return false}else return false}
function evalExists(obj,path,separator){if(obj!=undefined&&path!=null&&path!=""){if(separator==undefined||separator==""||separator==null)separator=".";var spl=path.toString().split(separator);var cValue=obj;for(var prop in spl){spl[prop]=spl[prop].replace(/\[|\]/g,"");if(typeof cValue!="string"&&typeof cValue[spl[prop]]!="undefined"){cValue=cValue[spl[prop]];if(spl[prop]==spl[spl.length-1])return typeof cValue!="undefined"?true:false}else return false}return false}else return false}function getObjectKeyCaseInsensitive(obj,
key){const lc=key.toLowerCase();return Object.keys(obj).find(k=>k.toLowerCase()===lc)}function getValue(obj,path,defaultResponse,options){if(obj!=undefined&&path!=null&&path!=""){path=path.toString().replace(/\[/g,".").replace(/\[|\]/g,"");if(path[0]==".")path=path.substr(1,path.length);var spl=path.split(".");var cValue=obj;let ig=options&&options.ignoreCase;let len=spl.length;let last=spl[len-1];let prop=null;let oProp=null;for(let i=0,t=len;i<t;i++){prop=oProp=spl[i];if(ig===true)prop=getObjectKeyCaseInsensitive(cValue,
oProp);if(prop&&cValue[prop]!=undefined){cValue=cValue[prop];if(oProp==last)return cValue!=undefined?cValue:typeof defaultResponse!="undefined"?defaultResponse:undefined;let to=typeof cValue;if(["string","number","boolean","function"].indexOf(typeof cValue)!=-1)return typeof defaultResponse!="undefined"?defaultResponse:undefined}else return typeof defaultResponse!="undefined"?defaultResponse:undefined}}return typeof defaultResponse!="undefined"?defaultResponse:undefined}function setValue(obj,path,
value,options={switchTypes:false}){if(path){if(!obj)obj={};path=path.toString().replace(/\[/g,".").replace(/\[|\]/g,"");if(path[0]==".")path=path.substr(1,path.length);var spl=path.split(".");var cValue=obj;var tObj=null;var l=spl.length;let idx=0,c=true;let prop=null;while(idx<l&&c){prop=spl[idx];if(cValue[prop]==undefined)if(["string","number","boolean","function"].indexOf(typeof cValue)!==-1)if(options.switchTypes){tObj[spl[idx-1]]={};cValue[prop]={}}else c=false;else cValue[prop]={};tObj=cValue;
cValue=cValue[prop];idx++}if(c)tObj[prop]=value}return obj}function deleteValue(obj,path){if(path){if(!obj)obj={};path=path.toString().replace(/\[/g,".").replace(/\[|\]/g,"");if(path[0]==".")path=path.substr(1,path.length);var spl=path.split(".");var cValue=obj;var tObj=null;var l=spl.length-1;for(var prop in spl)if(cValue[spl[prop]]==undefined)return obj;else{tObj=cValue;cValue=cValue[spl[prop]]}try{delete tObj[spl[prop]]}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].log("Cannot delete property ["+
ptath+"]. "+error.message)}}return obj}function validate(object){return typeof object!="undefined"&&object!=null}function extendObject(obj,attributes,extendArrays){try{if(validate(attributes)==true&&validate(obj)==false)obj={};obj=extendObjectAttributes(attributes,obj,typeof extendArrays!="boolean"?false:extendArrays);return obj}catch(error){return error.message}}function goOver(json,attributes){for(var prop in attributes)if(attributes[prop]instanceof Array&&json[prop]instanceof Array)for(var i=0;i<
attributes[prop].length;i++){if(typeof attributes[prop][i]=="object"||attributes[prop][i]instanceof Array)goOver(json[prop][i],attributes[prop][i])}else if(attributes[prop]instanceof Array&&typeof json[prop]=="undefined"){json[prop]={};json[prop]=clone(attributes[prop])}else if(typeof attributes[prop]=="object"){if(!json[prop])json[prop]={};goOver(json[prop],attributes[prop])}else if(typeof json[prop]!==typeof attributes[prop]){if(!evalExists(json,prop))json[prop]=clone(attributes[prop])}else if(typeof json[prop]==
"undefined")json[prop]=undefined}function jsonsBalance(json1,json2){try{if(validate(json1)&&validate(json2)){if(json1===json2)return;goOver(json1,json2);goOver(json2,json1);return}}catch(error){return error.message}}function compareJsonBranches(json1,json2){try{if(validate(json1)&&validate(json2)){if(json1===json2)return;var paths1=generatePath(json1);var paths2=generatePath(json2);if(paths1 instanceof Array&&paths2 instanceof Array&&paths1.length==paths2.length){paths1=paths1.sort();paths2=paths2.sort();
for(var i=0;i<paths1.length;i++)if(paths1[i]!=paths2[i])return false;return true}else return false}else return false}catch(error){console.log(error.message);return false}}function extendObjectAttributes(source,target,extendArrays){try{if(source==target)return target;if(target==null)target={};if(source instanceof Array&&!extendArrays)target=clone(source);else for(var prop in source)if(source[prop]instanceof Array)if(extendArrays&&target[prop]instanceof Array)for(var a=0;a<source[prop].length;a++){var idx=
target[prop].indexOf(source[prop][a]);if(idx==-1)try{target[prop].push(clone(source[prop][a]))}catch(e){console.warning(e.message+"  - Assigning target directly");target[prop]=source[prop]}else extendObjectAttributes(source[prop][idx],target[prop][a],extendArrays)}else target[prop]=source[prop];else if(source[prop]instanceof Window||isDOMNode(source[prop]))target[prop]=source[prop];else if(typeof source[prop]!="object")target[prop]=source[prop];else{if(target[prop]===undefined)target[prop]=null;target[prop]=
extendObjectAttributes(source[prop],target[prop],extendArrays)}return target}catch(error){return error.message}}function merge(source,target,override){try{if(source==target)return target;if(target==null){target=clone(source);return target}for(var prop in source)if(typeof source[prop]!="object"||source[prop]instanceof Array){if(target[prop]===undefined||override||override==undefined)target[prop]=source[prop]}else if(source[prop]instanceof Window||isDOMNode(source[prop]))target[prop]=source[prop];else{if(target[prop]===
undefined)target[prop]=null;target[prop]=merge(source[prop],target[prop],override)}return target}catch(error){return error.message}}function applyAttributes(source,attributes){try{if(source==attributes)return source;if(source==null)return source;for(var prop in source)if(typeof source[prop]!="object"||source[prop]instanceof Array){if(attributes[prop]!=undefined)source[prop]=attributes[prop]}else if(attributes[prop]instanceof Window||isDOMNode(attributes[prop]))source[prop]=attributes[prop];else if(attributes[prop]!=
undefined)source[prop]=applyAttributes(source[prop],attributes[prop]);return source}catch(error){return error.message}}function setAttribute(elem,keyValueAttributes,deep){deep=isNumber(deep)?deep:0;var recursive=function(elem,keyValueAttributes,count){if(elem){for(var attrib in keyValueAttributes)if(elem.nodeType==1&&elem.setAttribute)elem.setAttribute(attrib,keyValueAttributes[attrib]);if(count<deep&&elem.childNodes&&elem.childNodes.length>0){count++;for(var i=0;i<elem.childNodes.length;i++)recursive(elem.childNodes[i],
keyValueAttributes,count)}}};recursive(elem,keyValueAttributes,0)}function equals(a,b){if(arguments.length>2&&getDataTypeOf(arguments[2])=="json")return equalsWithOptions.apply(null,arguments);try{var p;var tap;var i;if(a==null&&b==null)return true;if(a==null&&b!=null||b==null)return false;if(a==undefined&&b==undefined)return true;if(a==undefined&&b!=undefined||b==undefined)return false;for(p in a)if(typeof b[p]=="undefined"&&typeof a[p]!="undefined")return false;else{tap=typeof a[p];switch(tap){case "object":if(tap!=
typeof b[p])return false;else if(a[p]instanceof HTMLElement){if(a[p]!==b[p])return false}else{tap=getTypeOf(a[p]);if(tap!=getTypeOf(b[p]))return false;else switch(tap){case "date":if(a[p].getTime()!=b[p].getTime())return false;break;case "array":if(a[p].length!=b[p].length)return false;else for(i=0;i<a[p].length;i++)if(!equals(a[p][i],b[p][i]))return false;break;default:if(!equals(a[p],b[p]))return false}}break;case "function":if(a[p].toString()!=b[p].toString())return false;break;default:if(a[p]!=
b[p])return false}}for(p in b)if(typeof a[p]=="undefined"&&typeof b[p]!="undefined")return false;return true}catch(e){GLOBAL_VAR["class"]["privateREF#"]["console"].log("Error comparing data objects: "+e.message);return false}finally{i=tap=p=null}}function equalsWithOptions(a,b,options){let d=false;let ds=[];let r=false;d=options?.differencies?true:false;try{var p;var tap;var i;if(a==null&&b==null)return true;if(a==null&&b!=null||b==null){if(!d)return r;ds.push("A is null")}if(a==undefined&&b==undefined)return true;
if(a==undefined&&b!=undefined||b==undefined){if(!d)return r;ds.push("A or B is undefined")}for(p in a)if(typeof b[p]=="undefined"&&typeof a[p]!="undefined"){if(!d)return r;ds.push(`B property is undefined prop: "${p}"`)}else{tap=typeof a[p];switch(tap){case "object":if(tap!=typeof b[p]){if(!d)return r;ds.push(`B prop: "${p}", is not a type of 'Object'`)}else if(a[p]instanceof HTMLElement){if(a[p]!==b[p]){if(!d)return r;ds.push(`B prop: "${p}", is not a type of 'HTMLElement'`)}}else{tap=getTypeOf(a[p]);
if(tap!=getTypeOf(b[p])){if(!d)return r;ds.push(`A prop: "${p}", type: "${tap}", is not the same that property B, type: "${getTypeOf(b[p])}"`)}else switch(tap){case "date":if(a[p].getTime()!=b[p].getTime()){if(!d)return r;ds.push(`Property value of A is different than B, prop: "${p}"`)}break;case "array":if(a[p].length!=b[p].length){if(!d)return r;ds.push(`Arrays have differents length, prop: "${p}",  A:${a[p].length}, B:"${b[p].length}"`)}else for(i=0;i<a[p].length;i++){let eq=equalsWithOptions(a[p][i],
b[p][i],options);if(eq!==true){if(!d)return r;ds=ds.concat(eq)}}break;default:let eq=equalsWithOptions(a[p],b[p],options);if(eq!==true){if(!d)return r;ds=ds.concat(eq)}}}break;case "function":if(a[p].toString()!=b[p].toString()){if(!d)return r;ds.push(`B Prop: "${p}" is not a "function"`)}break;default:if(a[p]!=b[p]){if(!d)return r;ds.push(`Prop: "${p}" is not equal`)}}}for(p in b)if(typeof a[p]=="undefined"&&typeof b[p]!="undefined"){if(!d)return r;ds.push(`Prop: "${p}" is undefined in A object, but exists in B object`)}if(!r)r=
d&&ds.length==0||!d?true:false}catch(e){let msg=`Error comparing data objects: ${e.message}`;GLOBAL_VAR["class"]["privateREF#"]["console"].log(msg);if(!d)return r;ds.push(msg);r=false}finally{i=tap=p=null}return r?r:d?ds:false}function toNumber(value,options){if(typeof options=="undefined")options={"type":"int","base":10,"defaultValue":null};else{options.type=typeof options.type!="undefined"?options.type.toLowerCase():"int";if(typeof options.base=="undefined")options.base=10;if(typeof options.defaultValue==
"undefined")options.defaultValue=null}if(isNumber(value))if(options.type=="int"||options.type=="integer")return parseInt(value,options.value);else return parseFloat(value);else if(typeof defaultValue!="undefined")return defaultValue;return value}function createEnum(){return new EnumeratorClass(arguments)}function evalObject(textScript,scope){if(getDataTypeOf(textScript)==="json")return JSON.parse(textScript);else if(!textScript.match(_REEvalFnRetrieve))return window[textScript];else{var script=document.createElement("script");
script.type="text/javascript";script.text=textScript;if(scope)scope.appendChild(script);else document.body.appendChild(script);window.setTimeout(function(){document.body.removeChild(script)},10)}}function createFunctionFromStr(params,strFn){if(params instanceof Array)params.push(strFn);return Function.apply(this,params)}function jsonToArray(json){var result=[];return Object.keys(json)}function jsonToString(jsonObj,firstParams,encode){var str="";var encFn=encode===true?encodeURIComponent:function(value){return value};
firstParams=firstParams===true?"?":firstParams===false?"&":typeof firstParams!="undefined"?firstParams:"&";for(var kvp in jsonObj){str+=firstParams+kvp+"="+encFn(jsonObj[kvp]);firstParams="&"}return str}function jsonMap(target,source,map,options={useBothKey:true,removeChildren:true}){if(!target)return null;if(source&&map)if(getDataTypeOf(map)=="json")for(let kvp in map){let values=map[kvp];if(!(values instanceof Array))values=[values];if(options.useBothKey)values=[kvp].concat(values);if(values){let propValue=
null;let idx=0,len=values.length;while(!propValue&&idx<len&&propValue==undefined){propValue=getValue(source,values[idx],undefined);if(propValue==undefined)propValue=source[values[idx]];idx++}if(propValue!=undefined)if(typeof target[kvp]==="object"&&typeof propValue==="object")merge(propValue,target[kvp],true);else setValue(target,kvp,propValue)}}else throw new Error(`Map object is not a JSON Object`);return target}Object.defineProperty(this,"getTypeOf",{"enumerable":false,"configurable":false,"writable":false,
"value":getTypeOf});Object.defineProperty(this,"getDataTypeOf",{"enumerable":false,"configurable":false,"writable":false,"value":getDataTypeOf});Object.defineProperty(this,"validateTypeOf",{"enumerable":false,"configurable":false,"writable":false,"value":validateTypeOf});Object.defineProperty(this,"getHTMLType",{"enumerable":false,"configurable":false,"writable":false,"value":getTypeOfHTMLElement});Object.defineProperty(this,"getTypeOfNode",{"enumerable":false,"configurable":false,"writable":false,
"value":getTypeOfNode});Object.defineProperty(this,"validate",{"enumerable":false,"configurable":false,"writable":false,"value":validate});Object.defineProperty(this,"convertTo",{"enumerable":false,"configurable":false,"writable":false,"value":convertTo});Object.defineProperty(this,"toNumber",{"enumerable":false,"configurable":false,"writable":false,"value":toNumber});Object.defineProperty(this,"isNumber",{"enumerable":false,"configurable":false,"writable":false,"value":isNumber});Object.defineProperty(this,
"existPath",{"enumerable":false,"configurable":false,"writable":false,"value":existsPath});Object.defineProperty(this,"existsPath",{"enumerable":false,"configurable":false,"writable":false,"value":existsPath});Object.defineProperty(this,"getValue",{"enumerable":false,"configurable":false,"writable":false,"value":getValue});Object.defineProperty(this,"setValue",{"enumerable":false,"configurable":false,"writable":false,"value":setValue});Object.defineProperty(this,"deleteValue",{"enumerable":false,
"configurable":false,"writable":false,"value":deleteValue});Object.defineProperty(this,"parseAttributes",{"enumerable":false,"configurable":false,"writable":false,"value":function(target,attributes){return parseByMatched(attributes,target)}});Object.defineProperty(this,"extend",{"enumerable":false,"configurable":false,"writable":false,"value":extendObject});Object.defineProperty(this,"jsonsBalance",{"enumerable":false,"configurable":false,"writable":false,"value":jsonsBalance});Object.defineProperty(this,
"jsonMap",{"enumerable":false,"configurable":false,"writable":false,"value":jsonMap});Object.defineProperty(this,"compareJsonBranches",{"enumerable":false,"configurable":false,"writable":false,"value":compareJsonBranches});Object.defineProperty(this,"merge",{"enumerable":false,"configurable":false,"writable":false,"value":merge});Object.defineProperty(this,"applyAttributes",{"enumerable":false,"configurable":false,"writable":false,"value":applyAttributes});Object.defineProperty(this,"clone",{"enumerable":false,
"configurable":false,"writable":false,"value":clone});Object.defineProperty(this,"evaluate",{"enumerable":false,"configurable":false,"writable":false,"value":evaluate});Object.defineProperty(this,"exist",{"enumerable":false,"configurable":false,"writable":false,"value":evalExists});Object.defineProperty(this,"exists",{"enumerable":false,"configurable":false,"writable":false,"value":evalExists});Object.defineProperty(this,"setAttribute",{"enumerable":false,"configurable":false,"writable":false,"value":setAttribute});
Object.defineProperty(this,"equals",{"enumerable":false,"configurable":false,"writable":false,"value":equals});Object.defineProperty(this,"checkPathValue",{"enumerable":false,"configurable":false,"writable":false,"value":checkPathValue});Object.defineProperty(this,"hasPath",{"enumerable":false,"configurable":false,"writable":false,"value":hasPath});Object.defineProperty(this,"createEnum",{"enumerable":false,"configurable":false,"writable":false,"value":createEnum});Object.defineProperty(this,"eval",
{"enumerable":false,"configurable":false,"writable":false,"value":evalObject});Object.defineProperty(this,"createFunction",{"enumerable":false,"configurable":false,"writable":false,"value":createFunctionFromStr});Object.defineProperty(this,"jsonToArray",{"enumerable":false,"configurable":false,"writable":false,"value":jsonToArray});Object.defineProperty(this,"jsonToString",{"enumerable":false,"configurable":false,"writable":false,"value":jsonToString});Object.defineProperty(this,"getFunctionName",
{"enumerable":false,"configurable":false,"writable":false,"value":getFunctionName});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Polyfills(){var _className=getFunctionName(arguments);if(typeof window.btoa=="undefined"){var btoa=null;if(typeof window.Base64!="undefined"&&typeof window.Base64.encode!="undefined")btoa=Base64.encode;else if(typeof window.jQuery!=
"undefined"&&typeof window.jQuery.base64!="undefined"&&typeof window.jQuery.base64.encode!="undefined")btoa=jQuery.base64.encode;if(btoa!=null)Object.defineProperty(window,"btoa",{"enumerable":true,"writable":false,"configurable":false,"value":function(data){return btoa(data)}})}if(typeof window.crypto==="undefined")window.crypto=window.msCrypto;if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString())}
function Printer(){var _className=getFunctionName(arguments);function supportPrint(){var response=false;if(window.agentInfo)if(agentInfo.isWindows)switch(true){case agentInfo.isOpera:case agentInfo.isChrome:case agentInfo.isSafari:case agentInfo.isYandex:response=true;break;case agentInfo.isMSIE:case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:default:response=false;break}else if(agentInfo.isMac)switch(true){case agentInfo.isOpera:case agentInfo.isChrome:case agentInfo.isSafari:case agentInfo.isYandex:response=
true;break;case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:case agentInfo.isSymbian:default:response=false;break}else if(agentInfo.isIOS)switch(true){case agentInfo.isSafari:case agentInfo.isOpera:case agentInfo.isChrome:case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:case agentInfo.isSymbian:default:response=false;break}else if(agentInfo.isChromeOS)response=false;else if(agentInfo.isPlaybook)response=false;else if(agentInfo.isHPTablet)response=false;else if(agentInfo.isAndroid)response=
false;else if(agentInfo.isIphone)response=false;else response=false;else{helper.console.warning("AgentInfo class is not defined",arguments);response=false}return response}function supportPrintMethods(){var response={"PREVIEW":false,"DIRECT":false};if(window.agentInfo)if(agentInfo.isWindows)switch(true){case agentInfo.isChrome:case agentInfo.isFirefox:case agentInfo.isSafari:case agentInfo.isOpera:case agentInfo.isYandex:response.PREVIEW=true;response.DIRECT=true;break;case agentInfo.isMSIE:response.PREVIEW=
true;response.DIRECT=false;break;case agentInfo.isNokiaBrowser:default:response.PREVIEW=false;response.DIRECT=false;break}else if(agentInfo.isMac)switch(true){case agentInfo.isOpera:case agentInfo.isChrome:case agentInfo.isSafari:case agentInfo.isYandex:response.PREVIEW=true;response.DIRECT=true;break;case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:case agentInfo.isSymbian:default:response.PREVIEW=false;response.DIRECT=false;break}else if(agentInfo.isIOS)switch(true){case agentInfo.isSafari:if(agentInfo.ipadModel<=
2){response.PREVIEW=true;response.DIRECT=true}else if(agentInfo.ipadModel==3){response.PREVIEW=true;response.DIRECT=true}else{response.PREVIEW=true;response.DIRECT=false}break;case agentInfo.isChrome:response.PREVIEW=true;response.DIRECT=true;break;case agentInfo.isOpera:case agentInfo.isFirefox:case agentInfo.isNokiaBrowser:case agentInfo.isSymbian:default:response.PREVIEW=false;response.DIRECT=false;break}else if(agentInfo.isChromeOS){response.PREVIEW=false;response.DIRECT=false}else if(agentInfo.isPlaybook){response.PREVIEW=
false;response.DIRECT=false}else if(agentInfo.isHPTablet){response.PREVIEW=false;response.DIRECT=false}else if(agentInfo.isAndroid){response.PREVIEW=true;response.DIRECT=true}else if(agentInfo.isIphone){response.PREVIEW=false;response.DIRECT=false}else{response.PREVIEW=false;response.DIRECT=false}else{helper.console.warning("AgentInfo class is not defined",arguments);response.PREVIEW=false;response.DIRECT=false}return response}Object.defineProperty(this,"supportPrint",{"enumerable":true,"configurable":false,
"get":function(){return supportPrint()}});Object.defineProperty(this,"printMethods",{"enumerable":true,"configurable":false,"get":function(){return supportPrintMethods()}});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Size(){var _className=getFunctionName(arguments);var _isMSIE=false;function round(value,decimals){var strValue;try{if(value!=null&&value!=
undefined&&(value!=""||value.toString()=="0")&&value.toString().toUpperCase()!="NAN"){strValue=parseFloat(value).toFixed(decimals);if(decimals==undefined||decimals==null||decimals==0)strValue=parseInt(strValue,10)}else strValue=""}catch(error){}return strValue}function isMSIE(){var userAgent=window.navigator.userAgent.toLowerCase();var isMSIE=false;var reg=/(msie) ([\w.]+)/.exec(userAgent);var ieTest=/(msie) ([0-9\.]+)/i.exec(userAgent);isMSIE=!!(ieTest&&ieTest[1]=="msie");if(!isMSIE&&userAgent.indexOf("trident")!=
-1&&/rv:([0-9\.]+)/i.exec(userAgent))isMSIE=true;return isMSIE}_isMSIE=isMSIE();function getCleanValue(value){var retValue=0;try{if(GLOBAL_VAR["class"]["privateREF#"]["object"]["isNumber"](value))retValue=parseFloat(value);else if(typeof(value=="string")){var exampleValue=round(1,2);var hasPoint=true;var re=new RegExp("[+-]?[0-9]*[.,][0-9]*|[+-]?[0-9]*");if(exampleValue.indexOf(",")!=-1)hasPoint=false;var regExpExec=re.exec(value);if(regExpExec!=null&&regExpExec[0]!=undefined&&regExpExec[0]!=""&&
regExpExec[0]!=null){var retValue=regExpExec[0];if(hasPoint)retValue=retValue.replace(",",".");else retValue=retValue.replace(".",",");retValue=parseFloat(retValue)}else retValue=value}else retValue=value}catch(error){retValue=value}return retValue}function getElementWidth(elem,includingMargin){var retValue=0;try{if(elem)if(elem.window&&elem.document&&elem.document.documentElement)retValue=elem.document.documentElement.clientWidth||elem.document.documentElement.offsetWidth;else if(window.getComputedStyle&&
elem.nodeType!=9&&window.getComputedStyle(elem,null)!=null){var tempWidth=window.getComputedStyle(elem,null).getPropertyValue("width");if(tempWidth.indexOf("px")>-1)retValue=getCleanValue(tempWidth);else if(tempWidth.indexOf("%")>-1)retValue=getElementWidth(elem.parentElement)*parseInt(getCleanValue(tempWidth),10)/100;else if(tempWidth.indexOf("auto")>-1)retValue=getElementWidth(elem.parentElement);else retValue=tempWidth}else if(elem.offsetWidth!=undefined&&elem.offsetWidth!=0)retValue=elem.offsetWidth;
else if(elem.clientWidth!=undefined&&elem.clientWidth!=0)retValue=elem.clientWidth;else if(_isMSIE==false&&elem.ownerDocument&&elem.ownerDocument.documentElement)retValue=elem.ownerDocument.documentElement.clientWidth||elem.ownerDocument.documentElement.offsetWidth;else if(elem.currentStyle)if(elem.currentStyle.width&&elem.currentStyle.width.indexOf("px")>-1)retValue=parseInt(elem.currentStyle.width.replace("px",""),10);else if(elem.currentStyle.width&&elem.currentStyle.width.indexOf("%")>-1)retValue=
getElementWidth(elem.parentElement)*parseInt(elem.currentStyle.width.replace("%",""),10)/100;else{if(elem.currentStyle.width&&elem.currentStyle.width.indexOf("auto")>-1)retValue=getElementWidth(elem.parentElement)}else if(elem.documentElement&&elem.documentElement.offsetWidth)retValue=elem.documentElement.offsetWidth;else if(elem.parentElement)retValue=getElementWidth(elem.parentElement);else retValue=0;else if(window.document.body.clientWidth!=undefined)retValue=window.document.body.clientWidth;
else if(window.document.body.offsetWidth!=undefined)retValue=window.document.body.offsetWidth;else retValue=MYREFERENCES.DefaultWidth;if(includingMargin===true){var css=window.getComputedStyle(elem,null);if(css){var ar=["marginLeft","marginRight","left","right"];for(var i=0;i<ar.length;i++){var rv=css[ar[i]];if(rv!="auto"&&rv!="")retValue+=parseFloat(getCleanValue(rv))}}}}catch(error){genericLog(error,arguments);retValue=0}return retValue}function getElementHeight(elem,includingMargin){var retValue=
0;try{if(elem)if(elem.window&&elem.document&&elem.document.documentElement)retValue=elem.document.documentElement.clientHeight||elem.document.documentElement.offsetHeight;else if(window.getComputedStyle&&elem.nodeType!=9&&window.getComputedStyle(elem,null)!=null){var tempHeight=window.getComputedStyle(elem,null).getPropertyValue("height");if(tempHeight.indexOf("px")>-1)retValue=getCleanValue(tempHeight);else if(tempHeight.indexOf("%")>-1)retValue=getElementHeight(elem.parentElement)*parseInt(getCleanValue(tempHeight),
10)/100;else if(tempHeight.indexOf("auto")>-1)retValue=getElementHeight(elem.parentElement);else retValue=tempHeight}else if(elem.offsetHeight!=undefined&&elem.offsetHeight!=0)retValue=elem.offsetHeight;else if(elem.clientHeight!=undefined&&elem.clientHeight!=0)retValue=elem.clientHeight;else if(_isMSIE==false&&elem.ownerDocument&&elem.ownerDocument.documentElement)retValue=elem.ownerDocument.documentElement.clientHeight||elem.ownerDocument.documentElement.offsetHeight;else if(elem.currentStyle)if(elem.currentStyle.height&&
elem.currentStyle.height.indexOf("px")>-1)retValue=parseInt(elem.currentStyle.height.replace("px",""),10);else if(elem.currentStyle.height&&elem.currentStyle.height.indexOf("%")>-1)retValue=getElementHeight(elem.parentElement)*parseInt(elem.currentStyle.height.replace("%",""),10)/100;else{if(elem.currentStyle.height&&elem.currentStyle.height.indexOf("auto")>-1)retValue=getElementHeight(elem.parentElement)}else if(elem.documentElement&&elem.documentElement.scrollHeight)retValue=elem.documentElement.scrollHeight;
else if(elem.parentElement)retValue=getElementHeight(elem.parentElement);else retValue=0;else if(window.document.body.clientHeight!=undefined)retValue=window.document.body.clientHeight;else if(window.document.body.offsetHeight!=undefined)retValue=window.document.body.offsetHeight;else retValue=MYREFERENCES.DefaultHeight;if(includingMargin===true){var css=window.getComputedStyle(elem,null);if(css){var ar=["marginTop","marginBottom","top","bottom"];for(var i=0;i<ar.length;i++){var rv=css[ar[i]];if(rv!=
"auto"&&rv!="")retValue+=parseFloat(getCleanValue(rv))}}}}catch(error){genericLog(error,arguments);retValue=0}return retValue}function getElementSize(elem,includingMargin){try{var _w;var _h;_w=getElementWidth(elem,includingMargin);_h=getElementHeight(elem,includingMargin);if(_w==undefined)_w=window.screen.width;if(_h==undefined)_h=window.screen.height;return{"width":_w,"height":_h}}catch(error){genericLog(error,arguments);return{"width":0,"height":0}}}Object.defineProperty(this,"getWidth",{"enumerable":true,
"configurable":false,"writable":false,"value":getElementWidth});Object.defineProperty(this,"getHeight",{"enumerable":true,"configurable":false,"writable":false,"value":getElementHeight});Object.defineProperty(this,"get",{"enumerable":true,"configurable":false,"writable":false,"value":getElementSize});Object.defineProperty(this,"cleanValue",{"enumerable":true,"configurable":false,"writable":false,"value":getCleanValue});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=
undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function SessionStorage(){var _className=getFunctionName(arguments);var _supportSessionStorage=true;function initialize(){try{_supportSessionStorage=window.sessionStorage?true:false}catch(error){_supportSessionStorage=false}}function get(key){var tempData=null;if(_supportSessionStorage){tempData=sessionStorage.getItem(key);if(tempData)try{tempData=JSON.parse(tempData)}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].error(error.message,
error,arguments);return error}}return tempData}function add(key,value){if(_supportSessionStorage&&key)try{sessionStorage.setItem(key,JSON.stringify(value))}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].error(error.message,error,arguments)}}function remove(key){if(_supportSessionStorage&&key)sessionStorage.removeItem(key)}function clear(){if(_supportSessionStorage)sessionStorage.clear()}initialize();Object.defineProperty(this,"get",{"enumerable":true,"configurable":false,"writable":false,
"value":get});Object.defineProperty(this,"set",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,"add",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,"remove",{"enumerable":true,"configurable":false,"writable":false,"value":remove});Object.defineProperty(this,"clear",{"enumerable":true,"configurable":false,"writable":false,"value":clear});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&
window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Storage(){var _className=getFunctionName(arguments);var _noop=function(){};var _supportLocalStorage=true;var _eventName="storage";var _handlers={};_handlers[_eventName]={};var _listening=false;function initialize(){try{_supportLocalStorage=window.localStorage?true:false;if(!_supportLocalStorage)_off=_on=clear=remove=add=get=_noop}catch(error){_supportLocalStorage=false}}
function get(key){var tempData=null;tempData=localStorage.getItem(key);if(tempData)try{tempData=JSON.parse(tempData)}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].error(error.message,error,arguments);return error}return tempData}function add(key,value){if(key)try{return localStorage.setItem(key,JSON.stringify(value))}catch(error){GLOBAL_VAR["class"]["privateREF#"]["console"].error(error.message,error,arguments)}}function remove(key){if(key)return localStorage.removeItem(key)}function clear(){return localStorage.clear()}
function on(key,handler){if(key&&handler)if(handler instanceof Function){if(!_listening)window.addEventListener(_eventName,localStorageChange,{passive:true});if(!_handlers[_eventName][key])_handlers[_eventName][key]=[];_handlers[_eventName][key].push(handler);_listening=true;return true}else return false;else return false}function off(key,handler){if(key&&handler)if(handler instanceof Function){if(_handlers[_eventName][key]){let idx=_handlers[_eventName][key].indexOf(handler);if(idx!=-1)_handlers[_eventName][key].splice(idx,
1)}else return false;return true}else return false;else return false}function localStorageChange(e){if(_handlers[_eventName][e.key])_handlers[_eventName][e.key].forEach(hnd=>{try{hnd(e)}catch(err){}})}initialize();Object.defineProperty(this,"get",{"enumerable":true,"configurable":false,"writable":false,"value":get});Object.defineProperty(this,"set",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,"add",{"enumerable":true,"configurable":false,"writable":false,
"value":add});Object.defineProperty(this,"remove",{"enumerable":true,"configurable":false,"writable":false,"value":remove});Object.defineProperty(this,"clear",{"enumerable":true,"configurable":false,"writable":false,"value":clear});var ss=new SessionStorage;Object.defineProperty(this,"session",{"enumerable":true,"configurable":false,"get":function(){return ss}});Object.defineProperty(this,"on",{enumerable:true,configurable:false,writeble:false,value:on});Object.defineProperty(this,"off",{enumerable:true,
configurable:false,writeble:false,value:off});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function StringExtend(){var _className=getFunctionName(arguments);if(!String.prototype.trimLeft)String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")};if(!String.prototype.ltrim)String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};if(!String.prototype.trimRight)String.prototype.trimRight=
function(){return this.replace(/\s+$/,"")};if(!String.prototype.rtrim)String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function trim(str){return typeof str=="string"?str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):str}function leftTrim(str){return typeof str=="string"?str.replace(/^\s+/,""):str}function rightTrim(str){return typeof str=="string"?str.replace(/\s+$/,
""):str}function formatStr(format,values){var args=Array.prototype.slice.call(arguments,1);return format.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!="undefined"?args[number]:match})}function sprintf(format,values){var arg=arguments;var i=1;if(format!=null&&typeof format!="undefined")return format.replace(/%((%)|s)/g,function(m){return m[2]||arg[i++]});else return format}function hasWord(text,word){var i=text.indexOf(word);return i==-1?false:function(tl){return(i==0||text[i-
1]==" ")&&(text.length==tl||text[tl]==" ")}(i+word.length)}Object.defineProperty(this,"trim",{"enumerable":true,"configurable":false,"writable":false,"value":trim});Object.defineProperty(this,"ltrim",{"enumerable":true,"configurable":false,"writable":false,"value":leftTrim});Object.defineProperty(this,"rtrim",{"enumerable":true,"configurable":false,"writable":false,"value":rightTrim});Object.defineProperty(this,"format",{"enumerable":true,"configurable":false,"writable":false,"value":formatStr});
Object.defineProperty(this,"sprintf",{"enumerable":true,"configurable":false,"writable":false,"value":sprintf});Object.defineProperty(this,"hasWord",{"enumerable":true,"configurable":false,"writable":false,"value":hasWord});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());return this}function Style(){var _className=getFunctionName(arguments);var _dynamicStyleSheet=null;var _gref=
GLOBAL_VAR["class"]["privateREF#"];function parsingAttributes(attribute,value){var attrib={};if(!window.agentInfo)if(GLOBAL_VAR.class["privateREF#"].console)GLOBAL_VAR.class["privateREF#"].console.warning("AgentInfo class is not defined.",arguments);else window.console.log("AgentInfo class is not defined");else try{switch(attribute.toUpperCase()){case "OPACITY":case "FILTER":if(agentInfo.isMSIE){if(value>1)value/=100;attrib["name"]="opacity";attrib["value"]=value}else{attrib["name"]="filter";if(value<
1&&value%1!=0)value*=100;attrib["value"]="alpha(opacity="+value+")"}break;case "FLOAT":case "CSSFLOAT":case "STYLEFLOAT":if(agentInfo.isMSIE)attrib={"name":"styleFloat","value":value};else attrib={"name":"cssFloat","value":value};break;default:attrib={"name":attribute,"value":value};break}}catch(error){return error}return attrib}function add(elems,style){if(elems){var isElem=true;if(!(elems.forEach instanceof Function)){elems=[elems];isElem=false}elems.forEach(function(elem){try{if(GLOBAL_VAR["class"]["privateREF#"]["object"].validate(style)==
true&&GLOBAL_VAR["class"]["privateREF#"]["object"].validate(elem)==true)if(typeof style=="string"&&style.indexOf(":")==-1){var splStyle=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(style).split(" ");var curClass=elem.className.split(" ");for(var i=0;i<splStyle.length;i++){var added=true;for(var k=0;k<curClass.length;k++)if(curClass[k]==splStyle[i]){added=false;break}if(added==true){elem.className=(elem.className+" "+splStyle[i]).replace(/ +/g," ").trim();added=false}}}else if(typeof style=="string"&&
style.indexOf(":")!=-1){var splStyle=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(style).split(":");splStyle[1]=splStyle[1].replace(/[;|,]/g,"");if(GLOBAL_VAR["class"]["privateREF#"].object.evaluate(elem,"style."+splStyle[0])==true)elem.style[splStyle[0]]=splStyle[1]}else if(typeof style=="object")for(var attrib in style){var lAttrib=attrib.substring(0,1).toLowerCase()+attrib.substring(1,attrib.length);if(GLOBAL_VAR["class"]["privateREF#"].object.evaluate(elem,"style."+[lAttrib])==true){elem.style[lAttrib]=
style[attrib];if(elem.style[lAttrib]!=style[attrib]){var text=elem.style.cssText;var start=text.search(lAttrib);if(start==-1)if(text=="")text=attrib+":"+style[attrib];else text+=";"+attrib+":"+style[attrib];else{var end=text.substr(start).search(";");if(end==-1)text=text.replace(text.substr(start),attrib+":"+style[attrib]);else text=text.replace(text.substr(start,end),attrib+":"+style[attrib])}elem.style.cssText=text}}}}catch(error){return error}});return isElem?elems[0]:elems}}function remove(elems,
toRemove){if(elems){var isElem=true;if(!(elems.forEach instanceof Function)){elems=[elems];isElem=false}elems.forEach(function(elem){if(GLOBAL_VAR["class"]["privateREF#"]["object"].validate(toRemove)==true&&GLOBAL_VAR["class"]["privateREF#"]["object"].validate(elem)==true)if(typeof toRemove=="string"&&toRemove.indexOf(":")==-1){var rmvClasses=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(toRemove).split(/ +/g);var curClasses=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(elem.className).split(/ +/g);
var p;for(var i=0;i<rmvClasses.length;i++){p=curClasses.indexOf(rmvClasses[i]);if(p!=-1)curClasses.splice(p,1)}elem.className=curClasses.join(" ")}});return isElem?elems[0]:elems}}function addAll(elem,style){if(GLOBAL_VAR["class"]["privateREF#"]["object"].validate(style)==true&&GLOBAL_VAR["class"]["privateREF#"]["object"].validate(elem)==true){add(elem,style);for(var i=0;i<elem.childNodes.length;i++)addAll(elem.childNodes[i],style)}}function removeAll(elem,style){if(GLOBAL_VAR["class"]["privateREF#"]["object"].validate(style)==
true&&GLOBAL_VAR["class"]["privateREF#"]["object"].validate(elem)==true){remove(elem,style);for(var i=0;i<elem.childNodes.length;i++)removeAll(elem.childNodes[i],style)}}function replace(elems,oldStyle,newStyle){if(elems){var isElem=true;if(!(elems.forEach instanceof Function)){elems=[elems];isElem=false}elems.forEach(function(elem){remove(elem,oldStyle);add(elem,newStyle)});return isElem?elems[0]:elems}}function hasClass(elem,className){if(elem&&className&&elem instanceof HTMLElement&&typeof className==
"string"){var splClasses=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(className).split(/ +/g);var count=0;for(var i=0;i<splClasses.length;i++)if(GLOBAL_VAR["class"]["privateREF#"]["string"].hasWord(elem.className,splClasses[i]))count++;return count==splClasses.length}return false}function hasAnyClass(elem,classes){if(elem&&classes&&elem instanceof HTMLElement&&typeof classes=="string"){var splClasses=GLOBAL_VAR["class"]["privateREF#"]["string"].trim(classes).split(/ +/g);for(var i=0;i<splClasses.length;i++)if(GLOBAL_VAR["class"]["privateREF#"]["string"].hasWord(elem.className,
splClasses[i]))return true;return false}return false}function hasAnyParentsClass(elem,classes){if(!elem)return false;else if(hasAnyClass(elem,classes))return true;else return hasAnyParentsClass(elem.parentElement,classes)}function getAttribute(elem,attribute){var value=undefined;var obj=GLOBAL_VAR["class"]["privateREF#"]["object"];try{if(obj.validate(elem)&&obj.validate(attribute)){if(obj.exists(elem,"currentStyle")==true){attribute=attribute.replace(/\-(\w)/g,function(strMatch,p1){return p1.toUpperCase()});
return elem.currentStyle[attribute]}if(obj.exists(document,"defaultView.getComputedStyle")){value=document.defaultView.getComputedStyle(elem,"");if(value!=null)return value.getPropertyValue(attribute)}if(obj.exists(elem,"style."+attribute)==true)return elem.style[attribute]}return value}catch(error){return error}}function getComputedStyleProperty(elem,prop){var value;if(elem.currentStyle)value=elem.currentStyle[styleProp];else if(window.getComputedStyle)value=document.defaultView.getComputedStyle(elem,
null).getPropertyValue(prop);return value}function getCSSRule(rulePath){var ruleName=rulePath.toLowerCase();var styleSheet;var i,ii;var cssRule,cssRuleInner=null;var cssRules,cssRulesInner;if(document.styleSheets)for(i=0;i<document.styleSheets.length;i++){styleSheet=document.styleSheets[i];try{styleSheet.cssRules||styleSheet.rules}catch(error){continue}if(styleSheet.cssRules)cssRules=styleSheet.cssRules;else cssRules=styleSheet.rules;if(cssRules)for(ii=0;ii<cssRules.length;ii++){cssRule=cssRules[ii];
if(cssRule)if(cssRule.selectorText){let selectors=cssRule.selectorText.split(",");if(selectors.find(r=>{return _gref.string.trim(r.toLowerCase())==ruleName}))return cssRule}else if(cssRule.styleSheet){if(cssRule.styleSheet.cssRules)cssRulesInner=cssRule.styleSheet.cssRules;else cssRulesInner=cssRule.styleSheet.rules;if(cssRulesInner)for(jj=0;jj<cssRulesInner.length;jj++){cssRuleInner=cssRulesInner[jj];if(cssRuleInner)if(cssRuleInner.selectorText)if(cssRuleInner.selectorText.toLowerCase()==ruleName)return cssRuleInner}}}}return null}
function addCSSRule(rulepath,style){if(!_dynamicStyleSheet){_dynamicStyleSheet=document.createElement("style");_dynamicStyleSheet.type="text/css";var idx=document.styleSheets.length;document.getElementsByTagName("head")[0].appendChild(_dynamicStyleSheet);_dynamicStyleSheet=document.styleSheets[idx]}var cssRules=null;if(_dynamicStyleSheet.cssRules)cssRules=_dynamicStyleSheet.cssRules;else cssRules=_dynamicStyleSheet.rules;_dynamicStyleSheet.insertRule(rulepath+"{"+style+"}",cssRules.length)}function removeCSSRule(rulepath){ruleName=
ruleName.toLowerCase();var styleSheet;var i,ii;var cssRule=null;var cssRules;if(document.styleSheets)for(i=0;i<document.styleSheets.length;i++){styleSheet=document.styleSheets[i];if(styleSheet.cssRules)cssRules=styleSheet.cssRules;else cssRules=styleSheet.rules;if(cssRules)for(var k=0;k<cssRules.length;k++){cssRule=cssRules[k];if(cssRule.selectorText)if(cssRule.selectorText.toLowerCase()==ruleName){cssRules.splice(k,1);return}}}}function changeCSSRule(rule,attribute,value){if(typeof rule=="string")rule=
getCSSRule(rule);if(rule)rule.style[attribute]=value;else GLOBAL_VAR["class"]["privateREF#"]["console"].log("rule '"+rule+"' not found",arguments)}function getCSSRuleAttributes(rule){if(typeof rule=="string")rule=getCSSRule(rule);if(rule==null)return null;else return rule.style}function getCSSRuleAttribute(rule,attrname){var attr=null;if(typeof rule=="string")rule=getCSSRule(rule);var styles=getCSSRuleAttributes(rule);if(styles!=null)attr=styles.getPropertyValue(attrname);return attr}function showElem(elems,
display){if(elems){if(!(elems instanceof Array))elems=[elems];var _show=function(elem){if(typeof elem=="string")elem=document.getElementById(elem);if(elem){if(getAttribute(elem,"display")=="none"&&display!==false){if(typeof display=="undefined")display="inherit";elem.style.display=display}if(elem.style.visibility!="visible")elem.style.visibility="visible"}};elems.forEach(_show)}}function hideElem(elems,display){if(elems){if(!(elems instanceof Array))elems=[elems];var _hide=function(elem){if(typeof elem==
"string")elem=document.getElementById(elem);if(elem){if(getAttribute(elem,"display")!="none"&&display!==false){if(typeof display=="undefined")display="none";elem.style.display=display}if(elem.style.visibility!="hidden")elem.style.visibility="hidden"}};elems.forEach(_hide)}}Object.defineProperty(this,"add",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,"addClass",{"enumerable":true,"configurable":false,"writable":false,"value":add});Object.defineProperty(this,
"remove",{"enumerable":true,"configurable":false,"writable":false,"value":remove});Object.defineProperty(this,"removeClass",{"enumerable":true,"configurable":false,"writable":false,"value":remove});Object.defineProperty(this,"replace",{"enumerable":true,"configurable":false,"writable":false,"value":replace});Object.defineProperty(this,"hasClass",{"enumerable":true,"configurable":false,"writable":false,"value":hasClass});Object.defineProperty(this,"hasAnyClass",{"enumerable":true,"configurable":false,
"writable":false,"value":hasAnyClass});Object.defineProperty(this,"hasAnyParentsClass",{"enumerable":true,"configurable":false,"writable":false,"value":hasAnyParentsClass});Object.defineProperty(this,"getAttribute",{"enumerable":true,"configurable":false,"writable":false,"value":getAttribute});Object.defineProperty(this,"getComputedStyle",{"enumerable":true,"configurable":false,"writable":false,"value":getComputedStyleProperty});Object.defineProperty(this,"getCSSRule",{"enumerable":true,"configurable":false,
"writable":false,"value":getCSSRule});Object.defineProperty(this,"addCSSRule",{"enumerable":true,"configurable":false,"writable":false,"value":addCSSRule});Object.defineProperty(this,"removeCSSRule",{"enumerable":true,"configurable":false,"writable":false,"value":removeCSSRule});Object.defineProperty(this,"changeCSSRule",{"enumerable":true,"configurable":false,"writable":false,"value":changeCSSRule});Object.defineProperty(this,"getCSSRuleAttributes",{"enumerable":true,"configurable":false,"writable":false,
"value":getCSSRuleAttributes});Object.defineProperty(this,"getCSSRuleAttribute",{"enumerable":true,"configurable":false,"writable":false,"value":getCSSRuleAttribute});Object.defineProperty(this,"show",{"enumerable":true,"configurable":false,"writable":false,"value":showElem});Object.defineProperty(this,"hide",{"enumerable":true,"configurable":false,"writable":false,"value":hideElem});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+
_className+" class. - "+(new Date).toString());return this}function URL(){var _className=getFunctionName(arguments);var _gref=GLOBAL_VAR["class"]["privateREF#"];function gup(name,optionalWindow,defaultValue){var regex=new RegExp("[\\?&]"+name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)","ig");var wnd="";try{wnd=typeof optionalWindow!="undefined"&&optionalWindow!=null&&optionalWindow.location&&optionalWindow.location.href?optionalWindow.location.href:window.location.href}catch(error){wnd=
window.location.href}var results=regex.exec(wnd);regex=null;return results==null?typeof defaultValue!="undefined"?defaultValue:"":results[1]}function getParam(parseUrl,name,params){if(params)params=params.replace(/ /g,"").replace(/\\/g,"-").split("-");if(parseUrl&&parseUrl.parameters&&name)for(var i=0;i<parseUrl.parameters.length;i++)if(parseUrl.parameters[i].name.toLowerCase()==name.toLowerCase()){var rParam=parseUrl.parameters[i];if(params){if(params.indexOf("lc")!=-1&&rParam)rParam=rParam.toLowerCase();
if(params.indexOf("uc")!=-1&&rParam)rParam=rParam.toUpperCase()}return rParam}return null}function toUrl(parseUrl,params){var fUrl="";if(parseUrl){if(typeof params==="undefined")params=[];else if(!(params instanceof Array))params=params.replace(/ /g,"").replace(/\\/g,"-").replace(/\//g,"-").split("-");if(params.indexOf("lp")!=-1)fUrl=parseUrl.lastPath;else if(params.indexOf("bp")!=-1)fUrl=parseUrl.brokerPath;else{if(parseUrl.protocol)fUrl+=parseUrl.protocol+"://";if(parseUrl.hostname)fUrl+=parseUrl.hostname;
if(parseUrl.port)fUrl+=":"+parseUrl.port;if(params.indexOf("vp")!=-1){if(fUrl.substr(fUrl.length-1,1)!="/")fUrl+="/"}else if(parseUrl.virtualPath){if(parseUrl.virtualPath.substr(0,1)!="/"&&fUrl.substr(fUrl.length-1,1)!="/")fUrl+="/";fUrl+=parseUrl.virtualPath}if(params.indexOf("r")===-1&&parseUrl.resource){if(fUrl.substr(fUrl.length-1,1)!="/")fUrl+="/";fUrl+=parseUrl.resource}if(params.indexOf("a")===-1)for(var i=0;i<parseUrl.parameters.length;i++)if(typeof parseUrl.parameters[i].value!="undefined")fUrl+=
(i==0?"?":"&")+parseUrl.parameters[i].name+"="+parseUrl.parameters[i].value;else fUrl+=(i==0?"?":"&")+parseUrl.parameters[i].name;if(params.indexOf("o")!=-1)fUrl=fUrl.replace(parseUrl.protocol+"://"+parseUrl.hostname+(parseUrl.port&&parseUrl.port!=""?":"+parseUrl.port:""),"");if(params.indexOf("p")!=-1)fUrl=fUrl.replace(parseUrl.protocol+"://","");if(params.indexOf("h")!=-1)fUrl=fUrl.split("#")[0]}}return fUrl}function parseUrl(url){var ret=null;var port=null;var prot=null;var host=null;var baseURL=
null;var parameters=[];var virtualPath=null;var lastPath=null;var brokerPath=null;var resource=null;var hash=null;var res;try{if(url){url=_gref.string.trim(url.toString());if(url.indexOf("://")!=-1){res=url.split("://");prot=res[0];url=res[1]}url=url.replace(/[/]+/g,"/");var colon=url.indexOf(":");if(colon!==-1&&colon<url.indexOf("/")){res=null;var re=new RegExp(":[0-9]*");res=re.exec(url);if(res!=null){port=res[0].replace(":","");host=url.substring(0,res.index);url=url.substring(res.index+res[0].length,
url.length)}}if(host===null){var slashIdx=url.indexOf("/");if(slashIdx!==-1){host=url.substr(0,slashIdx);url=url.substr(slashIdx)}else{host=url;url=""}}baseURL=url;if(baseURL&&baseURL.indexOf("#")!==-1){let hashes=baseURL.split("#");baseURL=hashes[0];hash=hashes[1]}if(baseURL&&baseURL.indexOf("?")!=-1){var params=baseURL.substr(baseURL.indexOf("?")+1,baseURL.length);virtualPath=baseURL.substr(0,baseURL.indexOf("?"));params=params.split("&");for(var i=0;i<params.length;i++){var param=params[i].split("=");
parameters.push({"name":param[0],"value":param[1]})}}else virtualPath=baseURL;if(virtualPath&&virtualPath.indexOf(".")!=-1){var lbs=virtualPath.lastIndexOf("/");var tempVirtualPath=virtualPath.substr(0,lbs+1);resource=virtualPath.substr(lbs+1,virtualPath.length-lbs);virtualPath=tempVirtualPath;tempVirtualPath=null}}if(host=="")host=null;if(baseURL=="")baseURL=null;if(virtualPath){var tvp=_gref.string.trim(virtualPath);var lvp=tvp.substr(0,tvp.lastIndexOf("/")).split("/");var i=lvp.length-1;lastPath=
lvp[i]!==""?lvp[i]+"/":i-1>0&&lvp[i-1]!==""?lvp[i-1]+"/":"";var bp=tvp;if(!bp.endsWith("/"))bp=tvp.substr(0,tvp.lastIndexOf("/"));bp=bp.split("/");if(bp.length>0){bp.pop();brokerPath=bp.join("/");if(!brokerPath.endsWith("/"))brokerPath+="/";if(brokerPath.endsWith(lastPath))brokerPath=brokerPath.substring(0,brokerPath.length-lastPath.length)}else brokerPath="/"}else{brokerPath="/";lastPath=""}var origin=(prot?`${prot}://`:"")+(host?host+(port?`:${port}`:""):"");ret={origin,port,"protocol":prot,"hostname":host,
"baseurl":baseURL,parameters,virtualPath,brokerPath,lastPath,resource,hash,"toUrl":function(params){return toUrl(this,params)},"getParam":function(name,params){return getParam(this,name,params)}}}catch(error){return error}return ret}function getTopWindow(wnd){if(wnd.parent&&wnd.parent!=wnd)try{var hasError=true;if(wnd.parent.location.href){hasError=false;return getTopWindow(wnd.parent)}}catch(error){hasError=true}finally{if(hasError)return wnd}else return wnd}Object.defineProperty(this,"gup",{"enumerable":true,
"configurable":false,"writable":false,"value":gup});Object.defineProperty(this,"getTopWindow",{"enumerable":true,"configurable":false,"writable":false,"value":getTopWindow});Object.defineProperty(this,"parseUrl",{"enumerable":true,"configurable":false,"writable":false,"value":parseUrl});Object.defineProperty(this,"toUrl",{"enumerable":true,"configurable":false,"writable":false,"value":toUrl});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+
_className+" class. - "+(new Date).toString());return this}function Utils(){var _className=getFunctionName(arguments);function getCookie(name){var re=new RegExp(name+"=([^;]+)");var value=re.exec(document.cookie);return value!=null?unescape(value[1]):null}function removeCookie(name,path){var d=new Date(1);document.cookie=GLOBAL_VAR["class"]["privateREF#"].string.format("{0}=; expires={1}; path={2}",name,d.toString(),path||"/")}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}function getGUID(){return"{"+uuidv4().toUpperCase()+"}"}function getNewGWSID(){return generateGUID(32)}function generateGUID(len){var str="".padEnd(len,"x");return str.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)}).toUpperCase()}function maskToGUID(mask){if(mask&&typeof mask==="string")return mask.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)});
else return null}Object.defineProperty(this,"getCookie",{"enumerable":true,"configurable":false,"writable":false,"value":getCookie});Object.defineProperty(this,"getGUID",{"enumerable":true,"configurable":false,"writable":false,"value":getGUID});Object.defineProperty(this,"getNewUUIDv4GUID",{"enumerable":true,"configurable":false,"writable":false,"value":uuidv4});Object.defineProperty(this,"getNewGWSID",{"enumerable":true,"configurable":false,"writable":false,"value":getNewGWSID});Object.defineProperty(this,
"generateGUID",{"enumerable":true,"configurable":false,"writable":false,"value":generateGUID});Object.defineProperty(this,"maskToGUID",{"enumerable":true,"configurable":false,"writable":false,"value":maskToGUID});Object.defineProperty(this,"removeCookie",{"enumerable":true,"configurable":false,"writable":false,"value":removeCookie});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString());
return this}function WebSocketObject(owner){var _className=getFunctionName(arguments);var _webSocket=null;var _opening=false;var _wsObjects=[];function getWSConstructor(){return"WebSocket"in window?WebSocket:MozWebSocket}function checkPendings(){_opening=false;if(_wsObjects.length>0)resolveWebSocket.apply(null,_wsObjects.shift())}function resolveWebSocket(url,binaryType,resolve,reject){var _ws;var _eventHandler=function(e){if(_ws){_ws.removeEventListener("open",_eventHandler);_ws.removeEventListener("close",
_eventHandler);_ws.removeEventListener("error",_eventHandler);try{var str="";var values=["type"];var srcValues=["readyState","url","binaryType","protocol"];values.forEach(function(item){str+=item+": "+e[item]+"\n\r"});srcValues.forEach(function(item){str+=item+": "+e.srcElement[item]+"\n\r"});GLOBAL_VAR.class["privateREF#"].console.log("Type:["+e.type+"], message: "+str,arguments)}catch(err){}}checkPendings()};try{GLOBAL_VAR.class["privateREF#"].console.log("New WebSocket connection: "+url,arguments);
_ws=new _webSocket(url);if(binaryType&&typeof _ws.binaryType!="undefined")_ws.binaryType=binaryType;_ws.addEventListener("open",_eventHandler);_ws.addEventListener("close",_eventHandler);_ws.addEventListener("error",_eventHandler);resolve(_ws)}catch(e){reject(e)}}function getNewWebSocket(url,binaryType){return new Promise(function(resolve,reject){if(!_opening){_opening=true;resolveWebSocket(url,binaryType,resolve,reject)}else _wsObjects.push([url,binaryType,resolve,reject])})}_webSocket=getWSConstructor();
Object.defineProperty(owner,"webSocket",{"enumerable":true,"configurable":false,"writable":false,"value":getNewWebSocket});if(GLOBAL_VAR.console.logDebug)if(window.console!=undefined&&window.console.log!=undefined)window.console.log("Initializing "+_className+" class. - "+(new Date).toString())}function arrayExtract(a,fn){var result=[];var i=a.length-1;while(i>=0){if(fn(a[i]))result=result.concat(a.splice(i,1));i--}return result}function stringRepeat(s,count){if(s==null)throw new TypeError("can't convert "+
s+" to object");var str=""+s;count=+count;if(count!=count)count=0;if(count<0)throw new RangeError("repeat count must be non-negative");if(count==Infinity)throw new RangeError("repeat count must be less than infinity");count=Math.floor(count);if(str.length==0||count==0)return"";if(str.length*count>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");var rpt="";for(;;){if((count&1)==1)rpt+=str;count>>>=1;if(count==0)break;str+=str}return rpt}if(window.agentInfo&&(window.agentInfo.isMSIE||
window.agentInfo.isSafari)){var _getBoundingClientRect=HTMLElement.prototype.getBoundingClientRect;HTMLElement.prototype._getBoundingClientRect=_getBoundingClientRect;HTMLElement.prototype.getBoundingClientRect=function(){var bcr=this._getBoundingClientRect();bcr.x=bcr.left;bcr.y=bcr.top;return bcr}}if(!Array.extract)Object.defineProperty(Array.prototype,"extract",{"enumerable":false,"configurable":false,"writable":false,"value":function(fn){return arrayExtract(this,fn)}});if(!String.repeat)Object.defineProperty(String.prototype,
"repeat",{"enumerable":false,"configurable":false,"writable":false,"value":function(count){return stringRepeat(this,count)}});GLOBAL_VAR["class"]["ref#"]=this;initialize(this);return this}if(typeof window.helper==="undefined")var helper=new Helper;
(function(){function Environment(){var _ref=this;if(typeof window["agentInfo"]=="undefined")return;var _isEmbedded=false;try{_isEmbedded=window.top!=window}catch(error){_isEmbedded=true}var _currentDevicePixelRatio=1;var _initialDevicePixelRatio=typeof window.agentInfo=="undefined"||!agentInfo.isMobile?1:window.devicePixelRatio||1;var _detectedWidth=window.screen.availWidth;var _availWidth=window.screen.availWidth;var _detectedHeight=window.screen.availHeight;var _availHeight=window.screen.availHeight;
var _screenWidth=window.screen.availWidth;var _screenHeight=window.screen.availHeight;var _screenRawWidth=_screenWidth;var _screenRawHeight=_screenHeight;var _getWidth=typeof window.helper!="undefined"?function(elem){return helper.size.getWidth(elem)}:function(elem){return $(elem).width()};var _getHeight=typeof window.helper!="undefined"?function(elem){return helper.size.getHeight(elem)}:function(elem){return $(elem).height()};var _winWidth=_getWidth(window);var _winHeight=_getHeight(window);var _viewportWidth=
_detectedWidth;var _viewportHeight=_detectedHeight;var _deviceWidth=window.screen.width;var _deviceHeight=window.screen.height;var _sizeCalculationHolderElem=null;var _sizeCalculationHolderElemId="sizeCalculationHolder";var _xzoom=100;var _xzoomfn=null;var _supportsFullScreenMode=agentInfo.supportHTML5&&!(agentInfo.isIOS&&agentInfo.ipadModel==="pro")&&agentInfo.supportsFullScreen(document.documentElement);var _fullScreenAvailable=false;var _isFullscreen=false;var _environmentReady=false;var _resolutionModes=
{"fittobrowser":0,"fittoscale":1,"fittoscreen":2,"fixed":3};var _resolutionMode=_resolutionModes.fittobrowser;var _watchDog={"intervalId":null,"intervalTime":50,"width":null,"height":null,"isChanging":false,"isRunning":false,"currentDate":null,"lastEvent":null,"waitTime":window.agentInfo&&agentInfo.isMobile?500:50,"updateTime":window.agentInfo&&agentInfo.isMobile?100:50,"count":0};var _commandHandlerList=[];var _isResizingRunning=false;var _holderElemReady=false;var _orientationMedia=null;var _margin=
{"left":0,"top":0,"right":0,"bottom":0,"infullscreen":false,"notinfullscreen":false,"original":{"left":0,"top":0,"right":0,"bottom":0}};var _savedValues={"currentDevicePixelRatio":null,"detectedWidth":null,"availWidth":null,"detectedHeight":null,"availHeight":null,"screenWidth":null,"screenHeight":null,"screenRawWidth":null,"screenRawHeight":null,"winWidth":null,"winHeight":null,"viewportWidth":null,"viewportHeight":null};var _crop={"width":0,"height":0,"infullscreen":false,"notinfullscreen":false,
"original":{"width":0,"height":0}};var _mobileLimits={"_320x320":320*320,"_640x480":640*480,"_960x600":960*600,"_2048x1024":2048*1024};var _isIEMobileMode=false;var _zoomValues=[25,33.5,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500,600,700,800,900,1E3,2E3,3E3,4E3,1E4];var _initialOrientation=null;function initialize(){applyPixelRatioRule(undefined,function(){return _initialDevicePixelRatio},function(value){_initialDevicePixelRatio=value});_isIEMobileMode=agentInfo.isMSIE&&agentInfo.isWindowsPhone&&
typeof window.matchMedia!="undefined";appendSizeCalculationHolder();var bodyReady=function(){if(document.body){document.body.appendChild(_sizeCalculationHolderElem);_holderElemReady=true;if(!agentInfo.isMobile){_isFullscreen=isFullscreen();assignZoomFn();_orientationMedia="landscape";if(_detectedWidth==0&&_detectedHeight==0)startWatchDog()}attachEvents();updateSizeValues();_initialOrientation=getOrientation();_environmentReady=true}else setTimeout(bodyReady,25)};helper.dom.loading(bodyReady);try{window.dispatchEvent(new CustomEvent("addStatusAPIVariables",
{"detail":[{"name":"size","title":"Size","get":function(){return _detectedWidth+"x"+_detectedHeight},"index":55}]}));window.dispatchEvent(new CustomEvent("addStatusAPIVariables",{"detail":[{"name":"zoom","title":"Zoom","get":function(){return _xzoom},"index":56}]}));window.dispatchEvent(new CustomEvent("addStatusAPIVariables",{"detail":[{"name":"rsize","title":"RSize","get":function(){return window.screen.width+"x"+window.screen.height},"index":56}]}))}catch(error){}}function getMatchMedia(){return window.matchMedia("(orientation: portrait)").matches?
"portrait":"landscape"}function getWndOrientation(){return typeof window.orientation=="undefined"||Math.abs(window.orientation)==90?"landscape":"portrait"}function getOrientation(){if(agentInfo.isMobile)if(_holderElemReady)if(window.matchMedia&&(agentInfo.isIOS&&agentInfo.ipadModel>=2||agentInfo.isWindowsPhone))return getMatchMedia();else if(agentInfo.isAndroid&&agentInfo.chromeVersion>"50")return getWndOrientation();else{var h=_getHeight(_sizeCalculationHolderElem);var w=_getWidth(_sizeCalculationHolderElem);
if(agentInfo.isAndroid&&!agentInfo.isChrome&&!agentInfo.isFirefox&&agentInfo.agentStr.indexOf("android 4.2.2")!=-1){var sw=window.screen.width;var sh=window.screen.height;if(sw==w){w=2;h=1}else if(sh==w){w=1;h=2}else{var wDif=Math.abs(sw-w);var hDif=Math.abs(sh-h);if(wDif>300||hDif>300)if(wDif>hDif){w=2;h=1}else{w=1;h=2}}}return w>=h?"landscape":"portrait"}else if(window.matchMedia)return getMatchMedia();else return getWndOrientation();else return _orientationMedia}function applyPixelRatioRule(dpr,
getDpr,setDpr){if(typeof setDpr==="undefined"||!(setDpr instanceof Function))setDpr=function(value){_currentDevicePixelRatio=value};if(typeof dpr!="undefined")setDpr(dpr);else{var vdpr=null;var cdpr=getDpr();if(agentInfo.isMobile){var w=window.screen.availWidth;var h=window.screen.availHeight;if(w<=320&&h<=320)vdpr=2;else if(w<=320&&h>=640||w*h<_mobileLimits._320x320||w>=640&&h<=320)vdpr=1;else if(cdpr>1&&(w<=480&&h<=640||h<=480&&w<=640||w*h<_mobileLimits._640x480)){if(!(agentInfo.isIOS&&agentInfo.isIphone&&
agentInfo.iosVersion==4))vdpr=1}else if(w>2048||h>2048||w*h>_mobileLimits._2048x1024);else if((w>=600&&h>=960||w>=960&&h>=600||w*h>_mobileLimits._960x600)&&cdpr>1)vdpr=1;else if((w<=1024&&h<=768||w<=768&&h<=1024)&&cdpr>1)vdpr=1;else if(cdpr>2)vdpr=2;else vdpr=window.devicePixelRatio||1}else vdpr=1;if(vdpr)setDpr(vdpr)}}function appendSizeCalculationHolder(){_sizeCalculationHolderElem=document.createElement("div");_sizeCalculationHolderElem.id=_sizeCalculationHolderElemId;_sizeCalculationHolderElem.style.height=
"100%";_sizeCalculationHolderElem.style.width="100%";_sizeCalculationHolderElem.style.backgroundColor="transparent";_sizeCalculationHolderElem.style.opacity="0.5";_sizeCalculationHolderElem.style.position="fixed";_sizeCalculationHolderElem.style.margin="0px";_sizeCalculationHolderElem.style.padding="0px";_sizeCalculationHolderElem.style.top="0px";_sizeCalculationHolderElem.style.left="0px";_sizeCalculationHolderElem.style.right="0px";_sizeCalculationHolderElem.style.bottom="0px";_sizeCalculationHolderElem.style.zIndex=
-9999999}function attachEvents(){window.addEventListener("resize",onresize,false)}function assignZoomFn(){var zoom=null;if(_isEmbedded)_xzoomfn=function(){return 100};else if(agentInfo.isFirefox)_xzoomfn=function(){var mediaQueryBinarySearch=function(property,unit,a,b,maxIter,epsilon){var matchMedia;var head,style,div;if(window.matchMedia)matchMedia=window.matchMedia;else{head=document.getElementsByTagName("head")[0];style=document.createElement("style");head.appendChild(style);div=document.createElement("div");
div.className="mediaQueryBinarySearch";div.style.display="none";document.body.appendChild(div);matchMedia=function(query){style.sheet.insertRule("@media "+query+"{.mediaQueryBinarySearch "+"{text-decoration: underline} }",0);var matched=getComputedStyle(div,null).textDecoration=="underline";style.sheet.deleteRule(0);return{matches:matched}}}var ratio=binarySearch(a,b,maxIter);if(div){head.removeChild(style);document.body.removeChild(div)}return ratio;function binarySearch(a,b,maxIter){var mid=(a+
b)/2;if(maxIter<=0||b-a<epsilon)return mid;var query="("+property+":"+mid+unit+")";if(matchMedia(query).matches)return binarySearch(mid,b,maxIter-1);else return binarySearch(a,mid,maxIter-1)}};return mediaQueryBinarySearch("min--moz-device-pixel-ratio","",0,10,20,1E-4)*100};else if(agentInfo.isMSIE)_xzoomfn=function(){return screen.deviceXDPI/screen.logicalXDPI*100};else if(window===window.top)if(agentInfo.isSafari)_xzoomfn=function(){return window.outerWidth/window.innerWidth*100};else _xzoomfn=
function(){return window.outerWidth/window.innerWidth*100};else if(agentInfo.isChrome)_xzoomfn=function(){if(window.devicePixelRatio!=1&&Math.abs(_getWidth(window)-window.screen.availWidth)>window.screen.availWidth*.01)return window.devicePixelRatio*100;else return window.outerWidth===window.screen.availWidth?window.devicePixelRatio*100:100};else _xzoomfn=function(){return 100}}function updateRealDevicePixelRatio(){if(document.hidden)_currentDevicePixelRatio=1;else{var rawXzoom=_xzoomfn();var dif=
999;if(_zoomValues.indexOf(rawXzoom)==-1){var i=0;while(rawXzoom>_zoomValues[i])i++;if(i==0)rawXzoom=_zoomValues[i];else rawXzoom=Math.abs(_zoomValues[i-1]-rawXzoom)<Math.abs(_zoomValues[i]-rawXzoom)?_zoomValues[i-1]:_zoomValues[i]}_xzoom=rawXzoom;_currentDevicePixelRatio=Math.floor(_xzoom)/100}}function setResolutionMode(value){switch(value.toString().toLowerCase()){case "1":case "fittoscale":_resolutionMode=_resolutionModes.fittoscale;break;case "2":case "fittoscreen":_resolutionMode=_resolutionModes.fittoscreen;
break;case "3":case "fixed":_resolutionMode=_resolutionModes.fixed;break;case "0":case "fittobrowser":default:_resolutionMode=_resolutionModes.fittobrowser;break}}function updateSizeValues(){if(agentInfo.isMobile){var orin=getOrientation();var max=Math.max(window.screen.width,window.screen.height);var min=Math.min(window.screen.width,window.screen.height);if(agentInfo.isIOS&&agentInfo.ipadModel==="pro"&&_holderElemReady)if(orin==="portrait"){max=window.screen.height;min=window.screen.width}else if(orin===
"landscape"){max=window.screen.height;min=window.screen.width}_deviceWidth=orin==="portrait"?min:max;_deviceHeight=orin==="portrait"?max:min;_screenRawWidth=_deviceWidth-_crop.width;_screenRawHeight=_deviceHeight-_crop.height;_screenHeight=_screenRawHeight*_currentDevicePixelRatio;_screenWidth=_screenRawWidth*_currentDevicePixelRatio;if(_holderElemReady){_viewportWidth=_getWidth(_sizeCalculationHolderElem)-_crop.width;_viewportHeight=_getHeight(_sizeCalculationHolderElem)-_crop.height}if(_supportsFullScreenMode)if(agentInfo.isMSIE&&
_isIEMobileMode){if(agentInfo.msieVersion>=11)if(getOrientation()=="portrait"){_detectedWidth=(screen.width||1)-_crop.width;_availWidth=_detectedWidth*_currentDevicePixelRatio-(_margin.left+_margin.right);_detectedHeight=(screen.height||1)-_crop.height;_availHeight=_detectedHeight*_currentDevicePixelRatio-(_margin.top+_margin.bottom)}else{_detectedHeight=(screen.width||1)-_crop.height;_availHeight=_detectedHeight*_currentDevicePixelRatio-(_margin.left+_margin.right);_detectedWidth=(screen.height||
1)-_crop.width;_availWidth=_detectedWidth*_currentDevicePixelRatio-(_margin.top+_margin.bottom)}}else if(_holderElemReady){_detectedWidth=_getWidth(_sizeCalculationHolderElem)-_crop.width;_detectedHeight=_getHeight(_sizeCalculationHolderElem)-_crop.height}else{_detectedWidth=_screenRawWidth;_detectedHeight=_screenRawHeight}else{_detectedWidth=_getWidth(window)-_crop.width;_detectedHeight=_getHeight(window)-_crop.height}if(!_holderElemReady){_viewportWidth=_detectedWidth;_viewportHeight=_detectedHeight}_availWidth=
_detectedWidth*_currentDevicePixelRatio-(_margin.left+_margin.right);_availHeight=_detectedHeight*_currentDevicePixelRatio-(_margin.top+_margin.bottom)}else{updateRealDevicePixelRatio();_deviceWidth=window.screen.width;_deviceHeight=window.screen.height;if(_isFullscreen){_screenWidth=window.screen.width-_crop.width;_screenHeight=window.screen.height-_crop.height}else{_screenWidth=window.screen.availWidth-_crop.width;_screenHeight=window.screen.availHeight-_crop.height}_screenRawWidth=_screenWidth;
_screenRawHeight=_screenHeight;_detectedWidth=_getWidth(window)-_crop.width;_availWidth=_detectedWidth*_currentDevicePixelRatio-(_margin.left+_margin.right);_detectedHeight=_getHeight(window)-_crop.height;_availHeight=_detectedHeight*_currentDevicePixelRatio-(_margin.top+_margin.bottom);if(_holderElemReady&&!_isFullscreen){_viewportWidth=_getWidth(_sizeCalculationHolderElem)-_crop.width;_viewportHeight=_getHeight(_sizeCalculationHolderElem)-_crop.height}else{_viewportWidth=_detectedWidth;_viewportHeight=
_detectedHeight}}}function setElement(elem){if(typeof elem!="undefined"){_sizeCalculationHolderElem=elem;if(_sizeCalculationHolderElem.id==undefined||_sizeCalculationHolderElem=="")_sizeCalculationHolderElem.id=_sizeCalculationHolderElemId;else _sizeCalculationHolderElemId=_sizeCalculationHolderElemId.id}}function environmentReady(fCallback){if(_environmentReady&&_holderElemReady){updateSizeValues();fCallback()}else{var count=0;var tempInterval=setInterval(function(){if(count<25){if(_environmentReady&&
_holderElemReady){clearInterval(tempInterval);updateSizeValues();fCallback()}}else{clearInterval(tempInterval);var str="Cannot trigger environment ready event";var ex=new Error(str);helper.console.error(str,ex);_environmentReady=false;_holderElemReady=false;updateSizeValues();fCallback()}count++},25)}}function isFullscreen(){return _getWidth(window)==_deviceWidth&&_getHeight(window)==_deviceHeight}function addEvent(event,handler){if(event==undefined||event==null||event=="")return"Event is undefined or null.";
if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";event=event.toLowerCase();var item={"event":event,"handler":handler};var isContained=false;if(_commandHandlerList[event]==undefined)_commandHandlerList[event]=[];else for(var i=0;i<_commandHandlerList[event].length;i++)if(_commandHandlerList[event][i].handler==item.handler){isContained=true;break}if(!isContained)_commandHandlerList[event].push(item);return true}function removeEvent(event,handler){var ret=false;
if(event==undefined||event==null||event=="")return"Event is undefined or null.";if(handler==undefined||handler==null||handler=="")return"Handler is undefined or null.";event=event.toLowerCase();var item={"event":event,"handler":handler};if(_commandHandlerList[event]==undefined)return"Cannot find event. Event is not in the command list.";else for(var i=0;i<_commandHandlerList[event].length;i++)if(_commandHandlerList[event][i].handler.toString()==item.handler.toString()){_commandHandlerList[event].splice(i,
1);ret=true}return ret}function setDevicePixelRatio(dpr){_initialDevicePixelRatio=dpr;_currentDevicePixelRatio=dpr;updateSizeValues()}function getCurrentWidth(){return(_holderElemReady?_getWidth(_sizeCalculationHolderElem):_screenRawWidth)-_crop.width}function getCurrentHeight(){return(_holderElemReady?_getHeight(_sizeCalculationHolderElem):_screenRawHeight)-_crop.height}function startWatchDog(e){_watchDog.currentDate=(new Date).getTime();_watchDog.lastEvent=e;watchDesktopSize()}function watchDesktopSize(){if(!_watchDog.isRunning&&
!_watchDog.isChanging){_watchDog.isRunning=true;_watchDog.count=0;triggerEvent(["resizestart"]);var elem=_holderElemReady?_sizeCalculationHolderElem:window;_watchDog.intervalId=setInterval(function(){if(_watchDog.height!=_getHeight(elem)||_watchDog.width!=_getWidth(elem)){_watchDog.height=_getHeight(elem);_watchDog.width=_getWidth(elem);stopWatchDog();changeScreenSize()}else{_watchDog.count++;if(_watchDog.count>10&&_watchDog.height==_getHeight(window)&&_watchDog.width==_getWidth(window)){stopWatchDog();
changeScreenSize()}}},_watchDog.intervalTime)}}function stopWatchDog(){clearInterval(_watchDog.intervalId);_watchDog.intervalId=null;_watchDog.isRunning=false}function changeScreenSize(){if(_watchDog.isChanging==false){_watchDog.isChanging=true;var cHeight=null;var originalHeight=cHeight;var maxWaitTime=1E3;function updateScreenSize(){_isFullscreen=!!document.fullscreenElement;if(_isFullscreen){if(_crop.notinfullscreen){_crop.width=_crop.original.width;_crop.height=_crop.original.height}if(_margin.notinfullscreen){_margin.left=
_margin.original.left;_margin.top=_margin.original.top;_margin.right=_margin.original.right;_margin.bottom=_margin.original.bottom}if(window.Thinfinity.InitializationData){var cropfs=helper.object.getValue(Thinfinity.InitializationData.get("ENVIRONMENT"),"crop.infullscreen",null);if(cropfs){_crop.infullscreen=true;_crop.width=cropfs.width;_crop.height=cropfs.height}var marginfs=helper.object.getValue(Thinfinity.InitializationData.get("ENVIRONMENT"),"margin.infullscreen",null);if(marginfs){_margin.infullscreen=
true;_margin.left=marginfs.left;_margin.top=marginfs.top;_margin.right=marginfs.right;_margin.bottom=marginfs.bottom}}}else{if(_crop.infullscreen){_crop.width=_crop.original.width;_crop.height=_crop.original.height}if(_margin.infullscreen){_margin.left=_margin.original.left;_margin.top=_margin.original.top;_margin.right=_margin.original.right;_margin.bottom=_margin.original.bottom}if(window.Thinfinity.InitializationData){var cropfs=helper.object.getValue(Thinfinity.InitializationData.get("ENVIRONMENT"),
"crop.notinfullscreen",null);if(cropfs){_crop.notinfullscreen=true;_crop.width=cropfs.width;_crop.height=cropfs.height}var marginfs=helper.object.getValue(Thinfinity.InitializationData.get("ENVIRONMENT"),"margin.notinfullscreen",null);if(marginfs){_margin.notinfullscreen=true;_margin.left=marginfs.left;_margin.top=marginfs.top;_margin.right=marginfs.right;_margin.bottom=marginfs.bottom}}}_watchDog.height=null;_watchDog.width=null;_watchDog.isChanging=false;updateSizeValues();triggerEvent(["resize",
"resizeComplete","resizeend"]);if(agentInfo.isMobile){var orin=getOrientation();if(_initialOrientation!=orin){_initialOrientation=orin;triggerEvent(["orientationChange"])}}triggerEvent(_isFullscreen?"enterfullscreen":"exitfullscreen")}function waitForSizeChanged(){var fHeight=_getHeight(window);if(fHeight!=_winHeight&&fHeight==cHeight)setTimeout(function(){updateScreenSize()},_watchDog.waitTime);else{cHeight=fHeight;if(maxWaitTime<(new Date).getTime()-_watchDog.currentDate)setTimeout(function(){updateScreenSize()},
_watchDog.waitTime);else setTimeout(function(){waitForSizeChanged()},_watchDog.updateTime)}}waitForSizeChanged()}}function updateDevicePixelRatio(){applyPixelRatioRule(undefined,function(value){_currentDevicePixelRatio=value});updateSizeValues()}function launchFullscreenMode(elem){try{_isFullscreen=true;if(!elem)elem=document.documentElement;if(elem.requestFullscreen)elem.requestFullscreen().then(()=>{_isFullscreen=!!document.fullscreenElement});else if(elem.mozRequestFullScreen)elem.mozRequestFullScreen();
else if(elem.webkitRequestFullscreen)elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else if(elem.msRequestFullscreen)elem.msRequestFullscreen();else if(typeof window.ActiveXObject!="undefined"){var wscript=new ActiveXObject("WScript.Shell");if(wscript!=null)wscript.SendKeys("{F11}")}else{_isFullscreen=false;helper.console.log("Your browser do not support FullScreen Mode")}}catch(error){_isFullscreen=false}}function exitFullscreenMode(elem){_isFullscreen=false;try{if(document.fullscreenElement){if(!elem)elem=
document.documentElement;if(elem.exitFullscreen)elem.exitFullscreen();else if(document.exitFullscreen)document.exitFullscreen().then(()=>{_isFullscreen=!!document.fullscreenElement});else if(elem.cancelFullscreen)elem.cancelFullscreen();else if(document.cancelFullscreen)document.cancelFullscreen();else if(elem.mozCancelFullScreen)elem.mozCancelFullScreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(elem.webkitExitFullscreen)elem.webkitExitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();
else if(elem.webkitCancelFullscreen)elem.webkitCancelFullscreen();else if(document.webkitCancelFullscreen)document.webkitCancelFullscreen();else if(elem.msExitFullscreen)elem.msExitFullscreen();else if(document.msExitFullscreen)document.msExitFullscreen();else if(elem.msCancelFullscreen)elem.msCancelFullscreen();else if(document.msCancelFullscreen)document.msCancelFullscreen();else{_isFullscreen=true;logDebug("Your browser do not support FullScreen Mode")}}}catch(error){_isFullscreen=!!document.fullscreenElement}}
function onresize(e){_isFullscreen=isFullscreen();updateSizeValues(e);triggerEvent(["resize"]);startWatchDog(e)}function triggerEvent(eventNames){var atLeastOne=false;if(eventNames){if(typeof eventNames=="string")eventNames=[eventNames];for(var k=0;k<eventNames.length;k++)if(_commandHandlerList[eventNames[k].toLowerCase()]!=undefined)for(var i=0;i<_commandHandlerList[eventNames[k].toLowerCase()].length;i++){try{_commandHandlerList[eventNames[k].toLowerCase()][i]["handler"](_watchDog.lastEvent)}catch(error){}atLeastOne=
true}}return atLeastOne}function crop(sizes){if(!sizes)return _crop;else{helper.object.parseAttributes(_crop,sizes);_crop.original.width=_crop.width;_crop.original.height=_crop.height;updateSizeValues();startWatchDog()}}function getScaleAndLayout(){var dpr=parseInt(window.devicePixelRatio*100,10);var cdpr=parseInt(_currentDevicePixelRatio*100,10);if(dpr>cdpr){var fw=_screenRawWidth*100/_xzoom;var sal=fw*window.devicePixelRatio/(fw*_currentDevicePixelRatio)*100;return parseInt(sal/25,10)*25}else return 100}
function lookFor(wnd,key,onlyCurrentWindow){let getParent=function(wnd){try{if(wnd&&wnd.parent&&wnd.parent!=wnd&&wnd.parent.location.href)return wnd.parent}catch(error){return null}};var web7Info=null;try{if(wnd){web7Info=wnd[key];if(!onlyCurrentWindow)while(!web7Info&&wnd){wnd=getParent(wnd);if(wnd)web7Info=wnd[key]}}}catch(error){}return web7Info}function getEnvironmentInformation(){var wndp=null;var wb=true;var crossDomain,embeddedCross=false;try{if(!(parent&&parent.document))crossDomain=true}catch(error){crossDomain=
true}try{if(!window.top.document)embeddedCross=true}catch(error){embeddedCross=true}if(window.parent&&window!=window.parent)try{if(window.parent.location.href)wndp=window.parent;wb=wndp&&wndp.location.host==window.location.host&&wndp.location.protocol==window.location.protocol&&window.location.pathname.endsWith(wndp.location.pathname)}catch(error){wndp=window}else wndp=window;var mw=wndp!=window&&wndp==top?wndp:window;var inFullScreen=crossDomain||embeddedCross?false:isFullscreen();let wfe=window.frameElement==
null||window.frameElement.getAttribute("__webV7_frame__")!==null;let cReferrer=wfe?window.parent.document.referrer:document.referrer;var inw=wfe&&(mw.opener&&mw!=mw.opener||mw.document.referrer==mw.document.location.href||wndp==window&&window.document.referrer.indexOf("oturl")!=-1);let fIndex=undefined;let webV7=lookFor(window,"__webV7__",false);if(webV7)fIndex=inw=false;else{let twnd=helper.url.getTopWindow(window);if(twnd.opener==null&&(window.cookiePrefix==="VNC"||twnd.document.referrer===location.origin+
Thinfinity.global.variables.basePath)){inw=true;fIndex=false}}var referrer=inw?"":cReferrer;var sameOrigin=helper.url.parseUrl(referrer).toUrl("-vp-a-p")===helper.url.parseUrl(window.location).toUrl("-vp-a-p");var info={"withBroker":wb,"referrer":referrer,"fromIndex":inFullScreen||inw?false:typeof fIndex!="undefined"?fIndex:sameOrigin,"mainWindow":mw,"inFullScreen":inFullScreen,"inNewWindow":inw,"embedded":crossDomain||embeddedCross?false:mw!==window};Object.defineProperty(info,"webV7",{enumerable:true,
configurable:false,get:()=>{return lookFor(window,"__webV7__",true)}});return info}initialize();Object.defineProperty(_ref,"fixDevicePixelRatio",{"enumerable":true,"configurable":false,"writable":false,"value":function(){updateDevicePixelRatio()}});Object.defineProperty(_ref,"currentOrientation",{"enumerable":true,"configurable":false,"get":function(){return getOrientation()}});Object.defineProperty(_ref,"currentDevicePixelRatio",{"enumerable":true,"configurable":false,"get":function(){return _currentDevicePixelRatio},
"set":function(dpr){setDevicePixelRatio(dpr)}});Object.defineProperty(_ref,"initialDevicePixelRatio",{"enumerable":true,"configurable":false,"get":function(){return _initialDevicePixelRatio}});_ref.margin={};Object.defineProperty(_ref.margin,"left",{"enumerable":true,"configurable":false,"get":function(){return _margin.left},"set":function(value){_margin.left=_margin.original.left=value;updateSizeValues()}});Object.defineProperty(_ref.margin,"top",{"enumerable":true,"configurable":false,"get":function(){return _margin.top},
"set":function(value){_margin.top=_margin.original.top=value;updateSizeValues()}});Object.defineProperty(_ref.margin,"right",{"enumerable":true,"configurable":false,"get":function(){return _margin.right},"set":function(value){_margin.right=_margin.original.right=value;updateSizeValues()}});Object.defineProperty(_ref.margin,"bottom",{"enumerable":true,"configurable":false,"get":function(){return _margin.bottom},"set":function(value){_margin.bottom=_margin.original.bottom=value;updateSizeValues()}});
Object.defineProperty(_ref,"detectedWidth",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_detectedWidth,10)}});Object.defineProperty(_ref,"detectedHeight",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_detectedHeight,10)}});Object.defineProperty(_ref,"availWidth",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_availWidth,10)}});Object.defineProperty(_ref,"availHeight",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_availHeight,
10)}});Object.defineProperty(_ref,"rawWidth",{"enumerable":true,"configurable":false,"get":function(){return _screenRawWidth}});Object.defineProperty(_ref,"rawHeight",{"enumerable":true,"configurable":false,"get":function(){return _screenRawHeight}});Object.defineProperty(_ref,"width",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_screenWidth,10)}});Object.defineProperty(_ref,"height",{"enumerable":true,"configurable":false,"get":function(){return parseInt(_screenHeight,
10)}});Object.defineProperty(_ref,"currentWidth",{"enumerable":true,"configurable":false,"get":function(){return getCurrentWidth()}});Object.defineProperty(_ref,"currentHeight",{"enumerable":true,"configurable":false,"get":function(){return getCurrentHeight()}});Object.defineProperty(_ref,"viewportWidth",{"enumerable":true,"configurable":false,"get":function(){return _viewportWidth}});Object.defineProperty(_ref,"viewportHeight",{"enumerable":true,"configurable":false,"get":function(){return _viewportHeight}});
if(typeof _ref["devicePixelRatio"]==undefined)Object.defineProperty(_ref,"devicePixelRatio",{"enumerable":true,"configurable":false,"get":function(){return _currentDevicePixelRatio}});Object.defineProperty(_ref,"scaleAndLayout",{"enumerable":true,"configurable":false,"get":function(){return getScaleAndLayout()}});Object.defineProperty(_ref,"resolutionMode",{"enumerable":true,"configurable":false,"get":function(){return _resolutionMode},"set":function(value){setResolutionMode(value)}});Object.defineProperty(_ref,
"setElement",{"enumerable":true,"configurable":false,"value":function(elem){setElement(elem)}});Object.defineProperty(_ref,"ready",{"enumerable":true,"configurable":false,"writable":false,"value":environmentReady});Object.defineProperty(_ref,"isFullscreen",{"enumerable":true,"configurable":false,"get":function(){return _isFullscreen}});Object.defineProperty(_ref,"supportsFullScreen",{"enumerable":true,"configurable":false,"get":function(){return _supportsFullScreenMode}});Object.defineProperty(_ref,
"fullScreenAvailable",{"enumerable":true,"configurable":false,"get":function(){return _fullScreenAvailable},"set":function(value){_fullScreenAvailable=value}});Object.defineProperty(_ref,"requestFullscreen",{"enumerable":true,"configurable":false,"writable":false,"value":launchFullscreenMode});Object.defineProperty(_ref,"exitFullscreen",{"enumerable":true,"configurable":false,"writable":false,"value":exitFullscreenMode});Object.defineProperty(_ref,"on",{"enumerable":true,"configurable":false,"writable":false,
"value":addEvent});Object.defineProperty(_ref,"off",{"enumerable":true,"configurable":false,"writable":false,"value":removeEvent});Object.defineProperty(_ref,"webapp",{"enumerable":true,"configurable":false,"get":function(){return typeof window.navigator.standalone!="undefined"?window.navigator.standalone:false}});Object.defineProperty(_ref,"trigger",{"enumerable":true,"configurable":false,"writable":false,"value":function(eventNames){return triggerEvent(eventNames)}});Object.defineProperty(_ref,
"update",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return updateSizeValues()}});Object.defineProperty(_ref,"crop",{"enumerable":true,"configurable":false,"get":function(){return{"width":_crop.width,"height":_crop.height}},"set":function(sizes){return crop(sizes)}});Object.defineProperty(_ref,"xZoom",{"enumerable":true,"configurable":false,"get":function(){return _xzoom}});Object.defineProperty(_ref,"getEnvironmentInformation",{"enumerable":true,"configurable":false,
"writable":false,"value":getEnvironmentInformation});return _ref}try{Thinfinity!=undefined}catch(e){Thinfinity={}}Thinfinity.Environment=Environment})();window.environment=new Thinfinity.Environment;jQuery.support.cors=true;if(!window.hasOwnProperty("productId"))window.productId="thinvnc";
ThinVNC=function(){var TVNC=this;var cmdCache=null;this.cookiesLoaded=false;this.browserCapabilitiesAvailable=helper.object.getValue(window,"customSettings.browserCapabilities",false);this.mouseX=-1;this.mouseY=-1;this.lastMouseAction="";this.caretX=0;this.caretY=0;this.mouseMoved=false;this.vncdiv;this.baseZIndex=8E5;this.majorVersion;this.firefoxVersion;this.iphone;this.ios;this.mac;this.mobile;this.supportsCanvas;this.startPending=true;this.jsonTimeoutValue=7E4;this.disposeTimeoutValue=25;this.disposeTimeout;
this.endingsession=false;this.pageX=0;this.pageY=0;this.button="";this.imagesLoading=0;this.fs=null;this.cacheLoaded=false;this.startCmdToSend=false;this.dbFiles=[];this.centered=true;this.vncdivId="mainPanel";this.vncContainer=null;this.reconnectDivId="recnx";this.canvasER=null;this.processNextScreenEnabled=true;this.deferCallBySetTimeout=false;this.queueRequestName="requestQueue";this.queueRecycleImg=new Array;this.recycleImgTimeoutValue=5E3;this.reconnectDelay=0;this.runInPublicServer=false;this.ws=
null;this.wsEnabled=false;this.wsAsyncRecv=false;this.wsAsyncRecvTimeout=10;this.wsSendReady=false;this.imgLoaderThreadPool=null;this.connecting=false;this.xmlHttpJson=null;this.lastKeyCode=0;var _onlyKeyCode=false;this.reconnecting=false;this.touching=false;this.crossdomain=false;this.imageCache2=[new Array(600),new Array(600),new Array(2048),new Array(4096),new Array(2048)];this.imageCacheV=[new Array(200),new Array(200),new Array(200),new Array(200),new Array(200)];this.brushCache=new Array(100);
this.offscreenCache=new Array(100);this.rdpGlyphArray=new Array(12);this.textCache=new Array(256);this.offscreenCanvas=null;this.MouseHooked=false;this.KeyboardHooked=false;this.containerWidth=0;this.containerHeight=0;this.msgQueue=[];this.imgQueue=null;this.imgQueueTimeout=1E4;this.imgIndex=0;this.imageListType=0;this.registeredDrawCmds={};this.registeredOOBCmds={};this.registeredCustomDataTypes={};this.registeredCustomCmds={};this.screenHeight=window.environment.rawHeight||window.screen.height;
this.screenWidth=window.environment.rawWidth||window.screen.width;this.canvasPrinter=null;this.xoff=false;this.useBufferedCanvas=false;this.gatewayAccessKey="";var _preferredBrokerKey="__#thinfinity.preferredBrokerId__";var _oturlDataPassKey="oturlDataPass";var _sessionStoragePreservedKeys=[_oturlDataPassKey,_preferredBrokerKey];this.savedMaxWidth=0;this.savedMaxHeight=0;this.inputEnabled=false;this.cmdCacheProps={};this.controlFactory=null;this.enableCmdCache=false;this.canvasInitiallyHidden=false;
this.logger=new JSLogAPI(this);this.printerManager=null;this.rdpMode=false;this.usedDPR=1;this.apiUrl="__base__/";var _CUEnabled=false;var _navigationTypes=helper.object.createEnum({"navigate":0,"reload":1,"back_forward":2,"prerender":3,"reserved":255});var isNewNavigation=function(){var result=false;var nt=_navigationTypes.navigate;if(window.performance){nt=_navigationTypes.getKey(helper.object.getValue(window.performance,"navigation.type",0));if(window.performance.getEntriesByType){var entries=
window.performance.getEntriesByType("navigation");nt=entries.length>0?_navigationTypes[entries[0].type]:nt}}result=!(nt===_navigationTypes.reload||nt===_navigationTypes.back_forward);return result};var currentWindowName=function(){try{var sname=window.name!=""?window.name:window.id!=undefined&&window.id!=""?window.id:window.frameElement?window.frameElement.id||window.frameElement.name:null;if(sname)return"CWN["+sname+"]"}catch(error){return null}};var wndId=currentWindowName()||"_sid";var ID={"key":function(){return(location.pathname.replace(/\//g,
"")+"_"+wndId).toLowerCase()},"get":function(){var k=sessionStorage.getItem(this.key());return k},"set":function(id){sessionStorage.setItem(this.key(),id)},"remove":function(){sessionStorage.removeItem(this.key())}};var WNDOpener={"key":function(){return(location.pathname.replace(/\//g,"")+"_hasOpener").toLowerCase()},"get":function(){var k=sessionStorage.getItem(this.key());return k},"set":function(hasOpener){sessionStorage.setItem(this.key(),hasOpener)},"remove":function(){sessionStorage.removeItem(this.key())}};
if(window.sessionStorage&&!isNewNavigation()){var sid=ID.get();var opener=WNDOpener.get();let len=sessionStorage.length;let i=0;for(i=0;i<len;i++){let k=sessionStorage.key(i);if(_sessionStoragePreservedKeys.indexOf(k)===-1)sessionStorage.removeItem(k)}if(sid)ID.set(sid);if(!window.opener&&opener){WNDOpener.set(true);window.opener=true}}else{WNDOpener.set(window.opener?true:false);ID.remove()}this.rcParams={pcId:"",publickey:"",id:null,clipboard:true,clipboardFileTransfer:false,active:false,showOnStart:true,
hookKeyboard:true,hookMouse:true,centered:true,centeredMode:"both",exitURL:"about:blank",monitor:0,monitorCount:0,viewLeft:0,viewTop:0,viewWidth:0,viewHeight:0,maxWidth:0,maxHeight:0,borderLeft:0,borderRight:0,borderTop:0,borderBottom:0,screenResX:0,screenResY:0,mouseControl:true,touchControl:true,kbdControl:true,kbdUnicode:true,kbdLogKeys:false,clientAck:-1,scraper:null,scraperArgs:null,quality:90,pixelFormat:0,grayscale:false,imageMethod:2,wallpaper:false,wscompression:true,cursorVisible:true,remotePointer:true,
relativeTouch:agentInfo.isMobile,mousePressAsRightButton:false,dragDist:32,scaled:true,divId:null,server:null,protocol:null,url:null,reconnectDelay:3E3,address:"",ticket:"",pin:"",sessionKey:"",externalId:"",userid:null,password:null,playsession:false,serverControlMouse:false,forceAjax:false,delayTouch:250,tbSize:"",xoffEnabled:true,xoffThreshold:20,xonThreshold:5,persistentCache:false,rleThreshold:70,useSendThread:false,lfn:null,useDblClick:false,fitToBrowser:true,fitmode:0,overflow:"auto",useFocus:false,
isCrossDomain:false,savesession:false,forceDesktop:false,rfxEnabled:false,sound:{enabled:false},isAutoFocusEnabled:true,isJsROEnabled:true,UBRWID:null,extraData:null,mouseMoveProcessInterval:10,overrideCursor:false,enableH264:false,enableGfx:false,events:{onServerError:null,onExecRemoteApp:null,onExecResult:null,onFileDownload:null,onOpenLink:null,onServerMessage:null,onFileReady:null,onFileStream:null,onRemoteCommand:null,onServerAuthenticationRequired:null,onServerNeedCredentials:null,onScreenReceived:null,
onServerConnect:null,onDisplayInteractionRequired:null,onBrokerError:null,onServerConnectionError:null,onServerCommandEvent:null,onServerCommandResult:null,onServerDisconnect:null,onServerRedirect:null,onServerConnecting:null,onSessionStart:null,onSessionEnd:null,onSessionStop:null,onProcessWindow:null,onDeleteWindow:null,onWindowStateChanged:null,onReceiveMessage:null,onPropertyChange:null,onSendKey:null,onKeyCode:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onPlaybackEnds:null,onCanvasResize:null,
onZoomDesktop:null,onConnectionLost:null,onConnectionRestored:null,onMouseAnimationFrameEnd:null,onLicenseMsg:null,onPrintHandler:null,onWakeOnLan:null,onWaitForVM:null,onSessionTimeout:null,onCopy:null,onPaste:null,onCut:null,onCopyFiles:null,onReconnectionAttempt:null,onShadowingStatus:null,onCreateCanvas:null,onReleaseCanvas:null,onTouchDeviceDetected:null},cursorCanvas:{x:0,y:0},synchronizeClipboard:true,isShadowSession:false};var WebPImageFormat=new function(){var supportsLossyWebp=null;var supportsLosslessWebp=
null;this.getSupportsWebP=function(){var res=0;if(supportsLosslessWebp!=null&&supportsLossyWebp!=null){if(supportsLosslessWebp)res|=2;if(supportsLossyWebp)res|=1}return res};this.supportsWebP=function(){if(supportsLosslessWebp==null||supportsLossyWebp==null){var img=new Image;img.onload=function(){supportsLossyWebp=img.width==4&&img.height==4};img.onerror=function(){supportsLossyWebp=false};img.src="data:image/webp;base64,UklGRkYAAABXRUJQVlA4IDoAAABwAgCdASoEAAQAAYcIhYWIhYSIiQIADAzdrBLeABAAAAEAAAEAAPKn5Nn/0v8//Zxn/6H3QAAAAAA=";
var img2=new Image;img2.onload=function(){supportsLosslessWebp=img.width==4&&img.height==4};img2.onerror=function(){supportsLosslessWebp=false};img2.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4TBoAAAAvA8AAAA8w//M///MfeFDTtgEL3+5G9D+AHA=="}return this.getSupportsWebP()};this.supportsWebP()};var RdpGlyph=function(font,character,offset,baseLine,width,height,fontData){this.font=font;this.character=character;this.offset=offset;this.baseLine=baseLine;this.width=width;this.height=height;this.fontData=
fontData};function TextEntry(size,data){this.size=size;this.data=data}var codec={binaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(data){var btable=
codec.binaryTable,len,bindex,dindex,e,j,n=0,u=0;len=data.indexOf("=");if(len<0)len=data.length;var output=Array((len>>2)*3+Math.floor(len%4/1.5));e=0;for(j=0;j<data.length;j++){bindex=btable[data.charCodeAt(j)&127];dindex=data.charAt(j)==="=";if(bindex===-1)logError("Illegal character '"+data.charCodeAt(j)+"'");else{u=u<<6|bindex;n+=6;if(n>=8){n-=8;output[e++]=u>>n&255;u&=(1<<n)-1}}}if(n)throw"Invalid base64 encoding";return output}};this.emptyRecycleImgTimeout=null;this.allowMouse=false;if(helper.object.existsPath(arguments,
"0.clientSettings"))self.clientSettings=arguments[0].clientSettings;this.observable={"useAjax":true,"connected":null,"viewHeight":0,"viewWidth":0,"isOTURLSession":false};var _restartConnectTimeout=2E3;var allowOverrideCursor=!agentInfo.isMobile&&cookiePrefix!=="VNC"&&(!agentInfo.isFirefox||window.devicePixelRatio==1)&&!agentInfo.isMSIE&&productId!="ZSC"?true:false;if(allowOverrideCursor&&helper.object.existsPath(self,"clientSettings.OverrideCursor"))TVNC.rcParams.overrideCursor=self.clientSettings.OverrideCursor;
TVNC.rcParams.overrideCursor=!(agentInfo.isMobile||agentInfo.isTouch);var _visualEffect=null;var _customEventsHandler={};var _allowMouseCapture=true;var _checkSizeAndResolutionTimeoutId=null;var _deltaYMultiplier=agentInfo.isOpera?-1:1;var _enumCloseStatusReason=helper.object.createEnum({"ERROR":-1,"DISCONNECT":0,"CLOSE":1});var _isPktIdxEnabled=false;var _lastPkt={"idx":0,"group":0,"reset":false};Object.defineProperty(this,"pktIdxEnabled",{"enumerable":false,"configurable":false,"get":function(){return _isPktIdxEnabled},
"set":function(value){_isPktIdxEnabled=helper.object.convertTo(value,"boolean");if(_isPktIdxEnabled){_lastPkt.reset=true;_lastPkt.idx=-1}}});var _avoidConnectionLostPopup=false;var _mouseQueueTimeout=null;var _blob={"threshold":4E3,"on":typeof ThinVNCApp=="undefined","processedScreenUrl":[],"processedMouseUrl":[],"revoked":false};var _usedImgQueueItems=[];var _location="";var _virtualPathProfile="";var _fromBroker=typeof window.fromBroker!="undefined"?window.fromBroker:false;var rePP=RegExp(/\?|&/);
var STATE_INITIAL=0,STATE_PENDING=1,STATE_ACTIVE=2,STATE_EXPIRED=3,STATE_ERROR=4,STATE_BUSY=5,RDP_NO_INFO=0,RDP_LOGIN_START=1,RDP_LOGIN_INFO=2,RDP_LOGIN_END=3,RDP_LOGIN_ERROR=4;var PROVISSIONING_CREATING=4096,PROVISSIONING_UPDATING=8192,PROVISSIONING_FAILED=16384,PROVISSIONING_SUCCEEDED=32768,PROVISSIONING_DELETING=65536,PROVISSIONING_MIGRATING=131072,POWERSTATE_CREATING=1,POWERSTATE_STARTING=2,POWERSTATE_RUNNING=4,POWERSTATE_STOPPING=8,POWERSTATE_STOPPED=16,POWERSTATE_DEALLOCATING=32,POWERSTATE_DEALLOCATED=
64;var _urlCreator=window.URL||window.webkitURL;var _SIDName=(typeof window.cookiePrefix!="undefined"?window.cookiePrefix+"_":"")+"SID";var _splashCssName=".establishingConnection";var _isSessionEnded=false;var _noop=function(){};var _pendingGrowlsPopups=[];var _licenseTypes=helper.object.createEnum("ERR_TYPE_INFO","ERR_TYPE_WARNING","ERR_TYPE_ERROR");const generateId=()=>`${performance.now()}${Math.random().toString().slice(5)}`.replace(".","");var _getServerUrl={"timeout":1E3,"normal_timeout":1E3,
"vm_timeout":5E3,"id":generateId(),"forceNewRedirection":false,"forceNewRedirectionUsed":false,oturlMaxRetries:4,retriesCount:0};var _xhrStatusExitCodes=[Thinfinity.Communication.errorCode.PAYMENT_REQUIRED,Thinfinity.Communication.errorCode.UNAUTHORIZED];if(helper.url.gup("serviceScreen")!="")if(Thinfinity.ServiceScreen){window.serviceScreen=new Thinfinity.ServiceScreen({"parentElement":document.body});window.serviceScreen.addValue("Use-Ajax",function(){return TVNC.useAjax});window.serviceScreen.addValue("Force-Ajax",
function(){return TVNC.rcParams.forceAjax.toString()})}var _isTemporalConnection=helper.object.convertTo(helper.url.gup("sdk")!="","bool");var _defaultResponseType=helper.ajax.responseType.JSON;var _comm=null;var _avoidSendMouseMove=false;Object.defineProperty(this,"avoidSendMouseMove",{"enumerable":true,"configurable":false,"get":function(){return _avoidSendMouseMove},"set":function(value){_avoidSendMouseMove=value;if(!_avoidSendMouseMove)TVNC.sendMouseMove()}});var _syncCookies={syncCookiesTime:2500,
syncCookiesTOUT:null,syncCookiesEnabled:true,data:{}};var _componentsInitialized=false;var _componentRegistrationServices=null;var _registeredEventsServicesList={};var _enumEventsServices=helper.object.createEnum({"SENDEVENT":1});var _url={"baseUrl":"","gatewayAccess":null,"httpConnection":"","wsConnection":"","brokerUrl":""};Object.defineProperty(this,"baseUrl",{"configurable":false,"enumerable":true,"get":function(){return _url.baseUrl},"set":function(baseUrl){_url.baseUrl=baseUrl}});Object.defineProperty(this,
"httpConnection",{"configurable":false,"enumerable":true,"get":function(){return _url.httpConnection}});Object.defineProperty(this,"hasSecondaryGateway",{"configurable":false,"enumerable":true,"get":function(){return _url.gatewayAccess&&_url.gatewayAccess!==""}});Object.defineProperty(this,"brokerUrl",{"configurable":false,"enumerable":true,"get":function(){return _url.brokerUrl}});var _clipSynchronized=false;function padZero(num,size){return("00000000"+num).substr(-size)}function setPlugin(plugin){if(plugin==
undefined||plugin==null){var arPluginName=null;for(var plugin in _plugins)if(helper.object.getValue(_plugins,plugin+".enabled",false)){if(arPluginName==null)arPluginName=[];arPluginName.push(plugin)}return arPluginName}else if(helper.object.validate(plugin)&&helper.object.validate(plugin["name"])&&helper.object.validate(plugin["obj"])){if(_plugins[plugin["name"]]==undefined)_plugins[plugin["name"]]={"obj":null};_plugins[plugin["name"]]["enabled"]=plugin["enabled"]||true;_plugins[plugin["name"]]["obj"]=
plugin["obj"]}else return helper.string.sprintf(consts.errorExternalPlugin)}function on(name,handler){if(!_customEventsHandler[name])_customEventsHandler[name]=[];var wasAdded=false;for(var i=0;i<_customEventsHandler[name].length;i++)if(_customEventsHandler[name]===handler){wasAdded=true;break}if(!wasAdded)_customEventsHandler[name].push(handler)}function off(name,handler){if(_customEventsHandler[name])for(var i=_customEventsHandler[name].length-1;i>=0;i--)if(_customEventsHandler[name]===handler)_customEventsHandler[name].splice(i,
1)}function triggerCustomEvent(name,data){if(_customEventsHandler&&_customEventsHandler[name])for(var i=0;i<_customEventsHandler[name].length;i++)try{return _customEventsHandler[name][i](data)}catch(error){}}function addValidCanvas(canvas){if(_validCanvas.indexOf(canvas)===-1)_validCanvas.push(canvas)}Object.defineProperty(this,"useAjax",{"enumerable":true,"configurable":true,"get":function(){return TVNC.observable.useAjax},"set":function(value){TVNC.observable.useAjax=value}});Object.defineProperty(this,
"connected",{"enumerable":true,"configurable":true,"get":function(){return _comm.connected},"set":function(value){_comm.connected=value}});Object.defineProperty(this.rcParams,"viewWidth",{"enumerable":true,"configurable":true,"get":function(){return TVNC.observable.viewWidth},"set":function(value){TVNC.observable.viewWidth=value}});Object.defineProperty(this.rcParams,"viewHeight",{"enumerable":true,"configurable":true,"get":function(){return TVNC.observable.viewHeight},"set":function(value){TVNC.observable.viewHeight=
value}});Object.defineProperty(this,"containerId",{"enumerable":true,"configurable":true,"get":function(){return TVNC.rcParams.divId}});Object.defineProperty(this,"setKeyboardFocus",{"enumerable":true,"configurable":false,"writable":false,"value":function(){return _displayManager.focus()}});var _displayObj={};Object.defineProperty(this,"display",{"enumerable":true,"configurable":false,"get":function(){return _displayObj}});Object.defineProperty(_displayObj,"manager",{"enumerable":true,"configurable":false,
"get":function(){return _displayManager}});Object.defineProperty(_displayObj,"managerInterface",{"enumerable":true,"configurable":false,"get":function(){return _oInterface.new}});Object.defineProperty(this,"allowMouseCapture",{"enumerable":true,"configurable":true,"get":function(){return _allowMouseCapture},"set":function(value){if(!TVNC.rcParams.serverControlMouse||!value)_allowMouseCapture=value}});Object.defineProperty(this,"overrideCursor",{"enumerable":true,"configurable":true,"get":function(){return allowOverrideCursor&&
TVNC.rcParams.overrideCursor},"set":function(value){if(allowOverrideCursor)TVNC.rcParams.overrideCursor=value}});Object.defineProperty(this,"on",{"enumerable":true,"configurable":true,"writable":false,"value":on});Object.defineProperty(this,"off",{"enumerable":true,"configurable":true,"writable":false,"value":off});Object.defineProperty(this,"__recvPingResponse",{"enumerable":false,"configurable":false,"value":function(){return _comm.recvPingResponse()}});Object.defineProperty(this,"plugins",{"enumerable":false,
"configurable":true,"value":function(plugin){return setPlugin(plugin)}});Object.defineProperty(this,"location",{"enumerable":true,"configurable":true,"get":function(){return _location}});Object.defineProperty(this,"virtualPath",{"enumerable":true,"configurable":true,"get":function(){return _virtualPathProfile}});Object.defineProperty(this,"fromBroker",{"enumerable":false,"configurable":true,"get":function(){return _fromBroker},"set":function(value){return _fromBroker=helper.object.convertTo(value,
"boolean")}});Object.defineProperty(this,"splashCssName",{"enumerable":false,"configurable":true,"get":function(){return _splashCssName},"set":function(value){return _splashCssName=value}});Object.defineProperty(this,"isTemporal",{"enumerable":false,"configurable":true,"get":function(){_isTemporalConnection}});Object.defineProperty(this,"H264",{"enumerable":false,"configurable":false,"get":function(){return _ePictureType===_enumPictureType.H264}});Object.defineProperty(this,"GFX",{"enumerable":false,
"configurable":false,"get":function(){return _ePictureType===_enumPictureType.GFX}});Object.defineProperty(this,"availableAudio",{"enumerable":true,"configurable":false,"get":()=>{return window.AudioContext?true:false}});Object.defineProperty(this,"enumCloseStatusReason",{"enumerable":true,"configurable":false,"get":function(){return _enumCloseStatusReason}});Object.defineProperty(this,"onSendEvent",{"enumerable":false,"configurable":false,"set":function(handler){if(handler&&handler instanceof Function)_registeredEventsServicesList[_enumEventsServices.SENDEVENT]=
handler}});this.allowFullscreenShortcut=productId=="thinrdp"?true:false;this.multiRowMinSize=40;if(agentInfo.isMSIE&&agentInfo.msieVersion<10)this.partialAnimationFrameUpdate=function(callback){setTimeout(callback,0)};else this.partialAnimationFrameUpdate=function(callback){callback()};var mouseCanvasX=0;var mouseCanvasY=0;var previousOrientation=null;var waitOrientationChangeTime=1E3;var elapsedOrientationTime=null;var allowSendingCommands=false;function createPrintDialog(){return typeof PrintDialog!=
"undefined"&&PrintDialog!=null?new PrintDialog({"onHide":function(){TVNC.pingIgnore=false},"onAssignDocument":function(){TVNC.pingIgnore=true},"owner":TVNC}):null}var printDialog=createPrintDialog();var timeBeforeReconnect=250;var timeoutIdBeforeReconnect=null;var resetTimeId=null;var isReset=false;var currentActiveWindow=null;var oLastError={"message":null,"code":null,"date":null,"timeoutId":null,"elapsedTime":1E4};var errorOccurs=0;var connection={"fromReconnection":false,"firstConnection":true,
"first404IncomingTime":null,"maxTimeBeforeRemoveGatewayAccessKey":3E4,reconnectingCount:0,reconnectingMax:8};var serverDPR={"enabled":false,"originalValue":null};var serverCmdResultOrientation=null;var restartOnOrientationChange=false;var mouseBuffer={"queue":[],"isAvailable":false};var ENUM_CODES={authenticationCodeErrors:["10009","10010"]};var UintArrayConfig={"size":5E4,"sliceMethod":typeof Uint8Array!="undefined"?(new Uint8Array).splice!=undefined?"slice":"subarray":"slice","method":"apply"};
var emulcont=null;var _getComputedStyle=helper.style.getComputedStyle;var _enumPictureType=helper.object.createEnum({CANVAS:0,H264:1,GFX:2});var _ePictureType=_enumPictureType.CANVAS;var _gfx=null;var _validCanvas=[];var _displayManager=null;var _packetReceiver=null;var _audioDriver=null;var _preventKeys={available:true,keys:{67:{"ctrlKey":true},99:{"ctrlKey":true},86:{"ctrlKey":true},118:{"ctrlKey":true},88:{"ctrlKey":true},120:{"ctrlKey":true}}};var _oInterface=null;var _oClipboard=null;var _iClipboard=
null;var _pendingsCommandsCallback=[];var _pendingDisplayResize=null;var _eMode=helper.object.createEnum({"HOST":0,"API":1,"SKEY":2,"OTURL":10,"SDK":11});var _isDisconnecting=false;var _connectResult={max:10,count:0};function getOrientation(){if(window.matchMedia)if(window.matchMedia("(orientation: portrait)").matches)return"portrait";else{if(window.matchMedia("(orientation: landscape)").matches)return"landscape"}else return"landscape"}this.getOrientation=getOrientation;function initialize(){previousOrientation=
window.environment.currentOrientation||getOrientation();var commArgs={"protocol":Thinfinity.Communication.protocol.WEBSOCKET,"withCredentials":TVNC.crossDomain(),"webSocket":{"maxTimeToOpen":1E4,"events":{"open":function(e){BTP_WS_OPEN=null;TVNC.wsEnabled=true;resetLastError();logDebug("TVNC.ws.onopen. TVNC.wsEnabled = true");TVNC.useAjax=false;TVNC.start();try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onConnectionKindChange==null)$(document).trigger("connectionKindChange");
else TVNC.rcParams.events.onConnectionKindChange()}catch(error){helper.console.warning("'onConnectionKindChange' calling attached method fail. message: "+error.message,error,arguments)}callPendingCommands()},"message":function(msg){errorOccurs=0;_packetReceiver.process(msg.data)},"close":function(e){BTP_WS_CLOSE1=null},"error":function(e){BTP_WS_ERR=null;var msg=consts.unknownError;var code="";if(e&&e.detail){code=e.detail.code;if(e.detail.message!="")msg=e.detail.message;if(e.detail.code===Thinfinity.Communication.errorCode.TIMEOUT){BTP_WS_TOUT=
null;helper.console.log("WebSocket: is not responding...",arguments);BTP_PWS_CLS2=null}}helper.console.warning(helper.string.format("TVNC.ws.error - {0}, ({1})",msg,code),arguments)}}},"methods":{arraybufferToString:TVNC.arbufToStringU8},"properties":{},"events":{"stateChange":function(state){connectionStateChanged(state)},"error":function(e){var msgDetail=helper.object.getValue(e,"detail.message","");helper.console.warning(helper.string.format("Something went wrong: {0}, protocol: {1}, state: {2}",
msgDetail,_comm.protocol,_comm.state),arguments);if(e.detail&&e.detail.code===Thinfinity.Communication.errorCode.RESTART)restart(true)}}};Object.defineProperty(commArgs.properties,"sessionEnd",{"enumerable":true,"configurable":false,"get":function(){return _isSessionEnded}});_comm=new Thinfinity.Communication(commArgs)}var _commLastState=0;let _commStateLost=false;function connectionStateChanged(state){if(state===Thinfinity.Communication.state.CONNECTED){if(_commLastState!=state){_displayManager.fireEvent("localEvent",
{cmd:"connected"});TVNC.closeReconnectDiv();if(_commLastState>Thinfinity.Communication.state.RECONNECTING&&_commLastState<Thinfinity.Communication.state.LOST||_commStateLost)try{BTP_PC_RST=null;var cs={"code":3,"message":consts.connRestored};_displayManager.fireEvent("localEvent",{...{cmd:"connectionRestored"},cs});if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onConnectionRestored==null)window.dispatchEvent(new CustomEvent(consts.connRestored,cs));else TVNC.rcParams.events.onConnectionRestored(cs)}catch(error){helper.console.error(consts.connRestored+
" - code: 3",error,arguments)}}_commStateLost=false}else if(state===Thinfinity.Communication.state.UNSTABLE){if(_commLastState!=state)try{BTP_PC_UNS=null;var cs={"code":1,"message":consts.connUnstable};_displayManager.fireEvent("localEvent",{...{cmd:"connectionUnstable"},cs});if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onConnectionLost==null)window.dispatchEvent(new CustomEvent(consts.connUnstable,cs));else _avoidConnectionLostPopup=TVNC.rcParams.events.onConnectionLost(cs);
if(!_avoidConnectionLostPopup)TVNC.showReconnectDiv(false)}catch(error){helper.console.error(consts.connUnstable+" - code: 1",error,arguments)}_commStateLost=true}else if(state===Thinfinity.Communication.state.LOST){try{BTP_PC_LST=null;var cs={"code":2,"message":consts.connLostReconnecting};_displayManager.fireEvent("localEvent",{...{cmd:"connectionLost"},cs});if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onConnectionLost==null)window.dispatchEvent(new CustomEvent(consts.connLost,
cs));else _avoidConnectionLostPopup=TVNC.rcParams.events.onConnectionLost(cs);if(!_avoidConnectionLostPopup)TVNC.showReconnectDiv(true)}catch(error){helper.console.error(consts.connLostReconnecting+" - code: 2",error,arguments)}_commStateLost=true}_commLastState=state}function callPendingCommands(){_pendingsCommandsCallback.forEach(function(handler){try{handler()}catch(error){}});_pendingsCommandsCallback=[]}this.showReconnectDiv=function(connLost){if(!checkSplashPopup())if(_visualEffect)_visualEffect.toGrayScale(connLost);
else{var elem=document.getElementById(TVNC.reconnectDivId);var d=helper.dom.appendJsonElement({"parentElement":elem&&elem.parentElement?elem.parentElement:document.body,"type":"div","attributes":{"style":helper.string.format("-webkit-box-shadow: 1px 1px 15px #000;-moz-box-shadow: 1px 1px 15px #000; position:absolute; top:50%; left:50%; transform:translate3d(-50%, -50%, 0); background:#111111;z-index:{0}; padding:20px;color:#FFF;-moz-border-radius: 7px;border-radius: 7px; font-size:14px; font-weight:normal; width:250px;height:68px; text-align:center",
TVNC.getNextHighestZindex(document.body))},"content":consts.connLostReconnecting+"</br>"});var button=helper.dom.appendJsonElement({"parentElement":d,"type":"input","attributes":{"id":"cancelRecnx","type":"button","style":"margin-top:20px;padding:6px;"},"events":{"click":function(e){TVNC.closeReconnectDiv();TVNC.disconnect();TVNC.dispose(true);$(document).unbind();$("#"+TVNC.vncdivId).unbind()}},"content":consts.abort})}};previousOrientation=window.environment.currentOrientation||getOrientation();
this.pingIgnore=false;this.closeReconnectDiv=function(abort){if(_avoidConnectionLostPopup!==true)if(_visualEffect)_visualEffect.toColor();else{$("#cancelRecnx").parent().remove();$("#"+TVNC.reconnectDivId).remove()}};this.connectWebSocket=function(fastConnect,callback){BTP_WS_INIT=null;if(_comm.state<=Thinfinity.Communication.state.CLOSING)_comm.wsOpen(TVNC.getWsUrl())};function restartConnection(){TVNC.reset();_comm.releaseQueue(TVNC.queueRequestName);var buildResolutionArgs=function(){var args=
"";var w=TVNC.rcParams.width;var h=TVNC.rcParams.height;var fitmode="";if(typeof this.agentName=="undefined")TVNC.resolveAgent();var screenWidth=window.environment.rawWidth||window.screen.width;var screenHeight=window.environment.rawHeight||window.screen.height;w=window.environment.detectedWidth;h=window.environment.detectedHeight;if(helper.object.existsPath(self,"clientSettings.UseViewportSize")&&self.clientSettings.UseViewportSize){w=window.environment.viewportWidth;h=window.environment.viewportHeight}if(typeof TVNC.rcParams.fitmode!=
"undefined"){fitmode=TVNC.rcParams.fitmode;if(fitmode!=undefined&&typeof fitmode=="string"&&fitmode.toLowerCase()!="fixed"&&fitmode.indexOf("x")>0){fitmode="&fitmode=1";var res=fitmode.split("x");w=res[0];h=res[1]}}else if(TVNC.rcParams.resolution=="fittobrowser")fitmode="&fitmode=0";else if(TVNC.rcParams.resolution=="fittoscreen")fitmode="&fitmode=2";else if(TVNC.rcParams.resolution=="fixed"){fitmode="&fitmode=1";w=TVNC.rcParams.width;h=TVNC.rcParams.height}else if(TVNC.rcParams.resolution.indexOf("x")>
0){fitmode="&fitmode=1";var res=TVNC.rcParams.resolution.split("x");w=res[0];h=res[1]}var pos=TVNC.vncdiv!=null?TVNC.findPos(TVNC.vncdiv):[0,0];var offset={"left":pos[0],"top":pos[1]};args+="&browserWidth="+(w-offset.left)+"&browserHeight="+(h-offset.top);args+="&screenWidth="+screenWidth+"&screenHeight="+screenHeight;args+=fitmode;return args};var isLandscape=window.environment.currentOrientation=="landscape"?true:false;var args="cmd=start&subcmd=restart"+buildResolutionArgs()+"&devicePixelRatio="+
(environment.initialDevicePixelRatio||1)+"&isMobile="+agentInfo.isMobile+"&isLandscape="+isLandscape+"&supportsFullScreen="+window.environment.supportsFullScreen+"&webapp="+window.environment.webapp;TVNC.start(args)}function restart(hasBeenLost){if(hasBeenLost)helper.console.error("The Connection has been lost.",null,arguments);if(_isSessionEnded){helper.console.error("The Session has ended. Cannot restart the connection.",null,arguments);return}helper.console.warning("Restarting connection...",null,
arguments);if(_comm.state>=Thinfinity.Communication.state.CLOSING)return;TVNC.rcParams.clientAck=-1;TVNC.rcParams.clientAck=TVNC.rcParams.clientAck<=0&&!TVNC.useAjax?0:Math.max(TVNC.rcParams.clientAck,1);if(_fromBroker)_url.baseUrl=_virtualPathProfile;TVNC.reconnect()}this.rop3CanvasNoType=function(context,cmd,imageData,auxImageData){var data=imageData.data;var auxData=auxImageData.data;for(var offset=0;offset<cmd.cx*cmd.cy*4;offset+=4){var auxDataPixel=auxData[offset]|auxData[offset+1]<<8|auxData[offset+
2]<<16;var dataPixel=data[offset]|data[offset+1]<<8|data[offset+2]<<16;dataPixel=this.doROP3(cmd.o,auxDataPixel,dataPixel,cmd.bc,cmd.fc);data[offset]=dataPixel&255;data[offset+1]=dataPixel>>>8&255;data[offset+2]=dataPixel>>>16&255;data[offset+3]=255}context.putImageData(imageData,cmd.x,cmd.y)};this.rop3CanvasU32=function(context,cmd,imageData,auxImageData){var data=new Uint32Array(imageData.data.buffer);var auxData=new Uint32Array(auxImageData.data.buffer);for(var offset=0;offset<cmd.cx*cmd.cy;offset++)data[offset]=
this.doROP3(cmd.o,auxData[offset]&16777215,data[offset]&16777215,cmd.bc,cmd.fc)|4278190080;context.putImageData(imageData,cmd.x,cmd.y);auxData=data=null};this.rop3Canvas=agentInfo.hasTypedArrays?this.rop3CanvasU32:this.rop3CanvasNoType;this.u8ArrayToDataUri=function(mime,raw){if(_blob.on&&raw.length>_blob.threshold)return _urlCreator.createObjectURL(new Blob([raw],{type:mime}));else return"data:"+mime+";base64,"+window.btoa(TVNC.arbufToStringU8(raw))};this.arbufToStringU8ConcatMethod=function(data){var str=
"";var len=data.byteLength;for(var i=0;i<len;i++)str+=String.fromCharCode(data[i]);return str};this.arbufToStringU8ApplyMethod=function(data){if(data.length<UintArrayConfig["size"])return String.fromCharCode.apply(null,data);else{var str="";var i=0;var n=data.length;while(i<n)str+=String.fromCharCode.apply(null,data[UintArrayConfig["sliceMethod"]](i,i+=UintArrayConfig["size"]));return str}};this.arbufToStringU8=UintArrayConfig["method"]=="apply"?this.arbufToStringU8ApplyMethod:this.arbufToStringU8ConcatMethod;
function clone(oldObject){return $.extend(true,{},oldObject)}this.crossDomain=function(){return TVNC.crossdomain||TVNC.rcParams.isCrossDomain};this.completeAjaxParams=function(params){if(TVNC.crossDomain()){params.beforeSend=function(xhr){xhr.withCredentials=true};params.crossDomain=true}return params};function initializeImageQueue(sessionId){if(TVNC.imgQueue==null||TVNC.imgQueue.sessionId!=sessionId){helper.console.log("Initializing Image Queue");this.imageCache2=[new Array(600),new Array(600),new Array(2048),
new Array(4096),new Array(2048)];this.imageCacheV=[new Array(200),new Array(200),new Array(200),new Array(200),new Array(200)];TVNC.purgeImageQueue(TVNC.imgQueue);TVNC.imgQueue=null;TVNC.imgQueue=TVNC.createImageQueue(sessionId);_usedImgQueueItems=[]}}this.createImageQueue=function(sessionId){var newItem={"sessionId":sessionId,"items":{},"loaded":0,"startTime":0,"count":0,"group":0,"aborted":function(){return false},"timeout":450,"watchdogTimer":null,"watchdogStart":function(){var self=this;this.startTime=
(new Date).getTime();if(this.watchdogTimer!==null){logError("imageQueue watchdog already running!");this.watchdogStop()}this.watchdogTimer=setTimeout(function(){if(self.timeout>0)logError("imageQueue idx: "+TVNC.resumeItem.qidx+" timeout at "+((new Date).getTime()-self.startTime)+" ms!");if(TVNC.resumeItem){TVNC.resumeItem.processed=true;if(TVNC.executeDeferred)TVNC.executeDeferred();else logDebug("Missing function executeDeferred. --\x3e TVNC.executeDeferred()")}},this.timeout)},"watchdogStop":function(){if(this.watchdogTimer!==
null){clearTimeout(this.watchdogTimer);self.timeout=1E3;this.watchdogTimer=null}}};return newItem};this.purgeImageQueue=function(imgQueue){if(!imgQueue)return;imgQueue.watchdogStop();for(var i=0;i<imgQueue.items.length;i++){var item=imgQueue.items[i];if(item)if(!item.purgeAll)logDebug("Not an item object in imgQueue, idx: "+i);else{item.purgeAll();TVNC.returnImageItem(item)}delete imgQueue.items[i]}};function ab2str(buf){return String.fromCharCode.apply(null,new Uint16Array(buf))}function str2ab(str){var buf=
new ArrayBuffer(str.length*2);var bufView=new Uint16Array(buf);for(var i=0,strLen=str.length;i<strLen;i++)bufView[i]=str.charCodeAt(i);return buf}function getImageCacheList(usecompression){if(TVNC.dbFiles.length>0){var dbSrc=TVNC.dbFiles.join("-");if(usecompression){var dbZip=new Zlib.RawDeflate(dbSrc);var dbB64=$.base64.encode(dbZip);return dbB64}else return dbSrc}else return""}this.toDataUrl=function(url,callback){helper.ajax.get({"url":url,"responseType":"blob","success":function(response){var reader=
new FileReader;reader.onloadend=function(){callback(reader.result)};reader.readAsDataURL(response)}})};this.convertImgURLToBase64=function(source,type,callback){var loadImage=function(internalCallback){var img=new Image;img.crossOrigin="Anonymous";img.onload=function(e){if(typeof e.target.complete=="undefined"||e.target.complete==true)internalCallback(img,e);else{var maxTimes=10;var countTimes=0;function retryLoadImage(){setTimeout(function(){if(countTimes>maxTimes){helper.console.warning("Cannot get image source.",
arguments);internalCallback(null)}else if(typeof e.target.complete=="undefined"||e.target.complete==true)internalCallback(img,e);else retryLoadImage();countTimes++},50)}}};img.onerror=function(e){internalCallback(null,e)};img.onabort=function(e){internalCallback(null,e)};img.srcImage=souce;img.src=source};loadImage(function(img,e){if(img){var canvas=document.createElement("canvas");canvas.appendChild(img);var base64=canvas.toDataURL(type);callback(type,base64)}else callback(type,null)})};this.getBasicHTMLImg=
function(url){if(url)return'<html><body>\x3c!--StartFragment--\x3e<img src="'+url+'"/>\x3c!--EndFragment--\x3e</body></html>';else return null};function getClipboardInterface(){if(!_oClipboard){let _clipboard={};let permissions={};Object.defineProperty(permissions,"fileTransfer",{configurable:false,enumerable:true,get:function(){return TVNC.rcParams.clipboardFileTransfer}});_oClipboard=(new Thinfinity.Object.Interface({defaultEventFire:{async:0}})).new(new Thinfinity.Object.IConfig({namespace:true,
options:[Thinfinity.Object.IConfig.OPTIONS.DO_NOT_FULL_EXTEND_OBJECT],object:TVNC,properties:[{source:"KeyboardHandler.kbdInput",ro:true,alias:"inputElement"},{source:"vncdiv",ro:true,alias:"parentElement"},{source:permissions,ro:true,alias:"permissions"},{source:"enable",ro:true,get:function(){return TVNC.rcParams.clipboard}},{source:"synchronizeClipboard",ro:true,get:function(){return TVNC.rcParams.synchronizeClipboard}}],methods:[{alias:"output",value:function(jData){if(jData.cmd)switch(jData.cmd.toLowerCase()){case "focus":_displayManager.focus();
break;case "settext":_displayManager.textValue=jData.value;break;case "maccmd":if(jData.value==="RELEASED")_displayManager.updateMacCmd(Thinfinity.Driver.Keyboard.MAC_CMD.RELEASED);break}}},{alias:"sendData",value:function(url,data){if(TVNC.useAjax){var url=_url.httpConnection+"cmd?id="+url;_comm.post({"url":url,"data":data})}else{var cmd=url+"&linemode=LF&data="+data;TVNC.sendCmd(cmd)}}},{alias:"request",value:function(params){params.url=TVNC.addExtraParams(_url.httpConnection+params.url);var cors=
TVNC.crossdomain||TVNC.rcParams.isCrossDomain;if(cors&&_comm.protocol!==_args.comm.protocol.AJAX)params.xhrFields={"withCredentials":true};_comm.send(params)}},{alias:"convertImgURLToBase64",value:TVNC.convertImgURLToBase64},{alias:"getBasicHTMLImg",value:TVNC.getBasicHTMLImg},{alias:"sendEvent",value:TVNC.sendEvent},{alias:"setSelectionRange",value:function(){_displayManager.setSelectionRange(0,_displayManager.textValue.length)}},{alias:"getTextValue",value:function(){return _displayManager.textValue}},
{alias:"clearText",value:function(){_displayManager.textValue=""}}],events:{copy:TVNC.rcParams.events.onCopy,paste:TVNC.rcParams.events.onPaste,cut:TVNC.rcParams.events.onCut,localPaste:function(){if(_preventKeys.available){TVNC.sendKey(86,0,"down",0);TVNC.sendKey(86,0,"up",0);return true}else return false},copyFiles:TVNC.rcParams.events.onCopyFiles}}));_iClipboard=_oClipboard.new}return{oObject:_oClipboard,iObject:_iClipboard}}this.findPos=function(obj){var curleft=0;var curtop=0;do{curleft+=obj.offsetLeft;
curtop+=obj.offsetTop}while(obj=obj.offsetParent);return[curleft,curtop]};this.emptyRecycleImg=function(onetime){while(TVNC.queueRecycleImg.length>0){img=TVNC.queueRecycleImg.pop();img=null}if(onetime==true)return;clearTimeout(TVNC.emptyRecycleImgTimeout);TVNC.emptyRecycleImgTimeout=setTimeout(TVNC.emptyRecycleImg,TVNC.recycleImgTimeoutValue)};this.setMaxSize=function(width,height){TVNC.rcParams.maxWidth=width;TVNC.rcParams.maxHeight=height};this.splitKey=function(key){var sk;if(!key.length)sk={"isVolatile":false,
"arr":0,"pos":key};else{sk={"isVolatile":key.length>6,"arr":parseInt(key.substring(0,2),10)};sk.pos=parseInt(sk.isVolatile?key.substring(6):key.substring(2,6),10)}return sk};this.getFromImageCache=function(key){var sk=this.splitKey(key);if(sk.isVolatile)return this.imageCacheV[sk.arr][sk.pos];else return this.imageCache2[sk.arr][sk.pos]};this.setToImageCache=function(item,key){if(!item)logError("Error on setToImageCache: null item.");var sk=this.splitKey(key);if(sk.isVolatile){BTP_IMG_CHV=null;if(this.imageCacheV[sk.arr][sk.pos])TVNC.returnImageItem(this.imageCacheV[sk.arr][sk.pos]);
this.imageCacheV[sk.arr][sk.pos]=item}else{BTP_IMG_CH2=null;if(this.imageCache2[sk.arr][sk.pos])TVNC.returnImageItem(this.imageCache2[sk.arr][sk.pos]);this.imageCache2[sk.arr][sk.pos]=item}};this.createCanvas=function(win){let div=document.createElement("div");div.style.position="absolute";div.style.left=win.left-TVNC.rcParams.viewLeft+"px";div.style.top=win.top-TVNC.rcParams.viewTop+"px";let r=0;let b=0;if(productId==="virtualui"){r=typeof win.right!=="undefined"?win.right:win.left;b=typeof win.bottom!==
"undefined"?win.bottom:win.top;if(win&&win.hwnd!=0&&TVNC.rcParams?.events?.onCreateCanvas)TVNC.rcParams.events.onCreateCanvas(win)}div.style.zIndex=this.baseZIndex+win.zidx*10;let w=win.width+r;let h=win.height+b;div.width=w;div.height=h;div.style.width=w+"px";div.style.height=h+"px";div.style.display="inline-block";if(win.hwnd>0)div.style.overflow="hidden";if(win.wndClass)div.setAttribute("wndClass",win.wndClass);if(TVNC.rdpMode&&win.hwnd==1){TVNC.vncContainer.style.width=w+"px";TVNC.vncContainer.style.height=
h+"px"}if(typeof win.className!="undefined")div.className=win.className;if(!win.parent){div.mask=new Object;div.mask.color="#000";div.mask.visible=false;var canvas=document.createElement("canvas");canvas.style.left="0px";canvas.style.top="0px";canvas.width=win.width;canvas.height=win.height;canvas.style.position="absolute";canvas.style.zIndex=1;canvas.style.width=win.width;canvas.style.height=win.height;canvas.hwnd=win.hwnd;helper.dom.addEvent(canvas,"contextmenu",function(e){if(e)e.preventDefault();
return false});div.canvas=canvas;div.appendChild(canvas)}if(agentInfo.isMobile)helper.dom.addEvent(div,"click",function(){});if(this.canvasInitiallyHidden&&win.hwnd!=0&&!win.parent){div.style.display="none";TVNC.fireCustomEvents("canvasInitiallyHidden",win)}div.id=productId+"_canvas_"+win.hwnd;var parentDiv=this.vncContainer;if(helper.object.validate(win.parent)&&win.parent!=0){div.parent=win.parent;parentDiv=document.getElementById(productId+"_canvas_"+win.parent);if(parentDiv)parentDiv.appendChild(div);
else{div.style.display="none";div.style.visibility="hidden";if(!this.canvasInitiallyHidden&&win.hwnd!=0)TVNC.fireCustomEvents("canvasHidden",win);this.vncContainer.appendChild(div)}}else parentDiv.appendChild(div);for(var i=this.vncContainer.childNodes.length-1;i>=0;i--){var elem=this.vncContainer.childNodes[i];if(elem.parent){var parentCanvas=document.getElementById(productId+"_canvas_"+elem.parent);if(parentCanvas){parentCanvas.appendChild(elem);elem.style.display="inline";if(elem.parent!=0)TVNC.fireCustomEvents("canvasShow",
elem.parent)}}}if(TVNC.controlFactory)TVNC.controlFactory.insertPending();return div};this.decode=function(data){return codec.decode(data)};this.cacheFont=function(cmd){var glyph=new RdpGlyph(cmd.fnt,cmd.chr,cmd.ofs,cmd.bl,cmd.w,cmd.h,this.decode(cmd.data));if(glyph.font<12&&glyph.character<256)this.rdpGlyphArray[glyph.font][glyph.character]=glyph;else throw logError("put font: font="+glyph.font+" c="+glyph.character),"Could not put font in cache";};this.getGlyph=function(font,character){if(font<
12&&character<256){var glyph=this.rdpGlyphArray[font][character];if(glyph!=null)return glyph}throw logError("Could not get Font:"+font+", "+character);};this.clearFontCache=function(){for(var i=0;i<12;i++)for(var j=0;j<256;j++){delete this.rdpGlyphArray[i][j];this.rdpGlyphArray[i][j]=null}};this.clearImageCache=function(){var i,j;try{for(i=0;i<this.imageCache2.length;i++){for(j=0;j<this.imageCache2[i].length;j++)if(this.imageCache2[i][j]){delete this.imageCache2[i][j].data;this.imageCache2[i][j]=
null}for(j=0;j<this.imageCacheV[i].length;j++)if(this.imageCacheV[i][j]){delete this.imageCacheV[i][j].data;this.imageCacheV[i][j]=null}}}catch(e){logError(e.Message)}};this.clearTextCache=function(){for(var i=0;i<this.textCache.length;i++){delete this.textCache[i];this.textCache[i]=null}};this.cachePutText=function(cache_id,data,idx,len){var carray=Array(len);for(n=0;n<len;n++)carray[n]=data[idx+n];textEntry=new TextEntry(len,carray);if(cache_id<this.textCache.length)this.textCache[cache_id]=textEntry;
else throw"Could not put Text in cache";};this.cacheGetText=function(cache_id){var entry=null;if(cache_id<this.textCache.length){entry=this.textCache[cache_id];if(entry!=null&&entry.data!=null)return entry}};this.toRGB=function(color){var rgb="rgba("+(color>>16&255)+",";rgb+=(color>>8&255)+",";rgb+=(color&255)+",1)";return rgb};this.putRdpText=function(cmd,context){var text=this.decode(cmd.text),idx=0,ch=0;if(cmd.bcx!=-1){context.fillStyle=this.toRGB(cmd.bc);context.fillRect(cmd.bx,cmd.by,cmd.bcx,
cmd.bcy);cmd.lx=cmd.bx;cmd.ly=cmd.by;cmd.lcx=cmd.bcx;cmd.lcy=cmd.bcy}else if(cmd.mm==1){context.fillStyle=this.toRGB(cmd.bc);context.fillRect(cmd.lx,cmd.ly,cmd.lcx,cmd.lcy)}cmd.maxX=cmd.lx+cmd.lcx-1;cmd.maxY=cmd.ly+cmd.lcy-1;if(cmd.lcx*cmd.lcy==0)return;var imgdata=null;var length=cmd.len;var j=0;var vert=(cmd.fl&4)==4;var horiz_implicit=(cmd.fl&32)!=0;while(j<length)switch(text[j]&255){case 255:if(j+2<cmd.len)this.cachePutText(text[j+1],text,0,text[j+2]&255);else throw"Index out of range!";length-=
j+3;text=text.slice(j+3);j=0;break;case 254:var entry=this.cacheGetText(text[j+1]&255);if(entry){if(entry.data[1]==0&&!horiz_implicit)if(!vert)cmd.x+=text[j+2]&255;else cmd.y+=text[j+2]&255;for(k=0;k<entry.size;k++){if(!imgdata)imgdata=context.getImageData(cmd.lx,cmd.ly,cmd.lcx,cmd.lcy);k+=this.doGlyph(context,imgdata,cmd,entry.data,k)}}j+2<length?j+=3:j+=2;length-=j;text=text.slice(j);j=0;break;default:if(!imgdata)imgdata=context.getImageData(cmd.lx,cmd.ly,cmd.lcx,cmd.lcy);j+=this.doGlyph(context,
imgdata,cmd,text,j);j++}if(imgdata)context.putImageData(imgdata,cmd.lx,cmd.ly)};this.doGlyph=function(context,imgdata,cmd,text,idx){var xyoffset=0,j=0,advanceCount=0,Bpp=Math.floor((cmd.bpp+7)/8);glyph=this.getGlyph(cmd.fnt,text[idx+j]&255);if(glyph){if(!(cmd.fl&32))if(cmd.oc)if(cmd.fl&4)cmd.y+=cmd.oc;else cmd.x+=cmd.oc;else{xyoffset=text[idx+ ++j]&255;advanceCount+=1;if(xyoffset==128){xyoffset=text[idx+j+1]&255|(text[idx+j+2]&255)<<8;advanceCount+=2}if(cmd.fl&4)cmd.y+=xyoffset;else cmd.x+=xyoffset}this.drawGlyph(context,
imgdata,cmd,glyph,Bpp);if(cmd.fl&32)cmd.x+=cmd.oc?cmd.oc:glyph.width}return advanceCount};this.drawGlyph=function(context,imgdata,cmd,glyph,Bpp){var x=cmd.x+glyph.offset&65535,y=cmd.y+glyph.baseLine&65535,dataWidth=Math.ceil(glyph.width/8)*8,glyphWidth=glyph.width,glyphHeight=glyph.height,fontData=glyph.fontData,desktopWidth=TVNC.rcParams.viewWidth,desktopHeight=TVNC.rcParams.viewHeight,foreColor=cmd.fc,backColor=cmd.bc,bit=128,line,pixel;if(x+glyphWidth<cmd.lx||x>cmd.maxX||y+glyphHeight<cmd.ly||
y>cmd.maxY)return;var data=imgdata.data;if(!(x>desktopWidth||y>desktopHeight))for(line=0;line<glyphHeight;line++)if(line+y>=cmd.ly&&line+y<=cmd.maxY)for(var pixel=0;pixel<glyphWidth;pixel++)if(pixel+x>=cmd.lx&&pixel+x<=cmd.maxX){var pixelOffset=((line+(y-cmd.ly))*cmd.lcx+pixel+(x-cmd.lx))*4;var byteIndex=Math.floor((line*dataWidth+pixel)/8);bit=fontData[byteIndex]>>7-pixel%8&1;try{if(bit)this.setPixel(data,pixelOffset,foreColor);else if(cmd.mm==1)this.setPixel(data,pixelOffset,backColor)}catch(err){logError(err)}}};
this.setPixel32=function(data,pixelOffset,color){data[pixelOffset]=color};this.setPixel=function(data,pixelOffset,color){data[pixelOffset]=color>>16&255;data[pixelOffset+1]=color>>8&255;data[pixelOffset+2]=color&255;data[pixelOffset+3]=255};this.doROP=function(rop,src,dst){switch(rop){case 0:return 0;case 1:return~(src|dst);case 2:return~src&dst;case 3:return~src;case 4:return src&~dst;case 5:return~dst;case 6:return src^dst;case 7:return~(src&dst);case 8:return src&dst;case 9:return~src^dst;case 10:return dst;
case 11:return~src|dst;case 12:return src;case 13:return src|~dst;case 14:return src|dst;case 15:return~0;case 16:return~src&~dst}return dst};this.doROP3=function(rop,src,dst,bc,fc){switch(rop){case 0:return 0;case 1:return~(src|dst);case 2:return~src&dst;case 3:return~src;case 4:return src&~dst;case 5:return~dst;case 6:return src^dst;case 7:return~(src&dst);case 8:return src&dst;case 9:return~src^dst;case 10:return dst;case 11:return~src|dst;case 12:return src;case 13:return src|~dst;case 14:return src|
dst;case 15:return~0;case 16:return~src&~dst;case 17:return~src&fc;case 18:return src==0?bc:fc;case 19:return dst|(fc|~src);case 20:return src==0?bc^dst:fc^dst;case 21:return src&fc|~src&dst;case 22:return src&~fc;case 23:return dst^~fc}return dst};this.registerDrawCmd=function(cmd,callback){TVNC.registeredDrawCmds[cmd]=callback};this.registerOOBCmd=function(cmd,callback){TVNC.registeredOOBCmds[cmd]=callback};this.unregisterOOBCmd=function(cmd){if(cmd&&TVNC.registeredOOBCmds[cmd])delete TVNC.registeredOOBCmds[cmd]};
this.fireOOBCmd=function(cmd,data){var res=false;if(typeof TVNC.registeredOOBCmds[cmd]!="undefined"){res=true;try{TVNC.registeredOOBCmds[cmd](data,cmd==="vchannel"?_url:null)}catch(error){helper.console.log(`Cannot process this package with OOB handler: [cmd:${cmd}, data:${JSON.stringify(data)}]`,arguments)}}return res};this.registerCustomCmd=function(cmds,callback){var fnRegistered=function(cmd){if(TVNC.registeredCustomCmds[cmd]==undefined)TVNC.registeredCustomCmds[cmd]=[];TVNC.registeredCustomCmds[cmd].push(callback)};
if(cmds&&callback&&typeof callback=="function")if(cmds instanceof Array)for(var i=0;i<cmds.length;i++)fnRegistered(cmds[i]);else fnRegistered(cmds)};this.unregisterCustomCmd=function(cmds,callback){var fnUnregistered=function(cmd){if(TVNC.registeredCustomCmds[cmd])for(var i=TVNC.registeredCustomCmds[cmd].length-1;i>=0;i--)if(TVNC.registeredCustomCmds[cmd][i]==callback)TVNC.registeredCustomCmds[cmd].splice(i,1)};if(cmds&&callback&&typeof callback=="function")if(cmds instanceof Array)for(var j=0;j<
cmds.length;j++)fnUnregistered(cmds[j]);else fnUnregistered(cmds)};this.registerCustomDataType=function(dataType,handler){if(handler instanceof Function)TVNC.registeredCustomDataTypes[dataType]=handler};this.unregisterCustomDataType=function(dataType){if(TVNC.registeredCustomDataTypes[dataType])delete TVNC.registeredCustomDataTypes[dataType]};TVNC.registeredCustomDataTypes[7]=function(){};this.fireCustomEvents=function(cmd,obj){if(cmd&&TVNC.registeredCustomCmds[cmd])for(var i=0;i<TVNC.registeredCustomCmds[cmd].length;i++)try{TVNC.registeredCustomCmds[cmd][i](obj)}catch(error){}};
this.fireCustomEvents=function(cmd,obj){if(cmd&&TVNC.registeredCustomCmds[cmd])for(var i=0;i<TVNC.registeredCustomCmds[cmd].length;i++)try{TVNC.registeredCustomCmds[cmd][i](obj)}catch(error){}};this.drawCmdFillRect=function(cmd,context){var isXOR=cmd.pm&&cmd.pm==14;var isBSHollow=cmd.bs&&cmd.bs==1;if(isXOR){context.save();try{var imgdata=null;try{imgdata=context.getImageData(cmd.x,cmd.y,cmd.w,cmd.h)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
imgdata=context.getImageData(cmd.x,cmd.y,cmd.w,cmd.h)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(imgdata){var data=imgdata.data;var canPaint=true;var x,y=0,offset=0,r,g,b,pixel,color;for(y=0;y<cmd.h;y++)for(x=0;x<cmd.w;x++,offset+=4){canPaint=!isBSHollow||(y==0||y==cmd.h-1)||(x==0||x==cmd.w-1);if(canPaint){if(isXOR){r=4294967295&imgdata.data[offset];g=4294967295&imgdata.data[offset+1];b=4294967295&imgdata.data[offset+2];pixel=r<<16&16777215|g<<8&16777215|b;color=this.doROP(6,
pixel,4294967295&cmd.clr)}else color=4294967295&cmd.clr;this.setPixel(data,offset,color)}}context.putImageData(imgdata,cmd.x,cmd.y)}}finally{context.globalCompositeOperation="source-over";context.restore()}}else{context.fillStyle=this.toRGB(cmd.clr);if(cmd.pm&&cmd.pm==14)context.globalCompositeOperation="xor";context.fillRect(cmd.x,cmd.y,cmd.w,cmd.h);context.globalCompositeOperation="source-over"}};this.drawCmdLineTo=function(cmd,context){context.save();try{if(cmd.cw&&cmd.ch){context.beginPath();
context.rect(cmd.cl,cmd.ct,cmd.cw,cmd.ch);context.clip()}var isHorizOrVert=false;var lineW=1,lineH=1;if(cmd.ey-cmd.y==0){isHorizOrVert=true;lineW=cmd.w;if(lineW==0)lineW=1}if(cmd.ex-cmd.x==0){isHorizOrVert=true;lineH=cmd.w;if(lineH==0)lineH=1}var isXOR=cmd.o&&cmd.o==7;var isNOT=cmd.o&&cmd.o==6;if(isHorizOrVert&&isXOR){var ox=Math.min(cmd.ex,cmd.x);var oy=Math.min(cmd.ey,cmd.y);cmd.cx=Math.abs(cmd.ex-cmd.x)+lineW;cmd.cy=Math.abs(cmd.ey-cmd.y)+lineH;var imgdata=null;try{imgdata=context.getImageData(ox,
oy,cmd.cx,cmd.cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imgdata=context.getImageData(ox,oy,cmd.cx,cmd.cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(imgdata){var data=imgdata.data;var x,y=0,offset=0,r,g,b,pixel,color;for(y=0;y<cmd.cy;y++)for(x=0;x<cmd.cx;x++,offset+=4){if(isXOR||isNOT){r=4294967295&imgdata.data[offset];g=4294967295&imgdata.data[offset+
1];b=4294967295&imgdata.data[offset+2];pixel=r<<16&16777215|g<<8&16777215|b;if(isXOR)color=this.doROP(6,pixel,4294967295&cmd.fg);else color=this.doROP(3,pixel,4294967295)}else color=4294967295&cmd.fg;this.setPixel(data,offset,color)}context.putImageData(imgdata,ox,oy)}}else{if(cmd.ey-cmd.y==0){cmd.y+=.5;cmd.ey+=.5}if(cmd.ex-cmd.x==0){cmd.x+=.5;cmd.ex+=.5}context.beginPath();if(isXOR||isNOT)context.globalCompositeOperation="xor";context.moveTo(cmd.x,cmd.y);context.lineTo(cmd.ex,cmd.ey);context.lineWidth=
cmd.w;if(isNOT)context.strokeStyle=this.toRGB(4294967295);else context.strokeStyle=this.toRGB(cmd.fg);context.stroke()}}finally{context.globalCompositeOperation="source-over";context.restore()}};this.drawCmdScreenBlt=function(cmd,canvas,context){var imagedata=null;try{imagedata=context.getImageData(cmd.sx,cmd.sy,cmd.cx,cmd.cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
imagedata=context.getImageData(cmd.sx,cmd.sy,cmd.cx,cmd.cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(imagedata)context.putImageData(imagedata,cmd.x,cmd.y)};this.drawCmdScreenBltSlower=function(cmd,canvas,context){var buffer=document.createElement("canvas");buffer.width=cmd.cx;buffer.height=cmd.cy;buffer.getContext("2d",{willReadFrequently:true}).drawImage(canvas,-cmd.sx,-cmd.sy);context.drawImage(buffer,cmd.x,cmd.y)};this.getKeyFromCmd=function(group,qidx){return padZero(group,
3).concat(padZero(qidx,5))};this.drawCmdDrawEdge=function(cmd,context){cmd.ex=cmd.x+cmd.w;cmd.ey=cmd.y+cmd.h;var borderStyles={BDR_RAISEDOUTER:1,BDR_SUNKENOUTER:2,BDR_RAISEDINNER:4,BDR_SUNKENINNER:8,BDR_OUTER:3,BDR_INNER:12,BDR_RAISED:5,BDR_SUNKEN:10};var edge={EDGE_RAISED:borderStyles.BDR_RAISEDOUTER|borderStyles.BDR_RAISEDINNER,EDGE_SUNKEN:borderStyles.BDR_SUNKENOUTER|borderStyles.BDR_SUNKENINNER,EDGE_ETCHED:borderStyles.BDR_SUNKENOUTER|borderStyles.BDR_RAISEDINNER,EDGE_BUMP:borderStyles.BDR_RAISEDOUTER|
borderStyles.BDR_SUNKENINNER};var borderFlags={BF_LEFT:1,BF_TOP:2,BF_RIGHT:4,BF_BOTTOM:8,BF_DIAGONAL:16,BF_MIDDLE:2048,BF_SOFT:4096,BF_ADJUST:8192,BF_FLAT:16384,BF_MONO:32768};var borderFlag={BF_TOPLEFT:borderFlags.BF_TOP|borderFlags.BF_LEFT,BF_TOPRIGHT:borderFlags.BF_TOP|borderFlags.BF_RIGHT,BF_BOTTOMLEFT:borderFlags.BF_BOTTOM|borderFlags.BF_LEFT,BF_BOTTOMRIGHT:borderFlags.BF_BOTTOM|borderFlags.BF_RIGHT,BF_RECT:borderFlags.BF_TOP|borderFlags.BF_LEFT|borderFlags.BF_BOTTOM|borderFlags.BF_RIGHT,BF_DIAGONAL_ENDTOPRIGHT:borderFlags.BF_DIAGONAL|
borderFlags.BF_TOP|borderFlags.BF_RIGHT,BF_DIAGONAL_ENDTOPLEFT:borderFlags.BF_DIAGONAL|borderFlags.BF_TOP|borderFlags.BF_LEFT,BF_DIAGONAL_ENDBOTTOMLEFT:borderFlags.BF_DIAGONAL|borderFlags.BF_BOTTOM|borderFlags.BF_LEFT,BF_DIAGONAL_ENDBOTTOMRIGHT:borderFlags.BF_DIAGONAL|borderFlags.BF_BOTTOM|borderFlags.BF_RIGHT};context.save();if(cmd.pm&&cmd.pm==14)context.globalCompositeOperation="xor";context.lineWidth=cmd.pw;context.strokestyle=this.toRGB(cmd.clr);if(cmd.e==edge.EDGE_SUNKEN&&cmd.f&borderFlags.BF_SOFT==
borderFlags.BF_SOFT);if(cmd.e==edge.EDGE_RAISED&&cmd.f&borderFlags.BF_SOFT==borderFlags.BF_SOFT);if(cmd.f&borderFlags.BF_TOP==borderFlags.BF_TOP){context.beginPath();context.moveTo(cmd.x,cmd.y);context.lineTo(cmd.ex,cmd.y);context.stroke()}if(cmd.f&borderFlags.BF_LEFT==borderFlags.BF_LEFT){context.beginPath();context.moveTo(cmd.x,cmd.y);context.lineTo(cmd.x,cmd.ey);context.stroke()}if(cmd.f&borderFlags.BF_BOTTOM==borderFlags.BF_BOTTOM){context.beginPath();context.moveTo(cmd.x,cmd.ey);context.lineTo(cmd.ex,
cmd.ey);context.stroke()}if(cmd.f&borderFlags.BF_RIGHT==borderFlags.BF_RIGHT){context.beginPath();context.moveTo(cmd.ex,cmd.y);context.lineTo(cmd.ex,cmd.ey);context.stroke()}context.globalCompositeOperation="source-over";context.restore()};this.deferCall=function(item,f,params){if(!TVNC.resumeItem){TVNC.imgQueue.watchdogStop();TVNC.imgQueue.watchdogStart();TVNC.resumeItem=item;var df=function(){f.apply(null,params)};if(TVNC.deferCallBySetTimeout)setTimeout(df,1);else TVNC.resumeProcess=df}};this.executeDeferred=
function(){if(TVNC.imgQueue)TVNC.imgQueue.watchdogStop();if(!TVNC.deferCallBySetTimeout&&TVNC.resumeProcess){var rp=TVNC.resumeProcess;TVNC.resumeProcess=null;TVNC.resumeItem=null;rp()}};this.processDrawCmds=function(root,win,canvas,context){var oriContext=context;TVNC.processNextScreenEnabled=false;if(win.idx){if(!cmdCache)cmdCache=new Array(1E5);if(win.cmds){for(i=0;i<win.cmds.length;i++){var cmd=win.cmds[i];cmdCache[cmd.z]=clone(cmd)}win.cmds.splice(0,win.cmds.length)}for(i=0;i<win.idx.length;i++){var cmd=
cmdCache[win.idx[i]];win.cmds.push(clone(cmd))}}if(win.cmds){var cmd,i,img,item,sx,sy;for(i=0;i<win.cmds.length;i++){if(TVNC.offscreenCanvas)context=TVNC.offscreenCanvas.getContext("2d",{willReadFrequently:true});else context=oriContext;cmd=win.cmds[i];if(cmd.processed)continue;cmd.processed=true;if(typeof cmd.z!="undefined"){var idx=cmd.z;if(!cmdCache)cmdCache=new Array(1E5);if(typeof cmd.c=="undefined"){win.cmds[i]=clone(cmdCache[idx]);cmd=win.cmds[i]}else cmdCache[idx]=clone(cmd)}if(TVNC.enableCmdCache){for(var p in cmd)if(cmd[p]!==
""&&cmd[p]!=null)TVNC.cmdCacheProps[p]=cmd[p];else if(typeof TVNC.cmdCacheProps[p]!="undefined")delete TVNC.cmdCacheProps[p];win.cmds[i]=TVNC.cmdCacheProps;cmd=clone(TVNC.cmdCacheProps);if(typeof cmd.originalValues!="undefined"){for(var q in cmd.originalValues)TVNC.cmdCacheProps[q]=cmd.originalValues[q];delete TVNC.cmdCacheProps.originalValues;delete cmd.originalValues}}if(cmd.c=="IC"){if(typeof cmd.qidx!="undefined"&&cmd.qidx>=0&&typeof root.imgQueue!="undefined"){item=TVNC.peekImageItem(root,cmd.qidx);
if(!item)continue;if(!item.ready||!item.image||!item.image.data){win.cmds[i].processed=false;TVNC.deferCall(win.cmds[i],TVNC.processDrawCmds,[root,win,canvas,context]);return}TVNC.setToImageCache(TVNC.extractImageItem(root,cmd.qidx),cmd.k)}else{item=TVNC.getFromImageCache(cmd.k);if(!item)continue}if(!item||!item.ready){logError("Cache: image "+cmd.k+" is not loaded, qidx: "+cmd.qidx);continue}if(typeof cmd.x=="undefined")continue;sx=0,sy=0;if(typeof cmd.sx!="undefined"){sx=cmd.sx;sy=cmd.sy}if(typeof cmd.o==
"undefined"||cmd.o==12)try{item.draw(context,cmd.x,cmd.y,cmd.cx,cmd.cy,sx,sy,cmd.cx,cmd.cy)}catch(err){logError("error in item.draw():"+cmd.k+",sx:"+sx+",sy:"+sy+",cmd.x:"+cmd.x+",cmd.y:"+cmd.y+",cmd.cx:"+cmd.cx+",cmd.cy:"+cmd.cy+",img.width:"+item.getWidth()+",img.height:"+item.getHeight())}else{var auxCanvas=document.createElement("canvas");auxCanvas.width=item.getWidth();auxCanvas.height=item.getHeight();var auxContext=auxCanvas.getContext("2d",{willReadFrequently:true});try{item.draw(auxContext,
0,0)}catch(err){logError("error on auxContext.drawImage")}var auxImageData=null;try{auxImageData=auxContext.getImageData(sx,sy,cmd.cx,cmd.cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");auxImageData=auxContext.getImageData(sx,sy,cmd.cx,cmd.cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}var imagedata=null;try{imagedata=context.getImageData(cmd.x,
cmd.y,cmd.cx,cmd.cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imagedata=context.getImageData(cmd.x,cmd.y,cmd.cx,cmd.cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(auxImageData&&imagedata)TVNC.rop3Canvas(context,cmd,imagedata,auxImageData)}}else if(cmd.c=="IP"){var sx=0,sy=0;if(typeof cmd.sx!="undefined"){sx=cmd.sx;sy=cmd.sy}item=TVNC.peekImageItem(root,
cmd.qidx);if(!item)continue;if(!item.ready){win.cmds[i].processed=false;TVNC.deferCall(win.cmds[i],TVNC.processDrawCmds,[root,win,canvas,context]);return}try{item.draw(context,cmd.x,cmd.y,cmd.cx,cmd.cy,sx,sy,cmd.cx,cmd.cy)}catch(ex){logError("IP: item.draw() failed. cmd.qidx="+cmd.qidx);if(item)logError("size: "+item.getWidth()+"x"+item.getHeight())}TVNC.returnImageItem(TVNC.extractImageItem(root,cmd.qidx))}else if(cmd.c=="CB"){if(TVNC.brushCache[cmd.idx])TVNC.returnImageItem(TVNC.brushCache[cmd.idx]);
item=TVNC.extractImageItem(root,cmd.qidx);if(!item){logError("pattern cache update error; item missing");continue}TVNC.brushCache[cmd.idx]=item}else if(cmd.c=="FR")TVNC.drawCmdFillRect(cmd,context);else if(cmd.c=="PB"){var auxCanvas=document.createElement("canvas");auxCanvas.width=cmd.cx;auxCanvas.height=cmd.cy;var auxContext=auxCanvas.getContext("2d",{willReadFrequently:true});cmd.fc&=16777215;cmd.bc&=16777215;var normalProcess=true;if(cmd.bs==0){auxContext.fillStyle=TVNC.toRGB(cmd.fc);auxContext.fillRect(0,
0,cmd.cx,cmd.cy)}else{if(cmd.cidx>=0)item=TVNC.brushCache[cmd.cidx];else item=TVNC.extractImageItem(root,cmd.qidx);if(typeof item!="undefined")if(typeof item.image.data.complete=="undefined"||item.image.data.complete==true){var ptrn=auxContext.createPattern(item.image.data,"repeat");auxContext.fillStyle=ptrn;auxContext.fillRect(0,0,cmd.cx,cmd.cy)}else{normalProcess=false;TVNC.delayProcessImagePattern(auxContext,item,cmd)}else helper.console.log("pattern missing, or empty image",arguments)}if(normalProcess){var auxImageData=
auxContext.getImageData(0,0,cmd.cx,cmd.cy);var imagedata=context.getImageData(cmd.x,cmd.y,cmd.cx,cmd.cy);if(auxImageData&&imagedata)TVNC.rop3Canvas(context,cmd,imagedata,auxImageData)}}else if(cmd.c=="SB")TVNC.drawCmdScreenBlt(cmd,canvas,context);else if(cmd.c=="LI")TVNC.drawCmdLineTo(cmd,context);else if(cmd.c=="PL"){if(cmd.p.length>0){var n;var px=cmd.p[0].x;var py=cmd.p[0].y;var cx;var cy;var vertical=false;var horizontal=false;for(n=1;n<cmd.p.length;n++){cx=cmd.p[n].x;cy=cmd.p[n].y;if(cx-px==
0){if(!vertical)cmd.p[n-1].x+=.5;vertical=true;cmd.p[n].x+=.5}else vertical=false;if(cy-py==0){if(!horizontal)cmd.p[n-1].y+=.5;horizontal=true;cmd.p[n].y+=.5}else horizontal=false;px=cx;py=cy}context.save();if(cmd.cw&&cmd.ch){context.beginPath();context.rect(cmd.cl,cmd.ct,cmd.cw,cmd.ch);context.clip()}if(cmd.pm&&cmd.pm==14)context.globalCompositeOperation="xor";context.beginPath();context.moveTo(cmd.p[0].x,cmd.p[0].y);for(n=1;n<cmd.p.length;n++)context.lineTo(cmd.p[n].x,cmd.p[n].y);context.lineWidth=
cmd.w;context.strokeStyle=TVNC.toRGB(cmd.fg);context.stroke();context.globalCompositeOperation="source-over";context.restore()}}else if(cmd.c=="DE")TVNC.drawCmdDrawEdge(cmd,context);else if(cmd.c=="CR"){context.save();if(cmd.r.length==0){context.beginPath();context.rect(0,0,0,0);context.clip()}else{context.beginPath();for(n=0;n<cmd.r.length;n++){var r=cmd.r[n];context.rect(r.x,r.y,r.cx,r.cy)}context.clip()}}else if(cmd.c=="ER"){var canvasid="canvasER";TVNC.canvasER=document.getElementById(canvasid);
if(!TVNC.canvasER){TVNC.canvasER=document.createElement("canvas");TVNC.canvasER.style.zIndex=TVNC.baseZIndex+499;TVNC.canvasER.style.position="absolute";TVNC.canvasER.style.left="0px";TVNC.canvasER.style.top="0px";TVNC.canvasER.id=canvasid;TVNC.vncContainer.appendChild(TVNC.canvasER)}addValidCanvas(TVNC.canvasER);TVNC.canvasER.width=TVNC.rcParams.viewWidth;TVNC.canvasER.height=TVNC.rcParams.viewHeight;var auxContext=TVNC.canvasER.getContext("2d",{willReadFrequently:true});auxContext.restore();auxContext.clearRect(0,
0,TVNC.canvasER.offsetWidth,TVNC.canvasER.offsetHeight);auxContext.fillStyle=canvas.parentElement.mask.color;for(n=0;n<cmd.r.length;n++){var r=cmd.r[n];auxContext.fillRect(r.x,r.y,r.cx,r.cy)}}else if(cmd.c=="EA"){BTP_PRA_SRT=null;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onExecRemoteApp==null)$(window).trigger("execRemoteApp",[cmd]);else TVNC.rcParams.events.onExecRemoteApp([cmd])}else if(cmd.c=="EX"){BTP_PRA_STS=null;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onExecResult==
null)$(window).trigger("execResult",[cmd]);else TVNC.rcParams.events.onExecResult([cmd])}else if(cmd.c=="TX")try{TVNC.putRdpText(cmd,context)}catch(err){logError(err)}else if(cmd.c=="FC")TVNC.cacheFont(cmd);else if(cmd.c=="DB")TVNC.dstblt(context,cmd.o,0,cmd.x,cmd.y,cmd.cx,cmd.cy);else if(cmd.c=="OB")TVNC.CreateOffscreenBitmap(cmd.id,cmd.cx,cmd.cy,cmd.dlist);else if(cmd.c=="SS")TVNC.SwitchSurface(cmd.id);else if(cmd.c=="MO"){if(!cmd.sx)cmd.sx=0;if(!cmd.sy)cmd.sy=0;TVNC.MembltOffscreen(oriContext,
cmd.o,cmd.id,cmd.x,cmd.y,cmd.cx,cmd.cy,cmd.sx,cmd.sy)}else if(cmd.c=="RC")if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onRemoteCommand==null)$(window).trigger("remoteCommand",[cmd.r]);else TVNC.rcParams.events.onRemoteCommand(cmd.r);else if(cmd.c=="FD"){var mime="";if(typeof cmd.mime!="undefined")mime=cmd.mime;var fileName=cmd.fn;if(typeof cmd.url!="undefined")fileName=cmd.url;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onFileDownload==null)$(window).trigger("fileDownload",
[fileName,mime]);else TVNC.rcParams.events.onFileDownload([fileName],mime)}else if(cmd.c=="DS"){let m=cmd.m;helper.console.log(`incoming "DS" command: ${JSON.stringify(cmd)}`,arguments);if(!m)m=[{id:_displayManager.mainDisplayId,w:cmd.w,h:cmd.h,hwnd:win.hwnd}];for(let i=0,t=m.length;i<t;i++){let wnd=m[i];_displayManager.processDisplayCmd(cmd.c,wnd.id,wnd.w,wnd.h,win.hwnd,wnd.x,wnd.y)}if(window!=window.top&&typeof TVNC.rcParams.events!="undefined"&&helper.object.validate(TVNC.rcParams.events.onDesktopResize))TVNC.rcParams.events.onDesktopResize(cmd.m)}else if(cmd.c==
"PR")TVNC.processPrint(cmd);else if(cmd.c=="LE"){BTP_PCL_ERR=null;try{helper.console.log(helper.string.format("Logon Error - code: {0}, data: {1}, description: {2}",cmd.ec,cmd.d,cmd.s),arguments)}catch(error){helper.console.warning("Cannot log 'LogonError'",error,arguments)}}else if(cmd.c=="CU"){_CUEnabled=true;item=TVNC.peekImageItem(root,cmd.qidx);if(!item)continue;if(!item.ready){win.cmds[0].processed=false;TVNC.deferCall(win.cmds[0],TVNC.processDrawCmds,[root,win,canvas,context]);return}if(item.image.data){let dx=
item.image.data.width-cmd.hx;let dy=item.image.data.height-cmd.hy;_displayManager.fireEvent("setCursor",{"src":item.image.data,"x":dx,"y":dy,"url":`url(${item.image.data.srcImage||item.image.data.src}) ${dx} ${dy}, auto`})}}else if(typeof TVNC.registeredDrawCmds[cmd.c]!="undefined")TVNC.registeredDrawCmds[cmd.c](cmd,win,context)}}TVNC.processImages(root,win,oriContext)};this.delayProcessImagePattern=function(ctx,item,cmd){helper.console.log("delayProcessImagePattern on image idx: "+item.idx,arguments);
var iCount=0;var createPattern=function(ctx,item,cmd){var ptrn=ctx.createPattern(item.image.data,"repeat");ctx.fillStyle=ptrn;ctx.fillRect(0,0,cmd.cx,cmd.cy);var auxImageData=ctx.getImageData(0,0,cmd.cx,cmd.cy);var imagedata=ctx.getImageData(cmd.x,cmd.y,cmd.cx,cmd.cy);if(auxImageData&&imagedata)TVNC.rop3Canvas(ctx,cmd,imagedata,auxImageData)};var processImagePattern=function(){if(iCount<5){if(typeof item.image.data.complete=="undefined"||item.image.data.complete==true)createPattern(ctx,item,cmd);
else setTimeout(function(){processImagePattern()},25);iCount++}else helper.console.log("cannot load this image: "+item.idx+" ,is not completed",arguments)};processImagePattern()};this.CreateOffscreenBitmap=function(id,cx,cy,dlist){if(this.offscreenCache[id])delete this.offscreenCache[id];var canvas=document.createElement("canvas");canvas.visibility="visible";canvas.display="block";canvas.style.position="absolute";canvas.style.left=-cx;canvas.style.top=-cy;canvas.style.zIndex=-1;canvas.width=cx;canvas.height=
cy;this.offscreenCache[id]=canvas;for(var i=0;i<dlist.length;i++)if(this.offscreenCache[dlist[i]]){delete this.offscreenCache[dlist[i]];this.offscreenCache[dlist[i]]=null}};this.SwitchSurface=function(id){if(id==65535)this.offscreenCanvas=null;else this.offscreenCanvas=this.offscreenCache[id]};this.MembltOffscreen=function(context,o,id,x,y,cx,cy,sx,sy){var srcContext=this.offscreenCache[id].getContext("2d",{willReadFrequently:true});var srcImageData=srcContext.getImageData(sx,sy,cx,cy);context.putImageData(srcImageData,
x,y)};this.clearOffscreenCache=function(){for(var i=0;i<this.offscreenCache.length;i++){if(this.offscreenCache[i])delete this.offscreenCache[i];this.offscreenCache[i]=null}};this.dstblt=function(context,rop,srccolor,x,y,cx,cy){var imagedata=null;try{imagedata=context.getImageData(x,y,cx,cy)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imagedata=context.getImageData(x,
y,cx,cy)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}if(imagedata){var data=imagedata.data;var offset=0;for(var line=0;line<cy;line++)for(var col=0;col<cx;col++,offset+=4){var color=srccolor;if(rop!=12){var r=4294967295&data[offset];var g=4294967295&data[offset+1];var b=4294967295&data[offset+2];var pixel=r<<16&16777215|g<<8&16777215|b;color=this.doROP(rop,color,pixel)}data[offset]=color>>16&255;data[offset+1]=color>>8&255;data[offset+2]=color&255}imagedata.data=data;context.putImageData(imagedata,
x,y)}};this.revokeImageUrl=function(){var d=((new Date).getTime()-4*1E3).toString();for(var k in _blob.processedScreenUrl)if(k<=d){for(var i=0;i<_blob.processedScreenUrl[k].length;i++)_urlCreator.revokeObjectURL(_blob.processedScreenUrl[k][i]);delete _blob.processedScreenUrl[k]}else break};this.addRevokeObjectURL=function(items){if(!_blob.revoked){var bUrls=[];var d=(new Date).getTime();for(var k in items)if(items[k]&&items[k].image&&items[k].image.data&&items[k].image.data.blobImage&&!items[k].image.data.mouseImage)bUrls.push(items[k].image.data.srcImage||
items[k].image.data.src);if(bUrls.length>0){if(!_blob.processedScreenUrl[d])_blob.processedScreenUrl[d]=[];_blob.processedScreenUrl[d].push.apply(_blob.processedScreenUrl[d],bUrls)}}};this.addRevokeStringURL=function(src){if(!_blob.revoked)if(src!=""){var bUrls=[src];var d=(new Date).getTime();if(!_blob.processedScreenUrl[d])_blob.processedScreenUrl[d]=[];_blob.processedScreenUrl[d].push.apply(_blob.processedScreenUrl[d],bUrls)}};this.removeUsedItems=function(imgQueue){if(_usedImgQueueItems&&_usedImgQueueItems.length>
0&&imgQueue){for(var i=0;i<_usedImgQueueItems.length;i++)delete imgQueue[_usedImgQueueItems[i]];_usedImgQueueItems=[]}};this.processNextScreen=function(){if(!TVNC.imagesLoading&&TVNC.processNextScreenEnabled&&TVNC.msgQueue.length>0){var m=TVNC.msgQueue.shift();TVNC.receiveScreen(m);TVNC.revokeImageUrl();if(m.imgQueue){TVNC.addRevokeObjectURL(m.imgQueue.items);TVNC.removeUsedItems(m.imgQueue.items)}}};this.incImagesLoading=function(){TVNC.imagesLoading++};this.decImagesLoading=function(){TVNC.imagesLoading--};
this.noImagesLoading=function(){return TVNC.imagesLoading==0};this.preserveOriginalValue=function(obj,prop,localCache){if(typeof localCache!="undefined"&&typeof localCache[prop]!="undefined"&&typeof obj[prop]=="undefined")obj[prop]=localCache[prop];if(typeof obj.originalValues=="undefined")obj.originalValues={};if(typeof obj[prop]=="undefined")obj[prop]=TVNC.cmdCacheProps[prop];else if(typeof localCache!="undefined")localCache[prop]=obj[prop];obj.originalValues[prop]=obj[prop]};function imgQueueItemFromImageDecoderData(u8Array,
type,hash,key){var e=this.encoded;e.width=u8Array[0]|u8Array[1]<<8;e.height=u8Array[2]|u8Array[3]<<8;e.bpp=u8Array[4];e.decoder=u8Array[5];e.option1=u8Array[6];e.option2=u8Array[7];e.offset=u8Array.buffer.byteLength-u8Array.length+8;e.size=u8Array.buffer.byteLength-e.offset;e.data=u8Array.buffer;TVNC.InsertIntoImgQueueAndExecute(key,this)}function imgQueueItemFromImageArray(u8Array,type,hash,key){var cacheEnabled=hash.length&&TVNC.fs;var insertAndExecute=true;if(u8Array.length){this.encoded.data=
TVNC.u8ArrayToDataUri("image/"+type,u8Array);if(cacheEnabled)TVNC.fs.write(hash,this.encoded.data)}else if(cacheEnabled){insertAndExecute=false;var imgItem=this;TVNC.fs.read(hash,function(stream){imgItem.encoded.data=stream;TVNC.InsertIntoImgQueueAndExecute(key,imgItem)})}if(insertAndExecute)TVNC.InsertIntoImgQueueAndExecute(key,this)}function imgQueueItemFromLegacyStringData(stringBinaryData,type,hash,key){var cacheEnabled=hash.length&&TVNC.fs;var insertAndExecute=true;if(stringBinaryData.length){this.encoded.data=
TVNC.getImageStreamFromTB64(type,window.btoa(stringBinaryData));if(cacheEnabled)TVNC.fs.write(hash,this.encoded.data)}else if(cacheEnabled){insertAndExecute=false;var imgItem=this;TVNC.fs.read(hash,function(stream){imgItem.encoded.data=stream;TVNC.InsertIntoImgQueueAndExecute(key,imgItem)})}if(insertAndExecute)TVNC.InsertIntoImgQueueAndExecute(key,this)}function drawImgQueueItem(context,x,y,w,h,sx,sy,sw,sh){if(!this.image.data){if(!sw||!sh){logError("drawImgQueueItem(): image of type "+this.image.type+
", sw and sh are null for idx # "+this.idx+", error: "+this.error);return}this.drawError(context,"#800080","#FFFFFF",x,y,sw,sh);return}if(this.image.type=="img"){if(!w)w=this.getWidth();if(!h)h=this.getHeight();if(sx!=null&&sy!=null){if(!sw)sw=w;if(!sh)sh=h;context.drawImage(this.image.data,sx,sy,sw,sh,x,y,w,h)}else context.drawImage(this.image.data,x,y,w,h)}else if(this.image.type=="canvas")if(sx!=null&&sy!=null){if(!sw)sw=this.getWidth();if(!sh)sh=this.getHeight();context.putImageData(this.image.data,
x-sx,y-sy,sx,sy,sw,sh)}else context.putImageData(this.image.data,x,y);else{logError("drawImgQueueItem(): unknown image->type for idx # "+this.idx+", error: "+this.error);return}}function drawDummyImgQueueItem(context,fillStyle,strokeStyle,x,y,w,h){context.fillStyle=fillStyle;context.strokeStyle=strokeStyle;w-=1;h-=1;context.beginPath();context.rect(x,y,w,h);context.moveTo(x,y);context.lineTo(x+w,y+h);context.moveTo(x,y+h);context.lineTo(x+w,y);context.closePath();context.fill();context.stroke()}function getImgQueueItemWidth(){if(!this.image.data)return this.encoded.width;
return this.image.data.width}function getImgQueueItemHeight(){if(!this.image.data)return this.encoded.height;return this.image.data.height}function purgeImgQueueItemEncoded(){var e=this.encoded;e.width=0;e.height=0;e.decoder=0;e.option1=0;e.option2=0;e.bpp=0;e.offset=0;e.size=0;e.data=null}function purgeImgQueueItemImage(){delete this.image.data;this.image.data=null;this.image.type=null;this.ready=false;this.error=0}function purgeImgQueueItemAll(){this.purgeEncoded();this.purgeImage()}function imgQueueItemLoadFailed(error){this.purgeAll();
this.ready=true;this.error=error?error:255;TVNC.executeDeferred()}function imgQueueItemLoadSucceeded(){this.purgeEncoded();this.ready=true;this.error=0;TVNC.executeDeferred()}function imgQueueItemSetImg(loadedCallback,errorCallback,src){this.purgeImage();this.image.type="img";this.image.data=document.createElement("img");this.image.data.detachEvents=function(){this.onload=null;this.onerror=null;this.onabort=null};this.image.data.onload=function(e){if(typeof e.target.complete=="undefined"||e.target.complete==
true){this.detachEvents();loadedCallback(e)}else{helper.console.log("Image data is not completed but it is loaded.",arguments);var maxTimes=10;var countTimes=0;function retryLoadImage(){setTimeout(function(){if(countTimes>maxTimes){helper.console.log("Cannot process this image.",arguments);return}else if(typeof e.target.complete=="undefined"||e.target.complete==true){this.detachEvents();loadedCallback(e)}else retryLoadImage();countTimes++},50)}}};this.image.data.onerror=function(e){this.detachEvents();
errorCallback(e)};this.image.data.onabort=function(e){this.detachEvents();errorCallback(e)};this.image.data.blobImage=src.substr(0,4)=="blob";this.image.data.srcImage=src;this.image.data.src=src}function imgQueueItemSetCanvas(context,arData){if(this.image.type!="canvas"||!this.image.data||this.image.width!=this.encoded.width||this.image.height!=this.encoded.height){this.purgeImage();this.image.type="canvas";this.image.data=context.createImageData(this.encoded.width,this.encoded.height)}this.image.data.data.set(new Uint8ClampedArray(arData))}
this.getImageItem=function(){return TVNC.createImgQueueItem()};this.returnImageItem=function(item){item.purgeEncoded();if(_blob.on)TVNC.addRevokeObjectURL({0:item});item=null};this.createImgQueueItem=function(){return{ready:false,error:0,image:{type:null,data:null},encoded:{width:0,height:0,decoder:0,option1:0,option2:0,bpp:0,offset:0,size:0,data:null},fromImageDecoderData:imgQueueItemFromImageDecoderData,fromImageArray:imgQueueItemFromImageArray,fromLegacyStringData:imgQueueItemFromLegacyStringData,
draw:drawImgQueueItem,drawError:drawDummyImgQueueItem,getWidth:getImgQueueItemWidth,getHeight:getImgQueueItemHeight,purgeEncoded:purgeImgQueueItemEncoded,purgeImage:purgeImgQueueItemImage,purgeAll:purgeImgQueueItemAll,loadFailed:imgQueueItemLoadFailed,loadSucceeded:imgQueueItemLoadSucceeded,setImg:imgQueueItemSetImg,setCanvas:imgQueueItemSetCanvas}};this.getImageStreamFromTB64=function(imageType,imageBase64){return"data:image/"+imageType+";base64,"+imageBase64};this.buildImgQueue=function(msg){try{var w,
win,c,cmds,cmd,i,currCmd,localCache={};msg.group=0;if(msg.windows)for(w=0;w<msg.windows.length;w++){win=msg.windows[w];if(win.cmds){cmds=win.cmds;if(typeof TVNC.cmdCacheProps["c"]!="undefined")currCmd=TVNC.cmdCacheProps["c"];for(i=0;i<cmds.length;i++){cmd=cmds[i];if(typeof cmd.c!="undefined")currCmd=cmd.c;if(currCmd=="IC"||currCmd=="IP"||currCmd=="CB"||currCmd=="PB")if(TVNC.fs||typeof cmd.d!="undefined"&&cmd.d!=="")this.addToImgQueue(msg.imgQueue,cmd,"c",localCache);else cmd.qidx=-1}}if(win.imgs){imgs=
win.imgs;for(i=0;i<imgs.length;i++){img=imgs[i];this.addToImgQueue(msg.imgQueue,img,"i")}}}}catch(e){logError("buildImgQueue error: "+e.message)}};this.addToImgQueue=function(imgQueue,oJS,srcType,localCache){oJS.qidx=++TVNC.imgIndex%99999;var idx=TVNC.getKeyFromCmd(0,oJS.qidx);if(imgQueue.items[idx])delete imgQueue.items[idx];var item=TVNC.getImageItem();var processImgItem=true;if(srcType=="c"){this.preserveOriginalValue(oJS,"t",localCache);var cacheEnabled=oJS.hash&&oJS.hash.length&&TVNC.fs;if(oJS.d.length){if(cacheEnabled)TVNC.fs.write(oJS.hash,
"data:image/"+oJS.t+";base64,"+oJS.d)}else if(cacheEnabled){processImgItem=false;TVNC.fs.read(oJS.hash,function(stream){item.encoded.data=stream;item.idx=idx;delete oJS.d;delete oJS.t;imgQueue.items[idx]=item;TVNC.processImgQueueItem(item)})}if(processImgItem)item.encoded.data="data:image/"+oJS.t+";base64,"+oJS.d}else{item.encoded.data=oJS.img;delete oJS.img}if(processImgItem){delete oJS.d;delete oJS.t;item.idx=idx;imgQueue.items[idx]=item;TVNC.processImgQueueItem(item)}};this.InsertIntoImgQueueAndExecute=
function(idx,item){if(TVNC.imgQueue.items&&TVNC.imgQueue.items[idx])delete TVNC.imgQueue.items[idx];item["idx"]=idx;TVNC.imgQueue.items[idx]=item;TVNC.imgQueue.count++;this.processImgQueueItem(item)};this.addToImgQueueAndExecute=function(imgQueue,item){var i=imgQueue.items.length;item["idx"]=i;imgQueue.items.push(item);this.processImgQueueItem(item);return i};this.processImgQueueItem=function(item){var decoderFunc=TVNC.getImageDecoder(item.encoded.decoder);if(!decoderFunc){logError("raw decoder "+
item.encoded.decoder+" not found for image key "+item.idx);item.loadFailed()}else decoderFunc(item)};this.processImgQueue=function(imgQueue){if(!imgQueue.items)return;for(var i=0;i<imgQueue.items.length;i++)this.processImgQueueItem(imgQueue,imgQueue.items[i])};this.registerImageDecoder=function(id,fnc){if(!TVNC.imageDecoders)TVNC.imageDecoders=[];TVNC.imageDecoders[id]=fnc};this.getImageDecoder=function(id){if(!TVNC.imageDecoders)return null;return TVNC.imageDecoders[id]};this.registerImageDecoder(0,
function(item){item.setImg(function(){item.loadSucceeded();TVNC.processNextScreen()},function(){item.loadFailed();logError("image # "+item.idx+" with errors")},item.encoded.data)});this.registerRawBinaryHandler=function(idList,fnc){if(!TVNC.rawBinaryHandlers)TVNC.rawBinaryHandlers=[];for(var i=0;i<idList.length;++i)TVNC.rawBinaryHandlers[idList[i]]=fnc};function getRawBinaryHandler(hid,opt1,opt2){if(!TVNC.rawBinaryHandlers)return null;if(!hid)hid=0;if(!opt1)opt1=0;if(!opt2)opt2=0;var id=(hid&255)<<
16|(opt1&255)<<8|opt2&255;return TVNC.rawBinaryHandlers[id]}this.extractImageItem=function(root,qidx){var id=TVNC.getKeyFromCmd(root.group,qidx);var item=root.imgQueue.items[id];_usedImgQueueItems.push(id);return item};this.peekImageItem=function(root,qidx){return root.imgQueue?root.imgQueue.items[TVNC.getKeyFromCmd(root.group,qidx)]:null};this.processImages=function(root,win,context){if(typeof win.imgs!=="undefined"){var imgpart,item;for(var i=0;i<win.imgs.length;i++){imgpart=win.imgs[i];if(imgpart.processed)continue;
imgpart.processed=true;if(!root.imgQueue){logError("Error on processImages: root.imgQueue not found.");return}item=TVNC.peekImageItem(root,imgpart.qidx);if(!item)continue;if(!item.ready){imgpart.processed=false;TVNC.deferCall(imgpart,TVNC.processImages,[root,win,context]);return}else try{if(win.hwnd==0)if(TVNC.rcParams.overrideCursor){if(typeof item.image.data!="undefined"&&item.image.data!=null){var mx=agentInfo.isMobile?window.devicePixelRatio:environment.xZoom/100/environment.currentDevicePixelRatio;
_displayManager.fireEvent("setCursor",{"src":item.image.data,"x":imgpart.x,"y":imgpart.y,"url":`url(${item.image.data.srcImage||item.image.data.src}) ${win.dx*mx-imgpart.x} ${win.dy*mx-imgpart.y}, auto`})}if(_blob.on&&item.image.data.blobImage){if(_blob.processedMouseUrl.length>16)_urlCreator.revokeObjectURL(_blob.processedMouseUrl.shift());_blob.processedMouseUrl.push(item.image.data.srcImage||item.image.data.src);delete root.imgQueue.items[item.idx]}else TVNC.returnImageItem(TVNC.extractImageItem(root,
imgpart.qidx))}else{_displayManager.fireEvent("drawCursor",item,imgpart,{async:0});TVNC.returnImageItem(TVNC.extractImageItem(root,imgpart.qidx))}else{item.draw(context,imgpart.x,imgpart.y);TVNC.returnImageItem(TVNC.extractImageItem(root,imgpart.qidx))}}catch(ex){logError("Error on processImages: "+ex.message)}}}if(TVNC.useBufferedCanvas)helper.animationFrame.request(function(){win.realcanvas.getContext("2d",{willReadFrequently:true}).drawImage(context.canvas,0,0)});TVNC.processWindows(root)};this.processLayerInfo=
function(root,win,div,context){if(win.layerinfo){div.layerinfo=null;if(win.layerinfo.flags)div.layerinfo=clone(win.layerinfo)}if(div.layerinfo){if((div.layerinfo.flags&2)==2){div.style.opacity=div.layerinfo.alpha/255;div.style.MozOpacity=div.layerinfo.alpha/255;div.style.filter="alpha(opacity="+div.layerinfo.alpha/2.55+")"}if((div.layerinfo.flags&1)==1&&context.canvas.width>0&&context.canvas.height>0){var color=div.layerinfo.crkey;var key={r:color>>16&255,g:color>>8&255,b:color&255};var d=10;var frame=
context.getImageData(0,0,context.canvas.width,context.canvas.height);for(var j=0;j<frame.data.length;j+=4){var r=frame.data[j];var g=frame.data[j+1];var b=frame.data[j+2];if(key.r-d<=r&&r<key.r+d&&key.g-d<=g&&g<key.g+d&&key.b-d<=b&&b<key.b+d)frame.data[j+3]=0}context.putImageData(frame,0,0)}}};this.processWindows=function(obj,success){if(success)obj.success=success;if(obj.nextWindow>=obj.windows.length)obj.success();else{var win=obj.windows[obj.nextWindow];obj.nextWindow++;TVNC.processWindow(obj,
win)}};this.processWindow=function(root,win){if(typeof win.hwnd=="undefined"){setTimeout(TVNC.reload,1);return}var canvasid=productId+"_canvas_"+win.hwnd;var canvas=document.getElementById(canvasid);if(_blob.on&&win.hwnd=="0"&&win.imgs&&win.imgs.length)for(var i=0;i<win.imgs.length;i++){var k=TVNC.getKeyFromCmd(root.group,win.imgs[i].qidx);if(helper.object.existsPath(root.imgQueue.items[k],"image.data"))root.imgQueue.items[k].image.data.mouseImage=true}if(!canvas&&win.hwnd!==0)canvas=this.createCanvas(win);
if(typeof win.className!="undefined")canvas.className=win.className;var realcanvas=canvas.canvas;if(!realcanvas)return;var context=realcanvas.getContext("2d",{willReadFrequently:true});var vw=helper.object.validate(win.width);if(win.hwnd==0){if(_blob.on&&win.imgs&&win.imgs.length)for(var i=0;i<win.imgs.length;i++){var k=TVNC.getKeyFromCmd(root.group,win.imgs[i].qidx);if(helper.object.existsPath(root.imgQueue.items[k],"image.data"))root.imgQueue.items[k].image.data.mouseImage=true}_displayManager.fireEvent("setCursor",
win)}else{var canvasid=productId+"_canvas_"+win.hwnd;var canvas=document.getElementById(canvasid);var realcanvas=null;var context=null;if(!canvas)canvas=this.createCanvas(win);if(typeof win.className!="undefined")canvas.className=win.className;realcanvas=canvas.canvas;if(!realcanvas)return;context=realcanvas.getContext("2d",{willReadFrequently:true});var vw=helper.object.validate(win.width);if(win.width==0||win.height==0){canvas.style.visibility="hidden";canvas.style.display="none";TVNC.fireCustomEvents("canvasHidden",
win);if(productId==="virtualui")if(win.hwnd!=0&&TVNC.rcParams?.events?.onReleaseCanvas)TVNC.rcParams.events.onReleaseCanvas(win)}else{if(helper.object.validate(win.left)&&(win.width==canvas.width&&win.height==canvas.height||canvas.width*canvas.height==0)){canvas.style.left=win.left-TVNC.rcParams.viewLeft+"px";canvas.style.top=win.top-TVNC.rcParams.viewTop+"px"}if(vw&&(win.width!=canvas.width||win.height!=canvas.height)||canvas.resizing)if(canvas.width*canvas.height==0){canvas.width=win.width;canvas.height=
win.height;canvas.style.width=win.width+"px";canvas.style.height=win.height+"px";realcanvas.width=win.width;realcanvas.height=win.height;realcanvas.style.width=win.width+"px";realcanvas.style.height=win.height+"px"}else if(helper.object.validate(TVNC.rcParams.events.onCanvasResize))if(TVNC.rcParams.events.onCanvasResize(win,canvas))TVNC.updateCanvasSize(canvas,win.left-TVNC.rcParams.viewLeft,win.top-TVNC.rcParams.viewTop,win.width,win.height);else canvas.resizing=true;else TVNC.updateCanvasSize(canvas,
win.left-TVNC.rcParams.viewLeft,win.top-TVNC.rcParams.viewTop,win.width,win.height);if(vw){if(productId!="virtualui")canvas.style.display="block";TVNC.fireCustomEvents("canvasShow",win);canvas.style.visibility="visible"}canvas.style.zIndex=this.baseZIndex+win.zidx*10}}if(typeof TVNC.rcParams.events!="undefined"&&helper.object.validate(TVNC.rcParams.events.onProcessWindow))TVNC.rcParams.events.onProcessWindow(root,win,canvas);if(TVNC.useBufferedCanvas){if(!realcanvas.bufferedCanvas){realcanvas.bufferedCanvas=
document.createElement("canvas");realcanvas.bufferedCanvas.width=realcanvas.width;realcanvas.bufferedCanvas.height=realcanvas.height}var bufferedContext=realcanvas.bufferedCanvas.getContext("2d",{willReadFrequently:true});win.realcanvas=realcanvas;TVNC.partialAnimationFrameUpdate(function(){TVNC.processDrawCmds(root,win,realcanvas,bufferedContext);TVNC.processLayerInfo(root,win,canvas,context);context=null})}else TVNC.partialAnimationFrameUpdate(function(){TVNC.processDrawCmds(root,win,realcanvas,
context);if(canvas)TVNC.processLayerInfo(root,win,canvas,context);context=null});if(!this.rcParams.cursorVisible)_displayManager.fireEvent("hideCursor");else if(TVNC.rcParams.overrideCursor)_displayManager.fireEvent("resetCursor");if(agentInfo.isIOS&&agentInfo.iosVersion<=7&&win.hwnd==0)_displayManager.fireEvent("setCursor","visible")};this.updateCanvasSize=function(canvas,newLeft,newTop,newWidth,newHeight){var imagedata=null;var realcanvas=canvas.canvas;canvas.resizing=false;var context=realcanvas.getContext("2d",
{willReadFrequently:true});if(realcanvas.width<newWidth||realcanvas.height<newHeight){try{imagedata=context.getImageData(0,0,realcanvas.width,realcanvas.height)}catch(e){if(helper.object.existsPath(window.netscape,"security.PrivilegeManager.enablePrivilege"))try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imagedata=context.getImageData(0,0,newWidth,newHeight)}catch(error){helper.console.log(JSON.stringify(error),arguments)}}realcanvas.width=newWidth;realcanvas.height=
newHeight;realcanvas.style.width=newWidth+"px";realcanvas.style.height=newHeight+"px";if(imagedata)context.putImageData(imagedata,0,0);else if(canvas.hwnd!==0){context.fillStyle="#CCC";context.fillRect(0,0,newWidth,newHeight)}}canvas.width=newWidth;canvas.height=newHeight;if(!isNaN(newLeft))canvas.style.left=newLeft+"px";if(!isNaN(newTop))canvas.style.top=newTop+"px";canvas.style.width=newWidth+"px";canvas.style.height=newHeight+"px";var hwnd=canvas.hwnd!=undefined&&canvas.hwnd==0?canvas.hwnd:canvas.id.indexOf("_0")!=
-1?0:1;if(productId=="thinrdp"&&hwnd==1){TVNC.vncdiv.style.width=TVNC.vncContainer.style.width=newWidth+"px";TVNC.vncdiv.style.height=TVNC.vncContainer.style.height=newHeight+"px"}imagedata=null};this.processControls=function(div,canvas){return};this.newPrintDialog=function(obj){try{if(printDialog==null)printDialog=createPrintDialog();if(!printDialog){if(typeof obj.progress=="undefined"||!obj.progress)TVNC.openPrnWindow({"url":obj.url,"title":obj.title,"obj":obj},true);return}if(helper.object.existsPath(self,
"clientSettings.PrintDialog")){if(helper.object.existsPath(self.clientSettings.PrintDialog,"DefaultMethod"))printDialog.defaultPrintMethod=self.clientSettings.PrintDialog.DefaultMethod;if(helper.object.existsPath(self.clientSettings.PrintDialog,"BypassDialog"))printDialog.bypassPrintDialog=self.clientSettings.PrintDialog.BypassDialog}var fUrl=obj.url;if(_url.httpConnection!==""){var surl=_url.httpConnection.split("/");var i=surl.length-1;var vp="";while(i>=0&&vp===""){if(surl[i]!==""){vp=surl[i];
i=0}i--}fUrl=helper.url.parseUrl(_url.httpConnection+obj.url.replace(vp,"")).toUrl()}printDialog.setDocument(fUrl,obj.title,obj.preview,obj.progress,TVNC.rcParams.events.onPrintHandler)}catch(error){if(typeof obj.progress=="undefined"||!obj.progress)TVNC.openPrnWindow({"url":obj.url,"title":obj.title,"obj":obj},true)}};this.processPrint=function(obj){var base=cookiePrefix==="VNC"?helper.url.parseUrl(location.href).toUrl("-vp-o"):_url.baseUrl;var url=base+obj.file.substring(1)+"?SID="+TVNC.rcParams.id;
if(TVNC.runInPublicServer&&window.top!=window)url="https://www.thinvnc.net"+url;obj.url=url;if(typeof TVNC.rcParams.events==="undefined"||!TVNC.rcParams.events.onFileReady)TVNC.newPrintDialog(obj);else TVNC.rcParams.events.onFileReady({"url":url,"title":obj.title,"obj":obj})};this.getProtocol=function(){var proto=TVNC.rcParams.protocol?TVNC.rcParams.protocol:window.location.protocol;return proto.toLowerCase()};this.getAjaxUrl=function(){var url="";var baseUrl="";url=TVNC.rcParams.server?TVNC.getProtocol()+
"//"+TVNC.rcParams.server:"";baseUrl=_url.baseUrl;var paths=baseUrl.substr(0,baseUrl.length-2).split("/");if(paths.length>2){url+="/"+paths[1];baseUrl=baseUrl.substr(baseUrl.indexOf("/",1))}if(TVNC.gatewayAccessKey!="")if(url.indexOf("/"+TVNC.gatewayAccessKey)<0)url+="/"+TVNC.gatewayAccessKey;url+=(baseUrl[0]!=="/"?"/":"")+baseUrl;return url};this.getCrossDomainDataType=function(){return _defaultResponseType};this.getCrossDomainUrl=function(url){return url};this.sendAck=function(){if(TVNC.rcParams.clientAck>
0)_comm.wsSend("cmd=ready")};this.sendXoff=function(){if(!TVNC.xoff&&TVNC.rcParams.xoffEnabled){helper.console.warning("***********************",arguments);helper.console.warning("SENDING XOFF CMD !!!!!!",arguments);helper.console.warning("***********************",arguments);_comm.wsSend("cmd=xoff");TVNC.xoff=true}};this.sendXon=function(){if(TVNC.xoff&&TVNC.rcParams.xoffEnabled){helper.console.warning("***********************",arguments);helper.console.warning("SENDING XON CMD !!!!!!!",arguments);
helper.console.warning("***********************",arguments);_comm.wsSend("cmd=xon");TVNC.xoff=false}};this.sendPostAjaxCmd=function(query,data){_comm.post({"url":_url.httpConnection+"cmd?"+query,"data":data})};this.sendServerCmd=function(cmd,query){if(allowSendingCommands)if(_comm.protocol===Thinfinity.Communication.protocol.AJAX){if(TVNC.rcParams.id)_comm.send(TVNC.completeAjaxParams({"queueName":this.queueRequestName,"url":_url.httpConnection+cmd+"?"+query+"&id="+this.rcParams.id,"dataType":_defaultResponseType,
"success":TVNC.serverCmdResult,"error":function(msg,xhr){TVNC.throwErrorConnection(msg,xhr)}}))}else _comm.wsSend(query+"&id="+this.rcParams.id)};this.receiveScreen=function(obj){if(!helper.object.validate(obj)||obj.status==2){setTimeout(TVNC.reload,1);return}if(obj.status==4){if(typeof obj.cmd!="undefined"&&obj.cmd=="openLinkDlg")if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onOpenLink==null)$(window).trigger("OpenLink",obj);else TVNC.rcParams.events.onOpenLink(obj);else{TVNC.processPrint(obj);
setTimeout(TVNC.reload,1)}return}if(obj.status==9){BTP_PRA_END=null;TVNC.disconnect();BTP_PS_END1=null;TVNC.dispose();return}if(helper.object.validate(obj.caret)){var fEvent=TVNC.caretX!=obj.caret.x||TVNC.caretY!=obj.caret.y;TVNC.caretX=obj.caret.x;TVNC.caretY=obj.caret.y;if(fEvent)TVNC.fireCustomEvents("updateCaretPosition",{"x":TVNC.caretX,"y":TVNC.caretY})}if(typeof obj.windows!="undefined"){obj.nextWindow=0;TVNC.processWindows(obj,function(){for(var i=TVNC.vncContainer.childNodes.length-1;i>=
0;i--){var elem=TVNC.vncContainer.childNodes[i];if(!elem)break;else if(_validCanvas.indexOf(elem)!==-1)continue;else if(elem.tagName=="CANVAS"||elem.tagName=="DIV"&&elem.id.match(/.*_canvas.*/)){var found=false;if(_CUEnabled&&elem.id==productId+"_canvas_0")found=true;for(j=0;j<obj.windows.length&&!found;j++){var canvasid=productId+"_canvas_"+obj.windows[j].hwnd;if(elem.id==canvasid||(elem.id==productId+"_canvasborder"+obj.windows[j].hwnd||cookiePrefix==="RDP"&&elem.id!==productId+"_canvas_0"))found=
true}if(elem==TVNC.canvasER)found=true;if(!found){elem.style.display="none";var hwnd=elem.id.replace(productId+"_canvas_","");if(hwnd!=0)TVNC.fireCustomEvents("canvasHidden",{"hwnd":hwnd});if(elem.mask){delete elem.mask;elem.mask=null}if(typeof TVNC.rcParams.events!="undefined"&&helper.object.validate(TVNC.rcParams.events.onDeleteWindow))TVNC.rcParams.events.onDeleteWindow(elem);elem.innerHTML="";try{TVNC.vncContainer.removeChild(elem)}catch(err){elem.innerHTML="";elem.style.display="none";logError("receiveScreen: "+
err)}elem=null}}}TVNC.processNextScreenEnabled=true;setTimeout(function(){TVNC.processNextScreen()},0)})}if(helper.object.validate(obj.sound))for(i=0;i<obj.sound.length;i++){var chunk=obj.sound[i].chunk;TVNC.sound.play(null,window.atob(unescape(chunk)))}if(!TVNC.rcParams.remotePointer&&!TVNC.rcParams.mouseControl&&!TVNC.rcParams.overrideCursor)_displayManager.fireEvent("setCursor","default");if(TVNC.rcParams.mouseControl&&!TVNC.rcParams.remotePointer&&helper.object.validate(obj.cursor))if(obj.cursor.shape!=
undefined)_displayManager.fireEvent("setCursor",obj.cursor.shape);TVNC.zoomDesktop();if(obj.status==3)if(productId=="thinrdp"&&TVNC.useAjax==true)TVNC.disconnect();else setTimeout(TVNC.reconnect,1);else if(TVNC.rcParams.active)setTimeout(TVNC.reload,1);if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onScreenReceived==null)$(window).trigger("screenReceived",obj);else TVNC.rcParams.events.onScreenReceived(obj)};function resetLastError(){oLastError.message=null;oLastError.code=null;
oLastError.date=null}this.throwErrorConnection=function(oError,xhr){errorOccurs++;clearTimeout(oLastError.timeoutId);var msg=helper.object.validate(oError)?typeof oError.message!="undefined"?oError.message:oError:"";if(errorOccurs>5){oLastError.timeoutId=setTimeout(function(){resetLastError()},oLastError.elapsedTime);if(oError!=""){oLastError.date=new Date;oLastError.message=msg;oLastError.code=typeof oError.code!="undefined"?oError.code:""}try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerError==
null)$(window).trigger("serverError",oError);else TVNC.rcParams.events.onServerError(oError);helper.console.log("'serverError' disconnecting. "+msg,arguments)}catch(error){helper.console.warning("'serverError' disconnecting. message: "+error.message,error,arguments)}TVNC.disconnect();return}else{helper.console.log("'serverError' reconnecting... "+msg,arguments);if(xhr&&xhr.status===Thinfinity.Communication.errorCode.NOT_FOUND)_comm.forceReconnect();else{_comm.restart(Thinfinity.Communication.protocol.AJAX);
TVNC.reset();TVNC.reconnect()}return}};this.stopCheckingConnectionLost=function(obj){return false};this.serverCmdResult=function(data){if(Object.startObserve)Object.startObserve();if(agentInfo.isMobile)_displayManager.fireEvent("setCursor","block");var obj=null;if(TVNC.useAjax&&!TVNC.crossDomain())obj=typeof data!="object"?JSON.parse(data):data;else obj=data;if(typeof obj=="undefined"){helper.console.error(consts.appProfileMissing+", "+consts.technicalSupport,{},arguments);obj={}}if(typeof obj.id==
"undefined")return;if(typeof obj.clipboardEnabled!="undefined"){TVNC.rcParams.clipboard=obj.clipboardEnabled;if(["ZSC"].indexOf(window.cookiePrefix)!=-1)TVNC.rcParams.synchronizeClipboard=false;else TVNC.rcParams.synchronizeClipboard=window?.customSettings?.synchronizeClipboard??window?.clientSettings?.SynchronizeClipboard??true;TVNC.rcParams.clipboardFileTransfer=obj.clipboardFileTransferEnabled||false;_displayManager.fireEvent("localEvent",{cmd:"sessionstatus",data});_preventKeys.available=["thinrdp"].indexOf(productId)!==
-1&&TVNC.rcParams.clipboard}TVNC.rcParams.sound=obj.soundEnabled;if(TVNC.rcParams.sound&&!_audioDriver){_audioDriver=new Thinfinity.Driver.Audio({methods:{sendCmd:this.sendCmd}});_packetReceiver.registerHandler(2,_audioDriver.play)}if(productId==="thinvnc"&&obj.cmd=="sessionStatus")_displayManager.processDisplayCmd("DS",0,obj.viewWidth,obj.viewHeight,null,0,0);let oData=null;let oError={message:"",code:0};if(typeof data.errormsg==="object"){oData=data.errormsg;oError={...oError,...oData}}oError.message=
(oData?.msg??obj.errormsg)||(typeof obj.errmsg!="undefined"?obj.errmsg:typeof obj.errstr!="undefined"?obj.errstr:"");oError.code=oData?.code||obj.rc||obj.code||obj.errno||0;if(obj.id==0){let resetLastError=function(){clearTimeout(oLastError.timeoutId);oLastError.timeoutId=setTimeout(function(){resetLastError()},oLastError.elapsedTime);if(oError!=""&&typeof oError.code!="undefined"){oLastError.date=new Date;oLastError.message=oError.message;oLastError.code=oError.code}};BTP_PS_ERR=null;if(!(oData&&
(oData.code!="undefined"||oError.code==-1))){helper.console.warning(`The connection has ended with errors: id: ${obj.id}, code: ${oError.code}, message: ${oError.message}, Session has ended: true`,arguments);_isSessionEnded=true;_comm.wsClose();resetLastError()}else _comm.reset();try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerError==null)$(window).trigger("serverError",oError);else TVNC.rcParams.events.onServerError(oError)}catch(error){helper.console.warning("'serverError' calling attached method fail. Message: "+
error.message,error,arguments)}if(helper.object.existsPath(oError,"code")&&ENUM_CODES.authenticationCodeErrors.indexOf(oError.code.toString())!=-1){if(oError.message!="")helper.console.warning(oError.message);if(window.environment.supportsFullScreen&&window.environment.isFullscreen)window.environment.exitFullscreen(false);if(Object.stopObserve)Object.stopObserve()}else;if(_isSessionEnded)_comm.dispose();return}else if(obj.cmd=="sessionStatus"&&oError.message=="Not authenticated"){TVNC.throwErrorConnection(oError,
{"status":0});return}else if(obj.cmd=="reconnectionAttempt"){if(typeof TVNC.rcParams.events==="undefined"||TVNC.rcParams.events.onReconnectionAttempt===null)$(window).trigger("onReconnectionAttempt",[obj]);else TVNC.rcParams.events.onReconnectionAttempt(obj);return}if(obj.id=="##"){TVNC.disconnect();return}if(obj.id=="!!"){if(obj.cmd==="wakeonlan"){if(_comm.protocol===Thinfinity.Communication.protocol.WEBSOCKET)_comm.wsWOL(true);if(_fromBroker)keepHTTPAlive(true);if(typeof TVNC.rcParams.events===
"undefined"||TVNC.rcParams.events.onWakeOnLan===null)$(window).trigger("wakeOnLan",[obj]);else TVNC.rcParams.events.onWakeOnLan(obj)}else if(obj.cmd==="waitforvm"){if(_comm.protocol===Thinfinity.Communication.protocol.WEBSOCKET)_comm.wsWOL(true);if(_fromBroker)keepHTTPAlive(true);if(typeof TVNC.rcParams.events==="undefined"||TVNC.rcParams.events.onWakeForVM===null)$(window).trigger("waitForVM",[obj]);else TVNC.rcParams.events.onWaitForVM(obj)}else if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerCommandEvent==
null)$(window).trigger("serverCmdResult",[obj]);else TVNC.rcParams.events.onServerCommandEvent(obj);return}else if(_comm.protocol===Thinfinity.Communication.protocol.WEBSOCKET)_comm.wsWOL(false);serverDPR.enabled=helper.object.existsPath(obj,"smartZoom")?helper.object.convertTo(obj.smartZoom,"boolean"):false;var rcActive=TVNC.rcParams.active;TVNC.rcParams.active=typeof obj.active!="undefined"?obj.active:TVNC.rcParams.active;TVNC.rcParams.monitor=typeof obj.monitor!="undefined"?obj.monitor:TVNC.rcParams.monitor;
TVNC.rcParams.monitorCount=typeof obj.monitorCount!="undefined"?obj.monitorCount:TVNC.rcParams.monitorCount;TVNC.rcParams.viewLeft=typeof obj.viewLeft!="undefined"?obj.viewLeft:TVNC.rcParams.viewLeft;TVNC.rcParams.viewTop=typeof obj.viewTop!="undefined"?obj.viewTop:TVNC.rcParams.viewTop;TVNC.rcParams.viewWidth=typeof obj.viewWidth!="undefined"?obj.viewWidth:TVNC.rcParams.viewWidth;TVNC.rcParams.viewHeight=typeof obj.viewHeight!="undefined"?obj.viewHeight:TVNC.rcParams.viewHeight;TVNC.rcParams.rfxEnabled=
typeof obj.rfxEnabled!="undefined"?obj.rfxEnabled:false;if(productId=="virtualui"){if(TVNC.vncContainer.parentElement)if(agentInfo.isMobile&&(agentInfo.isIOS&&agentInfo.ipadModel>=3||agentInfo.isMSIE)){TVNC.vncContainer.parentElement.style.width=Math.min(environment.rawWidth,TVNC.rcParams.viewWidth)+"px";TVNC.vncContainer.parentElement.style.height=Math.min(environment.rawHeight,TVNC.rcParams.viewHeight)+"px"}else{TVNC.vncContainer.parentElement.style.width=TVNC.rcParams.viewWidth+"px";TVNC.vncContainer.parentElement.style.height=
TVNC.rcParams.viewHeight+"px"}}else if((typeof obj.viewHeight!="undefined"||typeof obj.viewWidth!="undefined")&&typeof TVNC.rcParams.events!="undefined"&&helper.object.validate(TVNC.rcParams.events.onDesktopResize))TVNC.rcParams.events.onDesktopResize(TVNC.rcParams.viewWidth,TVNC.rcParams.viewHeight);TVNC.rcParams.mouseControl=typeof obj.mouseControl!="undefined"?obj.mouseControl:TVNC.rcParams.mouseControl;TVNC.rcParams.touchControl=typeof obj.touchControl!="undefined"?obj.touchControl:TVNC.rcParams.touchControl;
if(productId==="thinvnc")TVNC.rcParams.serverControlMouse=!TVNC.rcParams.mouseControl;TVNC.rcParams.kbdControl=typeof obj.kbdControl!="undefined"?obj.kbdControl:TVNC.rcParams.kbdControl;TVNC.rcParams.kbdUnicode=typeof obj.kbdUnicode!="undefined"?obj.kbdUnicode:TVNC.rcParams.kbdUnicode;TVNC.rcParams.showOnStart=typeof obj.showOnStart!="undefined"?obj.showOnStart:TVNC.rcParams.showOnStart;TVNC.rcParams.UBRWID=typeof obj.UBRWID!="undefined"?obj.UBRWID:TVNC.rcParams.UBRWID;if(obj.scraper!=null){TVNC.rcParams.scraper=
typeof obj.scraper!="undefined"?obj.scraper:TVNC.rcParams.scraper;if(obj.scraperArgs!=null)TVNC.rcParams.scraperArgs=typeof obj.scraperArgs!="undefined"?obj.scraperArgs:TVNC.rcParams.scraperArgs}TVNC.rcParams.quality=typeof obj.quality!="undefined"?obj.quality:TVNC.rcParams.quality;TVNC.rcParams.imageQuality=typeof obj.imageQuality!="undefined"?obj.imageQuality:TVNC.rcParams.imageQuality;TVNC.rcParams.wallpaper=typeof obj.wallpaper!="undefined"?obj.wallpaper:TVNC.rcParams.wallpaper;TVNC.rcParams.pixelFormat=
typeof obj.pixelFormat!="undefined"?obj.pixelFormat:TVNC.rcParams.pixelFormat;TVNC.rcParams.grayscale=typeof obj.grayscale!="undefined"?obj.grayscale:TVNC.rcParams.grayscale;if(typeof obj.remotePointer!="undefined"&&!obj.remotePointer)TVNC.rcParams.remotePointer=obj.remotePointer;TVNC.rcParams.imageMethod=typeof obj.imageMethod!="undefined"?obj.imageMethod:TVNC.rcParams.imageMethod;if(typeof obj.imageList!="undefined")if(obj.imageList=="json")TVNC.imageListType=0;else if(obj.imageList=="text")TVNC.imageListType=
1;else if(obj.imageList=="binary")TVNC.imageListType=2;TVNC.rcParams.fitmode=typeof obj.quality!="undefined"?obj.fitmode:TVNC.rcParams.fitmode;var fitResolutionMode="";switch(TVNC.rcParams.fitmode){case 1:fitToBrowser=false;fitResolutionMode="fixed";break;case 2:fitResolutionMode="fittoscreen";break;case 0:default:fitResolutionMode="fittobrowser";TVNC.rcParams.fitToBrowser=true;break}TVNC.rcParams.fitToBrowser=fitResolutionMode!="fittobrowser"?false:true;TVNC.rcParams.resolution=fitResolutionMode;
if(TVNC.savedMaxWidth==0||TVNC.rcParams.maxWidth==0)if(!agentInfo.isMobile)TVNC.rcParams.maxWidth=window.environment.rawWidth||screen.width;else if(productId=="virtualui")TVNC.rcParams.maxWidth=window.environment.currentWidth||screen.height;else TVNC.rcParams.maxWidth=window.environment.rawWidth||screen.width;if(TVNC.savedMaxHeight==0||TVNC.rcParams.maxHeight==0)if(!agentInfo.isMobile)TVNC.rcParams.maxHeight=window.environment.rawHeight||screen.height;else if(productId=="virtualui")TVNC.rcParams.maxHeight=
window.environment.currentHeight||screen.height;else TVNC.rcParams.maxHeight=window.environment.rawHeight||screen.height;if(obj.accessKey)TVNC.gatewayAccessKey=obj.accessKey;TVNC.savedMaxWidth=TVNC.rcParams.maxWidth;TVNC.savedMaxHeight=TVNC.rcParams.maxHeight;var version=parseInt(obj.version||0,10);if(version>=2)mouseBuffer.isAvailable=true;else mouseBuffer.isAvailable=false;if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl)if(mouseBuffer.isAvailable==true)TVNC.sendMouseQueue();else TVNC.sendMouseMove();
if(TVNC.rcParams.fitmode==0||TVNC.rcParams.fitToBrowser==true)if(typeof obj.dpr!="undefined"){var zoomBottomLimit=1;if(obj.dpr!=window.environment.currentDevicePixelRatio||TVNC.usedDPR!=window.environment.currentDevicePixelRatio||window.environment.currentOrientation!=serverCmdResultOrientation){serverCmdResultOrientation=window.environment.currentOrientation;window.environment.currentDevicePixelRatio=obj.dpr>0?obj.dpr:1;TVNC.usedDPR=window.environment.currentDevicePixelRatio;if(typeof obj.marginLeft!=
"undefined")window.environment.margin.left=obj.marginLeft;if(typeof obj.marginTop!="undefined")window.environment.margin.top=obj.marginTop;if(typeof obj.marginRight!="undefined")window.environment.margin.right=obj.marginRight;if(typeof obj.marginBottom!="undefined")window.environment.margin.bottom=obj.marginBottom;if(typeof obj.fullscreen!="undefined")window.environment.fullScreenAvailable=true;TVNC.savedMaxWidth=TVNC.rcParams.maxWidth;TVNC.savedMaxHeight=TVNC.rcParams.maxHeight;zoomBottomLimit=1/
window.environment.currentDevicePixelRatio;if(agentInfo.isMobile==true){if(productId!="ZSC"){adjustMainSize();TVNC.zoomFactor=zoomBottomLimit;zoom(zoomBottomLimit)}window.scrollTo(0,0)}else{screenHeight=environment.detectedHeight;screenWidth=environment.detectedWidth;if(serverDPR.enabled)serverDPR.originalValue=obj.dpr;if(productId==="virtualui")zoomBottomLimit=1;if(TVNC.zoomFactor!=zoomBottomLimit)TVNC.zoomDesktop(zoomBottomLimit);TVNC.rcParams.maxWidth=Math.round(screenWidth/zoomBottomLimit);TVNC.rcParams.maxHeight=
Math.round(screenHeight/zoomBottomLimit)}}}else if(serverDPR.enabled==false)window.environment.fixDevicePixelRatio();if(agentInfo.isMobile==true&&productId=="thinrdp"&&helper.object.validate(obj.reconnectOnResize))restartOnOrientationChange=obj.reconnectOnResize;if(TVNC.startPending)setTimeout(TVNC.start,1);if(helper.object.existsPath(self,"clientSettings.OverrideCursor"))TVNC.overrideCursor=self.clientSettings.OverrideCursor;if(helper.object.existsPath(self,"clientSettings.MousePressAsRightButton"))TVNC.rcParams.mousePressAsRightButton=
self.clientSettings.MousePressAsRightButton;if(rcActive!=obj.active){if(obj.active){TVNC.hookKM();TVNC.reload();syncCookies(startCookiesSync);if(cookiePrefix!="FMX")stopSyncCookies();BTP_PS_STR=null;if(typeof TVNC.rcParams.asyncCopy!=="undefined")_displayManager.fireEvent("asyncCopy",TVNC.rcParams.asyncCopy);_getServerUrl.retriesCount=_connectResult.count=0;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onSessionStart==null)$(window).trigger("sessionStart",obj);else TVNC.rcParams.events.onSessionStart(obj);
initializeComponents(data);if(cookiePrefix!=="VNC"&&agentInfo.isMobile)TVNC.rcParams.scaled=false}else{BTP_PS_STP=null;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onSessionStop==null)$(window).trigger("sessionStop",obj);else TVNC.rcParams.events.onSessionStop(obj)}if(obj.isShadowSession!==true)_displayManager.preserveConfiguration=true}TVNC.observable.isOTURLSession=obj.isOTURLSession;_displayManager.fireEvent("localEvent",{cmd:"serverCmdResult",obj});if(typeof TVNC.rcParams.events==
"undefined"||TVNC.rcParams.events.onServerCommandResult==null)$(window).trigger("onServerCommandResult",obj);else TVNC.rcParams.events.onServerCommandResult(obj);if(productId.toLowerCase()=="virtualui"){let scrollPoint=document.getElementById(TVNC.vncdivId+"_ScrollPoint");if(scrollPoint)helper.style.addClass(scrollPoint,`top:${TVNC.rcParams.viewHeight}px;left:${TVNC.rcParams.viewWidth}px`);else if(TVNC.vncdiv)helper.dom.appendJsonElement({parentElement:TVNC.vncdiv,type:"DIV",attributes:{id:TVNC.vncdivId+
"_ScrollPoint",style:`height:1px;width:1px;backgroundColor:transparent;position:absolute;top:${TVNC.rcParams.viewHeight}px;left:${TVNC.rcParams.viewWidth}px;zIndex:-1;`}})}TVNC.sendCmd("cmd=started")};this.sendCmd=function(query){return TVNC.sendServerCmd("cmd",query)};this.setMouseControl=function(value){TVNC.sendCmd("cmd=params&mouseControl="+value+"&kbdControl="+!TVNC.rcParams.kbdControl+"&touchControl="+!TVNC.rcParams.touchControl)};this.setQuality=function(value){TVNC.sendCmd("cmd=params&quality="+
value)};this.setimageMethod=function(value){TVNC.sendCmd("cmd=params&imageMethod="+value)};this.setGrayscale=function(value){TVNC.sendCmd("cmd=params&grayscale="+value)};this.setKbdControl=function(value){TVNC.sendCmd("cmd=params&kbdControl="+value)};this.setRemotePointer=function(value){TVNC.sendCmd("cmd=params&remotePointer="+value)};this.setPixelFormat=function(value){TVNC.sendCmd("cmd=params&pixelFormat="+value)};this.setMonitor=function(m){if(m>=this.rcParams.monitorCount)m=0;TVNC.sendCmd("cmd=params&monitor="+
m)};this.revokeObjectURLs=function(){if(_blob.on&&!_blob.revoked){if(_blob.processedMouseUrl)for(var i=0;i<_blob.processedMouseUrl.length;i++)_urlCreator.revokeObjectURL(_blob.processedMouseUrl[i]);_blob.processedMouseUrl=null;if(_blob.processedScreenUrl)for(var d in _blob.processedScreenUrl)for(var i=0;i<_blob.processedScreenUrl[d].length;i++)_urlCreator.revokeObjectURL(_blob.processedScreenUrl[d][i]);_blob.processedScreenUrl=null;_blob.revoked=true}};this.disconnect=function(){_isDisconnecting=
true;if(!_comm.state<=Thinfinity.Communication.state.CLOSING){sessionStorage.removeItem(_preferredBrokerKey);let connected=_comm.state>=Thinfinity.Communication.state.CONNECTING;if(connected&&_displayManager)_displayManager.fireEvent("localEvent",{cmd:"disconnect"});keepHTTPAlive(false);if(!_isSessionEnded)try{let msg=productId!=="virtualui"?consts.thisSessionHasEnded:consts.applicationClosed;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onSessionEnd==null)$(window).trigger("sessionEnd",
msg);else TVNC.rcParams.events.onSessionEnd(msg)}catch(error){helper.console.warning("'sessionEnd' calling attached method fail. message: "+error.message,error,arguments)}if(_displayManager){_displayManager.dispose();_displayManager.preserveConfiguration=false}BTP_PS_END2=null;connection.fromReconnection=false;TVNC.closeReconnectDiv();TVNC.disposeTimeout=setTimeout(function(){if(TVNC&&TVNC.dispose)TVNC.dispose()},TVNC.disposeTimeoutValue);TVNC.removeCanvases();if(window.environment.supportsFullScreen&&
window.environment.isFullscreen)exitFullscreen();TVNC.sendCmd("cmd=disconnect");stopSyncCookies();_isSessionEnded=true;TVNC.rcParams.id=0;TVNC.sendMouseMove=function(){};clearTimeout(TVNC.emptyRecycleImgTimeout);TVNC.purgeImageQueue(TVNC.imgQueue);ID.remove();sessionStorage.removeItem("oturlDataPass");_comm.wsClose();if(_audioDriver?.dispose)_audioDriver.dispose()}};this.removeCanvases=function(){$('[id^="'+productId+'_"]').remove()};this.removeListeners=function(){$(document).unbind();$(window).unbind();
$("#"+TVNC.vncdivId).unbind()};this.dispose=function(releaseAll,status){if(productId=="virtualui"&&TVNC.vncContainer.parentElement){TVNC.vncContainer.parentElement.style.width="100%";TVNC.vncContainer.parentElement.style.height="100%"}if(Thinfinity.Popups&&Thinfinity.Popups.growl)Thinfinity.Popups.growl.unblockAll();releaseAll=releaseAll!=false?true:false;clearTimeout(TVNC.disposeTimeout);if(!TVNC.useAjax){BTP_PWS_CLS3=null;_comm.wsClose()}_comm.releaseQueue(TVNC.queueRequestName);_comm.dispose();
if(helper.object.existsPath(oLastError,"code")&&ENUM_CODES.authenticationCodeErrors.indexOf(oLastError.code.toString())!=-1)connection.state=Thinfinity.Communication.state.CLOSING;if(releaseAll)TVNC.removeListeners();try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerDisconnect==null)$(window).trigger("serverDisconnect");else{TVNC.rcParams.events.onServerDisconnect(status);if(TVNC.events){if(TVNC.rcParams.events.splice&&TVNC.rcParams.events.length)TVNC.rcParams.events.splice(0,
TVNC.rcParams.events.length);TVNC.events=null}}}catch(error){helper.console.warning("'onServerDisconnect' calling attached method fail. message: "+error.message,error,arguments)}window.dispatchEvent(new CustomEvent("onServerDisconnect"));if(releaseAll){if(_displayManager)_displayManager.dispose();if(TVNC.clipboard)TVNC.clipboard.dispose();TVNC.removeCanvases()}if(TVNC.xmlHttpJson){TVNC.xmlHttpJson.abort();TVNC.xmlHttpJson=null}TVNC.emptyRecycleImg(true);if(releaseAll)if(!!TVNC.canvasER)TVNC.canvasER=
null;TVNC.clearImageCache();TVNC.clearTextCache();TVNC.clearFontCache();TVNC.clearOffscreenCache();if(window.environment.supportsFullScreen&&window.environment.isFullscreen)exitFullscreen();TVNC.rcParams.id=0;TVNC.sendMouseMove=function(){};if(TVNC.sound){TVNC.sound.dispose();TVNC.sound=null}TVNC.clipboard=null;clearTimeout(TVNC.emptyRecycleImgTimeout);TVNC.purgeImageQueue(TVNC.imgQueue);if(TVNC.imgQueue)TVNC.imgQueue.watchdogStop();TVNC.deferCall=function(){};TVNC.imgQueue=null;setTimeout(function(){if(Object.stopObserve)Object.stopObserve()},
5E3);TVNC.revokeObjectURLs();TVNC.imageListHelper=null;if(_componentRegistrationServices)_componentRegistrationServices.dispose()};this.usingDisplayManager=function(){return(agentInfo.gfx&&TVNC.rcParams.enableGfx||agentInfo.h264&&TVNC.rcParams.enableH264)&&_displayManager};this.reset=function(){this.rcParams.maxHeight=0;this.rcParams.maxWidth=0;if(!this.usingDisplayManager())for(var i=TVNC.vncContainer.childNodes.length-1;i>=0;i--){var canvas=TVNC.vncContainer.childNodes[i];if(canvas.tagName=="CANVAS"){canvas.style.display=
"none";var hwnd=canvas.hwnd||canvas.id.replace(productId+"_canvas_","");if(hwnd!=0)TVNC.fireCustomEvents("canvasHidden",{"hwnd":hwnd});if(canvas.mask)canvas.mask={};canvas.innerHTML="";try{TVNC.vncContainer.removeChild(canvas)}catch(err){logError("receiveScreen: "+err)}canvas=null}}TVNC.emptyRecycleImg(true);_displayManager.fireEvent("resetCursor");TVNC.clearImageCache();TVNC.clearTextCache();TVNC.clearFontCache();TVNC.clearOffscreenCache()};function exitFullscreen(){var el=document;if(window.frameElement)el=
helper.url.getTopWindow(window).document;window.environment.exitFullscreen(el)}this.setFullScreen=function(active){var el=document.documentElement;if(active)window.environment.requestFullscreen(el);else window.environment.exitFullscreen(el)};this.stop=function(){TVNC.sendCmd("cmd=stop")};this.start=function(cmdv){if(TVNC.useAjax)_isPktIdxEnabled=false;this.startCmdToSend=true;BTP_PR_STR=null;TVNC.sendStart(cmdv)};this.removeBrowserSize=function(scraperArgs){return this.removeArguments(scraperArgs,
["browserheight","browserwidth","screenheight","screenwidth"])};this.removeArguments=function(queryStr,args,ignoreCase){if(queryStr&&args&&args instanceof Array){ignoreCase=typeof ignoreCase==="undefined"?true:ignoreCase;if(ignoreCase)args=args.map(function(elem){return elem.toString().toLowerCase()});var lStr="";var rStr=queryStr;var nParams="";var idx=queryStr.indexOf("?");if(idx!=-1){lStr=queryStr.substr(0,idx);rStr=queryStr.substr(idx+1)}var fElem=true;var params=rStr.split("&");params.forEach(function(elem){var kvp=
elem.split("=");if(kvp.length>0){kvp[0]=kvp[0].toString();if(ignoreCase)kvp[0]=kvp[0].toLowerCase();if(args.indexOf(kvp[0])==-1){nParams+=(fElem?"":"&")+elem;fElem=false}}else{nParams+=(fElem?"":"&")+elem;fElem=false}});var u="";if(idx!=-1)u="?";return lStr+u+nParams}};this.sendStart=function(cmdv){if(!this.cacheLoaded)return;if(!this.startCmdToSend)return;this.startPending=false;this.rcParams.active=false;var cmd="cmd=start";if(typeof cmdv!="undefined")cmd=cmdv;if(connection.fromReconnection&&productId==
"thinrdp")cmd+="&subcmd=restart";connection.fromReconnection=false;if(this.rcParams.scraper!=null){cmd=cmd+"&scraper="+this.rcParams.scraper;if(this.rcParams.scraperArgs!=null){var scraperArgs=helper.object.getDataTypeOf(this.rcParams.scraperArgs)=="json"?helper.object.jsonToString(this.rcParams.scraperArgs,"&",false):this.rcParams.scraperArgs;if(cmdv!=undefined&&cmdv.indexOf("screenWidth")!=-1)cmd=cmd+this.removeBrowserSize(scraperArgs);else{var cmdLastChar=cmd.substr(cmd.length-1);var scrFirstChar=
scraperArgs.substr(0,1);var amp="";if(cmdLastChar!="&"&&scrFirstChar!="&")amp="&";cmd=cmd+amp+scraperArgs}}}if(!TVNC.useAjax)if(_comm.binaryType&&(!agentInfo.isFirefox||agentInfo.firefoxVersion>15)){cmd+="&imageList=binary";TVNC.imageListType=2}cmd+="&mouseControl="+this.rcParams.mouseControl+"&kbdControl="+this.rcParams.kbdControl+"&touchControl="+this.rcParams.touchControl;cmd+="&pixelFormat="+this.rcParams.pixelFormat;cmd+="&wallpaper="+this.rcParams.wallpaper;cmd+="&rleThreshold="+this.rcParams.rleThreshold;
cmd+="&useSendThread="+this.rcParams.useSendThread;cmd+="&monitor="+this.rcParams.monitor;TVNC.rcParams.clientAck=TVNC.rcParams.clientAck<=0&&!TVNC.useAjax?0:Math.max(TVNC.rcParams.clientAck,1);cmd+="&supportsWebP="+WebPImageFormat.supportsWebP();cmd+="&clientAck="+TVNC.rcParams.clientAck;if(TVNC.rcParams.screenResX>0)cmd+="&screenResX="+TVNC.rcParams.screenResX+"&screenResY="+TVNC.rcParams.screenResY;if(this.rcParams.pin)cmd+="&pin="+this.rcParams.pin;if(this.rcParams.sessionKey)cmd+="&sessionKey="+
this.rcParams.sessionKey;if(TVNC.controlFactory)cmd+="&nativeClasses="+TVNC.controlFactory.getClassList();if(TVNC.rcParams.persistentCache)cmd+="&imgCache="+getImageCacheList();var isLandscape=window.environment.currentOrientation=="landscape"?true:false;cmd+="&devicePixelRatio="+(window.environment.initialDevicePixelRatio||1)+"&isMobile="+agentInfo.isMobile+"&isLandscape="+isLandscape+"&supportsFullScreen="+window.environment.supportsFullScreen+"&webapp="+window.environment.webapp;if(TVNC.rcParams.extraData!=
null)cmd+="&extraData="+encodeURIComponent(JSON.stringify(TVNC.rcParams.extraData));allowSendingCommands=true;TVNC.sendCmd(cmd);if(TVNC.rcParams.showOnStart)TVNC.show()};this.purgeQuery=function(q){try{var pairs=q.split("&");var collection=[];var pair;var qq="";for(var p=0;p<pairs.length;p++)if(pairs[p]!=""){pair=pairs[p].split("=");if(pair.length=2)collection[pair[0]]=pair[1]}qq="";for(var c in collection)qq+=c+"="+collection[c]+"&";qq=qq.substr(0,qq.length-1);return qq}finally{collection=pairs=
pair=qq=null}};var _gettingSeverUrl=false;function addBaseUrl(baseUrl){var elem=document.getElementById("baseUrlTag");if(!elem){elem=document.createElement("base");elem.id="baseUrlTag";var head=document.querySelector("head");if(head){var fn=head.querySelector("script");if(fn)head.insertBefore(elem,fn);else head.appendChild(elem)}else helper.console.warning("Cannot insert 'script' tag, base url",arguments)}elem.href=baseUrl}function removeBaseUrl(){var elem=document.getElementById("baseUrlTag");elem.parentElement.removeChild(elem)}
function encodeResponseUrl(urlResponse){if(urlResponse){var surl=urlResponse.split("/");if(surl.length>2){urlResponse="";for(var i=0;i<Math.min(surl.length-1,2);i++)if(surl[i]!="")urlResponse+="/"+surl[i];for(var i=2;i<surl.length;i++)if(surl[i]!="")urlResponse+="/"+encodeURIComponent(surl[i]);urlResponse+="/"}}return urlResponse}function setUrls(response){var _browseUrl="__browser__";var basePath=Thinfinity.global.variables.basePath;if(TVNC.rcParams.sessionKey&&TVNC.rcParams.sessionKey!==""){var bp=
Thinfinity.global.variables.basePath.split("/").filter(function(p){return p!==""});var ru=response.url.split("/").filter(function(p){return p!==""});var i=bp.length-1;while(i>=0){if(bp[i]!==""&&ru.find(function(r){return r===bp[i]})){var f=bp[i];basePath=Thinfinity.global.variables.basePath=("/"+bp.splice(0,i).join("/")+"/").replaceAll("//","/");response.url=("/"+ru.slice(ru.indexOf(f),ru.length).join("/")+"/").replaceAll("//","/");i=-1}i--}}else if(productId==="thinvnc"){if(Thinfinity.global.variables.basePath.length>
1&&Thinfinity.global.variables.basePath!=="/"&&response.url.length>1){let bp=Thinfinity.global.variables.basePath.replaceAll("/","");if(response.url.split("/").find(p=>{return p===bp}))response.url="/"+response.url.split("/").filter(p=>{return p!=""}).splice(1).join("/")+"/"}if(Thinfinity.global.variables.gatewayPin.length>1)basePath=basePath.replace(Thinfinity.global.variables.gatewayPin,"").replaceAll("//","/")}_url.baseUrl=helper.url.parseUrl(Thinfinity.global.variables.basePath+response.url).toUrl();
_url.brokerUrl=helper.url.parseUrl(location.href).toUrl("-o-a-r");if(basePath!=="/"){if(basePath.substr(0,1)!=="/")basePath="/"+basePath;if(basePath.substr(basePath.length-1)!=="/")basePath+="/"}if(response.gateway&&response.gateway!==""){_url.httpConnection=helper.url.parseUrl(response.gateway+response.url).toUrl();_url.gatewayAccess=response.gateway;_url.wsConnection=helper.url.parseUrl(response.gateway+_browseUrl+response.url).toUrl();_url.wsConnection=_url.wsConnection.replace("http","ws");_location=
helper.url.parseUrl(response.gateway+response.url).toUrl();_url.baseUrl=_virtualPathProfile}else{if(_url.baseUrl!=="/"){if(_url.baseUrl.substr(0,1)!=="/")_url.baseUrl="/"+_url.baseUrl;if(_url.baseUrl.substr(_url.baseUrl.length-1)!=="/")_url.baseUrl+="/"}_url.httpConnection="";var sp=TVNC.rcParams.server?TVNC.rcParams.server.split("/").filter(function(p){return p!==""}):"";var bp=basePath.split("/").filter(function(p){return p!==""});var i=bp.length-1;var fIdx=-1;while(i>=0){fIdx=sp.findIndex(function(r){return r===
bp[i]});if(fIdx!=-1){TVNC.rcParams.server=sp.splice(0,fIdx).join("/");i=-1}i--}_url.wsConnection=TVNC.rcParams.server?TVNC.getProtocol().replace("http","ws")+"//"+TVNC.rcParams.server:window.location.origin.replace("http","ws");_url.wsConnection+=basePath+_browseUrl+_url.baseUrl.substr(basePath.length-1);_url.wsConnection=helper.url.parseUrl(_url.wsConnection).toUrl();addBaseUrl(_url.baseUrl);_location=TVNC.getAjaxUrl()}if(connection.fromReconnection)TVNC.fireOOBCmd("vchannel",{"msg":{"cmd":"update.gateway"}})}
this.getWsUrl=function(){var wsUrl=_url.wsConnection;if(TVNC.gatewayAccessKey!="")if(wsUrl.indexOf("/"+TVNC.gatewayAccessKey)<0)wsUrl+="/"+TVNC.gatewayAccessKey;return wsUrl+TVNC.rcParams.id+"?_gwsid="+Thinfinity.global.variables.gwsid};this.connect=function(userid,password){if(_isDisconnecting)return;if(!_fromBroker){TVNC.rcParams.id=null;ID.remove()}else if(TVNC.rcParams.id===null)TVNC.rcParams.id=ID.get();helper.ajax.addHeaderValue("X-Thinfinity-GWSID",Thinfinity.global.variables.gwsid);BTP_REM_CO=
null;keepHTTPAlive(true);if(_fromBroker){BTP_PCG_STR=null;if(!_gettingSeverUrl){TVNC.gatewayAccessKey="";_gettingSeverUrl=true;if(_virtualPathProfile==""){_virtualPathProfile=TVNC.rcParams.url?TVNC.rcParams.url:helper.url.parseUrl(window.location.href).toUrl("-o-a");if(_virtualPathProfile[_virtualPathProfile.length-1]!="/")_virtualPathProfile+="/"}connection.reconnectingCount=0;if(connection.firstConnection)updateConnectionStatus({action:1,description:consts.establishingConn});TVNC.getServerUrl(function(response){if(response)if(response.url){helper.console.log(helper.string.format("getServerUrl response. Redirect --\x3e URL:{0} ",
response.url),arguments);TVNC.gatewayAccessKey="";sessionStorage.setItem(_preferredBrokerKey,response.brokerid||"");setUrls(response);BTP_PCG_END=null;postConnect(userid,password);_gettingSeverUrl=false}else{_gettingSeverUrl=false;var errStr="";if(response.state===STATE_ERROR)errStr=response.description!=""?response.description:response.errstr!=""?response.errstr:consts.unknownError;else if(response.errno>=400)errStr=response.errno==404?consts.sessionError404:helper.string.format(consts.clientErrorNum,
response.errno);if(errStr){if(connection.fromReconnection)TVNC.closeReconnectDiv();var responseStr=response.description+(errStr&&errStr!==response.description?" "+errStr:"");var res=false;var status={"state":response.state,"description":response.description,"errstr":errStr,"errno":response.errno};if(_fromBroker&&response.errno===404&&_isTemporalConnection===true){helper.console.warning(helper.string.format("getServerUrl - status: {0}",responseStr),arguments);status.description=consts.brokerDown;status.temp=
true;status.brokerDown=true;status.originalEvent=true;try{if(helper.object.existsPath(TVNC,"rcParams.events.onBrokerError"))res=TVNC.rcParams.events.onBrokerError(status);else $(window).trigger("onBrokerError",status)}catch(error){helper.console.warning("'onBrokerError' calling attached method fail. message: "+error.message,error,arguments)}}if(!res)if(response.license){if(TVNC.connected)TVNC.disconnect();let licenseError={title:consts.licenseError,errorType:_licenseTypes.ERR_TYPE_ERROR,errorCode:response.state,
errorMsg:response.description};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onLicenseMsg==null)$(window).trigger("licenseMsg",licenseError);else TVNC.rcParams.events.onLicenseMsg(licenseError)}else{try{let oError={message:responseStr};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerError==null)$(window).trigger("serverError",oError);else TVNC.rcParams.events.onServerError(oError);helper.console.log("'serverError' disconnecting. "+responseStr,arguments)}catch(error){helper.console.warning("'serverError' disconnecting. message: "+
error.message,error,arguments)}TVNC.disconnect()}else helper.console.log("The error was handled by the user",arguments)}}else{_gettingSeverUrl=false;setTimeout(function(){BTP_PCG_ERR=null;TVNC.connect(userid,password)},200)}})}}else{var response={"url":_url.baseUrl!=="/"?_url.baseUrl:""};setUrls(response);updateConnectionStatus({"action":1,"description":productId=="virtualui"?null:consts.establishingConn});_virtualPathProfile="";postConnect(userid,password)}};function supportCur(){return!(agentInfo.isSafari||
agentInfo.isMobile&&agentInfo.isIOS||agentInfo.isMSIE&&agentInfo.msieVersion<=11&&agentInfo.msieOSVersion<=7)}function keepHTTPAlive(status){_comm.disposePing("HTTP.ALIVE");if(status){let url=helper.url.parseUrl(location.href).toUrl("-a-r")+(productId==="thinrdp"?TVNC.apiUrl+"auth/":"")+"ping?id="+TVNC.rcParams.id;_comm.createPing("HTTP.ALIVE",TVNC.completeAjaxParams({"url":url,"cache":false,"timeout":3E3,"error":function(){helper.console.warning("Cannot keep http alive, failed. ",arguments)},"success":function(){helper.console.log("Http alive, response",
arguments)},"intervalTime":6E4}))}}this.checkSizeAndResolution=function(callback){clearTimeout(_checkSizeAndResolutionTimeoutId);if(TVNC.rcParams.resolution=="fittobrowser")if(window.environment.detectedWidth==0||window.environment.detectedHeight==0)_checkSizeAndResolutionTimeoutId=setTimeout(TVNC.checkSizeAndResolution,250,callback);else callback();else callback()};function fireCustomEvent(eventName,response,jqXHR,err){try{if(helper.object.existsPath(TVNC.rcParams,helper.string.format("events.{0}",
eventName)))TVNC.rcParams.events[eventName](response,err);else{eventName=eventName.replace("on");eventName=eventName[0].toLowerCase()+s.substring(1);$(window).trigger(eventName,jqXHR,err)}}catch(error){helper.console.warning(helper.string.format("'{0}' calling attached method fail. message: {1}",eventName,error.message),error,arguments)}}function getDisplaysInfo(){let w=environment.availWidth;let h=environment.availHeight;let t=0;let displays=[{id:0,width:w,height:h,surface:{top:t,left:0},physicalWidth:w,
physicalHeight:h,orientation:environment.currentOrientation,desktopScaleFactor:1,deviceScaleFactor:1,mainDisplay:true,name:""}];return displays}function sendDisplaysInfo(displays){if(TVNC.rcParams.mode!==_eMode.SKEY){displays=getPurgedDisplayManagerInfo(displays);helper.console.log(`Sending browser displays info: ${JSON.stringify(displays)}`,arguments);let checkPending=function(){if(!_pendingDisplayResize){_pendingDisplayResize=displays;_pendingsCommandsCallback.push(function(){sendDisplaysInfo(_pendingDisplayResize);
_pendingDisplayResize=null})}else _pendingDisplayResize=displays};if(_comm)if(_comm.state===Thinfinity.Communication.state.CONNECTED){helper.console.log(`cmd=brwrRsze: ${JSON.stringify(displays)}`,arguments);TVNC.sendEvent("cmd=brwrRsze&ms="+encodeURIComponent(JSON.stringify(displays))+"&id="+TVNC.rcParams.id)}else{if(_comm.state<Thinfinity.Communication.state.CLOSING)checkPending()}else checkPending()}}function checkServerControlMouse(){TVNC.rcParams.overrideCursor=false;if(TVNC.rcParams.serverControlMouse)_allowMouseCapture=
false;else _allowMouseCapture=true}async function initializeDisplayManager(){if(_displayManager){helper.console.log(`Re-use device displays`,arguments);return true}else{var _prevResize=null;if(!!TVNC.rcParams.playsession){TVNC.rcParams.overrideCursor=false;TVNC.rcParams.allowMouseCapture=false;TVNC.rcParams.serverControlMouse=true}_oInterface=(new Thinfinity.Object.Interface({defaultEventFire:{async:0}})).new(new Thinfinity.Object.IConfig({namespace:true,options:[Thinfinity.Object.IConfig.OPTIONS.DO_NOT_FULL_EXTEND_OBJECT],
object:TVNC,properties:[{source:"rcParams.active",ro:true},{source:"rcParams.mouseControl",ro:true},{source:"mouseBuffer.isAvailable",alias:"mouseBufferAvailable",ro:true},{source:"rcParams.hookMouse",ro:true},{source:"rcParams.mousePressAsRightButton",ro:true},{source:"rcParams.cursorVisible",ro:true},{source:"rcParams.remotePointer",ro:true},{source:"rcParams.viewLeft",ro:true},{source:"rcParams.viewTop",ro:true},{source:"rcParams.enableH264",ro:true},{source:"rcParams.enableGfx",ro:true},{source:"rcParams.hookKeyboard",
ro:true},{source:"rcParams.kbdUnicode",ro:true},{source:"rcParams.kbdLogKeys",ro:true},{source:"onlyKeyCode",ro:true,get:function(){return _onlyKeyCode}},{source:"rcParams.isCrossDomain",ro:true},{source:"allowOverrideCursor",ro:true,get:function(){return allowOverrideCursor}},{source:"allowMouseCapture",ro:true},{source:"rcParams.overrideCursor",ro:false},{source:"centered",ro:true},{source:"rcParams.centeredMode",ro:true},{source:"border",ro:true,get:function(){return{left:TVNC.rcParams.borderLeft,
top:TVNC.rcParams.borderTop,right:TVNC.rcParams.borderRight,bottom:TVNC.rcParams.borderBottom}}},{source:"rcParams.playsession",ro:true},{source:"isServerControlMouse",ro:true,get:function(){return!!TVNC.rcParams.playsession||TVNC.rcParams.serverControlMouse}},{source:"rcParams.id",ro:true,alias:"sid"},{source:getClipboardInterface().iObject,ro:true,alias:"clipboard"},{source:"canPasteFiles",ro:true,get:function(){return productId=="thinrdp"}},{source:"rdpMode",ro:true},{source:"productId",ro:true,
get:function(){return window.productId}},{source:"rcParams.fitmode",ro:true},{source:"rcParams.fitToBrowser",ro:true},{source:"rcParams.rfxEnabled",ro:true},{source:"rcParams.overflow",ro:true},{source:"maxSize",ro:true,get:function(){return{width:TVNC.rcParams.maxWidth,height:TVNC.rcParams.maxHeight}}},{source:"serverDPR",ro:true,get:function(){return serverDPR}},{source:"CUEnabled",ro:true,get:function(){return _CUEnabled}},{source:"rcParams.quality",ro:true},{source:"rcParams.pixelFormat"},"baseZIndex",
{source:"cursorCanvasX",get:function(){if(TVNC.cursorCanvas){var position=TVNC.findPos(TVNC.vncContainer);let l=0;try{l=parseInt(TVNC.cursorCanvas.style.left.replace("px",""),10)}catch(err){l=TVNC.cursorCanvas.offsetLeft}return l*_displayManager.processDisplayCmd("GET_SCALE")+position[0]}else return TVNC.mouseX},ro:true},{source:"cursorCanvasY",get:function(){if(TVNC.cursorCanvas){var position=TVNC.findPos(TVNC.vncContainer);let t=0;try{t=parseInt(TVNC.cursorCanvas.style.top.replace("px",""),10)}catch(err){t=
TVNC.cursorCanvas.offsetTop}return t*_displayManager.processDisplayCmd("GET_SCALE")+position[1]}else return TVNC.mouseY},ro:true},{source:"pictureType",get:function(){return _ePictureType}},{source:"rcParams.shadowed",ro:true},{source:"rcParams.mouseWheelDirection",ro:true},{source:"rcParams.maxWidth",ro:true},{source:"rcParams.maxHeight",ro:true},{source:"rcParams.mouseX",ro:false},{source:"rcParams.mouseY",ro:false},{source:"rcParams.viewWidth"},{source:"rcParams.viewHeight"},{source:"rcParams.mouseMoved",
ro:false},{source:"caret",ro:true},{source:"rcParams.multiRowMinSize",ro:true},{source:"rcParams.caretX",ro:false},{source:"rcParams.caretY",ro:false},{source:"rcParams.relativeTouch",ro:true},{source:"rcParams.scaled",ro:true},{source:"rcParams.resizeDesktop",ro:true},{source:"rcParams.resolution",ro:true},{source:"rcParams.isShadowSession",ro:true},{source:"availableAudio",get:function(){return _audioDriver?.available??false}},{source:"mobileKeyboardEnumKeys",ro:true,get:()=>Thinfinity?.Driver?.MobileKeyboard?.enumKeys}],
methods:[{alias:"sendKey",value:TVNC.sendKey},{alias:"sendText",value:TVNC.sendText},{alias:"sendCmd",value:TVNC.sendCmd},{alias:"sendFocus",value:sendTabFocusCmd},{alias:"sendWheel",value:TVNC.sendWheel},{alias:"inputAllowed",value:TVNC.inputAllowed},{alias:"sendEvent",value:TVNC.sendEvent},{alias:"sendMouse",value:function mouseEvent(x,y,button,action){if(TVNC.mouseX!=x||TVNC.mouseY!=y)TVNC.mouseMoved=true;TVNC.mouseX=x;TVNC.mouseY=y;if(action!=="move")TVNC.sendMouse(x,y,button,action)}},{alias:"registerCanvas",
value:addValidCanvas},{alias:"fireEvent",value:function(event,data){if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events[event]==null)$(window).trigger(event,[data]);else TVNC.rcParams.events[event]([data])}},{alias:"updateCanvasSize",value:TVNC.updateCanvasSize},{alias:"removeDevice",value:function(id){_displayManager.removeDevice(id)}},{alias:"zoom",value:value=>{_displayManager.fireEvent("zoom",value)}},{alias:"sendWheel",value:TVNC.sendWheel},{alias:"forceMouseMove",value:()=>{TVNC.mouseMoved=
true;TVNC.sendMouseMove();TVNC.mouseMoved=false}},{alias:"pressAndRelease",value:(x,y)=>{TVNC.sendMouse(x,y,2,"down");TVNC.sendMouse(x,y,2,"up");_displayManager.fireEvent("pressAndRelease",x,y)}}],events:{resize:function(displays){if(_prevResize!==displays)sendDisplaysInfo(displays);_prevResize=displays},disconnect:function(){Thinfinity.Popups.unblock();TVNC.disconnect()}}}));TVNC=_oInterface.original;if(productId==="thinvnc"){_oInterface.new.on("rcParams.serverControlMouse",checkServerControlMouse);
checkServerControlMouse()}let username="";let isSessionKey=TVNC.rcParams.mode===_eMode.SKEY;if(isSessionKey){TVNC.rcParams.enableH264=Thinfinity.global.variables.H264Enabled=="true";TVNC.rcParams.enableGfx=Thinfinity.global.variables.GfxEnabled=="true"&&!TVNC.rcParams.enableH264}let displayConfig=isSessionKey?{db:false,shadowingSession:true}:{username:username,model:TVNC.rcParams.profileKey};displayConfig.methods={sendCmd:TVNC.sendCmd};displayConfig.canBeOverridden=TVNC.rcParams?.multiMonitor?.canBeOverridden||
false;displayConfig.count=TVNC.rcParams?.multiMonitor?.count||1;_displayManager=new Thinfinity.Display.Manager(displayConfig,_oInterface.new);if(TVNC.rcParams.enableH264)_displayManager.limits={min:{width:800,height:600}};Object.defineProperty(TVNC,"zoomFactor",{enumerable:true,configurable:false,get:function(){return _displayManager.processDisplayCmd("GET_ZOOM_FACTOR")},set:function(value){return _displayManager.processDisplayCmd("SET_ZOOM_FACTOR",value)}});delete TVNC.getZoom;Object.defineProperty(TVNC,
"getZoom",{enumerable:true,configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("GET_ZOOM_FACTOR")}});Object.defineProperty(TVNC,"zoomDesktop",{enumerable:true,configurable:false,writable:false,value:function(value){return _displayManager.processDisplayCmd("ZOOM_DESKTOP",value)}});Object.defineProperty(TVNC,"cursorCanvas",{enumerable:true,configurable:false,get:function(value){return _displayManager.processDisplayCmd("CURSOR_CANVAS")}});Object.defineProperty(TVNC,
"getMinZoomFactor",{enumerable:true,configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("GET_MIN_ZOOM_FACTOR")}});Object.defineProperty(TVNC,"center",{enumerable:true,configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("CENTER")}});Object.defineProperty(TVNC,"scale",{enumerable:true,configurable:false,get:function(){return _displayManager.processDisplayCmd("GET_SCALE")}});Object.defineProperty(TVNC,"getScale",{enumerable:true,
configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("GET_SCALE")}});Object.defineProperty(TVNC,"zoomFactorReset",{enumerable:true,configurable:false,writable:false,value:function(){return _displayManager.processDisplayCmd("ZOOM_FACTOR_RESET")}});await _displayManager.sync();var createDisplayDevice=function(config){let mon={resolution:Thinfinity.Display.Device.RESOLUTION.FIT_TO_BROWSER,orientation:environment.currentOrientation,desktopScaleFactor:1,deviceScaleFactor:1,
mainDisplay:false,external:true,height:environment.availHeight,width:environment.availWidth,surface:{left:0,top:0},window:null};helper.object.parseAttributes(mon,config);return new Thinfinity.Display.Device(mon)};triggerCustomEvent("display.manager.ready");let displays=null;let restoreData=null;if(!isSessionKey){if(agentInfo.h264&&TVNC.rcParams.enableH264&&_displayManager)displays=_displayManager.getStoredConfiguration();helper.console.log(`recovering stored data: ${displays?JSON.stringify(displays):
"is empty"}`);if(!displays)restoreData=triggerCustomEvent("display.manager.restore.display.info")}else{TVNC.registerOOBCmd("monitorDefs",function(data){if(data?.monitorDefs?.items)_displayManager.syncDisplayInfo(data.monitorDefs.items)});_displayManager.on("syncCompleted",function(){setTimeout(function(){TVNC.refresh()},5E3)})}_displayManager.on("createCanvas",TVNC.createCanvas);if(!displays)displays=getDisplaysInfo();if(restoreData){helper.console.log(`getting displays from profile`);return await restoreData()}else{helper.console.log(`creating monitors...`);
let m=displays.find(function(d){return d.mainDisplay});m.parentElement=document.getElementById("deskdiv");if(displays){var proms=[];displays.forEach(async function(d){proms.push(_displayManager.addDevice(createDisplayDevice(d)))});let values=await Promise.all(proms);let any=false;var blockedMsg=null;values.forEach(function(res){if(res&&res.code!==Thinfinity.Display.Manager.RESPONSE_CODES.SUCCESS){if(res.code===Thinfinity.Display.Manager.RESPONSE_CODES.POPUP_BLOCKED)blockedMsg=res.message;helper.console.warning(`Something went wrong. ${res.message}`,
arguments)}else any=true});if(blockedMsg)values=await _displayManager.restoreDevices();return any}else throw new Error(`Cannot access to screens details.`);}}}function getPurgedDisplayManagerInfo(displays){if(!displays)displays=_displayManager.getDisplaysInfo();if(displays)displays.forEach(function(m){delete m.window;delete m.resolution;delete m.name;m.width=m.display.width;m.height=m.display.height;delete m.display;delete m.screen;if(m.surface){m.left=m.surface.left;m.top=m.surface.top}delete m.surface});
return displays}function postConnect(userid,password){BTP_PCS_STR=null;if(_isDisconnecting)return;TVNC.checkSizeAndResolution(function(){BTP_PCS_END=null;if([Thinfinity.Communication.state.READY,Thinfinity.Communication.state.SERVERCONNECTED,Thinfinity.Communication.state.RECONNECTING,Thinfinity.Communication.state.UNSTABLE,Thinfinity.Communication.state.LOST].indexOf(_comm.state)!=-1){TVNC.cacheLoaded=false;TVNC.startCmdToSend=false;if(TVNC.rcParams.profileKey)TVNC.initfs(TVNC.rcParams.profileKey);
else{var dbname=TVNC.rcParams.address||"";if(dbname==""||productId.toLowerCase()=="webfmx"||productId.toLowerCase()=="virtualui")TVNC.initfs(productId+"_dev");else{dbname=dbname.replace(".","_").replace(":","_");TVNC.initfs(dbname)}}try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerAuthenticationRequired==null)$(window).trigger("serverAuthenticationRequired");else TVNC.rcParams.events.onServerAuthenticationRequired()}catch(error){helper.console.warning("'onServerAuthenticationRequired' calling attached method fail. message: "+
error.message,error,arguments)}if(typeof userid=="undefined"&&TVNC.rcParams.userid!=null)userid=TVNC.rcParams.userid;if(typeof password=="undefined"&&TVNC.rcParams.password!=null)password=TVNC.rcParams.password;var cmd="cmd";var jsonQuery={};jsonQuery.cmd="connect";if(typeof userid!="undefined"){jsonQuery.userid=escape(userid);TVNC.userid=userid;if(typeof password!="undefined"){jsonQuery.password=escape(password);TVNC.password=password}}jsonQuery.tabid=_getServerUrl.id;jsonQuery.wscompression=TVNC.rcParams.wscompression;
if(TVNC.rcParams.ticket!="")jsonQuery.ticket=TVNC.rcParams.ticket;if(TVNC.rcParams.pin!="")jsonQuery.pin=TVNC.rcParams.pin;if(TVNC.rcParams.sessionKey!="")jsonQuery.sessionKey=TVNC.rcParams.sessionKey;if(TVNC.rcParams.externalId!="")jsonQuery.externalId=TVNC.rcParams.externalId;jsonQuery.destAddr=TVNC.rcParams.address;if(TVNC.rcParams.scraper!=null){jsonQuery.scraper=TVNC.rcParams.scraper;if(TVNC.rcParams.scraperArgs!=null)if(helper.object.getDataTypeOf(TVNC.rcParams.scraperArgs)=="json")helper.object.merge(TVNC.rcParams.scraperArgs,
jsonQuery,true);else TVNC.rcParams.scraperArgs.split("&").forEach(function(kvp){kvp=kvp.split("=");jsonQuery[kvp[0]]=kvp[1]})}jsonQuery.screenWidth=window.screen?.width||window.environment.rawWidth;jsonQuery.screenHeight=window.screen?.height||window.environment.rawHeight;if(typeof window.orientation=="undefined")window.orientation=90;jsonQuery.orientation=window.orientation;if(typeof TVNC.rcParams.lfn!="undefined"&&TVNC.rcParams.lfn!=null&&TVNC.rcParams.lfn!="")jsonQuery.lfn=TVNC.rcParams.lfn;if(TVNC.rcParams.resolution!=
"fixed"){var bw=window.environment.detectedWidth;var bh=window.environment.detectedHeight;if(helper.object.existsPath(self,"clientSettings.UseViewportSize")&&self.clientSettings.UseViewportSize){bw=window.environment.viewportWidth;bh=window.environment.viewportHeight}jsonQuery.browserWidth=bw;jsonQuery.browserHeight=bh}jsonQuery.ogg=true;jsonQuery.supportCur=supportCur();jsonQuery.gfx=agentInfo.gfx;jsonQuery.h264=agentInfo.h264;var callConnect=function(){if(_displayManager){jsonQuery.decoderType=
0;jsonQuery.buffersize=agentInfo.isMobile?22:100;let di=JSON.stringify(getPurgedDisplayManagerInfo());helper.console.log(`Sending monitors info: ${di}`,arguments);jsonQuery.monitors=di}var oturlpass=sessionStorage.getItem("oturlDataPass");if(oturlpass)jsonQuery.oturlpass=oturlpass;var url=_url.httpConnection+cmd+"?cmd=connect";if(TVNC.rcParams.id!=null)url+="&id="+TVNC.rcParams.id;if(TVNC.rcParams.sessionKey)url+="&sessionkey="+TVNC.rcParams.sessionKey;jsonQuery.id=TVNC.rcParams.id;var isLandscape=
window.environment.currentOrientation=="landscape"?true:false;jsonQuery.devicePixelRatio=window.environment.initialDevicePixelRatio||1;jsonQuery.isMobile=agentInfo.isMobile;jsonQuery.isLandscape=isLandscape;jsonQuery.supportsFullScreen=window.environment.supportsFullScreen;jsonQuery.webapp=window.environment.webapp;if(Thinfinity.VirtualChannels&&Thinfinity.VirtualChannels.localServer){jsonQuery.localServer=true;jsonQuery.channelList=Thinfinity.VirtualChannels.getRegisteredNodes(Thinfinity.VirtualChannels.ChannelOrigin.CLIENT).join(",")}var params=
{url:TVNC.getCrossDomainUrl(TVNC.addExtraParams(url)),dataType:helper.ajax.responseType.JSON,data:JSON.stringify(jsonQuery),timeout:7E4,withCredentials:true,error:function(err,status,jqXHR){_comm.serverConnected=false;var XHRstatus=jqXHR.status;BTP_PCR_ERR3=null;var strMsg=helper.string.sprintf(consts.connAttemptFailed,"\nHTTP status code "+jqXHR.status+" "+jqXHR.statusText);if(XHRstatus>=400)helper.console.warning(`${strMsg} - ${jqXHR.responseType==="json"?jqXHR.statusText:jqXHR.responseText}`);
else if(XHRstatus===0){strMsg=consts.urlCantReached+" "+consts.tryingAgain;updateConnectionStatus({"description":strMsg,"errstr":strMsg});window.setTimeout(function(){if(_comm.state<=Thinfinity.Communication.state.CLOSING&&!_isDisconnecting)TVNC.connect()},_restartConnectTimeout);return}else connection.first404IncomingTime=null;TVNC.xmlHttpJson=null;if(_comm.state<=Thinfinity.Communication.state.LOST&&(_fromBroker||XHRstatus==404)){BTP_PCR_RTY=null;helper.console.log("Connect was fail, trying to connect again. ");
window.setTimeout(function(){TVNC.connect()},_restartConnectTimeout)}else{TVNC.closeReconnectDiv();fireCustomEvent("onServerConnectionError",strMsg,jqXHR,err)}},success:function(data,status,jqXHR){if((jqXHR.getResponseHeader("content-type")||"").indexOf("text/html")!=-1){BTP_PCR_ERR4=null;reloadWnd();return}connection.first404IncomingTime=null;TVNC.xmlHttpJson=null;TVNC.onConnectResult(data)}};BTP_PCR_STR=null;serverCmdResultOrientation=null;TVNC.xmlHttpJson=_comm.post(TVNC.completeAjaxParams(params));
if(_comm.state===Thinfinity.Communication.state.RECONNECTING)fireCustomEvent("onServerConnecting",{"reconnecting":Thinfinity.Communication.state.getKey(_comm.state).toString()})};initializeDisplayManager().then(function(res){if(res)callConnect();else{let msg=consts.displayCannotBeInitialized;helper.console.warning(msg,arguments);msg+=`</br><button id="btnClose" onclick="window.location.href= "/";let btn = document.getElementById('btnClose'); btn.parentElement.removeChild(btn);">Close this window</button>`;
document.body.innerText="";helper.dom.appendJsonElement({"parentElement":document.body,"type":"div","attributes":{"class":"bye"},"content":msg});setTimeout(function(){window.location.href="/"},15E3)}}).catch(function(err){helper.console.warning(`${consts.displayManagerError} - ${err.message||err} - ${err.stack||""}`,arguments)})}else{var msg=helper.string.sprintf(consts.connAttemptFailed,"");fireCustomEvent("onServerConnectionError",msg);helper.console.warning(helper.string.format(msg+" - state: {0}",
Thinfinity.Communication.state.getKey(_comm.state).toString()),arguments)}})}function updateConnectionStatus(status){helper.console.log(JSON.stringify(status),arguments);status.reconnecting=connection.fromReconnection;try{if(status.errno===undefined)if(helper.object.existsPath(TVNC,"rcParams.events.onServerConnecting"))TVNC.rcParams.events.onServerConnecting(status);else $(window).trigger("serverConnecting");else if(helper.object.existsPath(TVNC,"rcParams.events.onServerConnectionError"))TVNC.rcParams.events.onServerConnectionError(status.errstr);
else $(window).trigger("serverConnectionError")}catch(error){helper.console.warning("'onServerConnecting' calling attached method fail. message: "+error.message,error,arguments)}}this.addExtraParams=function(url){return url};function reloadWnd(){$(window).off("onbeforeunload");_comm.dispose();window.onbeforeunload=e=>{return};setTimeout(function(){window.location.reload()},1E3)}this.getServerUrl=function(callback){if(callback&&_comm.state<=Thinfinity.Communication.state.CLOSING){if(_getServerUrl.forceNewRedirection)_getServerUrl.forceNewRedirectionUsed=
true;var gsUrl=TVNC.addExtraParams(_virtualPathProfile+"getServerUrl?id=")+_getServerUrl.id+(_getServerUrl.forceNewRedirection?"&forceNewRedirection=true":"");gsUrl+="&preferredBrokerId="+(sessionStorage.getItem(_preferredBrokerKey)||"");helper.console.log(helper.string.format("get server url {0}",gsUrl),arguments);let callTimeout=true;_comm.send({url:gsUrl,async:true,dataType:"json",timeout:3E4,success:function(obj){if(_comm.state<=Thinfinity.Communication.state.CLOSING)try{if(!obj)obj={"state":STATE_PENDING};
var er=false;var status={"state":obj.state,"description":consts.resolving};_getServerUrl.timeout=_getServerUrl.normal_timeout;if(obj.state==STATE_PENDING&&obj.vmcode&&obj.vmtext){_getServerUrl.timeout=_getServerUrl.vm_timeout;status.description=obj.vmtext}else if(obj.state==STATE_BUSY)status.description=consts.waitingForResources;else{if(obj.rdpInfo)switch(obj.rdpInfo.action){case RDP_NO_INFO:break;case RDP_LOGIN_START:status.description=consts.initializingSession;break;case RDP_LOGIN_END:status.description=
consts.sessionInitialized;break;case RDP_LOGIN_INFO:status.description=obj.rdpInfo.errstr;break;case RDP_LOGIN_ERROR:{status.description=consts.sessionInitializationError;status.errno=obj.rdpInfo.errno;status.errstr=obj.rdpInfo.errstr;er=true}}if(obj.redirect){_getServerUrl.forceNewRedirection=false;status.description=consts.connecting;updateConnectionStatus(status);callback({"url":obj.url,"gateway":obj.gateway,"brokerid":obj.brokerid||""});return}}if(!er&&obj.errmsg!=""&&obj.state==STATE_ERROR){status.description=
status.errstr=obj.errmsg;status.errno=obj.state;helper.console.warning(helper.string.format("Cannot connect - error: {0} - state: {1} - reload: {2}",status.description,obj.state,obj.refresh==undefined?"''":obj.refresh),arguments);if(obj.refresh){reloadWnd();return}}if(_comm.state!==Thinfinity.Communication.state.RECONNECTING)updateConnectionStatus(status);callback(status);if(obj.state!=STATE_ERROR)setTimeout(function(){TVNC.getServerUrl(callback)},_getServerUrl.timeout)}catch(e){status={"action":4,
"description":e.message};if(_comm.state!==Thinfinity.Communication.state.RECONNECTING)updateConnectionStatus(status);callback(status)}else callback({"description":consts.connectionNotStablished,"errno":Thinfinity.Communication.errorCode.NO_CONTENT,"errstr":consts.connectionNotStablished})},error:function(response,status,xhr){var XHRStatus=status??xhr.status;var status={"state":STATE_ERROR,"errno":XHRStatus,"description":"","errstr":""};var errstr=xhr.statusText&&xhr.statusText!=""?" ("+xhr.statusText+
")":"EMPTY";helper.console.log(helper.string.format("Error --\x3e getServerUrl - status: {0}",errstr),arguments);_gettingSeverUrl=false;if(_xhrStatusExitCodes.indexOf(XHRStatus)!=-1){switch(XHRStatus){case Thinfinity.Communication.errorCode.UNAUTHORIZED:status.errstr=consts.unknownUser;reloadWnd();break;default:status.description=consts.sessionInitializationError;status.errstr=errstr!=""?errstr:status.description;break}if(_comm.state!=Thinfinity.Communication.state.RECONNECTING)updateConnectionStatus(status);
callback(status);return}else switch(XHRStatus){case Thinfinity.Communication.errorCode.NOT_FOUND:if(TVNC.observable.isOTURLSession)if(_getServerUrl.retriesCount<_getServerUrl.oturlMaxRetries)_getServerUrl.retriesCount++;else{_getServerUrl.forceNewRedirection=false;TVNC.rcParams.events.onServerConnectionError(consts.invalidTicket);return}else{if(connection.reconnectingCount>connection.reconnectingMax){callTimeout=false;let recallGetServerUrl=function(){connection.reconnectingCount=0;TVNC.getServerUrl(callback)};
fetch(_url.baseUrl).then(res=>{if(res.status===200&&res.url.indexOf("/?signin")!==-1)reloadWnd();else setTimeout(recallGetServerUrl,2E3)}).catch(err=>{setTimeout(recallGetServerUrl,2E3)})}connection.reconnectingCount+=1}break}if(callTimeout)setTimeout(function(){TVNC.getServerUrl(callback)},2E3)}});_getServerUrl.forceNewRedirection=false}};this.ping=function(url,error,success,fnconnect){if(url.lastIndexOf("/")!=url.length-1)url+="/";url+="ping?xxx";_comm.send(TVNC.completeAjaxParams({url:TVNC.addExtraParams(url),
dataType:_defaultResponseType,async:false,cache:false,timeout:1E3,error:function(){if(helper.object.validate(error))error()},success:function(){var pathArray=url.split("/");TVNC.rcParams.protocol=pathArray[0];TVNC.rcParams.server=pathArray[2];if(helper.object.validate(success))success();fnconnect()}}))};this.onConnectResult=function(data){TVNC.xmlHttpJson=null;TVNC.connecting=false;TVNC.allowMouse=true;TVNC.closeReconnectDiv();let tryToConnectAgain=()=>{_connectResult.count++;if(_connectResult.count<
_connectResult.max)TVNC.reconnect();else try{let msg=consts.sessionInitializationError;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerConnectionError==null)$(window).trigger("serverConnectionError",msg);else TVNC.rcParams.events.onServerConnectionError(msg);helper.console.warning(`connect result data is empty or null`);TVNC.disconnect();TVNC.dispose()}catch(error){helper.console.error("'onServerConnectionError' calling attached method fail.",error,arguments)}};if(data!=
""&&data)try{_comm.serverConnected=true;var doConnect=function(){if(!obj.id){let err=new Error(`Session ID is not valid: ${obj.id}`);helper.console.error(err.message,err,arguments)}if(obj.id&&TVNC.rcParams.id!=obj.id){ID.set(obj.id);TVNC.rcParams.id=obj.id;TVNC.removeCanvases();if(_fromBroker)keepHTTPAlive(true)}initializeImageQueue(obj.id);let objInstace=obj;let continueConnectResult=function(){obj=objInstace;if((connection.firstConnection||TVNC.wsEnabled)&&!TVNC.rcParams.forceAjax&&("WebSocket"in
window||"MozWebSocket"in window)){TVNC.connectWebSocket(false);if(obj.wolEnabled===true)_comm.wsWOL(true)}else{BTP_PA_STR=null;_comm.setChunkHandlers({"url":TVNC.addExtraParams("json?id="+TVNC.rcParams.id),"id":TVNC.rcParams.id,"success":ajaxSuccessHandler,"error":ajaxErrorHandler});_comm.start();TVNC.start()}connection.firstConnection=false;try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerConnect==null)$(window).trigger("serverConnect",obj);else TVNC.rcParams.events.onServerConnect(obj)}catch(error){helper.console.warning("'onServerConnect' calling attached method fail. message: "+
error.message,error,arguments)}};if(TVNC.rcParams.mode===_eMode.SKEY&&_displayManager&&obj?.monitorDefs?.items)if(TVNC.rcParams.events?.onDisplayInteractionRequired)TVNC.rcParams.events.onDisplayInteractionRequired(obj,continueConnectResult);else continueConnectResult();else continueConnectResult()};var redirecting=false;var obj=TVNC.crossDomain()?data:typeof data!="object"?JSON.parse(data):data;BTP_PCR_END1=null;if(obj.status&&typeof obj.status!="undefined"){if(obj.connectUrl){redirecting=true;TVNC.ping(obj.connectUrl,
function(e){if(obj.connectUrl2)TVNC.ping(obj.connectUrl2,function(e){if(obj.connectPin)_url.baseUrl="/"+obj.connectPin;else try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerRedirect==null)$(window).trigger("serverRedirect",[obj.connectUrl,obj]);else TVNC.rcParams.events.onServerRedirect(obj.connectUrl,obj)}catch(error){helper.console.warning("1 - 'onServerRedirect' calling attached method fail. message: "+error.message,error,arguments)}doConnect()},function(e){if(obj.connectPin)_url.baseUrl=
"/"+obj.connectPin;else try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerRedirect==null)$(window).trigger("serverRedirect",[obj.connectUrl2,obj]);else TVNC.rcParams.events.onServerRedirect(obj.connectUrl2,obj)}catch(error){helper.console.warning("2 - 'onServerRedirect' calling attached method fail. message: "+error.message,error,arguments)}},doConnect);else{if(obj.connectPin)_url.baseUrl="/"+obj.connectPin;else try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerRedirect==
null)$(window).trigger("serverRedirect",[obj.connectUrl,obj]);else TVNC.rcParams.events.onServerRedirect(obj.connectUrl,obj)}catch(error){helper.console.warning("3 - 'onServerRedirect' calling attached method fail. message: "+error.message,error,arguments)}doConnect()}},function(){try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerRedirect==null)$(window).trigger("serverRedirect",[obj.connectUrl,obj]);else TVNC.rcParams.events.onServerRedirect(obj.connectUrl,obj)}catch(error){helper.console.warning("4 - 'onServerRedirect' calling attached method fail. message: "+
error.message,error,arguments)}},doConnect)}else if(obj.connectPin)_url.baseUrl="/"+obj.connectPin;if(!redirecting)doConnect()}else if(obj.authStatus==3)try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerAuthenticationFailed==null)$(window).trigger("serverAuthenticationFailed",obj.errormsg);else TVNC.rcParams.events.onServerAuthenticationFailed(obj.errormsg)}catch(error){helper.console.warning("'onServerAuthenticationFailed' calling attached method fail. message: "+error.message,
error,arguments)}else if(obj.authStatus==4)try{BTP_PT_NC=null;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerNeedCredentials==null)$(window).trigger("serverNeedCredentials",{"credentials":obj.credentials});else TVNC.rcParams.events.onServerNeedCredentials({"credentials":obj.credentials})}catch(error){helper.console.warning("'onServerNeedCredentials' calling attached method fail. message: "+error.message,error,arguments)}else if(obj.errormsg)if(obj.license){if(TVNC.connected)TVNC.disconnect();
let licenseError={title:consts.licenseError,errorType:_licenseTypes.ERR_TYPE_ERROR,errorCode:obj.state||1,errorMsg:obj.errormsg};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onLicenseMsg==null)$(window).trigger("licenseMsg",licenseError);else TVNC.rcParams.events.onLicenseMsg(licenseError)}else{var idZero=typeof obj!="undefined"&&obj["id"]=="0";if(idZero&&!connection.fromReconnection){TVNC.disconnect();TVNC.dispose(undefined,{"code":-1,"message":obj.errormsg})}try{if(typeof TVNC.rcParams.events==
"undefined"||TVNC.rcParams.events.onServerConnectionError==null)$(window).trigger("serverConnectionError",helper.string.sprintf(consts.connAttemptFailed,obj.errormsg));else TVNC.rcParams.events.onServerConnectionError(helper.string.sprintf(consts.connAttemptFailed,obj.errormsg))}catch(error){helper.console.error("'onServerConnectionError' calling attached method fail.",error,arguments)}if(!idZero&&_comm.state!==Thinfinity.Communication.state.RECONNECTING){var status={"code":_enumCloseStatusReason.ERROR,
"message":obj.errormsg};if(productId=="ZSC")TVNC.dispose(false,status);else TVNC.dispose(undefined,status)}else if(idZero)return;else{clearTimeout(timeoutIdBeforeReconnect);timeoutIdBeforeReconnect=setTimeout(function(){TVNC.reconnect()},timeBeforeReconnect)}}else if(obj.id=="lnk"){TVNC.disconnect();TVNC.dispose();window.location.href=obj.url;return}else tryToConnectAgain();obj=null}catch(err){var msg=err;if(err.message)msg=err.message;logError("serverConnectionError: "+msg);try{if(typeof TVNC.rcParams.events==
"undefined"||TVNC.rcParams.events.onServerConnectionError==null)$(window).trigger("serverConnectionError",msg);else TVNC.rcParams.events.onServerConnectionError(msg)}catch(error){helper.console.error("'onServerConnectionError' calling attached method fail.",error,arguments)}}else tryToConnectAgain()};this.gup=function(name){var regex=new RegExp("[\\?&]"+name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)","ig");var results=regex.exec(window.location.href);regex=null;if(results==null)return"";
else return results[1]};this.refresh=function(){TVNC.removeCanvases();_displayManager.fireEvent("resetCursor");TVNC.sendCmd("cmd=refresh")};function ajaxSuccessHandler(data){errorOccurs=0;TVNC.xmlHttpJson=null;if(data!=""&&data)try{if(typeof data.oob!="undefined"){TVNC.fireOOBCmd(data.cmd,data);setTimeout(TVNC.reload,1)}else{data.imgQueue=TVNC.imgQueue;TVNC.msgQueue.push(data);TVNC.buildImgQueue(data);TVNC.processNextScreen();data=null}}catch(err){logError("ajax error: "+err+"\n"+data)}else helper.console.warning("No data on success")}
function ajaxErrorHandler(e,xhr){if(TVNC.xmlHttpJson){TVNC.xmlHttpJson.abort();TVNC.xmlHttpJson=null}if(xhr.status==0&&xhr.statusText=="timeout")restart(true);else if(xhr.status==404)TVNC.connect();else setTimeout(TVNC.reload,1)}this.reload=function(){if(_comm.state>=Thinfinity.Communication.state.CLOSING)return;if(TVNC.useAjax)_comm.getNextChunk();else TVNC.sendAck()};this.clearMouse=function(){this.mouseMoved=false};this.wsSend=function(query,type,data){_comm.wsSend(query,type,data)};this.sendEvent=
function(query,jData){if(_comm.protocol===Thinfinity.Communication.protocol.WEBSOCKET)_comm.wsSend(query);else if(_comm.state<Thinfinity.Communication.state.UNSTABLE)_comm.send(TVNC.completeAjaxParams({"queueName":this.queueRequestName,"url":TVNC.addExtraParams(_url.httpConnection+"cmd?"+query),"async":true,"dataType":_defaultResponseType}));if(_registeredEventsServicesList[_enumEventsServices.SENDEVENT]&&jData){jData.timeStamp=(new Date).getTime();_registeredEventsServicesList[_enumEventsServices.SENDEVENT](jData)}};
this.sendKey=function(key,ch,action,location){if(TVNC.rcParams.active&&TVNC.rcParams.kbdControl)if(typeof TVNC.rcParams.events!="undefined"&&TVNC.rcParams.events.onSendKeys!=null)try{TVNC.rcParams.events.onSendKeys(key,ch,action)}catch(error){helper.console.error("'onSendKeys' calling attached method fail.",error,arguments)}else{if(TVNC.rcParams.kbdLogKeys===true)logDebug("sendKey("+key+", "+ch+", "+action+")");var jData={"cmd":"keyb","key":key,"action":action,"id":TVNC.rcParams.id,"char":escape(ch)};
var cmd="cmd=keyb&key="+key+"&action="+action+"&id="+TVNC.rcParams.id+"&char="+escape(ch);if(typeof location!="undefined"){cmd+="&location="+location;jData.location=location}TVNC.sendEvent(cmd,jData)}};this.sendFunctionKey=function(key){if(TVNC.rcParams.active&&TVNC.rcParams.kbdControl){var jData={"cmd":"fkey","key":encodeURIComponent(key),"id":TVNC.rcParams.id};TVNC.sendEvent("cmd=fkey&key="+encodeURIComponent(key)+"&id="+TVNC.rcParams.id,jData)}};this.sendText=function(text){for(var c=0;c<text.length;c++){TVNC.sendKey(0,
text.charCodeAt(c),"down",0);TVNC.sendKey(0,text.charCodeAt(c),"up",0)}};this.sendKeyStroke=function(key){TVNC.sendKeyDown(key);TVNC.sendKeyUp(key)};this.sendKeyDown=function(key){TVNC.sendKey(key,0,"down",0)};this.sendKeyUp=function(key){TVNC.sendKey(key,0,"up",0)};this.sendCtrlAltDel=function(){TVNC.sendFunctionKey("CtrlAltDel")};this.sendShiftCtrlEsc=function(){TVNC.sendFunctionKey("ShiftCtrlEsc")};this.sendShellExplorer=function(){TVNC.sendFunctionKey("WindowsExplorer")};this.sendShellRun=function(){TVNC.sendFunctionKey("Run")};
this.sendCtrlEsc=function(){TVNC.sendFunctionKey("CtrlEsc")};this.sendCut=function(){TVNC.sendFunctionKey("Cut")};this.sendCopy=function(){TVNC.sendFunctionKey("Copy")};this.sendPaste=function(){TVNC.sendFunctionKey("Paste")};this.translateMouseCoordX=function(x){return x};this.translateMouseCoordY=function(y){return y};this.sendMouse=function(x,y,button,action){if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl&&TVNC.allowMouse){if(TVNC.useAjax&&action=="move"&&_comm.queueLength(TVNC.queueRequestName)>
0)return;TVNC.clearMouse();TVNC.lastMouseAction=action;x=parseInt(x,10)+TVNC.rcParams.viewLeft;y=parseInt(y,10)+TVNC.rcParams.viewTop;var tx=TVNC.translateMouseCoordX(x);var ty=TVNC.translateMouseCoordY(y);var jData={"cmd":"mouse","x":tx,"y":ty,"btn":button,"action":action,"id":TVNC.rcParams.id};TVNC.sendEvent("cmd=mouse&x="+tx+"&y="+ty+"&btn="+button+"&action="+action+"&id="+TVNC.rcParams.id,jData)}};this.sendMouseQueue=function(){clearTimeout(_mouseQueueTimeout);if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl&&
TVNC.allowMouse){if(mouseBuffer.queue.length>0){var buffer=mouseBuffer.queue;if([Thinfinity.Communication.state.RECONNECTING,Thinfinity.Communication.state.UNSTABLE,Thinfinity.Communication.state.LOST].indexOf(_comm.state)!=-1)for(var i=buffer-length-1;i>=0;i--)if(buffer[i].action=="move"){var temp=buffer[i];buffer=[];buffer.push(temp);break}TVNC.lastMouseAction=buffer[buffer.length-1].action;var sBuffer=JSON.stringify(buffer);TVNC.sendEvent("cmd=mouse&data="+sBuffer+"&id="+TVNC.rcParams.id,{"cmd":"mouse",
"data":sBuffer,"id":TVNC.rcParams.id});mouseBuffer.queue=[]}_mouseQueueTimeout=setTimeout(TVNC.sendMouseQueue,10)}};this.sendMouseMove=function(){clearTimeout(_mouseQueueTimeout);if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl&&!_avoidSendMouseMove){if(TVNC.mouseMoved)TVNC.sendMouse(TVNC.mouseX,TVNC.mouseY,0,"move");else if(TVNC.lastMouseAction=="move")TVNC.lastMouseAction="";_mouseQueueTimeout=setTimeout(TVNC.sendMouseMove,TVNC.rcParams.mouseMoveProcessInterval)}};this.sendWheel=function(deltaY,
deltaX){if(TVNC.rcParams.active&&TVNC.rcParams.mouseControl){var action="";var delta=0;if(deltaY!=0){action="wheel";delta=deltaY*_deltaYMultiplier}else{action="hwheel";delta=deltaX}var jData={"id":TVNC.rcParams.id,"action":action,"delta":delta};if(mouseBuffer.isAvailable)mouseBuffer.queue.push(jData);else TVNC.sendEvent("cmd=mouse&id="+TVNC.rcParams.id+"&action="+action+"&delta="+delta,jData)}};this.IsNumKey=function(code){return code>=96&&code<=111&&code!=108||code==144};this.isIMEKey=function(e){return(e.which||
e.keyCode)==229};this.isMacAltKey=function(e){return this.mac&&e.altKey};this.IsFunctionKey=function(keyCode){return keyCode>=112&&keyCode<=123||keyCode>=33&&keyCode<=40||keyCode>=45&&keyCode<=46||keyCode>=16&&keyCode<=20||keyCode>=91&&keyCode<=93||keyCode==13||keyCode==9||keyCode==8||keyCode==27||keyCode==144||keyCode==12||keyCode==224};this.hookKM=function(){if(!TVNC.MouseHooked){TVNC.MouseHooked=true;if(TVNC.rcParams.hookMouse);TVNC.bindKeyboardEvents()}};this.clearKbdMacInputTimer=function(){window.clearInterval(this.kbdMacInputTimer);
this.kbdMacInputTimer=null};this.inputAllowed=function(e){if(e&&_preventKeys.available)if(_preventKeys.keys[e.keyCode]){var modifiers=_preventKeys.keys[e.keyCode];var prevent=true;for(var mk in modifiers){prevent&=e[mk]===modifiers[mk];if(!prevent)break}if(prevent)return false}var isUIBlocked=$(".blockUI.blockOverlay:visible").length>0;var isIndex=false;if(productId=="ZSC"){if(emulcont==null)emulcont=document.getElementById("emulcont");if(emulcont&&parseInt(emulcont.style.left.replace("px",""),10)>
0)isIndex=true}return _comm.state<Thinfinity.Communication.state.UNSTABLE&&!isUIBlocked&&!isIndex&&(!TVNC.rcParams.useFocus||TVNC.inputEnabled)};this.bindKeyboardEvents=function(){TVNC.inputEnabled=true;if(TVNC.rcParams.hookKeyboard)if(TVNC.KeyboardHooked)_displayManager.focus();else{if(agentInfo.isMobile&&productId=="ZSC")return;TVNC.KeyboardHooked=true}};this.unbindKeyboardEvents=function(){TVNC.inputEnabled=false};this.mouseDown=function(x,y,button){_displayManager.fireEvent("mouseDown",x,y,button,
{async:false})};this.mouseUp=function(x,y,button){_displayManager.fireEvent("mouseUp",x,y,button,{async:false})};this.mouseMove=function(x,y){_displayManager.fireEvent("mouseMove",x,y,{async:false})};this.setFocus=function(X,Y){var position=TVNC.findPos(TVNC.vncContainer);let gs=_displayManager.processDisplayCmd("GET_SCALE");X=Math.round((X-position[0])/gs);Y=Math.round((Y-position[1])/gs);$('[id^="'+productId+'_"]').each(function(index){var win=$(this)[0];if(win.offsetLeft<=X&&win.offsetTop<=Y&&
win.offsetLeft+win.offsetWidth>=X&&win.offsetTop+win.offsetHeight>=Y)return win});return null};this.hasChildOfByClassName=function(classname,child){var elems=document.getElementsByClassName(classname);for(var i=0;i<elems.length;i++)if(elems[i].contains(child))return true;return false};this.getElementFromPoint=function(e){var x,y;if((e.changedTouches||e.touches)&&(e.changedTouches||e.touches).length>0){x=(e.changedTouches||e.touches)[0].pageX-document.body.offsetLeft;y=(e.changedTouches||e.touches)[0].pageY-
document.body.offsetTop}else if(e.clientX!=undefined||e.pageX!=undefined){x=e.clientX||e.pageX-document.body.offsetLeft;y=e.clientY||e.pageY-document.body.offsetTop}else if(e.pointers!=undefined&&e.pointers.length>0){x=e.pointers[0].pageX-document.body.offsetLeft;y=e.pointers[0].pageY-document.body.offsetTop}var idMask=productId+"_canvas_";var selectedElement=document.elementFromPoint(x,y);if(selectedElement&&(!helper.style.hasClass(selectedElement,"__uselocalmouse__")&&!TVNC.hasChildOfByClassName("__uselocalmouse__",
selectedElement)&&(selectedElement.tagName=="CANVAS"||selectedElement.name=="caret"||selectedElement.id=="caret"||selectedElement==TVNC.vncdiv||selectedElement.id.indexOf(idMask)!=-1||helper.style.hasClass(selectedElement,"ignoremouse"))))return null;else return selectedElement};this.setClipboardPosition=function(){};function isInsideOfArea(x,y,rad){return Math.pow(x,2)+Math.pow(y,2)<=rad}this.checkPacketIndex=function(pckIdx,groupIdx,eod){if(_lastPkt.idx==99&&pckIdx==0&&eod)_lastPkt.idx=-1;if(_lastPkt.idx==
-1&&_lastPkt.reset){_lastPkt.reset=false;_lastPkt.idx=pckIdx-1}if(_lastPkt.idx+1!=pckIdx){if(_lastPkt.idx+1<pckIdx){TVNC.logger.logWarning(helper.string.format("Missing pkt: {2} - last: {0}, current: {1}, groupIdx: {3}, UBRWID: {4}",_lastPkt.idx,pckIdx,_lastPkt.idx+1,groupIdx,TVNC.rcParams.UBRWID),"*");helper.console.warning(helper.string.format("Missing pkt: {2} - last: {0}, current: {1}, groupIdx: {3}, UBRWID: {4}",_lastPkt.idx,pckIdx,_lastPkt.idx+1,groupIdx,TVNC.rcParams.UBRWID),arguments)}else{TVNC.logger.logWarning(helper.string.format("Pkt treated - last: {0}, current: {1}, groupIdx: {2}, UBRWID: {3}",
_lastPkt.idx,pckIdx,groupIdx,TVNC.rcParams.UBRWID),"*");helper.console.warning(helper.string.format("Pkt treated - last: {0}, current: {1}, groupIdx: {2}, UBRWID: {3}",_lastPkt.idx,pckIdx,groupIdx,TVNC.rcParams.UBRWID),arguments)}if(eod)_lastPkt.idx=pckIdx;restartConnection()}else if(eod)_lastPkt.idx=pckIdx;else if(_lastPkt.idx==-1)_lastPkt.idx=0};this.getNextHighestZindex=function(obj){var highestIndex=0;var currentIndex=0;var elArray=Array();if(obj)elArray=obj.getElementsByTagName("*");else elArray=
document.getElementsByTagName("*");for(var i=0;i<elArray.length;i++){if(elArray[i].currentStyle)currentIndex=parseFloat(elArray[i].currentStyle["zIndex"]);else if(window.getComputedStyle)currentIndex=parseFloat(document.defaultView.getComputedStyle(elArray[i],null).getPropertyValue("z-index"));if(!isNaN(currentIndex)&&currentIndex>highestIndex)highestIndex=currentIndex}return highestIndex+1};function checkSplashPopup(){var elem=document.querySelector(_splashCssName);if(elem)if(elem.style.getPropertyValue("display")!=
"none"&&elem.style.getPropertyValue("visibility")!="hidden"){var b=elem.getBoundingClientRect();return b.x>0&&b.x<TVNC.rcParams.width&&b.y>0&&b.y<TVNC.rcParams.height&&b.height>0&&b.width>0}else return false;else return false}this.reconnect=function(){if(_comm.state>=Thinfinity.Communication.state.CLOSING)return;connection.fromReconnection=true;if(Thinfinity.Popups&&Thinfinity.Popups.growl)Thinfinity.Popups.growl.unblockAll();TVNC.processNextScreenEnabled=true;if(document.getElementById(TVNC.reconnectDivId)==
null){if(!TVNC.rcParams.overrideCursor)_displayManager.fireEvent("resetCursor");if(!_avoidConnectionLostPopup)TVNC.showReconnectDiv(true);try{if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerReconnect==null)$(window).trigger("serverReconnect");else TVNC.rcParams.events.onServerReconnect()}catch(error){helper.console.error("'onServerReconnect' calling attached method fail.",error,arguments)}if(TVNC.useAjax){if(TVNC.xmlHttpJson){TVNC.xmlHttpJson.abort();TVNC.xmlHttpJson=null}_comm.releaseQueue(TVNC.queueRequestName)}}if(helper.object.existsPath(TVNC,
"rcParams.scraperArgs")&&typeof TVNC.rcParams!="undefined"&&(TVNC.rcParams.resolution=="fittobrowser"||TVNC.rcParams.resolution=="fittoscreen")){var w=window.environment.detectedWidth;var h=window.environment.detectedHeight;if(helper.object.existsPath(self,"clientSettings.UseViewportSize")&&self.clientSettings.UseViewportSize){w=window.environment.viewportWidth;h=window.environment.viewportHeight}if(helper.object.getDataTypeOf(TVNC.rcParams.scraperArgs)=="json"){TVNC.rcParams.scraperArgs.browserWidth=
w;TVNC.rcParams.scraperArgs.browserHeight=h}else{TVNC.rcParams.scraperArgs=TVNC.removeBrowserSize(TVNC.rcParams.scraperArgs);TVNC.rcParams.scraperArgs+="&browserWidth="+w+"&browserHeight="+h}}TVNC.connect()};this.supportsHTML5Storage=function(){try{return"localStorage"in window&&window["localStorage"]!=null}catch(err){return false}};this.getStorageName=function(){var middle=this.rcParams.address?"_"+this.rcParams.address:"";return"thinvnc"+middle+"_prefs"};this.loadPreferences=function(){if(!this.supportsHTML5Storage())return;
try{var objJson=localStorage.getItem(this.getStorageName());var objData=JSON.parse(objJson);if(objData!=null&&typeof objData!="undefined")_onlyKeyCode=objData.onlykeycode!=null?objData.onlykeycode:_onlyKeyCode}catch(err){}};this.savePreferences=function(){if(!this.supportsHTML5Storage())return;try{var objData=new Object;objData.onlykeycode=_onlyKeyCode;var objJson=JSON.stringify(objData);localStorage.setItem(this.getStorageName(),objJson)}catch(err){}};this.applyParam=function(params,name,value){if(typeof value==
"object"&&value!=null){var obj=params[name];if(!obj)obj={};for(var v in value)obj[v]=value[v];params[name]=obj}else params[name]=value};this.setParams=function(dd,ee){for(var o in dd)this.applyParam(TVNC.rcParams,o,dd[o]);this.rcParams.events=ee;TVNC.rdpMode=this.rcParams.scraper=="RDP"};this.resolveAgent=function(){TVNC.majorVersion=agentInfo.majorVersion;TVNC.firefoxVersion=agentInfo.firefoxVersion;TVNC.mac=agentInfo.isMac;TVNC.ios=agentInfo.isIOS;TVNC.iosVersion=agentInfo.iosVersion;TVNC.iphone=
agentInfo.isIphone;TVNC.android=agentInfo.isAndroid;TVNC.hptablet=agentInfo.isHPTablet;TVNC.playbook=agentInfo.isPlaybook;TVNC.chromeOS=agentInfo.isChromeOS;TVNC.symbian=agentInfo.isSymbian;TVNC.firefox=agentInfo.isFirefox;TVNC.firefoxVersion=agentInfo.firefoxVersion;TVNC.opera=agentInfo.isOpera;TVNC.chrome=agentInfo.isChrome;TVNC.safari=agentInfo.isSafari;TVNC.msie=agentInfo.isMSIE;TVNC.msieVersion=agentInfo.msieVersion;TVNC.nokia=agentInfo.isNokiaBrowser;TVNC.mobile=agentInfo.isMobile&&!TVNC.rcParams.forceDesktop;
TVNC.touch=agentInfo.isTouch;TVNC.agentName=agentInfo.getAgentKey()};this.appendElement=function(parentElem,type,name,attrColl,content){var elem=document.createElement(type);if(name!=null&&name!=""){elem.setAttribute("name",name);elem.setAttribute("id",name)}for(var a in attrColl)if(a=="style"){var s=attrColl[a].split(";");s.forEach(function(item){var kvp=item.split(":");elem.style[helper.string.trim(kvp[0])]=helper.string.trim(kvp[1])})}else elem.setAttribute(a,attrColl[a]);if(content)elem.innerHTML=
content;parentElem.appendChild(elem);return elem};this.initfs=function(dbname){if(!this.rcParams.persistentCache){TVNC.cacheLoaded=true;TVNC.sendStart();return}if(typeof FS!="undefined"&&!TVNC.fs){TVNC.fs=new FS(dbname);TVNC.fs.init(function(){TVNC.fs.enumFiles(function(filename){TVNC.dbFiles.push(filename)},function(){TVNC.cacheLoaded=true;TVNC.sendStart()})},function(){delete TVNC.fs;TVNC.fs=null;TVNC.cacheLoaded=true;TVNC.sendStart()})}else{TVNC.cacheLoaded=true;TVNC.sendStart()}};this.applyParams=
function(dd){for(var o in dd)this.rcParams[o]=dd[o];TVNC.vncdivId=TVNC.rcParams.divId?TVNC.rcParams.divId:TVNC.vncdivId;TVNC.centered=TVNC.rcParams.centered;if(this.rcParams.showOnStart==false)if(Thinfinity.Popups&&Thinfinity.Popups.establishing.backgroundStyle===Thinfinity.Popups.establishing.backgroundStyles.NONE)TVNC.hide();TVNC.vncdiv=document.getElementById(TVNC.vncdivId);if(typeof TVNC.vncdiv=="undefined"||TVNC.vncdiv==null){var errorMsg="Container element is null or undefined, "+consts.technicalSupport;
logError(errorMsg);try{let oError={message:errorMsg};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerError==null)$(window).trigger("serverError",oError);else TVNC.rcParams.events.onServerError(oError)}catch(error){helper.console.error("'onServerError' calling attached method fail.",error,arguments)}TVNC.disconnect();throw new Error(errorMsg);}if(!TVNC.vncdiv)throw new Error("the "+TVNC.vncdivId+" is not available");TVNC.savedMaxWidth=TVNC.rcParams.maxWidth;TVNC.savedMaxHeight=
TVNC.rcParams.maxHeight;if(TVNC.rcParams.fitmode==0||TVNC.rcParams.fitToBrowser==true){TVNC.vncdiv.style.position="relative";TVNC.vncdiv.style.overflow="hidden";TVNC.vncdiv.style.top="0px";TVNC.vncdiv.style.marginTop="0px";TVNC.vncdiv.style.left="0px";TVNC.vncdiv.style.marginLeft="0px"}};this.init=function(dd){TVNC.applyParams(dd);var tempForceAjax=TVNC.gup("forceAjax");if(tempForceAjax!=""){TVNC.rcParams.forceAjax=helper.object.convertTo(tempForceAjax,"boolean");_comm.protocol=Thinfinity.Communication.protocol.AJAX}TVNC.resolveAgent();
if(TVNC.rdpMode&&TVNC.centered&&agentInfo.isMobile&&window.environment.supportsFullScreen){TVNC.vncContainer=document.getElementById("vncContainer");if(TVNC.vncContainer==null){TVNC.vncContainer=document.createElement("div");TVNC.vncContainer.id="vncContainer";TVNC.vncContainer.style.margin="auto auto";TVNC.vncContainer.style.height="auto";TVNC.vncContainer.style.width="auto";TVNC.vncContainer.style.minWidth="100px";TVNC.vncContainer.style.minHeight="100px";TVNC.vncContainer.style.backgroundColor=
"transparent";TVNC.vncContainer.style.position="relative";TVNC.vncdiv.appendChild(TVNC.vncContainer)}}else TVNC.vncContainer=TVNC.vncdiv;function isEmbeddedPrinter(){try{return window&&window.parent&&window.parent.document.getElementsByClassName("embedded-printer-device-container").length>0}catch(error){return false}}if(helper.object.existsPath(window,"Thinfinity.VisualEffect")){function isSlideMode(){try{if(window!=window.parent&&typeof window.parent!="undefined")if(window.parent.document&&window.parent.document.getElementsByTagName){var iframes=
window.parent.document.getElementsByTagName("iframe");for(var ifrIdx=0;ifrIdx<iframes.length;ifrIdx++)if(iframes[ifrIdx].contentWindow.name==window.name)return true;iframes=null}}catch(error){}return false}if(!isEmbeddedPrinter())_visualEffect=new Thinfinity.VisualEffect({"id":"visualEffectContainer","container":productId=="ZSC"?isSlideMode()?document.body:document.getElementById("prnBefore")||TVNC.vncContainer:TVNC.vncContainer,"allowReconnectionDialog":true,"events":{"onCancel":function(){TVNC.closeReconnectDiv();
TVNC.disconnect();$(document).unbind();$("#"+TVNC.vncdivId).unbind()}}})}TVNC.supportsCanvas=!!document.createElement("canvas").getContext;if(!_url.baseUrl){var path=TVNC.rcParams.url?TVNC.rcParams.url:window.location.href;var pathArray=path.split("/");if(TVNC.rcParams.protocol==""||!TVNC.rcParams.protocol)TVNC.rcParams.protocol=pathArray[0];if(TVNC.rcParams.server==""||!TVNC.rcParams.server)TVNC.rcParams.server=pathArray[2];_url.baseUrl="/";for(i=3;i<pathArray.length-1;i++){_url.baseUrl+=pathArray[i];
_url.baseUrl+="/"}}TVNC.loadPreferences();clearTimeout(TVNC.emptyRecycleImgTimeout);TVNC.emptyRecycleImgTimeout=setTimeout(TVNC.emptyRecycleImg,TVNC.recycleImgTimeoutValue);for(i=0;i<12;i++)this.rdpGlyphArray[i]=Array(256);TVNC.registerOOBCmd("cookie",function(obj){var cookieString=obj&&obj.cookie?obj.cookie:null;if(cookieString&&typeof cookieString==="string"&&cookieString.trim().length>0){writeCookies(extractCookie(cookieString,true),true);syncCookies()}});TVNC.registerOOBCmd("aslwarning",function(obj){var secondsToClose=
obj&&obj.secondsToClose?obj.secondsToClose:null;if(secondsToClose&&secondsToClose>0){var unit=consts.minutes;var min=obj.secondsToClose/60;var val=null;var color="";if(min===1){unit=consts.minute;val=min}else if(min>1){min=Math.ceil(min);unit=consts.minutes;val=min}else{min=Math.trunc(min);unit=consts.seconds;color="color:red;";val=secondsToClose}var msg=helper.string.sprintf(consts.sessionTimeout,`<b style="${color}">${val}</b>`,unit);var data={"secondsToClose":secondsToClose,"minutesToClose":min,
"message":msg};if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onSessionTimeout==null)$(window).trigger("SessionTimeout",data);else TVNC.rcParams.events.onSessionTimeout(data)}});TVNC.registerOOBCmd("licenseMsg",function(obj){obj.title=consts.licenseError;if(obj&&obj.errorType===_licenseTypes.ERR_TYPE_ERROR){if(typeof obj.errorCode!="undefined"){helper.console.warning(helper.string.format("Error Code: {0}, Message: {1}",obj.errorCode,obj.errorMsg),arguments);if(TVNC.connected)TVNC.disconnect()}}else helper.console.warning(obj.title+
" "+obj.errorMsg,arguments);let res=false;if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onLicenseMsg==null)$(window).trigger("licenseMsg",obj);else res=TVNC.rcParams.events.onLicenseMsg(obj);if(!res)TVNC.dispose(undefined,{"title":obj.title,"message":obj.errorMsg})})};function getComponentSettings(callback){helper.ajax.get({"url":`${helper.url.parseUrl(location.href).toUrl("-a-r")}/component.settings.json`,"type":helper.ajax.responseType.JSON,"success":callback,"error":function(e,
status,xhr){callback(null)}})}function initializeComponents(permissions){var _isLegacy=typeof cookiePrefix==="undefined"||cookiePrefix!=="fmx"?false:typeof legacyVersion!="undefined"?legacyVersion:true;if(!_componentsInitialized&&Thinfinity.Component&&Thinfinity.Component.RegistrationServices&&!_isLegacy){var panelContructor=function(params){if(Thinfinity.Component.Panel)return new Thinfinity.Component.Panel({"parentElement":document.body,"params":params})};getComponentSettings(function(components){_componentRegistrationServices=
new Thinfinity.Component.RegistrationServices({"owner":TVNC,"permissions":permissions,"components":components,"constructors":{"PANEL":panelContructor},"getAuthorization":function(name,callback){callback(true)}});_componentsInitialized=true});helper.dom.addEvent(window,"thinfinity.components.registration.services.ready",function(){if(_oInterface)TVNC.registerComponentObject("OINTERFACE",_oInterface)})}}function sendCookiesCmd(success,error){var d=new Date;var n=d.getTime();var url=_url.httpConnection+
"cmd?id="+TVNC.rcParams.id+"&cmd=cookie&dt="+n;writeCookies(_syncCookies.data,false);_comm.post({"url":url,"data":'{"cookie":'+n+"}","type":"json","success":success,"error":error})}function getCurrentCookiePath(){return _url.brokerUrl.replace(/\/$/,"")}function getFullCookiePath(){return _url.baseUrl.replace(/\/$/,"")}function startCookiesSync(){clearTimeout(_syncCookies.syncCookiesTOUT);if(_syncCookies.syncCookiesEnabled)_syncCookies.syncCookiesTOUT=setTimeout(()=>{syncCookies(startCookiesSync)},
_syncCookies.syncCookiesTime)}function extractCookie(strCookies,singleCookie){let cookieData=null;let name=null;if(strCookies!=""){cookieData={};strCookies.split(";").forEach(c=>{let [k,v]=c.split("=");k=k.trim();if(singleCookie)if(!name){name=k;cookieData[name]={name,value:v,expires:null,path:getCurrentCookiePath(),domain:null,svalue:null,targetPath:getFullCookiePath()}}else{if(cookieData[name].hasOwnProperty(k))cookieData[name][k]=v}else cookieData[k]={name:k.trim(),value:v,expires:null,path:getCurrentCookiePath(),
domain:null,svalue:null,targetPath:getFullCookiePath()}})}return cookieData}function writeCookies(data,toLocal){if(data){let expDate=(new Date(Date.now()+750)).toUTCString();Object.keys(data).forEach(k=>{let c=data[k];document.cookie=`${c.name}=${c.value};name=${c.name};${toLocal?"":"expires='"+expDate+"';"}path=${toLocal?c.path:c.targetPath}`})}}function syncCookies(callback){if(_syncCookies.syncCookiesEnabled&&_comm.state===Thinfinity.Communication.state.CONNECTED){let hasChanged=false;let _data=
extractCookie(document.cookie,false);if(_data)Object.keys(_data).forEach(k=>{if(!hasChanged)if(!_syncCookies.data[k])hasChanged=true;else{let l=_syncCookies.data[k];let r=_data[k];if(l.value!=r.value||l.path!=r.path||l.domain!=r.domain||l.expires!=r.expires)hasChanged=true}});if(hasChanged){_syncCookies.data=_data;sendCookiesCmd(callback,callback)}else callback()}else callback()}function stopSyncCookies(){_syncCookies.syncCookiesEnabled=false;clearTimeout(_syncCookies.syncCookiesTOUT);_syncCookies.syncCookiesTOUT=
null}this.openPrnManager=function(url,showCancel){function onShow(msg){Thinfinity.Popups.unblock();if(typeof msg=="undefined")msg=["<div class='popup' id='printDlg'><div id='printIco'>&nbsp;</div><div id='printDlgMsg'>",consts.printedDocReady,"</div><br/><div class='divbuttons'><a id='prnWOpenDocBtn' class='popuplink'>open</a>","<span id='prnWShowAllGroup'>&nbsp; &nbsp; <a id='prnWShowAllBtn' class='popuplink'>",consts.showAll,"</a>",showCancel?"&nbsp; &nbsp; <a class='popuplink' id='prnWCloseBtn' >"+
consts.discard+"</a>":"","</div></div>"].join("");var popup=new Thinfinity.Popups.popup;popup.block("printDlg",msg,null,function(e){$("#prnWOpenDocBtn").on("click",function(){TVNC.printerManager.openDocuments(true)});$("#prnWShowAllBtn").on("click",function(){TVNC.printerManager.showAllPrintings(true)});$("#prnWCloseBtn").on("click",function(){TVNC.printerManager.discard(true)});setTimeout(TVNC.reload,1)})}function onShowAll(obj){TVNC.printingWindow=window.open("printings.html","printingWindow")}
function onClose(){$.unblockUI();if(!!TVNC.printingWindow&&!TVNC.printingWindow.location)TVNC.printingWindow=null}function onEnqueueDocument(obj){if(obj.count==1){$("#printDlgMsg").html(consts.printedDocReady);$("#prnWShowAllGroup").hide()}else{$("#printDlgMsg").html(helper.string.sprintf(consts.printedDocsReady,obj.count));$("#prnWShowAllGroup").show()}}function onDiscard(){if(!!TVNC.printingWindow)if(!TVNC.printingWindow.location)TVNC.printingWindow=null;else TVNC.printingWindow.location.href=TVNC.printingWindow.location.href}
function onCheckVisibility(){var v=$("#printDlg").width();return v>0}if(!TVNC.printerManager)TVNC.printerManager=new PrinterManager({"onShow":onShow,"onShowAll":onShowAll,"onClose":onClose,"onEnqueueDocument":onEnqueueDocument,"onDiscard":onDiscard,"onCheckVisibility":onCheckVisibility});TVNC.printerManager.enqueueDocument(url)};this.openPrnWindow=function(url,showCancel){if(typeof PrinterManager!="undefined")this.openPrnManager(url,showCancel);else{var msg="<div class='popup' id='printDlg'><div id='printIco'>&nbsp;</div><div>"+
consts.printedDocReady+"</div><br/><div class='divbuttons'><a class='popuplink' href='"+(url.url.indexOf("?"+_SIDName+"=")==-1?url.url:url.url.substring(0,url.url.indexOf("?"+_SIDName+"=")))+"' target='_blank' onclick='$.unblockUI()'>open</a>";if(showCancel)msg+="&nbsp; &nbsp; <a class='popuplink' onclick='$.unblockUI()'>discard</a>";msg+="</div></div>";Thinfinity.Popups.unblock();var popup=new Thinfinity.Popups.popup;popup.block("printDlg",msg,null,function(){setTimeout(TVNC.reload,1)})}};this.openLinkDlg=
function(url,caption){helper.console.warning("openLinkDlg is deprecated, use 'Thinfinity.OpenLinkPopup'");if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onOpenLink==null)$(window).trigger("OpenLink",obj);else TVNC.rcParams.events.onOpenLink(obj)};function changeAppFocus(value){var cmd="cmd=focus"+"&value="+value;logDebug('switch app - "CTRL + TAB", cmd:'+cmd);TVNC.sendCmd(cmd)}this.show=function(){helper.style.add(TVNC.vncdiv,{"display":"inherit"})};this.hide=function(){helper.style.add(TVNC.vncdiv,
{"display":"none"})};function removeFunctions(){TVNC.zoomDesktop(1)}function sendTabFocusCmd(monitorId,cmd,value){if(_comm.state==Thinfinity.Communication.state.CONNECTED){TVNC.sendCmd(`cmd=${cmd}&value=${value.toString()}${typeof monitorId!=="undefined"?"&monitorId="+monitorId:""}`);if(_registeredEventsServicesList[_enumEventsServices.SENDEVENT]&&cmd!=="visibilityState")_registeredEventsServicesList[_enumEventsServices.SENDEVENT]({"timeStamp ":(new Date).getTime(),"cmd":"focus","value":value.toString(),
"monitorId":monitorId})}if(cmd==="focus"||cmd==="tabvisible")triggerCustomEvent(value?"focus":"blur");if(TVNC.rcParams.clipboard&&TVNC.rcParams.synchronizeClipboard){let b=value===true||value==="visible";if(!b)_clipSynchronized=false;else if(document.hasFocus()){_clipSynchronized=true;_displayManager.fireEvent("synchronizeRemoteClipboard",{async:false})}}}if(productId=="ZSC"&&TVNC.rcParams.hookKeyboard&&!TVNC.KeyboardHooked&&TVNC.triggerCustomEvent==undefined)Object.defineProperty(TVNC,"triggerCustomEvent",
{"enumerable":false,"configurable":false,"writable":false,"value":triggerCustomEvent});_packetReceiver=new Thinfinity.PacketReceiver({properties:{async:this.wsAsyncRecv,asyncTimeout:this.wsAsyncRecvTimeout,checkPacketIndex:this.isPktIdxEnabled},methods:{getRawBinaryHandler},handlers:{0:processJson,1:screenImage,3:queueText,5:function(group,arrayView){if(_ePictureType!==_enumPictureType.H264){triggerCustomEvent("H264");_ePictureType=_enumPictureType.H264;removeFunctions()}var id=arrayView[1];TVNC.sendCmd(`cmd=fc-pre&idx=${arrayView[2]}&id=${id}`);
_displayManager.processData(id,arrayView[0],arrayView.subarray(3))},6:function(group,arrayView){if(TVNC.rcParams.events.onFileStream)TVNC.rcParams.events.onFileStream(arrayView)},8:function(group,arrayView){if(_ePictureType===_enumPictureType.H264)return;if(_ePictureType!==_enumPictureType.GFX){triggerCustomEvent("GFX");_ePictureType=_enumPictureType.GFX;_displayManager.processData(null,Thinfinity.Display.Manager.EVENT_TYPES.GFX_RDP_INITIALIZE);removeFunctions()}_displayManager.processData(null,arrayView[0],
arrayView.subarray(1))}}});_packetReceiver.on("warning",function(msg){helper.console.warning(msg+", UBRWID: "+TVNC.rcParams.UBRWID,arguments);TVNC.logger.logWarning(msg+", UBRWID: "+TVNC.rcParams.UBRWID)});_packetReceiver.on("restartConnection",restartConnection);Object.defineProperty(this,"registerCustomHandler",{"enumerable":false,"configurable":false,"writable":false,"value":_packetReceiver.registerHandler});function processJson(group,arrayView,json){json=json||TVNC.arbufToStringU8((new Zlib.RawInflate(arrayView)).decompress());
if(json==="{}")return;try{var obj=JSON.parse(json)}catch(err){logError("err: "+err);logError("json: "+json);return}json=null;obj.group=group;if(typeof obj.oob!="undefined"){if(TVNC.fireOOBCmd(obj.cmd,obj))return;if(obj.cmd=="getImgCache"){var cmd="cmd=imgCache";cmd+="&items="+getImageCacheList(cmd.compression);TVNC.sendCmd(cmd)}else if(obj.cmd=="getNativeClasses"){var cmd="cmd=nativeClasses";cmd+="&items="+TVNC.controlFactory.getClassList();TVNC.sendCmd(cmd)}else if(obj.cmd=="openUrl")if(typeof TVNC.rcParams.events==
"undefined"||TVNC.rcParams.events.onOpenLink==null)$(window).trigger("OpenLink",obj);else TVNC.rcParams.events.onOpenLink(obj);else if(obj.cmd=="showMsg")if(typeof TVNC.rcParams.events=="undefined"||TVNC.rcParams.events.onServerMessage==null)$(window).trigger("ServerMessage",obj);else TVNC.rcParams.events.onServerMessage(obj);else if(obj.cmd=="shadowingStatus")if(typeof TVNC.rcParams.events?.onShadowingStatus)TVNC.rcParams.events.onShadowingStatus(obj.shadowed);else $(window).trigger("ShadowingStatus",
obj.shadowed);else if(obj.cmd=="clisync"){if(TVNC.rcParams.clipboard&&TVNC.rcParams.synchronizeClipboard){_clipSynchronized=true;_displayManager.fireEvent("synchronizeLocalClipboard",obj,{async:false})}}else if(TVNC.controlFactory)TVNC.controlFactory.dispatchEvent(obj.oob,obj.cmd,obj)}else if(typeof obj.id!="undefined")TVNC.serverCmdResult(obj);else if(obj.preidx)TVNC.sendCmd("cmd=fc-pre&idx="+obj.preidx);else if(obj.status){obj.imgQueue=TVNC.imgQueue;TVNC.msgQueue.push(obj);TVNC.processNextScreen()}}
function screenImage(group,arrayView){var key=((arrayView[0]-48)*1E4|0)+((arrayView[1]-48)*1E3|0)+((arrayView[2]-48)*100|0)+((arrayView[3]-48)*10|0)+(arrayView[4]-48)|0;key=TVNC.getKeyFromCmd(group,key);var type=TVNC.arbufToStringU8(arrayView.subarray(5,9)).replace(/ /g,"");var hashLength=0;var hash="";dataIndex=9;var item=TVNC.getImageItem();if(type=="idec")item.fromImageDecoderData(arrayView.subarray(dataIndex),type,hash,key);else{if(arrayView[dataIndex]==58){++dataIndex;do++hashLength;while(arrayView[dataIndex+
hashLength]!=58);hash=TVNC.arbufToStringU8(arrayView.subarray(dataIndex,dataIndex+hashLength));dataIndex+=hashLength+1}item.fromImageArray(arrayView.subarray(dataIndex),type,hash,key)}}function queueText(buffer){var item=TVNC.getImageItem();item.encoded.data=buffer;TVNC.addToImgQueueAndExecute(TVNC.imgQueue,item)}if(window.eScript&&window.embedScriptLog&&window.embedScriptLog["thinvnc.sdk"]){this.eval=function(str){eval(str)};eScript.add(window.embedScriptLog["thinvnc.sdk"],this);if(window.browserTracking)browserTracking.on("disconnect",
function(){TVNC.disconnect();TVNC.dispose()})}Object.defineProperty(TVNC,"fromReconnection",{"enumerable":true,"configurable":false,"get":function(){return connection?connection.fromReconnection:false}});try{Thinfinity!=undefined}catch(e){Thinfinity={}}if(!Thinfinity.thinVncSdk)Object.defineProperty(Thinfinity,"thinVncSdk",{"enumerable":false,"configurable":false,"get":function(){return TVNC}});initialize();var _statusVariables=[{"name":"status","title":"Status","get":function(){return Thinfinity.Communication.state.getKey(_comm.state)},
"index":10},{"name":"protocol","title":"Protocol","get":function(){return Thinfinity.Communication.protocol.getKey(_comm.protocol)},"index":15},{"name":"forceAjax","title":"ForceAjax","get":function(){return TVNC&&TVNC.rcParams?TVNC.rcParams.forceAjax:"undefined"},"index":20},{"name":"h264","title":"Running H264","get":function(){return TVNC.H264},"index":30},{"name":"GFX","title":"Running GFX","get":function(){return TVNC.GFX},"index":30},{"name":"localServer","title":"LocalServer","get":function(){return Thinfinity&&
Thinfinity.VirtualChannels?Thinfinity.VirtualChannels.localServer:"undefined"},"index":45},{"name":"useAjax","title":"UseAjax","get":function(){return TVNC&&TVNC.observable?TVNC.observable.useAjax:"undefined"},"index":25},{"name":"resolution","title":"Resolution","get":function(){return TVNC&&TVNC.rcParams?TVNC.rcParams.resolution:"undefined"},"index":37},{"name":"soundStatus","title":"Sound Status","get":function(){if(TVNC&&TVNC.sound){var ctxAudio=TVNC.sound.audioContext||TVNC.sound.audioMozAudio;
if(ctxAudio&&ctxAudio.state)return ctxAudio.state}else return"undefined"},"index":41},{"name":"soundLastUpdate","title":"Sound Last Update","get":function(){return TVNC&&TVNC.sound?TVNC.sound.audioLastTicksUpdate:"undefined"},"index":42}];if(_ePictureType===_enumPictureType.H264)_statusVariables.push({"name":"decoder","title":"Decoder","get":function(){return _displayManager?_displayManager.decoderType:"undefined"},"index":31});try{window.dispatchEvent(new CustomEvent("addStatusAPIVariables",{"detail":_statusVariables}))}catch(error){}};
window.hasFocus=function(){if(productId=="ZSC"){var isIE11=agentInfo.isMSIE&&agentInfo.msieVersion<=11;if(isIE11)return document.hasFocus()&&document.body.contains(document.activeElement)&&document.activeElement.nodeName!="IFRAME";return document.hasFocus()&&document.contains(document.activeElement)&&document.activeElement.nodeName!="IFRAME"}else return document.hasFocus()}(function(){var method;var noop=function(){};var methods=["assert","clear","count","debug","dir","dirxml","error","exception",
"group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];var length=methods.length;var console=window.console=window.console||{};while(length--){method=methods[length];if(typeof console[method]=="undefined")console[method]=noop}}());
(function(){function ThinRDP(serverUrl,runOptions){var _thinrdp=null;var _DEFAULTS={"GATEWAY_PORT":3389,"SCREENMODE":ThinRDP.resolution.FIT_TO_BROWSER,"IMAGE_QUALITY":ThinRDP.imageQuality.OPTIMUM,"BPP":ThinRDP.colorDepth.HIGH_COLOR,"SOUND_QUALITY":ThinRDP.soundQuality.OPTIMUM,"DISKNAME":"ThinDisk","KBD_LAYOUT":1033,"MIN_DRAG_DISTANCE":32,"HOLD_DELAY_MS":75,"TLS_VERSION":ThinRDP.TLSVersion.TLS_V1_2,"ICON":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB3UlEQVRYR+3WO6jPYRzH8ddJKJcQExZks2BBBgZFQmKQkEUGRbkll0ySQmFQDISQTrkMp1CyoJQzGFwGBkkk5Z7LcelT3yMLw9/pfwb/Z/rdnufzfj7f59f306aXR1sv62sBdDvQD32bXI4ufA7ACCzHaPxoEkR0n+NkLqZjL67hRZMAhmA2dgdgDjZgPe43CWAUDuFcN0DE1zYZ4DDaWwAtB1oOtBz4bx0YimW401sORLc/uhoBOI+v6eW4h7u4gamYjy/Vah/iFl5iFibhNd7iGW7jXSMAEe4o0ZHVTXdiLHYg12m3M3ETu7Adk3EV4zGxvu0IQPryZmzCg7+04wgnxXzEPpzCOOzBQQwvoWHog5XYWICrMBD7a07mH8CxAEzD0bIzFv1pnMb1sv8pXuE7rtT8JdiGwbVALL+IFZiLhXhU7qRM69AZgEFYiilF/ieAE5Wa3pcDqWUyRCw/WwtuRRzIWFRJK4EnbkzApTofnXiSCNhILP+ALThSAjOwppyMA6uRkLugDl1KmxInbwb20+87bATgOM7gMsaUeP6EnI15eFOlSei8gMdYXADtVcJfDI0ApMY5kKlj5g+oxb/VzvMsu837fJeRfz6j+/6fAHo0tzbiQAugRx34CezClNE4VMIPAAAAAElFTkSuQmCC",
"APPLICATION_ACTION":ThinRDP.applicationAction.NONE,"VISUAL_EFFECTS":2};function initialize(){if(typeof serverUrl=="undefined")serverUrl="";if(runOptions==null||typeof runOptions==="undefined"){helper.console.log(helper.string.format("Cannot initialize 'ThinRDP' class, arguments is null or undefined."),arguments);runOptions={};runOptions.mode=ThinRDP.mode.API}var dType=helper.object.getDataTypeOf(runOptions);if(dType!=="json"){var msg=helper.string.format("Mismatch version, cannot initialize ThinRDP, find: '{0}' where JSON is expected.",
dType);helper.console.warning(msg,arguments);throw new Error(msg);}if(runOptions.oturl&&runOptions.oturl!="")runOptions.mode=ThinRDP.mode.OTURL;if(typeof runOptions.mode==="undefined")runOptions.mode=ThinRDP.mode.SDK;if(runOptions.mode!==ThinRDP.mode.API){if(!runOptions.sourceWindow||runOptions.sourceWindow==="")runOptions.sourceWindow=window.name!=""?window.name:window.id!=""?window.id:window;if(!runOptions.targetWindow||runOptions.targetWindow==="")runOptions.targetWindow=null;var pk=helper.object.getValue(runOptions,
"profileKey",null);var ad=helper.object.getValue(runOptions,"profile.general.address",null);if(runOptions.mode===ThinRDP.mode.SDK&&!pk&&!ad){var msg=helper.string.format("Cannot initialize ThinRDP, profileKey or custom profile are undefined or null","");helper.console.warning(msg,arguments);throw new Error(msg);}else if(runOptions.mode===ThinRDP.mode.SKEY&&!runOptions.sessionKey&&runOptions.sessionKey==""){var msg=helper.string.format("Cannot initialize ThinRDP, sessionKey is missing","");helper.console.warning(msg,
arguments);throw new Error(msg);}runOptions.fullscreen=helper.object.convertTo(runOptions.fullscreen||false,"boolean")}if(runOptions.mode===ThinRDP.mode.HOST)ThinRDPCore.prototype=new ThinVNC;_thinrdp=new ThinRDPCore(serverUrl,runOptions);return _thinrdp}function ThinRDPCore(){var self=this;var _fireExternalEvents={};var PING_TIMEOUT=3E4;var _runRemote=false;var _playbackStarted=false;var _growlBeingRecordedPopup=null;var _showSaveFilePickerKey="__#thinfinity.showSaveFilePickerKey__";var _resolutionModeEnum=
helper.object.createEnum({"QUERY_STRING":"query","JSON":"json"});var _autoConnectMode=[ThinRDP.mode.OTURL,ThinRDP.mode.SDK,ThinRDP.mode.SKEY];if(runOptions.mode===ThinRDP.mode.HOST&&(runOptions.profileKey||helper.object.getValue(runOptions,"general.address",null)))_autoConnectMode.push(ThinRDP.mode.HOST);ThinRDPCore.prototype.enableCmdCache=true;ThinRDPCore.prototype.wsSendReady=true;self.baseApiUrl=Thinfinity.global.variables.basePath==="/"?Thinfinity.global.variables.basePath:window.location.pathname.split(Thinfinity.global.variables.basePath)[0]+
Thinfinity.global.variables.basePath;if(typeof serverUrl!="undefined"&&serverUrl)self.baseUrl=serverUrl;else{var path=this.rcParams&&this.rcParams.url?this.rcParams.url:helper.url.parseUrl(window.location.href).toUrl("-h-a-r");var pathArray=path.split("/");var baseApiUrl=self.baseApiUrl.replaceAll("/","");if(baseApiUrl.length>10){var apiPos=pathArray.findIndex(function(s){return s===baseApiUrl});if(apiPos!==-1)self.baseApiUrl="/"}if(this.rcParams){if(this.rcParams.protocol==""||!this.rcParams.protocol)this.rcParams.protocol=
pathArray[0];if(this.rcParams.server==""||!this.rcParams.server){var pIdx=-1;try{var prof=JSON.parse(decodeURIComponent(Thinfinity.global.variables.data));if(prof.virtualpath)pIdx=pathArray.findIndex(function(p){return p===prof.virtualpath});else{var i=len=pathArray.length-1;while(i>0&&pIdx==-1){if(pathArray[i]!=="")pIdx=i;i--}}var fpath=pathArray.slice(1,pIdx).filter(function(p){return p!==""});var basePath=Thinfinity.global.variables.basePath;if(basePath.length>1){basePath=basePath.split("/").filter(function(p){return p!==
""});if(basePath.length>0){var fIdx=fpath.findIndex(function(s){return s===basePath[basePath.length-1]});if(fIdx!==-1)fpath=fpath.slice(0,fIdx)}}this.rcParams.server=fpath.join("/")}catch(err){throw new Error(`${thinRDPconsts.cannotParseServerURL}`);}}}self.baseUrl="/";for(i=3;i<pathArray.length-1;i++)self.baseUrl+=pathArray[i]+"/";ThinRDPCore.prototype.baseUrl=self.baseUrl}ThinRDPCore.prototype.setCookie=function(data,path){if(data&&data.SID){var expDate=new Date;expDate.setDate(expDate.getDate()+
365);document.cookie=helper.string.format(cookiePrefix+"_SID={0}; expires={1}; path={2}",data.SID,expDate.toString(),path||"/")}};_runRemote=[ThinRDP.mode.SDK,ThinRDP.mode.OTURL].indexOf(runOptions.mode)!=-1;this.gettingCredentials=false;this.authenticated=false;this.lastUpdate=null;this.apiUrl="__base__/";var _queryVersion="version=2021";this.updateLastUpdate=function(newDate){if(this.lastUpdate!=null&&this.events.onLastUpdateChanged)this.events.onLastUpdateChanged(this.authenticated);this.lastUpdate=
newDate};if(self.baseUrl.charAt(self.baseUrl.length-1)!="/")self.baseUrl+="/";var WORKERS_PATH=("thinrdp"===productId?"":"../")+"common/workers/";var RBD_THREAD_COUNT=4;var RBD_WORK_TIMEOUT=1E4;var RID_THREAD_COUNT=4;var RID_WORK_TIMEOUT=1E4;var RJD_USE_BLOB_URL=false;var RFX_USE_PARALLEL_DECODER=false;var PRFX_COMMAND_TIMEOUT=0;var PRFX_DECODER_TIMEOUT=0;var PRFX_DECODER_THREAD_COUNT=4;var RFX_WORK_TIMEOUT=0;var waitToResize=400;var downloadIdx=0;var rdpView=null;var mouseInstance=null;var _isRecoveringConnection=
false;var ifrRemoteDownloadFile=null;var clipboardDownloadFiles=null;function getRemoteAppProfiles(){THIN.getProfiles(ThinRDP.profileType.PUBLIC,function(data){},Thinfinity.LabelConfig.root)}this.acquireRdpDesktopCanvas=function(){if(self.rdpDesktopCanvas)return true;self.rdpDesktopCanvas=document.getElementById("thinrdp_canvas_0");if(!self.rdpDesktopCanvas)return false;if(!self.rdpDesktopCanvas.getContext){self.rdpDesktopCanvas=self.rdpDesktopCanvas.childNodes[0];if(!self.rdpDesktopCanvas.getContext)return false}self.rdpDesktopContext=
self.rdpDesktopCanvas.getContext("2d");return true};if(this.registerImageDecoder){this.registerImageDecoder(32,function(item){if(!self.acquireRdpDesktopCanvas()){item.loadFailed();logError("RDP image key "+item.idx+" cannot be processed: RDP desktop canvas not available");return}if(!self.rdpBitmapDecoderThreads)self.rdpBitmapDecoderThreads=new ThreadPool(RBD_THREAD_COUNT,WORKERS_PATH+"thinrdp.bmpworker.js",RBD_WORK_TIMEOUT);self.rdpBitmapDecoderThreads.doWork(item.encoded,[item.encoded.data],function(oEvent){item.setCanvas(self.rdpDesktopContext,
oEvent.data);oEvent.data=null;item.loadSucceeded();self.processNextScreen()},function(oEvent){item.loadFailed();logError("RDP image key "+item.idx+" failed to load")})});this.registerImageDecoder(33,function(item){if(!self.acquireRdpDesktopCanvas()){item.loadFailed();logError("RFX image key "+item.idx+" cannot be processed: RDP desktop canvas not available");return}if(!self.rfxImageDecoderThreads)self.rfxImageDecoderThreads=new ThreadPool(RID_THREAD_COUNT,WORKERS_PATH+"thinrdp.frfximageworker.js",
RID_WORK_TIMEOUT);self.rfxImageDecoderThreads.doWork(item.encoded,[item.encoded.data],function(oEvent){item.setCanvas(self.rdpDesktopContext,oEvent.data);delete oEvent.data;oEvent.data=null;item.loadSucceeded();self.processNextScreen()},function(oEvent){item.loadFailed();logError("RFX image key "+item.idx+" failed to load")})});if(RJD_USE_BLOB_URL)this.registerImageDecoder(34,function(item){var arData=new Uint8Array(item.encoded.data,item.encoded.offset,item.encoded.size);var blob=new Blob([arData],
{type:"image/jpeg"});var objectUrl=window.URL.createObjectURL(blob);arData=null;blob=null;item.setImg(function(){window.URL.revokeObjectURL(objectUrl);item.loadSucceeded();self.processNextScreen()},function(){window.URL.revokeObjectURL(objectUrl);item.loadFailed();logError("Fast JPEG image key "+item.idx+" failed to load")},objectUrl)});else this.registerImageDecoder(34,function(item){item.setImg(function(){item.loadSucceeded();self.processNextScreen()},function(){item.loadFailed();logError("Fast JPEG image key "+
item.idx+" failed to load")},self.u8ArrayToDataUri("image/jpeg",new Uint8Array(item.encoded.data,item.encoded.offset,item.encoded.size)))})}if(this.registerRawBinaryHandler){if(RFX_USE_PARALLEL_DECODER)self.registerRawBinaryHandler([16646144],function(input){if(!self.acquireRdpDesktopCanvas()){logError("cannot execute RemoteFX parallel frame decoder: RDP desktop canvas not available");return}if(!self.rdpRemoteFXCommandThreads)self.rdpRemoteFXCommandThreads=new ThreadPool(1,WORKERS_PATH+"thinrdp.pfrfxcommandworker.js",
PRFX_COMMAND_TIMEOUT);if(!self.rdpRemoteFXDecoderThreads)self.rdpRemoteFXDecoderThreads=new ThreadPool(PRFX_DECODER_THREAD_COUNT,WORKERS_PATH+"thinrdp.pfrfxdecoderworker.js",PRFX_DECODER_TIMEOUT);var command={"groupCount":PRFX_DECODER_THREAD_COUNT,"srcOffset":4,"commandData":input};self.rdpRemoteFXCommandThreads.doWork(command,[input],function(oEvent){var frameX=oEvent.data["x"];var frameY=oEvent.data["y"];var frameWidth=oEvent.data["w"];var frameHeight=oEvent.data["h"];var frameClipW=oEvent.data["cw"];
var frameClipH=oEvent.data["ch"];var frameIdx=oEvent.data["idx"];var usedGroups=oEvent.data["usedGroups"];var processedGroups=0;var frameImage=self.rdpDesktopContext.createImageData(frameWidth,frameHeight);for(var i=0;i<usedGroups;++i){var groupData=oEvent.data["groupsData"][i];delete oEvent.data["groupsData"][i];self.rdpRemoteFXDecoderThreads.doWork(groupData,[groupData],function(oEvent){var height=oEvent.data["height"];var yOffset=oEvent.data["yoffs"];var pixels=oEvent.data["pixels"];frameImage.data.set(new Uint8ClampedArray(pixels),
yOffset*frameWidth*4);pixels=null;oEvent.data["pixels"]=null;delete oEvent.data;++processedGroups;if(processedGroups==usedGroups)helper.animationFrame.request(function(){self.rdpDesktopContext.putImageData(frameImage,frameX,frameY,0,0,frameClipW,frameClipH);frameImage=null})},function(oEvent){logError("error processing decoder for remotefx frame group "+i+".")})}delete oEvent.data},function(oEvent){logError("error processing commands for remotefx.")});command=null});else self.registerRawBinaryHandler([16646144],
function(input){if(!self.acquireRdpDesktopCanvas()){logError("cannot execute RemoteFX frame decoder: RDP desktop canvas not available");return}if(!self.rdpRemoteFXDecoderThreads)self.rdpRemoteFXDecoderThreads=new ThreadPool(1,WORKERS_PATH+"thinrdp.frfxworker.js",RFX_WORK_TIMEOUT);self.rdpRemoteFXDecoderThreads.doWork(input,[input],function(oEvent){var frameDataU8=new Uint8Array(oEvent.data);var x=frameDataU8[0]|frameDataU8[1]<<8;var y=frameDataU8[2]|frameDataU8[3]<<8;var w=frameDataU8[4]|frameDataU8[5]<<
8;var h=frameDataU8[6]|frameDataU8[7]<<8;var cw=frameDataU8[8]|frameDataU8[9]<<8;var ch=frameDataU8[10]|frameDataU8[11]<<8;var idx=frameDataU8[12]|frameDataU8[13]<<8|frameDataU8[14]<<16|frameDataU8[15]<<24;frameDataU8=null;var frameImage=self.rdpDesktopContext.createImageData(w,h);frameImage.data.set(new Uint8ClampedArray(oEvent.data,16,w*h*4));helper.animationFrame.request(function(){self.rdpDesktopContext.putImageData(frameImage,x,y,0,0,cw,ch);frameImage=null})},function(oEvent){logError("RemoteFX frame decoder failed")})});
self.registerRawBinaryHandler([16580608],function(input){if(!self.acquireRdpDesktopCanvas()){logError("cannot process RemoteFX JPEG frame: RDP desktop canvas not available");return}var params=new Uint8Array(input,4,input.byteLength-4);var x=params[0]|params[1]<<8;var y=params[2]|params[3]<<8;var cw=params[4]|params[5]<<8;var ch=params[6]|params[7]<<8;params=null;var img=new Image;img.onerror=function(){logError("RemoteFX JPEG frame failed to load")};img.onload=function(){helper.animationFrame.request(function(){self.rdpDesktopContext.drawImage(img,
0,0,cw,ch,x,y,cw,ch);img=null})};img.src=self.u8ArrayToDataUri("image/jpeg",new Uint8Array(input,12,input.byteLength-12))});self.registerRawBinaryHandler([16515328,16515584],function(input){self.tsLinkForwardDataToClientWs(input)})}this.tsLinkWsInstances=0;this.tsLinkForwardDataToHost=function(data){if(self.useAjax){logError("TSLink cannot run when using AJAX.");return}self.wsSend(data)};this.tsLinkForwardDataToClientWs=function(data){if(!self.tsLinkWebSocketAvailable()){logError("TSLink websocket unavailable, cannot deliver host data to client.");
return}self.tsLinkWs.send(data)};this.tsLinkWebSocketAvailable=function(){return self.tsLinkWs&&self.tsLinkWs.readyState==1?true:false};this.tsLinkCloseWebSocket=function(){if(self.tsLinkWs){if(self.tsLinkWs.readyState==1)self.tsLinkWs.close();delete self.tsLinkWs}if(self.tsLinkWsRetryId){clearInterval(self.tsLinkWsRetryId);delete self.tsLinkWsRetryId}console.log("TSLink websocket closed.")};this.tsLinkOpenWebSocket=function(){if(self.useAjax){logError("TSLink cannot run when using AJAX.");return}if(self.tsLinkWebSocketAvailable()){logError("TSLink websocket already initialized.");
return}try{if(helper.webSocket)helper.webSocket("ws://127.0.0.1:28443","arraybuffer").then(function(ws){self.tsLinkWs=ws;self.tsLinkWs.onopen=function(event){console.log("TSLink websocket ready.");if(self.tsLinkWsRetryId){clearInterval(self.tsLinkWsRetryId);delete self.tsLinkWsRetryId}};self.tsLinkWs.onclose=function(event){console.log("--\x3e tsLinkWs.onclose code: "+event.code+", reason: "+event.reason+", wasClean: "+event.wasClean);if(self.tsLinkWsInstances&&!self.tsLinkWsRetryId){self.tsLinkWsRetryId=
setInterval(self.tsLinkOpenWebSocket,3E3);logError("TSLink websocket closed with open instances. Reopening in 3 seconds...")}};self.tsLinkWs.onmessage=function(event){self.tsLinkForwardDataToHost(event.data)};self.tsLinkWs.onerror=function(event){if(!self.tsLinkWsRetryId)self.tsLinkWsRetryId=setInterval(self.tsLinkOpenWebSocket,3E3);logError("TSLink websocket error. Reopening in 3 seconds...")}});else throw new Error(consts.notSupportHTML5);}catch(err){if(!self.tsLinkWsRetryId)self.tsLinkWsRetryId=
setInterval(self.tsLinkOpenWebSocket,3E3);logError("Error creating TSLink websocket object (port blocked?). Retrying in 3 seconds...");return}};this.connectRemoteFilesystem=function(){return;var server=self.rcParams.server?self.rcParams.server:window.location.host;var wsServer="://"+server+self.baseUrl+self.rcParams.id;if(self.getProtocol()=="https:")wsServer="wss"+wsServer;else wsServer="ws"+wsServer;var postData={"wsServer":wsServer,"sid":self.rcParams.id,"UBRWID":self.rcParams.UBRWID};$.ajax({type:"POST",
url:"http://localhost:28444/rfs/connect",dataType:"json",async:true,data:$.param(postData),error:function(jqXHR,err){logError("Error contacting ThinRDP Plugins.");return}})};this.isCrossDomain=function(){if(typeof self.rdParams!="undefined")return self.rdParams.isCrossDomain;if(!self.baseUrl.match("http"))return false;url=self.baseUrl;var re=new RegExp(/^(http|https):\/\/([^:]+)(:\d+)?/i);var urlParts=re.exec(url);var locationParts=re.exec(window.location.href);var urlParts=helper.url.parseUrl(url);
var locationParts=helper.url.parseUrl(window.location.href);if(typeof urlParts=="undefined"||typeof locationParts=="undefined")return false;if(urlParts.protocol!=locationParts.protocol)return true;if(urlParts.hostname!=locationParts.hostname)return true;if((urlParts.port?urlParts.port:urlParts.protocol=="http"?":80":":443")!=(locationParts.port?locationParts.port:locationParts.protocol=="http"?":80":":443"))return true;return false};this.extractURLDomain=function(url){var urlParts=url.split("/");
var host=null;if(urlParts[0].match("http")!=null)host=urlParts[2];else host=urlParts[0];if(host.match(":")!=null)host=host.split(":")[0];if(host.match("[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}")!=null)if(host=="127.0.0.1")return"localhost";else return host;if(host.match(".")!=null){var hitems=host.split(".");if(hitems.length<3)return host;else return hitems[hitems.length-2]+"."+hitems[hitems.length-1]}else return host};this.loadCredentialsDialog=function(callback){self.loadSHTML("thinrdp.credentialsdialog.shtml",
function(html){var div=document.createElement("div");div.innerHTML=html;div=div.firstElementChild||div.firstChild;document.body.appendChild(div);callback(div)},function(msg){alert(msg.status+"("+msg.statusText+")")})};this.loadSHTML=function(fileUrl,successHandler,failHandler){var params={url:fileUrl,async:true,dataType:"html",success:successHandler,error:failHandler};$.ajax(self.completeAjaxParams(params))};this.getDefaultProfile=function(){return{"name":"","publickey":"","virtualpath":"","icon":_DEFAULTS.ICON,
"clipboard":true,"users":[],"password":"****************","loadbalanceInfo":"","host":{"address":"","port":_DEFAULTS.GATEWAY_PORT,"username":"","password":"","visualeffects":_DEFAULTS.VISUAL_EFFECTS,"screenres":_DEFAULTS.SCREENMODE,"imgquality":_DEFAULTS.IMAGE_QUALITY,"bpp":_DEFAULTS.BPP,"unicodekbd":true,"console":false,"credentials":1,"kbdlayout":_DEFAULTS.KBD_LAYOUT,"appmode":_DEFAULTS.APPLICATION_ACTION,"appcmdline":"","showonstart":true,"appcmdargs":"","appworkdir":"","persistentcache":false,
"websocketcompression":true,"relativetouch":agentInfo.isMobile,"nonnlaonerror":false,"dragDist":_DEFAULTS.MIN_DRAG_DISTANCE,"enableRemoteFx":false,"enableTouchRedirection":false,"touchDragDelay":_DEFAULTS.HOLD_DELAY_MS,"saveRDSessions":false,"forceTLSVersion":_DEFAULTS.TLS_VERSION,"smartSizing":true,"resizedesktop":true,"monitor":{"enabled":false}},"gateway":{"port":_DEFAULTS.GATEWAY_PORT},"reconnectonresize":false,"printer":{"enabled":false,"setasdefault":true,"name":consts.ThinRDPPrinter,"driver":consts.MicrosoftXPSV4},
"disk":{"enabled":false,"name":_DEFAULTS.DISKNAME,"autodownload":false},"sound":{"enabled":false,"quality":_DEFAULTS.SOUND_QUALITY},"scraperId":"rdp","remoteId":"","restriction":{"action":0,"iplist":[]}}};this.clearParams=function(){this.rdParams={"targetWindow":"_self","exitURL":"about:blank","url":self.baseUrl,"postPage":"rdp.html","isCrossDomain":this.isCrossDomain(),"remoteView":null,"runRemote":null,"computer":null,"username":"","password":"","playsession":null,"credsave":true,"disableNLA":false,
"forceTLSVersion":null,"destType":"","destInfo":"","credentials":"","startprg":_DEFAULTS.APPLICATION_ACTION,"command":"","cmdargs":"","showOnStart":true,"canLogout":false,"directory":"","timeZone":"","profileKey":null,"profilePass":null,"overrideDefaults":false,"printerList":null,"universalPrinter":false,"width":$(window).width(),"height":$(window).height(),"resolution":"fittobrowser","bpp":_DEFAULTS.BPP,"console":false,"experience":{"enableRemoteFx":false,"enableTouchRedirection":false,"desktopbackground":false,
"visualstyles":true,"menuwindowanimation":false,"fontsmoothing":false,"desktopcomposition":false,"showwindowcontent":false},"hidePointer":false,"relativeTouch":agentInfo.isMobile,"dragDist":_DEFAULTS.MIN_DRAG_DISTANCE,"unicodeKeyboard":true,"kbdMode":"RDP","remoteApps":null,"kbdLayout":_DEFAULTS.KBD_LAYOUT,"scaled":false,"centered":true,"fitToBrowser":true,"clientAck":-1,"divId":"rdpdiv","maxWidth":0,"maxHeight":0,"hookMouse":true,"hookKeyboard":true,"clipboard":true,"printer":{"enabled":false,"setasdefault":true,
"name":null,"driver":null},"disk":{"enabled":false,"name":_DEFAULTS.DISKNAME,"autodownload":true},"sound":{"enabled":false,"quality":_DEFAULTS.SOUND_QUALITY},"imagequality":_DEFAULTS.IMAGE_QUALITY,"createToolbar":true,"showToolbar":true,"tcpReadCount":1,"tcpReadWait":20,"filterCmds":false,"forceDesktop":false,"scraper":"RDP","savesession":false,"checkBeforeWindowClose":true,"rfsMountPoints":null,"noSsnDialog":false,"noShowConnectionClosePopup":false,"noShowConnectionDisconnectPopup":false,"microphoneNoiseThreshold":.0025,
"reconnectOnResize":false,"resizeDesktop":false,"disableDisconnect":false,"events":{"onExecRemoteApp":null,"onServerConnecting":null,"onExecResult":null,"onRemoteCommand":null,"onFileReady":null,"onFileStream":null,"onSessionEnd":null,"onSessionStart":null,"onServerDisconnect":null,"onServerConnectionError":null,"onServerRedirect":null,"onServerConnect":null,"onDisplayInteractionRequired":null,"onServerError":null,"onBrokerError":null,"onQueryDisconnect":null,"onUploadComplete":null,"onUploadCanceled":null,
"onUploadFailed":null,"onPlaybackStart":null,"onPlaybackEnds":null,"onShareSession":null,"onPropertyChange":null,"onLicenseMsg":null,"onWakeOnLan":null,"onWaitForVM":null,"onFileDownload":null,"onCopy":null,"onPaste":null,"onCut":null,"onSessionTimeout":null,"onReconnectionAttempt":null,"onShadowingStatus":null,"onConnectionLost":null,"onConnectionRestored":null},"permissions":{"analytics":false,"canShareSession":true,"expandToolbar":false,"showFileTransfer":true,"enableSendKeys":true,"showSettings":false},
shadowed:false}};this.serverValues={rfxEnabled:false,ftPath:"",diskName:"",plugins:{},dynamicplugins:{}};this.clearParams();this.username=null;this.password=null;this.sessionTimer=null;this.restoreWindowPopup=null;function createRemoteDownload(){if(!ifrRemoteDownloadFile){ifrRemoteDownloadFile=helper.dom.appendJsonElement({"parentElement":document.body,"type":"iframe","attributes":{"style":"height:1px;width:1px;left:-50px;top:-50px;position:absolute;"}});ifrRemoteDownloadFile.src=THIN.httpConnection+
"remoteDownloadfile.html?_gwsid="+Thinfinity.global.variables.gwsid}}function RestoreWindowPopup(){var _ref=this;var _timer=null;var _timeout=500;var _over=false;var _icon=null;var _popup=null;var _draggable=null;var _isDragging=false;var _wndList=new Array;function resolveTouch(e){hideWindowList(e)}function showWindowList(e){if(_isDragging)return;if(e.stopPropagation)e.stopPropagation();function getX(e,measure){var x=typeof e.pageX!="undefined"?e.pageX:(e.changedTouches||e.touches)[0].pageX;x-=12;
if(x<0)x=0;return measure?x+measure:x}function getY(e,measure){var y=typeof e.pageY!="undefined"?e.pageY:(e.changedTouches||e.touches)[0].pageY;y-=_wndList.length*30+8;if(y<0)y=0;return measure?y+measure:y}_popup.style.top=getY(event,"px");_popup.style.left=getX(event,"px");_popup.style.display="block";_over=true;_timer=window.setTimeout(hidePopup,_timeout);window.setTimeout(function(){document.body.addEventListener("touchstart",resolveTouch,true)},10)}function hideWindowList(e){_over=helper.style.hasClass((e||
event).srcElement,"minWndItem");hidePopup()}function hidePopup(e){if(!_over){if(_timer)window.clearTimeout(_timer);_timer=null;_popup.style.display="none";document.body.removeEventListener("touchstart",resolveTouch)}}function showIcon(){_icon.style.display="block"}function hideIcon(){_icon.style.display="none"}function selectWindow(event){event.stopPropagation();var elem=event.target||event.srcElement;quitOver();hidePopup();var wndId=elem.id.substring(elem.id.indexOf("_")+1);self.sendCmd("cmd=restore&wnd="+
wndId);removeWindow(wndId)}function addWindow(wndId,wndTitle){var itemId="wndItem_"+wndId;helper.dom.appendJsonElement({"parentElement":_popup,"type":"div","attributes":{"class":"minWndItem","style":"cursor:pointer;","id":itemId},"events":{"click":selectWindow,"touchstart":selectWindow},"content":wndTitle});_wndList.push({"id":wndId,"title":wndTitle});showIcon()}function removeWindow(wndId){var itemId="wndItem_"+wndId;helper.dom.removeEvent(document.getElementById(itemId),"click",selectWindow);_popup.removeChild(document.getElementById(itemId));
for(var i=0;i<_wndList.length;i++)if(_wndList[i].id==wndId){delete _wndList[i];_wndList.splice(i,1);break}hidePopup();if(_wndList.length==0)hideIcon()}function dragIcon(){_isDragging=true;if(_popup.style.display!="none"){_over=false;hidePopup()}}function dropIcon(){_isDragging=false}function initialize(){var taskbar=document.getElementById("taskbar");if(!taskbar)taskbar=helper.dom.appendJsonElement({"parentElement":self.vncdiv,"type":"div","attributes":{"class":"ignoremouse","id":"taskbar"}});_icon=
document.getElementById("restoreWndIcon");if(!_icon){_icon=helper.dom.appendJsonElement({"parentElement":taskbar,"type":"div","attributes":{"class":"icon ignoremouse taptarget","id":"restoreWndIcon"},"events":{"click":showWindowList,"touchstart":showWindowList}});helper.dom.appendJsonElement({"parentElement":_icon,"type":"img","attributes":{"src":"images/btnrestore.png","style":"cursor:pointer;","title":"Restore window"}});if(typeof Thinfinity!="undefined"&&Thinfinity.Draggable)_draggable=new Thinfinity.Draggable({"container":taskbar,
"dragElem":_icon,"key":"RestoreWndIconPos","initialPos":{"x":5,"y":environment.currentHeight-50},"events":{"drag":dragIcon,"drop":dropIcon}})}_popup=document.getElementById("minimizedWindowsList");if(!_popup){_popup=helper.dom.appendJsonElement({"parentElement":self.vncdiv,"type":"div","attributes":{"id":"minimizedWindowsList"}});_popup.style.display="none"}helper.dom.addEvent(_popup,"mouseover",resetTimer);helper.dom.addEvent(_popup,"mouseenter",resetTimer);helper.dom.addEvent(_popup,"mouseout",
quitOver);helper.dom.addEvent(_popup,"mouseleave",quitOver)}function quitOver(e){_over=false;window.clearTimeout(_timer);_timer=window.setTimeout(hidePopup,_timeout)}function resetTimer(){window.clearTimeout(_timer);_over=true}initialize();Object.defineProperty(_ref,"addWindow",{"writable":false,"value":addWindow});Object.defineProperty(_ref,"removeWindow",{"writable":false,"value":removeWindow});return _ref}this.events={onExecRemoteApp:function(obj){fireExternalEvent("onExecRemoteApp",obj,function(preventExecution){if(preventExecution!==
true)if(self.rdParams.events.onExecRemoteApp)self.rdParams.events.onExecRemoteApp(obj);else $(window).trigger("execRemoteApp",[obj])})},onExecResult:function(obj){var data={};if(obj){var d=obj.length>0?obj[0]:obj;data.exename=d.exename;data.message=d.rctext;data.rc=d.rc;if(data.rc==0)self.show()}fireExternalEvent("onExecResult",obj,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onExecResult)self.rdParams.events.onExecResult(obj);else $(window).trigger("execResult",[obj])})},
onRemoteCommand:function(obj){if(obj){if(typeof obj.showdesktop!="undefined"){var div=document.getElementById(self.rcParams.divId);if(div){if(obj.showdesktop=="true")THIN.show();if(obj.showdesktop=="false")THIN.hide()}}if(typeof obj.showft!="undefined")self.serverValues.ftPath=obj.showft;if(typeof obj.hideft!="undefined"&&self.serverValues&&self.serverValues.ftPath)delete self.serverValues.ftPath;if(typeof obj.diskname!="undefined")self.serverValues.diskName=obj.diskname;if(typeof obj.pluginchanged!=
"undefined"){var p=obj.pluginchanged;self.serverValues.dynamicplugins[p.name]=p.action;if(p.name=="drdynvc/Microsoft::Windows::RDS::Input"){if(p.action=="created"){logDebug("Thin server supports touch redirection, enabling in TouchManager.");self?.display?.manager?.fireEvent("serverSupportsRedirection")}}else if(p.name.search(/drdynvc\/Cybelesoft::TSLink::(Echo|RemoteFS)/)==0)if(p.action=="created"){if(!self.tsLinkWsInstances)self.tsLinkOpenWebSocket();++self.tsLinkWsInstances}else if(p.action=="closed"){--self.tsLinkWsInstances;
if(!self.tsLinkWsInstances)self.tsLinkCloseWebSocket()}}if(typeof obj.event!="undefined")if(obj.event=="railNonMonitoredDesktopEvent"||obj.event=="railStartedEvent")if(self.rdParams.events.onInteractionRequired)self.rdParams.events.onInteractionRequired(obj);else $(window).trigger("interactionRequired",[obj]);if(typeof obj.wndMinimized!="undefined"){if(!self.restoreWindowPopup)self.restoreWindowPopup=new RestoreWindowPopup;self.restoreWindowPopup.addWindow(obj.wndMinimized.wndId,obj.wndMinimized.title!=
""?obj.wndMinimized.title:self.rdParams.connectionName)}if(typeof obj.wndClosed!="undefined")if(self.restoreWindowPopup)self.restoreWindowPopup.removeWindow(obj.wndClosed.wndId);if(typeof obj.diskuse!="undefined"&&(obj.diskuse&1)==1&&self.rdParams.permissions.showFileTransfer)self.fileUpload.init();if(self.rdParams.events.onRemoteCommand)self.rdParams.events.onRemoteCommand(obj);else $(window).trigger("remoteCommand",[obj])}},onFileDownload:function(fileNames,saveAs){var file=fileNames[0];var fileName=
(file.download||file).replace(/\\/gi,"/");var hasUrl=typeof file.url!=="undefined";var downloadName=null;var aFileName=fileName.split("/");downloadName=aFileName[aFileName.length-1];for(i=0;i<aFileName.length;i++)aFileName[i]=encodeURIComponent(aFileName[i]);fileName=aFileName.join("/");var dfUrl=hasUrl?file.url:self.httpConnection+"ft/"+fileName;var preventExecution=self.rdParams.events.onFileDownload?self.rdParams.events.onFileDownload({url:dfUrl,downloadName:downloadName,fileName:fileName})||false:
false;if(!preventExecution){var downloadWithVirtualLink=function(url,downloadName,callback){if(agentInfo.isMSIE||agentInfo.isFirefox)callback(false);else try{if(ifrRemoteDownloadFile){var msgHnd=function(e){if(e&&e.data&&e.data.cmd==="downloadFileStatus"){helper.dom.removeEvent(window,"message",msgHnd);let res=true;if(file.clipboard===true)clipboardDownloadFiles=null;if(e.data.result instanceof TypeError){let resultMsg=e.data.result.message||e.data.result;if(resultMsg){helper.console.warning(resultMsg,
arguments);res=false}}callback(res)}};helper.dom.removeEvent(window,"message");helper.dom.addEvent(window,"message",msgHnd);ifrRemoteDownloadFile.contentWindow.postMessage({"cmd":"downloadFile","url":url,"downloadName":downloadName,"saveAs":saveAs},"*")}else callback(false)}catch(err){helper.dom.removeEvent(window,"message",msgHnd);helper.console.log("Cannot download file remotely, postMessage fails: "+err.message||err,arguments);callback(false)}};var downloadURL=function downloadURL(url){if(agentInfo.isMSIE)window.open(url);
else{var downloadIframe=document.createElement("iframe");downloadIframe.id="hiddenDownloader"+downloadIdx++;downloadIframe.style.visibility="hidden";document.body.appendChild(downloadIframe);downloadIframe.src=url;window.setTimeout(function(){document.body.removeChild(document.getElementById(downloadIframe.id))},5E3)}};downloadWithVirtualLink(dfUrl,downloadName,function(result){if(!result)downloadURL(dfUrl);else self.downloadList.downloadNextFile()})}processRDPCrossMessages("onFileDownload",fileNames)},
onFileReady:function(objprn){fireExternalEvent("onFileReady",objprn,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onFileReady)self.rdParams.events.onFileReady(objprn.url);else if(typeof objprn.obj!="undefined")self.newPrintDialog(objprn.obj);else self.openPrnWindow(objprn,true)})},onFileStream:function(data){fireExternalEvent("onFileStream",data,function(preventExecution){if(preventExecution!==true&&self.rdParams.events.onFileStream)self.rdParams.events.onFileStream(data)})},
onSessionEnd:function(obj){fireExternalEvent("onSessionEnd",obj,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onSessionEnd)self.rdParams.events.onSessionEnd(obj);else $(window).trigger("sessionEnd",obj)});disposeView()},onServerConnecting:function(status){fireExternalEvent("onServerConnecting",status,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onServerConnecting)self.rdParams.events.onServerConnecting(status);else $(window).trigger("ServerConnecting",
status)})},onServerCommandEvent:function(obj){var handled=false;if(typeof obj.respId=="undefined")return handled;switch(obj.respId){case 1:self.downloadList.list.rows=obj.items;self.downloadList.downloadDialog();handled=true;break;case 2:self.ssnShare.enabled=obj.items.length>0;if(self.ssnShare.enabled){var ssnData=obj.items[0];var baseServerUrl=_runRemote?self.baseUrl.substr(0,self.baseUrl.length-1):helper.url.parseUrl(window.location.href).toUrl("-a-r-vp");if(baseServerUrl&&baseServerUrl.substr(baseServerUrl.length-
1,1)=="/"&&ssnData.shareURL&&ssnData.shareURL.substr(0,1)=="/")ssnData.shareURL=ssnData.shareURL.substr(1,ssnData.shareURL.length-1);baseServerUrl=baseServerUrl.substr(0,baseServerUrl.length-1)+Thinfinity.global.variables.basePath;var bUrl=Thinfinity.global.variables.basePath.split("/").filter(function(p){return p!==""});var sUrl=ssnData.shareURL.split("/").filter(function(p){return p!==""});if(bUrl[bUrl.length-1]===sUrl[0])ssnData.shareURL=sUrl.slice(1,sUrl.length).join("/");self.ssnShare.shareURL=
baseServerUrl+ssnData.shareURL;self.ssnShare.expirationDate=ssnData.expiration;self.ssnShare.password=ssnData.password;self.ssnShare.key=ssnData.key;self.ssnShare.flags=ssnData.flags}if(self.rdParams.events&&self.rdParams.events.onShareSession)if(self.ssnShare.enabled)self.rdParams.events.onShareSession({"url":self.ssnShare.shareURL,"pwd":ssnData.password});else self.ssnShare.getSharing();else if(self.rdParams.noSsnDialog)if(self.ssnShare.enabled)fireExternalEvent("onShareSession",{"url":self.ssnShare.shareURL,
"pwd":self.ssnShare.password},function(preventExecution){if(!preventExecution)self.ssnShare.openDialog()});else self.ssnShare.getSharing();else self.ssnShare.openDialog();handled=true;break;case 3:self.showTrafficData(obj);break}return handled},onServerError:function(oError){if(oError.brokerDown===true&&oError.temp===true&&document.referrer!="")self.rdParams.exitURL=document.referrer;if(oError?.credentials){self.events.onServerNeedCredentials(oError);self.__proto__.endingsession=false;self.__proto__.connected=
false}else if(self.rdParams.events.onServerError)self.rdParams.events.onServerError(oError);else $(window).trigger("serverError",oError);processRDPCrossMessages("onServerError",oError)},onSessionStart:function(obj){self.__proto__.connected=true;if(obj.rfxEnabled)self.serverValues.rfxEnabled=true;if(typeof obj.isShadowSession!="undefined")THIN.rcParams.isShadowSession=obj.isShadowSession;if(!THIN.rcParams.isShadowSession&&obj.beingRecorded===true)if(!_growlBeingRecordedPopup)_growlBeingRecordedPopup=
Thinfinity.Popups.growl({"message":thinRDPconsts.beingRecorded,"icon":false,"type":Thinfinity.Popups.growl.type.WARNING});if((!agentInfo.isMobile||helper.object.getValue(self.rcParams,"mobile.smartSizing",false,{ignoreCase:true})&&(self.rcParams.viewWidth>=environment.viewportWidth||self.rcParams.viewHeight>=environment.viewportHeight||self.rcParams.viewWidth>=environment.viewportHeight||self.rcParams.viewHeight>=environment.viewportWidth))&&typeof obj.smartSizing!="undefined"&&obj.smartSizing!=self.rdParams.scaled)if(typeof customSettings==
"undefined"||typeof customSettings.scaled=="undefined")self.rcParams.scaled=self.rdParams.scaled=obj.smartSizing;if(agentInfo.isMobile&&zoom)setTimeout(function(){zoom(THIN.scale)},500);if(THIN.rdParams.startprg===ThinRDP.applicationAction.NONE)THIN.show();fireExternalEvent("onSessionStart",obj,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onSessionStart)self.rdParams.events.onSessionStart(obj);else $(window).trigger("sessionStart",obj);if(self.rdParams.rfsMountPoints!=
null)self.connectRemoteFilesystem();else self.rdParams.rfsMountPoints=""});createRemoteDownload()},onServerCommandResult:function(obj){if(typeof obj.isShadowSession!="undefined")THIN.rcParams.isShadowSession=obj.isShadowSession;if(obj.soundEnabled)self.rdParams.sound.enabled=true;self.isOTURLSession=obj.isOTURLSession;var iq;if(obj.imageMethod==3)iq=4;else if(helper.object.isNumber(obj.imageQuality))iq=parseInt(obj.imageQuality,10);else iq=0;if(iq!=self.rdParams.imagequality)self.rdParams.imagequality=
iq;if(!document.getElementById(productId+"_canvas_1")){var win={"left":0,"top":0,"width":self.rcParams.viewWidth,"height":self.rcParams.viewHeight,"hwnd":1,"zidx":0};self.createCanvas(win)}fireExternalEvent("onServerCommandResult",obj,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onServerCommandResult)self.rdParams.events.onServerCommandResult(obj);else $(window).trigger("serverCommandResult",obj)})},onServerDisconnect:function(){if(_growlBeingRecordedPopup)_growlBeingRecordedPopup.destroy();
fireExternalEvent("onServerDisconnect",null,function(preventExecution){if(preventExecution!==true)if(!self.gettingCredentials){self.hide();if(self.rdParams.events.onServerDisconnect)self.rdParams.events.onServerDisconnect();else $(window).trigger("serverDisconnect")}})},onBrokerError:function(obj){var response=false;if(obj.errno===404&&obj.temp===true){response=true;if(obj.originalEvent==1){delete obj.originalEvent;fireExternalEvent("onBrokerError",obj)}else if(self.rdParams.events.onBrokerError)response=
self.rdParams.events.onBrokerError(obj);else $(window).trigger("onBrokerError",obj)}return response},onServerConnectionError:function(errorMsg){fireExternalEvent("onServerConnectionError",errorMsg,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onServerConnectionError)self.rdParams.events.onServerConnectionError(errorMsg);else $(window).trigger("serverConnectionError",errorMsg)});disposeView()},onServerRedirect:function(url,obj){fireExternalEvent("onServerRedirect",[url,
obj],function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onServerRedirect)self.rdParams.events.onServerRedirect(url,obj);else $(window).trigger("serverRedirect",[url,obj])})},onServerConnect:function(obj){fireExternalEvent("onServerConnect",obj,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onServerConnect)self.rdParams.events.onServerConnect(obj);else $(window).trigger("serverConnect",obj)})},onDisplayInteractionRequired:function(obj,callback){if(self.rdParams.events.onDisplayInteractionRequired)self.rdParams.events.onDisplayInteractionRequired(obj,
callback)},onServerNeedCredentials:function(obj){self.connecting=false;Thinfinity.Popups.establishing.hide();self.authenticateUser(obj);processRDPCrossMessages("onServerNeedCredentials",obj)},onConnectionKindChange:function(){processRDPCrossMessages("onConnectionKindChange")},onKeyCode:function(e){var kcode=e.which||e.keyCode;if(kcode>=96&&kcode<=105&&kcode!=110)kcode-=48;return kcode},onKeyDown:function(e){var keybinfo={"type":e.type,"altKey":e.altKey,"ctrlKey":e.ctrlKey,"charCode":e.charCode,"keyCode":e.keyCode,
"which":e.which,"shiftKey":e.shiftKey,"metaKey":e.metaKey};var kcode=self.keyCode(e);if(self.IsFunctionKey(kcode)||(e.altKey||e.ctrlKey)&&e.altKey!=e.ctrlKey||!self.rcParams.kbdUnicode){self.sendKey(kcode,0,"down");e.stopPropagation();e.preventDefault()}self.lastKeyCode=kcode},onKeyPress:function(e){var charCode=self.opera?e.which:e.charCode;var keybinfo={"type":e.type,"altKey":e.altKey,"ctrlKey":e.ctrlKey,"charCode":e.charCode,"keyCode":e.keyCode,"which":e.which,"shiftKey":e.shiftKey,"metaKey":e.metaKey};
if(self.rcParams.kbdUnicode){var kcode=self.keyCode(e);if(kcode!=0&&self.IsFunctionKey(self.lastKeyCode)||(e.altKey||e.ctrlKey)&&e.altKey!=e.ctrlKey){e.stopPropagation();e.preventDefault();return}if(self.onlyKeyCode)self.sendKey(self.lastKeyCode,0,"down");else self.sendKey(self.lastKeyCode,charCode,"down");e.stopPropagation();e.preventDefault()}},onKeyUp:function(e){var keybinfo={"type":e.type,"altKey":e.altKey,"ctrlKey":e.ctrlKey,"charCode":e.charCode,"keyCode":e.keyCode,"which":e.which,"shiftKey":e.shiftKey,
"metaKey":e.metaKey};var kcode=self.keyCode(e);if(self.keyCodeSend==0)self.sendKey(0,self.lastKeyCode,"up");else self.sendKey(kcode,0,"up");self.lastKeyCode=0;if(self.firefox&&e.altKey)self.sendKey(18,0,"up");e.stopPropagation();e.preventDefault()},onPlaybackStart:function(){self.display.manager.fireEvent("playbackStart");if(self.rdParams.events.onPlaybackStart)self.rdParams.events.onPlaybackStart()},onPlaybackEnds:function(message){if(self.rdParams.events.onPlaybackEnds)self.rdParams.events.onPlaybackEnds(message)},
onDesktopResize:function(data){if(window!=window.top&&self.rdParams.publishproperties){var obj={"property":"REMOTE_DESKTOP_SIZE","sourceName":window.name,"values":data};window.parent.postMessage(obj,"*")}},onLastUpdateChanged:null,onLicenseMsg:function(obj){fireExternalEvent("onLicenseMsg",obj,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onMessage)self.rdParams.events.onLicenseMsg(obj);else $(window).trigger("licenseMsg",[obj])})},onWakeOnLan:function(obj){obj.message=
thinRDPconsts.waitingWakeOnLan;fireExternalEvent("onWakeOnLan",obj,function(preventExecution){if(self.rdParams.events.onWakeOnLan)self.rdParams.events.onWakeOnLan(obj);else $(window).trigger("onWakeOnLan",obj)})},onWaitForVM:function(obj){obj.message=thinRDPconsts.waitingWaitForVM;fireExternalEvent("onWaitForVM",obj,function(preventExecution){if(self.rdParams.events.onWaitForVM)self.rdParams.events.onWaitForVM(obj);else $(window).trigger("onWaitForVM",obj)})},onReconnectionAttempt:function(obj){obj.message=
thinRDPconsts.reconnectionAttempt;fireExternalEvent("onReconnectionAttempt",obj,function(preventExecution){if(self.rdParams.events.onReconnectionAttempt)self.rdParams.events.onReconnectionAttempt(obj);else $(window).trigger("onReconnectionAttempt",obj)})},onCopy:function(obj){fireExternalEvent("copy",obj,function(preventExecution){if(preventExecution!==true)return self.rdParams.events.onCopy?self.rdParams.events.onCopy(obj):$(window).trigger("onCopy",obj)})},onPaste:function(obj){fireExternalEvent("paste",
obj,function(preventExecution){if(preventExecution!==true)return self.rdParams.events.onPaste?self.rdParams.events.onPaste(obj):$(window).trigger("onPaste",obj)})},onCut:function(obj){fireExternalEvent("cut",obj,function(preventExecution){if(preventExecution!==true)return self.rdParams.events.onCut?self.rdParams.events.onCut(obj):$(window).trigger("onCut",obj)})},onCopyFiles:function(data){if(self.rdParams.events.onCopyFiles)self.rdParams.events.onCopyFiles(data)},onSessionTimeout:function(obj){fireExternalEvent("onSessionTimeout",
obj,function(preventExecution){if(self.rdParams.events.onSessionTimeout)self.rdParams.events.onSessionTimeout(obj);else $(window).trigger("onSessionTimeout",obj)})},onShadowingStatus:function(shadowed){fireExternalEvent("onShadowingStatus",shadowed,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onShadowingStatus)self.rdParams.events.onShadowingStatus(shadowed);else $(window).trigger("onShadowingStatus",[shadowed])})},onConnectionLost:function(data){if(self.rdParams.events.onConnectionLost)return self.rdParams.events.onConnectionLost(data);
else $(window).trigger("onConnectionLost",[data])},onConnectionRestored:function(data){if(self.rdParams.events.onConnectionRestored)return self.rdParams.events.onConnectionRestored(data);else $(window).trigger("onConnectionRestored",[data])}};this.completeAjaxParams=function(params){if(self.isCrossDomain()){params.beforeSend=function(xhr){xhr.withCredentials=true};params.crossDomain=true}return params};this.encryptedLogin=function(credentials,success,fail,context){var result=false;var querystr="login?credentials="+
encodeURIComponent(this.credentials);if(typeof context!="undefined")querystr=querystr+"&context="+context;this.credentials=credentials;var params={url:self.baseUrl+querystr,async:true,dataType:"html",error:function(jqXHR,err){result=false;fail()},success:function(data){var obj=JSON.parse(data);if(obj.rc==0){result=true;self.pingStart();success()}else{result=false;fail()}}};$.ajax(self.completeAjaxParams(params));return result};this.login=function(username,password,context,success,fail,redirect){var querystr=
"auth/login";var a=username.split("\\");var brokerid="";if(window.productName.indexOf(" Online")>0&&a.length==2&&!helper.object.isNumber(a[0])){brokerid="WEB:"+a[0];querystr=brokerid+"/"+querystr}this.username=username;this.password=password;var params={type:"post",url:self.baseUrl+self.apiUrl+querystr,contentType:"application/json",data:JSON.stringify({username:username,password:password,context:context||""}),async:true,cache:false,dataType:"html",error:function(jqXHR,err){if(jqXHR&&jqXHR.responseText)try{err=
JSON.parse(jqXHR.responseText);err=err.error||{}}catch(e){err={}}fail(err)},success:function(data){try{var obj=JSON.parse(data);obj=obj.data||obj.error||{};if(brokerid!="")$.ajax({type:"patch",async:true,cache:false,url:self.baseUrl,headers:{"x-thinfinity-poolid":brokerid}});if(typeof obj.redirectUri!="undefined"){if(window?.defaultSettings?.proxyAdjust2FAUri){var redirectUrl=helper.url.parseUrl(obj.redirectUri);var currentLocation=helper.url.parseUrl(location);if(redirectUrl.origin!==currentLocation.origin&&
!!redirectUrl.hostname&&!!currentLocation.origin){helper.console.warning(thinRDPconsts.reverseProxyMissingHeaders,arguments);obj.redirectUri=currentLocation.toUrl("-a-p-o")+(redirectUrl.virtualPath.startsWith("/")?redirectUrl.virtualPath.substring(1):redirectUrl.virtualPath);if(!obj.redirectUri.startsWith("/"))obj.redirectUri="/"+obj.redirectUri}}let res=false;if(typeof redirect==="function")try{res=redirect(obj.redirectUri)}catch(error){logError("login redirect handler error. "+error.message);res=
false}let href=location.href;if(href.indexOf("#")>-1)obj.redirectUri+=`#${href.split("#")[1]}`;if("data"in obj&&obj.data!=="")post(obj.redirectUri,{data:JSON.stringify(obj.data)});else if(!res)window.location=obj.redirectUri;return}if(obj&&obj.rc==0||"data"in obj&&typeof obj.data.renderURI!="undefined")success(obj);else fail(obj)}catch(error){fail(error)}}};$.ajax(self.completeAjaxParams(params))};this.logout=function(success,fail){var params={url:self.baseUrl+self.apiUrl+"auth/logout",cache:false,
async:true,dataType:"html",success:function(obj){if(typeof success!="undefined")success(obj)},error:function(jqXHR,textStatus){if(typeof fail!="undefined")fail(jqXHR)},timeout:3E3};$.ajax(self.completeAjaxParams(params))};this.getLoginMethods=function(success,fail){$.ajax({url:self.baseUrl+self.apiUrl+"auth/loginmethods",async:true,cache:false,dataType:"html",contentType:"application/json",error:function(jqXHR,err){fail()},success:function(data){var obj=typeof data!="object"?JSON.parse(data):data;
success(obj)}})};this.changePassword=function(username,oldPassword,newPassword,success,fail){this.username=username;this.password=newPassword;var params={"url":self.baseUrl+self.apiUrl+"auth/changepassword","method":"POST","async":true,"cache":false,"dataType":"html","contentType":"application/json","data":JSON.stringify({username:username,password:oldPassword,newpassword:newPassword}),"error":function(jqXHR,err){fail(JSON.parse(jqXHR.responseText).error)},"success":function(){success()}};$.ajax(self.completeAjaxParams(params))};
this.radiusChallengeResponse=function(username,originalMsg,response,success,fail){var params={"url":self.baseUrl+self.apiUrl+"auth/login","method":"POST","async":true,"cache":false,"dataType":"html","contentType":"application/json","data":JSON.stringify({context:"Radius",username:username,password:"",parent:originalMsg,answer:response}),"error":function(jqXHR,err){let error;if(jqXHR&&jqXHR.responseText){try{error=JSON.parse(jqXHR.responseText).error}catch{}fail(error)}fail()},"success":function(data){success(data)}};
$.ajax(self.completeAjaxParams(params))};this.profileType=_profileTypes;this.getRequestProfile=function(profileType){return profileType==self.profileType.TEMP?"temp=true":profileType==self.profileType.MRU?"mru=true":profileType==self.profileType.PRIVATE?"priv=true":profileType==self.profileType.FILTER?"filter=true":profileType==self.profileType.WEBMANAGER?"webmgr=true":"mru=false"};this.findMember=function(member,callback){var result=null;var reqURL=self.baseUrl+self.apiUrl+"members/"+encodeURIComponent(member);
var params={url:reqURL,async:true,cache:false,dataType:"html",statusCode:{500:function(error){callback(helper.string.format("Error: {0} - Message: {1}",error.status,error.statusText))},401:function(){callback(result)},404:function(data){result=JSON.parse(data&&data.responseText?data.responseText:"{}");callback(result)},200:function(data){result=JSON.parse(data);callback(result)}}};$.ajax(self.completeAjaxParams(params))};this.getUserInfo=function(callback){helper.ajax.get({url:self.baseUrl+self.apiUrl+
"auth/getUserInfo",async:true,cache:false,withCredentials:true,dataType:helper.ajax.responseType.JSON,success:function(res,status,xhr){if(status===200)_thinrdp.authenticated=!!res.data.username;callback(res)},error:callback})};this.getUserInfoAsync=async function(){return new Promise(function(resolve,reject){self.getUserInfo(function(res){resolve(res)})})};this.getVMModels=function(callback){helper.ajax.get({url:self.baseApiUrl+`__cloud__/models`,async:true,cache:false,withCredentials:true,dataType:helper.ajax.responseType.JSON,
success:callback,error:callback})};this.getVMLinkModels=function(callback){helper.ajax.get({url:self.baseApiUrl+`__cloud__/models/links`,async:true,cache:false,withCredentials:true,dataType:helper.ajax.responseType.JSON,success:callback,error:callback})};this.getDomainServices=function(success,failure){helper.ajax.get({"url":self.baseUrl+self.apiUrl+"dirsvc/settings","async":true,"cache":false,"withCredentials":true,"dataType":helper.ajax.responseType.JSON,"success":success,"error":function(err,status,
jqXHR){failure({"status":status,"message":err.message})}})};this.searchUsers=function(requestData,success,failure){helper.ajax.post({"url":self.baseUrl+self.apiUrl+"dirsvc/search","data":requestData,"async":true,"cache":false,"withCredentials":true,"dataType":helper.ajax.responseType.JSON,"success":success,"error":function(err,status,jqXHR){failure({"status":status,"message":err.message})}})};this.commitTransaction=function(id,callback){var _id=id!==""?id.toString():"*";var callArgs={"url":self.baseApiUrl+
self.apiUrl+`profiles/${_id}/commit`,"dataType":helper.ajax.responseType.JSON,"cache":false,"withCredentials":true,"success":callback,"error":callback};helper.ajax.post(callArgs)};this.rollbackTransaction=function(id,callback){var _id=id!==""?id.toString():"*";var callArgs={"url":self.baseUrl+self.apiUrl+`profiles/${_id}/rollback`,"dataType":helper.ajax.responseType.JSON,"cache":false,"withCredentials":true,"success":callback,"error":callback};helper.ajax.post(callArgs)};this.getIcon=function(iconURI,
success,error){var callArgs={url:"/__base__/images",dataType:helper.ajax.responseType.JSON,cache:false,data:{source:iconURI},success:function(res,status,xhr){let img=helper.object.getValue(res,"data.image",null);if(img){img="data:image/png;base64,"+img;success(img,status,xhr)}else error("No item data",xhr)},error:error};helper.ajax.post(callArgs)};this.getProfiles=function(profileType,callback,labelId,opts){var result=null;opts=helper.object.extend({filter:{text:"",scraper:"*",showDisabled:true,showHidden:true},
viewAs:null},opts||{});var reqURL=self.baseApiUrl+self.apiUrl+"profiles/search"+(_queryVersion?"?"+_queryVersion:"");var params={url:reqURL,method:"POST",async:true,cache:false,dataType:"html",contentType:"application/json",data:JSON.stringify({"workspace":[self.profileType.PUBLIC,self.profileType.WEBMANAGER].indexOf(profileType)!==-1?"_pub":"_priv","labelid":labelId,"mode":"compact","filter":{"text":opts.filter.text,"scraper":opts.filter.scraper,"showDisabled":opts.filter.showDisabled,"showHidden":opts.filter.showHidden,
...(opts.filter.bookingPov?{"bookingPov":opts.filter.bookingPov}:{})},"params":[],"viewAs":!!opts.viewAs?opts.viewAs:profileType===self.profileType.WEBMANAGER?"_all":"_self"}),statusCode:{500:function(error){callback(helper.string.format("Error: {0} - Message: {1}",error.status,error.statusText))},401:function(){callback(result)},200:function(data){result=JSON.parse(data);result=result.data||{};if(result&&result.labels&&result.labels instanceof Array){if(Thinfinity.LabelConfig&&profileType===self.profileType.PUBLIC&&
result.labels.length===0)if(!labelId)result.labels.push(Thinfinity.LabelConfig.root);result.labels.forEach(function(elem){elem.profileType=profileType==self.profileType.WEBMANAGER?self.profileType.PUBLIC:profileType})}callback(result)}}};$.ajax(self.completeAjaxParams(params))};this.getLabels=function(labelId,profileType,callback,opts){var result=null;opts=helper.object.extend({viewAs:null},opts||{});var reqURL=self.baseApiUrl+self.apiUrl+"labels"+(_queryVersion?"?"+_queryVersion:"");var params={url:reqURL,
async:true,cache:false,method:"GET",type:"get",dataType:"html",data:{"workspace":[self.profileType.PUBLIC,self.profileType.MRU,self.profileType.WEBMANAGER].indexOf(profileType)!==-1?"_pub":"_priv","viewAs":!!opts.viewAs?opts.viewAs:profileType===self.profileType.WEBMANAGER?"_all":"_self"},statusCode:{500:function(error){callback(helper.string.format("Error: {0} - Message: {1}",error.status,error.statusText))},401:function(){callback(result)},200:function(data){result=JSON.parse(data);result=result.data&&
result.data.items?result.data.items:{};if(result&&result instanceof Array){if(Thinfinity.LabelConfig&&profileType===self.profileType.MRU&&result.length===0)if(!labelId)result.push(Thinfinity.LabelConfig.root);result.forEach(function(elem){elem.profileType=profileType})}callback(result)}}};$.ajax(self.completeAjaxParams(params))};this.newLabel=function(data,profileType,success,fail){var result=null;if(typeof profileType!="number")profileType=self.profileType.MRU;var reqURL=self.baseUrl+self.apiUrl+
"labels";var data={data:data,workspace:[self.profileType.PUBLIC,self.profileType.MRU,self.profileType.WEBMANAGER].indexOf(profileType)!==-1?"_pub":"_priv"};var params={url:reqURL,method:"POST",async:true,cache:false,contentType:"application/json",data:JSON.stringify(data),complete:function(jqXHR,textStatus){var jqXHRDetails={status:jqXHR.status,statusText:jqXHR.statusText};switch(jqXHR.status){case 201:var res=jqXHR.responseJSON;res=res.data||{};success(res);break;case 401:fail(result,jqXHRDetails);
break;case 500:fail(helper.string.format("Error: {0} - Message: {1}",jqXHR.status,jqXHR.statusText),jqXHRDetails);break;default:fail(jqXHR.statusText,jqXHRDetails);break}}};$.ajax(self.completeAjaxParams(params))};this.updateLabel=function(data,profileType,success,fail){var result=null;if(typeof profileType!="number")profileType=self.profileType.MRU;var reqURL=self.baseUrl+self.apiUrl+"labels/"+data.id+"?workspace="+([self.profileType.PUBLIC,self.profileType.MRU,self.profileType.WEBMANAGER].indexOf(profileType)!==
-1?"_pub":"_priv");var data={data:data};var params={url:reqURL,method:"PUT",async:true,cache:false,contentType:"application/json",data:JSON.stringify(data),complete:function(jqXHR,textStatus){var jqXHRDetails={status:jqXHR.status,statusText:jqXHR.statusText};switch(jqXHR.status){case 200:success(jqXHR.responseJSON);break;case 401:fail(result,jqXHRDetails);break;case 500:fail(helper.string.format("Error: {0} - Message: {1}",jqXHR.status,jqXHR.statusText),jqXHRDetails);break;default:fail(jqXHR.statusText,
jqXHRDetails);break}}};$.ajax(self.completeAjaxParams(params))};this.removeLabel=function(labelId,profileType,success,fail){var result=null;var reqURL=self.baseUrl+self.apiUrl+"labels/"+labelId+"?workspace="+([self.profileType.PUBLIC,self.profileType.MRU,self.profileType.WEBMANAGER].indexOf(profileType)!==-1?"_pub":"_priv");var params={method:"DELETE",url:reqURL,async:true,cache:false,dataType:"json",complete:function(jqXHR,textStatus){var jqXHRDetails={status:jqXHR.status,statusText:jqXHR.statusText};
switch(jqXHR.status){case 200:success(jqXHR.responseJSON);break;case 401:fail(result,jqXHRDetails);break;case 500:fail(helper.string.format("Error: {0} - Message: {1}",jqXHR.status,jqXHR.statusText),jqXHRDetails);break;default:fail(jqXHR.statusText,jqXHRDetails);break}}};$.ajax(self.completeAjaxParams(params))};this.getProfile=function(publickey,profileType,callback,extraParams){var result=null;var reqURL=self.baseApiUrl+self.apiUrl+"profiles/"+publickey+(_queryVersion?"?"+_queryVersion:"")+(extraParams?
"&"+extraParams:"");var params={url:reqURL,method:"GET",cache:false,async:true,dataType:"json",data:{"workspace":[self.profileType.PUBLIC,self.profileType.WEBMANAGER].indexOf(profileType)!==-1?"_pub":"_priv"},statusCode:{500:function(error){callback(helper.string.format("Error: {0} - Message: {1}",error.status,error.statusText))},400:function(){callback({})},200:function(data){data=data.data||{};callback(data)}}};$.ajax(self.completeAjaxParams(params))};this.extendAuth=function(url,callback){const reqURL=
self.baseApiUrl+self.apiUrl+"auth/extend";return fetch(reqURL,{method:"POST",body:JSON.stringify({"url":url}),headers:{"Content-type":"application/json"}}).then(j=>j.json()).then(res=>{let token=res?.data?.token??null;return token?reqURL+"/"+token:null})};this.getProfileCredentials=function(publickey,success,failure){var result=null;var reqURL=self.baseApiUrl+self.apiUrl+"profiles/"+publickey+"/credentials?workspace=_pub"+(_queryVersion?"&"+_queryVersion:"");var params={url:reqURL,method:"GET",cache:false,
async:true,dataType:"json",statusCode:{500:function(error){(failure||success)(helper.string.format("Error: {0} - Message: {1}",error.status,error.statusText))},400:function(){(failure||success)({})},404:function(data){(failure||success)(data.responseJSON?data.responseJSON.error.message:error.statusText)},200:function(data){data=data.data||{};success(data)}}};$.ajax(self.completeAjaxParams(params))};this.updateProfileCredentials=function(publickey,obj,success,fail){var reqURL=self.baseApiUrl+self.apiUrl+
"profiles/"+publickey+"/credentials";var data={workspace:"_pub",data:obj};var params={method:""==obj.username+obj.password?"DELETE":"PUT",url:reqURL,cache:false,async:true,contentType:"application/json",data:JSON.stringify(data),complete:function(jqXHR,textStatus){var jqXHRDetails={status:jqXHR.status,statusText:jqXHR.statusText};switch(jqXHR.status){case 200:var res=jqXHR.responseJSON;success(res);break;default:fail(jqXHRDetails);break}}};$.ajax(self.completeAjaxParams(params))};this.newProfile=
function(profile,profileType,success,fail){var result=null;if(typeof profileType!="number")profileType=self.profileType.MRU;var reqURL=self.baseApiUrl+self.apiUrl+"profiles";var data={data:profile,workspace:profileType==self.profileType.TEMP?"_temp":[self.profileType.PUBLIC,self.profileType.WEBMANAGER].indexOf(profileType)!==-1?"_pub":"_priv",model:profile.model?profile.model:""};delete profile.id;delete profile.publickey;delete profile.model;var params={url:reqURL,method:"POST",async:true,contentType:"application/json",
data:JSON.stringify(data),complete:function(jqXHR,textStatus){var jqXHRDetails={status:jqXHR.status,statusText:jqXHR.statusText};switch(jqXHR.status){case 201:var res=jqXHR.responseJSON;res=res.data||{};success(res);break;case 400:fail(result,jqXHRDetails);break;case 500:fail(helper.string.format("Error: {0} - Message: {1}",jqXHR.status,jqXHR.statusText),jqXHRDetails);break;default:fail(jqXHR.statusText,jqXHRDetails);break}}};$.ajax(self.completeAjaxParams(params))};this.updateProfile=function(profile,
profileType,success,fail){var result=null;if(typeof profileType!="number")profileType=self.profileType.MRU;var reqURL=self.baseApiUrl+self.apiUrl+"profiles/"+profile.publickey;var data={data:profile,workspace:[self.profileType.PUBLIC,self.profileType.WEBMANAGER].indexOf(profileType)!==-1?"_pub":"_priv"};var params={url:reqURL,method:"PUT",async:true,contentType:"application/json",data:JSON.stringify(data),complete:function(jqXHR,textStatus){var jqXHRDetails={status:jqXHR.status,statusText:jqXHR.statusText};
switch(jqXHR.status){case 200:success(jqXHR.responseJSON);break;case 400:fail(result,jqXHRDetails);break;case 500:fail(helper.string.format("Error: {0} - Message: {1}",jqXHR.status,jqXHR.statusText),jqXHRDetails);break;default:fail(jqXHR.statusText,jqXHRDetails);break}}};$.ajax(self.completeAjaxParams(params))};this.removeProfile=function(publickey,profileType,callback){var result=null;var reqURL=self.baseApiUrl+self.apiUrl+"profiles/"+publickey+"?workspace="+([self.profileType.PUBLIC,self.profileType.WEBMANAGER].indexOf(profileType)!==
-1?"_pub":"_priv");var params={method:"DELETE",url:reqURL,cache:false,async:true,contentType:"application/json",complete:function(jqXHR,textStatus){var jqXHRDetails={status:jqXHR.status,statusText:jqXHR.statusText};switch(jqXHR.status){case 200:var res=jqXHR.responseJSON;callback(res,jqXHRDetails);break;case 401:callback(result,jqXHRDetails);break;case 500:callback(helper.string.format("Error: {0} - Message: {1}",jqXHR.status,jqXHR.statusText),jqXHRDetails);break;default:callback(jqXHR.statusText,
jqXHRDetails);break}}};$.ajax(self.completeAjaxParams(params))};this.pingStart=function(){if(!self.sessionTimer)self.sessionTimer=setTimeout(function(){if(self){var params={url:self.baseUrl+self.apiUrl+"auth/ping",async:true,timeout:5E3,dataType:"html",error:function(){self.sessionTimer=null;self.pingStart()},statusCode:{500:function(error){window.location.reload();return},200:function(data){result=JSON.parse(data);if(_thinrdp.authenticated!=result.authenticated)if(result.authenticated)_thinrdp.authenticated=
result.authenticated;else{window.location.reload();return}if(_thinrdp.lastUpdate!=result.lastupdate)_thinrdp.updateLastUpdate(result.lastupdate);self.sessionTimer=null;self.pingStart()}}};$.ajax(self.completeAjaxParams(params))}},PING_TIMEOUT)};this.pingStop=function(){clearTimeout(self.sessionTimer);self.sessionTimer=null};this.fillTimeZoneInfo=function(params){var rightNow=new Date;var rightStr=rightNow.getFullYear()+"-"+("0"+(rightNow.getMonth()+1)).slice(-2)+"-"+("0"+rightNow.getDate()).slice(-2)+
" "+rightNow.toTimeString();var temp;var Jan1=new Date(rightNow.getFullYear(),0,1,0,0,0,0);temp=Jan1.toUTCString();temp=temp.substring(0,temp.lastIndexOf(" "));var Jan2=new Date(temp);var Jul1=new Date(rightNow.getFullYear(),6,1,0,0,0,0);temp=Jul1.toUTCString();temp=temp.substring(0,temp.lastIndexOf(" "));var Jul2=new Date(temp);var standard_offset=(Jan1-Jan2)/(1E3*60);var daylight_offset=(Jul1-Jul2)/(1E3*60);rightStr+="|"+(standard_offset-daylight_offset);if(standard_offset!=daylight_offset){var Cur1=
new Date(rightNow.getFullYear(),rightNow.getMonth(),rightNow.getDate(),rightNow.getHours(),rightNow.getMinutes(),rightNow.getSeconds(),0);temp=Cur1.toUTCString();temp=temp.substring(0,temp.lastIndexOf(" "));var Cur2=new Date(temp);var current_offset=(Cur1-Cur2)/(1E3*60);if(current_offset==(standard_offset>daylight_offset?standard_offset:daylight_offset))rightStr+="|1";else rightStr+="|0"}else rightStr+="|0";params.timeZone=rightStr};this.applyParam=function(params,name,value){if(typeof value=="object"&&
value!=null)if(value instanceof Array)params[name]=value.slice(0);else{var obj=params[name];if(!obj)obj={};for(var v in value)obj[v]=value[v];params[name]=obj}else params[name]=value};function refreshFitToScreen(){var useDisp=self.serverValues.dynamicplugins["drdynvc/Microsoft::Windows::RDS::DisplayControl"];if(typeof useDisp!="undefined"&&useDisp=="created"){var ww=window.environment.rawWidth||window.screen.width;var wh=window.environment.rawHeight||window.screen.height;if(helper.object.existsPath(self,
"clientSettings.UseViewportSize")&&self.clientSettings.UseViewportSize){ww=window.environment.viewportWidth;wh=window.environment.viewportHeight}self.sendEvent("cmd=brwrRsze&w="+ww+"&h="+wh+"&id="+self.rcParams.id)}else self.restart()}function resizeDesktop(){if(self&&self.connected){if(typeof resizeTimeout!="undefined")window.clearTimeout(resizeTimeout);resizeTimeout=window.setTimeout(function(){var ww=window.environment.detectedWidth;var wh=window.environment.detectedHeight;if(helper.object.existsPath(self,
"clientSettings.UseViewportSize")&&self.clientSettings.UseViewportSize){ww=window.environment.viewportWidth;wh=window.environment.viewportHeight}if((agentInfo.isMobile||self.rdParams.resizeDesktop)&&self.rcParams.resolution==="fittobrowser"){var useDisp=self.serverValues.dynamicplugins["drdynvc/Microsoft::Windows::RDS::DisplayControl"];if(typeof useDisp!="undefined"&&useDisp=="created"){helper.console.log("calling notifyNewSize");self.sendEvent("cmd=brwrRsze&w="+ww+"&h="+wh+"&id="+self.rcParams.id)}}if(self.rdParams.reconnectOnResize){helper.console.log("actual restartToNewSize");
self.restart(ww,wh,"resize")}if(!agentInfo.isMobile&&self.rcParams.centered)self.center()},waitToResize<500?500:waitToResize)}}function parseProfile(incomingProfile){var scraper=(incomingProfile.scraperId||"RDP").toUpperCase();var outputProfile={};var editor=new Thinfinity.Profile.Editor({"API":ThinRDP,"type":scraper,"mode":"SILENT","profile":incomingProfile});if(incomingProfile.profileKey)editor.mergeData(outputProfile);else outputProfile=editor.mergeData();return outputProfile}this.getEventsHandlerList=
function(eventObj){var list=[];if(eventObj!=null)for(var eventName in eventObj)if(eventObj[eventName]!=null)list.push(eventName);return list};function getTargetIframe(params){var iframe=null;var divId=params.divId?document.getElementById(params.divId):null;var target=divId?divId:helper.object.getHTMLType(params.targetWindow)!=null?params.targetWindow:typeof params.targetWindow=="string"?document.getElementById(params.targetWindow):null;if(_isRecoveringConnection)target=document.getElementById(self.rdParams.targetWindow);
var targetName="iframe_"+runOptions.mode+"_"+helper.utils.getGUID();if(target===null)target=document.body;if(target instanceof HTMLIFrameElement){iframe=target;targetName=(iframe.name||iframe.id)!=""?iframe.name||iframe.id:targetName}else if(target instanceof HTMLElement)iframe=helper.dom.appendJsonElement({"type":"iframe","parentElement":target,"attributes":{"id":targetName,"style":"width:100%;height:100%;position:absolute;margin:0px;padding:0px;border:0px;"}});self.rdParams.targetWindow=targetName;
if(_runRemote)rdpView.linkageConnection.setTargetWindow(self.rdParams.targetWindow);if(runOptions.fullscreen)environment.requestFullscreen(iframe);return{"iframe":iframe,"target":target}}function createTemporalProfile(profileParams){function applyValue(value,target,propString,convertFunc){if(typeof value!="undefined"&&value!=null){var t=target;var prop=propString.split(".");for(var p=0;p<prop.length-1;p++){if(!t[prop[p]])t[prop[p]]={};t=t[prop[p]]}t[prop[prop.length-1]]=convertFunc?convertFunc(value):
value}}function getTempProfile(profile,profileType,success,fail){var frmNP=helper.dom.appendJsonElement({"type":"iframe","parentElement":document.body,"attributes":{"style":"position: absolute; height: 1px; width: 1px; left: -100px;top: -100px; visibility: hidden;z-index:-1;"}});frmNP.onload=function(){var _id=(new Date).getTime().toString();var fnMessage=function(e){if(e.data&&e.data.id===_id){if(e.data.data)success(e.data.data);else fail(e.data.message);helper.dom.removeEvent(window,"onmessage",
fnMessage);document.body.removeChild(frmNP)}};helper.dom.addEvent(window,"onmessage",fnMessage);frmNP.contentWindow.postMessage({"profile":profile,"profileType":profileType,"id":_id},"*")};var turl=self.baseUrl;if(turl.lastIndexOf("/")!=turl.length-1)turl+="/";turl+="getTempProfile.html";frmNP.src=turl}var newProfile=_runRemote&&serverUrl!=""&&serverUrl!=window.location.origin?getTempProfile:self.newProfile;var profile=parseProfile(profileParams.profile||profileParams);if(helper.object.getValue(profileParams,
"profile.general.username",null)&&helper.object.getValue(profileParams,"profile.general.password",null)&&helper.object.getValue(profileParams,"profile.general.credentials",-1)==-1)profileParams.credentials=profile.credentials=ThinRDP.credential.USE_DEFINED;newProfile(profile,self.profileType.TEMP,function(p){var url=helper.url.parseUrl(runOptions.mode===ThinRDP.mode.SDK&&self.baseUrl!==""?self.baseUrl:window.location.href).toUrl("-a-r")+p.urlKey+"/";var elems=getTargetIframe(profileParams);if(elems.iframe){if(elems.target){if(window.getComputedStyle(elems.target,
null).getPropertyValue("visibility")==="hidden")elems.target.style.visibility="visible";if(window.getComputedStyle(elems.target,null).getPropertyValue("display")==="none")elems.target.style.display="block"}elems.iframe.src=url;if(runOptions.mode!=ThinRDP.mode.HOST)rdpView.linkageConnection.start(elems.iframe.contentWindow);if(runOptions.success)setTimeout(function(){runOptions.success()},10)}else throw"Not implemented";},function(e){helper.console.log(e)})}this.connect=function(params){if(typeof params===
"undefined")params=runOptions;if(!_isRecoveringConnection)if(runOptions.mode===ThinRDP.mode.SDK&&!(params&&(params.profileKey||helper.object.getValue(params,"profile.general.address",null)||helper.object.getValue(params,"computer",null)))){var message=thinRDPconsts.establishConnectionMissingKeyData;if(helper.object.existsPath(params,"events.onServerConnectionError"))params.events.onServerConnectionError(message);else helper.console.error(message,arguments);if(runOptions.failure)setTimeout(function(){runOptions.failure(message)},
10);return}window.environment.ready(function(){if(!_isRecoveringConnection){if(params&&typeof params.port==="undefined"&&typeof params.computer!=="undefined"){var rePort=new RegExp(/:[0-9]{1,}/g);var result=rePort.exec(params.computer);if(result){params.computer=params.computer.replace(rePort,"");params.port=result[0].replace(/:/g,"")}}var iq=typeof params.imagequality=="undefined"?1:parseInt(params.imagequality,10);switch(iq){case 0:params.imageMethod=2;params.quality=100;params.rleThreshold=85;
break;case 1:params.imageMethod=2;params.quality=85;params.rleThreshold=85;break;case 2:params.imageMethod=2;params.quality=55;params.rleThreshold=85;break;case 3:params.imageMethod=0;params.quality=25;break;case 4:params.imageMethod=3;break}self.clearParams();for(var p in params)self.applyParam(self.rdParams,p,params[p]);if(typeof customSettings!="undefined"){for(var customProp in customSettings)self.rdParams[customProp]=customSettings[customProp];[{binding:["noShowPopupsOnClose","noShowConnectionClosePopup"],
to:"noShowConnectionClosePopup"}].forEach(item=>{item.binding.forEach(bind=>{if(customSettings.hasOwnProperty(bind))self.rdParams[item.to]=customSettings[bind]})})}if(helper.object.existsPath(window,"customSettings.mobile.extendedKeyboard.enabled"))self.rdParams["disableExtKeys"]=!window.customSettings.mobile.extendedKeyboard.enabled;if((self.rdParams.resizeDesktop||self.rdParams.reconnectOnResize)&&!agentInfo.isMobile);if(typeof self.rdParams.publishproperties=="undefined")self.rdParams.publishproperties=
typeof self.rdParams.events!="undefined"&&!!self.rdParams.events.onPropertyChange;self.rdParams.externalEvents=self.getEventsHandlerList(self.rdParams.events);self.rdParams.externalEvents.push("onBrokerError");self.fillTimeZoneInfo(self.rdParams)}if(runOptions.mode===ThinRDP.mode.OTURL){var elems=getTargetIframe(self.rdParams);if(elems.iframe){elems.iframe.src=serverUrl+runOptions.oturl;rdpView.linkageConnection.start(elems.iframe.contentWindow);if(runOptions.success)setTimeout(function(){runOptions.success()},
10);return}}if([ThinRDP.mode.OTURL,ThinRDP.mode.SDK].indexOf(runOptions.mode)!=-1)createTemporalProfile(params);else if(runOptions.mode===ThinRDP.mode.SKEY){var form=self.buildForm();self.rdParams.credentials=form.elements["credentials"].value;if(self.rdParams.brokerData)document.getElementById("ThinRDPForm").elements["brokerData"].value=self.rdParams.brokerData;document.getElementById("ThinRDPForm").elements["data"].value=encodeURIComponent(JSON.stringify(self.rdParams));form.target=self.rdParams.targetWindow==
"*"?self.buildTargetName():self.rdParams.targetWindow;var proto=self.rdParams.postPage.split(":");form.action=(proto[0]=="http"||proto[0]=="https"?"":self.baseUrl)+self.rdParams.postPage;if(self.rdParams.sourceWindow&&self.rdParams.targetWindow)form.action+=(form.action.indexOf("?")==-1?"?":"&")+"sourceWindow="+self.rdParams.sourceWindow+"&targetWindow="+self.rdParams.targetWindow;self.form=form;form.submit()}else{self.setParams(self.rdParams,self.events);self.registerDrawCommands();if(self.rdParams.logWindow){var scr=
document.createElement("SCRIPT");scr.setAttribute("type","text/javascript");scr.setAttribute("src","js/msgLogger.js");document.head.appendChild(scr)}function callConnect(){self.completeConnection();if(self.rdParams.disabledNLA||!self.rdParams.askForCredentials||self.rdParams.username!=""&&self.rdParams.password!="")doConnect();else self.authenticateUser({"credentials":{"username":self.rdParams.username,"password":self.rdParams.password}})}setTimeout(function(){callConnect()},150)}})};this.registerDrawCommands=
function(){this.registerDrawCmd("CM",function(cmd,win,context){if(!_playbackStarted){self.events.onPlaybackStart();_playbackStarted=true}if(self.overrideCursor)self.overrideCursor=false;if(!self.playbackController)self.playbackController=new PlaybackController({"owner":self,"useAjax":function(){return self.useAjax},"getAjaxUrl":"","sendEvent":self.sendEvent,"wsSend":self.wsSend,"id":self.rcParams.id,"onClientUpdate":function(obj){try{self.rcParams.mouseControl=false;if(self.clipboard)self.clipboard.dispose();
if(self.DesktopResize)self.DesktopResize(obj["Settings"]["width"],obj["Settings"]["height"],1);self.center();self.rdParams.viewLeft=0;self.rdParams.viewRight=obj["Settings"]["width"];self.rdParams.viewTop=0;self.rdParams.viewBottom=obj["Settings"]["height"];self.rdParams.viewWidth=obj["Settings"]["width"];self.rdParams.viewHeight=obj["Settings"]["height"];self.rdParams.maxWidth=obj["Settings"]["width"];self.rdParams.maxHeight=obj["Settings"]["height"];self.rdParams.resolution=obj["Settings"]["width"]+
"x"+obj["Settings"]["height"];self.rcParams.width=obj["Settings"]["width"];self.rcParams.height=obj["Settings"]["height"];self.rcParams.resolution=self.rdParams.resolution;self.zoomDesktop()}catch(err){console.log(err)}},"onMouseUpdate":function(m){self.display.manager.processDisplayCmd("PLAYBACK_MOUSE_MOVE",m.mon||0,m)}});self.playbackController.update(cmd.code,cmd.text)});this.registerDrawCmd("PC",function(cmd,win,context){var plugin=self.serverValues.plugins[cmd.pn];var sp;if(!plugin)plugin=self.serverValues.plugins[cmd.pn]=
{"subplugins":null};if(typeof cmd.spn!="undefined"){if(!plugin.subplugins)plugin.subplugins={};var sp=plugin.subplugins[cmd.dt];if(!sp)sp=plugin.subplugins[cmd.dt]={};sp[cmd.spn]={"dynamic":cmd.d,"enabled":cmd.e}}else{plugin["deviceType"]=cmd.dt;plugin["dynamic"]=cmd.d;plugin["enabled"]=cmd.e}});this.registerDrawCmd("SM",function(cmd,win,context){var smENUM=["debug","info","warning","error","exception","fatal"];if(cmd.k==3){var jData={"action":"alert","data":cmd,"title":thinRDPconsts.productDescription};
fireExternalEvent("onMessage",jData,function(preventExecution){if(preventExecution!==true)if(typeof THIN.rdParams.events=="undefined"||THIN.rdParams.events.onMessage==null)$(window).trigger("printDialog",jData);else if(THIN.rdParams.events.onMessage(jData)!==true)Thinfinity.Popups.alert(cmd.m,thinRDPconsts.productDescription,"","","","",false)})}else helper.console.log("ServerMessage - [kind: "+smENUM[cmd.k]+", code: "+cmd.e+", message: '"+cmd.m+"']")})};this.completeConnection=function(){if(agentInfo.isMobile&&
!self.rdParams.forceDesktop){self.maxWidth=self.rcParams.width;self.maxHeight=self.rcParams.height;self.rcParams.hookKeyboard=false;self.rcParams.scaled=false;mouseInstance=new Thinfinity.Mobile;mouseInstance.initMobile(self,true,{onServerConnecting:self.events.onServerConnecting,onSessionEnd:self.events.onSessionEnd,onServerConnectionError:self.events.onServerConnectionError,onServerError:self.events.onServerError,onServerConnect:self.events.onServerConnect,onServerDisconnect:self.events.onServerDisconnect,
onServerCommandResult:self.events.onServerCommandResult,onSessionStart:self.events.onSessionStart});mouseInstance.initTouchDevice()}if(self.__proto__==null)self.__proto__=Object.getPrototypeOf(self);self.__proto__.init.call(self,{scraper:self.rdParams.scraper,scraperArgs:self.buildArgs(self.rdParams,_resolutionModeEnum.JSON)})};function doConnect(avoidConnect){self.gettingCredentials=false;fireExternalEvent("onServerConnecting",null,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onServerConnecting)self.rdParams.events.onServerConnecting({"reconnecting":false});
else $(window).trigger("establishingConnection")});self.applyParams({"scraper":self.rdParams.scraper,"scraperArgs":self.buildArgs(self.rdParams,_resolutionModeEnum.JSON)});self.pingStop();if(avoidConnect!==true)self.__proto__.connect.call(self)}this.getImgQuality=function(){return self.rdParams.imagequality};this.setImgQuality=function(value){self.rdParams.imagequality=parseInt(value,10);switch(self.rdParams.imagequality){case 0:self.rdParams.imageMethod=1;self.rdParams.quality=100;break;case 1:self.rdParams.imageMethod=
2;self.rdParams.quality=80;break;case 2:self.rdParams.imageMethod=2;self.rdParams.quality=55;break;case 3:self.rdParams.imageMethod=0;self.rdParams.quality=40;break;case 4:self.rdParams.imageMethod=3;self.rdParams.quality=0;break}this.sendCmd("cmd=params&response=false&imagequality="+self.rdParams.imagequality);if(typeof saveConnectionSettings!="undefined")saveConnectionSettings(self)};this.restart=function(w,h,op){self.reset();if(typeof w!="undefined")self.rdParams.width=w;if(typeof h!="undefined")self.rdParams.height=
h;var altArgs="";if(typeof op!="undefined")altArgs+="&op="+op;var args="cmd=start&subcmd=restart"+altArgs+self.buildResolutionArgs();self.start(args)};this.buildResolutionArgs=function(resolutionMode,appendObj){if(typeof resolutionMode=="undefined")resolutionMode=_resolutionModeEnum.QUERY_STRING;var fitMode=appendObj||{};if(typeof this.agentName=="undefined")this.resolveAgent();var screenWidth=window.environment.rawWidth||window.screen.width;var screenHeight=window.environment.rawHeight||window.screen.height;
var w=window.environment.detectedWidth;var h=window.environment.detectedHeight;if(self.rdParams.resolution==ThinRDP.resolution.FIT_TO_BROWSER||self.rdParams.resolution==="fittobrowser")fitMode.fitmode=0;else if(self.rdParams.resolution==ThinRDP.resolution.FIT_TO_SCREEN||self.rdParams.resolution==="fittoscreen")fitMode.fitmode=2;else if(self.rdParams.resolution==ThinRDP.resolution.CUSTOM){w=self.rdParams.width;h=self.rdParams.height;fitMode.fitmode=1}else if(self.rdParams.resolution.indexOf("x")>0){fitMode.fitmode=
1;var res=self.rdParams.resolution.split("x");w=res[0];h=res[1]}fitMode.browserWidth=w;fitMode.browserHeight=h;fitMode.screenWidth=screenWidth;fitMode.screenHeight=screenHeight;return resolutionMode===_resolutionModeEnum.QUERY_STRING?helper.object.jsonToString(fitMode):fitMode};this.buildArgs=function(params,resolutionMode){if(typeof resolutionMode==undefined)resolutionMode=_resolutionModeEnum.QUERY_STRING;var buildedArgs={};if(self.rdParams.profileKey){buildedArgs.profileKey=self.rdParams.profileKey;
if(self.rdParams.profilePass)buildedArgs.profilePass=self.rdParams.profilePass;this.buildResolutionArgs(resolutionMode.JSON,buildedArgs);if(self.rdParams.computer!=null)buildedArgs.rdpcomputer=self.rdParams.computer;if(self.rdParams.username!="")buildedArgs.rdpusername=self.rdParams.username;if(self.rdParams.password!="")buildedArgs.rdppassword=self.rdParams.password;if(self.rdParams.credsave)buildedArgs.rdpcredsave=self.rdParams.credsave;if(customSettings&&typeof customSettings.noSaveCredentials!=
"undefined")self.rdParams.credsave=!customSettings.noSaveCredentials;if(self.rdParams.credentials!="")buildedArgs.credentials=self.rdParams.credentials;if(self.rdParams.savesession!="")buildedArgs.savesession=self.rdParams.savesession;if(typeof self.rdParams.playsession!="undefined"&&self.rdParams.playsession!=null)buildedArgs.playsession=self.rdParams.playsession;if(self.rdParams.disableNLA!="")buildedArgs.rdpdisablenla=self.rdParams.disableNLA;if(self.rdParams.forceTLSVersion!=null&&self.rdParams.forceTLSVersion!=
"")buildedArgs.rdptlsversion=self.rdParams.forceTLSVersion;if(self.rdParams.destType!=""){self.rdParams.destType=self.rdParams.destType.toUpperCase();if(self.rdParams.destType=="VMID"){buildedArgs.rdpdesttype=self.rdParams.destType;buildedArgs.rdpdestinfo=self.rdParams.destInfo}else if(self.rdParams.destType=="RDS"){buildedArgs.rdpdesttype=self.rdParams.destType;buildedArgs.rdpdestinfo=self.rdParams.destInfo}}if(self.rdParams.startprg!=""&&self.rdParams.startprg!="0"){buildedArgs.rdpappmode=self.rdParams.startprg;
if(self.rdParams.command!="")buildedArgs.rdpcommand=self.rdParams.command;if(self.rdParams.showOnStart!="undefined")buildedArgs.showonstart=self.rdParams.showOnStart}if(self.rdParams.timeZone!="")buildedArgs.timezone=self.rdParams.timeZone;if(self.rdParams.kbdMode!="")buildedArgs.rdpkbdmode=self.rdParams.kbdMode;if(typeof self.rdParams.kbdLayout!="undefined"&&self.rdParams.kbdLayout!=1033)buildedArgs.rdpkbdlayout=self.rdParams.kbdLayout;if(self.rdParams.overrideDefaults){buildedArgs.overrideDefaults=
true;if(self.rdParams.directory!="")buildedArgs.rdpdirectory=self.rdParams.directory;if(self.rdParams.cmdargs!="")buildedArgs.rdpcmdargs=self.rdParams.cmdargs;if(typeof params.bpp!="undefined")buildedArgs.bpp=params.bpp;if(typeof params.console!="undefined")buildedArgs.console=params.console;if(typeof params.unicodeKeyboard!="undefined")buildedArgs.rdpkbdunicode=self.rdParams.unicodeKeyboard;if(typeof params.experience!="undefined"){if(typeof params.experience.enableRemoteFx!="undefined")buildedArgs.enablerfx=
self.rdParams.experience.enableRemoteFx;if(typeof params.experience.enableTouchRedirection!="undefined")buildedArgs.entouchredir=self.rdParams.experience.enableTouchRedirection;if(typeof params.experience.desktopbackground!="undefined")buildedArgs.vedesktopbackground=self.rdParams.experience.desktopbackground;if(typeof params.experience.visualstyles!="undefined")buildedArgs.vevisualstyles=self.rdParams.experience.visualstyles;if(typeof params.experience.menuwindowanimation!="undefined")buildedArgs.vemnuwndanimation=
self.rdParams.experience.menuwindowanimation;if(typeof params.experience.fontsmoothing!="undefined")buildedArgs.vefontsmoothing=self.rdParams.experience.fontsmoothing;if(typeof params.experience.showwindowcontent!="undefined")buildedArgs.veshowwndcontent=self.rdParams.experience.showwindowcontent;if(typeof params.experience.desktopcomposition!="undefined")buildedArgs.vedesktopcomposition=self.rdParams.experience.desktopcomposition}if(typeof params.clipboard!="undefined")buildedArgs.clipboard=params.clipboard;
if(typeof params.reconnectOnResize!="undefined")buildedArgs.reconnectonresize=params.reconnectOnResize;if(typeof params.resizeDesktop!="undefined")buildedArgs.resizedesktop=params.resizeDesktop;if(typeof params.printer!="undefined"){if(typeof params.printer.enabled!="undefined")buildedArgs.prnenabled=params.printer.enabled;if(typeof params.printer.setasdefault!="undefined")buildedArgs.prnsetasdefault=params.printer.setasdefault;if(typeof params.printer.name!="undefined"&&self.rdParams.printer.name)buildedArgs.prnname=
params.printer.name;if(typeof params.printer.driver!="undefined"&&self.rdParams.printer.driver)buildedArgs.prndriver=params.printer.driver}if(typeof params.disk!="undefined"){if(typeof params.disk.enabled!="undefined")buildedArgs.diskenabled=params.disk.enabled;if(typeof params.disk.name!="undefined"&&self.rdParams.disk.name)buildedArgs.diskname=params.disk.name;if(typeof params.disk.autodownload!="undefined")buildedArgs.autodownload=params.disk.autodownload}if(typeof params.sound!="undefined")if(typeof params.sound.enabled!=
"undefined"){if(params.sound.enabled)params.sound.enabled=self.availableAudio;buildedArgs.sndenabled=params.sound.enabled;if(params.sound.enabled&&typeof params.sound.quality!="undefined")buildedArgs.sndquality=params.sound.quality.toString()}}}else{if(!self.rdParams.profileKey||self.rdParams.computer){if(self.rdParams.computer!="")buildedArgs.rdpcomputer=self.rdParams.computer;if(self.rdParams.width*self.rdParams.height>0)self.buildResolutionArgs(resolutionMode.JSON,buildedArgs);if(self.rdParams.username!=
"")buildedArgs.rdpusername=self.rdParams.username;if(self.rdParams.password!="")buildedArgs.rdppassword=self.rdParams.password;if(self.rdParams.credentials!="")buildedArgs.credentials=self.rdParams.credentials;if(self.rdParams.savesession!="")buildedArgs.savesession=self.rdParams.savesession;if(typeof self.rdParams.playsession!="undefined"&&self.rdParams.playsession!=null)buildedArgs.playsession=self.rdParams.playsession;if(self.rdParams.startprg!=""&&self.rdParams.startprg!="0"){buildedArgs.rdpappmode=
self.rdParams.startprg;if(self.rdParams.command!="")buildedArgs.rdpcommand=self.rdParams.command;if(self.rdParams.directory!="")buildedArgs.rdpdirectory=self.rdParams.directory;if(self.rdParams.cmdargs!="")buildedArgs.rdpcmdargs=self.rdParams.cmdargs;if(self.rdParams.showOnStart!="undefined")buildedArgs.showonstart=self.rdParams.showOnStart}buildedArgs.bpp=self.rdParams.bpp;buildedArgs.console=self.rdParams.console;buildedArgs.vedesktopbackground=self.rdParams.experience.desktopbackground;buildedArgs.vevisualstyles=
self.rdParams.experience.visualstyles;buildedArgs.vemnuwndanimation=self.rdParams.experience.menuwindowanimation;buildedArgs.vefontsmoothing=self.rdParams.experience.fontsmoothing;buildedArgs.veshowwndcontent=self.rdParams.experience.showwindowcontent;buildedArgs.vedesktopcomposition=self.rdParams.experience.desktopcomposition;buildedArgs.rdpkbdunicode=self.rdParams.unicodeKeyboard;if(self.rdParams.kbdLayout&&self.rdParams.kbdLayout!=1033)buildedArgs.rdpkbdlayout=self.rdParams.kbdLayout;if(typeof params.relativeTouch!=
"undefined")buildedArgs.relativetouch=self.rdParams.relativeTouch;if(typeof params.experience!="undefined"){if(typeof params.experience.enableRemoteFx!="undefined")buildedArgs.enablerfx=self.rdParams.experience.enableRemoteFx;if(typeof params.experience.enableTouchRedirection!="undefined")buildedArgs.entouchredir=self.rdParams.experience.enableTouchRedirection}}if(typeof self.rdParams.clipboard!="undefined")buildedArgs.clipboard=self.rdParams.clipboard;if(typeof self.rdParams.reconnectOnResize!="undefined")buildedArgs.reconnectonresize=
self.rdParams.reconnectOnResize;if(typeof self.rdParams.resizeDesktop!="undefined")buildedArgs.resizedesktop=self.rdParams.resizeDesktop;if(typeof self.rdParams.disableNLA!="undefined"&&self.rdParams.disableNLA!="")buildedArgs.rdpdisablenla=self.rdParams.disableNLA;if(typeof self.rdParams.forceTLSVersion!="undefined"&&self.rdParams.forceTLSVersion!=null&&self.rdParams.forceTLSVersion!="")buildedArgs.rdptlsversion=self.rdParams.forceTLSVersion;if(typeof self.rdParams.printer.enabled!="undefined"){buildedArgs.prnenabled=
self.rdParams.printer.enabled;if(self.rdParams.printer.enabled){buildedArgs.prnsetasdefault=self.rdParams.printer.setasdefault;if(self.rdParams.printer.name)buildedArgs.prnname=self.rdParams.printer.name;if(self.rdParams.printer.driver)buildedArgs.prndriver=self.rdParams.printer.driver}}if(typeof self.rdParams.disk.enabled!="undefined"){buildedArgs.diskenabled=self.rdParams.disk.enabled;if(self.rdParams.disk.enabled&&self.rdParams.disk.name)buildedArgs.diskname=self.rdParams.disk.name;if(self.rdParams.disk.enabled&&
self.rdParams.disk.autodownload!="undefined")buildedArgs.autodownload=self.rdParams.disk.autodownload}if(typeof self.rdParams.sound.enabled!="undefined"){if(params.sound.enabled)params.sound.enabled=self.availableAudio;buildedArgs.sndenabled=self.rdParams.sound.enabled;if(self.rdParams.sound.enabled&&self.rdParams.sound.quality)buildedArgs.sndquality=self.rdParams.sound.quality}if(typeof self.rdParams.uniqueBrowserId!="undefined")buildedArgs.uniqueBrowserId=self.rdParams.uniqueBrowserId}buildedArgs.supportsRFXDecoder=
agentInfo.supportsRFXDecoder;buildedArgs.tcpReadCount=self.rdParams.tcpReadCount;buildedArgs.tcpReadWait=self.rdParams.tcpReadWait;buildedArgs.filterCmds=self.rdParams.filterCmds;buildedArgs.canLogout=self.rdParams.canLogout;if(self.rdParams.printerList)buildedArgs.printerList=self.rdParams.printerList;if(typeof self.rdParams.universalPrinter!="undefined")buildedArgs.universalPrinter=self.rdParams.universalPrinter;buildedArgs.browserTouchCapable=1;buildedArgs.browserMaxTouchPoints=5;if(typeof self.rdParams.playThisRDSession!=
"undefined")buildedArgs.playThisRDSession=self.rdParams.playThisRDSession;if(self.rdParams.rfsMountPoints!=null)buildedArgs.rfsMountPoints=self.rdParams.rfsMountPoints;return resolutionMode===_resolutionModeEnum.QUERY_STRING?helper.object.jsonToString(buildedArgs):buildedArgs};this.buildTargetName=function(){var d=new Date;return"RDPCONN_"+(d.getFullYear()*1E4+d.getMonth()*100+d.getDate()).toString(16).toUpperCase()+"_"+(d.getHours()*360+d.getMinutes()*60+d.getSeconds()).toString(16).toUpperCase()};
this.buildForm=function(){var form=document.getElementById("ThinRDPForm");if(!form){form=helper.dom.appendJsonElement({"parentElement":document.body,"type":"form","attributes":{"id":"ThinRDPForm","name":"ThinRDPForm","method":"POST"}});helper.dom.appendJsonElement({"parentElement":form,"type":"input","attributes":{"id":"credentials","name":"credentials","type":"hidden","value":""}});helper.dom.appendJsonElement({"parentElement":form,"type":"input","attributes":{"id":"brokerData","name":"brokerData",
"type":"hidden","value":""}});helper.dom.appendJsonElement({"parentElement":form,"type":"input","attributes":{"id":"data","name":"data","type":"hidden","value":""}})}return form};this.getOwnReference=function(callback){if(callback)callback(self)};this.callDisconnect=function(silent){if(silent===true)self.disconnect();else fireExternalEvent("onQueryDisconnect",null,function(preventExecution){if(preventExecution!==true)if(self.rdParams.events.onQueryDisconnect)self.rdParams.events.onQueryDisconnect(self.doDisconnect);
else self.disconnect()})};this.doDisconnect=function(){var dologout=document.getElementById("dologout");self.rdParams.canLogout=dologout?dologout.checked:false;self.disconnect()};this.createRow=function(container,title,value){var row=helper.dom.appendJsonElement({"parentElement":container,"type":"div","attributes":{"class":"row"}});helper.dom.appendJsonElement({"parentElement":row,"type":"div","attributes":{"class":"colLabel"},"content":title+":"});helper.dom.appendJsonElement({"parentElement":row,
"type":"div","attributes":{"class":"colData"},"content":value})};this.showEnvironmentData=function(){var aValues={"Allow clipboard":self.rdParams.clipboard.toString(),"Auto download new files":(self.rdParams.disk.enabled?self.rdParams.disk.autodownload:false).toString(),"Base URL":self.baseUrl,"Bits per pixels":self.rdParams.bpp,"Client ACK":self.rdParams.clientAck,"Connection name":self.rdParams.connectionName,"Console mode":self.rdParams.console.toString(),"Disable NLA":self.rdParams.disableNLA.toString(),
"Force TLS Version":self.rdParams.forceTLSVersion?self.rdParams.forceTLSVersion.toString():"","Disk":self.rdParams.disk.enabled?"Enabled ("+self.rdParams.disk.name+")":"Disabled","File transfer path":self.serverValues.ftPath,"Fit to Browser":self.rdParams.fitToBrowser.toString(),"Force desktop":self.rdParams.forceDesktop.toString(),"Image Method":self.rdParams.imageMethod,"Image Quality":["Highest","Optimum","Good","Fastest"][self.getImgQuality()],"Is cross domain":self.rdParams.isCrossDomain.toString(),
"One time URL session":self.isOTURLSession.toString(),"Quality &amp; RLE Threshold":self.rdParams.quality+", "+self.rdParams.rleThreshold,"RemoteFX enabled":agentInfo.supportsRFXDecoder?self.serverValues.rfxEnabled.toString():"Not supported by browser","Run remote":_runRemote.toString(),"Save session":self.rdParams.savesession.toString(),"Sound":self.rdParams.sound.enabled?"Enabled, quality = "+self.rdParams.sound.quality:"Disabled","Touch redirection enabled":!self.rdParams.experience?"false":self.rdParams.experience.enableTouchRedirection.toString(),
"Unicode keyboard":self.rdParams.unicodeKeyboard,"Use Ajax":self.useAjax.toString(),"WS compression":(self.rdParams.wscompression==1).toString()};var container=helper.dom.createJsonElement({"type":"div"});for(var p in aValues)this.createRow(container,p,aValues[p]);var jData={"action":"info","title":"Info","message":thinRDPconsts.wEnvironmentData,"data":aValues};fireExternalEvent("onMessage",jData,function(preventExecution){if(preventExecution!==true)if(typeof THIN.rdParams.events=="undefined"||THIN.rdParams.events.onMessage==
null)$(window).trigger("printDialog",jData);else if(THIN.rdParams.events.onMessage(jData)!==true)Thinfinity.Popups.choice(null,"","wEnvironmentData"," ",thinRDPconsts.wEnvironmentData,container,[consts.ok+":selected"],"","",false,false)})};this.getTrafficData=function(){this.sendServerCmd("cmd","cmd=stats")};this.showTrafficData=function(obj){var aValues={"HTTP bytes sent":obj.webBytesSend,"HTTP bytes received":obj.webBytesRecv,"Web packages sent":obj.webPackageSend,"Web packages received":obj.webPackageReceive,
"RDP bytes sent":obj.rdpSend,"RDP bytes received":obj.rdpRecv};var container=helper.dom.createJsonElement({"type":"div"});for(var p in aValues)this.createRow(container,p,aValues[p]);var jData={"action":"info","title":"Info","message":thinRDPconsts.wTrafficData,"data":aValues};fireExternalEvent("onMessage",jData,function(preventExecution){if(preventExecution!==true)if(typeof THIN.rdParams.events=="undefined"||THIN.rdParams.events.onMessage==null)$(window).trigger("printDialog",jData);else if(THIN.rdParams.events.onMessage(jData)!==
true)Thinfinity.Popups.choice(null,"","wTrafficData"," ",thinRDPconsts.wTrafficData,container,[consts.ok+":selected"],"","",false,false)})};this.hostToName=function(){return self.baseUrl.replace(/[\.:\/]/g,"")};this.attachCredentialsPopup=function(data,authenticationCallback){function process(popupData){self.credPopup=popupData;self.refreshCredentialsPopup(data);$("#signInBtn").bind("click",function(){self.completeAuthentication()});$("#cancelSingInBtn").bind("click",function(){self.cancelAuthentication()});
$("#credentialsDialog").bind("keydown",function(e){switch(e.keyCode){case 13:self.completeAuthentication();break;case 27:self.cancelAuthentication();break}});if(authenticationCallback)authenticationCallback()}var popupData=document.getElementById("credentialsDialog");if(popupData)process(popupData);else self.loadCredentialsDialog(process)};this.refreshCredentialsPopup=function(data){self.credPopup.querySelector("#authusername").value=data?.credentials?.username??"";if(customSettings?.noSaveCredentials===
true){document.getElementById("saveCredentials").checked=false;document.getElementById("saveCredRow").style.setProperty("display","none")}else if(data?.credentials?.save)self.credPopup.querySelector("#saveCredRow").style.display="table-row";self.setAuthMessage(data.message||data.msg||"")};this.setAuthMessage=function(message){if(!message)$("#authErrMessage").html("").addClass("hidden");else $("#authErrMessage").html(message).removeClass("hidden")};this.completeAuthentication=function(){$(window).unbind("keydown");
self.rdParams.username=document.getElementById("authusername").value;self.rdParams.password=document.getElementById("authpassword").value;self.rdParams.credsave=document.getElementById("saveCredentials").checked;document.getElementById("authusername").value="";document.getElementById("authpassword").value="";Thinfinity.Popups.unblockDialogs();if(this.android){window.scroll(0,1);this.tempHeight=$(window).height();window.setTimeout(function(){self.completeConnectionDeferred()},500)}else doConnect()};
this.cancelAuthentication=function(){$(window).unbind("keydown");document.getElementById("authusername").value="";document.getElementById("authpassword").value="";Thinfinity.Popups.unblockDialogs();disposeView();processRDPCrossMessages("onLoginCancel",null);if(self.rdParams.events.onLoginCancel)self.rdParams.events.onLoginCancel();else $(window).trigger("LoginCancel")};this.completeConnectionDeferred=function(){if(this.tempHeight!=$(window).height()){this.tempHeight=$(window).height();window.setTimeout(function(){self.completeConnectionDeferred()},
10)}else doConnect()};this.sendCustomShortcut=function(keys){for(var k=0;k<keys.length;k++)if(keys[k].action=="down")self.sendKeyDown(keys[k].key);else if(keys[k].action=="up")self.sendKeyUp(keys[k].key);else if(keys[k].action=="type")self.sendText(keys[k].text);else if(keys[k].action=="fkey")self.sendFunctionKey(keys[k].key);else self.sendKeyStroke(keys[k].key)};function processRDPCrossMessages(cmd,obj,gui){if(obj&&rdpView.linkageConnection.isConnected)rdpView.linkageConnection.commands.sendCrossEvent({"cmd":cmd,
"data":JSON.parse(JSON.stringify(obj)),"gui":gui});else self.responseCrossMessage({"gui":gui,"preventExecution":false})}this.responseCrossMessage=function(data){if(data&&data.gui&&_fireExternalEvents[data.gui]){_fireExternalEvents[data.gui](data.preventExecution);clearTimeout(_fireExternalEvents[data.gui].expire);delete _fireExternalEvents[data.gui]}};this.receiveCrossEvent=function(data){var preventExecution=false;if(self.rdParams.events[data.cmd]){try{preventExecution=self.rdParams.events[data.cmd](data.data)}catch(error){}if(preventExecution!==
true)preventExecution=false}rdpView.linkageConnection.commands.responseCrossEvent({"gui":data.gui,"preventExecution":preventExecution})};function fireExternalEvent(cmd,data,callback,maxWaitTime){var gui=null;if(typeof self.rdParams.externalEvents!="undefined"&&self.rdParams.externalEvents.indexOf(cmd)!=-1){if(callback){gui=helper.utils.generateGUID(10);_fireExternalEvents[gui]=callback;if(maxWaitTime)_fireExternalEvents[gui].expire=setTimeout(function(){if(_fireExternalEvents[gui]){_fireExternalEvents[gui]("aborted");
delete _fireExternalEvents[data.gui]}},maxWaitTime)}processRDPCrossMessages(cmd,data,gui)}else if(callback)callback(cmd,data)}this.authenticateUser=function(data){function showAuthenticationDialog(){var jData={"action":"needCredentials","data":{"message":data},"title":thinRDPconsts.productDescription};fireExternalEvent("onMessage",jData,function(preventExecution){if(preventExecution!==true)if(typeof THIN.rdParams.events=="undefined"||THIN.rdParams.events.onMessage==null)$(window).trigger("printDialog",
jData);else if(THIN.rdParams.events.onMessage(jData)!==true){var popup=new Thinfinity.Popups.popup;popup.block("credentialsDialog",$(self.credPopup),null,focusAuthenticationField,null)}})}this.gettingCredentials=true;if(!this.credPopup)self.attachCredentialsPopup(data,showAuthenticationDialog);else{self.refreshCredentialsPopup(data);showAuthenticationDialog()}};function focusAuthenticationField(){var nameField=document.getElementById("authusername");if(nameField.offsetWidth==0)window.setTimeout(focusAuthenticationField,
10);else if(nameField.value=="")nameField.focus();else document.getElementById("authpassword").focus()}function disposeView(){setTimeout(function(){if(rdpView){rdpView.linkageConnection.commands.dispose();setTimeout(function(){rdpView=null},500)}},150)}function suppressMouseTouchEvent(e){try{if(window["TouchEvent"]&&e&&e instanceof TouchEvent){if(e.preventDefault)e.preventDefault();if(e.stopPropagation)e.stopPropagation()}}catch(err){helper.console.warning("[suppressMouseTouchEvent] Failed while trying to handle touch and mouse events. ",
arguments)}}this.fileUpload={maxUploadCount:3,toUpload:0,uploaded:0,nextUploadIdx:0,uploading:0,uploadErrors:null,filesUploading:null,uploadErrors:null,onClear:null,onFileAdd:null,onUploadFinish:null,progressBar:null,progressContainerID:"FUProgressContainer",init:function(startDrag){this.clear();if(typeof startDrag=="undefined")startDrag=true;if(startDrag&&window.File&&window.FileReader&&window.FileList&&window.Blob)self.dragDrop.init(startDrag)},clear:function(){this.toUpload=0;this.uploaded=0;this.nextUploadIdx=
0;this.uploading=0;this.filesUploading=new Array;if(this.progressBar!=null){for(var pb=0;pb<this.progressBar.length;pb++)if(this.progressBar[pb]){this.progressBar[pb].remove();delete this.progressBar[pb]}var fupc=document.getElementById(this.progressContainerID);if(fupc)fupc.parentElement.removeChild(fupc);document.getElementById("fileToUpload").form.reset()}this.progressBar=null;if(this.onClear)this.onClear()},add:function(file){for(var i=0;i<this.filesUploading.length;i++)if(this.filesUploading[i]&&
this.filesUploading[i].name==file.name)return;this.filesUploading=this.filesUploading.concat(file);if(this.onFileAdd)this.onFileAdd(file)},getFilenames:function(){if(!this.filesUploading)return"";else{var names=[];for(var f=0;f<this.filesUploading.length;f++)if(this.filesUploading[f])names.push(this.filesUploading[f].name);return names.join(",")}},filesToUploadCount:function(){var count=0;for(var i=0;i<this.filesUploading.length;i++)if(this.filesUploading[i])count++;return count},startNextUploads:function(){var startFrom=
this.nextUploadIdx;for(var i=startFrom;i<this.filesUploading.length;i++){if(this.uploading>=this.maxUploadCount)break;if(!this.filesUploading[i])continue;this.uploadFile(this.filesUploading[i],i);this.nextUploadIdx++;this.uploading++}},startUploading:function(){if(this.uploading==0){this.uploaded=0;this.nextUploadIdx=0;this.uploadErrors=new Array}this.toUpload=this.filesToUploadCount();for(var i=0;i<this.filesUploading.length;i++)if(this.filesUploading[i])this.addProgress(this.filesUploading[i],i);
this.startNextUploads()},uploadFile:function(file,idx){if(typeof FormData!="undefined"){var fd=new FormData;fd.append("fileToUpload",file);helper.ajax.post({"url":self.httpConnection+"ft/"+(self.serverValues.ftPath!=""?self.serverValues.ftPath+"/":"")+"\\"+encodeURIComponent(file.name)+(self.serverValues.diskName==""?"":"?diskname="+self.serverValues.diskName),"beforeSend":function(xhr){if(typeof window.addEventListener!="undefined"){xhr.upload.addEventListener("progress",function(evt){if(!self.fileUpload.uploadProgress(evt,
file,idx))xhr.abort()},false);xhr.addEventListener("load",function(evt){self.fileUpload.uploadComplete(evt,file,idx)},false);xhr.addEventListener("error",function(evt){self.fileUpload.uploadFailed(evt,file,idx)},false);xhr.addEventListener("abort",function(evt){self.fileUpload.uploadCanceled(evt,file,idx)},false)}else if(typeof window.attachEvent!="undefined"){xhr.upload.attachEvent("progress",function(evt){if(!self.fileUpload.uploadProgress(evt,file,idx))xhr.abort()},false);xhr.attachEvent("load",
function(evt){self.fileUpload.uploadComplete(evt,file,idx)});xhr.attachEvent("error",function(evt){self.fileUpload.uploadFailed(evt,file,idx)});xhr.attachEvent("abort",function(evt){self.fileUpload.uploadCanceled(evt,file,idx)})}xhr.setRequestHeader("X-Request-Condition","no-webdav");xhr.setRequestHeader("X-Request-Sanitize","false")},"data":fd,"timeout":0})}else{var ulFrame=document.getElementById("upload_frame");ulFrame.onload=function(evt){self.fileUpload.uploadComplete(evt,file,idx)};var fuForm=
document.getElementById("_fuForm");fuForm.action=self.httpConnection+"ft/"+(self.serverValues.ftPath!=""?self.serverValues.ftPath+"/":"")+"\\"+(typeof file.name=="undefined"?file.split(/(\\|\/)/g).pop():file.name)+"?reqcondition=no-webdav"+(self.serverValues.diskName==""?"":"&diskname="+self.serverValues.diskName);fuForm.submit()}},getFilename:function(file){if(typeof file=="undefined")return"";if(typeof file.name!="undefined")return file.name;return file.replace(/C:\\fakepath\\/i,"")},uploadProgress:function(evt,
file,idx){self.__recvPingResponse();if(!this.progressBar||!this.progressBar[idx]){logDebug("uploadProgress: adding missing progressBar.");self.fileUpload.addProgress(file,idx);this.filesUploading[idx]=file;this.toUpload=this.filesToUploadCount();this.uploading++;if(this.nextUploadIdx<=idx)this.nextUploadIdx=idx+1}if(evt.lengthComputable){var pc=parseInt(evt.loaded/evt.total*100);this.progressBar[idx].maxValue=100;this.progressBar[idx].setPos(pc)}else{this.progressBar[idx].maxValue=0;this.progressBar[idx].setMessage(thinRDPconsts.uploading);
if(typeof this.progressBar[idx].firstTime=="undefined"){this.progressBar[idx].firstTime=true;helper.console.warning("Unable to compute progress");console.log(file);console.log(evt)}}return true},uploadComplete:function(evt,file,idx){var fu=self.fileUpload;var src=evt.sourceElement||evt.target;if(src&&src.status!=200)if(!src.responseXML)if(typeof src.readyState=="undefined"||src.readyState!="complete"){fu.uploadFailed(evt,file,idx);return}else this.progressBar[idx].setPos(100);else if(!src.responseText.match(/200 OK/)){fu.uploadFailed(evt,
file,idx);return}if(self.rdParams&&self.rdParams.events.onUploadComplete)self.rdParams.events.onUploadComplete();else $(window).trigger("uploadComplete");logDebug("uploadComplete "+idx);fu.uploading--;fu.uploaded++;if(fu.uploaded==fu.toUpload)fu.uploadFinish();else fu.startNextUploads()},uploadFailed:function(evt,file,idx){var fu=self.fileUpload;if(self.rdParams.events.onUploadFailed)self.rdParams.events.onUploadFailed();else $(window).trigger("uploadFailed",evt);var src=evt.sourceElement||evt.target;
var sError=helper.string.sprintf("Error %s (%s) uploading '%s'",src.status,src.statusText,file.name);fu.uploadErrors.push(sError);logDebug("upload failed "+idx+": "+sError);this.progressBar[idx].setClass("failed");fu.uploading--;fu.uploaded++;if(fu.uploaded==fu.toUpload)fu.uploadFinish();else fu.startNextUploads()},uploadCanceled:function(evt,file,idx){var fu=self.fileUpload;if(self.rdParams.events.onUploadCanceled)self.rdParams.events.onUploadCanceled();else $(window).trigger("uploadCanceled");logDebug("upload canceled "+
idx);if(!this.progressBar||!this.progressBar[idx]){logError("uploadCanceled: progressBar not assigned.");return}this.progressBar[idx].setClass("failed");fu.uploading--;fu.uploaded++;if(fu.uploaded==fu.toUpload)fu.uploadFinish();else fu.startNextUploads()},uploadFinish:function(){if(this.onUploadFinish)this.onUploadFinish(this);else{function clearFileUpload(){self.fileUpload.clear();Thinfinity.Popups.unblock()}var jData={"action":"uploadFinish","message":this.uploadErrors.length==0?thinRDPconsts.uploadCompleted:
thinRDPconsts.uploadCompletedWithErrors,"title":thinRDPconsts.productDescription,"response":{"callback":function(){clearFileUpload()}}};fireExternalEvent("onMessage",jData,function(preventExecution){if(preventExecution!==true)if(typeof THIN.rdParams.events=="undefined"||THIN.rdParams.events.onMessage==null)$(window).trigger("printDialog",jData);else if(THIN.rdParams.events.onMessage(jData)!==true)Thinfinity.Popups.alert(jData.message,thinRDPconsts.productDescription,"disconnectedDlg","","",clearFileUpload,
false)},2E3)}},progressContainer:function(){var fuc=document.getElementById(this.progressContainerID);if(!fuc)fuc=helper.dom.appendJsonElement({"parentElement":document.body,"type":"div","attributes":{"id":this.progressContainerID}});return fuc},addProgress:function(file,idx){if(!this.progressBar)this.progressBar=new Array;for(var pb of this.progressBar)if(pb&&pb.fileName==file.name)return;var fuc=this.progressContainer();var pb=new ProgressBar({"id":this.progressContainerID,"idx":idx,"fileName":file.name,
"background-color":"#FF0","barHeight":"20px","mask":"<span class='upfilename'>"+file.name+" ("+this.formatedSize(file.size)+")</span><span class='upfilepercent'>$d%</span>"});pb.init();pb.setMessage(file.name+" ("+this.formatedSize(file.size)+")");this.progressBar[idx]=pb},formatedSize:function(val){var unit=" KB";if(val>1048576){val=val/1048576;unit=" MB"}else val=val/1024;return Math.ceil(val*100)/100+unit}},this.dragDrop={disabled:false,initialized:false,init:function(autoStart){if(this.disabled)return;
if(typeof autoStart=="")autoStart=true;if(autoStart)this.start()},start:function(){if(this.disabled)return;if(this.initialized)return;var deskDiv=document.body;if(typeof window.addEventListener!="undefined"){deskDiv.addEventListener("dragenter",this.dragEnter,false);deskDiv.addEventListener("dragleave",this.dragLeave,false);deskDiv.addEventListener("dragover",this.noopHandler,false);deskDiv.addEventListener("drop",this.drop,false)}else;this.initialized=true},stop:function(){var deskDiv=document.body;
if(typeof window.removeEventListener!="undefined"){deskDiv.removeEventListener("dragenter",this.dragEnter,false);deskDiv.removeEventListener("dragleave",this.dragLeave,false);deskDiv.removeEventListener("dragover",this.noopHandler,false);deskDiv.removeEventListener("drop",this.drop,false)}else;this.initialized=false},noopHandler:function(evt){evt.stopPropagation();evt.preventDefault()},dragEnter:function(evt){},dragLeave:function(evt){},drop:function(evt){Thinfinity.Popups.unblockDialogs();self.dragDrop.noopHandler(evt);
var files=evt.dataTransfer.files;if(files.length>0){for(var i=0;i<files.length;i++)self.fileUpload.add(files[i]);self.fileUpload.startUploading()}}},this.downloadList={files:null,selCount:0,rowOver:function(obj){$(obj).addClass("downloadRowOver")},rowOut:function(obj){$(obj).removeClass("downloadRowOver")},rowClick:function(obj,file){if(!!file.selected){file.selected=false;$(obj).removeClass("downloadRowSelected")}else{file.selected=true;$(obj).addClass("downloadRowSelected")}self.downloadList.selCount=
$(".downloadRowSelected").length;if(self.downloadList.isValid())$("#downloadBtnOk").removeClass("disabled");else $("#downloadBtnOk").addClass("disabled")},isValid:function(){if(self.msie)return this.selCount==1;else return this.selCount>0},isImage:function(url){var aName=url.split(".");switch(aName[aName.length-1]){case "jpe":case "jpeg":case "jpg":case "png":case "bmp":case "tif":case "gif":return true;default:return false}},pushFiles:function(arr,data,clip){var prePath=self.serverValues.ftPath==
""?"":self.serverValues.ftPath+"/";for(var idx in data){f=data[idx];if(f.selected)arr.push({download:prePath+f.download,url:f.url,clipboard:clip})}},doDownloadFiles:function(button){if(!self.downloadList.isValid())return false;$(button).addClass("disabled");this.files=new Array;this.pushFiles(this.files,self.downloadList.list.rows,false);self.downloadList.downloadNextFile()},downloadNextFile:function(){if(self.downloadList.files==null)return;var chkSFP=document.getElementById("chkSaveFilePicker");
if(self.downloadList.files.length>0)self.events.onFileDownload([self.downloadList.files.shift()],chkSFP&&chkSFP.checked);else Thinfinity.Popups.unblockDialogs()},list:{clearItems:function(){this.rows=[]},addItem:function(filename,size,date){this.rows.push({filename:filename,size:size,date:date})},formatSize:function(val){var unit=" KB";if(val>1048576){val=val/1048576;unit=" MB"}else val=val/1024;return Math.ceil(val*100)/100+unit},buildTable:function(data,columns){var tableBox=helper.dom.createJsonElement({"type":"div",
"attributes":{"class":"tablebox"}});var htmlTable=helper.dom.appendJsonElement({"parentElement":tableBox,"type":"table"});if(data.length==0){helper.style.add(tableBox,"nodata");var tr=helper.dom.appendJsonElement({"parentElement":htmlTable,"type":"tr"});var td=helper.dom.appendJsonElement({"parentElement":tr,"type":"td","content":thinRDPconsts.driveEmpty})}else{helper.style.add(htmlTable,"headTable");var thead=helper.dom.appendJsonElement({"parentElement":htmlTable,"type":"thead"});var tr=helper.dom.appendJsonElement({"parentElement":thead,
"type":"tr","attributes":{"class":"downloadHeader"}});var th=helper.dom.appendJsonElement({"parentElement":tr,"type":"th","attributes":{"class":"downloadTitle"},"content":columns[0]||""});var th=helper.dom.appendJsonElement({"parentElement":tr,"type":"th","attributes":{"class":"downloadSize"},"content":columns[1]||""});var th=helper.dom.appendJsonElement({"parentElement":tr,"type":"th","attributes":{"class":"downloadDate"},"content":columns[2]||""});var bodyBox=helper.dom.appendJsonElement({"parentElement":tableBox,
"type":"div","attributes":{"class":"bodyBox"}});htmlTable=helper.dom.appendJsonElement({"parentElement":bodyBox,"type":"table","attributes":{"class":"bodyTable"}});var tbody=helper.dom.appendJsonElement({"parentElement":htmlTable,"type":"tbody"});for(var i=0;i<data.length;i++){r=data[i];var tr=helper.dom.appendJsonElement({"parentElement":tbody,"type":"tr","events":{"onmouseover":function(e){self.downloadList.rowOver(e.target.parentElement)},"onmouseout":function(e){self.downloadList.rowOut(e.target.parentElement)},
"ontouchend,onclick":function(e){suppressMouseTouchEvent(e);self.downloadList.rowClick(e.target.parentElement,data[e.target.parentElement.rowIdx])}}});tr.rowIdx=i;helper.dom.appendJsonElement({"parentElement":tr,"type":"td","attributes":{"class":"downloadTitle"},"content":r.filename});helper.dom.appendJsonElement({"parentElement":tr,"type":"td","attributes":{"class":"downloadSize"},"content":this.formatSize(r.size)});helper.dom.appendJsonElement({"parentElement":tr,"type":"td","attributes":{"class":"downloadDate"},
"content":r.date})}}return tableBox}},openDownload:function(){this.list.clearItems();self.sendServerCmd("cmd","cmd=diskfiles")},downloadDialog:function(){var msg=helper.dom.createJsonElement({"type":"div","attributes":{"id":"downloadDialog","class":"popup"}});helper.dom.appendJsonElement({"parentElement":msg,"type":"div","attributes":{"class":"header"},"content":thinRDPconsts.selectDownloadFiles});var tc=helper.dom.appendJsonElement({"parentElement":msg,"type":"div","attributes":{"id":"filesTableCont",
class:this.list.rows.length===0?"empty":""}});tc.appendChild(self.downloadList.list.buildTable(this.list.rows,[thinRDPconsts.thindisk,thinRDPconsts.size,thinRDPconsts.date]));var divbuttons=helper.dom.appendJsonElement({"parentElement":msg,"type":"div","attributes":{"class":"divbuttons"}});var onDownloadClick=function(e){suppressMouseTouchEvent(e);self.downloadList.doDownloadFiles(e.srcElement)};var onCancelClick=function(e){suppressMouseTouchEvent(e);$.unblockUI.call(arguments)};var saveFilePickerContainer=
helper.dom.appendJsonElement({"parentElement":divbuttons,"type":"div","attributes":{"class":"saveFilePickerContainer"}});var ssfp=helper.storage.get(_showSaveFilePickerKey)||false;var chkSFP=helper.dom.appendJsonElement({"parentElement":saveFilePickerContainer,"type":"input","attributes":{"id":"chkSaveFilePicker",type:"checkbox"},events:{"onchange":function(e){helper.storage.set(_showSaveFilePickerKey,this.checked||false)}}});if(ssfp)chkSFP.setAttribute("checked",ssfp);helper.dom.appendJsonElement({"parentElement":saveFilePickerContainer,
"type":"label","attributes":{for:"chkSaveFilePicker","class":""},"content":thinRDPconsts.askToDownload});helper.dom.appendJsonElement({"parentElement":divbuttons,"type":"a","attributes":{"id":"downloadBtnOk","class":"popuplink disabled"},"content":thinRDPconsts.download,"events":{"onclick":onDownloadClick,"ontouchend":onDownloadClick}});helper.dom.appendJsonElement({"parentElement":divbuttons,"type":"a","attributes":{"class":"popuplink selected"},"content":thinRDPconsts.cancel,"events":{"onclick":onCancelClick,
"ontouchend":onCancelClick}});$.blockUI({message:msg,css:{"padding":0,"margin":0,"width":"100%","height":"100%","top":"0px","left":"0px","textAlign":"center",backgroundColor:"transparent",border:"none",cursor:"auto"},centerX:true,centerY:true})}},this.ssnShare={dialogVisible:function(){return document.getElementById("shareDialog")&&parseInt($("#shareDialog").width(),10)!=0},popup:null,shareURL:"",expiration:30,key:"",expirationDate:null,password:"",flags:{},openSsnShare:function(){self.sendServerCmd("cmd",
"cmd=getSsnshare")},getSharing:function(obj){if(this.shareURL=="")self.sendServerCmd("cmd","cmd=setSsnshare&enabled=true&expiration="+this.expiration)},openDialog:function(){if(this.dialogVisible()){$("#urlShare").val(this.shareURL);$("#ssnPassword").val(this.password)}else{var msg=helper.dom.createJsonElement({"type":"div","attributes":{"id":"shareDialog","class":"popup"}});var header=helper.dom.appendJsonElement({"parentElement":msg,"type":"div","attributes":{"class":"header"},"content":thinRDPconsts.shareSession});
var shareDialogCont=helper.dom.appendJsonElement({"parentElement":msg,"type":"div","attributes":{"id":"shareDialogCont"}});var shareDiv=helper.dom.appendJsonElement({"parentElement":shareDialogCont,"type":"div","attributes":{"class":"shareDiv"}});var row=helper.dom.appendJsonElement({"parentElement":shareDiv,"type":"div"});helper.dom.appendJsonElement({"parentElement":row,"type":"label","attributes":{"id":"sharingSessionLegend"},"content":thinRDPconsts.sharingSessionLegend});var table=helper.dom.appendJsonElement({"parentElement":shareDiv,
"type":"div","attributes":{"class":"table"}});row=helper.dom.appendJsonElement({"parentElement":table,"type":"div","attributes":{"class":"table-row"}});helper.dom.appendJsonElement({"parentElement":row,"type":"div","attributes":{"class":"table-cell ssnLabel"},"content":thinRDPconsts.sharingAddress+": "});var inputCell=helper.dom.appendJsonElement({"parentElement":row,"type":"div","attributes":{"class":"table-cell"}});var shareInput=helper.dom.appendJsonElement({"parentElement":inputCell,"type":"input",
"attributes":{"id":"urlShare","type":"text","readOnly":true,"value":this.shareURL}});var shareInputCpyBtn=helper.dom.appendJsonElement({"parentElement":inputCell,"type":"span","attributes":{"id":"shareInputCpyBtn","class":"shareFormBtn thin-copy"}});row=helper.dom.appendJsonElement({"parentElement":table,"type":"div","attributes":{"class":"table-row"}});helper.dom.appendJsonElement({"parentElement":row,"type":"div","attributes":{"class":"table-cell ssnLabel"},"content":thinRDPconsts.password+": "});
inputCell=helper.dom.appendJsonElement({"parentElement":row,"type":"div","attributes":{"class":"table-cell"}});var passInput=helper.dom.appendJsonElement({"parentElement":inputCell,"type":"input","attributes":{"id":"ssnPassword","type":"text","readOnly":true,"value":this.password}});passInputCpyBtn=helper.dom.appendJsonElement({"parentElement":inputCell,"type":"span","attributes":{"id":"passInputCpyBtn","class":"shareFormBtn thin-copy"}});var divbuttons=helper.dom.appendJsonElement({"parentElement":msg,
"type":"div","attributes":{"class":"divbuttons"}});var a=helper.dom.appendJsonElement({"parentElement":divbuttons,"type":"a","attributes":{"class":"popuplink","id":"btnOkShare"},"content":thinRDPconsts.ok});var jData={"action":"shareScreen","message":thinRDPconsts.shareSession,"legend":thinRDPconsts.sharingSessionLegend,"address":this.shareURL,"password":this.password,"title":thinRDPconsts.productDescription,"response":{"callback":function(){self.ssnShare.closeDialog()}}};self.ssnShare.getSharing();
fireExternalEvent("onMessage",jData,function(preventExecution){if(preventExecution!==true)if(typeof THIN.rdParams.events=="undefined"||THIN.rdParams.events.onMessage==null)$(window).trigger("printDialog",jData);else if(THIN.rdParams.events.onMessage(jData)!==true){popup=new Thinfinity.Popups.popup(self);popup.noPropagateEvents=false;popup.block("shareDialog",msg,null,function(){$("#urlShare, #ssnPassword").focus(function(){var $this=$(this);$this.select();$this.mouseup(function(){$this.unbind("mouseup");
return false})});$("#shareInputCpyBtn").click(function(){self.ssnShare.copyContentOf("#urlShare")});$("#passInputCpyBtn").click(function(){self.ssnShare.copyContentOf("#ssnPassword")});helper.dom.addEvent(document.getElementById("btnOkShare"),["touchend","click"],function(e){suppressMouseTouchEvent(e);self.ssnShare.closeDialog()})})}})}},closeDialog:function(){popup.unblock(function(){if(self.KeyboardHandler&&self.KeyboardHandler.kbdInput)self.KeyboardHandler.kbdInput.focus()})},copyContentOf:function(target){$(target).select();
value=function(obj){return obj?obj.toString():""}(window.getSelection());if(navigator.clipboard&&!agentInfo.isFirefox)navigator.clipboard.writeText(value);else try{result=document.execCommand("copy")}catch(err){console.log("Oops, unable to copy")}window.getSelection().removeAllRanges();return false}};this.getRemoteDesktopSize=function(){var div=self.vncdiv;return{"width":div.offsetWidth,"height":div.offsetHeight}};ThinRDPCore.prototype.dragDrop=self.dragDrop;Object.defineProperty(self,"DEFAULT_ICON",
{"enumerable":false,"configurable":false,"get":function(){return _DEFAULTS.ICON}});Object.defineProperty(self,"resizeDesktop",{"enumerable":false,"configurable":false,"writable":false,"value":resizeDesktop});Object.defineProperty(self,"refreshFitToScreen",{"enumerable":false,"configurable":false,"writable":false,"value":refreshFitToScreen});if(_runRemote)rdpView=new Thinfinity.RDPView({"mode":Thinfinity.RDPView.mode.REMOTE,"thinrdp":self});else if(runOptions.mode==ThinRDP.mode.HOST)rdpView=new Thinfinity.RDPView({"mode":Thinfinity.RDPView.mode.HOST,
"thinrdp":self});if(runOptions.events){var observablesEvents=[{"name":"onWidthChange","eventName":"viewWidth","eventType":"changed"},{"name":"onHeightChange","eventName":"viewHeight","eventType":"changed"}];for(var i=0,l=observablesEvents.length;i<l;i++)if(runOptions.events[observablesEvents[i].name]){var evt=observablesEvents[i];rdpView.model.on(evt.eventName,evt.eventType,runOptions.events[evt.name])}}if(_autoConnectMode.indexOf(runOptions.mode)!=-1)self.connect(runOptions);else if(runOptions.success)setTimeout(function(){runOptions.success()},
10);if(!_runRemote)THIN=this;if(runOptions.mode===ThinRDP.mode.API||runOptions.mode===ThinRDP.mode.SKEY)return THIN;else return rdpView.model}function ThinRDPAdminClass(owner){var statsUrl="stats/";var _ref=this;owner=owner||_thinrdp;function getStatistics(query,onsuccess,onerror){sendCommand(owner,statsUrl+"query",query,onsuccess,onerror)}function send(command,query,onsuccess,onerror){sendCommand(owner,statsUrl+command,query,onsuccess,onerror)}Object.defineProperty(_ref,"getStatistics",{"enumerable":true,
"configurable":false,"writable":false,"value":getStatistics});Object.defineProperty(_ref,"sendCommand",{"enumerable":true,"configurable":false,"writable":false,"value":send})}function ThinRDPRecordingsClass(owner){var recordsUrl="RDPSession/";var _ref=this;owner=owner||_thinrdp;function getRecordings(query,onsuccess,onerror){sendCommand(owner,recordsUrl+"GetList",query,onsuccess,onerror)}function deleteRecordings(aItems,onsuccess,onerror){sendCommand(owner,recordsUrl+"delete","items="+aItems.join(","),
onsuccess,onerror)}Object.defineProperty(_ref,"getRecordings",{"enumerable":true,"configurable":false,"writable":false,"value":getRecordings});Object.defineProperty(_ref,"deleteRecordings",{"enumerable":true,"configurable":false,"writable":false,"value":deleteRecordings})}function ThinRDPDetectRemoteFilesystemClass(dontRetry){return;if(self.rdParams.rfsMountPoints!=null)return;var pluginData=null;var params={url:"http://localhost:28444/rfs/mounts",async:!dontRetry,timeout:3E3,cache:false,dataType:"html",
error:function(jqXHR,err){},success:function(data){pluginData=data;self.rdParams.rfsMountPoints=data}};$.ajax(self.completeAjaxParams(params));return pluginData}function getBaseServerUrl(owner){return owner?owner.baseUrl:""}function sendCommand(owner,cmd,query,onsuccess,onerror){var params={url:getBaseServerUrl(owner)+cmd+"?"+query,async:true,cache:false,dataType:"html",error:function(jqXHR,err){if(typeof onerror!="undefined"){if(err=="error")err=jqXHR.statusText;onerror(err)}},success:function(data){if(typeof onsuccess!=
"undefined")onsuccess(data)}};if(owner&&owner.completeAjaxParams)params=owner.completeAjaxParams(params);$.ajax(params)}function post(path,params,method){method=method||"post";var form=document.createElement("form");form.setAttribute("method",method);form.setAttribute("action",path);for(var key in params)if(params.hasOwnProperty(key)){var hiddenField=document.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",params[key]);
form.appendChild(hiddenField)}document.body.appendChild(form);form.submit()}try{initialize()}catch(e){if(runOptions&&runOptions.failure)runOptions.failure(e.message);else throw new Error(e.message);}if(!ThinRDP.Admin)Object.defineProperty(ThinRDP,"Admin",{"enumerable":true,"configurable":false,"get":function(){return ThinRDPAdminClass}});if(!ThinRDP.Recordings)Object.defineProperty(ThinRDP,"Recordings",{"enumerable":true,"configurable":false,"get":function(){return ThinRDPRecordingsClass}});return _thinrdp}
var _edition=helper.object.createEnum({"SMALL_BUSINESS":0,"STANDARD":1,"ENTERPRISE":2,"CLOUD":3});var _modeEnum=helper.object.createEnum({"HOST":0,"API":1,"SKEY":2,"OTURL":10,"SDK":11});var _TLSVersions=helper.object.createEnum("NEGOTIATE","TLS_V1_0","TLS_V1_1","TLS_V1_2","TLS_V1_3");var _credentialsModes=helper.object.createEnum("USE_AUTH","ASK","USE_DEFINED");var _applicationActions=helper.object.createEnum("NONE","START_PROGRAM","RUN_REMOTEAPP");var _profileTypes=helper.object.createEnum("PUBLIC",
"PRIVATE","MRU","TEMP","FILTER","WEBMANAGER");var _profileKind=helper.object.createEnum("RDP","WEBLINK","RDWEB","RDWEBAPP","RDPLABEL");var _resolution=helper.object.createEnum("CUSTOM","FIT_TO_BROWSER","FIT_TO_SCREEN","640x480","800x600","1024x768","1280x720","1280x768","1280x1024","1440x900","1440x1050","1600x1200","1680x1050","1920x1080","1920x1200");var _imageQuality=helper.object.createEnum("HIGHEST","OPTIMUM","GOOD","FASTEST");var _soundQuality=helper.object.createEnum("HIGHEST","OPTIMUM","GOOD",
"FASTEST");var _bpp=helper.object.createEnum("LOW_COLOR","HIGH_COLOR15","HIGH_COLOR","TRUE_COLOR24","TRUE_COLOR32");var _visualEffect=helper.object.createEnum({"DESKTOP_BACKGROUND":1,"VISUAL_STYLES":2,"MENU_WND_ANIMATION":4,"FONT_SMOOTHING":8,"SHOW_WND_CONTENT":16,"DESKTOP_COMPOSITION":32});var _registeredPlugins={};function registerPlugin(name,plugin){var rname="";if(name)rname=name.toUpperCase();if(_registeredPlugins[rname]==undefined){_registeredPlugins[rname]={"plugin":plugin,"name":name};if(!ThinRDP[name])ThinRDP[name]=
plugin}}function unregisterPlugin(name){if(name)name=name.toUpperCase();if(_registeredPlugins[name]!=undefined){var rname=_registeredPlugins[name].name;delete _registeredPlugins[name];if(ThinRDP[rname])delete ThinRDP[rname]}}Object.defineProperty(ThinRDP,"registerPlugin",{"enumerable":false,"configurable":false,"writable":false,"value":registerPlugin});Object.defineProperty(ThinRDP,"unregisterPlugin",{"enumerable":false,"configurable":false,"writable":false,"value":unregisterPlugin});Object.defineProperty(ThinRDP,
"mode",{"enumerable":true,"configurable":false,"get":function(){return _modeEnum}});Object.defineProperty(ThinRDP,"TLSVersion",{"enumerable":true,"configurable":false,"get":function(){return _TLSVersions}});Object.defineProperty(ThinRDP,"credential",{"enumerable":true,"configurable":false,"get":function(){return _credentialsModes}});Object.defineProperty(ThinRDP,"profileType",{"enumerable":true,"configurable":false,"get":function(){return _profileTypes}});Object.defineProperty(ThinRDP,"profileKind",
{"enumerable":true,"configurable":false,"get":function(){return _profileKind}});Object.defineProperty(ThinRDP,"applicationAction",{"enumerable":true,"configurable":false,"get":function(){return _applicationActions}});Object.defineProperty(ThinRDP,"resolution",{"enumerable":true,"configurable":false,"get":function(){return _resolution}});Object.defineProperty(ThinRDP,"imageQuality",{"enumerable":true,"configurable":false,"get":function(){return _imageQuality}});Object.defineProperty(ThinRDP,"soundQuality",
{"enumerable":true,"configurable":false,"get":function(){return _soundQuality}});Object.defineProperty(ThinRDP,"colorDepth",{"enumerable":true,"configurable":false,"get":function(){return _bpp}});Object.defineProperty(ThinRDP,"visualEffect",{"enumerable":true,"configurable":false,"get":function(){return _visualEffect}});Object.defineProperty(ThinRDP,"edition",{"enumerable":true,"configurable":false,"get":function(){return _edition}});window.ThinRDP=ThinRDP})();
(function(){var thinRDP=null;var pWnd=null;helper.dom.ready(function(){thinRDP=new ThinRDP("",{"mode":ThinRDP.mode.API});helper.dom.addEvent(window,"message",function(e){if(!pWnd)pWnd=e.source;thinRDP.newProfile(e.data.profile,e.data.profileType,function(data){pWnd.postMessage({"data":data,"id":e.data.id},"*")},function(err){pWnd.postMessage({"message":err.message,"id":e.data.id},"*")})})})})();
