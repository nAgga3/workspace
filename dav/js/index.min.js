let accessKey="";if(vPathServerRoot!=="")accessKey=location.pathname.split(vPathServerRoot)[0];else{let pathnames=location.pathname.split("/");accessKey="/"+pathnames.find(path=>{return path!==""})}var webDavSettings={ApplicationAccessKey:accessKey,ApplicationPath:accessKey+(vPathServerRoot!=="/"?vPathServerRoot:""),ApplicationProtocolsPath:webDavServerRoot+"js/node_modules/webdav.client/Plugins/",EditDocAuth:{Authentication:"anonymous",CookieNames:null,SearchIn:null,LoginUrl:null}};
let titleElems=document?.head.getElementsByTagName("title");if(titleElems&&titleElems.length>0)titleElems[0].innerHTML=vPathServerRoot.replaceAll("/","");var __keepPingAlive__=null;const _apiUrl="__base__/";const _pingsController={list:{},time:3E4,url:"auth/ping"};
if(webDavSettings.ApplicationAccessKey!=""){__keepPingAlive__=new Worker(webDavServerRoot+"workers/webdav-worker.js");function sendPing(){let opts={headers:{"X-Ping-Data":JSON.stringify({ak:webDavSettings.ApplicationAccessKey,vp:vPathServerRoot})}};fetch(webDavOrigin+`/${_apiUrl}${_pingsController.url}`.replaceAll("//","/")+"?_h=xping&_t="+Date.now()).catch(err=>{console.log("ping error: "+err.message)});fetch((new URL(location)).origin+`/${webDavSettings.ApplicationAccessKey}/${_apiUrl}${_pingsController.url}`.replaceAll("//",
"/")+"?_h=xping&_t="+Date.now(),opts).catch(err=>{console.log("ping ${rulesSet.accessKey} error: "+err.message)});fetch((new URL(location)).origin+`/${webDavSettings.ApplicationPath}/dav_ping`.replaceAll("//","/")+"?_h=xping&_t="+Date.now(),opts).catch(err=>{console.log("dav ping ${rulesSet.accessKey} error: "+err.message)})}__keepPingAlive__.onmessage=function(e){if(e.data.cmd==="send")sendPing()};__keepPingAlive__.postMessage({cmd:"start",value:_pingsController.time})}
SessionData=(()=>{let ref={};let getReferrer=()=>{if(webDavOrigin!=="")return webDavOrigin+(vPathServerRoot===""?"/close.html":"");else{var inw=window.frameElement==null&&window.opener;let r=window.document.referrer.replaceAll(vPathServerRoot,"");if(!inw&&r!="")return r;else return"NULL"}};let key="__#webDav.data__";let data=sessionStorage.getItem(key);let appendData=path=>{if(!data)data={};data[path]=getReferrer();sessionStorage.setItem(key,JSON.stringify(data))};ref.removeData=path=>{delete data[path];
sessionStorage.setItem(key,JSON.stringify(data))};if(!data)appendData(vPathServerRoot);else{data=JSON.parse(data);if(!data[vPathServerRoot])appendData(vPathServerRoot)}ref.getExitUrl=path=>{return data[path]};return ref})();let btnExit=document.getElementById("btn-exit");
btnExit.addEventListener("click",function(){window.parent.postMessage({to:"webV7",type:"connection",cmd:"close",meta:window.__webV7__},"*");if(window.parent&&window!=window.parent)try{if(window.parent.location.href)wndp=window.parent}catch(error){wndp=window}else wndp=window;var mw=wndp!=window&&wndp==top?wndp:window;let wfe=window.frameElement==null||window.frameElement.getAttribute("__webV7_frame__")!==null;var inw=wfe&&(mw.opener&&mw!=mw.opener||mw.document.referrer==mw.document.location.href||
wndp==window);let url=SessionData.getExitUrl(vPathServerRoot);SessionData.removeData(vPathServerRoot);document.body.innerHTML="<div style='line-height: 50;text-align: center;'>Application Closed</div>";if(inw||!(url&&url!="NULL"))window.close();else window.location.href=url},false);
